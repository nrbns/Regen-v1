{"version":3,"file":"vectorWorker-UUx-mBKW.js","sources":["../src/workers/vectorWorker.ts"],"sourcesContent":["/**\r\n * Vector Operations Web Worker - Future Enhancement #3\r\n * Moves heavy vector computations off main thread\r\n * Handles: HNSW search, cosine similarity, embedding normalization\r\n */\r\n\r\n// Web Worker context - runs in separate thread\r\n// @ts-ignore - Web Worker global scope\r\nself.onmessage = async (event: MessageEvent) => {\r\n  const { type, payload, id } = event.data;\r\n\r\n  try {\r\n    switch (type) {\r\n      case 'search': {\r\n        const { queryVector, vectors, k = 5 } = payload;\r\n        const results = cosineSimilaritySearch(queryVector, vectors, k);\r\n        self.postMessage({ type: 'search_result', id, results });\r\n        break;\r\n      }\r\n\r\n      case 'normalize': {\r\n        const { vector } = payload;\r\n        const normalized = normalizeVector(vector);\r\n        self.postMessage({ type: 'normalize_result', id, vector: normalized });\r\n        break;\r\n      }\r\n\r\n      case 'batch_search': {\r\n        const { queryVectors, vectors, k = 5 } = payload;\r\n        const results = queryVectors.map((qv: number[]) => cosineSimilaritySearch(qv, vectors, k));\r\n        self.postMessage({ type: 'batch_search_result', id, results });\r\n        break;\r\n      }\r\n\r\n      case 'compute_similarity': {\r\n        const { vector1, vector2 } = payload;\r\n        const similarity = cosineSimilarity(vector1, vector2);\r\n        self.postMessage({ type: 'similarity_result', id, similarity });\r\n        break;\r\n      }\r\n\r\n      default:\r\n        self.postMessage({ type: 'error', id, error: `Unknown operation: ${type}` });\r\n    }\r\n  } catch (error) {\r\n    self.postMessage({\r\n      type: 'error',\r\n      id,\r\n      error: error instanceof Error ? error.message : String(error),\r\n    });\r\n  }\r\n};\r\n\r\n/**\r\n * Cosine similarity search (fast, in-memory)\r\n */\r\nfunction cosineSimilaritySearch(\r\n  queryVector: number[],\r\n  vectors: Array<{ id: string; vector: number[]; metadata?: any }>,\r\n  k: number\r\n): Array<{ id: string; score: number; metadata?: any }> {\r\n  const results = vectors\r\n    .map(v => ({\r\n      id: v.id,\r\n      score: cosineSimilarity(queryVector, v.vector),\r\n      metadata: v.metadata,\r\n    }))\r\n    .sort((a, b) => b.score - a.score)\r\n    .slice(0, k);\r\n\r\n  return results;\r\n}\r\n\r\n/**\r\n * Cosine similarity between two vectors\r\n */\r\nfunction cosineSimilarity(a: number[], b: number[]): number {\r\n  if (a.length !== b.length) return 0;\r\n\r\n  let dotProduct = 0;\r\n  let normA = 0;\r\n  let normB = 0;\r\n\r\n  for (let i = 0; i < a.length; i++) {\r\n    dotProduct += a[i] * b[i];\r\n    normA += a[i] * a[i];\r\n    normB += b[i] * b[i];\r\n  }\r\n\r\n  const denominator = Math.sqrt(normA) * Math.sqrt(normB);\r\n  return denominator === 0 ? 0 : dotProduct / denominator;\r\n}\r\n\r\n/**\r\n * Normalize vector to unit length\r\n */\r\nfunction normalizeVector(vector: number[]): number[] {\r\n  const norm = Math.sqrt(vector.reduce((sum, v) => sum + v * v, 0));\r\n  if (norm === 0) return vector;\r\n  return vector.map(v => v / norm);\r\n}\r\n"],"names":["event","type","payload","id","queryVector","vectors","k","results","cosineSimilaritySearch","vector","normalized","normalizeVector","queryVectors","qv","vector1","vector2","similarity","cosineSimilarity","error","v","a","b","dotProduct","normA","normB","i","denominator","norm","sum"],"mappings":"yBAQA,KAAK,UAAY,MAAOA,GAAwB,CAC9C,KAAM,CAAE,KAAAC,EAAM,QAAAC,EAAS,GAAAC,CAAA,EAAOH,EAAM,KAEpC,GAAI,CACF,OAAQC,EAAA,CACN,IAAK,SAAU,CACb,KAAM,CAAE,YAAAG,EAAa,QAAAC,EAAS,EAAAC,EAAI,GAAMJ,EAClCK,EAAUC,EAAuBJ,EAAaC,EAASC,CAAC,EAC9D,KAAK,YAAY,CAAE,KAAM,gBAAiB,GAAAH,EAAI,QAAAI,EAAS,EACvD,KACF,CAEA,IAAK,YAAa,CAChB,KAAM,CAAE,OAAAE,GAAWP,EACbQ,EAAaC,EAAgBF,CAAM,EACzC,KAAK,YAAY,CAAE,KAAM,mBAAoB,GAAAN,EAAI,OAAQO,EAAY,EACrE,KACF,CAEA,IAAK,eAAgB,CACnB,KAAM,CAAE,aAAAE,EAAc,QAAAP,EAAS,EAAAC,EAAI,GAAMJ,EACnCK,EAAUK,EAAa,IAAKC,GAAiBL,EAAuBK,EAAIR,EAASC,CAAC,CAAC,EACzF,KAAK,YAAY,CAAE,KAAM,sBAAuB,GAAAH,EAAI,QAAAI,EAAS,EAC7D,KACF,CAEA,IAAK,qBAAsB,CACzB,KAAM,CAAE,QAAAO,EAAS,QAAAC,CAAA,EAAYb,EACvBc,EAAaC,EAAiBH,EAASC,CAAO,EACpD,KAAK,YAAY,CAAE,KAAM,oBAAqB,GAAAZ,EAAI,WAAAa,EAAY,EAC9D,KACF,CAEA,QACE,KAAK,YAAY,CAAE,KAAM,QAAS,GAAAb,EAAI,MAAO,sBAAsBF,CAAI,GAAI,CAAA,CAEjF,OAASiB,EAAO,CACd,KAAK,YAAY,CACf,KAAM,QACN,GAAAf,EACA,MAAOe,aAAiB,MAAQA,EAAM,QAAU,OAAOA,CAAK,CAAA,CAC7D,CACH,CACF,EAKA,SAASV,EACPJ,EACAC,EACAC,EACsD,CAUtD,OATgBD,EACb,IAAIc,IAAM,CACT,GAAIA,EAAE,GACN,MAAOF,EAAiBb,EAAae,EAAE,MAAM,EAC7C,SAAUA,EAAE,QAAA,EACZ,EACD,KAAK,CAACC,EAAGC,IAAMA,EAAE,MAAQD,EAAE,KAAK,EAChC,MAAM,EAAGd,CAAC,CAGf,CAKA,SAASW,EAAiBG,EAAaC,EAAqB,CAC1D,GAAID,EAAE,SAAWC,EAAE,OAAQ,MAAO,GAElC,IAAIC,EAAa,EACbC,EAAQ,EACRC,EAAQ,EAEZ,QAASC,EAAI,EAAGA,EAAIL,EAAE,OAAQK,IAC5BH,GAAcF,EAAEK,CAAC,EAAIJ,EAAEI,CAAC,EACxBF,GAASH,EAAEK,CAAC,EAAIL,EAAEK,CAAC,EACnBD,GAASH,EAAEI,CAAC,EAAIJ,EAAEI,CAAC,EAGrB,MAAMC,EAAc,KAAK,KAAKH,CAAK,EAAI,KAAK,KAAKC,CAAK,EACtD,OAAOE,IAAgB,EAAI,EAAIJ,EAAaI,CAC9C,CAKA,SAASf,EAAgBF,EAA4B,CACnD,MAAMkB,EAAO,KAAK,KAAKlB,EAAO,OAAO,CAACmB,EAAKT,IAAMS,EAAMT,EAAIA,EAAG,CAAC,CAAC,EAChE,OAAIQ,IAAS,EAAUlB,EAChBA,EAAO,IAAIU,GAAKA,EAAIQ,CAAI,CACjC"}