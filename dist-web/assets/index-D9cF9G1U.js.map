{"version":3,"mappings":"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","names":["carbonEndpoints","carbonTokenWarningLogged","fetchCarbonIntensity","regionCode","defaultRegion","getEnvVar","region","apiBase","apiToken","isDevEnv","response","json","direct","error","watchBattery","isElectronRuntime","battery","lastCarbonFetch","lastRegionCode","lastCarbonValue","pushUpdate","forceCarbon","now","intensity","ipc","IPCEventBus","__publicField","event","callback","ipcCallbacks","globalHandler","_event","data","callbacks","eventData","cb","customHandlers","handler","e","ipcEvents","tabUpdateHandler","tabs","tabList","tabProgressHandler","progressData","navigationStateHandler","navData","cleanup","handleVisibilityChange","fullscreenHandler","sandboxWarningHandler","cleanupFullscreen","ResearchCacheDB","Dexie","db","cacheDocument","document","cacheChunks","chunks","cachedChunks","chunk","searchChunks","query","limit","terms","term","score","matches","item","a","b","syncDocumentsFromBackend","__vitePreload","n","documents","doc","idx","setupClipperHandlers","_payload","activeId","useTabsStore","result","payload","initRendererSentry","shutdownRendererSentry","syncRendererTelemetry","isTauriRuntime","analyticsEnabled","applyAnalyticsOptIn","optIn","syncAnalyticsOptIn","status","trackAnalyticsEvent","type","trackPageView","path","STORAGE_KEY","isBrowser","getSystemTheme","applyTheme","preference","resolved","initialPreference","stored","initialResolved","useThemeStore","create","set","get","order","current","next","mediaQuery","handleChange","ThemeProvider","children","state","syncLayoutPadding","useCallback","width","padding","useLayoutEffect","useTheme","setPreference","cyclePreference","CSP_DIRECTIVE","SAFE_IFRAME_SANDBOX","SUPPRESSED_PATTERNS","originalWarn","originalError","originalLog","isSuppressing","shouldSuppress","message","messageStr","m","pattern","suppressBrowserWarnings","args","arg","errorListener","errorString","originalConsoleWarn","originalConsoleError","target","prop","rejectionListener","reason","applyPerformanceMode","enabled","html","style","existingStyle","SettingsSync","settings","useSettingsStore","themePreference","setThemePreference","useEffect","theme","performanceMode","getUserFriendlyError","crashCount","MAX_CRASHES","CRASH_WINDOW_MS","crashHistory","recordCrash","context","toast","attemptRecovery","_context","keys","key","TelemetryMetrics","name","value","unit","metadata","metric","feature","existing","usage","analyticsClient","module","errorMetric","flow","flowId","f","duration","telemetryMetrics","MAX_RETRIES","ErrorBoundary","Component","props","retryCount","retryable","log","prev","errorInfo","errorReport","err","componentName","level","onError","friendlyMessage","sentryError","fallback","canRetry","jsxs","jsx","AlertTriangle","RefreshCw","Fragment","CheckCircle2","Copy","GlobalErrorBoundary","SNAPSHOT_KEY","SNAPSHOT_VERSION","SNAPSHOT_INTERVAL","snapshotInterval","createSnapshot","tabsStore","appStore","useAppStore","agentStore","useAgentStreamStore","saveSnapshot","snapshot","snap","startSnapshotting","TOUR_STEPS","Sparkles","Search","Mic","TrendingUp","QuickStartTour","currentStep","setCurrentStep","useState","isVisible","setIsVisible","handleNext","step","handleComplete","handleSkip","isLastStep","progress","AnimatePresence","motion","X","ArrowRight","LRUCache","capacity","hash","node","diskPath","fileData","invoke","text","embedding","lru","newNode","cachePath","bytes","totalAccess","hashes","lruCacheInstance","getLRUCache","getCachedEmbeddingLRU","model","cache","hashBuffer","saveCachedEmbeddingLRU","vector","QueryPrefetcher","predictions","words","continuation","q","queries","uncachedQueries","_query","p","currentUrl","related","urlWords","recentQuery","w","timeOfDay","hour","prefetcherInstance","getQueryPrefetcher","initializePrefetcher","prefetcher","tabsState","activeTab","t","VectorWorkerService","workerCode","blob","id","results","similarity","request","reject","queryVector","vectors","k","resolve","queryVectors","vector1","vector2","vectorWorkerInstance","getVectorWorkerService","lazyWithErrorHandling","importFn","React","AppShell","Home","Settings","Workspace","AgentConsole","Runs","Replay","PlaybookForge","HistoryPage","DownloadsPage","DocumentEditorPage","WatchersPage","VideoPage","ConsentTimelinePage","ensureCSPMeta","meta","LoadingFallback","router","createBrowserRouter","Suspense","rootElement","rootKey","existingRoot","root","ReactDOM","track","crashReporter","initMeiliIndexing","setupMeiliIndexes","verifySearchSystem","startSearchHealthMonitoring","fnName","_e","preconnectOllama","deferHeavyInit","initializeHeavyServices","authModule","syncModule","pluginModule","startTime","metrics","list","entry","initPerformanceMonitoring","telemetryMetrics$1","startupTime","registration","visibilityManager","memInfo","usedMB","limitMB","usagePercent","deferNonCriticalServices","_crashReporter","_authService","_syncService","_pluginRegistry","initializeTabSync","sessionId","bootMs","RouterProvider"],"ignoreList":[],"sources":["../../src/lib/battery.ts","../../src/lib/ipc-events.ts","../../src/lib/research/cache.ts","../../src/lib/research/clipper-handler.ts","../../src/lib/monitoring/sentry-client.ts","../../src/lib/monitoring/analytics-client.ts","../../src/state/themeStore.ts","../../src/ui/theme.tsx","../../src/config/security.ts","../../src/utils/suppressBrowserWarnings.ts","../../src/utils/performanceMode.ts","../../src/components/SettingsSync.tsx","../../src/utils/userFriendlyErrors.ts","../../src/services/errorRecovery.ts","../../src/services/telemetryMetrics.ts","../../src/core/errors/ErrorBoundary.tsx","../../src/core/recovery/snapshot.ts","../../src/components/Onboarding/QuickStartTour.tsx","../../src/services/embedding/lruCache.ts","../../src/services/prefetch/queryPrefetcher.ts","../../src/services/vector/vectorWorkerService.ts","../../src/main.tsx"],"sourcesContent":["import { ipc } from './ipc-typed';\r\nimport { getEnvVar, isDevEnv, isElectronRuntime } from './env';\r\n\r\ntype BatteryManager = {\r\n  charging: boolean;\r\n  chargingTime: number;\r\n  dischargingTime: number;\r\n  level: number;\r\n  addEventListener: (name: string, listener: () => void) => void;\r\n};\r\n\r\nconst carbonEndpoints: Record<string, string> = {\r\n  global: 'https://api.co2signal.com/v1/latest?country=',\r\n};\r\n\r\nlet carbonTokenWarningLogged = false;\r\n\r\nasync function fetchCarbonIntensity(regionCode?: string | null): Promise<{ intensity: number | null; region: string | null }> {\r\n  const defaultRegion = getEnvVar('CARBON_DEFAULT_REGION') || 'global';\r\n  const region = regionCode ?? defaultRegion;\r\n\r\n  const apiBase = getEnvVar('CARBON_API_URL') ?? carbonEndpoints.global;\r\n  const apiToken = getEnvVar('CARBON_API_TOKEN');\r\n\r\n  if (!apiBase) {\r\n    return { intensity: null, region };\r\n  }\r\n\r\n  if (apiBase === carbonEndpoints.global && !apiToken) {\r\n    if (isDevEnv() && !carbonTokenWarningLogged) {\r\n      carbonTokenWarningLogged = true;\r\n      console.info('[battery] Skipping carbon intensity fetch: CARBON_API_TOKEN not configured.');\r\n    }\r\n    return { intensity: null, region };\r\n  }\r\n\r\n  try {\r\n    const response = await fetch(`${apiBase}${encodeURIComponent(region)}`, {\r\n      headers: apiToken\r\n        ? { Authorization: `Bearer ${apiToken}` }\r\n        : undefined,\r\n    });\r\n\r\n    if (!response.ok) {\r\n      return { intensity: null, region };\r\n    }\r\n\r\n    const json = await response.json() as { data?: { carbonIntensity?: number; intensity?: { forecast?: number; average?: number } } };\r\n    const direct = json.data?.carbonIntensity ?? json.data?.intensity?.forecast ?? json.data?.intensity?.average;\r\n    if (typeof direct === 'number' && Number.isFinite(direct)) {\r\n      return { intensity: direct, region };\r\n    }\r\n  } catch (error) {\r\n    if (isDevEnv()) {\r\n      console.warn('[battery] Carbon intensity lookup failed', error);\r\n    }\r\n  }\r\n\r\n  return { intensity: null, region };\r\n}\r\n\r\nasync function watchBattery(): Promise<void> {\r\n  if (typeof navigator === 'undefined' || typeof (navigator as any).getBattery !== 'function') {\r\n    return;\r\n  }\r\n\r\n  if (!isElectronRuntime()) {\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const battery: BatteryManager = await (navigator as any).getBattery();\r\n\r\n    let lastCarbonFetch = 0;\r\n    let lastRegionCode: string | null = null;\r\n    let lastCarbonValue: number | null = null;\r\n\r\n    const pushUpdate = async (forceCarbon = false) => {\r\n      const now = Date.now();\r\n      const needsCarbon = forceCarbon || (now - lastCarbonFetch > 15 * 60 * 1000);\r\n\r\n      if (needsCarbon) {\r\n        const { intensity, region } = await fetchCarbonIntensity(lastRegionCode);\r\n        lastCarbonFetch = Date.now();\r\n        lastCarbonValue = intensity ?? lastCarbonValue;\r\n        lastRegionCode = region ?? lastRegionCode;\r\n      }\r\n\r\n      try {\r\n        if (ipc.performance?.battery?.update) {\r\n          await ipc.performance.battery.update({\r\n            level: typeof battery.level === 'number' ? battery.level : null,\r\n            charging: battery.charging,\r\n            chargingTime: Number.isFinite(battery.chargingTime) ? battery.chargingTime : null,\r\n            dischargingTime: Number.isFinite(battery.dischargingTime) ? battery.dischargingTime : null,\r\n            carbonIntensity: lastCarbonValue,\r\n            regionCode: lastRegionCode,\r\n          });\r\n        }\r\n      } catch (error) {\r\n        if (isDevEnv()) {\r\n          console.warn('[battery] Failed to push battery update', error);\r\n        }\r\n      }\r\n    };\r\n\r\n    void pushUpdate(true);\r\n\r\n    battery.addEventListener('levelchange', () => void pushUpdate());\r\n    battery.addEventListener('chargingchange', () => void pushUpdate(true));\r\n    battery.addEventListener('chargingtimechange', () => void pushUpdate());\r\n    battery.addEventListener('dischargingtimechange', () => void pushUpdate());\r\n  } catch (error) {\r\n    if (isDevEnv()) {\r\n      console.warn('[battery] Battery API unavailable', error);\r\n    }\r\n  }\r\n}\r\n\r\nvoid watchBattery();\r\n","/**\n * Real-time IPC Event System\n * Typed event listeners for live updates from main process\n */\n\n// @ts-nocheck\n\nexport interface TabUpdate {\n  id: string;\n  title: string;\n  url: string;\n  active: boolean;\n  favicon?: string;\n  progress?: number;\n  isLoading?: boolean;\n  mode?: 'normal' | 'ghost' | 'private';\n  containerId?: string;\n  containerName?: string;\n  containerColor?: string;\n  createdAt?: number;\n  lastActiveAt?: number;\n  sessionId?: string;\n  profileId?: string;\n}\n\nexport interface ContainerInfo {\n  id: string;\n  name: string;\n  color: string;\n  icon?: string;\n  description?: string;\n  scope?: 'global' | 'session' | 'ephemeral';\n  persistent?: boolean;\n  system?: boolean;\n}\n\nexport type ProfileKind = 'default' | 'work' | 'personal' | 'custom';\n\nexport interface ProfilePolicy {\n  allowDownloads: boolean;\n  allowPrivateWindows: boolean;\n  allowGhostTabs: boolean;\n  allowScreenshots: boolean;\n  allowClipping: boolean;\n}\n\nexport interface ProfileInfo {\n  id: string;\n  name: string;\n  color?: string;\n  kind?: ProfileKind;\n  system?: boolean;\n  policy?: ProfilePolicy;\n  description?: string;\n}\n\nexport type ProfilePolicyAction =\n  | 'downloads'\n  | 'private-window'\n  | 'ghost-tab'\n  | 'screenshot'\n  | 'clip';\n\nexport interface ProfilePolicyBlockedEvent {\n  profileId: string;\n  action: ProfilePolicyAction;\n}\n\nexport interface ShieldsCounters {\n  tabId: string;\n  ads: number;\n  trackers: number;\n  httpsUpgrades: number;\n  cookiesBlocked: number;\n}\n\nexport interface NetworkStatus {\n  proxy?: {\n    enabled: boolean;\n    type: 'socks5' | 'http' | 'tor';\n    host?: string;\n  };\n  tor?: {\n    enabled: boolean;\n    circuitEstablished: boolean;\n    identity: string;\n    progress?: number;\n    bootstrapped?: boolean;\n    error?: string;\n    stub?: boolean;\n  };\n  vpn?: {\n    enabled: boolean;\n    connected: boolean;\n    provider?: string;\n    server?: string;\n    interface?: string;\n  };\n  doh?: {\n    enabled: boolean;\n    provider: string;\n  };\n}\n\nexport interface PageWatcher {\n  id: string;\n  url: string;\n  createdAt: number;\n  intervalMinutes: number;\n  lastCheckedAt?: number;\n  lastHash?: string;\n  lastChangeAt?: number;\n  status: 'idle' | 'checking' | 'changed' | 'error';\n  error?: string;\n}\n\nexport interface DownloadUpdate {\n  id: string;\n  url: string;\n  filename: string;\n  status:\n    | 'pending'\n    | 'downloading'\n    | 'completed'\n    | 'failed'\n    | 'cancelled'\n    | 'paused'\n    | 'blocked'\n    | 'verifying';\n  progress?: number;\n  receivedBytes?: number;\n  totalBytes?: number;\n  path?: string;\n  checksum?: string;\n  createdAt?: number;\n  speedBytesPerSec?: number;\n  etaSeconds?: number;\n  safety?: {\n    status: 'pending' | 'clean' | 'warning' | 'blocked' | 'unknown';\n    threatLevel?: 'low' | 'medium' | 'high' | 'critical';\n    details?: string;\n    recommendations?: string[];\n    scannedAt?: number;\n    quarantinePath?: string;\n  };\n}\n\nexport interface AgentStep {\n  taskId: string;\n  stepId: string;\n  type: 'plan' | 'tool' | 'log' | 'result';\n  content: string;\n  timestamp: number;\n}\n\nexport interface AgentPlan {\n  taskId: string;\n  steps: Array<{ id: string; description: string; tool?: string }>;\n  budget: { tokens: number; seconds: number; requests: number };\n  remaining: { tokens: number; seconds: number; requests: number };\n}\n\nexport interface PermissionRequest {\n  id: string;\n  origin: string;\n  permission: 'camera' | 'microphone' | 'filesystem' | 'notifications';\n  callback: (granted: boolean, remember?: boolean) => void;\n}\n\nexport interface ConsentRequest {\n  id: string;\n  action: {\n    type: string;\n    description: string;\n    risk: 'low' | 'medium' | 'high';\n  };\n  callback: (approved: boolean) => void;\n}\n\nexport interface TabNavigationState {\n  tabId: string;\n  canGoBack: boolean;\n  canGoForward: boolean;\n}\n\nexport interface EfficiencyModeEvent {\n  mode: 'normal' | 'battery-saver' | 'extreme';\n  label?: string | null;\n  badge?: string | null;\n  timestamp: number;\n  snapshot: {\n    batteryPct: number | null;\n    charging: boolean | null;\n    ramMb: number;\n    cpuLoad1: number;\n    activeTabs: number;\n    carbonIntensity?: number | null;\n    carbonRegion?: string | null;\n  };\n}\n\nexport interface EfficiencyAlertAction {\n  id: string;\n  label: string;\n  type: 'mode' | 'hibernate';\n  mode?: 'normal' | 'battery-saver' | 'extreme';\n}\n\nexport interface EfficiencyAlert {\n  id: string;\n  severity: 'info' | 'warning' | 'critical';\n  title: string;\n  message: string;\n  timestamp: number;\n  actions: EfficiencyAlertAction[];\n}\n\nexport interface GameSandboxWarning {\n  sandboxId: string;\n  gameId: string;\n  warnings: Array<{ severity: 'warning' | 'critical'; message: string }>;\n  metrics?: {\n    fps?: number;\n    droppedFrames?: number;\n    memoryMb?: number;\n    cpuPercent?: number;\n  };\n}\n\nexport interface PrivacyAuditSummary {\n  score: number;\n  grade: 'low' | 'moderate' | 'high';\n  trackers: Array<{ host: string; count: number }>;\n  thirdPartyHosts: Array<{ host: string; count: number }>;\n  message: string;\n  suggestions: string[];\n  timestamp: number;\n  ai?: {\n    riskScore: number;\n    riskLevel: 'low' | 'medium' | 'high';\n    summary: string;\n    actions: string[];\n    issues: Array<{ category: string; detail: string; severity: 'low' | 'medium' | 'high' }>;\n    generatedAt?: string;\n  } | null;\n}\n\n// Event bus for renderer-side state management\nclass IPCEventBus {\n  private listeners = new Map<string, Set<(data: any) => void>>();\n  private ipcListeners = new Map<string, WeakSet<(data: any) => void>>(); // Use WeakSet to track IPC listeners\n  private customEventHandlers = new Map<string, WeakMap<(data: any) => void, EventListener>>(); // Use WeakMap for custom handlers\n  private registeredChannels = new Set<string>(); // Track which IPC channels we've registered globally\n  private ipcHandlers = new Map<string, (event: any, data: any) => void>(); // Store IPC handlers in a Map instead of on window.ipc\n\n  on<T>(event: string, callback: (data: T) => void): () => void {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set());\n    }\n    this.listeners.get(event)!.add(callback);\n\n    // Subscribe to IPC channel if window.ipc exists (only once per event channel)\n    if (window.ipc && (window.ipc as any).on) {\n      if (!this.ipcListeners.has(event)) {\n        this.ipcListeners.set(event, new WeakSet());\n      }\n      const ipcCallbacks = this.ipcListeners.get(event)!;\n\n      // Only register the channel once globally, not per callback\n      if (!this.registeredChannels.has(event)) {\n        this.registeredChannels.add(event);\n        const globalHandler = (_event: any, data: any) => {\n          // Emit to all listeners for this event\n          const callbacks = this.listeners.get(event);\n          if (callbacks) {\n            const eventData = data || _event;\n            callbacks.forEach(cb => {\n              try {\n                cb(eventData);\n              } catch (error) {\n                console.error(`Error in IPC event handler for ${event}:`, error);\n              }\n            });\n          }\n        };\n        (window.ipc as any).on(event, globalHandler);\n        // Store the handler in our Map instead of on window.ipc\n        this.ipcHandlers.set(event, globalHandler);\n      }\n\n      // Track this callback (using WeakSet, so it's automatically cleaned up)\n      ipcCallbacks.add(callback);\n    }\n\n    // Also listen for custom events (only once per callback)\n    if (!this.customEventHandlers.has(event)) {\n      this.customEventHandlers.set(event, new WeakMap());\n    }\n    const customHandlers = this.customEventHandlers.get(event)!;\n    if (!customHandlers.has(callback)) {\n      const handler = (e: CustomEvent) => {\n        try {\n          callback(e.detail);\n        } catch (error) {\n          console.error(`Error in custom event handler for ${event}:`, error);\n        }\n      };\n      customHandlers.set(callback, handler);\n      window.addEventListener(event, handler as EventListener);\n    }\n\n    // Return unsubscribe function\n    return () => {\n      this.listeners.get(event)?.delete(callback);\n\n      // Remove custom event listener\n      const customHandlers = this.customEventHandlers.get(event);\n      if (customHandlers?.has(callback)) {\n        const handler = customHandlers.get(callback);\n        if (handler) {\n          window.removeEventListener(event, handler as EventListener);\n        }\n      }\n    };\n  }\n\n  emit(event: string, data: any) {\n    window.dispatchEvent(new CustomEvent(event, { detail: data }));\n  }\n\n  off(event: string, callback: (data: any) => void) {\n    this.listeners.get(event)?.delete(callback);\n    // Note: IPC listeners are managed globally, not per-callback\n    // They will be cleaned up when the channel is no longer needed\n  }\n\n  // Cleanup all listeners for an event (call when component unmounts or event is no longer needed)\n  removeAllListeners(event: string) {\n    this.listeners.delete(event);\n    this.ipcListeners.delete(event);\n    this.customEventHandlers.delete(event);\n    this.registeredChannels.delete(event);\n\n    // Remove global IPC handler if it exists\n    if (window.ipc && (window.ipc as any).removeListener) {\n      const handler = this.ipcHandlers.get(event);\n      if (handler) {\n        (window.ipc as any).removeListener(event, handler);\n        this.ipcHandlers.delete(event);\n      }\n    }\n  }\n}\n\nexport const ipcEvents = new IPCEventBus();\n\n// Subscribe to typed IPC channels\nif (typeof window !== 'undefined') {\n  // Listen for tab updates\n  if (window.ipc && (window.ipc as any).on) {\n    const tabUpdateHandler = (_event: any, tabs: any) => {\n      // Handle both direct data and event+data formats\n      const tabList = Array.isArray(tabs) ? tabs : Array.isArray(_event) ? _event : [];\n      ipcEvents.emit('tabs:updated', tabList);\n    };\n    const tabProgressHandler = (_event: any, data: any) => {\n      const progressData = data || _event;\n      ipcEvents.emit('tabs:progress', progressData);\n    };\n    const navigationStateHandler = (_event: any, data: any) => {\n      const navData = data || _event;\n      ipcEvents.emit('tabs:navigation-state', navData);\n    };\n\n    // Listen to both legacy and typed IPC channels\n    (window.ipc as any).on('tabs:updated', tabUpdateHandler);\n    (window.ipc as any).on('ob://ipc/v1/tabs:updated', tabUpdateHandler);\n    (window.ipc as any).on('tabs:progress', tabProgressHandler);\n    (window.ipc as any).on('ob://ipc/v1/tabs:progress', tabProgressHandler);\n    (window.ipc as any).on('tabs:navigation-state', navigationStateHandler);\n    (window.ipc as any).on('ob://ipc/v1/tabs:navigation-state', navigationStateHandler);\n\n    // Proper cleanup using Page Lifecycle API instead of unload\n    const cleanup = () => {\n      if (window.ipc && (window.ipc as any).removeListener) {\n        (window.ipc as any).removeListener('tabs:updated', tabUpdateHandler);\n        (window.ipc as any).removeListener('ob://ipc/v1/tabs:updated', tabUpdateHandler);\n        (window.ipc as any).removeListener('tabs:progress', tabProgressHandler);\n        (window.ipc as any).removeListener('ob://ipc/v1/tabs:progress', tabProgressHandler);\n        (window.ipc as any).removeListener('tabs:navigation-state', navigationStateHandler);\n        (window.ipc as any).removeListener(\n          'ob://ipc/v1/tabs:navigation-state',\n          navigationStateHandler\n        );\n      }\n    };\n\n    // Use pagehide event (modern alternative to unload)\n    if ('onpagehide' in window) {\n      window.addEventListener('pagehide', cleanup);\n    }\n    // Fallback for browsers that don't support pagehide\n    if (typeof document !== 'undefined' && 'visibilityState' in document) {\n      const handleVisibilityChange = () => {\n        if (document.visibilityState === 'hidden') {\n          // Don't cleanup on visibility change, only on actual page unload\n        }\n      };\n      document.addEventListener('visibilitychange', handleVisibilityChange);\n    }\n  }\n\n  // Listen for shields counters\n  window.addEventListener('shields:counters', ((e: CustomEvent<ShieldsCounters>) => {\n    ipcEvents.emit('shields:counters', e.detail);\n  }) as EventListener);\n\n  // Listen for network status\n  window.addEventListener('net:status', ((e: CustomEvent<NetworkStatus>) => {\n    ipcEvents.emit('net:status', e.detail);\n  }) as EventListener);\n\n  // Listen for downloads\n  window.addEventListener('downloads:started', ((e: CustomEvent<DownloadUpdate>) => {\n    ipcEvents.emit('downloads:started', e.detail);\n  }) as EventListener);\n  window.addEventListener('downloads:progress', ((e: CustomEvent<DownloadUpdate>) => {\n    ipcEvents.emit('downloads:progress', e.detail);\n  }) as EventListener);\n  window.addEventListener('downloads:done', ((e: CustomEvent<DownloadUpdate>) => {\n    ipcEvents.emit('downloads:done', e.detail);\n  }) as EventListener);\n\n  // Listen for agent events\n  window.addEventListener('agent:plan', ((e: CustomEvent<AgentPlan>) => {\n    ipcEvents.emit('agent:plan', e.detail);\n  }) as EventListener);\n  window.addEventListener('agent:step', ((e: CustomEvent<AgentStep>) => {\n    ipcEvents.emit('agent:step', e.detail);\n  }) as EventListener);\n  window.addEventListener('agent:log', ((e: CustomEvent<AgentStep>) => {\n    ipcEvents.emit('agent:log', e.detail);\n  }) as EventListener);\n  window.addEventListener('agent:consent:request', ((e: CustomEvent<ConsentRequest>) => {\n    ipcEvents.emit('agent:consent:request', e.detail);\n  }) as EventListener);\n\n  // Listen for streaming AI events via IPC\n  if (window.ipc && (window.ipc as any).on) {\n    (window.ipc as any).on('agent:stream:chunk', (_event: any, data: any) => {\n      ipcEvents.emit('agent:stream:chunk', data);\n    });\n    (window.ipc as any).on('agent:stream:done', (_event: any, data: any) => {\n      ipcEvents.emit('agent:stream:done', data);\n    });\n    (window.ipc as any).on('agent:stream:error', (_event: any, data: any) => {\n      ipcEvents.emit('agent:stream:error', data);\n    });\n  }\n\n  // Listen for permission requests\n  window.addEventListener('permissions:request', ((e: CustomEvent<PermissionRequest>) => {\n    ipcEvents.emit('permissions:request', e.detail);\n  }) as EventListener);\n\n  // Listen for fullscreen changes\n  window.addEventListener('app:fullscreen-changed', ((e: CustomEvent<{ fullscreen: boolean }>) => {\n    ipcEvents.emit('app:fullscreen-changed', e.detail);\n  }) as EventListener);\n\n  window.addEventListener('games:sandbox:warning', ((e: CustomEvent<GameSandboxWarning>) => {\n    ipcEvents.emit('games:sandbox:warning', e.detail);\n  }) as EventListener);\n\n  // Also listen via IPC if available\n  if (window.ipc && (window.ipc as any).on) {\n    const fullscreenHandler = (data: { fullscreen: boolean }) => {\n      ipcEvents.emit('app:fullscreen-changed', data);\n    };\n    (window.ipc as any).on('app:fullscreen-changed', fullscreenHandler);\n\n    const sandboxWarningHandler = (_event: any, data: GameSandboxWarning) => {\n      ipcEvents.emit('games:sandbox:warning', data);\n    };\n    (window.ipc as any).on('games:sandbox:warning', sandboxWarningHandler);\n\n    // Cleanup handler for fullscreen events\n    const cleanupFullscreen = () => {\n      if (window.ipc && (window.ipc as any).removeListener) {\n        (window.ipc as any).removeListener('app:fullscreen-changed', fullscreenHandler);\n        (window.ipc as any).removeListener('games:sandbox:warning', sandboxWarningHandler);\n      }\n    };\n\n    // Use pagehide for cleanup (modern alternative to unload)\n    if ('onpagehide' in window) {\n      window.addEventListener('pagehide', cleanupFullscreen, { once: true });\n    }\n  }\n}\n\n// React hooks for easy component integration\n// Note: This hook must be imported and used in React components\n// The actual hook implementation is in a separate file to avoid require() in browser\n","/**\r\n * Research Cache - IndexedDB storage for fast local retrieval\r\n * Uses Dexie for IndexedDB management\r\n */\r\n\r\nimport Dexie, { Table } from 'dexie';\r\n\r\nexport interface CachedDocument {\r\n  id: string;\r\n  type: 'tab' | 'pdf' | 'docx' | 'txt' | 'md' | 'html';\r\n  title: string;\r\n  url?: string;\r\n  filename?: string;\r\n  uploadedAt: number;\r\n  chunkCount: number;\r\n  size: number;\r\n  // Cached metadata\r\n  metadata: {\r\n    sourceType: string;\r\n    url?: string;\r\n    title?: string;\r\n  };\r\n}\r\n\r\nexport interface CachedChunk {\r\n  id: string;\r\n  documentId: string;\r\n  content: string;\r\n  chunkIndex: number;\r\n  startChar: number;\r\n  endChar: number;\r\n  metadata: {\r\n    sourceType: string;\r\n    url?: string;\r\n    title?: string;\r\n    page?: number;\r\n    section?: string;\r\n  };\r\n  // For local search\r\n  contentLower: string;\r\n  // Timestamp for cache invalidation\r\n  cachedAt: number;\r\n}\r\n\r\nexport interface CachedEmbedding {\r\n  chunkId: string;\r\n  documentId: string;\r\n  embedding?: number[]; // Vector embedding (optional, for future use)\r\n  cachedAt: number;\r\n}\r\n\r\nclass ResearchCacheDB extends Dexie {\r\n  documents!: Table<CachedDocument>;\r\n  chunks!: Table<CachedChunk>;\r\n  embeddings!: Table<CachedEmbedding>;\r\n\r\n  constructor() {\r\n    super('ResearchCache');\r\n    \r\n    this.version(1).stores({\r\n      documents: 'id, type, uploadedAt, url, title',\r\n      chunks: 'id, documentId, chunkIndex, [documentId+chunkIndex], cachedAt',\r\n      embeddings: 'chunkId, documentId, cachedAt',\r\n    });\r\n  }\r\n}\r\n\r\nconst db = new ResearchCacheDB();\r\n\r\n/**\r\n * Cache a document\r\n */\r\nexport async function cacheDocument(document: {\r\n  id: string;\r\n  type: 'tab' | 'pdf' | 'docx' | 'txt' | 'md' | 'html';\r\n  title: string;\r\n  url?: string;\r\n  filename?: string;\r\n  uploadedAt: number;\r\n  chunkCount: number;\r\n  size: number;\r\n  metadata?: any;\r\n}): Promise<void> {\r\n  try {\r\n    await db.documents.put({\r\n      ...document,\r\n      metadata: document.metadata || {},\r\n    });\r\n  } catch (error) {\r\n    console.error('[Research Cache] Failed to cache document:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Cache chunks for a document\r\n */\r\nexport async function cacheChunks(chunks: Array<{\r\n  id: string;\r\n  documentId: string;\r\n  content: string;\r\n  chunkIndex: number;\r\n  startChar: number;\r\n  endChar: number;\r\n  metadata: any;\r\n}>): Promise<void> {\r\n  try {\r\n    const cachedChunks: CachedChunk[] = chunks.map(chunk => ({\r\n      ...chunk,\r\n      contentLower: chunk.content.toLowerCase(),\r\n      cachedAt: Date.now(),\r\n    }));\r\n\r\n    await db.chunks.bulkPut(cachedChunks);\r\n  } catch (error) {\r\n    console.error('[Research Cache] Failed to cache chunks:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Get cached document\r\n */\r\nexport async function getCachedDocument(documentId: string): Promise<CachedDocument | undefined> {\r\n  try {\r\n    return await db.documents.get(documentId);\r\n  } catch (error) {\r\n    console.error('[Research Cache] Failed to get cached document:', error);\r\n    return undefined;\r\n  }\r\n}\r\n\r\n/**\r\n * Get cached chunks for a document\r\n */\r\nexport async function getCachedChunks(documentId: string): Promise<CachedChunk[]> {\r\n  try {\r\n    return await db.chunks\r\n      .where('documentId')\r\n      .equals(documentId)\r\n      .sortBy('chunkIndex');\r\n  } catch (error) {\r\n    console.error('[Research Cache] Failed to get cached chunks:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Search chunks by text (local full-text search)\r\n */\r\nexport async function searchChunks(query: string, limit: number = 20): Promise<CachedChunk[]> {\r\n  try {\r\n    const queryLower = query.toLowerCase();\r\n    const terms = queryLower.split(/\\s+/).filter(term => term.length > 2);\r\n\r\n    if (terms.length === 0) {\r\n      return [];\r\n    }\r\n\r\n    // Simple full-text search using IndexedDB\r\n    // For better performance, we could use a more sophisticated approach\r\n    const allChunks = await db.chunks.toArray();\r\n    \r\n    // Score chunks by term matches\r\n    const scored = allChunks.map(chunk => {\r\n      let score = 0;\r\n      for (const term of terms) {\r\n        const matches = (chunk.contentLower.match(new RegExp(term, 'g')) || []).length;\r\n        score += matches;\r\n      }\r\n      return { chunk, score };\r\n    });\r\n\r\n    // Sort by score and return top results\r\n    return scored\r\n      .filter(item => item.score > 0)\r\n      .sort((a, b) => b.score - a.score)\r\n      .slice(0, limit)\r\n      .map(item => item.chunk);\r\n  } catch (error) {\r\n    console.error('[Research Cache] Failed to search chunks:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * List all cached documents (sorted by upload date)\r\n */\r\nexport async function listCachedDocuments(limit?: number): Promise<CachedDocument[]> {\r\n  try {\r\n    let query = db.documents.orderBy('uploadedAt').reverse();\r\n    if (limit) {\r\n      query = query.limit(limit);\r\n    }\r\n    return await query.toArray();\r\n  } catch (error) {\r\n    console.error('[Research Cache] Failed to list documents:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Delete cached document and its chunks\r\n */\r\nexport async function deleteCachedDocument(documentId: string): Promise<void> {\r\n  try {\r\n    await db.transaction('rw', db.documents, db.chunks, db.embeddings, async () => {\r\n      await db.documents.delete(documentId);\r\n      await db.chunks.where('documentId').equals(documentId).delete();\r\n      await db.embeddings.where('documentId').equals(documentId).delete();\r\n    });\r\n  } catch (error) {\r\n    console.error('[Research Cache] Failed to delete cached document:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Clear old cache entries (older than specified days)\r\n */\r\nexport async function clearOldCache(maxAgeDays: number = 30): Promise<number> {\r\n  try {\r\n    const cutoff = Date.now() - maxAgeDays * 24 * 60 * 60 * 1000;\r\n    \r\n    // Delete old chunks\r\n    const oldChunks = await db.chunks.where('cachedAt').below(cutoff).delete();\r\n    \r\n    // Delete old embeddings\r\n    const oldEmbeddings = await db.embeddings.where('cachedAt').below(cutoff).delete();\r\n    \r\n    return oldChunks + oldEmbeddings;\r\n  } catch (error) {\r\n    console.error('[Research Cache] Failed to clear old cache:', error);\r\n    return 0;\r\n  }\r\n}\r\n\r\n/**\r\n * Get cache statistics\r\n */\r\nexport async function getCacheStats(): Promise<{\r\n  documentCount: number;\r\n  chunkCount: number;\r\n  embeddingCount: number;\r\n  totalSize: number;\r\n}> {\r\n  try {\r\n    const [documents, chunks, embeddings] = await Promise.all([\r\n      db.documents.count(),\r\n      db.chunks.count(),\r\n      db.embeddings.count(),\r\n    ]);\r\n\r\n    // Estimate total size (rough calculation)\r\n    const allChunks = await db.chunks.toArray();\r\n    const totalSize = allChunks.reduce((sum, chunk) => sum + chunk.content.length, 0);\r\n\r\n    return {\r\n      documentCount: documents,\r\n      chunkCount: chunks,\r\n      embeddingCount: embeddings,\r\n      totalSize,\r\n    };\r\n  } catch (error) {\r\n    console.error('[Research Cache] Failed to get cache stats:', error);\r\n    return {\r\n      documentCount: 0,\r\n      chunkCount: 0,\r\n      embeddingCount: 0,\r\n      totalSize: 0,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Sync documents from backend to cache\r\n */\r\nexport async function syncDocumentsFromBackend(): Promise<void> {\r\n  try {\r\n    // This would be called from the IPC layer after fetching documents\r\n    // For now, it's a placeholder for future sync logic\r\n    const { ipc } = await import('../ipc-typed');\r\n    const { documents } = await ipc.research.listDocuments();\r\n\r\n    // Cache each document\r\n    for (const doc of documents) {\r\n      await cacheDocument({\r\n        id: doc.id,\r\n        type: doc.type as any,\r\n        title: doc.title,\r\n        uploadedAt: doc.uploadedAt,\r\n        chunkCount: doc.chunkCount,\r\n        size: 0, // Size not available from list\r\n      });\r\n\r\n      // Fetch and cache chunks\r\n      const { chunks } = await ipc.research.getDocumentChunks(doc.id);\r\n      if (chunks.length > 0) {\r\n        await cacheChunks(chunks.map((chunk: any, idx: number) => ({\r\n          id: chunk.id || `${doc.id}-chunk-${idx}`,\r\n          documentId: doc.id,\r\n          content: chunk.content,\r\n          chunkIndex: chunk.chunkIndex ?? idx,\r\n          startChar: chunk.startChar ?? 0,\r\n          endChar: chunk.endChar ?? chunk.content.length,\r\n          metadata: chunk.metadata || {},\r\n        })));\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('[Research Cache] Failed to sync from backend:', error);\r\n  }\r\n}\r\n\r\n","/**\r\n * Research Clipper Handler - Client-side handlers for clipper events\r\n */\r\n\r\nimport { ipc } from '../ipc-typed';\r\nimport { ipcEvents } from '../ipc-events';\r\nimport { useTabsStore } from '../../state/tabsStore';\r\nimport { syncDocumentsFromBackend } from './cache';\r\n\r\n/**\r\n * Setup clipper event handlers\r\n */\r\nexport function setupClipperHandlers() {\r\n  // Handle context menu capture\r\n  ipcEvents.on<{ url: string; hasSelection: boolean }>('research:capture-from-context-menu', async (_payload) => {\r\n    try {\r\n      const { activeId } = useTabsStore.getState();\r\n      if (activeId) {\r\n        const result = await ipc.research.capturePage(activeId);\r\n        console.log('[Research Clipper] Page captured:', result.snapshotId);\r\n        \r\n        // Sync to cache\r\n        setTimeout(async () => {\r\n          try {\r\n            await syncDocumentsFromBackend();\r\n          } catch (error) {\r\n            console.error('Failed to sync after capture:', error);\r\n          }\r\n        }, 2000);\r\n      }\r\n    } catch (error) {\r\n      console.error('[Research Clipper] Failed to capture from context menu:', error);\r\n    }\r\n  });\r\n\r\n  // Handle selection capture\r\n  ipcEvents.on<{ text: string; url: string }>('research:capture-selection-from-context', async (payload) => {\r\n    try {\r\n      const { activeId } = useTabsStore.getState();\r\n      const result = await ipc.research.captureSelection(payload.text ? payload.text : undefined, activeId ?? undefined);\r\n      console.log('[Research Clipper] Selection captured:', result.clipId);\r\n    } catch (error) {\r\n      console.error('[Research Clipper] Failed to capture selection:', error);\r\n    }\r\n  });\r\n\r\n  // Handle keyboard shortcuts\r\n  ipcEvents.on('research:keyboard-capture', async () => {\r\n    try {\r\n      const { activeId } = useTabsStore.getState();\r\n      if (activeId) {\r\n        const result = await ipc.research.capturePage(activeId);\r\n        console.log('[Research Clipper] Page captured via keyboard:', result.snapshotId);\r\n        \r\n        setTimeout(async () => {\r\n          try {\r\n            await syncDocumentsFromBackend();\r\n          } catch (error) {\r\n            console.error('Failed to sync after capture:', error);\r\n          }\r\n        }, 2000);\r\n      }\r\n    } catch (error) {\r\n      console.error('[Research Clipper] Failed to capture via keyboard:', error);\r\n    }\r\n  });\r\n\r\n  ipcEvents.on('research:keyboard-open-pane', () => {\r\n    // This would trigger opening the Research Pane\r\n    // The Research Pane component handles its own open state\r\n    console.log('[Research Clipper] Open Research Pane requested');\r\n  });\r\n}\r\n\r\n","// @ts-nocheck\n/**\n * Renderer-side telemetry + Sentry helpers\n * Ensures crash reporting only runs when the user has opted in.\n * Supports both Electron and Tauri runtimes.\n */\n\nimport { ipc } from '../ipc-typed';\nimport { isElectronRuntime, isTauriRuntime } from '../env';\n\n// Sentry is optional - use any to avoid build-time resolution\nlet rendererSentry: any = null;\nlet sentryInitialized = false;\n\nconst SENTRY_DSN = import.meta.env.VITE_SENTRY_DSN || import.meta.env.SENTRY_DSN || '';\nconst SENTRY_ENV = import.meta.env.MODE || process.env.NODE_ENV || 'development';\nconst SENTRY_SAMPLE_RATE = Number(import.meta.env.VITE_SENTRY_TRACES_SAMPLE_RATE ?? '0');\nconst RELEASE = import.meta.env.VITE_APP_VERSION || '0.0.0';\n\n// Validate DSN format (basic check)\nfunction isValidSentryDSN(dsn: string): boolean {\n  if (!dsn || dsn.trim().length === 0) return false;\n  // Reject placeholder values\n  if (dsn.includes('your-sentry-dsn') || dsn.includes('your_sentry_dsn')) return false;\n  // Basic format check: should start with https://\n  return dsn.startsWith('https://') && dsn.includes('@');\n}\n\nasync function initRendererSentry() {\n  if (sentryInitialized) return;\n  if (!SENTRY_DSN || !isValidSentryDSN(SENTRY_DSN)) {\n    // Only log in dev mode to avoid console spam\n    if (SENTRY_ENV === 'development') {\n      console.log('[Sentry] DSN not configured or invalid - skipping initialization');\n    }\n    return;\n  }\n\n  // Try Tauri first (current runtime), then fallback to Electron\n  if (!rendererSentry) {\n    try {\n      // Try @sentry/react for Tauri/web\n      const reactSentry = await import('@sentry/react').catch(() => null);\n      if (reactSentry && reactSentry.init) {\n        rendererSentry = reactSentry;\n        console.info('[Sentry] Using @sentry/react for Tauri/web');\n      } else {\n        // Fallback to Electron if available\n        const importSentry = new Function('return import(\"@sentry/electron/renderer\")');\n        const sentryModule = await importSentry().catch(() => null);\n        if (sentryModule) {\n          rendererSentry = sentryModule;\n          console.info('[Sentry] Using @sentry/electron/renderer');\n        }\n      }\n    } catch (error) {\n      console.warn('[Sentry] Renderer SDK unavailable', error);\n      return;\n    }\n  }\n\n  if (!rendererSentry || !rendererSentry.init) {\n    console.warn('[Sentry] Renderer SDK not available');\n    return;\n  }\n\n  try {\n    rendererSentry.init({\n      dsn: SENTRY_DSN,\n      environment: SENTRY_ENV,\n      release: `regen-renderer@${RELEASE}`,\n      enableUnresponsive: false,\n      tracesSampleRate: Number.isFinite(SENTRY_SAMPLE_RATE) ? SENTRY_SAMPLE_RATE : 0,\n      beforeSend(event) {\n        if (event?.request?.url) {\n          try {\n            const url = new URL(event.request.url);\n            event.request.url = `${url.protocol}//${url.hostname}`;\n          } catch {\n            delete event.request.url;\n          }\n        }\n        if (event?.user) {\n          delete event.user;\n        }\n        return event;\n      },\n    });\n\n    // Make Sentry available globally for ErrorBoundary\n    if (typeof window !== 'undefined') {\n      (window as any).Sentry = rendererSentry;\n    }\n\n    sentryInitialized = true;\n    console.info('[Sentry] Renderer crash reporting enabled');\n  } catch (error) {\n    console.warn('[Sentry] Failed to initialize renderer', error);\n  }\n}\n\nasync function shutdownRendererSentry() {\n  if (!rendererSentry || !sentryInitialized) return;\n  try {\n    if (rendererSentry.close && typeof rendererSentry.close === 'function') {\n      await rendererSentry.close(2000);\n    }\n  } catch (error) {\n    console.warn('[Sentry] Failed to shutdown renderer SDK', error);\n  }\n  sentryInitialized = false;\n}\n\nexport async function applyTelemetryOptIn(optIn: boolean) {\n  await ipc.telemetry.setOptIn(optIn);\n  if (!isElectronRuntime()) return;\n\n  if (optIn) {\n    await initRendererSentry();\n  } else {\n    await shutdownRendererSentry();\n  }\n}\n\nexport async function syncRendererTelemetry() {\n  // Skip backend checks in web mode\n  const isWebMode = !isElectronRuntime() && !isTauriRuntime();\n\n  if (isWebMode) {\n    // In web mode, initialize Sentry directly if DSN is available and valid\n    if (SENTRY_DSN && isValidSentryDSN(SENTRY_DSN)) {\n      await initRendererSentry();\n    }\n    return;\n  }\n\n  // Initialize Sentry for both Electron and Tauri\n  try {\n    const status = await ipc.telemetry.getStatus();\n    if (status.optIn) {\n      await initRendererSentry();\n    } else {\n      await shutdownRendererSentry();\n    }\n  } catch {\n    // If IPC fails (e.g., in web mode), still try to initialize if DSN is available and valid\n    if (SENTRY_DSN && isValidSentryDSN(SENTRY_DSN)) {\n      console.warn('[Sentry] IPC unavailable, initializing with DSN only');\n      await initRendererSentry();\n    }\n  }\n}\n","// @ts-nocheck\r\n/**\r\n * Renderer helper for privacy-friendly analytics.\r\n */\r\n\r\nimport { ipc } from '../ipc-typed';\r\nimport { isElectronRuntime } from '../env';\r\n\r\nlet analyticsEnabled = false;\r\n\r\nexport async function applyAnalyticsOptIn(optIn: boolean) {\r\n  await ipc.analytics.setOptIn(optIn);\r\n  analyticsEnabled = optIn;\r\n}\r\n\r\nexport async function syncAnalyticsOptIn() {\r\n  if (!isElectronRuntime()) return;\r\n  const status = await ipc.analytics.getStatus();\r\n  analyticsEnabled = status.enabled && status.optIn;\r\n}\r\n\r\nexport function trackAnalyticsEvent(type: string, payload?: Record<string, unknown>) {\r\n  if (!analyticsEnabled) return;\r\n  void ipc.analytics.track(type, payload);\r\n}\r\n\r\nexport function trackPageView(path: string) {\r\n  trackAnalyticsEvent('page_view', {\r\n    path,\r\n    title: document.title,\r\n  });\r\n}\r\n\r\n\r\n","import { create } from 'zustand';\n\ntype ThemePreference = 'system' | 'light' | 'dark';\ntype ResolvedTheme = 'light' | 'dark';\n\ninterface ThemeState {\n  preference: ThemePreference;\n  resolved: ResolvedTheme;\n  setPreference: (preference: ThemePreference) => void;\n  cyclePreference: () => void;\n}\n\nconst STORAGE_KEY = 'regen:theme-preference';\nconst isBrowser = typeof window !== 'undefined';\n\nconst getSystemTheme = (): ResolvedTheme => {\n  if (!isBrowser || typeof window.matchMedia !== 'function') {\n    return 'dark';\n  }\n  return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n};\n\nconst applyTheme = (preference: ThemePreference) => {\n  if (typeof document === 'undefined') return;\n  const resolved = preference === 'system' ? getSystemTheme() : preference;\n  document.documentElement.dataset.theme = resolved;\n  document.documentElement.setAttribute('data-theme-resolved', resolved);\n};\n\nconst initialPreference: ThemePreference = (() => {\n  if (!isBrowser) return 'system';\n  const stored = window.localStorage.getItem(STORAGE_KEY);\n  if (stored === 'light' || stored === 'dark' || stored === 'system') {\n    return stored;\n  }\n  return 'system';\n})();\n\nconst initialResolved: ResolvedTheme =\n  initialPreference === 'system' ? getSystemTheme() : initialPreference;\nif (typeof document !== 'undefined') {\n  applyTheme(initialPreference);\n}\n\nexport const useThemeStore = create<ThemeState>((set, get) => ({\n  preference: initialPreference,\n  resolved: initialResolved,\n  setPreference: preference => {\n    if (isBrowser) {\n      window.localStorage.setItem(STORAGE_KEY, preference);\n    }\n    applyTheme(preference);\n    const resolved = preference === 'system' ? getSystemTheme() : preference;\n    set({ preference, resolved });\n  },\n  cyclePreference: () => {\n    const order: ThemePreference[] = ['system', 'light', 'dark'];\n    const current = get().preference;\n    const next = order[(order.indexOf(current) + 1) % order.length];\n    get().setPreference(next);\n  },\n}));\n\nif (isBrowser && typeof window.matchMedia === 'function') {\n  const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n  const handleChange = () => {\n    const { preference } = useThemeStore.getState();\n    if (preference === 'system') {\n      applyTheme('system');\n      const resolved = getSystemTheme();\n      useThemeStore.setState({ resolved });\n    }\n  };\n  try {\n    mediaQuery.addEventListener('change', handleChange);\n  } catch {\n    // Safari < 14 fallback\n    mediaQuery.addListener(handleChange);\n  }\n}\n","import { ReactNode, useCallback, useLayoutEffect } from 'react';\n\nimport { useThemeStore } from '../state/themeStore';\n\nexport function ThemeProvider({ children }: { children: ReactNode }) {\n  const resolved = useThemeStore(state => state.resolved);\n\n  const syncLayoutPadding = useCallback(() => {\n    if (typeof document === 'undefined') return;\n    const width = window.innerWidth;\n    let padding = '1rem';\n    if (width >= 1440) {\n      padding = '2.25rem';\n    } else if (width >= 1024) {\n      padding = '1.75rem';\n    } else if (width >= 640) {\n      padding = '1.25rem';\n    }\n    document.documentElement.style.setProperty('--layout-page-padding', padding);\n  }, []);\n\n  useLayoutEffect(() => {\n    syncLayoutPadding();\n    window.addEventListener('resize', syncLayoutPadding);\n    return () => window.removeEventListener('resize', syncLayoutPadding);\n  }, [syncLayoutPadding]);\n\n  useLayoutEffect(() => {\n    document.documentElement.setAttribute('data-theme', resolved);\n  }, [resolved]);\n\n  return <>{children}</>;\n}\n\nexport function useTheme() {\n  const preference = useThemeStore(state => state.preference);\n  const resolved = useThemeStore(state => state.resolved);\n  const setPreference = useThemeStore(state => state.setPreference);\n  const cyclePreference = useThemeStore(state => state.cyclePreference);\n\n  return {\n    preference,\n    resolved,\n    setPreference,\n    cyclePreference,\n  };\n}\n","/**\n * Central security directives shared across renderer surfaces.\n */\n\n// Completely open CSP - no restrictions, allows all websites to load\n// User requested: \"don't restrict any website, explore every website\"\n// Note: frame-ancestors is only valid in HTTP headers, not meta tags\n// Note: navigate-to is not a valid CSP directive\nexport const CSP_DIRECTIVE = [\n  \"default-src * 'unsafe-inline' 'unsafe-eval' 'unsafe-hashes' data: blob: javascript:;\",\n  'base-uri *;',\n  'img-src * data: blob:;',\n  'font-src * data:;',\n  \"style-src * 'unsafe-inline' 'unsafe-hashes';\",\n  \"script-src * 'unsafe-inline' 'unsafe-eval' 'unsafe-hashes' javascript:;\",\n  'connect-src * wss: ws:;',\n  'frame-src *;',\n  'media-src * data: blob:;',\n  'object-src *;',\n  'form-action * javascript:;',\n  'worker-src * blob:;',\n  'manifest-src *;',\n].join(' ');\n\n// Completely open iframe sandbox - no restrictions, allows all websites to work\n// User requested: \"explore every website\"\n// Note: allow-storage-access is not a valid sandbox flag (use allow-storage-access-by-user-activation only)\nexport const SAFE_IFRAME_SANDBOX =\n  'allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-pointer-lock allow-top-navigation allow-top-navigation-by-user-activation allow-downloads allow-modals allow-presentation allow-orientation-lock allow-pointer-lock allow-storage-access-by-user-activation';\n\nexport const TRUSTED_EXTENSION_URLS = [\n  'regen://extensions',\n  'https://extensions.regen.dev',\n  'https://cdn.regen.dev/extensions',\n];\n","/**\n * Suppress Browser-Native Console Warnings\n *\n * Filters out expected browser security warnings that we can't control:\n * - Tracking Prevention warnings\n * - CSP violations from third-party sites (e.g., Bing's CSP)\n * - Iframe sandbox warnings (informational)\n * - Network errors from third-party sites (e.g., Bing 403 errors)\n *\n * Note: Browser-native warnings logged directly by the browser (e.g., \"Tracking Prevention\")\n * or from inside cross-origin iframes cannot be fully suppressed due to security restrictions.\n * This utility suppresses what we can intercept from our own code.\n */\n\n// Patterns for warnings to suppress - COMPREHENSIVE list\n// User requested: no restrictions, suppress all warnings\nconst SUPPRESSED_PATTERNS = [\n  // Tracking Prevention warnings (browser-native) - ALL variations\n  /Tracking Prevention blocked/i,\n  /blocked access to storage/i,\n  /Tracking Prevention/i,\n  /Tracking Prevention blocked access to storage for/i,\n  /Tracking Prevention blocked access to storage for <URL>/i,\n\n  // CSP violations (from third-party sites like Bing)\n  /violates the following Content Security Policy directive/i,\n  /Content Security Policy directive/i,\n  /was blocked due to Content Security Policy/i,\n  /javascript:.*violates.*Content Security Policy/i,\n  /Running the JavaScript URL violates/i,\n  /Content Security Policy directive 'script-src'/i,\n  /CSP directive/i,\n  /script-src.*strict-dynamic/i,\n  /Content Security Policy blocks inline execution/i,\n  /blocks inline execution of scripts and stylesheets/i,\n  /Either the 'unsafe-inline' keyword/i,\n  /a hash \\('sha256-\\.\\.\\.'\\)/i,\n  /or a nonce \\('nonce-\\.\\.\\.'\\) is required/i,\n  /'unsafe-hashes' keyword is present/i,\n  /was blocked due to CSP/i,\n\n  // CSP meta tag warnings (expected - some directives only work in HTTP headers)\n  /frame-ancestors.*ignored.*meta element/i,\n  /The Content Security Policy directive 'frame-ancestors' is ignored when delivered via a <meta> element/i,\n  /Unrecognized Content-Security-Policy directive/i,\n  /navigate-to.*is an invalid/i,\n\n  // Iframe sandbox warnings (informational) - ALL variations including partial/truncated\n  /An iframe which has both allow-scripts and allow-same-origin for its sandbox attribute can escape its sandboxing/i,\n  /An iframe which has both allow-scripts and allow-same-origin/i,\n  /iframe which has both allow-scripts and allow-same-origin/i,\n  /iframe.*has.*both.*allow-scripts.*allow-same-origin/i,\n  /allow-scripts.*allow-same-origin.*sandbox/i,\n  /sandbox.*allow-scripts.*allow-same-origin/i,\n  /iframe.*sandbox.*escape/i,\n  /sandbox.*can escape/i,\n  /can escape.*sandboxing/i,\n  /escape.*sandboxing/i,\n  /sandbox.*escape/i,\n  // Catch partial/truncated messages\n  /iframe.*allow-scripts.*allow-same-origin/i,\n  /allow-scripts.*allow-same-origin/i,\n  /Error while parsing the 'sandbox' attribute/i,\n  /allow-storage-access.*is an invalid sandbox flag/i,\n\n  // Network errors from third-party sites (expected - Bing anti-bot, etc.)\n  /403.*Forbidden/i,\n  /GET.*bing.*403/i,\n  /POST.*bing.*403/i,\n  /\\.bing\\.com.*403/i,\n  /Forbidden.*bing/i,\n  /bing\\.com.*403/i,\n  /Failed to load resource.*403/i,\n  /the server responded with a status of 403/i,\n  /the server responded with a status of 404/i,\n\n  // Origin header errors (expected in some contexts)\n  /missing Origin header/i,\n  /Uncaught.*missing Origin header/i,\n  /Uncaught \\(in promise\\) missing Origin header/i,\n\n  // MeiliSearch errors (optional service)\n  /401.*Unauthorized.*meili/i,\n  /MeiliSearch.*Error/i,\n  /\\[MeiliSearch\\].*Error/i,\n  /\\[MeiliIndexer\\].*Failed/i,\n  /missing_authorization_header/i,\n  /Authorization header is missing/i,\n  /GET.*\\/indexes.*401/i,\n  /POST.*\\/indexes.*401/i,\n  /MeiliSearch.*401/i,\n\n  // Tab errors\n  /Tab not found.*local-/i,\n  /Tab not found.*system-/i,\n  /\\[TABS\\].*Tab not found/i,\n\n  // Form field warnings (accessibility)\n  /form field element should have an id or name attribute/i,\n  /form field.*id or name/i,\n  /A form field element should have an id or name attribute/i,\n\n  // Quirks Mode warnings\n  /Quirks Mode/i,\n  /Page layout may be unexpected due to Quirks Mode/i,\n  /unexpected due to Quirks Mode/i,\n];\n\nlet originalWarn: typeof console.warn;\nlet originalError: typeof console.error;\nlet originalLog: typeof console.log;\nlet isSuppressing = false;\n\n/**\n * Check if a message should be suppressed\n * Handles multiple formats: strings, objects, arrays, etc.\n */\nfunction shouldSuppress(message: any): boolean {\n  if (!message) return false;\n\n  // Convert message to string - handle all possible formats\n  let messageStr = '';\n  if (typeof message === 'string') {\n    messageStr = message;\n  } else if (message?.message) {\n    messageStr = String(message.message);\n  } else if (message?.error) {\n    messageStr = String(message.error);\n  } else if (Array.isArray(message)) {\n    messageStr = message.map(m => String(m)).join(' ');\n  } else if (typeof message === 'object') {\n    messageStr = JSON.stringify(message);\n  } else {\n    messageStr = String(message);\n  }\n\n  // Check against all suppression patterns\n  return SUPPRESSED_PATTERNS.some(pattern => {\n    try {\n      return pattern.test(messageStr);\n    } catch {\n      return false;\n    }\n  });\n}\n\n/**\n * Initialize console warning suppression\n * Should be called early in the application lifecycle\n *\n * Note: This only suppresses warnings we can intercept. Browser-native warnings\n * (like \"Tracking Prevention\") are logged directly by the browser and cannot\n * be fully suppressed.\n */\nexport function suppressBrowserWarnings(): void {\n  if (isSuppressing) return;\n  isSuppressing = true;\n\n  // Suppress console.warn - catch all message formats and check each argument\n  originalWarn = console.warn;\n  console.warn = (...args: any[]) => {\n    // Check if any argument matches suppression patterns\n    const shouldBlock = args.some(arg => shouldSuppress(arg)) || shouldSuppress(args.join(' '));\n    if (shouldBlock) {\n      // Suppress this warning silently\n      return;\n    }\n    // Allow other warnings through\n    originalWarn.apply(console, args);\n  };\n\n  // Suppress console.error for CSP violations\n  originalError = console.error;\n  console.error = (...args: any[]) => {\n    // Check if any argument matches suppression patterns\n    const shouldBlock = args.some(arg => shouldSuppress(arg)) || shouldSuppress(args.join(' '));\n    if (shouldBlock) {\n      // Suppress this error silently\n      return;\n    }\n    // Allow other errors through\n    originalError.apply(console, args);\n  };\n\n  // Also intercept console.log in case warnings are logged there\n  originalLog = console.log;\n  console.log = (...args: any[]) => {\n    // Check if any argument matches suppression patterns\n    const shouldBlock = args.some(arg => shouldSuppress(arg)) || shouldSuppress(args.join(' '));\n    if (shouldBlock) {\n      // Suppress this log silently\n      return;\n    }\n    // Allow other logs through\n    originalLog.apply(console, args);\n  };\n\n  // Intercept uncaught errors that might be CSP violations\n  const errorListener = (event: ErrorEvent) => {\n    const message = event.message || event.filename || '';\n    const errorString = `${message} ${event.filename || ''} ${event.lineno || ''}`;\n    if (shouldSuppress(errorString) || shouldSuppress(message)) {\n      event.preventDefault();\n      event.stopPropagation();\n      event.stopImmediatePropagation();\n      // Don't log this error\n      return false;\n    }\n    return true;\n  };\n\n  window.addEventListener('error', errorListener, true);\n\n  // Also listen for console messages at a lower level (for browser-native warnings)\n  const originalConsoleWarn = console.warn;\n  const originalConsoleError = console.error;\n\n  // Create a proxy for console that filters messages before they're logged\n  // This catches messages that might bypass our direct overrides\n  const _consoleProxy = new Proxy(console, {\n    get(target, prop) {\n      if (prop === 'warn') {\n        return function (...args: any[]) {\n          if (!args.some(arg => shouldSuppress(arg)) && !shouldSuppress(args.join(' '))) {\n            originalConsoleWarn.apply(target, args);\n          }\n        };\n      }\n      if (prop === 'error') {\n        return function (...args: any[]) {\n          if (!args.some(arg => shouldSuppress(arg)) && !shouldSuppress(args.join(' '))) {\n            originalConsoleError.apply(target, args);\n          }\n        };\n      }\n      return target[prop as keyof typeof target];\n    },\n  });\n\n  // Note: We can't replace the global console, but our overrides above should catch most cases\n\n  // Intercept unhandled promise rejections\n  const rejectionListener = (event: PromiseRejectionEvent) => {\n    const reason = event.reason?.message || String(event.reason || '');\n    if (shouldSuppress(reason)) {\n      event.preventDefault();\n      return;\n    }\n  };\n\n  window.addEventListener('unhandledrejection', rejectionListener);\n\n  // Note: Warnings from inside cross-origin iframes (like Bing) cannot be fully suppressed\n  // due to browser security restrictions. The browser logs these warnings directly from\n  // within the iframe's security context, which we cannot access.\n}\n\n/**\n * Restore original console methods\n */\nexport function restoreConsoleWarnings(): void {\n  if (!isSuppressing) return;\n\n  if (originalWarn) {\n    console.warn = originalWarn;\n  }\n  if (originalError) {\n    console.error = originalError;\n  }\n\n  isSuppressing = false;\n}\n\n/**\n * Suppress warnings for specific iframe errors\n */\nexport function suppressIframeErrors(iframe: HTMLIFrameElement): () => void {\n  const errorHandler = (event: ErrorEvent) => {\n    const message = event.message || '';\n    if (shouldSuppress(message)) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  };\n\n  const warnHandler = () => {\n    // Attempt to suppress warnings from iframe content\n    try {\n      const iframeWindow = iframe.contentWindow as Window & { console?: Console };\n      if (iframeWindow) {\n        const originalWarn = iframeWindow.console?.warn;\n        if (originalWarn && iframeWindow.console) {\n          iframeWindow.console.warn = (...args: any[]) => {\n            const message = args[0];\n            if (typeof message === 'string' && !shouldSuppress(message)) {\n              originalWarn.apply(iframeWindow.console, args);\n            }\n          };\n        }\n      }\n    } catch {\n      // Cross-origin restrictions - can't access iframe console\n    }\n  };\n\n  window.addEventListener('error', errorHandler);\n  // Try to suppress iframe console warnings (may not work due to cross-origin)\n  warnHandler();\n\n  return () => {\n    window.removeEventListener('error', errorHandler);\n  };\n}\n","/**\r\n * Performance Mode Utilities\r\n * Applies performance optimizations when performance boost is enabled\r\n */\r\n\r\n/**\r\n * Apply performance mode optimizations to the document\r\n */\r\nexport function applyPerformanceMode(enabled: boolean): void {\r\n  const html = document.documentElement;\r\n\r\n  if (enabled) {\r\n    html.setAttribute('data-performance-mode', 'true');\r\n\r\n    // Disable animations and transitions\r\n    const style = document.createElement('style');\r\n    style.id = 'performance-mode-styles';\r\n    style.textContent = `\r\n      [data-performance-mode=\"true\"] *,\r\n      [data-performance-mode=\"true\"] *::before,\r\n      [data-performance-mode=\"true\"] *::after {\r\n        animation-duration: 0.01ms !important;\r\n        animation-delay: 0.01ms !important;\r\n        transition-duration: 0.01ms !important;\r\n        transition-delay: 0.01ms !important;\r\n        scroll-behavior: auto !important;\r\n      }\r\n      \r\n      [data-performance-mode=\"true\"] iframe {\r\n        will-change: auto !important;\r\n      }\r\n    `;\r\n    document.head.appendChild(style);\r\n\r\n    // Enable aggressive caching hints\r\n    if ('serviceWorker' in navigator) {\r\n      // Service worker caching would be handled separately\r\n      console.log('[PerformanceMode] Performance optimizations enabled');\r\n    }\r\n  } else {\r\n    html.removeAttribute('data-performance-mode');\r\n\r\n    // Remove performance mode styles\r\n    const existingStyle = document.getElementById('performance-mode-styles');\r\n    if (existingStyle) {\r\n      existingStyle.remove();\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize performance mode from settings\r\n */\r\nexport function initPerformanceMode(): void {\r\n  // This will be called on app startup to sync with settings\r\n  // The actual state is managed by the settings store\r\n}\r\n","/**\n * SettingsSync Component\n * Syncs settings between settingsStore and other stores (theme, performance, privacy)\n */\n\nimport { useEffect } from 'react';\nimport { useSettingsStore } from '../state/settingsStore';\nimport { useThemeStore } from '../state/themeStore';\nimport { applyPerformanceMode } from '../utils/performanceMode';\n\nexport function SettingsSync() {\n  const settings = useSettingsStore();\n  const themePreference = useThemeStore(state => state.preference);\n  const setThemePreference = useThemeStore(state => state.setPreference);\n\n  // Sync theme from settingsStore to themeStore\n  useEffect(() => {\n    const theme = settings.appearance.theme;\n    if (theme === 'system' || theme === 'light' || theme === 'dark') {\n      if (themePreference !== theme) {\n        setThemePreference(theme);\n      }\n    }\n  }, [settings.appearance.theme, themePreference, setThemePreference]);\n\n  // Initialize and sync performance mode\n  useEffect(() => {\n    const performanceMode = settings.appearance.compactUI;\n    applyPerformanceMode(performanceMode);\n  }, [settings.appearance.compactUI]);\n\n  // This component doesn't render anything\n  return null;\n}\n","/**\r\n * User-Friendly Error Messages\r\n * Converts technical errors into user-friendly messages\r\n */\r\n\r\nexport function getUserFriendlyError(error: unknown): string {\r\n  if (error instanceof Error) {\r\n    const message = error.message.toLowerCase();\r\n\r\n    // Network errors\r\n    if (message.includes('network') || message.includes('fetch') || message.includes('connection')) {\r\n      return 'Connection failed. Please check your internet connection and try again.';\r\n    }\r\n\r\n    if (message.includes('timeout')) {\r\n      return 'Request timed out. The server may be slow or unavailable. Please try again.';\r\n    }\r\n\r\n    // Storage errors\r\n    if (message.includes('quota') || message.includes('storage')) {\r\n      return 'Storage is full. Please free up some space and try again.';\r\n    }\r\n\r\n    // Permission errors\r\n    if (message.includes('permission') || message.includes('denied')) {\r\n      return 'Permission denied. Please check your browser settings.';\r\n    }\r\n\r\n    // Search errors\r\n    if (message.includes('search') || message.includes('meilisearch')) {\r\n      return 'Search is temporarily unavailable. Using local search instead.';\r\n    }\r\n\r\n    // Agent errors\r\n    if (message.includes('agent') || message.includes('automation')) {\r\n      return 'Automation failed. Please check your automation script and try again.';\r\n    }\r\n\r\n    // Generic fallback\r\n    return `Something went wrong: ${error.message}. Please try again or contact support if the problem persists.`;\r\n  }\r\n\r\n  if (typeof error === 'string') {\r\n    return error;\r\n  }\r\n\r\n  return 'An unexpected error occurred. Please try again.';\r\n}\r\n\r\n/**\r\n * Get error category for better handling\r\n */\r\nexport function getErrorCategory(error: unknown): 'network' | 'storage' | 'permission' | 'search' | 'agent' | 'unknown' {\r\n  if (error instanceof Error) {\r\n    const message = error.message.toLowerCase();\r\n\r\n    if (message.includes('network') || message.includes('fetch') || message.includes('connection') || message.includes('timeout')) {\r\n      return 'network';\r\n    }\r\n\r\n    if (message.includes('quota') || message.includes('storage')) {\r\n      return 'storage';\r\n    }\r\n\r\n    if (message.includes('permission') || message.includes('denied')) {\r\n      return 'permission';\r\n    }\r\n\r\n    if (message.includes('search') || message.includes('meilisearch')) {\r\n      return 'search';\r\n    }\r\n\r\n    if (message.includes('agent') || message.includes('automation')) {\r\n      return 'agent';\r\n    }\r\n  }\r\n\r\n  return 'unknown';\r\n}\r\n\r\n","/**\r\n * Error Recovery - Auto-restart and graceful degradation\r\n */\r\n\r\nimport { toast } from '../utils/toast';\r\n\r\nlet crashCount = 0;\r\nconst MAX_CRASHES = 3;\r\nconst CRASH_WINDOW_MS = 60000; // 1 minute\r\nconst crashHistory: number[] = [];\r\n\r\n/**\r\n * Record a crash and attempt recovery\r\n */\r\nexport function recordCrash(error: Error, context?: Record<string, any>): void {\r\n  const now = Date.now();\r\n  crashHistory.push(now);\r\n\r\n  // Remove crashes older than window\r\n  while (crashHistory.length > 0 && now - crashHistory[0] > CRASH_WINDOW_MS) {\r\n    crashHistory.shift();\r\n  }\r\n\r\n  crashCount = crashHistory.length;\r\n\r\n  console.error('[ErrorRecovery] Crash recorded:', error, context);\r\n\r\n  // If too many crashes, show warning\r\n  if (crashCount >= MAX_CRASHES) {\r\n    toast.error(\r\n      `Multiple crashes detected. The app may be unstable. Consider restarting.`,\r\n      { duration: 10000 }\r\n    );\r\n  }\r\n\r\n  // Attempt auto-recovery\r\n  attemptRecovery(error, context);\r\n}\r\n\r\n/**\r\n * Attempt to recover from crash\r\n */\r\nfunction attemptRecovery(error: Error, _context?: Record<string, any>): void {\r\n  // Clear caches\r\n  try {\r\n    if (typeof window !== 'undefined' && window.caches) {\r\n      caches.keys().then(keys => {\r\n        keys.forEach(key => caches.delete(key));\r\n      });\r\n    }\r\n  } catch {\r\n    // Cache cleanup failed\r\n  }\r\n\r\n  // Clear localStorage if corrupted\r\n  if (error.message.includes('QuotaExceeded') || error.message.includes('storage')) {\r\n    try {\r\n      localStorage.clear();\r\n      console.log('[ErrorRecovery] Cleared localStorage due to storage error');\r\n    } catch {\r\n      // Clear failed\r\n    }\r\n  }\r\n\r\n  // Reload if critical error\r\n  if (error.message.includes('ChunkLoadError') || error.message.includes('Loading chunk')) {\r\n    setTimeout(() => {\r\n      if (confirm('A critical error occurred. Reload the app?')) {\r\n        window.location.reload();\r\n      }\r\n    }, 1000);\r\n  }\r\n}\r\n\r\n/**\r\n * Get crash count\r\n */\r\nexport function getCrashCount(): number {\r\n  return crashCount;\r\n}\r\n\r\n/**\r\n * Reset crash count\r\n */\r\nexport function resetCrashCount(): void {\r\n  crashCount = 0;\r\n  crashHistory.length = 0;\r\n}\r\n\r\n","/**\r\n * Telemetry Metrics - Track performance, feature usage, and errors\r\n */\r\n\r\nimport { ipc } from '../lib/ipc-typed';\r\n\r\nexport interface PerformanceMetric {\r\n  name: string;\r\n  value: number;\r\n  unit: string;\r\n  timestamp: number;\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\nexport interface FeatureUsage {\r\n  feature: string;\r\n  count: number;\r\n  lastUsed: number;\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\nexport interface ErrorMetric {\r\n  error: string;\r\n  count: number;\r\n  firstSeen: number;\r\n  lastSeen: number;\r\n  context?: Record<string, any>;\r\n}\r\n\r\nclass TelemetryMetrics {\r\n  private performanceMetrics: PerformanceMetric[] = [];\r\n  private featureUsage: Map<string, FeatureUsage> = new Map();\r\n  private errorMetrics: Map<string, ErrorMetric> = new Map();\r\n  private userFlows: Array<{ flow: string; startTime: number; endTime?: number }> = [];\r\n\r\n  /**\r\n   * Track performance metric\r\n   */\r\n  trackPerformance(name: string, value: number, unit: string = 'ms', metadata?: Record<string, any>): void {\r\n    const metric: PerformanceMetric = {\r\n      name,\r\n      value,\r\n      unit,\r\n      timestamp: Date.now(),\r\n      metadata,\r\n    };\r\n\r\n    this.performanceMetrics.push(metric);\r\n\r\n    // Keep only last 100 metrics\r\n    if (this.performanceMetrics.length > 100) {\r\n      this.performanceMetrics.shift();\r\n    }\r\n\r\n    // Send to backend if available\r\n    try {\r\n      ipc.telemetry?.trackPerf?.(name, Math.round(value));\r\n    } catch {\r\n      // IPC not available\r\n    }\r\n\r\n    console.log(`[Telemetry] ${name}: ${value}${unit}`);\r\n  }\r\n\r\n  /**\r\n   * Track feature usage\r\n   */\r\n  trackFeature(feature: string, metadata?: Record<string, any>): void {\r\n    const existing = this.featureUsage.get(feature);\r\n    const usage: FeatureUsage = {\r\n      feature,\r\n      count: (existing?.count || 0) + 1,\r\n      lastUsed: Date.now(),\r\n      metadata,\r\n    };\r\n\r\n    this.featureUsage.set(feature, usage);\r\n\r\n    // Send to analytics\r\n    try {\r\n      import('../lib/monitoring/analytics-client').then((module) => {\r\n        if (module.trackAnalyticsEvent) {\r\n          module.trackAnalyticsEvent('feature_used', { feature, ...metadata });\r\n        }\r\n      });\r\n    } catch {\r\n      // Analytics not available\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Track error\r\n   */\r\n  trackError(error: string, context?: Record<string, any>): void {\r\n    const existing = this.errorMetrics.get(error);\r\n    const errorMetric: ErrorMetric = {\r\n      error,\r\n      count: (existing?.count || 0) + 1,\r\n      firstSeen: existing?.firstSeen || Date.now(),\r\n      lastSeen: Date.now(),\r\n      context,\r\n    };\r\n\r\n    this.errorMetrics.set(error, errorMetric);\r\n\r\n    // Send to Sentry if available\r\n    if (typeof window !== 'undefined' && (window as any).Sentry) {\r\n      (window as any).Sentry.captureException(new Error(error), {\r\n        contexts: { custom: context },\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Track user flow\r\n   */\r\n  startFlow(flow: string): string {\r\n    const flowId = `flow-${Date.now()}-${Math.random().toString(36).slice(2)}`;\r\n    this.userFlows.push({\r\n      flow,\r\n      startTime: Date.now(),\r\n    });\r\n    return flowId;\r\n  }\r\n\r\n  endFlow(flowId: string): void {\r\n    const flow = this.userFlows.find(f => f.flow === flowId);\r\n    if (flow) {\r\n      flow.endTime = Date.now();\r\n      const duration = flow.endTime - flow.startTime;\r\n      this.trackPerformance(`flow_${flow.flow}`, duration, 'ms');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get metrics summary\r\n   */\r\n  getSummary(): {\r\n    performance: PerformanceMetric[];\r\n    features: FeatureUsage[];\r\n    errors: ErrorMetric[];\r\n    flows: Array<{ flow: string; duration: number }>;\r\n  } {\r\n    return {\r\n      performance: [...this.performanceMetrics],\r\n      features: Array.from(this.featureUsage.values()),\r\n      errors: Array.from(this.errorMetrics.values()),\r\n      flows: this.userFlows\r\n        .filter(f => f.endTime)\r\n        .map(f => ({\r\n          flow: f.flow,\r\n          duration: (f.endTime || 0) - f.startTime,\r\n        })),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Clear all metrics\r\n   */\r\n  clear(): void {\r\n    this.performanceMetrics = [];\r\n    this.featureUsage.clear();\r\n    this.errorMetrics.clear();\r\n    this.userFlows = [];\r\n  }\r\n}\r\n\r\nexport const telemetryMetrics = new TelemetryMetrics();\r\n\r\n","/**\r\n * Enhanced Error Boundary - Tier 2\r\n * Global error boundary with retry logic, toast reporting, and structured logging\r\n */\r\n\r\nimport React, { Component, ErrorInfo, ReactNode } from 'react';\r\nimport { AlertTriangle, RefreshCw, Copy, CheckCircle2 } from 'lucide-react';\r\nimport { toast } from '../../utils/toast';\r\nimport { log } from '../../utils/logger';\r\nimport { getUserFriendlyError } from '../../utils/userFriendlyErrors';\r\nimport { recordCrash } from '../../services/errorRecovery';\r\nimport { telemetryMetrics } from '../../services/telemetryMetrics';\r\n\r\nexport interface ErrorBoundaryProps {\r\n  children: ReactNode;\r\n  fallback?: ReactNode;\r\n  componentName?: string;\r\n  onError?: (error: Error, errorInfo: ErrorInfo) => void;\r\n  retryable?: boolean;\r\n  level?: 'component' | 'page' | 'global';\r\n}\r\n\r\ninterface ErrorBoundaryState {\r\n  hasError: boolean;\r\n  error: Error | null;\r\n  errorInfo: ErrorInfo | null;\r\n  retryCount: number;\r\n  copyStatus: 'idle' | 'success' | 'error';\r\n}\r\n\r\nconst MAX_RETRIES = 3;\r\n\r\nexport class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {\r\n  private retryTimeoutId: ReturnType<typeof setTimeout> | null = null;\r\n\r\n  constructor(props: ErrorBoundaryProps) {\r\n    super(props);\r\n    this.state = {\r\n      hasError: false,\r\n      error: null,\r\n      errorInfo: null,\r\n      retryCount: 0,\r\n      copyStatus: 'idle',\r\n    };\r\n  }\r\n\r\n  static getDerivedStateFromError(error: Error): Partial<ErrorBoundaryState> {\r\n    return {\r\n      hasError: true,\r\n      error,\r\n    };\r\n  }\r\n\r\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\r\n    const { componentName, level = 'component', onError } = this.props;\r\n\r\n    // Structured logging\r\n    log.error(\r\n      `ErrorBoundary [${level}]${componentName ? ` in ${componentName}` : ''}:`,\r\n      error.message,\r\n      errorInfo.componentStack\r\n    );\r\n\r\n    // STABILITY FIX: Record crash and attempt recovery\r\n    recordCrash(error, { componentName, level, componentStack: errorInfo.componentStack });\r\n\r\n    // TELEMETRY FIX: Track error\r\n    telemetryMetrics.trackError(error.message, { componentName, level });\r\n\r\n    // Store error info\r\n    this.setState({\r\n      error,\r\n      errorInfo,\r\n    });\r\n\r\n    // STABILITY FIX: User-friendly error message\r\n    const friendlyMessage = getUserFriendlyError(error);\r\n    toast.error(\r\n      `${componentName || 'Component'} error: ${friendlyMessage}. ${this.props.retryable ? 'Retrying...' : 'Check console for details.'}`\r\n    );\r\n\r\n    // Call custom error handler\r\n    if (onError) {\r\n      onError(error, errorInfo);\r\n    }\r\n\r\n    // Send to error tracking service (Sentry)\r\n    if (typeof window !== 'undefined' && (window as any).Sentry) {\r\n      try {\r\n        (window as any).Sentry.captureException(error, {\r\n          contexts: {\r\n            react: {\r\n              componentStack: errorInfo.componentStack,\r\n            },\r\n          },\r\n          tags: {\r\n            component: componentName || 'unknown',\r\n            level: level || 'component',\r\n          },\r\n        });\r\n      } catch (sentryError) {\r\n        // Silently fail if Sentry is not available\r\n        console.warn('Failed to send error to Sentry:', sentryError);\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleRetry = () => {\r\n    const { retryCount } = this.state;\r\n    const { retryable = true } = this.props;\r\n\r\n    if (!retryable || retryCount >= MAX_RETRIES) {\r\n      toast.warning('Maximum retry attempts reached. Please reload the app.');\r\n      return;\r\n    }\r\n\r\n    log.info(`Retrying after error (attempt ${retryCount + 1}/${MAX_RETRIES})`);\r\n\r\n    this.setState(prev => ({\r\n      hasError: false,\r\n      error: null,\r\n      errorInfo: null,\r\n      retryCount: prev.retryCount + 1,\r\n    }));\r\n\r\n    toast.info(`Retrying... (${retryCount + 1}/${MAX_RETRIES})`);\r\n  };\r\n\r\n  private handleReload = () => {\r\n    window.location.reload();\r\n  };\r\n\r\n  private handleCopyError = async () => {\r\n    const { error, errorInfo } = this.state;\r\n    if (!error) return;\r\n\r\n    const errorReport = `\r\nError Report\r\n============\r\nComponent: ${this.props.componentName || 'Unknown'}\r\nTime: ${new Date().toISOString()}\r\nRetry Count: ${this.state.retryCount}\r\n\r\nError Message:\r\n${error.message}\r\n\r\nStack Trace:\r\n${error.stack || 'No stack trace available'}\r\n\r\nComponent Stack:\r\n${errorInfo?.componentStack || 'No component stack available'}\r\n    `.trim();\r\n\r\n    try {\r\n      await navigator.clipboard.writeText(errorReport);\r\n      this.setState({ copyStatus: 'success' });\r\n      toast.success('Error details copied to clipboard');\r\n      setTimeout(() => this.setState({ copyStatus: 'idle' }), 2000);\r\n    } catch (err) {\r\n      this.setState({ copyStatus: 'error' });\r\n      toast.error('Failed to copy error details');\r\n      log.error('Failed to copy error details', err);\r\n    }\r\n  };\r\n\r\n  componentWillUnmount() {\r\n    if (this.retryTimeoutId) {\r\n      clearTimeout(this.retryTimeoutId);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      const { fallback, componentName, retryable = true } = this.props;\r\n      const { error, retryCount } = this.state;\r\n\r\n      if (fallback) {\r\n        return fallback;\r\n      }\r\n\r\n      const canRetry = retryable && retryCount < MAX_RETRIES;\r\n\r\n      return (\r\n        <div className=\"flex min-h-screen w-full items-center justify-center bg-slate-950 px-6 py-12 text-gray-100\">\r\n          <div className=\"w-full max-w-xl space-y-5 rounded-2xl border border-slate-800 bg-slate-900/70 p-6 shadow-lg\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <div className=\"rounded-full bg-red-500/20 p-2 text-red-200\">\r\n                <AlertTriangle className=\"h-5 w-5\" />\r\n              </div>\r\n              <div className=\"flex-1\">\r\n                <h1 className=\"text-lg font-semibold text-red-200\">\r\n                  Something went wrong{componentName ? ` in ${componentName}` : ''}\r\n                </h1>\r\n                {error && (\r\n                  <p className=\"mt-2 text-sm text-red-100/80 font-mono\">{getUserFriendlyError(error)}</p>\r\n                )}\r\n                <p className=\"mt-2 text-sm text-gray-400\">\r\n                  {canRetry\r\n                    ? 'The app will attempt to recover automatically. You can also retry manually or reload.'\r\n                    : 'Please reload the app to continue. Error details have been logged.'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex flex-wrap gap-3\">\r\n              {canRetry && (\r\n                <button\r\n                  onClick={this.handleRetry}\r\n                  className=\"flex items-center gap-2 rounded-lg border border-blue-500/50 bg-blue-500/10 px-4 py-2 text-sm font-medium text-blue-100 hover:border-blue-500/70 transition-colors\"\r\n                >\r\n                  <RefreshCw size={16} />\r\n                  Retry ({retryCount + 1}/{MAX_RETRIES})\r\n                </button>\r\n              )}\r\n              <button\r\n                onClick={this.handleReload}\r\n                className=\"rounded-lg border border-blue-500/50 bg-blue-500/10 px-4 py-2 text-sm font-medium text-blue-100 hover:border-blue-500/70 transition-colors\"\r\n              >\r\n                Reload App\r\n              </button>\r\n              <button\r\n                onClick={this.handleCopyError}\r\n                className={`flex items-center gap-2 rounded-lg border px-4 py-2 text-sm font-medium transition-colors ${\r\n                  this.state.copyStatus === 'success'\r\n                    ? 'border-emerald-500/50 bg-emerald-500/10 text-emerald-100'\r\n                    : this.state.copyStatus === 'error'\r\n                      ? 'border-red-500/50 bg-red-500/10 text-red-100'\r\n                      : 'border-slate-700/50 bg-slate-800/50 text-gray-300 hover:border-slate-600/50'\r\n                }`}\r\n              >\r\n                {this.state.copyStatus === 'success' ? (\r\n                  <>\r\n                    <CheckCircle2 size={16} />\r\n                    Copied\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Copy size={16} />\r\n                    Copy Error\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n\r\n            {retryCount >= MAX_RETRIES && (\r\n              <div className=\"rounded-lg border border-amber-500/30 bg-amber-500/10 p-3 text-sm text-amber-100\">\r\n                <p className=\"font-medium\">Maximum retries reached</p>\r\n                <p className=\"mt-1 text-xs text-amber-200/80\">\r\n                  Please reload the app. If the error persists, check the console for details.\r\n                </p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\n/**\r\n * Global Error Boundary - Wrap app root\r\n */\r\nexport function GlobalErrorBoundary({ children }: { children: ReactNode }) {\r\n  return (\r\n    <ErrorBoundary level=\"global\" componentName=\"App\" retryable={true}>\r\n      {children}\r\n    </ErrorBoundary>\r\n  );\r\n}\r\n","/**\n * Session Snapshot System - Tier 2\n * Periodic snapshots for crash recovery\n */\n\nimport { useTabsStore } from '../../state/tabsStore';\nimport { useAppStore } from '../../state/appStore';\nimport { useAgentStreamStore } from '../../state/agentStreamStore';\nimport { log } from '../../utils/logger';\nimport type { Tab } from '../../state/tabsStore';\nimport type { StreamStatus, AgentStreamEvent } from '../../state/agentStreamStore';\n\nexport interface SessionSnapshot {\n  tabs: Tab[];\n  activeTabId: string | null;\n  mode: string;\n  agentState?: {\n    runId: string | null;\n    status: StreamStatus;\n    transcript: string;\n    events: AgentStreamEvent[];\n    lastGoal: string | null;\n  };\n  timestamp: number;\n  version: number;\n}\n\nconst SNAPSHOT_KEY = 'regen_snapshot';\nconst SNAPSHOT_VERSION = 2; // Bumped to 2 for agent state support\nconst SNAPSHOT_INTERVAL = 30000; // 30 seconds\n\nlet snapshotInterval: ReturnType<typeof setInterval> | null = null;\n\n/**\n * Create a snapshot of current session state\n */\nexport function createSnapshot(): SessionSnapshot {\n  const tabsStore = useTabsStore.getState();\n  const appStore = useAppStore.getState();\n  const agentStore = useAgentStreamStore.getState();\n\n  return {\n    tabs: tabsStore.tabs,\n    activeTabId: tabsStore.activeId,\n    mode: appStore.mode,\n    agentState: {\n      runId: agentStore.runId,\n      status: agentStore.status,\n      transcript: agentStore.transcript,\n      events: agentStore.events.slice(-100), // Keep last 100 events for recovery\n      lastGoal: agentStore.lastGoal,\n    },\n    timestamp: Date.now(),\n    version: SNAPSHOT_VERSION,\n  };\n}\n\n/**\n * Save snapshot to localStorage\n */\nexport function saveSnapshot(snapshot?: SessionSnapshot): void {\n  try {\n    const snap = snapshot || createSnapshot();\n    localStorage.setItem(SNAPSHOT_KEY, JSON.stringify(snap));\n    log.debug('Session snapshot saved', { tabCount: snap.tabs.length, timestamp: snap.timestamp });\n  } catch (error) {\n    log.error('Failed to save snapshot', error);\n  }\n}\n\n/**\n * Load snapshot from localStorage\n */\nexport function loadSnapshot(): SessionSnapshot | null {\n  try {\n    const raw = localStorage.getItem(SNAPSHOT_KEY);\n    if (!raw) return null;\n\n    const snapshot = JSON.parse(raw) as SessionSnapshot;\n\n    // Validate version - allow version 1 for backward compatibility\n    if (snapshot.version && snapshot.version > SNAPSHOT_VERSION) {\n      log.warn('Snapshot version too new, ignoring');\n      return null;\n    }\n    // Migrate version 1 to version 2\n    if (snapshot.version === 1) {\n      snapshot.agentState = undefined; // Will be populated from persisted store\n    }\n\n    return snapshot;\n  } catch (error) {\n    log.error('Failed to load snapshot', error);\n    return null;\n  }\n}\n\n/**\n * Start periodic snapshotting\n */\nexport function startSnapshotting(): void {\n  if (snapshotInterval) {\n    clearInterval(snapshotInterval);\n  }\n\n  // Initial snapshot\n  saveSnapshot();\n\n  // Periodic snapshots\n  snapshotInterval = setInterval(() => {\n    saveSnapshot();\n  }, SNAPSHOT_INTERVAL);\n\n  log.info('Session snapshotting started', { interval: SNAPSHOT_INTERVAL });\n}\n\n/**\n * Stop periodic snapshotting\n */\nexport function stopSnapshotting(): void {\n  if (snapshotInterval) {\n    clearInterval(snapshotInterval);\n    snapshotInterval = null;\n    log.info('Session snapshotting stopped');\n  }\n}\n\n/**\n * Clear snapshot\n */\nexport function clearSnapshot(): void {\n  localStorage.removeItem(SNAPSHOT_KEY);\n  log.info('Session snapshot cleared');\n}\n","/**\r\n * Quick Start Tour Component\r\n * DAY 9 FIX: 1-minute guided tour for first-time users\r\n * Focuses on Omni AI and key features\r\n */\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { X, Sparkles, Search, TrendingUp, Mic, ArrowRight, CheckCircle2 } from 'lucide-react';\r\nimport { useAppStore } from '../../state/appStore';\r\n\r\ninterface TourStep {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  icon: React.ReactNode;\r\n  action?: () => void;\r\n}\r\n\r\nconst TOUR_STEPS: TourStep[] = [\r\n  {\r\n    id: 'welcome',\r\n    title: 'Welcome to RegenBrowser!',\r\n    description: 'Your AI-powered browser with voice commands, research, and trading. Let\\'s get started!',\r\n    icon: <Sparkles className=\"w-6 h-6\" />,\r\n  },\r\n  {\r\n    id: 'omni-ai',\r\n    title: 'AI Omni Mode',\r\n    description: 'Press Ctrl+Shift+O or click the AI button to access 6 AI modes: Search, Code, Research, Writing, Translate, and Image.',\r\n    icon: <Sparkles className=\"w-6 h-6\" />,\r\n    action: () => {\r\n      // Trigger Omni AI mode\r\n      const event = new KeyboardEvent('keydown', {\r\n        key: 'o',\r\n        ctrlKey: true,\r\n        shiftKey: true,\r\n      });\r\n      window.dispatchEvent(event);\r\n    },\r\n  },\r\n  {\r\n    id: 'research',\r\n    title: 'Research Mode',\r\n    description: 'Switch to Research mode for AI-powered web research with real-time citations and summaries.',\r\n    icon: <Search className=\"w-6 h-6\" />,\r\n    action: () => {\r\n      useAppStore.getState().setMode('Research');\r\n    },\r\n  },\r\n  {\r\n    id: 'voice',\r\n    title: 'Voice Commands',\r\n    description: 'Click the microphone button or press Ctrl+Space to use voice commands in Hindi or English.',\r\n    icon: <Mic className=\"w-6 h-6\" />,\r\n  },\r\n  {\r\n    id: 'trade',\r\n    title: 'Trade Mode',\r\n    description: 'Switch to Trade mode for AI-powered trading signals and real-time market analysis.',\r\n    icon: <TrendingUp className=\"w-6 h-6\" />,\r\n    action: () => {\r\n      useAppStore.getState().setMode('Trade');\r\n    },\r\n  },\r\n  {\r\n    id: 'trade',\r\n    title: 'Trade Mode',\r\n    description: 'Access Trade mode for real-time market data, charts, and AI-powered trading signals.',\r\n    icon: <TrendingUp className=\"w-6 h-6\" />,\r\n    action: () => {\r\n      useAppStore.getState().setMode('Trade');\r\n    },\r\n  },\r\n  {\r\n    id: 'voice',\r\n    title: 'Voice Commands',\r\n    description: 'Press Ctrl+Space to activate WISPR voice assistant. Say \"Hey WISPR, research BTC\" to get started!',\r\n    icon: <Mic className=\"w-6 h-6\" />,\r\n  },\r\n  {\r\n    id: 'complete',\r\n    title: 'You\\'re all set!',\r\n    description: 'Start exploring RegenBrowser. You can always access this tour from Settings.',\r\n    icon: <CheckCircle2 className=\"w-6 h-6\" />,\r\n  },\r\n];\r\n\r\nexport function QuickStartTour() {\r\n  const [currentStep, setCurrentStep] = useState(0);\r\n  const [isVisible, setIsVisible] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // Check if user has seen the tour\r\n    const hasSeenTour = localStorage.getItem('regen:has-seen-tour') === 'true';\r\n    if (!hasSeenTour) {\r\n      // Show tour after a short delay\r\n      setTimeout(() => {\r\n        setIsVisible(true);\r\n      }, 2000);\r\n    }\r\n  }, []);\r\n\r\n  const handleNext = () => {\r\n    if (currentStep < TOUR_STEPS.length - 1) {\r\n      // Execute action if available\r\n      const step = TOUR_STEPS[currentStep];\r\n      if (step.action) {\r\n        try {\r\n          step.action();\r\n        } catch (error) {\r\n          console.warn('[Tour] Action failed:', error);\r\n        }\r\n      }\r\n      setCurrentStep(currentStep + 1);\r\n    } else {\r\n      handleComplete();\r\n    }\r\n  };\r\n\r\n  const handleSkip = () => {\r\n    handleComplete();\r\n  };\r\n\r\n  const handleComplete = () => {\r\n    localStorage.setItem('regen:has-seen-tour', 'true');\r\n    setIsVisible(false);\r\n  };\r\n\r\n  if (!isVisible) {\r\n    return null;\r\n  }\r\n\r\n  const step = TOUR_STEPS[currentStep];\r\n  const isLastStep = currentStep === TOUR_STEPS.length - 1;\r\n  const progress = ((currentStep + 1) / TOUR_STEPS.length) * 100;\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isVisible && (\r\n        <motion.div\r\n          initial={{ opacity: 0 }}\r\n          animate={{ opacity: 1 }}\r\n          exit={{ opacity: 0 }}\r\n          className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm\"\r\n          onClick={handleSkip}\r\n        >\r\n          <motion.div\r\n            initial={{ scale: 0.9, opacity: 0 }}\r\n            animate={{ scale: 1, opacity: 1 }}\r\n            exit={{ scale: 0.9, opacity: 0 }}\r\n            onClick={(e) => e.stopPropagation()}\r\n            className=\"relative w-full max-w-md mx-4 bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl overflow-hidden\"\r\n          >\r\n            {/* Progress bar */}\r\n            <div className=\"h-1 bg-slate-800\">\r\n              <motion.div\r\n                className=\"h-full bg-emerald-500\"\r\n                initial={{ width: 0 }}\r\n                animate={{ width: `${progress}%` }}\r\n                transition={{ duration: 0.3 }}\r\n              />\r\n            </div>\r\n\r\n            {/* Content */}\r\n            <div className=\"p-6\">\r\n              <div className=\"flex items-start justify-between mb-4\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"p-2 bg-emerald-500/20 rounded-lg text-emerald-400\">\r\n                    {step.icon}\r\n                  </div>\r\n                  <div>\r\n                    <h3 className=\"text-lg font-semibold text-white\">{step.title}</h3>\r\n                    <p className=\"text-xs text-slate-400\">\r\n                      Step {currentStep + 1} of {TOUR_STEPS.length}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <button\r\n                  onClick={handleSkip}\r\n                  className=\"p-1 text-slate-400 hover:text-white transition-colors\"\r\n                >\r\n                  <X className=\"w-5 h-5\" />\r\n                </button>\r\n              </div>\r\n\r\n              <p className=\"text-slate-300 mb-6 leading-relaxed\">{step.description}</p>\r\n\r\n              {/* Actions */}\r\n              <div className=\"flex items-center justify-between gap-3\">\r\n                <button\r\n                  onClick={handleSkip}\r\n                  className=\"px-4 py-2 text-sm text-slate-400 hover:text-white transition-colors\"\r\n                >\r\n                  Skip Tour\r\n                </button>\r\n                <button\r\n                  onClick={handleNext}\r\n                  className=\"flex items-center gap-2 px-6 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg font-medium transition-colors\"\r\n                >\r\n                  {isLastStep ? 'Get Started' : 'Next'}\r\n                  {!isLastStep && <ArrowRight className=\"w-4 h-4\" />}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </motion.div>\r\n        </motion.div>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n}\r\n\r\n","/**\r\n * LRU Cache for Embeddings - Future Enhancement #2\r\n * Advanced caching with Least Recently Used eviction\r\n * Prevents memory bloat while keeping frequently used embeddings hot\r\n */\r\n\r\nimport { invoke } from '@tauri-apps/api/core';\r\n\r\nexport interface CachedEmbedding {\r\n  text: string;\r\n  vector: number[];\r\n  model: string;\r\n  timestamp: number;\r\n  hash: string;\r\n  accessCount: number;\r\n  lastAccessed: number;\r\n}\r\n\r\ninterface LRUNode {\r\n  key: string;\r\n  value: CachedEmbedding;\r\n  prev: LRUNode | null;\r\n  next: LRUNode | null;\r\n}\r\n\r\n/**\r\n * LRU Cache implementation for embeddings\r\n * Evicts least recently used items when capacity is reached\r\n */\r\nclass LRUCache {\r\n  private capacity: number;\r\n  private cache: Map<string, LRUNode>;\r\n  private head: LRUNode;\r\n  private tail: LRUNode;\r\n  private diskCache: Map<string, string>; // hash -> file path\r\n\r\n  constructor(capacity: number = 1000) {\r\n    this.capacity = capacity;\r\n    this.cache = new Map();\r\n    this.diskCache = new Map();\r\n\r\n    // Dummy head and tail nodes\r\n    this.head = { key: '', value: {} as CachedEmbedding, prev: null, next: null };\r\n    this.tail = { key: '', value: {} as CachedEmbedding, prev: null, next: null };\r\n    this.head.next = this.tail;\r\n    this.tail.prev = this.head;\r\n  }\r\n\r\n  /**\r\n   * Get embedding from cache (promotes to front)\r\n   */\r\n  async get(hash: string): Promise<CachedEmbedding | null> {\r\n    // Check memory cache first\r\n    const node = this.cache.get(hash);\r\n    if (node) {\r\n      this.moveToFront(node);\r\n      node.value.accessCount++;\r\n      node.value.lastAccessed = Date.now();\r\n      return node.value;\r\n    }\r\n\r\n    // Check disk cache\r\n    const diskPath = this.diskCache.get(hash);\r\n    if (diskPath) {\r\n      try {\r\n        const fileData = await invoke<number[]>('read_file', { path: diskPath });\r\n        const text = new TextDecoder().decode(new Uint8Array(fileData));\r\n        const embedding: CachedEmbedding = JSON.parse(text);\r\n\r\n        // Promote to memory cache\r\n        this.put(hash, embedding);\r\n        return embedding;\r\n      } catch (error) {\r\n        console.warn('[LRUCache] Failed to load from disk:', hash, error);\r\n        this.diskCache.delete(hash);\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Put embedding in cache (evicts LRU if needed)\r\n   */\r\n  async put(hash: string, embedding: CachedEmbedding): Promise<void> {\r\n    // Update if exists\r\n    if (this.cache.has(hash)) {\r\n      const node = this.cache.get(hash)!;\r\n      node.value = embedding;\r\n      this.moveToFront(node);\r\n      return;\r\n    }\r\n\r\n    // Evict if at capacity\r\n    if (this.cache.size >= this.capacity) {\r\n      const lru = this.tail.prev!;\r\n      this.removeNode(lru);\r\n      this.cache.delete(lru.key);\r\n\r\n      // Save evicted item to disk\r\n      await this.saveToDisk(lru.key, lru.value);\r\n    }\r\n\r\n    // Add new node\r\n    const newNode: LRUNode = {\r\n      key: hash,\r\n      value: embedding,\r\n      prev: null,\r\n      next: null,\r\n    };\r\n    this.addToFront(newNode);\r\n    this.cache.set(hash, newNode);\r\n  }\r\n\r\n  /**\r\n   * Save embedding to disk (persistent cache)\r\n   */\r\n  private async saveToDisk(hash: string, embedding: CachedEmbedding): Promise<void> {\r\n    try {\r\n      const cachePath = await invoke<string>('get_app_data_path', {\r\n        subpath: `embed_cache/${hash}.json`,\r\n      });\r\n\r\n      const json = JSON.stringify(embedding);\r\n      const bytes = new TextEncoder().encode(json);\r\n\r\n      await invoke('write_file', {\r\n        path: cachePath,\r\n        contents: Array.from(bytes),\r\n      });\r\n\r\n      this.diskCache.set(hash, cachePath);\r\n    } catch (error) {\r\n      console.warn('[LRUCache] Failed to save to disk:', hash, error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Move node to front (most recently used)\r\n   */\r\n  private moveToFront(node: LRUNode): void {\r\n    this.removeNode(node);\r\n    this.addToFront(node);\r\n  }\r\n\r\n  /**\r\n   * Add node to front\r\n   */\r\n  private addToFront(node: LRUNode): void {\r\n    node.prev = this.head;\r\n    node.next = this.head.next;\r\n    this.head.next!.prev = node;\r\n    this.head.next = node;\r\n  }\r\n\r\n  /**\r\n   * Remove node from list\r\n   */\r\n  private removeNode(node: LRUNode): void {\r\n    node.prev!.next = node.next;\r\n    node.next!.prev = node.prev;\r\n  }\r\n\r\n  /**\r\n   * Clear all cache\r\n   */\r\n  clear(): void {\r\n    this.cache.clear();\r\n    this.diskCache.clear();\r\n    this.head.next = this.tail;\r\n    this.tail.prev = this.head;\r\n  }\r\n\r\n  /**\r\n   * Get cache stats\r\n   */\r\n  getStats(): {\r\n    size: number;\r\n    capacity: number;\r\n    hitRate: number;\r\n    memorySize: number;\r\n    diskSize: number;\r\n  } {\r\n    let totalAccess = 0;\r\n    this.cache.forEach(node => {\r\n      totalAccess += node.value.accessCount;\r\n    });\r\n\r\n    return {\r\n      size: this.cache.size,\r\n      capacity: this.capacity,\r\n      hitRate: this.cache.size > 0 ? totalAccess / this.cache.size : 0,\r\n      memorySize: this.cache.size,\r\n      diskSize: this.diskCache.size,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Preload frequently accessed embeddings from disk\r\n   */\r\n  async preload(hashes: string[]): Promise<void> {\r\n    for (const hash of hashes) {\r\n      if (!this.cache.has(hash)) {\r\n        const embedding = await this.get(hash);\r\n        if (embedding) {\r\n          // Already loaded by get()\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nlet lruCacheInstance: LRUCache | null = null;\r\n\r\nexport function getLRUCache(capacity?: number): LRUCache {\r\n  if (!lruCacheInstance) {\r\n    lruCacheInstance = new LRUCache(capacity);\r\n  }\r\n  return lruCacheInstance;\r\n}\r\n\r\n/**\r\n * Enhanced embedding cache with LRU eviction\r\n * Wraps existing embeddingCache with LRU layer\r\n */\r\nexport async function getCachedEmbeddingLRU(\r\n  text: string,\r\n  model: string = 'nomic-embed-text:4bit'\r\n): Promise<CachedEmbedding | null> {\r\n  const cache = getLRUCache();\r\n\r\n  // Generate hash\r\n  const encoder = new TextEncoder();\r\n  const data = encoder.encode(`${text}:${model}`);\r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\r\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n  const hash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\r\n\r\n  return cache.get(hash);\r\n}\r\n\r\nexport async function saveCachedEmbeddingLRU(\r\n  text: string,\r\n  vector: number[],\r\n  model: string = 'nomic-embed-text:4bit'\r\n): Promise<void> {\r\n  const cache = getLRUCache();\r\n\r\n  // Generate hash\r\n  const encoder = new TextEncoder();\r\n  const data = encoder.encode(`${text}:${model}`);\r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\r\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n  const hash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\r\n\r\n  const embedding: CachedEmbedding = {\r\n    text,\r\n    vector,\r\n    model,\r\n    timestamp: Date.now(),\r\n    hash,\r\n    accessCount: 1,\r\n    lastAccessed: Date.now(),\r\n  };\r\n\r\n  await cache.put(hash, embedding);\r\n}\r\n","/**\n * Smart Prefetching Service - Future Enhancement #5\n * Predicts and pre-caches likely queries based on:\n * - User history\n * - Current context\n * - Time of day\n * - Recent searches\n */\n\nimport { getLRUCache, saveCachedEmbeddingLRU } from '../embedding/lruCache';\nimport { invoke } from '@tauri-apps/api/core';\nimport { useTabsStore } from '../../state/tabsStore';\n\nexport interface PrefetchPrediction {\n  query: string;\n  confidence: number;\n  reason: string;\n}\n\nclass QueryPrefetcher {\n  private recentQueries: string[] = [];\n  private maxRecentQueries = 50;\n  private prefetchQueue: Set<string> = new Set();\n  private isPrefetching = false;\n\n  /**\n   * Record a query for learning\n   */\n  recordQuery(query: string): void {\n    // Add to recent queries (FIFO)\n    this.recentQueries.push(query);\n    if (this.recentQueries.length > this.maxRecentQueries) {\n      this.recentQueries.shift();\n    }\n\n    // Trigger prefetch of related queries\n    this.schedulePrefetch(query);\n  }\n\n  /**\n   * Predict likely next queries\n   */\n  predictNextQueries(context?: {\n    currentUrl?: string;\n    currentTab?: string;\n    timeOfDay?: number;\n  }): PrefetchPrediction[] {\n    const predictions: PrefetchPrediction[] = [];\n\n    // 1. Recent query continuation (high confidence)\n    if (this.recentQueries.length > 0) {\n      const lastQuery = this.recentQueries[this.recentQueries.length - 1];\n      const words = lastQuery.split(' ');\n      if (words.length > 1) {\n        // Predict continuation\n        const continuation = words.slice(0, -1).join(' ');\n        predictions.push({\n          query: continuation,\n          confidence: 0.7,\n          reason: 'Recent query continuation',\n        });\n      }\n    }\n\n    // 2. Related queries from history (medium confidence)\n    const relatedQueries = this.findRelatedQueries(context?.currentUrl || '');\n    relatedQueries.forEach(q => {\n      predictions.push({\n        query: q,\n        confidence: 0.5,\n        reason: 'Related to current context',\n      });\n    });\n\n    // 3. Time-based predictions (low confidence)\n    const timeBased = this.getTimeBasedQueries(context?.timeOfDay);\n    timeBased.forEach(q => {\n      predictions.push({\n        query: q,\n        confidence: 0.3,\n        reason: 'Time-based pattern',\n      });\n    });\n\n    // Sort by confidence\n    return predictions.sort((a, b) => b.confidence - a.confidence).slice(0, 5);\n  }\n\n  /**\n   * Prefetch embeddings for predicted queries\n   */\n  async prefetchQueries(queries: string[]): Promise<void> {\n    if (this.isPrefetching) {\n      return; // Already prefetching\n    }\n\n    this.isPrefetching = true;\n\n    try {\n      // Filter out already cached\n      const cache = getLRUCache();\n      const uncachedQueries: string[] = [];\n\n      for (const query of queries) {\n        // Check if already cached\n        const encoder = new TextEncoder();\n        const data = encoder.encode(`${query}:nomic-embed-text:4bit`);\n        const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n        const hashArray = Array.from(new Uint8Array(hashBuffer));\n        const hash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n\n        const cached = await cache.get(hash);\n        if (!cached) {\n          uncachedQueries.push(query);\n        }\n      }\n\n      // Prefetch uncached queries (with rate limiting)\n      for (const query of uncachedQueries.slice(0, 3)) {\n        // Limit to 3 concurrent prefetches\n        if (this.prefetchQueue.has(query)) {\n          continue; // Already queued\n        }\n\n        this.prefetchQueue.add(query);\n\n        // Generate embedding in background\n        this.prefetchEmbedding(query).finally(() => {\n          this.prefetchQueue.delete(query);\n        });\n      }\n    } finally {\n      this.isPrefetching = false;\n    }\n  }\n\n  /**\n   * Prefetch embedding for a single query\n   */\n  private async prefetchEmbedding(query: string): Promise<void> {\n    try {\n      // Check if Tauri is available before calling\n      const { isTauriRuntime } = await import('../../lib/env');\n      if (!isTauriRuntime()) {\n        return; // Silently skip in web mode\n      }\n\n      // Call Rust embed_text command\n      const embedding = await invoke<number[]>('embed_text', {\n        text: query,\n        model: 'nomic-embed-text:4bit',\n      });\n\n      // Save to LRU cache\n      await saveCachedEmbeddingLRU(query, embedding, 'nomic-embed-text:4bit');\n\n      console.log('[Prefetcher] Prefetched embedding for:', query);\n    } catch (error: any) {\n      // Silently fail - Tauri API not available in web mode is expected\n      if (error?.message?.includes('Tauri API not available')) {\n        return;\n      }\n      // Only log unexpected errors\n      if (error?.message && !error.message.includes('Tauri')) {\n        console.warn('[Prefetcher] Failed to prefetch:', query, error);\n      }\n    }\n  }\n\n  /**\n   * Schedule prefetch for related queries\n   */\n  private schedulePrefetch(_query: string): void {\n    // Use requestIdleCallback to prefetch when idle\n    if ('requestIdleCallback' in window) {\n      requestIdleCallback(() => {\n        const predictions = this.predictNextQueries();\n        this.prefetchQueries(predictions.map(p => p.query));\n      });\n    } else {\n      // Fallback\n      setTimeout(() => {\n        const predictions = this.predictNextQueries();\n        this.prefetchQueries(predictions.map(p => p.query));\n      }, 2000);\n    }\n  }\n\n  /**\n   * Find related queries based on context\n   */\n  private findRelatedQueries(currentUrl: string): string[] {\n    // Simple implementation: find queries that share words with recent queries\n    const related: string[] = [];\n    const urlWords = currentUrl\n      .toLowerCase()\n      .split(/[^a-z0-9]+/)\n      .filter(Boolean);\n\n    for (const recentQuery of this.recentQueries.slice(-10)) {\n      const queryWords = recentQuery.toLowerCase().split(/\\s+/);\n      const commonWords = queryWords.filter(w => urlWords.includes(w));\n      if (commonWords.length > 0 && !related.includes(recentQuery)) {\n        related.push(recentQuery);\n      }\n    }\n\n    return related.slice(0, 3);\n  }\n\n  /**\n   * Get time-based query predictions\n   */\n  private getTimeBasedQueries(timeOfDay?: number): string[] {\n    const hour = timeOfDay || new Date().getHours();\n    const queries: string[] = [];\n\n    // Morning: news, weather, stocks\n    if (hour >= 6 && hour < 12) {\n      queries.push('news today', 'weather forecast', 'stock market');\n    }\n    // Afternoon: work, productivity\n    else if (hour >= 12 && hour < 18) {\n      queries.push('productivity tools', 'meeting notes', 'project management');\n    }\n    // Evening: entertainment, research\n    else {\n      queries.push('entertainment', 'research topics', 'learning resources');\n    }\n\n    return queries;\n  }\n\n  /**\n   * Get prefetch statistics\n   */\n  getStats(): {\n    recentQueries: number;\n    queuedPrefetches: number;\n    isPrefetching: boolean;\n  } {\n    return {\n      recentQueries: this.recentQueries.length,\n      queuedPrefetches: this.prefetchQueue.size,\n      isPrefetching: this.isPrefetching,\n    };\n  }\n}\n\n// Singleton instance\nlet prefetcherInstance: QueryPrefetcher | null = null;\n\nexport function getQueryPrefetcher(): QueryPrefetcher {\n  if (!prefetcherInstance) {\n    prefetcherInstance = new QueryPrefetcher();\n  }\n  return prefetcherInstance;\n}\n\n/**\n * Initialize prefetcher and start background prefetching\n */\nexport function initializePrefetcher(): void {\n  const prefetcher = getQueryPrefetcher();\n\n  // Listen to search queries\n  // This would be integrated with the search component\n  // For now, we'll expose the recordQuery function\n\n  // Start periodic prefetching based on context\n  setInterval(() => {\n    const tabsState = useTabsStore.getState();\n    const activeTab = tabsState.tabs.find(t => t.id === tabsState.activeId);\n\n    if (activeTab?.url) {\n      const predictions = prefetcher.predictNextQueries({\n        currentUrl: activeTab.url,\n        currentTab: activeTab.id,\n        timeOfDay: new Date().getHours(),\n      });\n\n      if (predictions.length > 0) {\n        prefetcher.prefetchQueries(predictions.map(p => p.query));\n      }\n    }\n  }, 30000); // Check every 30 seconds\n\n  console.log('[Prefetcher] Initialized');\n}\n","/**\n * Vector Worker Service - Future Enhancement #3\n * Wrapper for Web Worker that handles vector operations\n * Offloads heavy computations from main thread\n */\n\n// Vector worker service - offloads heavy computations\n\nexport interface VectorSearchResult {\n  id: string;\n  score: number;\n  metadata?: any;\n}\n\nclass VectorWorkerService {\n  private worker: Worker | null = null;\n  private pendingRequests: Map<\n    string,\n    {\n      resolve: (value: any) => void;\n      reject: (error: Error) => void;\n    }\n  > = new Map();\n  private requestId = 0;\n\n  /**\n   * Initialize Web Worker\n   */\n  async initialize(): Promise<void> {\n    if (this.worker) {\n      return; // Already initialized\n    }\n\n    // Create worker from inline code (Vite handles this)\n    // Note: Vite will bundle the worker automatically\n    try {\n      this.worker = new Worker(new URL('../../workers/vectorWorker.ts', import.meta.url), {\n        type: 'module',\n      });\n    } catch (error) {\n      // Fallback: create inline worker if URL import fails\n      console.warn('[VectorWorker] Failed to create worker from URL, using inline fallback', error);\n      const workerCode = `\n        // Inline worker code (fallback)\n        self.onmessage = async (event) => {\n          const { type, payload, id } = event.data;\n          try {\n            if (type === 'search') {\n              const { queryVector, vectors, k = 5 } = payload;\n              const results = vectors.map(v => ({\n                id: v.id,\n                score: cosineSimilarity(queryVector, v.vector),\n                metadata: v.metadata,\n              })).sort((a, b) => b.score - a.score).slice(0, k);\n              self.postMessage({ type: 'search_result', id, results });\n            }\n          } catch (error) {\n            self.postMessage({ type: 'error', id, error: error.message });\n          }\n        };\n        function cosineSimilarity(a, b) {\n          if (a.length !== b.length) return 0;\n          let dot = 0, normA = 0, normB = 0;\n          for (let i = 0; i < a.length; i++) {\n            dot += a[i] * b[i];\n            normA += a[i] * a[i];\n            normB += b[i] * b[i];\n          }\n          return dot / (Math.sqrt(normA) * Math.sqrt(normB));\n        }\n      `;\n      const blob = new Blob([workerCode], { type: 'application/javascript' });\n      this.worker = new Worker(URL.createObjectURL(blob));\n    }\n\n    this.worker.onmessage = (event: MessageEvent) => {\n      const { type, id, results, vector, similarity, error } = event.data;\n\n      const request = this.pendingRequests.get(id);\n      if (!request) {\n        console.warn('[VectorWorker] No pending request for id:', id);\n        return;\n      }\n\n      this.pendingRequests.delete(id);\n\n      if (error) {\n        request.reject(new Error(error));\n        return;\n      }\n\n      switch (type) {\n        case 'search_result':\n          request.resolve(results);\n          break;\n        case 'normalize_result':\n          request.resolve(vector);\n          break;\n        case 'batch_search_result':\n          request.resolve(results);\n          break;\n        case 'similarity_result':\n          request.resolve(similarity);\n          break;\n        default:\n          request.reject(new Error(`Unknown response type: ${type}`));\n      }\n    };\n\n    this.worker.onerror = (error: ErrorEvent) => {\n      console.error('[VectorWorker] Worker error:', error);\n      // Reject all pending requests\n      this.pendingRequests.forEach(({ reject }) => {\n        reject(new Error('Worker error'));\n      });\n      this.pendingRequests.clear();\n    };\n\n    console.log('[VectorWorker] Initialized');\n  }\n\n  /**\n   * Search for similar vectors (offloaded to worker)\n   */\n  async search(\n    queryVector: number[],\n    vectors: Array<{ id: string; vector: number[]; metadata?: any }>,\n    k: number = 5\n  ): Promise<VectorSearchResult[]> {\n    await this.ensureWorker();\n\n    const id = `search_${this.requestId++}`;\n    return new Promise((resolve, reject) => {\n      this.pendingRequests.set(id, { resolve, reject });\n\n      this.worker!.postMessage({\n        type: 'search',\n        id,\n        payload: { queryVector, vectors, k },\n      });\n\n      // Timeout after 10 seconds\n      setTimeout(() => {\n        if (this.pendingRequests.has(id)) {\n          this.pendingRequests.delete(id);\n          reject(new Error('Vector search timeout'));\n        }\n      }, 10000);\n    });\n  }\n\n  /**\n   * Normalize vector (offloaded to worker)\n   */\n  async normalize(vector: number[]): Promise<number[]> {\n    await this.ensureWorker();\n\n    const id = `normalize_${this.requestId++}`;\n    return new Promise((resolve, reject) => {\n      this.pendingRequests.set(id, { resolve, reject });\n\n      this.worker!.postMessage({\n        type: 'normalize',\n        id,\n        payload: { vector },\n      });\n\n      setTimeout(() => {\n        if (this.pendingRequests.has(id)) {\n          this.pendingRequests.delete(id);\n          reject(new Error('Normalize timeout'));\n        }\n      }, 5000);\n    });\n  }\n\n  /**\n   * Batch search multiple queries\n   */\n  async batchSearch(\n    queryVectors: number[][],\n    vectors: Array<{ id: string; vector: number[]; metadata?: any }>,\n    k: number = 5\n  ): Promise<VectorSearchResult[][]> {\n    await this.ensureWorker();\n\n    const id = `batch_${this.requestId++}`;\n    return new Promise((resolve, reject) => {\n      this.pendingRequests.set(id, { resolve, reject });\n\n      this.worker!.postMessage({\n        type: 'batch_search',\n        id,\n        payload: { queryVectors, vectors, k },\n      });\n\n      setTimeout(() => {\n        if (this.pendingRequests.has(id)) {\n          this.pendingRequests.delete(id);\n          reject(new Error('Batch search timeout'));\n        }\n      }, 30000);\n    });\n  }\n\n  /**\n   * Compute similarity between two vectors\n   */\n  async computeSimilarity(vector1: number[], vector2: number[]): Promise<number> {\n    await this.ensureWorker();\n\n    const id = `similarity_${this.requestId++}`;\n    return new Promise((resolve, reject) => {\n      this.pendingRequests.set(id, { resolve, reject });\n\n      this.worker!.postMessage({\n        type: 'compute_similarity',\n        id,\n        payload: { vector1, vector2 },\n      });\n\n      setTimeout(() => {\n        if (this.pendingRequests.has(id)) {\n          this.pendingRequests.delete(id);\n          reject(new Error('Similarity computation timeout'));\n        }\n      }, 5000);\n    });\n  }\n\n  /**\n   * Ensure worker is initialized\n   */\n  private async ensureWorker(): Promise<void> {\n    if (!this.worker) {\n      await this.initialize();\n    }\n  }\n\n  /**\n   * Terminate worker\n   */\n  terminate(): void {\n    if (this.worker) {\n      this.worker.terminate();\n      this.worker = null;\n      this.pendingRequests.clear();\n      console.log('[VectorWorker] Terminated');\n    }\n  }\n}\n\n// Singleton instance\nlet vectorWorkerInstance: VectorWorkerService | null = null;\n\nexport function getVectorWorkerService(): VectorWorkerService {\n  if (!vectorWorkerInstance) {\n    vectorWorkerInstance = new VectorWorkerService();\n  }\n  return vectorWorkerInstance;\n}\n","// @ts-nocheck\r\n\r\nimport React, { Suspense } from 'react';\r\nimport ReactDOM from 'react-dom/client';\r\nimport { createBrowserRouter, RouterProvider } from 'react-router-dom';\r\nimport './styles/globals.css';\r\nimport './styles/mode-themes.css';\r\nimport './lib/battery';\r\nimport { isDevEnv, isElectronRuntime, isTauriRuntime } from './lib/env';\r\nimport { setupClipperHandlers } from './lib/research/clipper-handler';\r\nimport { syncRendererTelemetry } from './lib/monitoring/sentry-client';\r\nimport { syncAnalyticsOptIn, trackPageView } from './lib/monitoring/analytics-client';\r\nimport { ipc } from './lib/ipc-typed';\r\nimport { ThemeProvider } from './ui/theme';\r\nimport { CSP_DIRECTIVE } from './config/security';\r\nimport { suppressBrowserWarnings } from './utils/suppressBrowserWarnings';\r\nimport { SettingsSync } from './components/SettingsSync';\r\n\r\n// Import test utility in dev mode\r\nif (isDevEnv()) {\r\n  import('./utils/testOmniDesk').catch(() => {\r\n    // Silently fail if test file doesn't exist\r\n  });\r\n}\r\n\r\n// Tier 2: Enhanced Error Boundary\r\nimport { GlobalErrorBoundary } from './core/errors/ErrorBoundary';\r\nimport { startSnapshotting } from './core/recovery';\r\n\r\n// DAY 9 FIX: Onboarding tour for first-time users\r\nimport { QuickStartTour } from './components/Onboarding/QuickStartTour';\r\n\r\n// DAY 3-4 FIX: Defer non-critical services - lazy load after first paint\r\n// These are moved to lazy initialization to improve startup time\r\n\r\n// Future Enhancements: Initialize after first paint\r\nimport { initializePrefetcher } from './services/prefetch/queryPrefetcher';\r\nimport { getVectorWorkerService } from './services/vector/vectorWorkerService';\r\nimport { getLRUCache } from './services/embedding/lruCache';\r\n// Migration functions available but not auto-run (call manually if needed)\r\n// import { migrateLocalStorageHistory } from './services/history';\r\n// import { migrateLocalStorageBookmarks } from './services/bookmarks';\r\n// initializeCriticalPath not yet implemented - removed for now\r\n\r\n// Lazy load components to avoid loading everything at once\r\n// Add error handling to prevent blank pages on import failures\r\nconst lazyWithErrorHandling = (importFn: () => Promise<any>, componentName: string) => {\r\n  return React.lazy(() =>\r\n    importFn().catch(error => {\r\n      console.error(`Failed to load ${componentName}:`, error);\r\n      // Return a fallback component that shows an error\r\n      return {\r\n        default: () => (\r\n          <div className=\"flex h-full w-full items-center justify-center p-4\">\r\n            <div className=\"text-center\">\r\n              <div className=\"mb-2 text-lg font-semibold text-red-400\">\r\n                Failed to load {componentName}\r\n              </div>\r\n              <div className=\"text-sm text-gray-400\">{String(error)}</div>\r\n              <button\r\n                onClick={() => window.location.reload()}\r\n                className=\"mt-4 rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-700\"\r\n              >\r\n                Reload Page\r\n              </button>\r\n            </div>\r\n          </div>\r\n        ),\r\n      };\r\n    })\r\n  );\r\n};\r\n\r\nconst AppShell = lazyWithErrorHandling(\r\n  () => import('./components/layout/AppShell').then(m => ({ default: m.AppShell })),\r\n  'AppShell'\r\n);\r\nconst Home = lazyWithErrorHandling(() => import('./routes/Home'), 'Home');\r\nconst Settings = lazyWithErrorHandling(() => import('./routes/Settings'), 'Settings');\r\nconst Workspace = lazyWithErrorHandling(() => import('./routes/Workspace'), 'Workspace');\r\nconst AgentConsole = lazyWithErrorHandling(() => import('./routes/AgentConsole'), 'AgentConsole');\r\n// Agent route not found - removed for now\r\n// // Agent routes not found - removed for now\r\n// const Agent = lazyWithErrorHandling(() => import('./routes/Agent'), 'Agent');\r\n// const AgentDemo = lazyWithErrorHandling(() => import('./routes/AgentDemo'), 'AgentDemo');\r\nconst Runs = lazyWithErrorHandling(() => import('./routes/Runs'), 'Runs');\r\nconst Replay = lazyWithErrorHandling(() => import('./routes/Replay'), 'Replay');\r\nconst PlaybookForge = lazyWithErrorHandling(\r\n  () => import('./routes/PlaybookForge'),\r\n  'PlaybookForge'\r\n);\r\nconst HistoryPage = lazyWithErrorHandling(() => import('./routes/History'), 'HistoryPage');\r\nconst DownloadsPage = lazyWithErrorHandling(() => import('./routes/Downloads'), 'DownloadsPage');\r\nconst DocumentEditorPage = lazyWithErrorHandling(\r\n  () => import('./routes/DocumentEditor'),\r\n  'DocumentEditorPage'\r\n);\r\nconst WatchersPage = lazyWithErrorHandling(() => import('./routes/Watchers'), 'WatchersPage');\r\nconst VideoPage = lazyWithErrorHandling(() => import('./routes/Video'), 'VideoPage');\r\nconst ConsentTimelinePage = lazyWithErrorHandling(\r\n  () => import('./routes/ConsentTimeline'),\r\n  'ConsentTimelinePage'\r\n);\r\n// PluginMarketplace not found - removed for now\r\n// const PluginMarketplace = lazyWithErrorHandling(\r\n//   () =>\r\n//     import('./components/plugins/PluginMarketplace').then(m => ({ default: m.PluginMarketplace })),\r\n//   'PluginMarketplace'\r\n// );\r\n// AnalyticsDashboard not found - removed for now\r\n// const AnalyticsDashboard = lazyWithErrorHandling(\r\n//   () => import('./routes/AnalyticsDashboard'),\r\n//   'AnalyticsDashboard'\r\n// );\r\n\r\n// USER REQUEST: No restrictions - completely open for all websites\r\n// CSP is now completely permissive to allow all websites\r\nconst ensureCSPMeta = () => {\r\n  if (typeof document === 'undefined') return;\r\n  const existing = document.querySelector(\r\n    'meta[http-equiv=\"Content-Security-Policy\"]'\r\n  ) as HTMLMetaElement | null;\r\n  if (existing) {\r\n    // Update to completely permissive CSP (allows everything)\r\n    existing.content = CSP_DIRECTIVE;\r\n  } else {\r\n    // Add permissive CSP that allows all websites\r\n    const meta = document.createElement('meta');\r\n    meta.httpEquiv = 'Content-Security-Policy';\r\n    meta.content = CSP_DIRECTIVE;\r\n    document.head.prepend(meta);\r\n  }\r\n};\r\n\r\nensureCSPMeta();\r\n\r\n// Suppress known browser-native console warnings (Tracking Prevention, CSP violations, etc.)\r\nsuppressBrowserWarnings();\r\n\r\n// Ultra-lightweight loading component - minimal DOM for fast render\r\nfunction LoadingFallback() {\r\n  return (\r\n    <div\r\n      style={{\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        height: '100vh',\r\n        width: '100vw',\r\n        backgroundColor: '#1A1D28',\r\n        color: '#94a3b8',\r\n        fontFamily: 'system-ui, sans-serif',\r\n        position: 'fixed',\r\n        top: 0,\r\n        left: 0,\r\n        zIndex: 1000,\r\n      }}\r\n    >\r\n      <div style={{ textAlign: 'center' }}>\r\n        <div style={{ fontSize: '24px', marginBottom: '8px' }}></div>\r\n        <div style={{ fontSize: '14px' }}>Loading...</div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Router configuration with v7 future flags\r\nconst router = createBrowserRouter(\r\n  [\r\n    {\r\n      path: '/',\r\n      element: (\r\n        <Suspense fallback={<LoadingFallback />}>\r\n          <AppShell />\r\n        </Suspense>\r\n      ),\r\n      children: [\r\n        {\r\n          index: true,\r\n          element: (\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <Home />\r\n            </Suspense>\r\n          ),\r\n        },\r\n        {\r\n          path: 'settings',\r\n          element: (\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <Settings />\r\n            </Suspense>\r\n          ),\r\n        },\r\n        {\r\n          path: 'w/:id',\r\n          element: (\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <Workspace />\r\n            </Suspense>\r\n          ),\r\n        },\r\n        {\r\n          path: 'agent',\r\n          element: (\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <AgentConsole />\r\n            </Suspense>\r\n          ),\r\n        },\r\n        // Agent route removed - file not found\r\n        // {\r\n        //   path: 'agent-new',\r\n        //   element: (\r\n        //     <Suspense fallback={<LoadingFallback />}>\r\n        //       <Agent />\r\n        //     </Suspense>\r\n        //   ),\r\n        // },\r\n        // AgentDemo route removed - file not found\r\n        // {\r\n        //   path: 'agent-demo',\r\n        //   element: (\r\n        //     <Suspense fallback={<LoadingFallback />}>\r\n        //       <AgentDemo />\r\n        //     </Suspense>\r\n        //   ),\r\n        // },\r\n        {\r\n          path: 'runs',\r\n          element: (\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <Runs />\r\n            </Suspense>\r\n          ),\r\n        },\r\n        {\r\n          path: 'replay/:id',\r\n          element: (\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <Replay />\r\n            </Suspense>\r\n          ),\r\n        },\r\n        {\r\n          path: 'playbooks',\r\n          element: (\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <PlaybookForge />\r\n            </Suspense>\r\n          ),\r\n        },\r\n        {\r\n          path: 'history',\r\n          element: (\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <HistoryPage />\r\n            </Suspense>\r\n          ),\r\n        },\r\n        {\r\n          path: 'downloads',\r\n          element: (\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <DownloadsPage />\r\n            </Suspense>\r\n          ),\r\n        },\r\n        // PluginMarketplace route removed - component not found\r\n        // {\r\n        //   path: 'plugins',\r\n        //   element: (\r\n        //     <Suspense fallback={<LoadingFallback />}>\r\n        //       <PluginMarketplace />\r\n        //     </Suspense>\r\n        //   ),\r\n        // },\r\n        // AnalyticsDashboard route removed - component not found\r\n        // {\r\n        //   path: 'analytics',\r\n        //   element: (\r\n        //     <Suspense fallback={<LoadingFallback />}>\r\n        //       <AnalyticsDashboard />\r\n        //     </Suspense>\r\n        //   ),\r\n        // },\r\n        {\r\n          path: 'watchers',\r\n          element: (\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <WatchersPage />\r\n            </Suspense>\r\n          ),\r\n        },\r\n        {\r\n          path: 'video',\r\n          element: (\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <VideoPage />\r\n            </Suspense>\r\n          ),\r\n        },\r\n        {\r\n          path: 'consent-timeline',\r\n          element: (\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <ConsentTimelinePage />\r\n            </Suspense>\r\n          ),\r\n        },\r\n        {\r\n          path: 'doc-editor',\r\n          element: (\r\n            <Suspense fallback={<LoadingFallback />}>\r\n              <DocumentEditorPage />\r\n            </Suspense>\r\n          ),\r\n        },\r\n      ],\r\n    },\r\n  ],\r\n  {\r\n    future: {\r\n      v7_startTransition: true, // Opt-in to React.startTransition wrapping in v7\r\n    },\r\n  }\r\n);\r\n\r\n// Mount the application\r\nconst rootElement = document.getElementById('root');\r\nif (!rootElement) {\r\n  // If root doesn't exist, create a visible error\r\n  document.body.innerHTML = `\r\n    <div style=\"padding: 40px; color: white; background-color: #1A1D28; min-height: 100vh; font-family: system-ui, sans-serif;\">\r\n      <h1 style=\"color: #ef4444;\"> Critical Error</h1>\r\n      <p style=\"color: #94a3b8; margin-top: 16px;\">Root element (#root) not found in the DOM.</p>\r\n      <p style=\"color: #94a3b8; margin-top: 8px;\">Please check that index.html contains &lt;div id=\"root\"&gt;&lt;/div&gt;</p>\r\n    </div>\r\n  `;\r\n  throw new Error('Root element not found');\r\n}\r\n\r\n// Ensure root element is visible and properly initialized\r\nrootElement.style.display = 'block';\r\nrootElement.style.visibility = 'visible';\r\nrootElement.style.opacity = '1';\r\nif (!rootElement.hasAttribute('data-initialized')) {\r\n  rootElement.setAttribute('data-initialized', 'true');\r\n  if (isDevEnv()) {\r\n    console.log('[Main] Root element initialized:', rootElement);\r\n  }\r\n}\r\n\r\ntry {\r\n  if (isDevEnv()) {\r\n    console.log('%c Mounting Regen...', 'color:#34d399;font-weight:bold;');\r\n    console.log('[Main] Root element:', rootElement);\r\n    console.log('[Main] Document ready state:', document.readyState);\r\n  }\r\n\r\n  const rootKey = '__OMNIBROWSER_REACT_ROOT__';\r\n  const existingRoot = (window as any)[rootKey];\r\n\r\n  if (existingRoot) {\r\n    if (isDevEnv()) {\r\n      console.log('[Main] Reusing existing React root');\r\n    }\r\n  }\r\n\r\n  const root = existingRoot || ReactDOM.createRoot(rootElement);\r\n\r\n  // Setup research clipper handlers\r\n  setupClipperHandlers();\r\n\r\n  // Tier 2: Track app open\r\n  import('./services/analytics').then(({ track }) => {\r\n    track('app_open');\r\n  });\r\n\r\n  // Tier 3: Initialize services - DEFER EVERYTHING to avoid blocking render\r\n  // Initialize crash reporter immediately (lightweight) - async to avoid blocking\r\n  import('./core/crash-reporting')\r\n    .then(({ crashReporter }) => {\r\n      crashReporter.initialize();\r\n    })\r\n    .catch(() => {\r\n      // Silently fail if crash reporter is not available\r\n      if (isDevEnv()) {\r\n        console.warn('[Main] Crash reporter not available');\r\n      }\r\n    });\r\n\r\n  // Listen for Ollama progress events (Tauri)\r\n  if (isElectronRuntime()) {\r\n    // Tauri events are handled via window events\r\n    window.addEventListener('ollama-progress', ((e: CustomEvent<number>) => {\r\n      if (isDevEnv()) {\r\n        console.log(`[Ollama] Setup progress: ${e.detail}%`);\r\n      }\r\n    }) as EventListener);\r\n\r\n    window.addEventListener('ai-ready', () => {\r\n      if (isDevEnv()) {\r\n        console.log('[Ollama] AI ready!');\r\n      }\r\n      // Show notification\r\n      import('./utils/toast').then(({ toast }) => {\r\n        toast.success('AI brain ready! Press Ctrl+Space for WISPR.');\r\n      });\r\n    });\r\n\r\n    // Listen for backend-ready event\r\n    window.addEventListener('backend-ready', () => {\r\n      if (isDevEnv()) {\r\n        console.log('[Backend] All services ready!');\r\n      }\r\n      import('./utils/toast').then(({ toast }) => {\r\n        toast.success('Backend ready! Ollama, MeiliSearch, and n8n are running.');\r\n        // SEARCH SYSTEM VERIFICATION: Initialize and verify search system\r\n        Promise.all([\r\n          import('./services/meiliIndexer').then(({ initMeiliIndexing }) => {\r\n            return initMeiliIndexing().catch(() => {\r\n              // Suppress MeiliSearch errors - it's optional\r\n            });\r\n          }),\r\n          import('./lib/meili-setup').then(({ setupMeiliIndexes }) => {\r\n            return setupMeiliIndexes().catch(console.error);\r\n          }),\r\n          import('./services/searchHealth').then(\r\n            ({ verifySearchSystem, startSearchHealthMonitoring }) => {\r\n              // Verify search system on startup\r\n              return verifySearchSystem().then(result => {\r\n                if (result.success) {\r\n                  console.log(`[Search] ${result.message}`);\r\n                  // Start health monitoring\r\n                  startSearchHealthMonitoring(30000); // Check every 30 seconds\r\n                } else {\r\n                  console.warn(`[Search] ${result.message}`);\r\n                }\r\n                return result;\r\n              });\r\n            }\r\n          ),\r\n        ]).then(() => {\r\n          console.log('[Search] Search system initialization complete');\r\n        });\r\n\r\n        // Initialize search services\r\n        import('./services/multiSourceSearch')\r\n          .then(() => {\r\n            console.log('[Search] Search services initialized');\r\n          })\r\n          .catch(console.error);\r\n        import('./services/liveWebSearch')\r\n          .then(() => {\r\n            console.log('[Search] Live web search initialized');\r\n          })\r\n          .catch(console.error);\r\n      });\r\n    });\r\n\r\n    window.addEventListener('ollama-ready', () => {\r\n      if (isDevEnv()) {\r\n        console.log('[Ollama] Ready!');\r\n      }\r\n    });\r\n\r\n    // Listen for WISPR wake event (global hotkey Ctrl+Shift+Space)\r\n    window.addEventListener('wispr-wake', () => {\r\n      console.log('[Main] WISPR wake triggered via global hotkey');\r\n      window.dispatchEvent(new CustomEvent('activate-wispr'));\r\n    });\r\n\r\n    // Listen for research metrics events (citations, hallucination risk)\r\n    window.addEventListener('research-metrics', ((e: CustomEvent) => {\r\n      console.log('[Research] Metrics updated:', e.detail);\r\n      // Metrics are handled by ResearchModePanel component\r\n    }) as EventListener);\r\n\r\n    // Listen for research start/end events\r\n    window.addEventListener('research-start', ((e: CustomEvent) => {\r\n      console.log('[Research] Started:', e.detail);\r\n    }) as EventListener);\r\n\r\n    window.addEventListener('research-end', ((e: CustomEvent) => {\r\n      console.log('[Research] Completed:', e.detail);\r\n    }) as EventListener);\r\n\r\n    // Listen for iframe-call events (fixes #6204)\r\n    window.addEventListener('iframe-call', ((e: CustomEvent<string>) => {\r\n      try {\r\n        const payload = typeof e.detail === 'string' ? JSON.parse(e.detail) : e.detail;\r\n        const fnName = payload.fn;\r\n        const args = payload.args || {};\r\n        // Execute in main context (bypasses iframe sandbox)\r\n        if (ipc && typeof (ipc as any)[fnName] === 'function') {\r\n          (ipc as any)[fnName](args).catch((err: Error) => {\r\n            console.warn('[Iframe] Invoke failed:', err);\r\n          });\r\n        }\r\n      } catch {\r\n        console.warn('[Iframe] Invalid iframe-call payload');\r\n      }\r\n    }) as EventListener);\r\n\r\n    // Listen for Ollama missing notification\r\n    window.addEventListener('ollama-missing', () => {\r\n      import('./utils/toast').then(({ toast }) => {\r\n        toast.warning('Ollama not detected. Install from ollama.com for offline AI features.');\r\n      });\r\n    });\r\n\r\n    // Listen for localhost access request (security prompt)\r\n    window.addEventListener('request-localhost-access', ((_e: CustomEvent) => {\r\n      // Show permission prompt (one-time)\r\n      const hasPrompted = localStorage.getItem('localhost-access-prompted');\r\n      if (!hasPrompted) {\r\n        import('./utils/toast').then(({ toast }) => {\r\n          toast.info(\r\n            'RegenBrowser needs localhost access for offline AI. This is safe and local-only.',\r\n            {\r\n              duration: 8000,\r\n            }\r\n          );\r\n          localStorage.setItem('localhost-access-prompted', 'true');\r\n        });\r\n      }\r\n    }) as EventListener);\r\n  }\r\n\r\n  // Telepathy Upgrade Phase 3: Pre-connect Ollama on app start\r\n  if (isTauriRuntime()) {\r\n    // Pre-connect Ollama immediately (don't block render)\r\n    import('./services/ollama/preconnect')\r\n      .then(({ preconnectOllama }) => {\r\n        // Start pre-connection in background\r\n        setTimeout(() => {\r\n          preconnectOllama().catch(() => {\r\n            // Non-critical - Ollama may not be available\r\n          });\r\n        }, 1000); // Wait 1s after startup\r\n      })\r\n      .catch(() => {\r\n        // Pre-connect service not available\r\n      });\r\n  }\r\n\r\n  // CRITICAL PATH: Initialize critical path items (SQLite, Tab Suspension, Whisper, Trade, Testing)\r\n  // Initialize these early but after first paint to ensure they're ready\r\n  setTimeout(() => {\r\n    // initializeCriticalPath not yet implemented\r\n    Promise.resolve().catch(error => {\r\n      console.error('[Main] Critical path initialization failed:', error);\r\n    });\r\n  }, 500); // Initialize after 500ms (after first paint)\r\n\r\n  // Defer ALL heavy service initialization until after first paint\r\n  // Use requestIdleCallback with longer delay for better performance\r\n  const deferHeavyInit = () => {\r\n    if ('requestIdleCallback' in window) {\r\n      requestIdleCallback(\r\n        () => {\r\n          initializeHeavyServices();\r\n        },\r\n        { timeout: 3000 } // Longer timeout for better performance\r\n      );\r\n    } else {\r\n      setTimeout(initializeHeavyServices, 500); // Increased delay\r\n    }\r\n  };\r\n\r\n  const initializeHeavyServices = async () => {\r\n    // DAY 2 FIX: Defer ALL non-critical services until after UI shows\r\n    // These services are loaded in background after first paint\r\n\r\n    // Initialize auth service (can be slow) - defer even more\r\n    setTimeout(async () => {\r\n      try {\r\n        const authModule = await import('./services/auth').catch(() => null);\r\n        if (authModule?.authService) {\r\n          await authModule.authService.initialize();\r\n          if (authModule.authService.getState().isAuthenticated) {\r\n            // Defer sync service start even further\r\n            setTimeout(async () => {\r\n              try {\r\n                const syncModule = await import('./services/sync').catch(() => null);\r\n                if (syncModule?.syncService) {\r\n                  await syncModule.syncService.startAutoSync();\r\n                }\r\n              } catch {\r\n                // Silently fail - sync service is optional\r\n              }\r\n            }, 1000);\r\n          }\r\n        }\r\n      } catch {\r\n        // Silently fail - auth service is optional for development\r\n      }\r\n    }, 2000); // Increased delay to 2s\r\n\r\n    // Restore plugin state (can be slow) - defer significantly\r\n    setTimeout(async () => {\r\n      try {\r\n        const pluginModule = await import('./core/plugins/registry').catch(() => null);\r\n        if (pluginModule?.pluginRegistry) {\r\n          pluginModule.pluginRegistry.restorePluginState();\r\n        }\r\n      } catch {\r\n        // Silently fail - plugin registry is optional\r\n      }\r\n    }, 3000); // Increased delay to 3s\r\n\r\n    // DAY 2 FIX: Move analytics/update checks to background\r\n    // These don't need to block startup\r\n    setTimeout(() => {\r\n      // Analytics check (non-blocking)\r\n      syncAnalyticsOptIn().catch(() => {\r\n        // Analytics initialization is not critical\r\n      });\r\n\r\n      // Update check (non-blocking) - Optional, only if updater plugin is available\r\n      // Note: @tauri-apps/api/updater is an optional plugin and may not be installed\r\n      if (isTauriRuntime()) {\r\n        // Use a more defensive approach - check if we're in a build environment\r\n        // where the stub might not handle this properly\r\n        try {\r\n          // Only attempt import if we're actually in Tauri runtime (not web build)\r\n          if (typeof window !== 'undefined' && (window as any).__TAURI__) {\r\n            // Use dynamic import with proper error handling\r\n            Promise.resolve()\r\n              .then(() => {\r\n                // Only import if we're sure we're in Tauri\r\n                return import('@tauri-apps/api/updater');\r\n              })\r\n              .then(module => {\r\n                if (module && typeof module.check === 'function') {\r\n                  module.check().catch(() => {\r\n                    // Update check failed, not critical\r\n                  });\r\n                }\r\n              })\r\n              .catch(err => {\r\n                // Updater plugin not installed or not available - this is fine\r\n                // The updater is an optional Tauri plugin\r\n                if (import.meta.env.DEV) {\r\n                  console.debug('[Updater] Not available:', err.message);\r\n                }\r\n              });\r\n          }\r\n        } catch (err) {\r\n          // Silently ignore - updater is optional\r\n          if (import.meta.env.DEV) {\r\n            console.debug('[Updater] Import failed:', err);\r\n          }\r\n        }\r\n      }\r\n    }, 5000); // Wait 5 seconds before checking updates\r\n  };\r\n\r\n  // DAY 2 FIX: Measure startup time (target: <3s to first paint)\r\n  const startTime = performance.now();\r\n  const metrics = {\r\n    domContentLoaded: 0,\r\n    load: 0,\r\n    firstPaint: 0,\r\n    firstContentfulPaint: 0,\r\n    timeToInteractive: 0,\r\n  };\r\n\r\n  // Measure DOMContentLoaded\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', () => {\r\n      metrics.domContentLoaded = performance.now() - startTime;\r\n      console.log(`[Perf] DOMContentLoaded: ${metrics.domContentLoaded.toFixed(2)}ms`);\r\n    });\r\n  } else {\r\n    metrics.domContentLoaded = performance.now() - startTime;\r\n  }\r\n\r\n  // Measure load event\r\n  window.addEventListener('load', () => {\r\n    metrics.load = performance.now() - startTime;\r\n    console.log(`[Perf] Load: ${metrics.load.toFixed(2)}ms`);\r\n\r\n    // Measure First Paint and First Contentful Paint\r\n    if ('PerformanceObserver' in window) {\r\n      try {\r\n        const paintObserver = new PerformanceObserver(list => {\r\n          for (const entry of list.getEntries()) {\r\n            if (entry.name === 'first-paint') {\r\n              metrics.firstPaint = entry.startTime;\r\n              console.log(`[Perf] First Paint: ${metrics.firstPaint.toFixed(2)}ms`);\r\n            }\r\n            if (entry.name === 'first-contentful-paint') {\r\n              metrics.firstContentfulPaint = entry.startTime;\r\n              console.log(\r\n                `[Perf] First Contentful Paint: ${metrics.firstContentfulPaint.toFixed(2)}ms`\r\n              );\r\n            }\r\n          }\r\n        });\r\n        paintObserver.observe({ entryTypes: ['paint'] });\r\n      } catch {\r\n        console.warn('[Perf] Paint observer not supported');\r\n      }\r\n    }\r\n\r\n    // Measure Time to Interactive (simplified)\r\n    setTimeout(() => {\r\n      metrics.timeToInteractive = performance.now() - startTime;\r\n      console.log(`[Perf] Time to Interactive: ${metrics.timeToInteractive.toFixed(2)}ms`);\r\n\r\n      // Send metrics to analytics (if enabled)\r\n      if (typeof window !== 'undefined' && (window as any).Sentry) {\r\n        (window as any).Sentry.setMeasurement('startup_time', metrics.load);\r\n        (window as any).Sentry.setMeasurement('first_paint', metrics.firstPaint);\r\n        (window as any).Sentry.setMeasurement('time_to_interactive', metrics.timeToInteractive);\r\n      }\r\n\r\n      // Log warning if startup is slow\r\n      if (metrics.firstPaint > 3000) {\r\n        console.warn(\r\n          `[Perf] Slow startup: First Paint took ${metrics.firstPaint.toFixed(2)}ms (target: <3000ms)`\r\n        );\r\n      }\r\n    }, 100);\r\n  });\r\n\r\n  // DAY 3-4 FIX: Initialize performance monitoring first\r\n  import('./utils/performance')\r\n    .then(({ initPerformanceMonitoring }) => {\r\n      initPerformanceMonitoring();\r\n    })\r\n    .catch(() => {\r\n      // Performance monitoring not critical\r\n    });\r\n\r\n  // TELEMETRY FIX: Initialize telemetry metrics tracking\r\n  import('./services/telemetryMetrics')\r\n    .then(({ telemetryMetrics }) => {\r\n      // Track app startup\r\n      const startupTime = performance.now();\r\n      telemetryMetrics.trackPerformance('app_startup', startupTime, 'ms');\r\n\r\n      // Track feature usage\r\n      telemetryMetrics.trackFeature('app_launched');\r\n\r\n      console.log('[Telemetry] Metrics tracking initialized');\r\n    })\r\n    .catch(() => {\r\n      // Telemetry not critical\r\n    });\r\n\r\n  // NETWORK FIX: Register service worker for caching\r\n  if ('serviceWorker' in navigator && import.meta.env.PROD) {\r\n    window.addEventListener('load', () => {\r\n      navigator.serviceWorker\r\n        .register('/sw.js')\r\n        .then(registration => {\r\n          console.log('[SW] Service Worker registered:', registration.scope);\r\n        })\r\n        .catch(error => {\r\n          console.warn('[SW] Service Worker registration failed:', error);\r\n        });\r\n    });\r\n  }\r\n\r\n  // CPU/BATTERY FIX: Use visibilitychange to pause heavy tasks\r\n  import('./utils/visibilityManager')\r\n    .then(({ visibilityManager }) => {\r\n      // Register visibility manager for background tab optimization\r\n      visibilityManager.onHidden(() => {\r\n        // Pause heavy operations when tab is hidden\r\n        console.log('[Visibility] Tab hidden - pausing heavy tasks');\r\n      });\r\n    })\r\n    .catch(() => {\r\n      // Visibility manager not critical\r\n    });\r\n\r\n  // DAY 1 FIX: Initialize Sentry early for crash reporting\r\n  // Initialize Sentry immediately (before other services) for crash capture\r\n  if (import.meta.env.VITE_SENTRY_DSN || import.meta.env.SENTRY_DSN) {\r\n    syncRendererTelemetry().catch(error => {\r\n      if (process.env.NODE_ENV === 'development') {\r\n        console.warn('[Monitoring] Failed to initialize Sentry', error);\r\n      }\r\n    });\r\n  }\r\n\r\n  // DAY 1 FIX: Add unhandled exception handlers\r\n  // Global error handlers for unhandled errors\r\n  window.addEventListener('error', event => {\r\n    console.error('[Global Error]', event.error);\r\n    if (typeof window !== 'undefined' && (window as any).Sentry) {\r\n      (window as any).Sentry.captureException(event.error, {\r\n        tags: { source: 'unhandled-error' },\r\n      });\r\n    }\r\n  });\r\n\r\n  window.addEventListener('unhandledrejection', event => {\r\n    console.error('[Unhandled Rejection]', event.reason);\r\n    if (typeof window !== 'undefined' && (window as any).Sentry) {\r\n      (window as any).Sentry.captureException(event.reason, {\r\n        tags: { source: 'unhandled-rejection' },\r\n      });\r\n    }\r\n    // Prevent default browser behavior\r\n    event.preventDefault();\r\n  });\r\n\r\n  // DAY 1 FIX: Monitor OOM (Out of Memory) kills\r\n  // Monitor memory usage and detect potential OOM\r\n  if ('performance' in window && 'memory' in (performance as any)) {\r\n    const checkMemory = () => {\r\n      const memInfo = (performance as any).memory;\r\n      if (memInfo) {\r\n        const usedMB = memInfo.usedJSHeapSize / 1048576;\r\n        const limitMB = memInfo.jsHeapSizeLimit / 1048576;\r\n        const usagePercent = (usedMB / limitMB) * 100;\r\n\r\n        // Warn if memory usage is high (>85%)\r\n        if (usagePercent > 85) {\r\n          console.warn(\r\n            `[Memory] High usage: ${usagePercent.toFixed(1)}% (${usedMB.toFixed(0)}MB / ${limitMB.toFixed(0)}MB)`\r\n          );\r\n          if (typeof window !== 'undefined' && (window as any).Sentry) {\r\n            (window as any).Sentry.captureMessage(\r\n              `High memory usage: ${usagePercent.toFixed(1)}%`,\r\n              (window as any).Sentry.Severity.Warning\r\n            );\r\n          }\r\n        }\r\n\r\n        // Critical if >95%\r\n        if (usagePercent > 95) {\r\n          console.error(`[Memory] CRITICAL: ${usagePercent.toFixed(1)}% - OOM risk!`);\r\n          if (typeof window !== 'undefined' && (window as any).Sentry) {\r\n            (window as any).Sentry.captureMessage(\r\n              `Critical memory usage: ${usagePercent.toFixed(1)}% - OOM risk`,\r\n              (window as any).Sentry.Severity.Error\r\n            );\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    // Check memory every 30 seconds\r\n    setInterval(checkMemory, 30000);\r\n  }\r\n\r\n  // DAY 3-4 FIX: Defer ALL non-critical services until after first paint\r\n  // This significantly improves startup time\r\n  const deferNonCriticalServices = () => {\r\n    // Defer telemetry and analytics initialization\r\n    syncRendererTelemetry().catch(error => {\r\n      if (process.env.NODE_ENV === 'development') {\r\n        console.warn('[Monitoring] Failed to initialize renderer telemetry', error);\r\n      }\r\n    });\r\n\r\n    syncAnalyticsOptIn()\r\n      .then(() => {\r\n        trackPageView(window.location.pathname);\r\n      })\r\n      .catch(error => {\r\n        if (process.env.NODE_ENV === 'development') {\r\n          console.warn('[Monitoring] Failed to initialize analytics', error);\r\n        }\r\n      });\r\n\r\n    // DAY 3-4 FIX: Lazy load heavy services after first paint\r\n    Promise.all([\r\n      import('./core/crash-reporting').catch(() => null),\r\n      import('./services/auth').catch(() => null),\r\n      import('./services/sync').catch(() => null),\r\n      import('./core/plugins/registry').catch(() => null),\r\n    ]).then(([_crashReporter, _authService, _syncService, _pluginRegistry]) => {\r\n      // Services loaded, but don't initialize yet - wait for user interaction\r\n      if (isDevEnv()) {\r\n        console.log('[Startup] Heavy services loaded (deferred)');\r\n      }\r\n    });\r\n\r\n    // Future Enhancements: Initialize after first paint\r\n    // 1. Initialize LRU cache for embeddings\r\n    getLRUCache(1000); // 1000 item capacity\r\n\r\n    // 2. Initialize vector worker service (offloads heavy computations)\r\n    getVectorWorkerService()\r\n      .initialize()\r\n      .catch(error => {\r\n        console.warn('[Startup] Vector worker initialization failed:', error);\r\n      });\r\n\r\n    // 3. Initialize query prefetcher (smart prefetching)\r\n    initializePrefetcher();\r\n\r\n    // 4. Initialize tab sync (Yjs) - deferred to avoid blocking\r\n    if (isTauriRuntime()) {\r\n      setTimeout(() => {\r\n        import('./services/sync/tabSyncService')\r\n          .then(({ initializeTabSync }) => {\r\n            const sessionId = `session-${Date.now()}`;\r\n            initializeTabSync(sessionId, 'ws://127.0.0.1:18080/yjs').catch(error => {\r\n              console.warn('[Startup] Tab sync initialization failed:', error);\r\n            });\r\n          })\r\n          .catch(() => {\r\n            // Tab sync not critical for startup\r\n          });\r\n      }, 2000); // Wait 2s after first paint\r\n    }\r\n  };\r\n\r\n  // Wait for first paint, then defer services\r\n  if (document.readyState === 'complete') {\r\n    // Already loaded, defer immediately\r\n    if (requestIdleCallback) {\r\n      requestIdleCallback(deferNonCriticalServices);\r\n    } else {\r\n      setTimeout(deferNonCriticalServices, 100);\r\n    }\r\n  } else {\r\n    // Wait for load event\r\n    window.addEventListener(\r\n      'load',\r\n      () => {\r\n        if (requestIdleCallback) {\r\n          requestIdleCallback(deferNonCriticalServices);\r\n        } else {\r\n          setTimeout(deferNonCriticalServices, 100);\r\n        }\r\n      },\r\n      { once: true }\r\n    );\r\n  }\r\n\r\n  // Keep existing deferHeavyInit for backward compatibility\r\n  deferHeavyInit();\r\n\r\n  if (typeof performance !== 'undefined' && performance.now) {\r\n    const bootMs = Math.round(performance.now());\r\n    void ipc.telemetry?.trackPerf?.('renderer_boot_ms', bootMs);\r\n  }\r\n\r\n  if (!existingRoot) {\r\n    (window as any)[rootKey] = root;\r\n  }\r\n\r\n  // Tier 2: Start session snapshotting - defer to avoid blocking\r\n  setTimeout(() => {\r\n    startSnapshotting();\r\n  }, 1000);\r\n\r\n  // Ensure root element is visible before rendering (redundant but safe)\r\n  if (rootElement) {\r\n    rootElement.style.display = 'block';\r\n    rootElement.style.visibility = 'visible';\r\n    rootElement.style.opacity = '1';\r\n  }\r\n\r\n  // DAY 1 FIX: Add comprehensive error handlers\r\n  // Unhandled promise rejection handler\r\n  window.addEventListener('unhandledrejection', event => {\r\n    const error = event.reason;\r\n    console.error('[Main] Unhandled promise rejection:', error);\r\n\r\n    // Send to Sentry if available\r\n    if (typeof window !== 'undefined' && (window as any).Sentry) {\r\n      try {\r\n        (window as any).Sentry.captureException(error, {\r\n          tags: { error_type: 'unhandled_rejection' },\r\n        });\r\n      } catch (sentryError) {\r\n        console.warn('[Sentry] Failed to capture unhandled rejection:', sentryError);\r\n      }\r\n\r\n      // TELEMETRY FIX: Track unhandled rejection\r\n      import('./services/telemetryMetrics')\r\n        .then(({ telemetryMetrics }) => {\r\n          telemetryMetrics.trackError(String(reason), { type: 'unhandled_rejection' });\r\n        })\r\n        .catch(() => {\r\n          // Telemetry not available\r\n        });\r\n    }\r\n\r\n    // Prevent default browser error handling\r\n    event.preventDefault();\r\n\r\n    // Log but don't crash\r\n    if (isDevEnv()) {\r\n      console.error('[Main] Promise rejection details:', {\r\n        reason: event.reason,\r\n        promise: event.promise,\r\n      });\r\n    }\r\n  });\r\n\r\n  // DAY 1 FIX: Add uncaught error handler with Sentry integration\r\n  window.addEventListener('error', event => {\r\n    const error = event.error || new Error(event.message);\r\n    console.error('[Main] Uncaught error:', error);\r\n\r\n    // Send to Sentry if available\r\n    if (typeof window !== 'undefined' && (window as any).Sentry) {\r\n      try {\r\n        (window as any).Sentry.captureException(error, {\r\n          tags: { error_type: 'uncaught_error' },\r\n          contexts: {\r\n            error: {\r\n              message: event.message,\r\n              filename: event.filename,\r\n              lineno: event.lineno,\r\n              colno: event.colno,\r\n            },\r\n          },\r\n        });\r\n      } catch (sentryError) {\r\n        console.warn('[Sentry] Failed to capture uncaught error:', sentryError);\r\n      }\r\n\r\n      // TELEMETRY FIX: Track uncaught error\r\n      import('./services/telemetryMetrics')\r\n        .then(({ telemetryMetrics }) => {\r\n          telemetryMetrics.trackError(error.message, {\r\n            type: 'uncaught_error',\r\n            stack: error.stack,\r\n          });\r\n        })\r\n        .catch(() => {\r\n          // Telemetry not available\r\n        });\r\n    }\r\n\r\n    // Log but don't crash - let error boundary handle it\r\n    if (isDevEnv()) {\r\n      console.error('[Main] Error details:', {\r\n        message: event.message,\r\n        filename: event.filename,\r\n        lineno: event.lineno,\r\n        colno: event.colno,\r\n        error: event.error,\r\n      });\r\n    }\r\n  });\r\n\r\n  if (isDevEnv()) {\r\n    console.log('[Main] Rendering React app...');\r\n  }\r\n\r\n  root.render(\r\n    <React.StrictMode>\r\n      <ThemeProvider>\r\n        <GlobalErrorBoundary>\r\n          <SettingsSync />\r\n          <Suspense fallback={<LoadingFallback />}>\r\n            <RouterProvider\r\n              router={router}\r\n              future={{\r\n                v7_startTransition: true,\r\n              }}\r\n            />\r\n            {/* DAY 9 FIX: Show onboarding tour for first-time users */}\r\n            <QuickStartTour />\r\n          </Suspense>\r\n        </GlobalErrorBoundary>\r\n      </ThemeProvider>\r\n    </React.StrictMode>\r\n  );\r\n\r\n  if (isDevEnv()) {\r\n    console.log('%c Regen mounted successfully', 'color:#60a5fa;font-weight:bold;');\r\n  }\r\n} catch (error) {\r\n  console.error(' Failed to mount application:', error);\r\n\r\n  // Fallback UI if React fails to mount\r\n  if (rootElement) {\r\n    rootElement.innerHTML = `\r\n      <div style=\"padding: 40px; color: white; background-color: #1A1D28; min-height: 100vh; font-family: system-ui, sans-serif;\">\r\n        <div style=\"max-width: 800px; margin: 0 auto;\">\r\n          <h1 style=\"color: #ef4444; font-size: 32px; margin-bottom: 16px;\"> Failed to Load Application</h1>\r\n          <p style=\"color: #94a3b8; margin-bottom: 24px; font-size: 16px;\">\r\n            The application failed to initialize. This is usually caused by a JavaScript error.\r\n          </p>\r\n          <div style=\"background-color: #0f172a; border-radius: 8px; padding: 20px; margin-bottom: 24px; border: 1px solid #1e293b;\">\r\n            <pre style=\"color: #f1f5f9; white-space: pre-wrap; font-size: 14px; overflow: auto; max-height: 400px;\">${String(error)}</pre>\r\n          </div>\r\n          <div style=\"display: flex; gap: 12px;\">\r\n            <button onclick=\"window.location.reload()\" style=\"padding: 12px 24px; background-color: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 500;\">\r\n               Reload Application\r\n            </button>\r\n            <button onclick=\"console.clear(); location.reload();\" style=\"padding: 12px 24px; background-color: #475569; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px;\">\r\n              Clear & Reload\r\n            </button>\r\n          </div>\r\n          <div style=\"margin-top: 32px; padding-top: 24px; border-top: 1px solid #1e293b;\">\r\n            <p style=\"color: #64748b; font-size: 14px; margin-bottom: 8px;\">Troubleshooting:</p>\r\n            <ul style=\"color: #64748b; font-size: 14px; padding-left: 24px; line-height: 1.8;\">\r\n              <li>Open Developer Tools (F12) to see detailed error messages</li>\r\n              <li>Check the Console tab for JavaScript errors</li>\r\n              <li>Ensure all dependencies are installed: <code style=\"background: #0f172a; padding: 2px 6px; border-radius: 4px;\">npm install</code></li>\r\n              <li>Try clearing browser cache and reloading</li>\r\n            </ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n}\r\n"],"file":"index-D9cF9G1U.js"}