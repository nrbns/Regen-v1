{"version":3,"file":"meiliIndexer-C-Al5lgE.js","sources":["../../src/services/meiliIndexer.ts"],"sourcesContent":["// MeiliSearch Auto-Indexing Service\r\n// Automatically indexes tabs, research, notes as they're created/updated\r\n\r\nimport { indexDocuments, ensureIndex, checkMeiliSearch } from '../lib/meili';\r\nimport type { Tab } from '../state/tabsStore';\r\n\r\nlet meiliAvailable = false;\r\nlet indexingEnabled = true;\r\n\r\n/**\r\n * Initialize MeiliSearch indexing\r\n */\r\nexport async function initMeiliIndexing(): Promise<void> {\r\n  try {\r\n    meiliAvailable = await checkMeiliSearch();\r\n    if (meiliAvailable) {\r\n      // Ensure indexes exist - suppress errors if MeiliSearch becomes unavailable\r\n      try {\r\n        await ensureIndex('tabs', 'id');\r\n        await ensureIndex('research', 'id');\r\n        await ensureIndex('notes', 'id');\r\n      } catch {\r\n        // MeiliSearch not available or unauthorized - silently disable\r\n        meiliAvailable = false;\r\n        indexingEnabled = false;\r\n        return;\r\n      }\r\n    } else {\r\n      // MeiliSearch not available - silently disable indexing\r\n      meiliAvailable = false;\r\n      indexingEnabled = false;\r\n    }\r\n  } catch {\r\n    // Suppress MeiliSearch errors - it's optional and may not be running\r\n    meiliAvailable = false;\r\n    indexingEnabled = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Index a single tab\r\n */\r\nexport async function indexTab(tab: Tab): Promise<void> {\r\n  if (!meiliAvailable || !indexingEnabled) return;\r\n\r\n  try {\r\n    const doc = {\r\n      id: tab.id,\r\n      title: tab.title || 'Untitled',\r\n      url: tab.url || '',\r\n      mode: tab.mode || 'normal',\r\n      appMode: tab.appMode || 'Browse',\r\n      createdAt: tab.createdAt || Date.now(),\r\n      lastActiveAt: tab.lastActiveAt || Date.now(),\r\n      tags: [tab.appMode?.toLowerCase() || 'browse', tab.mode || 'normal'],\r\n    };\r\n\r\n    await indexDocuments('tabs', [doc]);\r\n  } catch (error) {\r\n    // Suppress MeiliSearch errors - it's optional\r\n    const errorMsg = String(error);\r\n    if (!errorMsg.includes('401') && !errorMsg.includes('Unauthorized')) {\r\n      console.error('[MeiliIndexer] Failed to index tab:', error);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Index multiple tabs (batch)\r\n */\r\nexport async function indexTabs(tabs: Tab[]): Promise<void> {\r\n  if (!meiliAvailable || !indexingEnabled || tabs.length === 0) return;\r\n\r\n  try {\r\n    const docs = tabs.map(tab => ({\r\n      id: tab.id,\r\n      title: tab.title || 'Untitled',\r\n      url: tab.url || '',\r\n      mode: tab.mode || 'normal',\r\n      appMode: tab.appMode || 'Browse',\r\n      createdAt: tab.createdAt || Date.now(),\r\n      lastActiveAt: tab.lastActiveAt || Date.now(),\r\n      tags: [tab.appMode?.toLowerCase() || 'browse', tab.mode || 'normal'],\r\n    }));\r\n\r\n    await indexDocuments('tabs', docs);\r\n    console.log(`[MeiliIndexer] Indexed ${tabs.length} tabs`);\r\n  } catch (error) {\r\n    // Suppress MeiliSearch errors - it's optional\r\n    const errorMsg = String(error);\r\n    if (!errorMsg.includes('401') && !errorMsg.includes('Unauthorized')) {\r\n      console.error('[MeiliIndexer] Failed to index tabs:', error);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Index research document\r\n */\r\nexport async function indexResearch(doc: {\r\n  id: string;\r\n  title: string;\r\n  content: string;\r\n  url?: string;\r\n  tags?: string[];\r\n  timestamp?: number;\r\n}): Promise<void> {\r\n  if (!meiliAvailable || !indexingEnabled) return;\r\n\r\n  try {\r\n    await indexDocuments('research', [\r\n      {\r\n        id: doc.id,\r\n        title: doc.title,\r\n        content: doc.content,\r\n        url: doc.url || '',\r\n        tags: doc.tags || [],\r\n        timestamp: doc.timestamp || Date.now(),\r\n      },\r\n    ]);\r\n  } catch (error) {\r\n    console.error('[MeiliIndexer] Failed to index research:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Index note\r\n */\r\nexport async function indexNote(doc: {\r\n  id: string;\r\n  title: string;\r\n  content: string;\r\n  tags?: string[];\r\n  timestamp?: number;\r\n}): Promise<void> {\r\n  if (!meiliAvailable || !indexingEnabled) return;\r\n\r\n  try {\r\n    await indexDocuments('notes', [\r\n      {\r\n        id: doc.id,\r\n        title: doc.title,\r\n        content: doc.content,\r\n        tags: doc.tags || [],\r\n        timestamp: doc.timestamp || Date.now(),\r\n      },\r\n    ]);\r\n  } catch (error) {\r\n    console.error('[MeiliIndexer] Failed to index note:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Enable/disable indexing\r\n */\r\nexport function setIndexingEnabled(enabled: boolean): void {\r\n  indexingEnabled = enabled;\r\n  console.log(`[MeiliIndexer] Indexing ${enabled ? 'enabled' : 'disabled'}`);\r\n}\r\n\r\n// Auto-initialize when module loads - suppress all errors\r\nif (typeof window !== 'undefined') {\r\n  // Wait a bit for MeiliSearch to start\r\n  setTimeout(() => {\r\n    initMeiliIndexing().catch(() => {\r\n      // Suppress all MeiliSearch errors - it's optional\r\n    });\r\n  }, 3000);\r\n}\r\n"],"names":["meiliAvailable","indexingEnabled","initMeiliIndexing","checkMeiliSearch","ensureIndex","indexTab","tab","doc","indexDocuments","error","errorMsg"],"mappings":"oeAMA,IAAIA,EAAiB,GACjBC,EAAkB,GAKtB,eAAsBC,GAAmC,CACvD,GAAI,CAEF,GADAF,EAAiB,MAAMG,EAAA,EACnBH,EAEF,GAAI,CACF,MAAMI,EAAY,OAAQ,IAAI,EAC9B,MAAMA,EAAY,WAAY,IAAI,EAClC,MAAMA,EAAY,QAAS,IAAI,CACjC,MAAQ,CAENJ,EAAiB,GACjBC,EAAkB,GAClB,MACF,MAGAD,EAAiB,GACjBC,EAAkB,EAEtB,MAAQ,CAEND,EAAiB,GACjBC,EAAkB,EACpB,CACF,CAKA,eAAsBI,EAASC,EAAyB,CACtD,GAAI,GAACN,GAAkB,CAACC,GAExB,GAAI,CACF,MAAMM,EAAM,CACV,GAAID,EAAI,GACR,MAAOA,EAAI,OAAS,WACpB,IAAKA,EAAI,KAAO,GAChB,KAAMA,EAAI,MAAQ,SAClB,QAASA,EAAI,SAAW,SACxB,UAAWA,EAAI,WAAa,KAAK,IAAA,EACjC,aAAcA,EAAI,cAAgB,KAAK,IAAA,EACvC,KAAM,CAACA,EAAI,SAAS,eAAiB,SAAUA,EAAI,MAAQ,QAAQ,CAAA,EAGrE,MAAME,EAAe,OAAQ,CAACD,CAAG,CAAC,CACpC,OAASE,EAAO,CAEd,MAAMC,EAAW,OAAOD,CAAK,EACzB,CAACC,EAAS,SAAS,KAAK,GAAK,CAACA,EAAS,SAAS,cAAc,GAChE,QAAQ,MAAM,sCAAuCD,CAAK,CAE9D,CACF,CAgGI,OAAO,OAAW,KAEpB,WAAW,IAAM,CACfP,EAAA,EAAoB,MAAM,IAAM,CAEhC,CAAC,CACH,EAAG,GAAI"}