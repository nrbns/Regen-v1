const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/core-ai-yFIunLTZ.js","chunks/vendor-zustand-BWsgwsXr.js","chunks/vendor-react-gmX1Lmvt.js","chunks/vendor-react-dom-Bkb6jJ_S.js","chunks/vendor-Vl2WtvH-.js","chunks/mode-manager.ts-DwguZmJt.js","chunks/core-memory-DmK-uh9X.js"])))=>i.map(i=>d[i]);
import{t as s,_ as c,e as p}from"./core-ai-yFIunLTZ.js";import"./vendor-zustand-BWsgwsXr.js";import"./vendor-react-gmX1Lmvt.js";import"./vendor-react-dom-Bkb6jJ_S.js";import"./vendor-Vl2WtvH-.js";import"./mode-manager.ts-DwguZmJt.js";import"./core-memory-DmK-uh9X.js";async function g(e){try{if(typeof window<"u"){const{ipc:n}=await c(async()=>{const{ipc:a}=await import("./core-ai-yFIunLTZ.js").then(i=>i.U);return{ipc:a}},__vite__mapDeps([0,1,2,3,4,5,6]));try{const{useTabsStore:a}=await c(async()=>{const{useTabsStore:t}=await import("./core-ai-yFIunLTZ.js").then(o=>o.S);return{useTabsStore:t}},__vite__mapDeps([0,1,2,3,4,5,6])),i=a.getState(),r=i.tabs.find(t=>t.id===i.activeId);if(r){const t=await n.tabs.capturePreview({id:r.id});if(t?.success&&t?.dataUrl)return t.dataUrl}}catch{console.debug("[WISPR] IPC screenshot not available, trying fallback")}}return await f()}catch{return console.error("[WISPR] Screenshot capture failed"),s.error("Failed to capture screenshot"),null}}async function f(){try{const e=window.html2canvas;if(e&&typeof e=="function")return(await e(document.body,{backgroundColor:"#000000",scale:1,useCORS:!0,windowWidth:window.innerWidth,windowHeight:window.innerHeight})).toDataURL("image/png");try{const{ipc:n}=await c(async()=>{const{ipc:t}=await import("./core-ai-yFIunLTZ.js").then(o=>o.U);return{ipc:t}},__vite__mapDeps([0,1,2,3,4,5,6])),{useTabsStore:a}=await c(async()=>{const{useTabsStore:t}=await import("./core-ai-yFIunLTZ.js").then(o=>o.S);return{useTabsStore:t}},__vite__mapDeps([0,1,2,3,4,5,6])),i=a.getState(),r=i.tabs.find(t=>t.id===i.activeId);if(r){const t=await n.tabs.capturePreview({id:r.id});if(t?.success&&t?.dataUrl)return t.dataUrl}}catch{console.debug("[WISPR] IPC screenshot fallback failed")}return null}catch(e){return console.error("[WISPR] Viewport screenshot failed:",e),null}}async function m(e,n){try{s.info("Analyzing screenshot with AI...");let a=e.split(",")[1]||e;e.startsWith("data:image/")&&(a=e.split(",")[1]);const r=`data:image/${e.includes("image/jpeg")?"jpeg":"png"};base64,${a}`,t=n?`Analyze this screenshot and answer: ${n}. Pay special attention to charts, graphs, and dark backgrounds. Describe what you see in detail, including any numbers, trends, or patterns visible.`:"Analyze this screenshot. Describe what you see, identify any charts, graphs, text, or important information. Pay attention to dark backgrounds and ensure all visible elements are described.",o=typeof window<"u"?window.__OB_API_BASE__:"";if(o)try{const d=await fetch(`${o.replace(/\/$/,"")}/api/ai/vision`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:r,prompt:t,model:"gpt-4o",max_tokens:1e3})});if(d.ok){const u=await d.json();return u.analysis||u.text||null}}catch{console.warn("[WISPR] Vision API not available, falling back to text description")}const l=w(),h=n?`${t}

Context from page: ${l.substring(0,1e3)}`:`Describe what's on this page. Context: ${l.substring(0,1e3)}`;return(await p.runTask({kind:"chat",prompt:h,context:{hasScreenshot:!0,pageText:l.substring(0,2e3)}})).text}catch(a){return console.error("[WISPR] Screenshot analysis failed:",a),s.error("Failed to analyze screenshot"),null}}function w(){const e=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode:i=>{const r=i.parentElement;if(!r)return NodeFilter.FILTER_REJECT;const t=window.getComputedStyle(r);return t.display==="none"||t.visibility==="hidden"||t.opacity==="0"||r.tagName==="SCRIPT"||r.tagName==="STYLE"?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),n=[];let a;for(;a=e.nextNode();){const i=a.textContent?.trim();i&&i.length>0&&n.push(i)}return n.join(" ").substring(0,5e3)}async function R(e){const n=await g();return n?await m(n,e):(s.error("Failed to capture screenshot"),null)}export{m as analyzeScreenshot,R as captureAndAnalyze,g as captureScreenshot};
//# sourceMappingURL=screenshotAnalyzer--BZfFR7x.js.map
