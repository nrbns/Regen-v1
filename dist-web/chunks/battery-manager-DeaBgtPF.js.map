{"version":3,"file":"battery-manager-DeaBgtPF.js","sources":["../../src/core/redix/battery-manager.ts"],"sourcesContent":["// @ts-nocheck\n\nimport { usePowerStore } from '../../state/powerStore';\n\nlet initialized = false;\n\ntype BatteryLike = {\n  charging: boolean;\n  chargingTime: number;\n  dischargingTime: number;\n  level: number;\n  addEventListener: (event: string, handler: () => void) => void;\n  removeEventListener: (event: string, handler: () => void) => void;\n};\n\nexport async function initBatteryManager(): Promise<void> {\n  if (initialized || typeof window === 'undefined') {\n    return;\n  }\n  initialized = true;\n\n  if ('getBattery' in navigator && typeof navigator.getBattery === 'function') {\n    try {\n      const battery: BatteryLike = await navigator.getBattery();\n      bindBatteryEvents(battery);\n      updateBatteryStore(battery);\n      return;\n    } catch (error) {\n      console.warn('[BatteryManager] navigator.getBattery failed', error);\n    }\n  }\n\n  // Battery API unavailable â€“ fallback to basic status\n  usePowerStore.getState().setBattery({\n    supported: false,\n    level: null,\n    charging: null,\n  });\n}\n\nfunction bindBatteryEvents(battery: BatteryLike) {\n  const handleChange = () => updateBatteryStore(battery);\n  ['chargingchange', 'levelchange', 'dischargingtimechange', 'chargingtimechange'].forEach(\n    event => {\n      try {\n        battery.addEventListener(event, handleChange);\n      } catch {\n        // ignore\n      }\n    }\n  );\n\n  window.addEventListener(\n    'beforeunload',\n    () => {\n      ['chargingchange', 'levelchange', 'dischargingtimechange', 'chargingtimechange'].forEach(\n        event => {\n          try {\n            battery.removeEventListener(event, handleChange);\n          } catch {\n            // ignore\n          }\n        }\n      );\n    },\n    { once: true }\n  );\n}\n\nfunction updateBatteryStore(battery: BatteryLike) {\n  usePowerStore.getState().setBattery({\n    supported: true,\n    level: typeof battery.level === 'number' ? battery.level : null,\n    charging: typeof battery.charging === 'boolean' ? battery.charging : null,\n    chargingTime: Number.isFinite(battery.chargingTime) ? battery.chargingTime : null,\n    dischargingTime: Number.isFinite(battery.dischargingTime) ? battery.dischargingTime : null,\n    lastUpdated: Date.now(),\n  });\n}\n"],"names":["initialized","initBatteryManager","battery","bindBatteryEvents","updateBatteryStore","error","usePowerStore","handleChange","event"],"mappings":"g5BAIA,IAAIA,EAAc,GAWlB,eAAsBC,GAAoC,CACxD,GAAI,EAAAD,GAAe,OAAO,OAAW,KAKrC,IAFAA,EAAc,GAEV,eAAgB,WAAa,OAAO,UAAU,YAAe,WAC/D,GAAI,CACF,MAAME,EAAuB,MAAM,UAAU,WAAA,EAC7CC,EAAkBD,CAAO,EACzBE,EAAmBF,CAAO,EAC1B,MACF,OAASG,EAAO,CACd,QAAQ,KAAK,+CAAgDA,CAAK,CACpE,CAIFC,EAAc,SAAA,EAAW,WAAW,CAClC,UAAW,GACX,MAAO,KACP,SAAU,IAAA,CACX,EACH,CAEA,SAASH,EAAkBD,EAAsB,CAC/C,MAAMK,EAAe,IAAMH,EAAmBF,CAAO,EACrD,CAAC,iBAAkB,cAAe,wBAAyB,oBAAoB,EAAE,QAC/EM,GAAS,CACP,GAAI,CACFN,EAAQ,iBAAiBM,EAAOD,CAAY,CAC9C,MAAQ,CAER,CACF,CAAA,EAGF,OAAO,iBACL,eACA,IAAM,CACJ,CAAC,iBAAkB,cAAe,wBAAyB,oBAAoB,EAAE,QAC/EC,GAAS,CACP,GAAI,CACFN,EAAQ,oBAAoBM,EAAOD,CAAY,CACjD,MAAQ,CAER,CACF,CAAA,CAEJ,EACA,CAAE,KAAM,EAAA,CAAK,CAEjB,CAEA,SAASH,EAAmBF,EAAsB,CAChDI,EAAc,SAAA,EAAW,WAAW,CAClC,UAAW,GACX,MAAO,OAAOJ,EAAQ,OAAU,SAAWA,EAAQ,MAAQ,KAC3D,SAAU,OAAOA,EAAQ,UAAa,UAAYA,EAAQ,SAAW,KACrE,aAAc,OAAO,SAASA,EAAQ,YAAY,EAAIA,EAAQ,aAAe,KAC7E,gBAAiB,OAAO,SAASA,EAAQ,eAAe,EAAIA,EAAQ,gBAAkB,KACtF,YAAa,KAAK,IAAA,CAAI,CACvB,CACH"}