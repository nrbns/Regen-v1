const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/core-ai-yFIunLTZ.js","chunks/vendor-zustand-BWsgwsXr.js","chunks/vendor-react-gmX1Lmvt.js","chunks/vendor-react-dom-Bkb6jJ_S.js","chunks/vendor-Vl2WtvH-.js","chunks/mode-manager.ts-DwguZmJt.js","chunks/core-memory-DmK-uh9X.js"])))=>i.map(i=>d[i]);
import{f as d,l,_ as b}from"./core-ai-yFIunLTZ.js";import{invoke as s}from"@tauri-apps/api/core";import{e as g,f as h}from"../assets/index-D9cF9G1U.js";import"./vendor-zustand-BWsgwsXr.js";import"./vendor-react-gmX1Lmvt.js";import"./vendor-react-dom-Bkb6jJ_S.js";import"./vendor-Vl2WtvH-.js";import"./mode-manager.ts-DwguZmJt.js";import"./core-memory-DmK-uh9X.js";import"./mode-research-BclgCwOH.js";import"./vendor-utils-5Vdoy44w.js";import"./mode-docs-FcsoolLb.js";import"./vendor-pdf-ejcqEZLU.js";import"./vendor-mammoth-BPQIafDs.js";import"./vendor-framer-motion-DDE19Uim.js";async function m(e){const n=new TextEncoder().encode(e),t=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(t)).map(c=>c.toString(16).padStart(2,"0")).join("")}async function u(e){try{const{isTauriRuntime:a}=await b(async()=>{const{isTauriRuntime:n}=await import("./core-ai-yFIunLTZ.js").then(t=>t.N);return{isTauriRuntime:n}},__vite__mapDeps([0,1,2,3,4,5,6]));return a()?await s("get_app_data_path",{subpath:`embed_cache/${e}.json`}):`embed_cache/${e}.json`}catch(a){return a?.message?.includes("Tauri API not available")?`embed_cache/${e}.json`:(a?.message&&!a.message.includes("Tauri")&&console.warn("[EmbeddingCache] Failed to get app data path",a),`embed_cache/${e}.json`)}}async function p(e,a="nomic-embed-text:4bit"){try{const n=await g(e,a);if(n)return console.log("[EmbeddingCache] LRU cache hit"),n.vector;const t=await m(`${a}:${e}`),r=await u(t);try{const i=await s("read_file",{path:r}),c=new TextDecoder().decode(new Uint8Array(i)),o=JSON.parse(c);if(o.model===a&&o.text===e)return console.log("[EmbeddingCache] Disk cache hit for",t.slice(0,8)),await h(e,o.vector,a),o.vector}catch{console.debug("[EmbeddingCache] Cache miss for",t.slice(0,8))}return null}catch(n){return console.warn("[EmbeddingCache] Failed to get cached embedding",n),null}}async function f(e,a,n="nomic-embed-text:4bit"){try{await h(e,a,n);const t=await m(`${n}:${e}`),r=await u(t),i={text:e,vector:a,model:n,timestamp:Date.now(),hash:t},c=JSON.stringify(i),o=new TextEncoder().encode(c);await s("write_file",{path:r,contents:Array.from(o)}),console.log("[EmbeddingCache] Cached embedding",t.slice(0,8))}catch(t){console.warn("[EmbeddingCache] Failed to cache embedding",t)}}async function L(e,a="nomic-embed-text:4bit"){const n=await p(e,a);if(n)return n;if(d()||!l()){const t=e.split("").reduce((r,i)=>r+i.charCodeAt(0),0);return new Array(384).fill(0).map((r,i)=>Math.sin(t+i)*.1)}try{const t=await s("embed_text",{text:e,model:a});return f(e,t,a).catch(()=>{}),t}catch(t){d()||console.warn("[EmbeddingCache] Tauri embedding failed, using fallback",t);const r=e.split("").reduce((i,c)=>i+c.charCodeAt(0),0);return new Array(384).fill(0).map((i,c)=>Math.sin(r+c)*.1)}}export{f as cacheEmbedding,p as getCachedEmbedding,L as getOrGenerateEmbedding};
//# sourceMappingURL=embeddingCache-B2jk-Emn.js.map
