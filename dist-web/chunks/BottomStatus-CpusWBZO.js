const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/core-ai-yFIunLTZ.js","chunks/vendor-zustand-BWsgwsXr.js","chunks/vendor-react-gmX1Lmvt.js","chunks/vendor-react-dom-Bkb6jJ_S.js","chunks/vendor-Vl2WtvH-.js","chunks/mode-manager.ts-DwguZmJt.js","chunks/core-memory-DmK-uh9X.js"])))=>i.map(i=>d[i]);
import{_ as ft,a as Me,i as y,u as _t,w as zt,h as Ut,k as fe,v as Ft,f as ye}from"./core-ai-yFIunLTZ.js";import{bz as Gt,aF as Wt,aO as Ht,S as qt,j as t,r as a,s as Yt,al as Kt,bV as yt,e as L,bW as Ce,X as xe,bX as ot,bY as it,ak as ge,t as ct,p as Jt,g as lt,l as Xt,bl as Qt,O as Zt}from"./vendor-react-gmX1Lmvt.js";import{m as $,A as ee}from"./vendor-framer-motion-DDE19Uim.js";import{u as Be}from"./History-kg0LrAO3.js";import{u as es}from"./profileStore-CltTxMCZ.js";import{d as dt,g as ut,i as ts}from"./mode-manager.ts-DwguZmJt.js";import{u as be}from"./OmniDesk-C5fSodZ1.js";import{c as xt}from"./vendor-zustand-BWsgwsXr.js";import{u as $e}from"./trustDashboardStore-BRaGSCcb.js";import"./core-memory-DmK-uh9X.js";import"./vendor-Vl2WtvH-.js";import"./vendor-react-dom-Bkb6jJ_S.js";import"../assets/index-D9cF9G1U.js";import"./mode-research-BclgCwOH.js";import"./vendor-utils-5Vdoy44w.js";import"./mode-docs-FcsoolLb.js";import"./vendor-pdf-ejcqEZLU.js";import"./vendor-mammoth-BPQIafDs.js";import"@tauri-apps/api/core";const ss={"Ultra Green":{color:"#10b981",icon:qt,message:"AI healed the planet!"},Green:{color:"#22c55e",icon:Ht,message:"Eco-friendly response"},Yellow:{color:"#f59e0b",icon:Wt,message:"Moderate energy use"},Red:{color:"#ef4444",icon:Gt,message:"High energy — optimize!"}};function rs({score:c,tier:u,co2SavedG:r=0}){const b=ss[u],h=b.icon;return t.jsxs($.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-1.5 px-2 py-1 rounded-md border backdrop-blur-sm",style:{borderColor:`${b.color}40`,backgroundColor:`${b.color}10`},title:`${u}: ${c}% • ${b.message}${r>0?` • Saved ${r.toFixed(1)}g CO₂`:""}`,children:[t.jsx(h,{size:12,style:{color:b.color}}),t.jsxs("span",{style:{color:b.color},className:"text-[10px] font-semibold",children:[c,"%"]}),r>0&&t.jsxs("span",{className:"text-[9px] text-gray-400",children:[r.toFixed(1),"g"]})]})}function as(){const[c,u]=a.useState("Normal"),[r,b]=a.useState(!1),[h,S]=a.useState(!1),T=es(i=>i.policies[i.activeProfileId]);a.useEffect(()=>{const i=dt();if(b(i.isTorBrowser),i.isTorBrowser&&i.confidence!=="low"){const E=ut();E.isEnabled()||(E.enable(),u("Ghost"),S(!0))}S(ts())},[]);const te=T?!T.allowPrivateWindows:!1,se=T?!T.allowGhostTabs:!1,R=[{value:"Normal",icon:Yt,label:"Normal",color:"text-gray-400"},{value:"Private",icon:Kt,label:"Private",color:"text-blue-400",disabled:te},{value:"Ghost",icon:yt,label:"Ghost",color:"text-purple-400",disabled:se,badge:r?"Tor":void 0}],_=async i=>{if(i===c||R.find(v=>v.value===i)?.disabled)return;const{ipc:P}=await ft(async()=>{const{ipc:v}=await import("./core-ai-yFIunLTZ.js").then(I=>I.U);return{ipc:v}},__vite__mapDeps([0,1,2,3,4,5,6])),{activeId:k}=Me.getState(),W=ut();if(i==="Ghost"){try{if(!dt().isTorBrowser&&!confirm(`⚠️ Ghost Mode is most secure when running inside Tor Browser.

Without Tor Browser, some security features may be limited.

Enable Ghost Mode anyway?`))return;if(W.enable(),S(!0),k)try{await P.proxy.set({tabId:k,type:"socks5",host:"127.0.0.1",port:9050})}catch(I){console.warn("Could not set Tor proxy:",I)}u("Ghost")}catch(v){console.error("Failed to enable Ghost mode:",v)}return}if(i==="Normal"){h&&(W.disable(),S(!1));try{k&&await P.proxy.set({tabId:k}),await P.proxy.set({}),u("Normal")}catch(v){console.error("Failed to switch to Normal mode:",v),u("Normal")}}else if(i==="Private")try{await P.private.createWindow({url:"about:blank"}),u("Normal");return}catch(v){console.error("Failed to create private window:",v);return}i!=="Normal"&&i!=="Private"&&u(i)};return t.jsx("div",{className:"flex items-center gap-1 rounded-lg border border-gray-700/50 bg-gray-800/50 p-1",role:"group","aria-label":"Privacy mode selector",children:R.map(i=>{const E=i.icon,P=c===i.value;return t.jsxs($.button,{type:"button",onClick:()=>_(i.value),onKeyDown:k=>{(k.key==="Enter"||k.key===" ")&&(k.preventDefault(),_(i.value))},whileHover:{scale:1.05},whileTap:{scale:.95},className:`flex items-center gap-1.5 rounded-md px-3 py-1.5 text-xs font-medium transition-all focus:outline-none focus:ring-2 focus:ring-blue-400/50 ${P?`${i.color.replace("text-","bg-")} bg-opacity-20 text-white`:i.disabled?"cursor-not-allowed text-gray-600":"text-gray-400 hover:text-gray-300"}`,disabled:i.disabled,"aria-label":`Switch to ${i.label} privacy mode`,"aria-pressed":P,"aria-disabled":i.disabled,title:i.disabled?`${i.label} disabled by profile policy`:`Switch to ${i.label}`,children:[t.jsx(E,{size:14,"aria-hidden":"true"}),t.jsx("span",{children:i.label}),i.badge&&t.jsx("span",{className:"text-[10px] opacity-75",title:"Tor Browser detected",children:i.badge})]},i.value)})})}const Ie={running:!1,bootstrapped:!1,circuitEstablished:!1,progress:0,stub:!1,error:null,loading:!1,lastChecked:null},ns={connected:!1,type:void 0,name:void 0,stub:!1,loading:!1,lastChecked:null},D=xt((c,u)=>({tor:Ie,vpn:ns,async refreshTor(){c(r=>({tor:{...r.tor,loading:!0}}));try{const r=await y.tor.status();c({tor:{running:!!r?.running,bootstrapped:!!r?.bootstrapped,circuitEstablished:!!r?.circuitEstablished,progress:typeof r?.progress=="number"?r.progress:0,stub:!!r?.stub,error:typeof r?.error=="string"?r.error:null,loading:!1,lastChecked:Date.now()}})}catch(r){c({tor:{...u().tor,loading:!1,error:r instanceof Error?r.message:String(r),lastChecked:Date.now()}})}},async refreshVpn(){c(r=>({vpn:{...r.vpn,loading:!0}}));try{const r=await y.vpn.status();c({vpn:{connected:!!r?.connected,type:r?.type??void 0,name:r?.name??void 0,stub:!!r?.stub,loading:!1,lastChecked:Date.now()}})}catch{c({vpn:{...u().vpn,loading:!1,lastChecked:Date.now()}})}},async startTor(){c(r=>({tor:{...r.tor,loading:!0,error:null}}));try{const r=await y.tor.start();await u().refreshTor(),r?.stub&&c(b=>({tor:{...b.tor,stub:!0,error:r?.warning??"Tor binary not found; running in stub mode."}}))}catch(r){c({tor:{...Ie,error:r instanceof Error?r.message:String(r),loading:!1,lastChecked:Date.now()}})}},async stopTor(){c(r=>({tor:{...r.tor,loading:!0}}));try{await y.tor.stop()}catch(r){c({tor:{...u().tor,error:r instanceof Error?r.message:String(r)}})}finally{c({tor:{...Ie,lastChecked:Date.now()}})}},async newTorIdentity(){try{await y.tor.newIdentity(),await u().refreshTor()}catch(r){c({tor:{...u().tor,error:r instanceof Error?r.message:String(r)}})}},async checkVpn(){c(r=>({vpn:{...r.vpn,loading:!0}}));try{const r=await y.vpn.check();c({vpn:{connected:!!r?.connected,type:r?.type??void 0,name:r?.name??void 0,stub:!!r?.stub,loading:!1,lastChecked:Date.now()}})}catch{c({vpn:{...u().vpn,loading:!1,lastChecked:Date.now()}})}}})),os=1440*60*1e3,is=200,cs=2e3,he=xt(c=>({latest:null,history:[],dailyTotalCarbon:0,pushSample:u=>c(r=>{const b=[...r.history,u].slice(-300),S=Math.max(u.carbonIntensity??is,0)*(cs/os),T=r.dailyTotalCarbon+S;return{latest:u,history:b,dailyTotalCarbon:T}}),clear:()=>c({latest:null,history:[],dailyTotalCarbon:0})})),pt=new Intl.RelativeTimeFormat("en",{numeric:"auto"});function ls(){const c=globalThis.crypto?.randomUUID?.();return c||`privacy-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`}function mt(c){const u=Date.now();let r=c-u;const b=[[1e3,"second"],[60,"minute"],[60,"hour"],[24,"day"],[7,"week"],[4.34524,"month"],[12,"year"]];for(const[h,S]of b){if(Math.abs(r)<h)return pt.format(Math.round(r),S);r/=h}return pt.format(Math.round(r),"year")}function Bs(){const{activeId:c}=Me(),u=_t(e=>e.language||"en"),[r,b]=a.useState(""),[h,S]=a.useState(!1),[T,te]=a.useState(()=>typeof navigator<"u"?!navigator.onLine:!1),[se,R]=a.useState(""),[_,i]=a.useState(null),[E,P]=a.useState(null),[k,W]=a.useState(!1),[v,I]=a.useState(!1),ve=a.useRef(null),we=a.useRef(null),[re,H]=a.useState({enabled:!1,provider:"cloudflare"}),ae=he(e=>e.latest),q=ae?.cpu??0,Y=ae?.memory??0,K=he(e=>e.pushSample),[ne]=a.useState(!0),[De,gt]=a.useState(()=>zt()),[ke,oe]=a.useState("Normal"),[A,ie]=a.useState(null),J=be(e=>e.label),Re=be(e=>e.badge),je=be(e=>e.snapshot),Ae=be(e=>e.setEvent),Oe=je.carbonIntensity??null,l=D(e=>e.tor),x=D(e=>e.vpn),X=D(e=>e.refreshTor),Ne=D(e=>e.refreshVpn),bt=D(e=>e.startTor),ht=D(e=>e.stopTor),vt=D(e=>e.newTorIdentity),Q=D(e=>e.checkVpn),z=he(e=>e.history),Ve=he(e=>e.dailyTotalCarbon),Le=a.useRef([]),_e=a.useRef([]),[ce,Se]=a.useState(null),[ze,wt]=a.useState([]),Ue=a.useRef([]),[Fe,Z]=a.useState(null),[M,le]=a.useState(!1),[Ge,de]=a.useState(null),[We,He]=a.useState([]),[C,ue]=a.useState(null),[m,qe]=a.useState({trackersBlocked:0,adsBlocked:0});a.useEffect(()=>{const e=async()=>{try{const n=await y.shields.getStatus();n&&qe({trackersBlocked:n.trackersBlocked||0,adsBlocked:n.adsBlocked||0})}catch(n){console.debug("[BottomStatus] Failed to get shields stats:",n)}};e();const s=setInterval(e,5e3);return()=>clearInterval(s)},[]);const pe=a.useMemo(()=>Ut(),[]),Ye=a.useMemo(()=>fe("API_BASE_URL")??fe("OMNIBROWSER_API_URL")??fe("OB_API_BASE_URL")??fe("VITE_REDIX_HTTP_URL")??"http://localhost:4000",[]),U=a.useRef(null),Ke=$e(e=>e.open),Te=$e(e=>e.refresh),O=$e(e=>({pending:e.consentStats.pending,blocked:e.blockedSummary.trackers,loading:e.loading}));a.useEffect(()=>{const e=()=>te(!1),s=()=>te(!0);window.addEventListener("online",e),window.addEventListener("offline",s);const n=Ft(o=>{gt(o)});return()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s),n()}},[]);const p=a.useCallback(e=>{const s={id:ls(),timestamp:e.timestamp??Date.now(),kind:e.kind,status:e.status,message:e.message};He(n=>[...n.slice(-29),s]),ue(s)},[]),Je=a.useRef(x),Xe=a.useRef(l);Be("net:status",e=>{if(e.doh&&H(e.doh),e.tor?.enabled&&e.tor.circuitEstablished?oe("Tor"):e.proxy?.enabled?oe("Ghost"):oe("Normal"),e.vpn)if(!e.vpn.connected)Z(null);else{const s=Ue.current,n=s.find(o=>o.name===e.vpn?.provider)||s.find(o=>o.server&&o.server===e.vpn?.server);n?Z(n.id):e.vpn.provider&&Z(e.vpn.provider)}},[]),Be("efficiency:mode",e=>{Ae(e)},[Ae]),Be("efficiency:alert",e=>{ie(e)},[]),a.useEffect(()=>{X(),Ne();const e=window.setInterval(()=>{X(),Ne()},2e4);return()=>window.clearInterval(e)},[X,Ne]),a.useEffect(()=>{let e=!1;const s=async()=>{try{const o=await y.vpn.listProfiles();!e&&Array.isArray(o)&&(wt(o),Ue.current=o)}catch(o){console.warn("[vpn] Failed to load profiles",o)}};s();const n=window.setInterval(s,6e4);return()=>{e=!0,window.clearInterval(n)}},[]),a.useEffect(()=>{const e=window.setTimeout(()=>{Te()},450),s=window.setInterval(()=>{Te()},6e4);return()=>{window.clearTimeout(e),window.clearInterval(s)}},[Te]),a.useEffect(()=>{if(ae){const e=z.slice(-5);Le.current=e.filter(s=>s.cpu>=85),_e.current=e.filter(s=>s.memory>=85),Le.current.length>=3?Se({title:"CPU running hot",message:"Consider enabling Performance Mode or closing heavy tabs.",severity:"warning"}):_e.current.length>=3&&Se({title:"Memory pressure detected",message:"Try hibernating inactive tabs to free RAM.",severity:"warning"})}},[ae,z]),a.useEffect(()=>{const e=Xe.current;!e.running&&l.running&&p({kind:"tor",status:"info",message:"Tor daemon starting…"}),!e.bootstrapped&&l.bootstrapped&&p({kind:"tor",status:"success",message:"Tor circuit established"}),e.running&&!l.running&&p({kind:"tor",status:"info",message:"Tor stopped"}),!e.stub&&l.stub&&p({kind:"tor",status:"warning",message:"Tor binary not found – running in stub mode"}),l.error&&l.error!==e.error&&p({kind:"tor",status:"warning",message:`Tor warning: ${l.error}`}),Xe.current=l},[l,p]),a.useEffect(()=>{const e=Je.current;if(!e.connected&&x.connected){const s=x.name||x.type||"VPN";p({kind:"vpn",status:"success",message:`VPN connected${`: ${s}`}`})}e.connected&&!x.connected&&p({kind:"vpn",status:"info",message:"VPN disconnected"}),Je.current=x},[x,p]),a.useEffect(()=>{if(pe){let e=!1,s=null;const n=async()=>{if(!e)try{const o=await y.performance.getMetrics();if(e||!o)return;const N={timestamp:o.timestamp||Date.now(),cpu:o.cpu||0,memory:o.memory||0,carbonIntensity:void 0};K(N)}catch(o){e||console.warn("[metrics] Failed to poll metrics:",o)}};return n(),s=setInterval(n,1e3),()=>{e=!0,s&&clearInterval(s)}}else{if(ye()){K({timestamp:Date.now(),cpu:0,memory:0});return}if(!De){if(U.current){try{U.current.close()}catch{}U.current=null}K({timestamp:Date.now(),cpu:0,memory:0});return}let e=null,s=null,n=0;const o=10,N=3e3,d=()=>{if(!ye()&&e?.readyState!==WebSocket.OPEN)try{const w=`${Ye.replace(/^http/,"ws")}/ws/metrics`;e=new WebSocket(w),U.current=e,e.onmessage=g=>{try{const f=JSON.parse(g.data);if(f.type!=="metrics")return;const B={timestamp:typeof f.timestamp=="number"?f.timestamp:Date.now(),cpu:typeof f.cpu=="number"?f.cpu:0,memory:typeof f.memory=="number"?f.memory:0,carbonIntensity:typeof f.carbon_intensity=="number"?f.carbon_intensity:void 0};K(B),n=0}catch(f){console.warn("[metrics] Failed to parse message",f)}},e.onopen=()=>{n=0},e.onerror=g=>{g.stopPropagation(),g.preventDefault()},e.onclose=()=>{if(e=null,U.current=null,!ye()&&n<o){n++;const g=N*Math.min(n,5);s=setTimeout(()=>{d()},g)}}}catch(w){ye()||console.error("[metrics] Failed to create websocket:",w)}};return d(),()=>{if(s&&clearTimeout(s),e){try{(e.readyState===WebSocket.OPEN||e.readyState===WebSocket.CONNECTING)&&e.close()}catch{}e=null}U.current=null}}},[pe,Ye,K,De]),a.useEffect(()=>{if(!pe)return;let e=!1,s=null;const n=async()=>{if(!e)try{const o=await y.shields.getStatus();if(e||!o)return;qe({trackersBlocked:o.trackersBlocked||0,adsBlocked:o.adsBlocked||0})}catch(o){e||console.warn("[BottomStatus] Failed to poll shields stats:",o)}};return n(),s=setInterval(n,2e3),()=>{e=!0,s&&clearInterval(s)}},[pe]),a.useEffect(()=>{let e=!0;const s=async()=>{if(e){if(!window.ipc||typeof window.ipc.invoke!="function"){setTimeout(s,500);return}try{const n=await y.dns.status();e&&n&&typeof n=="object"&&H(n)}catch{e&&H({enabled:!1,provider:"cloudflare"})}}};return setTimeout(s,400),()=>{e=!1}},[]);const kt={Normal:"text-gray-400",Ghost:"text-blue-400",Tor:"text-purple-400"},jt=O.pending>0?"warning":O.blocked>0?"info":"default",Nt=O.pending>0?`${O.pending} pending`:O.blocked>0?`${O.blocked} trackers blocked`:"Ledger clean",St=l.stub?"Tor: Stub":l.running?l.circuitEstablished?"Tor: On":`Tor: ${Math.round(l.progress)}%`:"Tor: Off",Tt=l.error?`Tor warning: ${l.error}`:l.stub?"Tor binary not found; using stub mode for UI only.":l.running?l.circuitEstablished?"Tor circuit established. Click to stop.":"Tor starting up. Click to stop.":"Route traffic through Tor. Click to enable.",Et=x.connected?`VPN connected${x.name?` (${x.name})`:""}. Click to re-check.`:"Check whether a system VPN is active.",Qe={info:"bg-blue-500/10 border-blue-400/40 text-blue-100",warning:"bg-amber-500/10 border-amber-400/40 text-amber-100",critical:"bg-red-500/10 border-red-400/40 text-red-100"},me=e=>typeof e!="number"||!Number.isFinite(e)?0:Math.max(0,Math.min(100,Math.round(e))),Ze=({label:e,points:s,color:n,labels:o})=>{const d=(s.length>0?s:[0]).map((B,G,V)=>{const Ee=G/Math.max(V.length-1,1)*200,Pe=80-B/100*80;return`${G===0?"M":"L"}${Ee},${Pe}`}).join(" "),w=o.length>=2?o[o.length-1]-o[0]:0,g=Math.max(Math.round(w/6e4),0),f=g>0?`${g}m window`:"Live";return t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center justify-between text-[11px] text-gray-300",children:[t.jsx("span",{children:e}),t.jsx("span",{className:"opacity-70",children:f})]}),t.jsx("svg",{viewBox:"0 0 200 80",className:"h-20 w-full rounded-md bg-gray-900/70 p-1",children:t.jsx("path",{d,fill:"none",stroke:n,strokeWidth:"2",strokeLinecap:"round"})})]})},Pt=a.useMemo(()=>z.map(e=>me(e.cpu)),[z]),F=a.useMemo(()=>z.slice(-180),[z]),Ct=a.useMemo(()=>F.map(e=>me(e.cpu)),[F]),Bt=a.useMemo(()=>F.map(e=>me(e.memory)),[F]),et=a.useMemo(()=>F.map(e=>e.timestamp),[F]),tt=({icon:e,label:s,value:n,percent:o,gradient:N="from-blue-500 via-cyan-500 to-blue-500",title:d,onClick:w,sparklinePoints:g})=>{const f=w?"button":"div",B=me(o);return t.jsxs(f,{type:w?"button":void 0,onClick:w,title:d,className:`flex items-center gap-1.5 rounded-full border border-gray-700/60 bg-gray-800/60 px-2 py-1 text-xs text-gray-200 ${w?"cursor-pointer transition-colors hover:border-gray-500/70 focus:outline-none focus:ring-1 focus:ring-blue-400/40":""}`,children:[t.jsx(e,{size:12,className:"text-gray-400"}),t.jsx("span",{className:"font-semibold text-gray-100",children:s}),t.jsx("span",{className:"text-[11px] opacity-75",children:n}),t.jsx("div",{className:"h-1.5 w-14 overflow-hidden rounded-full bg-gray-700",children:t.jsx($.div,{className:`h-full bg-gradient-to-r ${N}`,initial:{width:0},animate:{width:`${B}%`},transition:{duration:.5,ease:"easeOut"}})}),g&&g.length>4&&t.jsx("svg",{viewBox:"0 0 40 12",className:"ml-2 h-3 w-10 text-blue-400/70",children:t.jsx("polyline",{fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",points:g.slice(-12).map((G,V,Ee)=>{const Pe=V/Math.max(Ee.length-1,1)*40,Lt=12-G/100*12;return`${Pe},${Lt}`}).join(" ")})})]})},j=({icon:e,label:s,description:n,variant:o="default",title:N,onClick:d,pulse:w=!1,loading:g=!1,className:f})=>{const B={default:"border-gray-700/60 bg-gray-800/60 text-gray-200",positive:"border-emerald-500/30 bg-emerald-500/10 text-emerald-100",warning:"border-amber-500/30 bg-amber-500/10 text-amber-100",danger:"border-red-500/30 bg-red-500/10 text-red-100",info:"border-blue-500/30 bg-blue-500/10 text-blue-100"},G=d?"button":"div";return t.jsxs(G,{type:d?"button":void 0,onClick:d,onKeyDown:d?V=>{(V.key==="Enter"||V.key===" ")&&(V.preventDefault(),d())}:void 0,title:N,"aria-label":N||s,"aria-busy":g,className:`${B[o]} ${f??""} flex items-center gap-1.5 rounded-full px-2 py-1 text-xs ${d?"cursor-pointer transition-colors hover:border-gray-500/70 focus:outline-none focus:ring-1 focus:ring-blue-400/30":""}`,children:[t.jsx(e,{size:12,className:"opacity-80","aria-hidden":"true"}),t.jsx("span",{className:"font-medium",children:s}),n&&t.jsx("span",{className:"text-[11px] opacity-75",children:n}),g&&t.jsx("span",{className:"h-3 w-3 animate-spin rounded-full border border-current border-t-transparent","aria-label":"Loading",role:"status"}),w&&t.jsx($.span,{className:"inline-flex h-1.5 w-1.5 rounded-full bg-current",animate:{opacity:[.4,1,.4],scale:[1,1.2,1]},transition:{duration:1.6,repeat:1/0,ease:"easeInOut"},"aria-hidden":"true"})]})};a.useEffect(()=>{if(!A)return;const e=setTimeout(()=>{ie(null)},2e4);return()=>clearTimeout(e)},[A]),a.useEffect(()=>{if(!C)return;const e=window.setTimeout(()=>{ue(null)},8e3);return()=>window.clearTimeout(e)},[C]);const $t=async e=>{try{e.type==="mode"&&e.mode?await y.efficiency.applyMode(e.mode):e.type==="hibernate"&&await y.efficiency.hibernateInactiveTabs()}catch(s){console.error("Efficiency action failed:",s)}finally{ie(null)}},st=a.useCallback(async()=>{if(!r.trim()||h)return;S(!0),i(null),R("");const e=Me.getState().tabs.find(o=>o.id===c),s=e?{url:e.url,title:e.title,tabId:e.id}:void 0,n="http://localhost:8001";try{const o=await fetch(`${n}/workflow`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:r,context:s?`Current page: ${s.title} (${s.url})`:"",workflowType:"rag",options:{useOllama:!0,stream:!1,temperature:.7}})}).catch(()=>null);if(o?.ok){const d=await o.json();R(d.result||"No response generated."),d.greenScore!==void 0&&P({score:d.greenScore,tier:d.greenTier||"Green",co2Saved:d.co2SavedG||0});return}const N=await fetch(`${n}/ask`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:r,context:s,options:{provider:"auto",maxTokens:500}})}).catch(()=>null);if(N?.ok){const d=await N.json();R(d.text||"No response generated."),d.greenScore!==void 0&&P({score:d.greenScore,tier:d.greenTier||"Green",co2Saved:d.co2SavedG||0});return}try{const{sendPrompt:d}=await ft(async()=>{const{sendPrompt:f}=await import("./core-ai-yFIunLTZ.js").then(B=>B.W);return{sendPrompt:f}},__vite__mapDeps([0,1,2,3,4,5,6])),w=s?`Context: You are viewing "${s.title}" at ${s.url}

User question: ${r}`:r,g=await d(w,{systemPrompt:"You are a helpful AI assistant in a browser. Answer concisely.",maxTokens:500});R(g.text)}catch{throw new Error("AI service unavailable. Please check your API keys or Redix server.")}}catch(o){console.error("[BottomStatus] Prompt failed:",o),i(o.message||"Failed to get AI response. Check Redix server or API keys.")}finally{S(!1)}},[r,h,c]);a.useEffect(()=>{if(!k&&!v)return;const e={capture:!0},s=n=>{const o=n.target;k&&ve.current&&ve.current.contains(o)||v&&we.current&&we.current.contains(o)||(W(!1),I(!1))};return document.addEventListener("mousedown",s,e),()=>document.removeEventListener("mousedown",s,e)},[k,v]);const It=async()=>{try{re.enabled?(await y.dns.disableDoH(),H({enabled:!1,provider:"cloudflare"})):(await y.dns.enableDoH("cloudflare"),H({enabled:!0,provider:"cloudflare"}))}catch(e){console.error("Failed to toggle DoH:",e)}},Mt=a.useCallback(async e=>{if(!(!e||M)){de(null),le(!0);try{const s=await y.vpn.connect(e);if(await Q().catch(()=>{}),s?.connected){Z(e);const n=s.name||s.server||s.interface||"VPN";p({kind:"vpn",status:"success",message:n?`VPN connected: ${n}`:"VPN connected"})}else p({kind:"vpn",status:"info",message:"VPN connect command sent"})}catch(s){const n=s instanceof Error?s.message:String(s);de(n),p({kind:"vpn",status:"warning",message:`VPN error: ${n}`})}finally{le(!1)}}},[Q,p,M]),Dt=a.useCallback(async()=>{if(!M){de(null),le(!0);try{await y.vpn.disconnect(),await Q().catch(()=>{}),Z(null),p({kind:"vpn",status:"info",message:"VPN disconnect requested"})}catch(e){const s=e instanceof Error?e.message:String(e);de(s),p({kind:"vpn",status:"warning",message:`VPN error: ${s}`})}finally{le(!1)}}},[Q,p,M]),Rt=[Re||null,typeof je.batteryPct=="number"?`${Math.round(je.batteryPct)}%`:null,typeof Oe=="number"?`${Math.round(Oe)} gCO₂/kWh`:null,Ve>0?`${Ve.toFixed(2)} gCO₂ saved today`:null].filter(Boolean).join(" · "),At=J.includes("Regen")?"positive":J.includes("Battery")?"info":"default",Ot=St.replace(/^Tor:?\s*/i,""),Vt=l.stub?"warning":l.running?"info":"default",rt=x.connected?x.type?x.type.toUpperCase():"Active":"Disconnected",at=u?.startsWith("hi")?"hi":u?.startsWith("ta")?"ta":"en",nt={shieldsOn:{en:"Shields ON",hi:"शील्ड चालू",ta:"கவசம் இயக்கம்"},blocked:{en:"Blocked",hi:"रोकें",ta:"தடுக்கப்பட்டது"}};return t.jsxs(t.Fragment,{children:[t.jsx(ee,{children:C&&t.jsxs($.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,y:12},transition:{duration:.2},className:`fixed bottom-20 right-6 z-50 flex items-center gap-2 rounded-lg border px-3 py-2 text-xs shadow-lg shadow-black/40 ${C.status==="success"?"border-emerald-500/40 bg-emerald-500/15 text-emerald-100":C.status==="warning"?"border-amber-500/40 bg-amber-500/15 text-amber-100":"border-sky-500/40 bg-sky-500/15 text-sky-100"}`,children:[C.kind==="tor"?t.jsx(L,{size:16,"aria-hidden":"true"}):t.jsx(Ce,{size:16,"aria-hidden":"true"}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"font-medium",children:C.message}),t.jsx("span",{className:"text-[10px] opacity-80",children:mt(C.timestamp)})]}),t.jsx("button",{type:"button",onClick:()=>ue(null),className:"ml-2 rounded p-1 text-[10px] transition-colors hover:text-white","aria-label":"Dismiss privacy notification",children:t.jsx(xe,{size:12})})]},C.id)}),t.jsxs("div",{className:"hidden flex-col gap-2 border-t border-slate-800/60 bg-slate-950/90 px-4 py-2.5 text-xs text-gray-300 md:flex","data-onboarding":"status-bar",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 text-xs text-gray-300 sm:gap-2 sm:text-sm md:gap-3",children:[t.jsx(as,{}),t.jsx(tt,{icon:ot,label:"CPU",value:`${q}%`,percent:q,gradient:"from-blue-500 via-cyan-500 to-blue-500",title:"CPU usage",sparklinePoints:Pt}),t.jsx(tt,{icon:it,label:"RAM",value:`${Y}%`,percent:Y,title:"System memory usage",gradient:"from-green-500 via-emerald-500 to-green-500"}),t.jsx(j,{icon:ge,label:J,description:Rt||void 0,variant:At,title:Re??J}),t.jsx(j,{icon:yt,label:"Mode",description:ke,className:kt[ke],title:`Privacy mode: ${ke}`}),t.jsx(j,{icon:L,label:"Trust",description:Nt,variant:jt,onClick:()=>void Ke(),title:"Open trust & ethics dashboard",loading:O.loading}),T&&t.jsx(j,{icon:ct,label:"Offline",description:"Local mode",variant:"warning",title:"Offline mode: remote services paused"}),t.jsx(j,{icon:L,label:"Blocked",description:m.trackersBlocked>0||m.adsBlocked>0?m.trackersBlocked>0&&m.adsBlocked>0?`${m.trackersBlocked} trackers, ${m.adsBlocked} ads`:m.trackersBlocked>0?`${m.trackersBlocked} trackers`:`${m.adsBlocked} ads`:"0 trackers",variant:m.trackersBlocked>0||m.adsBlocked>0?"positive":"default",onClick:()=>void Ke(),title:m.trackersBlocked>0||m.adsBlocked>0?`Privacy shields active: ${m.trackersBlocked} tracker${m.trackersBlocked===1?"":"s"} and ${m.adsBlocked} ad${m.adsBlocked===1?"":"s"} blocked. Click to view details.`:"Privacy shields: No trackers or ads blocked yet. Click to view privacy dashboard."}),t.jsxs("div",{className:"ml-auto flex flex-shrink-0 items-center gap-1.5 sm:gap-2",children:[t.jsx(j,{icon:Jt,label:"Model",description:ne?"Ready":"Loading",variant:ne?"positive":"default",pulse:ne,loading:!ne,title:"Local model status"}),t.jsxs("button",{type:"button",className:"hidden items-center gap-1 rounded-full border border-gray-700/50 bg-gray-800/60 px-2 py-1 text-xs text-gray-300 transition-colors hover:border-gray-600 hover:text-white sm:px-3 sm:py-1.5 md:flex",onClick:()=>I(e=>!e),title:"View detailed performance trends",children:[t.jsx(ge,{size:14}),t.jsx("span",{className:"hidden lg:inline",children:"Trends"})]}),t.jsxs("div",{className:"relative hidden w-32 sm:block sm:w-48 md:w-60",children:[t.jsx("input",{type:"text",value:r,onChange:e=>b(e.target.value),onKeyDown:e=>{e.key==="Enter"&&st()},placeholder:"Prompt agent (e.g., 'summarize this page')...",disabled:h||T,className:`h-8 w-full rounded-full border border-gray-700/60 bg-gray-800/70 pl-3 pr-9 text-xs text-gray-200 placeholder-gray-400 focus:border-blue-500/60 focus:outline-none focus:ring-1 focus:ring-blue-500/40 ${h||T?"cursor-not-allowed opacity-70":""}`}),h?t.jsx(lt,{className:"absolute right-2 top-1/2 h-3.5 w-3.5 -translate-y-1/2 animate-spin text-blue-300","aria-label":"Sending prompt"}):t.jsx("button",{type:"button",onClick:()=>void st(),disabled:T,className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 transition-colors hover:text-gray-200 disabled:opacity-50",title:"Send prompt",children:t.jsx(Xt,{size:14})})]}),(se||_||h)&&t.jsxs("div",{className:"hidden w-full space-y-2 sm:block",children:[t.jsx("div",{className:"rounded-xl border border-gray-800 bg-gray-900/70 p-3 text-left text-xs text-gray-200",children:_?t.jsx("span",{className:"text-red-400",children:_}):t.jsx("span",{className:"whitespace-pre-wrap",children:se||(h?"Redix is thinking…":"")})}),E&&!h&&t.jsx("div",{className:"flex items-center justify-end",children:t.jsx(rs,{score:E.score,tier:E.tier,co2SavedG:E.co2Saved})})]}),t.jsxs("div",{className:"relative",ref:ve,children:[t.jsxs("button",{type:"button",className:"flex items-center gap-1 rounded-full border border-gray-700/50 bg-gray-800/60 px-3 py-1.5 text-xs text-gray-300 transition-colors hover:border-gray-600 hover:text-white",onClick:()=>W(e=>!e),title:"Security & network controls",children:[t.jsx(Qt,{size:14}),"More"]}),t.jsx(ee,{children:k&&t.jsx($.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},transition:{duration:.16},className:"absolute right-0 mt-2 w-64 rounded-lg border border-gray-800 bg-slate-950/95 p-3 shadow-xl",children:t.jsxs("div",{className:"grid gap-2",children:[t.jsx(j,{icon:L,label:"Tor",description:Ot,variant:Vt,onClick:l.loading?void 0:async()=>{l.running?(p({kind:"tor",status:"info",message:"Stopping Tor…"}),await ht(),setTimeout(async()=>{await X(),(await y.proxy.status())?.tor?.enabled===!1&&p({kind:"tor",status:"success",message:"Tor stopped. Proxy disabled."})},1e3)):(p({kind:"tor",status:"info",message:"Starting Tor…"}),await bt(),setTimeout(async()=>{await X();const e=await y.proxy.status();e?.tor?.enabled&&e?.tor?.circuitEstablished?p({kind:"tor",status:"success",message:`Tor active. Circuit: ${e.tor.circuitId||"established"}`}):e?.tor?.enabled&&p({kind:"tor",status:"info",message:"Tor starting, circuit establishing…"})},2e3))},loading:l.loading,title:Tt,className:`justify-start ${l.loading?"cursor-not-allowed opacity-60":""}`}),l.running&&!l.stub&&t.jsxs("button",{type:"button",onClick:()=>{l.loading||(p({kind:"tor",status:"info",message:"Requesting new Tor identity…"}),vt().then(()=>{p({kind:"tor",status:"success",message:"Tor identity refreshed"})}).catch(e=>{const s=e instanceof Error?e.message:String(e);p({kind:"tor",status:"warning",message:`Tor identity error: ${s}`})}))},className:"flex items-center gap-2 rounded-md border border-purple-500/40 bg-purple-500/10 px-3 py-1.5 text-[11px] text-purple-100 transition-colors hover:border-purple-400/60",children:[t.jsx(Zt,{size:12}),"Request new Tor identity"]}),t.jsx(j,{icon:Ce,label:"VPN",description:rt,variant:x.connected?"positive":"default",onClick:x.loading?void 0:()=>void Q(),loading:x.loading,title:Et,className:`justify-start ${x.loading?"cursor-not-allowed opacity-60":""}`}),ze.length>0&&t.jsxs("div",{className:"space-y-2 rounded-md border border-gray-800/60 bg-gray-900/40 p-2",children:[t.jsx("span",{className:"text-[10px] uppercase text-gray-400",children:"VPN Profiles"}),t.jsx("div",{className:"space-y-1",children:ze.map(e=>{const s=Fe===e.id;return t.jsxs("button",{type:"button",onClick:()=>Mt(e.id),disabled:M,className:`w-full rounded-md px-2 py-1 text-left text-[11px] transition-colors ${s?"border border-emerald-400/40 bg-emerald-500/20 text-emerald-100":"border border-transparent text-gray-300 hover:border-gray-700"} ${M?"cursor-wait opacity-70":""}`,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:e.name}),s&&t.jsx("span",{className:"text-[10px] opacity-70",children:"Active"})]}),e.server&&t.jsx("div",{className:"text-[10px] opacity-60",children:e.server})]},e.id)})}),t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("button",{type:"button",onClick:()=>Dt(),disabled:!Fe||M,className:"flex-1 rounded-md border border-gray-700/50 px-2 py-1 text-[10px] text-gray-300 transition-colors hover:border-gray-600 disabled:opacity-50",children:"Disconnect"}),M&&t.jsx(lt,{className:"h-3.5 w-3.5 animate-spin text-emerald-300"})]}),Ge&&t.jsx("div",{className:"rounded-md border border-amber-500/30 bg-amber-500/10 px-2 py-1 text-[10px] text-amber-200",children:Ge})]}),We.length>0&&t.jsxs("div",{className:"space-y-2 rounded-md border border-gray-800/60 bg-gray-900/40 p-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-[10px] uppercase text-gray-400",children:[t.jsx("span",{children:"Privacy activity"}),t.jsx("button",{type:"button",onClick:()=>{He([]),ue(null)},className:"rounded px-1.5 py-0.5 text-[9px] text-gray-400 transition-colors hover:text-gray-200",children:"Clear"})]}),t.jsx("div",{className:"max-h-32 space-y-1 overflow-auto",children:We.slice().reverse().map(e=>{const s=e.status==="success"?"bg-emerald-400":e.status==="warning"?"bg-amber-400":"bg-sky-400";return t.jsxs("div",{className:"flex items-start gap-2 text-[11px] text-gray-300",children:[t.jsx("span",{className:`mt-1 h-2 w-2 rounded-full ${s}`,"aria-hidden":"true"}),t.jsxs("div",{className:"space-y-0.5",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[e.kind==="tor"?t.jsx(L,{size:12,className:"text-purple-300"}):t.jsx(Ce,{size:12,className:"text-emerald-300"}),t.jsx("span",{children:e.message})]}),t.jsx("div",{className:"text-[9px] text-gray-500",children:mt(e.timestamp)})]})]},e.id)})})]}),t.jsx(j,{icon:L,label:"DoH",description:re.enabled?re.provider:"Disabled",variant:re.enabled?"info":"default",onClick:It,title:"Toggle DNS-over-HTTPS",className:"justify-start"}),t.jsx(j,{icon:ge,label:"Efficiency",description:J||"Normal",variant:"default",className:"justify-start"}),t.jsx(j,{icon:ot,label:"CPU",description:`${q}%`,variant:q>70?"warning":"default",title:"CPU usage",className:"justify-start"}),t.jsx(j,{icon:it,label:"RAM",description:`${Y}%`,variant:Y>75?"warning":"default",title:"Memory usage",className:"justify-start"})]})})})]}),t.jsx(ee,{children:v&&t.jsxs($.div,{ref:we,initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},transition:{duration:.16},className:"absolute right-0 top-12 w-72 rounded-lg border border-gray-800 bg-slate-950/95 p-4 shadow-xl",children:[t.jsxs("div",{className:"mb-2 flex items-center justify-between text-xs text-gray-300",children:[t.jsx("span",{className:"font-semibold uppercase tracking-wide",children:"Performance Trends"}),t.jsx("button",{className:"text-xs opacity-70 transition-opacity hover:opacity-100",onClick:()=>I(!1),"aria-label":"Close trends panel",children:t.jsx(xe,{size:12})})]}),t.jsx(Ze,{label:"CPU %",points:Ct,color:"#38bdf8",labels:et}),t.jsx(Ze,{label:"RAM %",points:Bt,color:"#22d3ee",labels:et})]})})]})]}),t.jsxs("div",{className:"flex flex-wrap items-start gap-3",children:[t.jsx(ee,{children:A&&t.jsxs($.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},className:`flex w-full max-w-xl items-center gap-3 rounded-lg border px-3 py-2 shadow-inner ${Qe[A.severity]}`,children:[t.jsx(ct,{size:14}),t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsx("span",{className:"text-xs font-semibold",children:A.title}),t.jsx("span",{className:"text-[11px] opacity-80",children:A.message})]}),t.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[A.actions.map(e=>t.jsx("button",{onClick:()=>$t(e),className:"rounded bg-gray-900/60 px-2 py-1 text-[11px] font-medium transition-colors hover:bg-gray-900/80",children:e.label},e.id)),t.jsx("button",{onClick:()=>ie(null),className:"p-1 text-xs opacity-70 transition-opacity hover:opacity-100","aria-label":"Dismiss efficiency alert",children:t.jsx(xe,{size:12})})]})]},"efficiency-alert")}),t.jsx(ee,{children:ce&&t.jsxs($.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},className:`flex w-full max-w-xl items-center gap-3 rounded-lg border px-3 py-2 shadow-inner ${Qe[ce.severity]}`,children:[t.jsx(ge,{size:14}),t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsx("span",{className:"text-xs font-semibold",children:ce.title}),t.jsx("span",{className:"text-[11px] opacity-80",children:ce.message})]}),t.jsx("div",{className:"ml-auto",children:t.jsx("button",{onClick:()=>Se(null),className:"p-1 text-xs opacity-70 transition-opacity hover:opacity-100","aria-label":"Dismiss metrics alert",children:t.jsx(xe,{size:12})})})]},"metrics-alert")})]})]}),t.jsxs("div",{className:"flex items-center justify-between border-t border-slate-900/70 bg-slate-950/95 px-4 py-3 text-xs text-gray-200 md:hidden",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("span",{className:"text-[11px] text-gray-400",children:["CPU ",q,"% · RAM ",Y,"%"]}),t.jsxs("button",{type:"button",onClick:()=>oe(e=>e==="Normal"?"Ghost":"Normal"),className:"mt-1 inline-flex items-center gap-2 rounded-full bg-slate-800/80 px-3 py-1 text-[11px] font-medium text-gray-100",children:[t.jsx(L,{size:12}),nt.shieldsOn[at]]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"text-[11px] text-gray-400",children:[nt.blocked[at],":"," ",m.trackersBlocked+m.adsBlocked]}),t.jsxs("span",{className:"text-[10px] text-gray-500",children:["VPN: ",x.connected?rt:"OFF"]})]})]})]})}export{Bs as BottomStatus};
//# sourceMappingURL=BottomStatus-CpusWBZO.js.map
