import{r as a,j as e,ak as k,bi as C,O as S,T as E}from"./vendor-react-gmX1Lmvt.js";import{i as c}from"./core-ai-yFIunLTZ.js";import{i as y}from"../assets/index-D9cF9G1U.js";import{m as g}from"./vendor-framer-motion-DDE19Uim.js";import"./vendor-react-dom-Bkb6jJ_S.js";import"./vendor-Vl2WtvH-.js";import"./vendor-zustand-BWsgwsXr.js";import"./mode-manager.ts-DwguZmJt.js";import"./core-memory-DmK-uh9X.js";import"./mode-research-BclgCwOH.js";import"./vendor-utils-5Vdoy44w.js";import"./mode-docs-FcsoolLb.js";import"./vendor-pdf-ejcqEZLU.js";import"./vendor-mammoth-BPQIafDs.js";import"@tauri-apps/api/core";const L={idle:"text-emerald-300 bg-emerald-500/10 border-emerald-500/30",checking:"text-blue-300 bg-blue-500/10 border-blue-500/30",changed:"text-amber-300 bg-amber-500/10 border-amber-500/30",error:"text-red-300 bg-red-500/10 border-red-500/30"};function B(){const[o,d]=a.useState([]),[l,m]=a.useState({url:"",intervalMinutes:15}),[f,j]=a.useState(!0),[u,h]=a.useState(!1),[p,i]=a.useState(null);a.useEffect(()=>{(async()=>{try{const s=await c.watchers.list();Array.isArray(s)&&d(s)}catch(s){console.error("Failed to load watchers:",s),i(s instanceof Error?s.message:String(s))}finally{j(!1)}})();const r=y.on("watchers:updated",s=>{Array.isArray(s)&&d(s)}),n=y.on("watchers:changed",s=>{s?.id&&d(A=>A.map(x=>x.id===s.id?{...x,...s}:x))});return()=>{r(),n()}},[]);const b=a.useMemo(()=>[...o].sort((t,r)=>{const n=t.lastChangeAt||t.lastCheckedAt||t.createdAt;return(r.lastChangeAt||r.lastCheckedAt||r.createdAt)-n}),[o]),v=async t=>{if(t.preventDefault(),i(null),!l.url.trim()){i("Enter a valid URL.");return}h(!0);try{await c.watchers.add({url:l.url.trim(),intervalMinutes:l.intervalMinutes}),m({url:"",intervalMinutes:l.intervalMinutes})}catch(r){const n=r instanceof Error?r.message:String(r);i(n)}finally{h(!1)}},N=async t=>{try{await c.watchers.remove(t)}catch(r){console.error("Failed to remove watcher",r)}},w=async t=>{try{await c.watchers.trigger(t)}catch(r){console.error("Failed to trigger watcher",r)}};return e.jsxs("div",{className:"h-full w-full bg-[#1A1D28] text-gray-100 flex flex-col",children:[e.jsx("header",{className:"p-6 border-b border-gray-800/50 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(k,{size:22,className:"text-emerald-400"}),"Page Change Watchers"]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Receive alerts when tracked pages change. Checks run automatically at the interval you choose."})]})}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("section",{className:"bg-gray-900/70 rounded-xl border border-gray-800/60 p-5 shadow-lg shadow-black/20",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 flex items-center gap-2",children:[e.jsx(C,{size:18}),"Add watcher"]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"We’ll keep a hash of the page content and alert you whenever it changes."}),e.jsxs("form",{onSubmit:v,className:"mt-4 flex flex-col gap-3 md:flex-row md:items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs uppercase tracking-wide text-gray-500 mb-2",children:"Page URL"}),e.jsx("input",{type:"url",required:!0,value:l.url,onChange:t=>m(r=>({...r,url:t.target.value})),placeholder:"https://example.com/page",className:"w-full px-4 py-2.5 rounded-lg bg-gray-800/80 border border-gray-700/60 text-sm text-gray-100 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/50"})]}),e.jsxs("div",{className:"w-full md:w-36",children:[e.jsx("label",{className:"block text-xs uppercase tracking-wide text-gray-500 mb-2",children:"Check every (minutes)"}),e.jsx("input",{type:"number",min:1,max:1440,value:l.intervalMinutes,onChange:t=>m(r=>({...r,intervalMinutes:Number.parseInt(t.target.value||"15",10)})),className:"w-full px-4 py-2.5 rounded-lg bg-gray-800/80 border border-gray-700/60 text-sm text-gray-100 focus:outline-none focus:ring-2 focus:ring-emerald-500/50"})]}),e.jsx("button",{type:"submit",disabled:u,className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-emerald-600 hover:bg-emerald-500 transition disabled:opacity-60 text-sm font-semibold",children:u?"Adding…":"Add watcher"})]}),p&&e.jsx("p",{className:"text-sm text-red-400 mt-3",children:p})]}),e.jsxs("section",{children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-200 flex items-center gap-2",children:["Active watchers",e.jsxs("span",{className:"text-xs text-gray-500",children:["(",o.length,")"]})]})}),f?e.jsx("div",{className:"flex items-center justify-center py-20 text-gray-400 text-sm",children:"Loading watchers…"}):b.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center py-20 text-center text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No watchers yet. Add a page to start monitoring changes."})}):e.jsx("div",{className:"space-y-3",children:b.map(t=>e.jsx(g.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"bg-gray-900/60 border border-gray-800/60 rounded-lg p-4 hover:bg-gray-900/80 transition-all",children:e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`text-[11px] font-semibold uppercase tracking-wide px-2 py-0.5 rounded-full border ${L[t.status]}`,children:t.status}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Every ",t.intervalMinutes," min • Created"," ",new Date(t.createdAt).toLocaleString()]})]}),e.jsx("a",{href:t.url,target:"_blank",rel:"noreferrer",className:"text-sm font-medium text-emerald-200 truncate hover:underline",title:t.url,children:t.url}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 space-x-3",children:[t.lastCheckedAt&&e.jsxs("span",{children:["Last check: ",new Date(t.lastCheckedAt).toLocaleString()]}),t.lastChangeAt&&e.jsxs("span",{className:"text-amber-300",children:["Last change detected: ",new Date(t.lastChangeAt).toLocaleString()]})]}),t.error&&e.jsxs("div",{className:"mt-2 text-xs text-red-400",children:["Error: ",t.error]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g.button,{onClick:()=>w(t.id),whileHover:{scale:1.05},whileTap:{scale:.95},className:"p-2 rounded-lg bg-gray-800/60 hover:bg-gray-800 border border-gray-700/60 text-gray-300 hover:text-blue-400 transition-colors",title:"Run check now",children:e.jsx(S,{size:16})}),e.jsx(g.button,{onClick:()=>N(t.id),whileHover:{scale:1.05},whileTap:{scale:.95},className:"p-2 rounded-lg bg-gray-800/60 hover:bg-gray-800 border border-gray-700/60 text-gray-300 hover:text-red-400 transition-colors",title:"Remove watcher",children:e.jsx(E,{size:16})})]})]})},t.id))})]})]})]})}export{B as default};
//# sourceMappingURL=Watchers-D9YXaUTw.js.map
