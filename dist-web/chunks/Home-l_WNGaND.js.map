{"version":3,"mappings":"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","names":["DocumentViewer","isOpen","onClose","document","highlightText","contentRef","useRef","useEffect","content","text","walker","node","parent","highlighted","handleOpenInTab","ipc","error","AnimatePresence","jsx","motion","jsxs","e","FileText","BookOpen","ExternalLink","X","buildDefaultActions","summary","citations","actions","topCitation","sanitizeContext","context","acc","key","value","coerceSources","sources","normalized","item","maybeUrl","maybeLabel","normalizeResponse","answer","model","trimmed","source","index","runResearchAgent","request","contextPayload","result","fallback","aiEngine","executeResearchAgentAction","action","targetUrl","AGENT_DEFAULT_PROMPT","ResearchPane","query","setQuery","useState","isLoading","setIsLoading","answerChunks","setAnswerChunks","setSources","activeSourceId","setActiveSourceId","setIsOpen","viewerDocument","setViewerDocument","viewerHighlight","setViewerHighlight","activeId","tabs","useTabsStore","activeTab","tab","streamChannelRef","listenerRef","agentPromptRef","agentPrompt","setAgentPrompt","agentResponse","setAgentResponse","agentLoading","setAgentLoading","agentError","setAgentError","pendingActionId","setPendingActionId","isResearchMode","useAppStore","s","syncDocumentsFromBackend","handleKeyboardOpen","ipcEvents","handleQuery","useCallback","localResults","searchChunks","localSources","chunk","channel","listener","_event","payload","prev","sourceList","citeId","cites","cite","existingIds","newSources","handleSaveTabSnapshot","snapshotId","handleFileUpload","event","file","fileId","buildAgentContext","selection","rawSelection","handleRunAgent","response","showToast","handleAgentAction","followUpPrompt","handleOpenSource","url","handleViewDocument","highlight","Sparkles","Camera","Upload","Search","Fragment","Loader2","ClipboardList","citation","CheckCircle2","idx","part","i","citationMatch","citeNum","citedSource","WeatherCard","weather","setWeather","isVisible","setIsVisible","handleWeatherUpdate","listen","Droplets","Cloud","Sun","Wind","FlightCard","flight","setFlight","handleFlightCard","__vitePreload","ArrowRight","Plane","iframe","toast","ResearchPanel","lazy","n","TradePanel","DocumentMode","m","ThreatsPanel","ModeLoadingFallback","Home","mode","isFullscreen","setIsFullscreen","checkFullscreen","isCurrentlyFullscreen","timeoutId","handleFullscreen","data","unsubscribe","OmniDesk","ErrorBoundary","Suspense"],"ignoreList":[],"sources":["../../src/components/research/DocumentViewer.tsx","../../src/services/researchAgent.ts","../../src/components/research/ResearchPane.tsx","../../src/components/WeatherCard.tsx","../../src/components/FlightCard.tsx","../../src/routes/Home.tsx"],"sourcesContent":["/**\r\n * Document Viewer - Overlay for viewing full documents with highlighted snippets\r\n */\r\n\r\nimport { useEffect, useRef } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { X, ExternalLink, FileText, BookOpen } from 'lucide-react';\r\nimport { ipc } from '../../lib/ipc-typed';\r\n\r\ninterface DocumentViewerProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  document: {\r\n    id: string;\r\n    title: string;\r\n    url?: string;\r\n    type: 'tab' | 'pdf' | 'docx' | 'txt' | 'md' | 'html' | 'snapshot' | 'web';\r\n    snippet?: string;\r\n    content?: string;\r\n  };\r\n  highlightText?: string;\r\n}\r\n\r\nexport function DocumentViewer({ isOpen, onClose, document, highlightText }: DocumentViewerProps) {\r\n  const contentRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    if (isOpen && highlightText && contentRef.current) {\r\n      // Scroll to and highlight the text\r\n      const content = contentRef.current;\r\n      const text = highlightText.toLowerCase();\r\n      \r\n      // Simple text highlighting approach\r\n      if (content.textContent?.toLowerCase().includes(text)) {\r\n        // Find and highlight the text\r\n        const walker = window.document.createTreeWalker(\r\n          content,\r\n          NodeFilter.SHOW_TEXT,\r\n          null\r\n        );\r\n        let node;\r\n        \r\n        while ((node = walker.nextNode())) {\r\n          if (node.textContent?.toLowerCase().includes(text)) {\r\n            const parent = node.parentElement;\r\n            if (parent && parent.textContent) {\r\n              // Replace text with highlighted version\r\n              const highlighted = parent.innerHTML.replace(\r\n                new RegExp(highlightText.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'), 'gi'),\r\n                `<span class=\"bg-yellow-400/30 text-yellow-200 rounded px-1\">$&</span>`\r\n              );\r\n              parent.innerHTML = highlighted;\r\n              parent.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }, [isOpen, highlightText]);\r\n\r\n  const handleOpenInTab = async () => {\r\n    if (document.url) {\r\n      try {\r\n        await ipc.tabs.create(document.url);\r\n      } catch (error) {\r\n        console.error('Failed to open in tab:', error);\r\n      }\r\n    }\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      <motion.div\r\n        initial={{ opacity: 0 }}\r\n        animate={{ opacity: 1 }}\r\n        exit={{ opacity: 0 }}\r\n        className=\"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4\"\r\n        onClick={onClose}\r\n      >\r\n        <motion.div\r\n          initial={{ opacity: 0, scale: 0.95, y: 20 }}\r\n          animate={{ opacity: 1, scale: 1, y: 0 }}\r\n          exit={{ opacity: 0, scale: 0.95, y: 20 }}\r\n          className=\"w-full max-w-4xl max-h-[90vh] bg-slate-950 border border-slate-800 rounded-2xl shadow-2xl flex flex-col overflow-hidden\"\r\n          onClick={(e) => e.stopPropagation()}\r\n        >\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between p-4 border-b border-slate-800 bg-slate-900\">\r\n            <div className=\"flex items-center gap-3 flex-1 min-w-0\">\r\n              <div className=\"p-2 rounded-lg bg-blue-500/20 text-blue-400\">\r\n                {document.type === 'pdf' ? (\r\n                  <FileText size={20} />\r\n                ) : (\r\n                  <BookOpen size={20} />\r\n                )}\r\n              </div>\r\n              <div className=\"flex-1 min-w-0\">\r\n                <h2 className=\"text-lg font-semibold text-gray-100 truncate\">{document.title}</h2>\r\n                {document.url && (\r\n                  <p className=\"text-xs text-gray-400 truncate mt-1\">{document.url}</p>\r\n                )}\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              {document.url && (\r\n                <button\r\n                  onClick={handleOpenInTab}\r\n                  className=\"p-2 rounded-lg hover:bg-slate-800 text-gray-400 hover:text-gray-200 transition-colors\"\r\n                  title=\"Open in new tab\"\r\n                >\r\n                  <ExternalLink size={18} />\r\n                </button>\r\n              )}\r\n              <button\r\n                onClick={onClose}\r\n                className=\"p-2 rounded-lg hover:bg-slate-800 text-gray-400 hover:text-gray-200 transition-colors\"\r\n              >\r\n                <X size={18} />\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Content */}\r\n          <div className=\"flex-1 overflow-y-auto p-6\">\r\n            {document.content ? (\r\n              <div\r\n                ref={contentRef}\r\n                className=\"prose prose-invert max-w-none text-gray-200 leading-relaxed\"\r\n                dangerouslySetInnerHTML={{ __html: document.content }}\r\n              />\r\n            ) : document.snippet ? (\r\n              <div className=\"text-gray-200 leading-relaxed\">\r\n                <p className=\"text-lg mb-4\">{document.snippet}</p>\r\n                <p className=\"text-sm text-gray-400\">\r\n                  Full document content not available. Click \"Open in new tab\" to view the complete document.\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"flex flex-col items-center justify-center h-full text-gray-400\">\r\n                <FileText size={48} className=\"opacity-50 mb-4\" />\r\n                <p>No content available for this document.</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Footer */}\r\n          <div className=\"p-4 border-t border-slate-800 bg-slate-900/50\">\r\n            <div className=\"flex items-center justify-between text-xs text-gray-400\">\r\n              <span className=\"px-2 py-1 rounded bg-slate-800 uppercase\">\r\n                {document.type}\r\n              </span>\r\n              {highlightText && (\r\n                <span className=\"text-yellow-400\">\r\n                  Highlighted: \"{highlightText.slice(0, 50)}...\"\r\n                </span>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </motion.div>\r\n      </motion.div>\r\n    </AnimatePresence>\r\n  );\r\n}\r\n\r\n","import { aiEngine } from '../core/ai';\nimport { ipc } from '../lib/ipc-typed';\nimport type {\n  ResearchAgentAction,\n  ResearchAgentRequest,\n  ResearchAgentResponse,\n  ResearchAgentContext,\n} from '../types/researchAgent';\n\ntype AgentAskResult = {\n  answer?: string;\n  sources?: string[];\n  model?: string;\n};\n\nfunction buildDefaultActions(\n  summary: string,\n  citations: ResearchAgentResponse['citations']\n): ResearchAgentAction[] {\n  const actions: ResearchAgentAction[] = [];\n  if (summary.trim().length > 0) {\n    actions.push({\n      id: 'save-summary',\n      type: 'save_summary',\n      label: 'Save summary to notes',\n      description: 'Store these key takeaways in the current research session.',\n      payload: { summary },\n      badge: 'Recommended',\n    });\n  }\n\n  const topCitation = citations[0];\n  if (topCitation?.url) {\n    actions.push({\n      id: 'open-source',\n      type: 'open_url',\n      label: `Open ${topCitation.label}`,\n      description: 'Review the highest-confidence citation in a new tab.',\n      payload: { url: topCitation.url },\n    });\n  }\n\n  actions.push({\n    id: 'follow-up',\n    type: 'follow_up',\n    label: 'Ask a follow-up question',\n    description: 'Use the summary to draft a more specific research prompt.',\n    payload: {\n      prompt: `Give me 3 follow-up questions based on this summary:\\n${summary}`,\n    },\n  });\n\n  return actions;\n}\n\nfunction sanitizeContext(context: ResearchAgentContext): Record<string, unknown> {\n  if (!context) return {};\n  return Object.entries(context).reduce<Record<string, unknown>>((acc, [key, value]) => {\n    if (value !== undefined && value !== null && value !== '') {\n      acc[key] = value;\n    }\n    return acc;\n  }, {});\n}\n\nfunction coerceSources(sources?: unknown): string[] | undefined {\n  if (!Array.isArray(sources)) return undefined;\n  const normalized = sources\n    .map(item => {\n      if (typeof item === 'string') return item;\n      if (item && typeof item === 'object') {\n        const maybeUrl =\n          'url' in item && typeof (item as { url?: unknown }).url === 'string'\n            ? (item as { url: string }).url\n            : undefined;\n        const maybeLabel =\n          'label' in item && typeof (item as { label?: unknown }).label === 'string'\n            ? (item as { label: string }).label\n            : undefined;\n        return maybeUrl || maybeLabel;\n      }\n      return undefined;\n    })\n    .filter((value): value is string => Boolean(value));\n  return normalized.length ? normalized : undefined;\n}\n\nfunction normalizeResponse(\n  answer: string,\n  sources: string[] | undefined,\n  model?: string\n): ResearchAgentResponse {\n  const trimmed = answer.trim();\n  const citations =\n    sources?.map((source, index) => ({\n      label: source.replace(/^https?:\\/\\//, '').split('/')[0] || `Source ${index + 1}`,\n      url: source,\n    })) || [];\n\n  return {\n    summary: trimmed || 'No summary available.',\n    confidence: trimmed ? 0.78 : 0.4,\n    actions: buildDefaultActions(trimmed, citations),\n    citations,\n    model,\n  };\n}\n\nexport async function runResearchAgent(\n  request: ResearchAgentRequest\n): Promise<ResearchAgentResponse> {\n  const contextPayload = {\n    url: request.context.url,\n    text: request.context.selection || request.context.notes,\n  };\n\n  try {\n    const result = (await ipc.agent.ask(request.prompt, contextPayload)) as AgentAskResult;\n    if (!result || !result.answer) {\n      throw new Error('Agent returned an empty answer');\n    }\n    return normalizeResponse(result.answer, result.sources, result.model);\n  } catch (error) {\n    console.warn('[ResearchAgent] IPC agent failed, falling back to aiEngine', error);\n    const fallback = await aiEngine.runTask(\n      {\n        kind: 'agent',\n        prompt: request.prompt,\n        context: sanitizeContext(request.context),\n        mode: 'research',\n        llm: {\n          temperature: 0.2,\n          maxTokens: 600,\n        },\n      },\n      () => {}\n    );\n    return normalizeResponse(\n      fallback?.text || '',\n      coerceSources(fallback?.citations),\n      fallback?.model\n    );\n  }\n}\n\nexport async function executeResearchAgentAction(\n  action: ResearchAgentAction,\n  context: ResearchAgentContext\n): Promise<string | void> {\n  switch (action.type) {\n    case 'open_url': {\n      const targetUrl = action.payload?.url;\n      if (targetUrl) {\n        await ipc.tabs.create(targetUrl);\n      }\n      return;\n    }\n    case 'save_summary': {\n      const summary = action.payload?.summary;\n      if (!summary) return;\n      const targetUrl = context.url || 'about:blank';\n      await ipc.research.saveNotes(targetUrl, summary, []);\n      return;\n    }\n    case 'follow_up': {\n      return action.payload?.prompt;\n    }\n    default:\n      return;\n  }\n}\n","/**\n * Research Pane - Right-side panel for Research Mode\n * Provides query interface, streaming answers, and source cards\n */\n\nimport { useState, useCallback, useEffect, useRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  X,\n  Search,\n  Sparkles,\n  BookOpen,\n  FileText,\n  Upload,\n  Camera,\n  Loader2,\n  ExternalLink,\n  ClipboardList,\n  CheckCircle2,\n  // ChevronRight,\n} from 'lucide-react';\nimport { ipc } from '../../lib/ipc-typed';\nimport { useTabsStore } from '../../state/tabsStore';\nimport { useAppStore } from '../../state/appStore';\nimport { searchChunks, syncDocumentsFromBackend } from '../../lib/research/cache';\nimport { DocumentViewer } from './DocumentViewer';\nimport { ipcEvents } from '../../lib/ipc-events';\nimport { runResearchAgent, executeResearchAgentAction } from '../../services/researchAgent';\nimport type { ResearchAgentResponse, ResearchAgentAction } from '../../types/researchAgent';\nimport { showToast } from '../../state/toastStore';\n\ninterface SourceCard {\n  id: string;\n  title: string;\n  url: string;\n  snippet?: string;\n  type: 'tab' | 'pdf' | 'snapshot' | 'repo' | 'web';\n  confidence?: number;\n  publishedAt?: string;\n}\n\ninterface AnswerChunk {\n  content: string;\n  citations: string[];\n}\n\nconst AGENT_DEFAULT_PROMPT =\n  'Summarize this page and list 3 concrete follow-up actions for my research.';\n\nexport function ResearchPane() {\n  const [query, setQuery] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [answerChunks, setAnswerChunks] = useState<AnswerChunk[]>([]);\n  const [sources, setSources] = useState<SourceCard[]>([]);\n  const [activeSourceId, setActiveSourceId] = useState<string | null>(null);\n  const [isOpen, setIsOpen] = useState(false);\n  const [viewerDocument, setViewerDocument] = useState<{\n    id: string;\n    title: string;\n    url?: string;\n    type: 'tab' | 'pdf' | 'docx' | 'txt' | 'md' | 'html' | 'snapshot' | 'web';\n    snippet?: string;\n    content?: string;\n  } | null>(null);\n  const [viewerHighlight, setViewerHighlight] = useState<string | undefined>();\n  const { activeId, tabs } = useTabsStore();\n  const activeTab = tabs.find(tab => tab.id === activeId);\n  const streamChannelRef = useRef<string | null>(null);\n  const listenerRef = useRef<((event: any, payload: any) => void) | null>(null);\n  const agentPromptRef = useRef<HTMLTextAreaElement | null>(null);\n  const [agentPrompt, setAgentPrompt] = useState(AGENT_DEFAULT_PROMPT);\n  const [agentResponse, setAgentResponse] = useState<ResearchAgentResponse | null>(null);\n  const [agentLoading, setAgentLoading] = useState(false);\n  const [agentError, setAgentError] = useState<string | null>(null);\n  const [pendingActionId, setPendingActionId] = useState<string | null>(null);\n\n  // Check if Research Mode is active\n  const mode = useAppStore(s => s.mode);\n  const isResearchMode = mode === 'Research';\n\n  useEffect(() => {\n    // Auto-open when Research mode is active\n    if (isResearchMode && !isOpen) {\n      setIsOpen(true);\n    }\n  }, [isResearchMode, isOpen]);\n\n  // Sync documents from backend on mount\n  useEffect(() => {\n    if (isOpen) {\n      syncDocumentsFromBackend().catch(error => {\n        console.error('Failed to sync documents on mount:', error);\n      });\n    }\n  }, [isOpen]);\n\n  // Listen for keyboard shortcuts to open pane\n  useEffect(() => {\n    const handleKeyboardOpen = () => {\n      setIsOpen(true);\n    };\n\n    ipcEvents.on('research:keyboard-open-pane', handleKeyboardOpen);\n    return () => {\n      ipcEvents.off('research:keyboard-open-pane', handleKeyboardOpen);\n    };\n  }, []);\n\n  // Cleanup stream listener\n  useEffect(() => {\n    return () => {\n      if (streamChannelRef.current && listenerRef.current && window.ipc?.removeListener) {\n        window.ipc.removeListener(streamChannelRef.current, listenerRef.current);\n      }\n    };\n  }, []);\n\n  const handleQuery = useCallback(async () => {\n    if (!query.trim() || isLoading) return;\n\n    setIsLoading(true);\n    setAnswerChunks([]);\n    setSources([]);\n    setActiveSourceId(null);\n\n    try {\n      // First, try local cache search for instant results\n      const localResults = await searchChunks(query.trim(), 5);\n      if (localResults.length > 0) {\n        // Show local results immediately\n        const localSources: SourceCard[] = localResults.map(chunk => ({\n          id: chunk.id,\n          title: chunk.metadata.title || 'Cached Document',\n          url: chunk.metadata.url || '',\n          snippet: chunk.content.slice(0, 200) + '...',\n          type: (chunk.metadata.sourceType || 'web') as any,\n          confidence: 0.8, // High confidence for local matches\n        }));\n        setSources(localSources);\n      }\n\n      // Start research stream (server-side)\n      const { channel } = await ipc.researchStream.start(query.trim(), 'default');\n      streamChannelRef.current = channel;\n\n      if (window.ipc?.on) {\n        const listener = (_event: any, payload: any) => {\n          switch (payload?.type) {\n            case 'chunk':\n              setAnswerChunks(prev => [\n                ...prev,\n                { content: payload.content, citations: payload.citations || [] },\n              ]);\n              break;\n            case 'sources':\n              if (payload.entries) {\n                const sourceList: SourceCard[] = Object.entries(payload.entries).flatMap(\n                  ([citeId, cites]: [string, any]) =>\n                    (Array.isArray(cites) ? cites : []).map((cite: any) => ({\n                      id: cite.id || citeId,\n                      title: cite.title || 'Untitled',\n                      url: cite.url || cite.fragmentUrl || '',\n                      snippet: cite.snippet,\n                      type: 'web' as const,\n                      confidence: cite.relevanceScore,\n                      publishedAt: cite.publishedAt,\n                    }))\n                );\n                setSources(prev => {\n                  const existingIds = new Set(prev.map(s => s.id));\n                  const newSources = sourceList.filter(s => !existingIds.has(s.id));\n                  return [...prev, ...newSources];\n                });\n              }\n              break;\n            case 'complete':\n              setIsLoading(false);\n              break;\n            case 'error':\n              setIsLoading(false);\n              console.error('Research error:', payload.message);\n              break;\n          }\n        };\n        listenerRef.current = listener;\n        window.ipc.on(channel, listener);\n      }\n    } catch (error) {\n      setIsLoading(false);\n      console.error('Failed to start research:', error);\n    }\n  }, [query, isLoading]);\n\n  const handleSaveTabSnapshot = useCallback(async () => {\n    if (!activeTab?.id) return;\n\n    try {\n      const { snapshotId } = await ipc.research.saveSnapshot(activeTab.id);\n      console.log('Tab snapshot saved:', snapshotId);\n\n      // Sync to cache after a short delay (allowing backend processing)\n      setTimeout(async () => {\n        try {\n          await syncDocumentsFromBackend();\n        } catch (error) {\n          console.error('Failed to sync to cache:', error);\n        }\n      }, 2000);\n    } catch (error) {\n      console.error('Failed to save snapshot:', error);\n    }\n  }, [activeTab]);\n\n  const handleFileUpload = useCallback(async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    try {\n      const fileId = await ipc.research.uploadFile(file);\n      console.log('File uploaded:', fileId);\n\n      // Sync to cache after a short delay (allowing backend processing)\n      setTimeout(async () => {\n        try {\n          await syncDocumentsFromBackend();\n        } catch (error) {\n          console.error('Failed to sync to cache:', error);\n        }\n      }, 2000);\n\n      // Reset input\n      event.target.value = '';\n    } catch (error) {\n      console.error('Failed to upload file:', error);\n      event.target.value = '';\n    }\n  }, []);\n\n  const buildAgentContext = useCallback(() => {\n    let selection: string | undefined;\n    if (typeof window !== 'undefined' && window.getSelection) {\n      const rawSelection = window.getSelection()?.toString();\n      if (rawSelection) {\n        selection = rawSelection.slice(0, 2000);\n      }\n    }\n    return {\n      url: activeTab?.url || undefined,\n      title: activeTab?.title || undefined,\n      selection,\n      mode: 'research' as const,\n    };\n  }, [activeTab]);\n\n  const handleRunAgent = useCallback(async () => {\n    if (!agentPrompt.trim() || agentLoading) return;\n    setAgentLoading(true);\n    setAgentError(null);\n    try {\n      const context = buildAgentContext();\n      const response = await runResearchAgent({\n        prompt: agentPrompt.trim(),\n        context,\n        allowActions: true,\n      });\n      setAgentResponse(response);\n      showToast('success', 'Research Agent ready');\n      if (ipc.telemetry?.trackFeature) {\n        ipc.telemetry.trackFeature('research_agent', 'run').catch(() => {});\n      }\n    } catch (error) {\n      console.error('[ResearchPane] Research Agent failed:', error);\n      setAgentError(error instanceof Error ? error.message : 'Unable to run Research Agent.');\n      showToast('error', 'Research Agent failed');\n    } finally {\n      setAgentLoading(false);\n    }\n  }, [agentPrompt, agentLoading, buildAgentContext]);\n\n  const handleAgentAction = useCallback(\n    async (action: ResearchAgentAction) => {\n      setPendingActionId(action.id);\n      try {\n        const followUpPrompt = await executeResearchAgentAction(action, buildAgentContext());\n        if (followUpPrompt) {\n          setAgentPrompt(followUpPrompt);\n          requestAnimationFrame(() => agentPromptRef.current?.focus());\n        }\n        showToast(\n          'success',\n          action.type === 'follow_up' ? 'Drafted follow-up question' : 'Action executed'\n        );\n      } catch (error) {\n        console.error('[ResearchPane] Agent action failed:', error);\n        showToast('error', 'Failed to run action');\n      } finally {\n        setPendingActionId(null);\n      }\n    },\n    [buildAgentContext]\n  );\n\n  const handleOpenSource = useCallback(\n    async (url: string) => {\n      try {\n        if (activeId) {\n          await ipc.tabs.navigate(activeId, url);\n        } else {\n          await ipc.tabs.create(url);\n        }\n      } catch (error) {\n        console.error('Failed to open source:', error);\n      }\n    },\n    [activeId]\n  );\n\n  const handleViewDocument = useCallback(async (source: SourceCard, highlight?: string) => {\n    // Try to get full content from cache or backend\n    try {\n      // For now, use the snippet as content\n      // In a full implementation, we'd fetch the full document\n      setViewerDocument({\n        id: source.id,\n        title: source.title,\n        url: source.url,\n        type: source.type === 'repo' ? 'web' : source.type,\n        snippet: source.snippet,\n      });\n      setViewerHighlight(highlight);\n    } catch (error) {\n      console.error('Failed to load document:', error);\n    }\n  }, []);\n\n  if (!isOpen) {\n    return (\n      <button\n        onClick={() => setIsOpen(true)}\n        className=\"fixed right-4 top-20 z-50 rounded-full bg-blue-600 p-3 text-white shadow-lg transition-colors hover:bg-blue-700\"\n        title=\"Open Research Pane\"\n        aria-label=\"Open Research Pane\"\n      >\n        <BookOpen size={20} />\n      </button>\n    );\n  }\n\n  return (\n    <motion.div\n      initial={{ x: 400 }}\n      animate={{ x: 0 }}\n      exit={{ x: 400 }}\n      className=\"fixed right-0 top-0 z-50 flex h-full w-96 flex-col border-l border-slate-800 bg-slate-950 shadow-2xl\"\n      role=\"complementary\"\n      aria-label=\"Research Mode panel\"\n    >\n      {/* Header */}\n      <div className=\"flex items-center justify-between border-b border-slate-800 bg-slate-900 p-4\">\n        <div className=\"flex items-center gap-2\">\n          <Sparkles size={18} className=\"text-blue-400\" />\n          <h2 className=\"text-sm font-semibold text-gray-100\">Research Mode</h2>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <button\n            onClick={handleSaveTabSnapshot}\n            disabled={!activeTab}\n            className=\"rounded p-1.5 text-gray-400 transition-colors hover:bg-slate-800 hover:text-gray-200 disabled:cursor-not-allowed disabled:opacity-40\"\n            title=\"Save current tab snapshot\"\n          >\n            <Camera size={16} />\n          </button>\n          <label className=\"cursor-pointer rounded p-1.5 text-gray-400 transition-colors hover:bg-slate-800 hover:text-gray-200\">\n            <Upload size={16} />\n            <input\n              type=\"file\"\n              accept=\".pdf,.docx,.txt,.md\"\n              onChange={handleFileUpload}\n              className=\"hidden\"\n            />\n          </label>\n          <button\n            onClick={() => setIsOpen(false)}\n            className=\"rounded p-1.5 text-gray-400 transition-colors hover:bg-slate-800 hover:text-gray-200\"\n          >\n            <X size={16} />\n          </button>\n        </div>\n      </div>\n\n      {/* Query Bar */}\n      <div className=\"border-b border-slate-800 bg-slate-900/50 p-4\">\n        <form\n          aria-label=\"Research query form\"\n          onSubmit={e => {\n            e.preventDefault();\n            handleQuery();\n          }}\n          className=\"flex items-center gap-2\"\n        >\n          <div className=\"relative flex-1\">\n            <Search size={16} className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500\" />\n            <input\n              type=\"text\"\n              value={query}\n              onChange={e => setQuery(e.target.value)}\n              placeholder=\"Ask a research question...\"\n              className=\"w-full rounded-lg border border-slate-700 bg-slate-800 py-2 pl-10 pr-4 text-sm text-gray-100 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50\"\n              disabled={isLoading}\n              aria-label=\"Research question\"\n            />\n          </div>\n          <button\n            type=\"submit\"\n            disabled={isLoading || !query.trim()}\n            className=\"flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-blue-700 disabled:cursor-not-allowed disabled:bg-slate-700\"\n          >\n            {isLoading ? (\n              <>\n                <Loader2 size={14} className=\"animate-spin\" />\n                Searching...\n              </>\n            ) : (\n              <>\n                <Sparkles size={14} />\n                Search\n              </>\n            )}\n          </button>\n        </form>\n      </div>\n\n      {/* Content Area */}\n      <div className=\"flex-1 space-y-4 overflow-y-auto p-4\">\n        {/* Research Agent */}\n        <div\n          className=\"space-y-3 rounded-2xl border border-slate-800 bg-slate-900/60 p-4\"\n          role=\"region\"\n          aria-label=\"Research Agent\"\n        >\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2 text-sm font-semibold text-slate-200\">\n              <ClipboardList size={16} className=\"text-blue-400\" />\n              Research Agent\n            </div>\n            {agentResponse && (\n              <span className=\"text-xs text-slate-400\">\n                Confidence {(agentResponse.confidence * 100).toFixed(0)}%\n              </span>\n            )}\n          </div>\n          <textarea\n            id=\"research-pane-agent-prompt\"\n            name=\"research-agent-prompt\"\n            ref={agentPromptRef}\n            value={agentPrompt}\n            onChange={e => setAgentPrompt(e.target.value)}\n            rows={3}\n            className=\"w-full rounded-xl border border-slate-800 bg-slate-950/60 px-3 py-2 text-sm text-slate-100 placeholder:text-slate-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 disabled:opacity-60\"\n            placeholder=\"Ask the Research Agent to summarize, compare, or plan next steps...\"\n            aria-label=\"Research agent prompt\"\n            disabled={agentLoading}\n          />\n          <div className=\"flex items-center gap-2\">\n            <button\n              type=\"button\"\n              onClick={handleRunAgent}\n              disabled={agentLoading || !agentPrompt.trim()}\n              className=\"inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-blue-500 to-indigo-500 px-4 py-2 text-sm font-semibold text-white shadow-lg shadow-blue-900/30 transition hover:from-blue-400 hover:to-indigo-400 disabled:cursor-not-allowed disabled:opacity-60\"\n            >\n              {agentLoading ? (\n                <Loader2 size={16} className=\"animate-spin\" />\n              ) : (\n                <Sparkles size={16} />\n              )}\n              {agentLoading ? 'Running agent' : 'Run Research Agent'}\n            </button>\n            {agentResponse && (\n              <button\n                type=\"button\"\n                onClick={() => {\n                  setAgentResponse(null);\n                  setAgentError(null);\n                }}\n                className=\"rounded-lg border border-slate-800 px-3 py-2 text-xs font-medium text-slate-300 transition hover:border-slate-600 hover:text-slate-100\"\n              >\n                Clear\n              </button>\n            )}\n          </div>\n          {agentError && (\n            <div className=\"rounded-lg border border-rose-500/40 bg-rose-500/10 px-3 py-2 text-xs text-rose-200\">\n              {agentError}\n            </div>\n          )}\n          {agentResponse && (\n            <div className=\"space-y-3\">\n              <div className=\"rounded-xl border border-slate-800 bg-slate-950/60 p-3 text-sm text-slate-100\">\n                <p className=\"whitespace-pre-line leading-relaxed\">{agentResponse.summary}</p>\n                {agentResponse.citations.length > 0 && (\n                  <div className=\"mt-3 flex flex-wrap gap-2\">\n                    {agentResponse.citations.map(citation => (\n                      <a\n                        key={citation.url}\n                        href={citation.url}\n                        target=\"_blank\"\n                        rel=\"noreferrer\"\n                        className=\"inline-flex items-center gap-1 rounded-full border border-blue-500/40 px-2 py-0.5 text-[11px] text-blue-200 transition hover:border-blue-400 hover:text-white\"\n                      >\n                        <ExternalLink size={12} />\n                        {citation.label}\n                      </a>\n                    ))}\n                  </div>\n                )}\n              </div>\n              <div className=\"space-y-2\">\n                {agentResponse.actions.length === 0 && (\n                  <div\n                    className=\"rounded-lg border border-slate-800 bg-slate-950/50 px-3 py-2 text-xs text-slate-400\"\n                    role=\"status\"\n                    aria-live=\"polite\"\n                  >\n                    The agent did not recommend any actions for this query.\n                  </div>\n                )}\n                {agentResponse.actions.map(action => (\n                  <button\n                    key={action.id}\n                    type=\"button\"\n                    onClick={() => handleAgentAction(action)}\n                    disabled={pendingActionId === action.id}\n                    className=\"flex w-full items-center justify-between rounded-lg border border-slate-800 bg-slate-950/40 px-3 py-2 text-left text-sm text-slate-200 transition hover:border-blue-500/40 hover:bg-slate-900/70 disabled:cursor-wait disabled:opacity-60\"\n                  >\n                    <div>\n                      <div className=\"font-medium\">{action.label}</div>\n                      {action.description && (\n                        <div className=\"text-xs text-slate-400\">{action.description}</div>\n                      )}\n                      {action.badge && (\n                        <div className=\"mt-1 inline-flex rounded-full border border-emerald-500/30 bg-emerald-500/10 px-2 py-0.5 text-[10px] uppercase tracking-wide text-emerald-200\">\n                          {action.badge}\n                        </div>\n                      )}\n                    </div>\n                    {pendingActionId === action.id ? (\n                      <Loader2 size={16} className=\"animate-spin text-blue-400\" />\n                    ) : (\n                      <CheckCircle2 size={16} className=\"text-emerald-400\" />\n                    )}\n                  </button>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Streaming Answer */}\n        {answerChunks.length > 0 && (\n          <div className=\"space-y-3\" aria-live=\"polite\">\n            <h3 className=\"text-xs font-semibold uppercase tracking-wide text-gray-400\">Answer</h3>\n            <div className=\"space-y-3 rounded-lg border border-slate-800 bg-slate-900/50 p-4\">\n              {answerChunks.map((chunk, idx) => (\n                <div key={idx} className=\"text-sm leading-relaxed text-gray-200\">\n                  {chunk.content.split(/(\\[(\\d+)\\])/g).map((part, i) => {\n                    const citationMatch = part.match(/^\\[(\\d+)\\]$/);\n                    if (citationMatch) {\n                      const citeNum = citationMatch[1];\n                      const citedSource = sources.find((s, idx) => idx + 1 === parseInt(citeNum));\n                      return (\n                        <button\n                          key={i}\n                          onClick={() => {\n                            if (citedSource) {\n                              handleViewDocument(citedSource);\n                            }\n                          }}\n                          className=\"ml-1 inline-flex cursor-pointer items-center justify-center rounded-full border border-blue-500/40 bg-blue-500/15 px-1.5 py-0.5 text-[10px] text-blue-200 transition-colors hover:border-blue-400/60 hover:bg-blue-500/25\"\n                          title={\n                            citedSource\n                              ? `View source: ${citedSource.title}`\n                              : `Citation ${citeNum}`\n                          }\n                        >\n                          [{citeNum}]\n                        </button>\n                      );\n                    }\n                    return <span key={i}>{part}</span>;\n                  })}\n                </div>\n              ))}\n              {isLoading && (\n                <div className=\"flex items-center gap-2 text-xs text-gray-400\">\n                  <Loader2 size={12} className=\"animate-spin\" />\n                  Streaming answer...\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {/* Sources */}\n        {sources.length > 0 && (\n          <div className=\"space-y-3\">\n            <h3 className=\"text-xs font-semibold uppercase tracking-wide text-gray-400\">\n              Sources ({sources.length})\n            </h3>\n            <div className=\"space-y-2\">\n              <AnimatePresence>\n                {sources.map(source => (\n                  <motion.div\n                    key={source.id}\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    exit={{ opacity: 0 }}\n                    className={`cursor-pointer space-y-2 rounded-lg border p-3 transition-colors ${\n                      activeSourceId === source.id\n                        ? 'border-blue-500/60 bg-blue-500/10'\n                        : 'border-slate-800 bg-slate-900/50 hover:border-slate-700'\n                    }`}\n                    role=\"button\"\n                    tabIndex={0}\n                    aria-pressed={activeSourceId === source.id}\n                    onClick={() =>\n                      setActiveSourceId(activeSourceId === source.id ? null : source.id)\n                    }\n                    onKeyDown={e => {\n                      if (e.key === 'Enter' || e.key === ' ') {\n                        e.preventDefault();\n                        setActiveSourceId(activeSourceId === source.id ? null : source.id);\n                      }\n                    }}\n                  >\n                    <div className=\"flex items-start justify-between gap-2\">\n                      <div className=\"min-w-0 flex-1\">\n                        <div className=\"mb-1 flex items-center gap-2\">\n                          <span className=\"rounded bg-slate-800 px-1.5 py-0.5 text-[10px] uppercase text-gray-400\">\n                            {source.type}\n                          </span>\n                          {source.confidence && (\n                            <span className=\"text-[10px] text-gray-500\">\n                              {Math.round(source.confidence * 100)}% match\n                            </span>\n                          )}\n                        </div>\n                        <h4 className=\"truncate text-sm font-medium text-gray-200\">\n                          {source.title}\n                        </h4>\n                        {source.snippet && (\n                          <p className=\"mt-1 line-clamp-2 text-xs text-gray-400\">\n                            {source.snippet}\n                          </p>\n                        )}\n                        <p className=\"mt-1 truncate text-[10px] text-gray-500\">{source.url}</p>\n                      </div>\n                      <div className=\"flex items-center gap-1\">\n                        <button\n                          onClick={e => {\n                            e.stopPropagation();\n                            handleViewDocument(source, source.snippet);\n                          }}\n                          className=\"rounded p-1.5 text-gray-400 transition-colors hover:bg-slate-800 hover:text-gray-200\"\n                          title=\"View document\"\n                        >\n                          <FileText size={14} />\n                        </button>\n                        {source.url && (\n                          <button\n                            onClick={e => {\n                              e.stopPropagation();\n                              handleOpenSource(source.url);\n                            }}\n                            className=\"rounded p-1.5 text-gray-400 transition-colors hover:bg-slate-800 hover:text-gray-200\"\n                            title=\"Open in tab\"\n                          >\n                            <ExternalLink size={14} />\n                          </button>\n                        )}\n                      </div>\n                    </div>\n                  </motion.div>\n                ))}\n              </AnimatePresence>\n            </div>\n          </div>\n        )}\n\n        {/* Empty State */}\n        {!isLoading && answerChunks.length === 0 && sources.length === 0 && (\n          <div className=\"flex h-full flex-col items-center justify-center space-y-3 text-center text-gray-500\">\n            <BookOpen size={48} className=\"opacity-50\" />\n            <div>\n              <p className=\"text-sm font-medium text-gray-400\">Start researching</p>\n              <p className=\"mt-1 text-xs text-gray-500\">\n                Ask a question or save a tab snapshot to begin\n              </p>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Document Viewer */}\n      {viewerDocument && (\n        <DocumentViewer\n          isOpen={!!viewerDocument}\n          onClose={() => {\n            setViewerDocument(null);\n            setViewerHighlight(undefined);\n          }}\n          document={viewerDocument}\n          highlightText={viewerHighlight}\n        />\n      )}\n    </motion.div>\n  );\n}\n","/**\r\n * Weather Card Component\r\n * Shows live weather data with Hindi support\r\n */\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Cloud, Sun, Droplets, Wind, X } from 'lucide-react';\r\n\r\ninterface WeatherData {\r\n  city: string;\r\n  temp: string;\r\n  feels: string;\r\n  desc: string;\r\n  humidity: number;\r\n  wind: string;\r\n  source: string;\r\n}\r\n\r\nexport function WeatherCard() {\r\n  const [weather, setWeather] = useState<WeatherData | null>(null);\r\n  const [isVisible, setIsVisible] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // Listen for weather updates\r\n    const handleWeatherUpdate = (event: CustomEvent) => {\r\n      setWeather(event.detail);\r\n      setIsVisible(true);\r\n      \r\n      // Auto-hide after 15 seconds\r\n      setTimeout(() => {\r\n        setIsVisible(false);\r\n      }, 15000);\r\n    };\r\n\r\n    window.addEventListener('weather-update', handleWeatherUpdate as EventListener);\r\n    \r\n    // Also listen for Tauri events\r\n    if (typeof window !== 'undefined' && (window as any).__TAURI__) {\r\n      const { listen } = require('@tauri-apps/api/event');\r\n      listen('weather-update', (event: any) => {\r\n        setWeather(event.payload);\r\n        setIsVisible(true);\r\n        setTimeout(() => setIsVisible(false), 15000);\r\n      });\r\n    }\r\n\r\n    return () => {\r\n      window.removeEventListener('weather-update', handleWeatherUpdate as EventListener);\r\n    };\r\n  }, []);\r\n\r\n  if (!weather || !isVisible) return null;\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      <motion.div\r\n        initial={{ opacity: 0, y: -20 }}\r\n        animate={{ opacity: 1, y: 0 }}\r\n        exit={{ opacity: 0, y: -20 }}\r\n        className=\"fixed top-20 right-5 bg-gradient-to-br from-purple-900 to-blue-900 p-6 rounded-2xl text-white shadow-2xl border border-purple-500 max-w-sm z-50\"\r\n      >\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h3 className=\"text-2xl font-bold\">{weather.city}</h3>\r\n          <button\r\n            onClick={() => setIsVisible(false)}\r\n            className=\"text-gray-400 hover:text-white transition-colors\"\r\n          >\r\n            <X className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"text-5xl my-2 font-bold\">{weather.temp}</div>\r\n        <div className=\"text-lg text-gray-300 mb-2\">Feels like {weather.feels}</div>\r\n        \r\n        <div className=\"capitalize text-xl mb-4 flex items-center gap-2\">\r\n          {weather.desc.includes('rain') || weather.desc.includes('') ? (\r\n            <Droplets className=\"w-5 h-5\" />\r\n          ) : weather.desc.includes('cloud') || weather.desc.includes('') ? (\r\n            <Cloud className=\"w-5 h-5\" />\r\n          ) : (\r\n            <Sun className=\"w-5 h-5\" />\r\n          )}\r\n          {weather.desc}\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-2 gap-4 mt-4 text-sm\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <Droplets className=\"w-4 h-4\" />\r\n            <span>Humidity: {weather.humidity}%</span>\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Wind className=\"w-4 h-4\" />\r\n            <span>Wind: {weather.wind} km/h</span>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"text-xs mt-3 opacity-70 text-center\">\r\n          Source: {weather.source === 'live' ? 'Live API' : 'Cached data'}\r\n        </div>\r\n      </motion.div>\r\n    </AnimatePresence>\r\n  );\r\n}\r\n\r\n","/**\r\n * Flight Card Component\r\n * Shows flight booking details with round-trip support\r\n */\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Plane, X, ArrowRight } from 'lucide-react';\r\nimport { toast } from '../utils/toast';\r\n\r\ninterface FlightData {\r\n  from: string;\r\n  to: string;\r\n  type: string;\r\n  depart: string;\r\n  return: string;\r\n  price: string;\r\n  airline: string;\r\n  source: string;\r\n}\r\n\r\nexport function FlightCard() {\r\n  const [flight, setFlight] = useState<FlightData | null>(null);\r\n  const [isVisible, setIsVisible] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const handleFlightCard = (event: CustomEvent) => {\r\n      setFlight(event.detail);\r\n      setIsVisible(true);\r\n      setTimeout(() => setIsVisible(false), 20000);\r\n    };\r\n\r\n    window.addEventListener('flight-card', handleFlightCard as EventListener);\r\n    \r\n    if (typeof window !== 'undefined' && (window as any).__TAURI__) {\r\n      // Dynamic import to avoid Vite dependency scan errors\r\n      import('@tauri-apps/api/event')\r\n        .then(({ listen }) => {\r\n          listen('flight-card', (event: any) => {\r\n            setFlight(event.payload);\r\n            setIsVisible(true);\r\n            setTimeout(() => setIsVisible(false), 20000);\r\n          });\r\n        })\r\n        .catch(() => {\r\n          // Silently fail if Tauri API is not available\r\n        });\r\n    }\r\n\r\n    return () => {\r\n      window.removeEventListener('flight-card', handleFlightCard as EventListener);\r\n    };\r\n  }, []);\r\n\r\n  if (!flight || !isVisible) return null;\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      <motion.div\r\n        initial={{ opacity: 0, scale: 0.9 }}\r\n        animate={{ opacity: 1, scale: 1 }}\r\n        exit={{ opacity: 0, scale: 0.9 }}\r\n        className=\"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-gradient-to-r from-indigo-900 to-purple-900 p-8 rounded-2xl text-white shadow-2xl border border-purple-500 max-w-md z-50\"\r\n      >\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <div className=\"text-center flex-1\">\r\n            <div className=\"text-2xl font-bold flex items-center justify-center gap-2\">\r\n              {flight.from} <ArrowRight className=\"w-5 h-5\" /> {flight.to}\r\n            </div>\r\n            <div className=\"text-sm text-gray-300 mt-1\">{flight.type}</div>\r\n          </div>\r\n          <button\r\n            onClick={() => setIsVisible(false)}\r\n            className=\"text-gray-400 hover:text-white transition-colors\"\r\n          >\r\n            <X className=\"w-5 h-5\" />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"text-center text-5xl my-4 font-bold\">{flight.price}</div>\r\n        \r\n        <div className=\"text-center text-lg mb-2\">\r\n          <div>Out: {flight.depart}</div>\r\n          {flight.return !== '' && <div>Return: {flight.return}</div>}\r\n        </div>\r\n\r\n        <div className=\"text-center text-xl mb-4 flex items-center justify-center gap-2\">\r\n          <Plane className=\"w-5 h-5\" />\r\n          {flight.airline}\r\n        </div>\r\n\r\n        <button\r\n          onClick={() => {\r\n            // Focus iframe if it exists\r\n            const iframe = document.querySelector('iframe');\r\n            if (iframe) {\r\n              iframe.focus();\r\n              toast.info('Click in the booking window to proceed to payment');\r\n            }\r\n          }}\r\n          className=\"mt-4 w-full bg-green-500 hover:bg-green-600 px-8 py-3 rounded-full text-xl font-bold transition-colors\"\r\n        >\r\n          Go to Payment\r\n        </button>\r\n\r\n        <div className=\"text-xs text-center mt-3 opacity-70\">\r\n          Source: {flight.source === 'live' ? 'Live prices' : 'Cached data'}\r\n        </div>\r\n      </motion.div>\r\n    </AnimatePresence>\r\n  );\r\n}\r\n\r\n","import { useEffect, useState, Suspense, lazy } from 'react';\r\nimport { useAppStore } from '../state/appStore';\r\nimport { ipcEvents } from '../lib/ipc-events';\r\nimport { OmniDesk } from '../components/OmniDesk';\r\nimport { ResearchPane } from '../components/research/ResearchPane';\r\nimport { Loader2 } from 'lucide-react';\r\nimport { ErrorBoundary } from '../core/errors/ErrorBoundary';\r\nimport { WeatherCard } from '../components/WeatherCard';\r\nimport { FlightCard } from '../components/FlightCard';\r\n\r\n// Tier 3: Load all enabled modes with error handling\r\nconst ResearchPanel = lazy(() => import('../modes/research'));\r\nconst TradePanel = lazy(() => import('../modes/trade'));\r\nconst DocumentMode = lazy(() =>\r\n  import('../modes/docs/DocumentMode').then(m => ({ default: m.DocumentMode }))\r\n);\r\nconst ThreatsPanel = lazy(() => import('../modes/threats'));\r\n\r\n// Enhanced loading fallback with skeleton loader\r\nconst ModeLoadingFallback = () => (\r\n  <div className=\"flex flex-col items-center justify-center h-full w-full p-8\">\r\n    <div className=\"flex items-center gap-3 mb-4\">\r\n      <Loader2 className=\"w-5 h-5 animate-spin text-emerald-400\" />\r\n      <span className=\"text-sm text-gray-400\">Loading mode...</span>\r\n    </div>\r\n    {/* Skeleton loader */}\r\n    <div className=\"w-full max-w-2xl space-y-4 animate-pulse\">\r\n      <div className=\"h-4 bg-gray-800 rounded w-3/4\"></div>\r\n      <div className=\"h-4 bg-gray-800 rounded w-1/2\"></div>\r\n      <div className=\"h-32 bg-gray-800 rounded\"></div>\r\n      <div className=\"h-4 bg-gray-800 rounded w-5/6\"></div>\r\n    </div>\r\n  </div>\r\n);\r\n\r\nexport default function Home() {\r\n  const mode = useAppStore(s => s.mode);\r\n  const [isFullscreen, setIsFullscreen] = useState(false);\r\n\r\n  // Initialize fullscreen state on mount - ensure it starts as false\r\n  useEffect(() => {\r\n    // Force initial state to false (window should not start in fullscreen)\r\n    setIsFullscreen(false);\r\n\r\n    // Check initial fullscreen state after a brief delay\r\n    const checkFullscreen = () => {\r\n      const isCurrentlyFullscreen = !!(\r\n        document.fullscreenElement ||\r\n        (window as any).webkitFullscreenElement ||\r\n        (window as any).mozFullScreenElement\r\n      );\r\n      if (isCurrentlyFullscreen !== isFullscreen) {\r\n        setIsFullscreen(isCurrentlyFullscreen);\r\n      }\r\n    };\r\n\r\n    // Check after a brief delay to ensure window is ready\r\n    const timeoutId = setTimeout(checkFullscreen, 100);\r\n\r\n    // Listen for fullscreen changes from Electron\r\n    const handleFullscreen = (data: { fullscreen: boolean }) => {\r\n      setIsFullscreen(data.fullscreen);\r\n    };\r\n\r\n    // Use the IPC event bus\r\n    const unsubscribe = ipcEvents.on<{ fullscreen: boolean }>(\r\n      'app:fullscreen-changed',\r\n      handleFullscreen\r\n    );\r\n\r\n    // Also listen for browser fullscreen changes\r\n    document.addEventListener('fullscreenchange', checkFullscreen);\r\n    document.addEventListener('webkitfullscreenchange', checkFullscreen);\r\n    document.addEventListener('mozfullscreenchange', checkFullscreen);\r\n\r\n    return () => {\r\n      clearTimeout(timeoutId);\r\n      unsubscribe();\r\n      document.removeEventListener('fullscreenchange', checkFullscreen);\r\n      document.removeEventListener('webkitfullscreenchange', checkFullscreen);\r\n      document.removeEventListener('mozfullscreenchange', checkFullscreen);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div\r\n      className={`h-full w-full bg-[#1A1D28] flex flex-col overflow-hidden ${isFullscreen ? 'absolute inset-0' : ''}`}\r\n    >\r\n      {mode === 'Browse' || !mode ? (\r\n        <div className=\"flex-1 w-full relative min-h-0 overflow-hidden\">\r\n          {/* Browser content is handled by AppShell via TabContentSurface */}\r\n          {/* Show OmniDesk when no tabs or active tab is about:blank (search page) */}\r\n          {/* OmniDesk will handle its own visibility logic */}\r\n          {/* z-20 is below TabStrip (z-50) to ensure tabs are always clickable */}\r\n          <div className=\"absolute inset-0 z-20 pointer-events-none\">\r\n            <div className=\"pointer-events-auto h-full w-full overflow-hidden\">\r\n              <OmniDesk variant=\"overlay\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : mode === 'Research' ? (\r\n        <div className=\"flex-1 w-full relative flex flex-col min-h-0 overflow-hidden\">\r\n          {/* Research Panel - Full height, no browser view, no tabs, pure AI interface */}\r\n          <ErrorBoundary componentName=\"ResearchPanel\" retryable={true}>\r\n            <Suspense fallback={<ModeLoadingFallback />}>\r\n              <ResearchPanel />\r\n            </Suspense>\r\n          </ErrorBoundary>\r\n        </div>\r\n      ) : mode === 'Trade' ? (\r\n        <div className=\"flex-1 w-full relative flex flex-col min-h-0 overflow-hidden\">\r\n          <ErrorBoundary componentName=\"TradePanel\" retryable={true}>\r\n            <Suspense fallback={<ModeLoadingFallback />}>\r\n              <TradePanel />\r\n            </Suspense>\r\n          </ErrorBoundary>\r\n        </div>\r\n      ) : mode === 'Docs' ? (\r\n        <div className=\"flex-1 w-full relative flex flex-col min-h-0 overflow-hidden\">\r\n          <ErrorBoundary componentName=\"DocumentMode\" retryable={true}>\r\n            <Suspense fallback={<ModeLoadingFallback />}>\r\n              <DocumentMode />\r\n            </Suspense>\r\n          </ErrorBoundary>\r\n        </div>\r\n      ) : mode === 'Threats' ? (\r\n        <div className=\"flex-1 w-full relative flex flex-col min-h-0 overflow-hidden\">\r\n          <ErrorBoundary componentName=\"ThreatsPanel\" retryable={true}>\r\n            <Suspense fallback={<ModeLoadingFallback />}>\r\n              <ThreatsPanel />\r\n            </Suspense>\r\n          </ErrorBoundary>\r\n        </div>\r\n      ) : (\r\n        // Show \"Coming Soon\" placeholder for disabled modes\r\n        <div className=\"flex-1 w-full flex items-center justify-center bg-[#1A1D28]\">\r\n          <div className=\"text-center space-y-4\">\r\n            <h2 className=\"text-2xl font-semibold text-gray-300\">{mode} Mode</h2>\r\n            <p className=\"text-gray-500\">Coming Soon</p>\r\n            <p className=\"text-sm text-gray-600 max-w-md\">\r\n              This mode is under development. Switch to Research mode to get started with AI-powered\r\n              browsing.\r\n            </p>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Research Pane - Available in all modes except Research (which has its own panel) */}\r\n      {!isFullscreen && mode !== 'Research' && <ResearchPane />}\r\n\r\n      {/* Weather Card - Shows when weather command is executed */}\r\n      <WeatherCard />\r\n\r\n      {/* Flight Card - Shows when flight booking is initiated */}\r\n      <FlightCard />\r\n    </div>\r\n  );\r\n}\r\n"],"file":"Home-l_WNGaND.js"}