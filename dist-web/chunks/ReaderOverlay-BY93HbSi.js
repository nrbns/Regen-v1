const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/core-ai-yFIunLTZ.js","chunks/vendor-zustand-BWsgwsXr.js","chunks/vendor-react-gmX1Lmvt.js","chunks/vendor-react-dom-Bkb6jJ_S.js","chunks/vendor-Vl2WtvH-.js","chunks/mode-manager.ts-DwguZmJt.js","chunks/core-memory-DmK-uh9X.js"])))=>i.map(i=>d[i]);
import{a as G,i as j,_ as L}from"./core-ai-yFIunLTZ.js";import{r as i,j as e,a2 as V,g as v,D as B,S as A,X as H,R as J,t as Q,c3 as W,E as X}from"./vendor-react-gmX1Lmvt.js";import{A as Y,m as S}from"./vendor-framer-motion-DDE19Uim.js";import"./vendor-zustand-BWsgwsXr.js";import"./vendor-Vl2WtvH-.js";import"./mode-manager.ts-DwguZmJt.js";import"./core-memory-DmK-uh9X.js";import"./vendor-react-dom-Bkb6jJ_S.js";function ie({active:n,onClose:w,tabId:c,url:p}){const[r,C]=i.useState(null),[M,z]=i.useState(!1),[E,y]=i.useState(null),[k,h]=i.useState([]),[g,f]=i.useState(null),[u,P]=i.useState(!1),[N,b]=i.useState(null),[R,_]=i.useState(!1),[$,d]=i.useState(null),T=G(),s=i.useMemo(()=>T.tabs.find(t=>t.id===c),[T.tabs,c]);i.useEffect(()=>{if(!n){C(null),h([]),f(null),b(null),d(null);return}if(!c){y("No active tab to read.");return}(async()=>{z(!0),y(null),h([]),f(null),b(null);try{let a;try{if(c&&typeof window<"u"&&window.ipc)try{a=await j.research.extractContent(c)}catch(m){console.warn("[ReaderOverlay] IPC extractContent failed, trying Redix fallback:",m);const x="http://localhost:8001";try{const o=await fetch(`${x}/extract`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:s?.url||p,tabId:c})}).catch(()=>null);if(o?.ok){const l=await o.json();(l.title||l.content)&&(a={title:l.title||s?.title,content:l.content||l.text,html:l.html||`<h1>${l.title}</h1><p>${l.content}</p>`})}}catch(o){console.debug("[ReaderOverlay] Redix extract also failed:",o)}}}catch{}if(!a&&typeof window<"u"&&window.document)try{const{extractPageContent:m}=await L(async()=>{const{extractPageContent:o}=await import("./pageExtractor-ZG_aqhIg.js");return{extractPageContent:o}},[]),x=m(window.document,s?.url||p||void 0);a={title:x.title,content:x.mainContent,html:`<h1>${x.title}</h1>
<p>${x.mainContent}</p>`}}catch(m){console.warn("[ReaderOverlay] Page extractor fallback failed:",m)}if(!a&&s&&(a={title:s.title||"Reader View",content:`Content from: ${s.url||"Current page"}

Unable to extract readable content. Please ensure the page has loaded completely.`,html:`<h1>${s.title||"Reader View"}</h1>
<p>Content from: <a href="${s.url}">${s.url}</a></p>
<p>Unable to extract readable content. Please ensure the page has loaded completely.</p>`}),!a||!a.content&&!a.html){y("Unable to extract article content for this page. The page may not have readable content, or it may still be loading.");return}C({title:a.title||s?.title||s?.url||"Reader View",html:a.html||`<p>${q(a.content)}</p>`,content:a.content||"",url:s?.url||p||void 0})}catch(a){console.error("Failed to load reader content:",a),y("Failed to load reader view for this page. Please try again or ensure the page has loaded.")}finally{z(!1)}})()},[n,c,s,p]);const O=async()=>{if(r?.content){P(!0),b(null),d(null);try{try{const{sendPrompt:a}=await L(async()=>{const{sendPrompt:l}=await import("./core-ai-yFIunLTZ.js").then(U=>U.W);return{sendPrompt:l}},__vite__mapDeps([0,1,2,3,4,5,6])),m=`Summarize the following article in 3-5 bullet points:

Title: ${r.title}

${r.content}`,o=(await a(m,{systemPrompt:"You are a helpful assistant that creates concise summaries of web articles.",maxTokens:300})).text.split(/\n/).filter(l=>l.trim().match(/^[-•*]\s|^\d+\.\s/)).map(l=>({summary:l.replace(/^[-•*]\s|^\d+\.\s/,"").trim(),citation:{text:r.title,url:r.url}}));if(o.length>0){h(o),f("cloud");return}}catch{}const t=await j.reader.summarize({url:r.url,title:r.title,content:r.content,html:r.html});h(t.bullets),f(t.mode)}catch(t){console.error("Failed to summarize article:",t),b("Summarization failed. Try again or check AI settings.")}finally{P(!1)}}},D=async()=>{if(r?.html){_(!0),d(null);try{const t=await j.reader.export({url:r.url,title:r.title,html:r.html});t?.success?d(`Saved clean copy to ${t.path}`):d("Export failed. Please try again.")}catch(t){console.error("Failed to export reader view:",t),d("Export failed. Please try again.")}finally{_(!1)}}},F=t=>{t&&(j.tabs.create({url:t,mode:"normal"}).catch(console.error),w())};return n?e.jsx(Y,{children:n&&e.jsxs(e.Fragment,{children:[e.jsx(S.div,{initial:{opacity:0},animate:{opacity:.6},exit:{opacity:0},className:"fixed inset-0 z-[70] bg-gray-950",onClick:w}),e.jsxs(S.div,{initial:{opacity:0,y:32},animate:{opacity:1,y:0},exit:{opacity:0,y:32},transition:{duration:.18},className:"fixed inset-8 z-[80] rounded-2xl border border-gray-800/70 bg-[#0B1120]/98 shadow-2xl backdrop-blur-xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-800/60 bg-gray-900/40",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl bg-blue-500/20 border border-blue-500/30",children:e.jsx(V,{size:20,className:"text-blue-200"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-100",children:r?.title||s?.title||"Reader"}),e.jsx("div",{className:"text-xs text-gray-500",children:r?.url?K(r.url):s?.url})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:D,disabled:!r?.html||R,className:"flex items-center gap-2 px-3 py-2 text-sm rounded-lg border border-gray-700/60 bg-gray-800/50 hover:bg-gray-800/70 text-gray-200 disabled:opacity-60 disabled:cursor-not-allowed transition-colors",children:[R?e.jsx(v,{size:16,className:"animate-spin"}):e.jsx(B,{size:16}),"Export clean view"]}),e.jsxs("button",{onClick:()=>void O(),disabled:!r?.content||u,className:"flex items-center gap-2 px-3 py-2 text-sm rounded-lg bg-blue-600/70 hover:bg-blue-600 text-blue-50 border border-blue-500/40 disabled:opacity-60 disabled:cursor-not-allowed transition-colors",children:[u?e.jsx(v,{size:16,className:"animate-spin"}):e.jsx(A,{size:16}),"Cite-preserving summary"]}),e.jsx("button",{onClick:w,className:"p-2 rounded-lg hover:bg-gray-800/60 text-gray-400 hover:text-gray-200 transition-colors",title:"Close reader",children:e.jsx(H,{size:18})})]})]}),$&&e.jsxs("div",{className:"px-6 py-3 bg-emerald-500/10 border-b border-emerald-500/20 text-sm text-emerald-200 flex items-center justify-between",children:[e.jsx("span",{children:$}),e.jsx("button",{onClick:()=>d(null),className:"text-emerald-300 hover:text-emerald-100",children:"Dismiss"})]}),E?e.jsx("div",{className:"flex-1 flex items-center justify-center text-sm text-red-300 bg-red-500/10",children:E}):e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-[2fr_1fr] overflow-hidden",children:[e.jsxs("div",{className:"relative overflow-y-auto",children:[M&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-950/60 backdrop-blur-sm z-10",children:e.jsx(v,{size:32,className:"text-blue-400 animate-spin"})}),e.jsx("div",{className:"prose prose-invert max-w-none px-8 py-6",children:r?e.jsx("div",{className:"reader-article",dangerouslySetInnerHTML:{__html:r.html}}):e.jsx("div",{className:"text-center text-gray-500 text-sm py-12",children:"Preparing clean article view…"})})]}),e.jsxs("aside",{className:"border-l border-gray-800/60 bg-gray-900/30 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-800/50",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-100 flex items-center gap-2",children:[e.jsx(A,{size:16,className:"text-blue-300"}),"Summary with citations"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[g==="local"&&"Generated locally (GGUF)",g==="cloud"&&"Generated via cloud model (with consent)",g==="extractive"&&"Extractive summary from source paragraphs",!g&&"Click summarize to generate key bullet points"]})]}),e.jsx("button",{onClick:()=>void O(),disabled:!r?.content||u,className:"p-2 rounded-lg border border-gray-700/50 text-gray-300 hover:text-gray-100 hover:bg-gray-800/60 disabled:opacity-50",title:"Refresh summary",children:e.jsx(J,{size:16,className:u?"animate-spin":""})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-4 space-y-4",children:[u&&e.jsxs("div",{className:"flex items-center justify-center h-full text-sm text-gray-400 gap-2",children:[e.jsx(v,{size:18,className:"animate-spin"}),"Generating summary…"]}),N&&e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-yellow-500/40 bg-yellow-500/10 text-yellow-200 px-3 py-2 text-sm",children:[e.jsx(Q,{size:16}),N]}),!u&&!N&&k.length===0&&e.jsxs("div",{className:"text-sm text-gray-500",children:["The summary will include direct citations from the article to preserve attribution. Click"," ",e.jsx("span",{className:"text-blue-400",children:"“Cite-preserving summary”"})," to begin."]}),k.map((t,a)=>e.jsxs(S.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},className:"rounded-xl border border-gray-700/50 bg-gray-900/50 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-3 text-gray-100",children:[e.jsx("div",{className:"flex items-center justify-center h-6 w-6 rounded-full bg-blue-500/20 border border-blue-500/40 text-xs text-blue-200",children:a+1}),e.jsx("p",{className:"text-sm leading-relaxed",children:t.summary})]}),t.citation&&e.jsxs("button",{onClick:()=>F(t.citation?.url),className:"mt-3 flex w-full items-start gap-2 rounded-lg bg-gray-900/70 border border-gray-800/70 px-3 py-2 text-xs text-gray-400 hover:text-gray-200 hover:border-gray-700 transition-colors text-left",children:[e.jsx(W,{size:14,className:"flex-shrink-0 text-gray-500"}),e.jsx("span",{className:"flex-1",children:t.citation.text.length>220?`${t.citation.text.slice(0,220)}…`:t.citation.text}),t.citation.url&&e.jsx(X,{size:12,className:"text-gray-500"})]})]},`${t.summary}-${a}`))]})]})]})]})]})}):null}function q(n){return n.replace(/[<>]/g,"").replace(/\s+/g," ")}function K(n){try{return new URL(n).hostname}catch{return n}}export{ie as ReaderOverlay};
//# sourceMappingURL=ReaderOverlay-BY93HbSi.js.map
