import{i as p,d as u}from"./core-ai-yFIunLTZ.js";import{a as l}from"./AppShell-CJtR0Pw4.js";import"./vendor-zustand-BWsgwsXr.js";import"./vendor-react-gmX1Lmvt.js";import"./vendor-react-dom-Bkb6jJ_S.js";import"./vendor-Vl2WtvH-.js";import"./mode-manager.ts-DwguZmJt.js";import"./core-memory-DmK-uh9X.js";import"../assets/index-D9cF9G1U.js";import"./mode-research-BclgCwOH.js";import"./vendor-utils-5Vdoy44w.js";import"./mode-docs-FcsoolLb.js";import"./vendor-pdf-ejcqEZLU.js";import"./vendor-mammoth-BPQIafDs.js";import"./vendor-framer-motion-DDE19Uim.js";import"@tauri-apps/api/core";import"./History-kg0LrAO3.js";import"./Downloads-CU-ngJEB.js";import"./OmniDesk-C5fSodZ1.js";import"./WorkspacesPanel-3geKynW_.js";import"./bookmarksStore-CAScveEF.js";import"./workspacesStore-BSqEl-CQ.js";import"./tradeStore-CHfkU4NA.js";import"./dataService-HUHZrGu9.js";import"./registry-CG5fPtjR.js";import"./trustDashboardStore-BRaGSCcb.js";let d=!1,c=null;function N(){d||(d=!0,M().catch(()=>{}),c=setInterval(()=>M().catch(()=>{}),2e4),window.addEventListener("beforeunload",()=>{c&&clearInterval(c)},{once:!0}))}async function M(){if(!(!p?.tabs?.getAllMetrics||!p?.tabs?.list))try{const[e,n]=await Promise.all([p.tabs.getAllMetrics(),p.tabs.list()]),o=Date.now(),a=n.map(i=>{const s=e?.[i.id];return{tabId:i.id,title:i.title,url:i.url,memoryMB:s?.memoryMB??0,timestamp:o,pinned:i.pinned,appMode:i.appMode,sleeping:i.sleeping}}),m=a.reduce((i,s)=>i+s.memoryMB,0),t=typeof navigator<"u"&&"deviceMemory"in navigator?navigator.deviceMemory*1024:void 0,r={totalMB:m,timestamp:o,tabs:a,savingsMB:g(a),freeMB:t?Math.max(0,t-m):void 0};l.getState().pushSnapshot(r),t&&l.getState().setCapacity(t),u({type:"redix:memory:snapshot",payload:{totalMB:r.totalMB,timestamp:o}})}catch(e){console.warn("[MemoryManager] Failed to capture snapshot",e)}}function g(e){if(!e.length)return;const n=e.filter(t=>t.sleeping);if(!n.length)return 0;const o=e.filter(t=>!t.sleeping),a=o.length>0?o.reduce((t,r)=>t+r.memoryMB,0)/o.length:e.reduce((t,r)=>t+r.memoryMB,0)/e.length,m=n.reduce((t,r)=>t+Math.max(0,a-r.memoryMB),0);return Math.max(0,m)}export{N as initMemoryManager};
//# sourceMappingURL=memory-manager-BFSAMsDL.js.map
