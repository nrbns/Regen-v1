{"version":3,"mappings":"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","names":["AGENT_MODES","TrendingUp","Sparkles","Code","FileText","Workflow","AgentModeSelector","onAgentSelect","defaultMode","selectedMode","setSelectedMode","useState","capabilities","setCapabilities","useEffect","caps","multiAgentSystem","jsxs","jsx","mode","Icon","isSelected","cap","AgentStagehandIntegration","stagehand","execute","click","type","extract","navigate","useStagehand","task","AgentConsole","runId","setRunId","_logs","setLogs","streamingText","setStreamingText","query","setQuery","isStreaming","setIsStreaming","copyStatus","setCopyStatus","responsePaneRef","useRef","dslRef","streamMetaRef","latestOutputRef","abortControllerRef","status","transcript","events","setRun","setStatus","appendTranscript","reset","_currentRunId","useAgentStreamStore","language","useSettingsStore","state","agentConsoleHistory","useAgentMemoryStore","entry","selectedAgentMode","setSelectedAgentMode","activeId","tabs","useTabsStore","activeTab","t","crashed","checkForCrashedLoops","stopAutoSave","handleAutomationExecute","e","execRunId","dsl","__vitePreload","updateAutomationStatus","handleStartStream","handleAutomationCancel","finalizeTelemetry","useCallback","extras","meta","latencyMs","trackAction","persistConsoleMemory","payload","error","MemoryStoreInstance","clearConsoleHistory","tokenHandler","l","stepHandler","s","trackAgent","trimmedQuery","controller","runToken","agentResult","startAutoSave","context","relevantMemories","semanticSearchMemories","m","finalResult","streamError","sawFirstToken","aiEngine","event","prev","durationMs","saveLoopState","completeAutomation","finalOutput","message","handleStopStream","handleCopyResponse","textToCopy","Bot","motion","Loader2","StopCircle","Send","parsed","res","AnimatePresence","Fragment","CheckCircle2","Copy","AIThinkingSkeleton"],"ignoreList":[],"sources":["../../src/components/integrations/AgentModeSelector.tsx","../../src/routes/AgentConsole/stagehand-integration.tsx","../../src/routes/AgentConsole.tsx"],"sourcesContent":["/**\r\n * Agent Mode Selector Component\r\n * Integrates multi-agent system into UI\r\n */\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { multiAgentSystem, type AgentMode } from '../../core/agents/multiAgentSystem';\r\nimport { Sparkles, TrendingUp, Code, FileText, Workflow } from 'lucide-react';\r\n\r\nconst AGENT_MODES: Array<{\r\n  id: AgentMode;\r\n  label: string;\r\n  icon: typeof Sparkles;\r\n  description: string;\r\n}> = [\r\n  {\r\n    id: 'trade',\r\n    label: 'Trade',\r\n    icon: TrendingUp,\r\n    description: 'Market analysis, signals, order execution',\r\n  },\r\n  {\r\n    id: 'research',\r\n    label: 'Research',\r\n    icon: Sparkles,\r\n    description: 'Multi-source search, citations, verification',\r\n  },\r\n  {\r\n    id: 'dev',\r\n    label: 'Dev',\r\n    icon: Code,\r\n    description: 'Code extraction, auto-debug, profiling',\r\n  },\r\n  {\r\n    id: 'document',\r\n    label: 'Document',\r\n    icon: FileText,\r\n    description: 'PDF/Doc insights, table extraction',\r\n  },\r\n  {\r\n    id: 'workflow',\r\n    label: 'Workflow',\r\n    icon: Workflow,\r\n    description: 'Arc-like automated workflows',\r\n  },\r\n];\r\n\r\ninterface AgentModeSelectorProps {\r\n  onAgentSelect?: (mode: AgentMode, capabilities: string[]) => void;\r\n  defaultMode?: AgentMode;\r\n}\r\n\r\nexport function AgentModeSelector({\r\n  onAgentSelect,\r\n  defaultMode = 'research',\r\n}: AgentModeSelectorProps) {\r\n  const [selectedMode, setSelectedMode] = useState<AgentMode>(defaultMode);\r\n  const [capabilities, setCapabilities] = useState<string[]>([]);\r\n\r\n  useEffect(() => {\r\n    const caps = multiAgentSystem.getCapabilities(selectedMode, {\r\n      mode: selectedMode,\r\n    });\r\n    setCapabilities(caps);\r\n    onAgentSelect?.(selectedMode, caps);\r\n  }, [selectedMode, onAgentSelect]);\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-4\">\r\n      <div className=\"flex flex-wrap gap-2\">\r\n        {AGENT_MODES.map(mode => {\r\n          const Icon = mode.icon;\r\n          const isSelected = selectedMode === mode.id;\r\n          return (\r\n            <button\r\n              key={mode.id}\r\n              onClick={() => setSelectedMode(mode.id)}\r\n              className={`flex items-center gap-2 rounded-lg border px-4 py-2 transition-all ${\r\n                isSelected\r\n                  ? 'border-emerald-500 bg-emerald-500/20 text-emerald-400'\r\n                  : 'border-neutral-700 bg-neutral-800/50 text-neutral-300 hover:border-neutral-600'\r\n              } `}\r\n            >\r\n              <Icon className=\"h-4 w-4\" />\r\n              <span className=\"font-medium\">{mode.label}</span>\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      {capabilities.length > 0 && (\r\n        <div className=\"rounded-lg bg-neutral-800/50 p-4\">\r\n          <h3 className=\"mb-2 text-sm font-semibold text-neutral-300\">Capabilities</h3>\r\n          <ul className=\"flex flex-wrap gap-2\">\r\n            {capabilities.map(cap => (\r\n              <li\r\n                key={cap}\r\n                className=\"rounded-full bg-neutral-700/50 px-3 py-1 text-xs text-neutral-400\"\r\n              >\r\n                {cap}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Stagehand Integration for Agent Console\r\n * Adds developer-friendly scripting API\r\n */\r\n\r\nimport { useEffect } from 'react';\r\nimport { useStagehand } from '../../hooks/useStagehand';\r\n\r\nexport function AgentStagehandIntegration() {\r\n  const { stagehand, execute, click, type, extract, navigate } = useStagehand({\r\n    context: 'agent',\r\n  });\r\n\r\n  useEffect(() => {\r\n    // Expose Stagehand API to window for console access\r\n    if (typeof window !== 'undefined') {\r\n      (window as any).agentStagehand = {\r\n        stagehand,\r\n        execute,\r\n        click,\r\n        type,\r\n        extract,\r\n        navigate,\r\n        // Agent-specific helpers\r\n        runTask: async (task: string) => {\r\n          await type('textarea[name=\"task\"]', task);\r\n          await click('button[type=\"submit\"]');\r\n        },\r\n        getLogs: async () => {\r\n          const logs = await extract('.agent-logs');\r\n          return logs;\r\n        },\r\n        cancel: async () => {\r\n          await click('button[data-action=\"cancel\"]');\r\n        },\r\n      };\r\n    }\r\n\r\n    return () => {\r\n      if (typeof window !== 'undefined') {\r\n        delete (window as any).agentStagehand;\r\n      }\r\n    };\r\n  }, [stagehand, execute, click, type, extract, navigate]);\r\n\r\n  return null; // This is a side-effect component\r\n}\r\n\r\n","// @ts-nocheck\n\nimport { useEffect, useRef, useState, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Bot, Send, StopCircle, Copy, CheckCircle2, Loader2, Sparkles } from 'lucide-react';\nimport { AIThinkingSkeleton } from '../components/common/LoadingSkeleton';\nimport { aiEngine, type AITaskResult } from '../core/ai';\nimport { MemoryStoreInstance } from '../core/supermemory/store';\nimport { semanticSearchMemories } from '../core/supermemory/search';\nimport { useAgentStreamStore } from '../state/agentStreamStore';\nimport { useAgentMemoryStore } from '../state/agentMemoryStore';\nimport { trackAgent, trackAction } from '../core/supermemory/tracker';\nimport {\n  startAutoSave,\n  stopAutoSave,\n  saveLoopState,\n  checkForCrashedLoops,\n} from '../core/agents/loopResume';\nimport { useSettingsStore } from '../state/settingsStore';\nimport { AgentModeSelector } from '../components/integrations/AgentModeSelector';\nimport { multiAgentSystem, type AgentMode } from '../core/agents/multiAgentSystem';\nimport { useTabsStore } from '../state/tabsStore';\nimport { AgentStagehandIntegration } from './AgentConsole/stagehand-integration';\n\nexport default function AgentConsole() {\n  const [runId, setRunId] = useState<string | null>(null);\n  const [_logs, setLogs] = useState<any[]>([]);\n  const [streamingText, setStreamingText] = useState<string>('');\n  const [query, setQuery] = useState('');\n  const [isStreaming, setIsStreaming] = useState(false);\n  const [copyStatus, setCopyStatus] = useState<'idle' | 'copied'>('idle');\n  const responsePaneRef = useRef<HTMLDivElement | null>(null);\n  const dslRef = useRef<string>(\n    JSON.stringify(\n      {\n        goal: 'Open example.com',\n        steps: [{ skill: 'navigate', args: { url: 'https://example.com' } }],\n        output: { type: 'json', schema: {} },\n      },\n      null,\n      2\n    )\n  );\n  const streamMetaRef = useRef<{\n    startedAt: number;\n    query: string;\n    model?: string;\n    provider?: string;\n  } | null>(null);\n  const latestOutputRef = useRef<string>('');\n  const abortControllerRef = useRef<AbortController | null>(null);\n\n  const {\n    status,\n    transcript,\n    events,\n    setRun,\n    setStatus,\n    appendTranscript,\n    reset,\n    runId: _currentRunId,\n  } = useAgentStreamStore();\n  const language = useSettingsStore(state => state.language || 'auto');\n  const agentConsoleHistory = useAgentMemoryStore(state =>\n    state.entries.filter(entry => entry.agentId === 'agent.console').slice(0, 5)\n  );\n  const [selectedAgentMode, setSelectedAgentMode] = useState<AgentMode>('research');\n  const { activeId, tabs } = useTabsStore();\n  const activeTab = tabs.find(t => t.id === activeId);\n\n  // Check for crashed loops on mount\n  useEffect(() => {\n    const crashed = checkForCrashedLoops();\n    if (crashed.length > 0) {\n      console.log('[AgentConsole] Found', crashed.length, 'crashed loops');\n      // Could show a toast or modal here to offer resume\n    }\n  }, []);\n\n  // Cleanup auto-save on unmount\n  useEffect(() => {\n    return () => {\n      stopAutoSave();\n    };\n  }, []);\n\n  // Auto-scroll response pane to bottom when new content arrives\n  useEffect(() => {\n    if (responsePaneRef.current && (streamingText || transcript)) {\n      responsePaneRef.current.scrollTop = responsePaneRef.current.scrollHeight;\n    }\n  }, [streamingText, transcript]);\n\n  useEffect(() => {\n    latestOutputRef.current = streamingText || transcript || '';\n  }, [streamingText, transcript]);\n\n  // AUTOMATION INTEGRATION: Listen for automation execution events from PlaybookForge\n  useEffect(() => {\n    const handleAutomationExecute = ((e: CustomEvent) => {\n      const { runId: execRunId, dsl } = e.detail;\n      if (dsl) {\n        // Set the DSL and trigger execution\n        dslRef.current = JSON.stringify(dsl, null, 2);\n        setQuery(dsl.goal || 'Execute automation');\n\n        // Import and use automation bridge to track status\n        import('../services/automationBridge').then(({ updateAutomationStatus }) => {\n          updateAutomationStatus(execRunId, { progress: 10 });\n        });\n\n        // Start the agent execution\n        setTimeout(() => {\n          handleStartStream();\n        }, 100);\n      }\n    }) as EventListener;\n\n    const handleAutomationCancel = (() => {\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n        setIsStreaming(false);\n        setStatus('idle');\n      }\n    }) as EventListener;\n\n    window.addEventListener('agent:execute', handleAutomationExecute);\n    window.addEventListener('agent:cancel', handleAutomationCancel);\n\n    return () => {\n      window.removeEventListener('agent:execute', handleAutomationExecute);\n      window.removeEventListener('agent:cancel', handleAutomationCancel);\n    };\n  }, [handleStartStream, setStatus]);\n\n  const finalizeTelemetry = useCallback(\n    (\n      status: 'success' | 'error' | 'cancelled',\n      extras?: {\n        error?: string;\n        provider?: string;\n        model?: string;\n        promptTokens?: number | null;\n        completionTokens?: number | null;\n        totalTokens?: number | null;\n      }\n    ) => {\n      const meta = streamMetaRef.current;\n      if (!meta) return;\n      const latencyMs = Math.round(performance.now() - meta.startedAt);\n      trackAction(`agent_stream_${status}`, {\n        source: 'AgentConsole',\n        queryLength: meta.query.length,\n        latencyMs,\n        provider: extras?.provider ?? meta.provider ?? 'unknown',\n        model: extras?.model ?? meta.model ?? 'unknown',\n        promptTokens: extras?.promptTokens ?? undefined,\n        completionTokens: extras?.completionTokens ?? undefined,\n        totalTokens: extras?.totalTokens ?? undefined,\n        outputChars: latestOutputRef.current.length || undefined,\n        error: extras?.error,\n      }).catch(() => {});\n      streamMetaRef.current = null;\n    },\n    []\n  );\n\n  const persistConsoleMemory = useCallback(\n    async (payload: {\n      prompt: string;\n      runId: string;\n      success: boolean;\n      response?: string;\n      error?: string;\n      usage?: AITaskResult['usage'];\n      durationMs?: number;\n    }) => {\n      try {\n        useAgentMemoryStore.getState().addEntry({\n          agentId: 'agent.console',\n          runId: payload.runId,\n          prompt: payload.prompt,\n          response: payload.response,\n          error: payload.error,\n          success: payload.success,\n          tokens: payload.usage\n            ? {\n                prompt: payload.usage.prompt_tokens ?? null,\n                completion: payload.usage.completion_tokens ?? null,\n                total: payload.usage.total_tokens ?? null,\n              }\n            : undefined,\n        });\n      } catch (error) {\n        console.warn('[AgentConsole] Failed to update agent memory store:', error);\n      }\n\n      if (typeof window === 'undefined') {\n        return;\n      }\n\n      try {\n        await MemoryStoreInstance.saveEvent({\n          type: 'agent',\n          value: payload.response || payload.error || payload.prompt,\n          metadata: {\n            action: payload.prompt,\n            runId: payload.runId,\n            skill: 'agent.console',\n            result: payload.response,\n            error: payload.error,\n            duration: payload.durationMs,\n            tokensUsed: payload.usage?.total_tokens ?? undefined,\n            promptTokens: payload.usage?.prompt_tokens,\n            completionTokens: payload.usage?.completion_tokens,\n            success: payload.success,\n          },\n        });\n      } catch (error) {\n        console.warn('[AgentConsole] Failed to persist console memory:', error);\n      }\n    },\n    []\n  );\n\n  const clearConsoleHistory = useCallback(() => {\n    try {\n      useAgentMemoryStore.getState().clearAgent('agent.console');\n    } catch (error) {\n      console.warn('[AgentConsole] Failed to clear agent console history:', error);\n    }\n  }, []);\n\n  // Listen for agent tokens and steps\n  useEffect(() => {\n    if (typeof window === 'undefined' || !window.agent) {\n      console.warn('[AgentConsole] window.agent not available');\n      return;\n    }\n\n    const tokenHandler = (t: any) => {\n      setLogs((l: any[]) => [...l, t]);\n      if (t.type === 'token' && t.text) {\n        appendTranscript(t.text);\n      }\n    };\n    const stepHandler = async (s: any) => {\n      setLogs((l: any[]) => [...l, s]);\n      useAgentStreamStore.getState().appendEvent({\n        id: `event_${Date.now()}_${Math.random()}`,\n        type: 'step',\n        step: s.idx,\n        status: s.skill,\n        content: s.res ? JSON.stringify(s.res) : undefined,\n        timestamp: Date.now(),\n      });\n\n      // Track agent step\n      try {\n        await trackAgent('step_complete', {\n          runId: runId || undefined,\n          skill: s.skill,\n          step: s.idx,\n          result: s.res ? JSON.stringify(s.res).substring(0, 200) : undefined, // Truncate for storage\n        });\n      } catch (error) {\n        console.warn('[AgentConsole] Failed to track agent step:', error);\n      }\n    };\n\n    try {\n      window.agent.onToken(tokenHandler);\n      window.agent.onStep(stepHandler);\n    } catch (error) {\n      console.error('[AgentConsole] Failed to register agent handlers:', error);\n    }\n\n    return () => {\n      // Cleanup handled by component unmount\n    };\n  }, [appendTranscript, runId]);\n\n  const handleStartStream = useCallback(async () => {\n    const trimmedQuery = query.trim();\n    if (!trimmedQuery || isStreaming) return;\n\n    reset();\n    setStreamingText('');\n    setIsStreaming(true);\n    setStatus('connecting');\n    const controller = new AbortController();\n    abortControllerRef.current = controller;\n    streamMetaRef.current = { startedAt: performance.now(), query: trimmedQuery };\n\n    const runToken = `agent-stream-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n    setRun(runToken, trimmedQuery, activeId);\n\n    // Phase 2: Use multi-agent system\n    try {\n      const agentResult = await multiAgentSystem.execute(selectedAgentMode, trimmedQuery, {\n        mode: selectedAgentMode,\n        tabId: activeId,\n        url: activeTab?.url,\n        sessionId: activeTab?.sessionId,\n      });\n\n      // Execute actions if any\n      if (agentResult.actions && agentResult.actions.length > 0) {\n        // Actions will be executed by safe executor\n        console.log('[AgentConsole] Agent generated actions:', agentResult.actions);\n      }\n    } catch (error) {\n      console.error('[AgentConsole] Multi-agent execution failed:', error);\n      // Continue with existing flow as fallback\n    }\n\n    // Start auto-save for loop resume\n    startAutoSave({\n      language,\n      mode: 'agent',\n    });\n\n    // Track agent action\n    try {\n      await trackAgent('stream_start', {\n        action: trimmedQuery,\n        skill: 'stream',\n      });\n    } catch (error) {\n      console.warn('[AgentConsole] Failed to track agent action:', error);\n    }\n\n    // Build enhanced context with recent runs and relevant memories\n    const context: any = {\n      mode: 'agent-console',\n    };\n\n    // Add recent agent runs\n    if (agentConsoleHistory.length > 0) {\n      context.agent_runs = agentConsoleHistory.slice(0, 3).map(entry => ({\n        prompt: entry.prompt,\n        response: entry.response,\n        success: entry.success,\n        error: entry.error,\n        createdAt: entry.createdAt,\n      }));\n    }\n\n    // Fetch relevant memories for context\n    let relevantMemories: any[] = [];\n    try {\n      const memoryMatches = await semanticSearchMemories(trimmedQuery, {\n        limit: 5,\n        minSimilarity: 0.6,\n      });\n      relevantMemories = memoryMatches.map(m => ({\n        value: m.event.value,\n        metadata: m.event.metadata,\n        id: m.event.id,\n        type: m.event.type,\n        similarity: m.similarity,\n      }));\n    } catch (error) {\n      console.warn('[AgentConsole] Failed to fetch memory context:', error);\n    }\n\n    if (relevantMemories.length > 0) {\n      context.memories = relevantMemories;\n    }\n\n    try {\n      let finalResult: AITaskResult | null = null;\n      let streamError: string | null = null;\n      let sawFirstToken = false;\n\n      await aiEngine.runTask(\n        {\n          kind: 'agent',\n          prompt: trimmedQuery,\n          context,\n          mode: 'agent-console',\n          metadata: { surface: 'agent-console' },\n          llm: { temperature: 0.2, maxTokens: 900 },\n          signal: controller.signal,\n        },\n        event => {\n          if (event.type === 'token' && typeof event.data === 'string') {\n            if (!sawFirstToken) {\n              sawFirstToken = true;\n              setStatus('live');\n            }\n            setStreamingText(prev => `${prev}${event.data}`);\n            appendTranscript(event.data);\n          } else if (event.type === 'done') {\n            if (event.data && typeof event.data !== 'string') {\n              finalResult = event.data as AITaskResult;\n            } else if (typeof event.data === 'string') {\n              finalResult = {\n                text: event.data,\n                provider: 'unknown',\n                model: 'unknown',\n              };\n            }\n          } else if (event.type === 'error') {\n            streamError = typeof event.data === 'string' ? event.data : 'AI stream failed';\n          }\n        }\n      );\n\n      abortControllerRef.current = null;\n\n      if (controller.signal.aborted) {\n        setIsStreaming(false);\n        finalizeTelemetry('cancelled');\n        return;\n      }\n\n      if (streamError) {\n        const durationMs = streamMetaRef.current\n          ? Math.round(performance.now() - streamMetaRef.current.startedAt)\n          : undefined;\n        await persistConsoleMemory({\n          prompt: trimmedQuery,\n          runId: runToken,\n          success: false,\n          error: streamError,\n          response: latestOutputRef.current || streamingText || undefined,\n          durationMs,\n        });\n        setIsStreaming(false);\n        setStatus('error');\n        useAgentStreamStore.getState().setError(streamError);\n        // Save loop state on error\n        saveLoopState({\n          mode: 'agent',\n          metadata: { language },\n        });\n        stopAutoSave();\n        finalizeTelemetry('error', { error: streamError });\n\n        // AUTOMATION INTEGRATION: Notify automation bridge of error\n        import('../services/automationBridge')\n          .then(({ completeAutomation }) => {\n            completeAutomation(runToken, undefined, streamError);\n          })\n          .catch(() => {\n            // Automation bridge not available\n          });\n        return;\n      }\n\n      const finalOutput = finalResult?.text ?? latestOutputRef.current ?? streamingText ?? '';\n      const durationMs = streamMetaRef.current\n        ? Math.round(performance.now() - streamMetaRef.current.startedAt)\n        : undefined;\n\n      // Save final loop state\n      saveLoopState({\n        mode: 'agent',\n        status: 'complete',\n        metadata: { language },\n      });\n      stopAutoSave();\n\n      await persistConsoleMemory({\n        prompt: trimmedQuery,\n        runId: runToken,\n        success: true,\n        response: finalOutput,\n        usage: finalResult?.usage,\n        durationMs,\n      });\n      setIsStreaming(false);\n      setStatus('complete');\n      finalizeTelemetry('success', {\n        provider: finalResult?.provider,\n        model: finalResult?.model,\n        promptTokens: finalResult?.usage?.prompt_tokens ?? null,\n        completionTokens: finalResult?.usage?.completion_tokens ?? null,\n        totalTokens: finalResult?.usage?.total_tokens ?? null,\n      });\n\n      // AUTOMATION INTEGRATION: Notify automation bridge of completion\n      import('../services/automationBridge')\n        .then(({ completeAutomation }) => {\n          completeAutomation(runToken, { output: finalOutput, result: finalResult });\n        })\n        .catch(() => {\n          // Automation bridge not available\n        });\n    } catch (error) {\n      abortControllerRef.current = null;\n      if (controller.signal.aborted) {\n        finalizeTelemetry('cancelled');\n        return;\n      }\n      const message = error instanceof Error ? error.message : String(error);\n      const durationMs = streamMetaRef.current\n        ? Math.round(performance.now() - streamMetaRef.current.startedAt)\n        : undefined;\n      await persistConsoleMemory({\n        prompt: trimmedQuery,\n        runId: runToken,\n        success: false,\n        error: message,\n        response: latestOutputRef.current || streamingText || undefined,\n        durationMs,\n      });\n      setIsStreaming(false);\n      setStatus('error');\n      useAgentStreamStore.getState().setError(message);\n      finalizeTelemetry('error', { error: message });\n\n      try {\n        await trackAgent('stream_error', {\n          action: trimmedQuery,\n          error: message,\n        });\n      } catch {\n        // Ignore tracking errors\n      }\n    }\n  }, [\n    query,\n    isStreaming,\n    reset,\n    setStatus,\n    setRun,\n    appendTranscript,\n    finalizeTelemetry,\n    agentConsoleHistory,\n  ]);\n\n  const handleStopStream = useCallback(() => {\n    if (!abortControllerRef.current) return;\n    abortControllerRef.current.abort();\n    abortControllerRef.current = null;\n    setIsStreaming(false);\n    setStatus('complete');\n  }, [setStatus]);\n\n  const handleCopyResponse = useCallback(async () => {\n    const textToCopy = streamingText || transcript;\n    if (!textToCopy) return;\n\n    try {\n      await navigator.clipboard.writeText(textToCopy);\n      setCopyStatus('copied');\n      setTimeout(() => setCopyStatus('idle'), 2000);\n    } catch (error) {\n      console.error('Failed to copy:', error);\n    }\n  }, [streamingText, transcript]);\n\n  return (\n    <div className=\"flex h-full flex-col gap-4 p-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"rounded-xl border border-blue-500/40 bg-blue-500/10 p-2\">\n            <Bot size={20} className=\"text-blue-300\" />\n          </div>\n          <div>\n            <h1 className=\"text-xl font-semibold text-gray-100\">Agent Console</h1>\n            <p className=\"text-xs text-gray-400\">Stream AI responses and manage agent runs</p>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          {status === 'live' && (\n            <motion.span\n              className=\"inline-flex items-center gap-2 rounded-full border border-emerald-500/40 bg-emerald-500/15 px-3 py-1 text-xs text-emerald-100\"\n              animate={{ opacity: [1, 0.7, 1] }}\n              transition={{ duration: 1.5, repeat: Infinity }}\n            >\n              <span className=\"h-2 w-2 rounded-full bg-emerald-400\" />\n              Streaming\n            </motion.span>\n          )}\n        </div>\n      </div>\n\n      <div className=\"grid flex-1 grid-cols-1 gap-4 lg:grid-cols-2\">\n        {/* Left: Input & Controls */}\n        <div className=\"flex flex-col gap-4\">\n          {/* Phase 2: Agent Mode Selector */}\n          <div className=\"rounded-xl border border-slate-700/60 bg-slate-900/40 p-4\">\n            <label className=\"mb-2 block text-sm font-medium text-gray-300\">Agent Mode</label>\n            <AgentModeSelector\n              defaultMode={selectedAgentMode}\n              onAgentSelect={(mode, capabilities) => {\n                setSelectedAgentMode(mode);\n                console.log('[AgentConsole] Selected agent:', mode, 'Capabilities:', capabilities);\n              }}\n            />\n          </div>\n\n          <div className=\"flex flex-col gap-2\">\n            <label className=\"text-sm font-medium text-gray-300\">Ask Redix</label>\n            <div className=\"flex gap-2\">\n              <div className=\"relative flex-1\">\n                <input\n                  id=\"agent-console-query\"\n                  name=\"agent-console-query\"\n                  type=\"text\"\n                  value={query}\n                  onChange={e => setQuery(e.target.value)}\n                  onKeyDown={e => {\n                    if (e.key === 'Enter' && !e.shiftKey && !isStreaming) {\n                      e.preventDefault();\n                      void handleStartStream();\n                    }\n                  }}\n                  placeholder=\"Ask anything... (e.g., 'summarize quantum computing trends')\"\n                  disabled={isStreaming}\n                  className=\"w-full rounded-xl border border-slate-700/60 bg-slate-800/70 px-4 py-3 text-sm text-gray-100 placeholder:text-gray-500 focus:border-blue-500/60 focus:outline-none focus:ring-1 focus:ring-blue-500/40 disabled:opacity-50\"\n                />\n                {isStreaming && (\n                  <motion.div\n                    className=\"absolute right-3 top-1/2 -translate-y-1/2\"\n                    animate={{ rotate: 360 }}\n                    transition={{ duration: 1, repeat: Infinity, ease: 'linear' }}\n                  >\n                    <Loader2 size={16} className=\"text-blue-400\" />\n                  </motion.div>\n                )}\n              </div>\n              {isStreaming ? (\n                <motion.button\n                  onClick={handleStopStream}\n                  whileHover={{ scale: 1.05 }}\n                  whileTap={{ scale: 0.95 }}\n                  className=\"inline-flex items-center gap-2 rounded-xl border border-red-500/60 bg-red-500/20 px-4 py-3 text-sm font-medium text-red-100 transition hover:bg-red-500/30\"\n                >\n                  <StopCircle size={16} />\n                  Stop\n                </motion.button>\n              ) : (\n                <motion.button\n                  onClick={handleStartStream}\n                  disabled={!query.trim()}\n                  whileHover={{ scale: query.trim() ? 1.05 : 1 }}\n                  whileTap={{ scale: query.trim() ? 0.95 : 1 }}\n                  className=\"inline-flex items-center gap-2 rounded-xl border border-blue-500/60 bg-blue-500/20 px-4 py-3 text-sm font-medium text-blue-100 transition hover:bg-blue-500/30 disabled:cursor-not-allowed disabled:opacity-40\"\n                >\n                  <Send size={16} />\n                  Send\n                </motion.button>\n              )}\n            </div>\n          </div>\n\n          {/* Agent DSL Editor (Collapsible) */}\n          <details className=\"rounded-xl border border-slate-700/60 bg-slate-900/40\">\n            <summary className=\"cursor-pointer px-4 py-2 text-sm font-medium text-gray-300 hover:text-gray-100\">\n              Advanced: Agent DSL\n            </summary>\n            <div className=\"border-t border-slate-700/60 p-4\">\n              <textarea\n                id=\"agent-dsl-editor\"\n                name=\"agent-dsl\"\n                className=\"h-48 w-full rounded-lg border border-slate-700/60 bg-slate-800/70 p-3 font-mono text-xs text-gray-200 focus:border-blue-500/60 focus:outline-none\"\n                defaultValue={dslRef.current}\n                onChange={e => (dslRef.current = e.target.value)}\n              />\n              <div className=\"mt-3 flex flex-wrap gap-2\">\n                <button\n                  className=\"rounded-lg border border-indigo-500/60 bg-indigo-500/20 px-3 py-1.5 text-xs font-medium text-indigo-100 transition hover:bg-indigo-500/30\"\n                  onClick={async () => {\n                    if (typeof window === 'undefined' || !window.agent) {\n                      alert('Agent API not available. Please ensure you are running in Electron.');\n                      return;\n                    }\n                    try {\n                      const parsed = JSON.parse(dslRef.current);\n                      const res = (await window.agent.start(parsed)) as any;\n                      if (res?.runId) {\n                        setRunId(res.runId);\n\n                        // Track agent run start\n                        try {\n                          await trackAgent('run_start', {\n                            runId: res.runId,\n                            skill: parsed.goal || 'unknown',\n                            action: JSON.stringify(parsed).substring(0, 200),\n                          });\n                        } catch (error) {\n                          console.warn('[AgentConsole] Failed to track agent run:', error);\n                        }\n                      }\n                    } catch (error) {\n                      console.error('Failed to start agent run:', error);\n                      alert(\n                        `Failed to start agent run: ${error instanceof Error ? error.message : String(error)}`\n                      );\n                    }\n                  }}\n                >\n                  Start Run\n                </button>\n                <button\n                  className=\"rounded-lg border border-slate-700/60 bg-slate-800/60 px-3 py-1.5 text-xs font-medium text-gray-300 transition hover:bg-slate-800/80\"\n                  onClick={async () => {\n                    if (typeof window === 'undefined' || !window.agent) {\n                      alert('Agent API not available. Please ensure you are running in Electron.');\n                      return;\n                    }\n                    if (runId) {\n                      try {\n                        await window.agent.stop(runId);\n                      } catch (error) {\n                        console.error('Failed to stop agent run:', error);\n                        alert(\n                          `Failed to stop agent run: ${error instanceof Error ? error.message : String(error)}`\n                        );\n                      }\n                    }\n                  }}\n                >\n                  Stop Run\n                </button>\n              </div>\n            </div>\n          </details>\n\n          {/* Live Events Timeline */}\n          {events.length > 0 && (\n            <div className=\"flex flex-col gap-2\">\n              <h3 className=\"text-sm font-medium text-gray-300\">Recent Events</h3>\n              <div className=\"max-h-48 space-y-2 overflow-y-auto rounded-lg border border-slate-700/60 bg-slate-900/40 p-3\">\n                <AnimatePresence>\n                  {events\n                    .slice(-5)\n                    .reverse()\n                    .map(event => (\n                      <motion.div\n                        key={event.id}\n                        initial={{ opacity: 0, x: -8 }}\n                        animate={{ opacity: 1, x: 0 }}\n                        exit={{ opacity: 0 }}\n                        className=\"rounded-lg border border-slate-700/40 bg-slate-800/50 p-2 text-xs\"\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"font-medium text-gray-200\">{event.type}</span>\n                          {event.step !== undefined && (\n                            <span className=\"text-gray-400\">Step {event.step}</span>\n                          )}\n                        </div>\n                        {event.content && (\n                          <p className=\"mt-1 truncate text-gray-400\">{event.content}</p>\n                        )}\n                      </motion.div>\n                    ))}\n                </AnimatePresence>\n              </div>\n            </div>\n          )}\n\n          {/* Recent Agent Runs */}\n          {agentConsoleHistory.length > 0 && (\n            <div className=\"flex flex-col gap-2\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-sm font-medium text-gray-300\">Recent Agent Runs</h3>\n                <button\n                  className=\"text-xs text-gray-500 hover:text-gray-300\"\n                  onClick={clearConsoleHistory}\n                >\n                  Clear\n                </button>\n              </div>\n              <div className=\"space-y-2\">\n                {agentConsoleHistory.map(entry => (\n                  <button\n                    key={entry.id}\n                    onClick={() => setQuery(entry.prompt)}\n                    className=\"w-full rounded-lg border border-slate-700/60 bg-slate-900/40 p-3 text-left transition hover:border-slate-500/60 hover:bg-slate-900/70\"\n                  >\n                    <div className=\"flex items-center justify-between text-[11px]\">\n                      <span className=\"text-gray-500\">\n                        {new Date(entry.createdAt).toLocaleTimeString([], {\n                          hour: '2-digit',\n                          minute: '2-digit',\n                        })}\n                      </span>\n                      <span className={entry.success ? 'text-emerald-400' : 'text-rose-400'}>\n                        {entry.success ? 'Succeeded' : 'Error'}\n                      </span>\n                    </div>\n                    <p className=\"mt-1 line-clamp-1 text-sm text-gray-200\">{entry.prompt}</p>\n                    {(entry.response || entry.error) && (\n                      <p className=\"mt-1 line-clamp-2 text-xs text-gray-400\">\n                        {(entry.response || entry.error || '').trim()}\n                      </p>\n                    )}\n                  </button>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Right: Streaming Response Pane */}\n        <div className=\"flex flex-col gap-2\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-sm font-medium text-gray-300\">Response</h3>\n            {(streamingText || transcript) && (\n              <button\n                onClick={handleCopyResponse}\n                className=\"inline-flex items-center gap-1.5 rounded-lg border border-slate-700/60 bg-slate-800/60 px-2 py-1 text-xs text-gray-300 transition hover:bg-slate-800/80\"\n              >\n                {copyStatus === 'copied' ? (\n                  <>\n                    <CheckCircle2 size={14} className=\"text-emerald-400\" />\n                    Copied\n                  </>\n                ) : (\n                  <>\n                    <Copy size={14} />\n                    Copy\n                  </>\n                )}\n              </button>\n            )}\n          </div>\n          <div\n            ref={responsePaneRef}\n            className=\"flex-1 overflow-y-auto rounded-xl border border-slate-700/60 bg-slate-900/60 p-4\"\n          >\n            <AnimatePresence mode=\"wait\">\n              {streamingText || transcript ? (\n                <motion.div\n                  key=\"response\"\n                  initial={{ opacity: 0, y: 8 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  className=\"prose prose-invert prose-sm max-w-none\"\n                >\n                  <div className=\"whitespace-pre-wrap text-sm leading-relaxed text-gray-200\">\n                    {streamingText || transcript}\n                    {isStreaming && (\n                      <motion.span\n                        className=\"ml-1 inline-block h-4 w-0.5 bg-blue-400\"\n                        animate={{ opacity: [1, 0, 1] }}\n                        transition={{ duration: 0.8, repeat: Infinity }}\n                      />\n                    )}\n                  </div>\n                </motion.div>\n              ) : isStreaming ? (\n                <motion.div\n                  key=\"loading\"\n                  initial={{ opacity: 0 }}\n                  animate={{ opacity: 1 }}\n                  className=\"space-y-4\"\n                >\n                  <AIThinkingSkeleton message=\"AI is processing your request...\" />\n                  <div className=\"space-y-2\">\n                    <div className=\"h-3 w-full animate-pulse rounded bg-gray-800/50\" />\n                    <div className=\"h-3 w-5/6 animate-pulse rounded bg-gray-800/50\" />\n                    <div className=\"h-3 w-4/6 animate-pulse rounded bg-gray-800/50\" />\n                  </div>\n                </motion.div>\n              ) : (\n                <motion.div\n                  key=\"empty\"\n                  initial={{ opacity: 0 }}\n                  animate={{ opacity: 1 }}\n                  className=\"flex h-full flex-col items-center justify-center text-center\"\n                >\n                  <div className=\"rounded-full border border-slate-700/60 bg-slate-800/60 p-4\">\n                    <Sparkles size={24} className=\"text-slate-500\" />\n                  </div>\n                  <p className=\"mt-4 text-sm text-gray-400\">\n                    Ask a question to see streaming AI responses\n                  </p>\n                  <p className=\"mt-1 text-xs text-gray-500\">\n                    Responses stream in real-time as they're generated\n                  </p>\n                </motion.div>\n              )}\n            </AnimatePresence>\n          </div>\n        </div>\n      </div>\n      <AgentStagehandIntegration />\n    </div>\n  );\n}\n"],"file":"AgentConsole-Crl6GhHY.js"}