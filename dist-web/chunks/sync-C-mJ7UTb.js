import{authService as a}from"./auth-Cg8cvnkf.js";import{useWorkspacesStore as c}from"./workspacesStore-BSqEl-CQ.js";import{u as o}from"./bookmarksStore-CAScveEF.js";import{u as i}from"./core-ai-yFIunLTZ.js";import{l as s,t as n}from"./mode-research-BclgCwOH.js";import"./vendor-zustand-BWsgwsXr.js";import"./vendor-react-gmX1Lmvt.js";import"./vendor-react-dom-Bkb6jJ_S.js";import"./vendor-Vl2WtvH-.js";import"./mode-manager.ts-DwguZmJt.js";import"./core-memory-DmK-uh9X.js";import"./vendor-utils-5Vdoy44w.js";import"./mode-docs-FcsoolLb.js";import"./vendor-pdf-ejcqEZLU.js";import"./vendor-mammoth-BPQIafDs.js";import"./vendor-framer-motion-DDE19Uim.js";var f=Object.defineProperty,d=(r,t,e)=>t in r?f(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,l=(r,t,e)=>d(r,typeof t!="symbol"?t+"":t,e);class h{constructor(){l(this,"syncEnabled",!1),l(this,"lastSyncAt",null),l(this,"syncInProgress",!1)}async enable(){return a.getState().isAuthenticated?(this.syncEnabled=!0,localStorage.setItem("regen_sync_enabled","true"),s.info("[Sync] Sync enabled"),n("sync_enabled"),await this.sync(),!0):(s.warn("[Sync] Cannot enable sync without authentication"),!1)}disable(){this.syncEnabled=!1,localStorage.removeItem("regen_sync_enabled"),s.info("[Sync] Sync disabled"),n("sync_disabled")}isEnabled(){return typeof window>"u"?!1:localStorage.getItem("regen_sync_enabled")==="true"&&a.getState().isAuthenticated}async pull(){const t=a.getState();if(!t.isAuthenticated||!t.user)return null;try{return s.info("[Sync] Pulling data from server"),null}catch(e){return s.error("[Sync] Pull failed:",e),null}}async push(){const t=a.getState();if(!t.isAuthenticated||!t.user)return!1;try{const e={workspaces:c.getState().workspaces,bookmarks:o.getState().bookmarks,settings:i.getState(),version:1,syncedAt:Date.now()};return s.info("[Sync] Pushing data to server"),this.lastSyncAt=Date.now(),n("sync_pushed",{itemCount:e.workspaces.length+e.bookmarks.length}),!0}catch(e){return s.error("[Sync] Push failed:",e),!1}}async sync(){if(this.syncInProgress)return s.warn("[Sync] Sync already in progress"),{success:!1};if(!this.isEnabled())return s.warn("[Sync] Sync not enabled"),{success:!1};this.syncInProgress=!0;try{const t=await this.pull();if(t){const e=await this.merge(t);if(e.length>0)return s.warn("[Sync] Conflicts detected:",e.length),n("sync_conflicts",{count:e.length}),{success:!0,conflicts:e}}return await this.push(),this.lastSyncAt=Date.now(),n("sync_completed"),{success:!0}}catch(t){return s.error("[Sync] Sync failed:",t),n("sync_failed",{error:String(t)}),{success:!1}}finally{this.syncInProgress=!1}}async merge(t){const e=[];c.getState().workspaces;const u=t.workspaces;t.syncedAt>(this.lastSyncAt||0)&&c.setState({workspaces:u}),o.getState().bookmarks;const y=t.bookmarks;t.syncedAt>(this.lastSyncAt||0)&&o.setState({bookmarks:y}),i.getState();const S=t.settings;return t.syncedAt>(this.lastSyncAt||0)&&i.setState(S),e}getLastSyncAt(){return this.lastSyncAt}startAutoSync(t=300*1e3){setInterval(()=>{this.isEnabled()&&!this.syncInProgress&&this.sync().catch(e=>{s.error("[Sync] Auto-sync failed:",e)})},t)}}const F=new h;export{F as syncService};
//# sourceMappingURL=sync-C-mJ7UTb.js.map
