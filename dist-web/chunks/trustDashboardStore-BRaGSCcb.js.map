{"version":3,"file":"trustDashboardStore-BRaGSCcb.js","sources":["../../src/state/trustDashboardStore.ts"],"sourcesContent":["import { create } from 'zustand';\nimport { ipc } from '../lib/ipc-typed';\nimport { isElectronRuntime } from '../lib/env';\nimport type { ConsentRecord } from '../types/consent';\nimport type { TrustSummary } from '../types/trustWeaver';\nimport type { PrivacyAuditSummary } from '../lib/ipc-events';\n\ntype ShieldsStatus = {\n  adsBlocked: number;\n  trackersBlocked: number;\n  httpsUpgrades: number;\n  cookies3p: 'block' | 'allow';\n  webrtcBlocked: boolean;\n  fingerprinting: boolean;\n} | null;\n\ntype ConsentStats = {\n  total: number;\n  pending: number;\n  approved: number;\n  revoked: number;\n};\n\ntype BlockedSummary = {\n  trackers: number;\n  ads: number;\n  upgrades: number;\n};\n\ninterface TrustDashboardState {\n  visible: boolean;\n  loading: boolean;\n  error: string | null;\n  consentTimeline: ConsentRecord[];\n  trustSignals: TrustSummary[];\n  shieldsStatus: ShieldsStatus;\n  privacyAudit: PrivacyAuditSummary | null;\n  consentStats: ConsentStats;\n  blockedSummary: BlockedSummary;\n  lastUpdated: number | null;\n  open: () => Promise<void>;\n  close: () => void;\n  refresh: () => Promise<void>;\n}\n\nasync function safeCall<T>(callback: () => Promise<T>): Promise<T | undefined> {\n  try {\n    return await callback();\n  } catch (error) {\n    console.warn('[trust-dashboard] call failed', error);\n    return undefined;\n  }\n}\n\nexport const useTrustDashboardStore = create<TrustDashboardState>((set, get) => ({\n  visible: false,\n  loading: false,\n  error: null,\n  consentTimeline: [],\n  trustSignals: [],\n  shieldsStatus: null,\n  privacyAudit: null,\n  consentStats: {\n    total: 0,\n    pending: 0,\n    approved: 0,\n    revoked: 0,\n  },\n  blockedSummary: {\n    trackers: 0,\n    ads: 0,\n    upgrades: 0,\n  },\n  lastUpdated: null,\n  async open() {\n    if (!get().visible) {\n      set({ visible: true });\n    }\n    await get().refresh();\n  },\n  close() {\n    set({ visible: false });\n  },\n  async refresh() {\n    if (!isElectronRuntime()) {\n      set({\n        loading: false,\n        error: null,\n        consentTimeline: [],\n        trustSignals: [],\n        shieldsStatus: null,\n        privacyAudit: null,\n        consentStats: {\n          total: 0,\n          pending: 0,\n          approved: 0,\n          revoked: 0,\n        },\n        blockedSummary: {\n          trackers: 0,\n          ads: 0,\n          upgrades: 0,\n        },\n        lastUpdated: Date.now(),\n      });\n      return;\n    }\n    set({ loading: true, error: null });\n    try {\n      const [{ records: trustRecords } = { records: [] }, consentRecordsRaw, shieldsStatus, privacyAudit] = await Promise.all([\n        safeCall(() => ipc.trust.list()),\n        safeCall(() => ipc.consent.list()),\n        safeCall(() => ipc.shields.getStatus()),\n        safeCall(() => ipc.privacy.sentinel.audit()),\n      ]);\n\n      const consentRecords = Array.isArray(consentRecordsRaw) ? consentRecordsRaw : [];\n      const consentStats = consentRecords.reduce<ConsentStats>(\n        (stats, record) => {\n          stats.total += 1;\n          if (record.approved && !record.revokedAt) {\n            stats.approved += 1;\n          } else if (record.revokedAt) {\n            stats.revoked += 1;\n          } else {\n            stats.pending += 1;\n          }\n          return stats;\n        },\n        { total: 0, pending: 0, approved: 0, revoked: 0 },\n      );\n\n      const consentTimeline = [...consentRecords].sort((a, b) => b.timestamp - a.timestamp).slice(0, 20);\n\n      const trustSignals = Array.isArray(trustRecords)\n        ? [...trustRecords].sort((a, b) => {\n            if (a.verdict === b.verdict) {\n              return b.score - a.score;\n            }\n            const order = { trusted: 2, caution: 1, risk: 0 } as const;\n            return order[b.verdict] - order[a.verdict];\n          })\n        : [];\n\n      const blockedSummary: BlockedSummary = {\n        trackers: shieldsStatus?.trackersBlocked ?? 0,\n        ads: shieldsStatus?.adsBlocked ?? 0,\n        upgrades: shieldsStatus?.httpsUpgrades ?? 0,\n      };\n\n      set({\n        loading: false,\n        consentTimeline,\n        trustSignals,\n        shieldsStatus: shieldsStatus ?? null,\n        privacyAudit: privacyAudit ?? null,\n        consentStats,\n        blockedSummary,\n        lastUpdated: Date.now(),\n      });\n    } catch (error) {\n      set({\n        loading: false,\n        error: error instanceof Error ? error.message : String(error),\n      });\n    }\n  },\n}));\n\n"],"names":["safeCall","callback","error","useTrustDashboardStore","create","set","get","isElectronRuntime","trustRecords","consentRecordsRaw","shieldsStatus","privacyAudit","ipc","consentRecords","consentStats","stats","record","consentTimeline","a","b","trustSignals","order","blockedSummary"],"mappings":"kGA6CA,eAAeA,EAAYC,EAAoD,CAC7E,GAAI,CACF,OAAO,MAAMA,EAAA,CACf,OAASC,EAAO,CACd,QAAQ,KAAK,gCAAiCA,CAAK,EACnD,MACF,CACF,CAEO,MAAMC,EAAyBC,EAA4B,CAACC,EAAKC,KAAS,CAC/E,QAAS,GACT,QAAS,GACT,MAAO,KACP,gBAAiB,CAAA,EACjB,aAAc,CAAA,EACd,cAAe,KACf,aAAc,KACd,aAAc,CACZ,MAAO,EACP,QAAS,EACT,SAAU,EACV,QAAS,CAAA,EAEX,eAAgB,CACd,SAAU,EACV,IAAK,EACL,SAAU,CAAA,EAEZ,YAAa,KACb,MAAM,MAAO,CACNA,EAAA,EAAM,SACTD,EAAI,CAAE,QAAS,GAAM,EAEvB,MAAMC,EAAA,EAAM,QAAA,CACd,EACA,OAAQ,CACND,EAAI,CAAE,QAAS,GAAO,CACxB,EACA,MAAM,SAAU,CACd,GAAI,CAACE,IAAqB,CACxBF,EAAI,CACF,QAAS,GACT,MAAO,KACP,gBAAiB,CAAA,EACjB,aAAc,CAAA,EACd,cAAe,KACf,aAAc,KACd,aAAc,CACZ,MAAO,EACP,QAAS,EACT,SAAU,EACV,QAAS,CAAA,EAEX,eAAgB,CACd,SAAU,EACV,IAAK,EACL,SAAU,CAAA,EAEZ,YAAa,KAAK,IAAA,CAAI,CACvB,EACD,MACF,CACAA,EAAI,CAAE,QAAS,GAAM,MAAO,KAAM,EAClC,GAAI,CACF,KAAM,CAAC,CAAE,QAASG,CAAA,EAAiB,CAAE,QAAS,CAAA,GAAMC,EAAmBC,EAAeC,CAAY,EAAI,MAAM,QAAQ,IAAI,CACtHX,EAAS,IAAMY,EAAI,MAAM,MAAM,EAC/BZ,EAAS,IAAMY,EAAI,QAAQ,MAAM,EACjCZ,EAAS,IAAMY,EAAI,QAAQ,WAAW,EACtCZ,EAAS,IAAMY,EAAI,QAAQ,SAAS,OAAO,CAAA,CAC5C,EAEKC,EAAiB,MAAM,QAAQJ,CAAiB,EAAIA,EAAoB,CAAA,EACxEK,EAAeD,EAAe,OAClC,CAACE,EAAOC,KACND,EAAM,OAAS,EACXC,EAAO,UAAY,CAACA,EAAO,UAC7BD,EAAM,UAAY,EACTC,EAAO,UAChBD,EAAM,SAAW,EAEjBA,EAAM,SAAW,EAEZA,GAET,CAAE,MAAO,EAAG,QAAS,EAAG,SAAU,EAAG,QAAS,CAAA,CAAE,EAG5CE,EAAkB,CAAC,GAAGJ,CAAc,EAAE,KAAK,CAACK,EAAGC,IAAMA,EAAE,UAAYD,EAAE,SAAS,EAAE,MAAM,EAAG,EAAE,EAE3FE,EAAe,MAAM,QAAQZ,CAAY,EAC3C,CAAC,GAAGA,CAAY,EAAE,KAAK,CAACU,EAAGC,IAAM,CAC/B,GAAID,EAAE,UAAYC,EAAE,QAClB,OAAOA,EAAE,MAAQD,EAAE,MAErB,MAAMG,EAAQ,CAAE,QAAS,EAAG,QAAS,EAAG,KAAM,CAAA,EAC9C,OAAOA,EAAMF,EAAE,OAAO,EAAIE,EAAMH,EAAE,OAAO,CAC3C,CAAC,EACD,CAAA,EAEEI,EAAiC,CACrC,SAAUZ,GAAe,iBAAmB,EAC5C,IAAKA,GAAe,YAAc,EAClC,SAAUA,GAAe,eAAiB,CAAA,EAG5CL,EAAI,CACF,QAAS,GACT,gBAAAY,EACA,aAAAG,EACA,cAAeV,GAAiB,KAChC,aAAcC,GAAgB,KAC9B,aAAAG,EACA,eAAAQ,EACA,YAAa,KAAK,IAAA,CAAI,CACvB,CACH,OAASpB,EAAO,CACdG,EAAI,CACF,QAAS,GACT,MAAOH,aAAiB,MAAQA,EAAM,QAAU,OAAOA,CAAK,CAAA,CAC7D,CACH,CACF,CACF,EAAE"}