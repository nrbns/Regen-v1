{"version":3,"mappings":"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","names":["HandsFreeMode","sessionId","mode","onCommand","onClose","isListening","setIsListening","useState","isProcessing","setIsProcessing","ttsEnabled","setTtsEnabled","recognitionRef","useRef","synthRef","abortControllerRef","useEffect","SpeechRecognition","recognition","event","transcript","result","handleVoiceCommand","toast","speak","response","ipc","cmd","error","text","utterance","toggleListening","jsxs","jsx","Volume2","VolumeX","MicOff","Mic","X","RegenSidebar","messages","setMessages","input","setInput","isLoading","setIsLoading","handsFreeMode","setHandsFreeMode","setMode","isConnected","_currentStatus","_setCurrentStatus","messagesEndRef","socketRef","tabs","activeId","useTabsStore","activeTab","handleSend","pendingConfirmation","setPendingConfirmation","messageText","lower","confirmed","confirmationMessage","prev","userMessage","clientId","placeholderMessage","errorMessage","handleVoiceToggle","handleKeyPress","e","Sparkles","Wifi","WifiOff","useAppStore","__vitePreload","n","Search","TrendingUp","Fragment","msg","Loader2","Send"],"ignoreList":[],"sources":["../../src/components/regen/HandsFreeMode.tsx","../../src/components/regen/RegenSidebar.tsx"],"sourcesContent":["/**\n * Hands-Free Mode Component\n * Continuous voice listening + TTS responses\n */\n\nimport { useState, useEffect, useRef } from 'react';\nimport { Mic, MicOff, Volume2, VolumeX, X } from 'lucide-react';\nimport { ipc } from '../../lib/ipc-typed';\nimport { toast } from '../../utils/toast';\n\ninterface HandsFreeModeProps {\n  sessionId: string;\n  mode: 'research' | 'trade';\n  onCommand?: (command: { type: string; payload: any }) => void;\n  onClose?: () => void;\n}\n\nexport function HandsFreeMode({ sessionId, mode, onCommand, onClose }: HandsFreeModeProps) {\n  const [isListening, setIsListening] = useState(false);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [ttsEnabled, setTtsEnabled] = useState(true);\n  const recognitionRef = useRef<any>(null);\n  const synthRef = useRef<SpeechSynthesis | null>(null);\n  const abortControllerRef = useRef<AbortController | null>(null);\n\n  // Initialize speech recognition\n  useEffect(() => {\n    const SpeechRecognition =\n      (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\n\n    if (SpeechRecognition) {\n      const recognition = new SpeechRecognition();\n      recognition.continuous = true; // Continuous listening\n      recognition.interimResults = false;\n      recognition.lang = 'en-US,ta-IN,hi-IN'; // Support multiple languages\n\n      recognition.onresult = async (event: any) => {\n        const transcript = Array.from(event.results)\n          .map((result: any) => result[0]?.transcript)\n          .join(' ')\n          .trim();\n\n        if (transcript && !isProcessing) {\n          setIsProcessing(true);\n          await handleVoiceCommand(transcript);\n          setIsProcessing(false);\n        }\n      };\n\n      recognition.onerror = (event: any) => {\n        console.error('Speech recognition error:', event.error);\n        if (event.error !== 'no-speech') {\n          toast.error('Voice recognition error. Please try again.');\n          setIsListening(false);\n        }\n      };\n\n      recognition.onend = () => {\n        // Auto-restart if hands-free mode is still on\n        if (isListening && !isProcessing) {\n          try {\n            recognition.start();\n          } catch {\n            // Already started or other error\n          }\n        }\n      };\n\n      recognitionRef.current = recognition;\n    }\n\n    synthRef.current = window.speechSynthesis;\n\n    return () => {\n      if (recognitionRef.current) {\n        recognitionRef.current.stop();\n      }\n      if (synthRef.current) {\n        synthRef.current.cancel();\n      }\n    };\n  }, [isListening, isProcessing]);\n\n  const handleVoiceCommand = async (transcript: string) => {\n    // Stop command\n    if (transcript.toLowerCase().includes('stop') || transcript.toLowerCase().includes('cancel')) {\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n      }\n      speak('Stopped hands-free actions.');\n      return;\n    }\n\n    try {\n      // Send to Regen\n      const response = await ipc.regen.query({\n        sessionId,\n        message: transcript,\n        mode,\n        source: 'voice',\n      });\n\n      // Execute commands\n      if (response.commands && response.commands.length > 0) {\n        for (const cmd of response.commands) {\n          if (onCommand) {\n            onCommand(cmd);\n          }\n        }\n      }\n\n      // Speak response\n      if (ttsEnabled && response.text) {\n        speak(response.text);\n      }\n    } catch (error) {\n      console.error('[HandsFree] Command failed:', error);\n      speak('Sorry, I encountered an error. Please try again.');\n    }\n  };\n\n  const speak = (text: string) => {\n    if (!synthRef.current || !ttsEnabled) return;\n\n    // Cancel any ongoing speech\n    synthRef.current.cancel();\n\n    const utterance = new SpeechSynthesisUtterance(text);\n    utterance.lang = 'en-US'; // Can be made language-aware\n    utterance.rate = 1.0;\n    utterance.pitch = 1.0;\n    utterance.volume = 1.0;\n\n    synthRef.current.speak(utterance);\n  };\n\n  const toggleListening = () => {\n    if (!recognitionRef.current) {\n      toast.error('Voice recognition not available in this browser');\n      return;\n    }\n\n    if (isListening) {\n      recognitionRef.current.stop();\n      setIsListening(false);\n      if (synthRef.current) {\n        synthRef.current.cancel();\n      }\n    } else {\n      try {\n        recognitionRef.current.start();\n        setIsListening(true);\n        speak(\"Hands-free mode activated. I'm listening...\");\n      } catch (error) {\n        console.error('Failed to start recognition:', error);\n        toast.error('Failed to start voice recognition');\n      }\n    }\n  };\n\n  return (\n    <div className=\"fixed bottom-6 right-6 z-50 flex flex-col items-end gap-2\">\n      {/* Controls */}\n      <div className=\"flex items-center gap-2 bg-gray-900 border border-gray-700 rounded-lg p-2 shadow-lg\">\n        <button\n          onClick={() => setTtsEnabled(!ttsEnabled)}\n          className={`p-2 rounded transition-colors ${\n            ttsEnabled\n              ? 'bg-green-600 text-white hover:bg-green-700'\n              : 'bg-gray-800 text-gray-400 hover:bg-gray-700'\n          }`}\n          aria-label={ttsEnabled ? 'Disable TTS' : 'Enable TTS'}\n        >\n          {ttsEnabled ? <Volume2 className=\"w-4 h-4\" /> : <VolumeX className=\"w-4 h-4\" />}\n        </button>\n        <button\n          onClick={toggleListening}\n          className={`p-3 rounded-full transition-colors ${\n            isListening\n              ? 'bg-red-600 text-white hover:bg-red-700 animate-pulse'\n              : 'bg-blue-600 text-white hover:bg-blue-700'\n          }`}\n          aria-label={isListening ? 'Stop listening' : 'Start listening'}\n        >\n          {isListening ? <MicOff className=\"w-5 h-5\" /> : <Mic className=\"w-5 h-5\" />}\n        </button>\n        {onClose && (\n          <button\n            onClick={onClose}\n            className=\"p-2 text-gray-400 hover:text-gray-300 transition-colors\"\n            aria-label=\"Close\"\n          >\n            <X className=\"w-4 h-4\" />\n          </button>\n        )}\n      </div>\n\n      {/* Status indicator */}\n      {isListening && (\n        <div className=\"bg-blue-600 text-white text-xs px-3 py-1 rounded-full\">\n          {isProcessing ? 'Processing...' : 'Listening...'}\n        </div>\n      )}\n    </div>\n  );\n}\n","/**\n * Regen Sidebar Component\n * The AI brain of Regen - chat + voice interface\n */\n\nimport { useState, useEffect, useRef } from 'react';\nimport {\n  Send,\n  Mic,\n  MicOff,\n  Sparkles,\n  Loader2,\n  X,\n  Search,\n  TrendingUp,\n  Wifi,\n  WifiOff,\n} from 'lucide-react';\nimport { useTabsStore } from '../../state/tabsStore';\nimport { ipc } from '../../lib/ipc-typed';\nimport { toast } from '../../utils/toast';\nimport { HandsFreeMode } from './HandsFreeMode';\nimport { getRegenSocket } from '../../lib/realtime/regen-socket';\n\nexport type RegenMode = 'research' | 'trade';\n\ninterface RegenMessage {\n  id: string;\n  role: 'user' | 'assistant';\n  content: string;\n  timestamp: number;\n  done?: boolean; // For streaming messages\n  commands?: Array<{ type: string; payload: Record<string, unknown> }>;\n}\n\n// RegenCommand type is now handled by RegenSocket client\n\nexport function RegenSidebar() {\n  const [messages, setMessages] = useState<RegenMessage[]>([]);\n  const [input, setInput] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [isListening, setIsListening] = useState(false);\n  const [handsFreeMode, setHandsFreeMode] = useState(false);\n  const [mode, setMode] = useState<RegenMode>('research');\n  const [sessionId] = useState(() => `regen-${Date.now()}`);\n  const [isConnected] = useState(false);\n  const [_currentStatus, _setCurrentStatus] = useState<string>('');\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const recognitionRef = useRef<any>(null);\n  const socketRef = useRef<ReturnType<typeof getRegenSocket> | null>(null);\n  const { tabs, activeId } = useTabsStore();\n  const activeTab = tabs.find(t => t.id === activeId);\n\n  // Auto-scroll to bottom\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  // Initialize speech recognition\n  useEffect(() => {\n    const SpeechRecognition =\n      (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\n\n    if (SpeechRecognition) {\n      const recognition = new SpeechRecognition();\n      recognition.continuous = false;\n      recognition.interimResults = false;\n      recognition.lang = 'en-US';\n\n      recognition.onresult = (event: any) => {\n        const transcript = Array.from(event.results)\n          .map((result: any) => result[0]?.transcript)\n          .join(' ')\n          .trim();\n\n        if (transcript) {\n          setInput(transcript);\n          handleSend(transcript);\n        }\n        setIsListening(false);\n      };\n\n      recognition.onerror = (event: any) => {\n        console.error('Speech recognition error:', event.error);\n        toast.error('Voice recognition failed. Please try again.');\n        setIsListening(false);\n      };\n\n      recognition.onend = () => {\n        setIsListening(false);\n      };\n\n      recognitionRef.current = recognition;\n    }\n\n    return () => {\n      if (recognitionRef.current) {\n        recognitionRef.current.stop();\n      }\n    };\n  }, []);\n\n  // Track pending confirmation\n  const [pendingConfirmation, setPendingConfirmation] = useState<{\n    orderId?: string;\n    pendingOrder: any;\n  } | null>(null);\n\n  const handleSend = async (text?: string) => {\n    const messageText = text || input.trim();\n    if (!messageText) return;\n\n    // Handle confirmation responses\n    if (pendingConfirmation) {\n      const lower = messageText.toLowerCase().trim();\n      const confirmed = lower === 'yes' || lower === 'y' || lower === 'confirm';\n\n      if (confirmed || lower === 'no' || lower === 'n' || lower === 'cancel') {\n        try {\n          const result = await ipc.regen.tradeConfirm({\n            orderId: pendingConfirmation.orderId,\n            confirmed,\n            pendingOrder: pendingConfirmation.pendingOrder,\n          });\n\n          const confirmationMessage: RegenMessage = {\n            id: `msg-${Date.now()}`,\n            role: 'assistant',\n            content: confirmed\n              ? `✅ Order placed successfully! Order ID: ${result.orderId || 'N/A'}`\n              : '❌ Order cancelled.',\n            timestamp: Date.now(),\n          };\n          setMessages(prev => [...prev, confirmationMessage]);\n          setPendingConfirmation(null);\n        } catch (error) {\n          console.error('[Regen] Trade confirmation failed:', error);\n          toast.error('Failed to process trade confirmation');\n        }\n        setInput('');\n        return;\n      }\n    }\n\n    setIsLoading(true);\n    setInput('');\n\n    // Add user message\n    const userMessage: RegenMessage = {\n      id: `msg-${Date.now()}`,\n      role: 'user',\n      content: messageText,\n      timestamp: Date.now(),\n    };\n    setMessages(prev => [...prev, userMessage]);\n\n    try {\n      // Send query via HTTP (response streams via WebSocket)\n      const socket = socketRef.current;\n      const clientId = socket?.getClientId() || `client-${Date.now()}`;\n\n      // Create placeholder message for streaming\n      const placeholderMessage: RegenMessage = {\n        id: `msg-${Date.now()}-streaming`,\n        role: 'assistant',\n        content: '',\n        timestamp: Date.now(),\n        done: false,\n      };\n      setMessages(prev => [...prev, placeholderMessage]);\n\n      const response = await fetch('http://localhost:4000/api/agent/query', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          clientId,\n          sessionId,\n          message: messageText,\n          mode,\n          source: text ? 'voice' : 'text',\n          tabId: activeTab?.id,\n          context: activeTab\n            ? {\n                url: activeTab.url,\n                title: activeTab.title,\n              }\n            : undefined,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Query failed');\n      }\n\n      // Response is streamed via WebSocket, so we don't need to process HTTP response\n      // The WebSocket handler above will receive the streaming events and update messages\n      // Commands are also executed automatically via WebSocket command events\n    } catch (error) {\n      console.error('[Regen] Query failed:', error);\n      toast.error('Failed to get response from Regen');\n\n      const errorMessage: RegenMessage = {\n        id: `msg-${Date.now() + 1}`,\n        role: 'assistant',\n        content: 'Sorry, I encountered an error. Please try again.',\n        timestamp: Date.now(),\n      };\n      setMessages(prev => [...prev, errorMessage]);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleVoiceToggle = () => {\n    if (!recognitionRef.current) {\n      toast.error('Voice recognition not available in this browser');\n      return;\n    }\n\n    if (isListening) {\n      recognitionRef.current.stop();\n      setIsListening(false);\n    } else {\n      recognitionRef.current.start();\n      setIsListening(true);\n    }\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col h-full bg-gray-900 border-l border-gray-700\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between p-4 border-b border-gray-700\">\n        <div className=\"flex items-center gap-2\">\n          <Sparkles className=\"w-5 h-5 text-blue-500\" />\n          <h2 className=\"text-lg font-semibold text-gray-200\">Regen</h2>\n          {isConnected ? (\n            <Wifi className=\"w-4 h-4 text-green-500\" aria-label=\"Connected\" />\n          ) : (\n            <WifiOff className=\"w-4 h-4 text-red-500\" aria-label=\"Disconnected\" />\n          )}\n        </div>\n        <button\n          onClick={async () => {\n            // Close sidebar via appStore\n            const { useAppStore } = await import('../../state/appStore');\n            useAppStore.getState().setRegenSidebarOpen(false);\n          }}\n          className=\"text-gray-400 hover:text-gray-300 transition-colors\"\n          aria-label=\"Close\"\n        >\n          <X className=\"w-5 h-5\" />\n        </button>\n      </div>\n\n      {/* Mode Toggles */}\n      <div className=\"flex gap-2 p-3 border-b border-gray-700\">\n        <button\n          onClick={() => setMode('research')}\n          className={`flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-colors ${\n            mode === 'research'\n              ? 'bg-blue-600 text-white'\n              : 'bg-gray-800 text-gray-400 hover:bg-gray-700'\n          }`}\n        >\n          <Search className=\"w-4 h-4\" />\n          <span className=\"text-sm font-medium\">Research</span>\n        </button>\n        <button\n          onClick={() => setMode('trade')}\n          className={`flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-colors ${\n            mode === 'trade'\n              ? 'bg-green-600 text-white'\n              : 'bg-gray-800 text-gray-400 hover:bg-gray-700'\n          }`}\n        >\n          <TrendingUp className=\"w-4 h-4\" />\n          <span className=\"text-sm font-medium\">Trade</span>\n        </button>\n      </div>\n\n      {/* Messages */}\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n        {messages.length === 0 && (\n          <div className=\"text-center text-gray-400 mt-8\">\n            <Sparkles className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n            <p className=\"text-sm\">Ask me anything or use voice commands</p>\n            {_currentStatus && <p className=\"text-xs mt-2 text-blue-400\">{_currentStatus}</p>}\n            <p className=\"text-xs mt-2 text-gray-500\">\n              {mode === 'research' ? (\n                <>\n                  Try: \"Find 5 best brokers for intraday trading in India and give detailed\n                  pros/cons\"\n                  <br />\n                  or \"Compare Zerodha, Upstox, Angel One for intraday trading\"\n                </>\n              ) : (\n                <>\n                  Try: \"Buy 10 shares of TCS at market\"\n                  <br />\n                  or \"Set SL at 1% and target 3%\"\n                </>\n              )}\n            </p>\n          </div>\n        )}\n\n        {messages.map(msg => (\n          <div\n            key={msg.id}\n            className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}\n          >\n            <div\n              className={`max-w-[80%] rounded-lg px-4 py-2 ${\n                msg.role === 'user' ? 'bg-blue-600 text-white' : 'bg-gray-800 text-gray-200'\n              }`}\n            >\n              <p className=\"text-sm whitespace-pre-wrap\">{msg.content}</p>\n              {msg.commands && msg.commands.length > 0 && (\n                <div className=\"mt-2 text-xs opacity-75\">\n                  {msg.commands.length} command(s) executed\n                </div>\n              )}\n            </div>\n          </div>\n        ))}\n\n        {isLoading && (\n          <div className=\"flex justify-start\">\n            <div className=\"bg-gray-800 rounded-lg px-4 py-2\">\n              <Loader2 className=\"w-4 h-4 animate-spin text-gray-400\" />\n            </div>\n          </div>\n        )}\n\n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* Hands-Free Mode Toggle */}\n      <div className=\"px-4 py-2 border-t border-gray-700 flex items-center justify-between bg-gray-800/50\">\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-xs text-gray-400\">Hands-Free Mode</span>\n          <button\n            onClick={() => setHandsFreeMode(!handsFreeMode)}\n            className={`relative w-10 h-5 rounded-full transition-colors ${\n              handsFreeMode ? 'bg-blue-600' : 'bg-gray-700'\n            }`}\n            aria-label=\"Toggle hands-free mode\"\n          >\n            <span\n              className={`absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full transition-transform ${\n                handsFreeMode ? 'translate-x-5' : 'translate-x-0'\n              }`}\n            />\n          </button>\n        </div>\n        {handsFreeMode && (\n          <div className=\"text-xs text-blue-400 animate-pulse flex items-center gap-1\">\n            <Mic className=\"w-3 h-3\" />\n            <span>Listening...</span>\n          </div>\n        )}\n      </div>\n\n      {/* Input */}\n      <div className=\"p-4 border-t border-gray-700\">\n        <div className=\"flex items-center gap-2\">\n          <button\n            onClick={handleVoiceToggle}\n            className={`p-2 rounded transition-colors ${\n              isListening ? 'bg-red-600 text-white' : 'bg-gray-800 text-gray-400 hover:bg-gray-700'\n            }`}\n            aria-label={isListening ? 'Stop listening' : 'Start voice input'}\n          >\n            {isListening ? <MicOff className=\"w-5 h-5\" /> : <Mic className=\"w-5 h-5\" />}\n          </button>\n          <input\n            type=\"text\"\n            value={input}\n            onChange={e => setInput(e.target.value)}\n            onKeyPress={handleKeyPress}\n            placeholder=\"Ask Regen anything...\"\n            className=\"flex-1 bg-gray-800 text-gray-200 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            disabled={isLoading}\n          />\n          <button\n            onClick={() => handleSend()}\n            disabled={isLoading || !input.trim()}\n            className=\"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n            aria-label=\"Send\"\n          >\n            <Send className=\"w-5 h-5\" />\n          </button>\n        </div>\n      </div>\n\n      {/* Hands-Free Mode Overlay */}\n      {handsFreeMode && (\n        <HandsFreeMode\n          sessionId={sessionId}\n          mode={mode}\n          onCommand={async cmd => {\n            // Execute browser commands\n            try {\n              switch (cmd.type) {\n                case 'OPEN_TAB':\n                  if (cmd.payload.url) {\n                    await ipc.regen.openTab({ url: cmd.payload.url as string });\n                  }\n                  break;\n                case 'SCROLL':\n                  if (cmd.payload.tabId) {\n                    await ipc.regen.scroll({\n                      tabId: cmd.payload.tabId as string,\n                      amount: (cmd.payload.amount as number) || 500,\n                    });\n                  }\n                  break;\n                case 'CLICK_ELEMENT':\n                  if (cmd.payload.tabId && cmd.payload.elementId) {\n                    await ipc.regen.clickElement({\n                      tabId: cmd.payload.tabId as string,\n                      selector: cmd.payload.elementId as string,\n                    });\n                  }\n                  break;\n                case 'GO_BACK':\n                  if (activeTab?.id) {\n                    await ipc.tabs.goBack(activeTab.id);\n                  }\n                  break;\n                case 'GO_FORWARD':\n                  if (activeTab?.id) {\n                    await ipc.tabs.goForward(activeTab.id);\n                  }\n                  break;\n              }\n            } catch (error) {\n              console.error('[HandsFree] Command execution failed:', error);\n            }\n          }}\n          onClose={() => setHandsFreeMode(false)}\n        />\n      )}\n    </div>\n  );\n}\n"],"file":"RegenSidebar-4rHIQNpC.js"}