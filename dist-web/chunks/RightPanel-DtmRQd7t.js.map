{"version":3,"mappings":"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","names":["AgentPlanner","goal","setGoal","useState","plan","setPlan","executing","setExecuting","results","setResults","mode","setMode","generatePlan","generatedPlan","ipc","error","executePlan","result","jsxs","jsx","Sparkles","e","step","index","motion","r","CheckCircle2","XCircle","key","value","Fragment","Loader2","Play","createId","estimateTokens","prompt","answer","combined","AIDockPanel","setPrompt","isSubmitting","setIsSubmitting","pinned","setPinned","history","setHistory","activeTab","useTabsStore","state","tab","t","latest","contextLabel","useMemo","handleSubmit","event","question","showToast","started","jobId","response","pollInterval","resultEndpoint","define_process_env_default","resultResponse","agentResult","sources","s","modelName","tokens","latencyMs","entry","prev","populateFollowUp","Pin","PinOff","Send","Bot","Timer","source","ExternalLink","actionIcons","Navigation","FileText","Search","Copy","actionColors","SmartActionButton","action","compact","status","setStatus","color","icon","handleClick","getStatusIcon","getColorClasses","base","SmartActionGroup","actions","className","EnhancedAIPanel","onClose","initialQuery","query","setQuery","setResponse","isStreaming","setIsStreaming","setError","copied","setCopied","smartActions","setSmartActions","responseEndRef","useRef","activeId","tabs","useEffect","urlRegex","url","idx","useAppStore","__vitePreload","n","chunk","err","handleVoiceResult","text","handleKeyDown","X","VoiceButton","Check","ACTION_LABELS","statusLabel","record","ListChecks","Zap","Lock","Activity","Shield","ShieldCheck","Leaf","KeyRound","Share2","RightPanel","open","setActiveTab","steps","setSteps","logs","setLogs","consentRecords","setConsentRecords","dryRun","setDryRun","logsEndRef","consentRefresh","useConsentOverlayStore","consentList","openConsentDashboard","useIPCEvent","data","AnimatePresence","Brain","Icon","log","formatDistanceToNow","PrivacyDashboard"],"ignoreList":[],"sources":["../../src/components/AgentPlanner.tsx","../../src/components/ai/AIDockPanel.tsx","../../src/components/ai/SmartActionButton.tsx","../../src/components/ai/EnhancedAIPanel.tsx","../../src/components/layout/RightPanel.tsx"],"sourcesContent":["/**\r\n * Agent Planner UI Component\r\n * Generate and execute multi-step plans\r\n */\r\n\r\nimport { useState } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { Play, Sparkles, CheckCircle2, XCircle, Loader2 } from 'lucide-react';\r\nimport { ipc } from '../lib/ipc-typed';\r\n\r\nexport interface PlanStep {\r\n  id: string;\r\n  action: string;\r\n  args: Record<string, unknown>;\r\n  expectedOutput?: string;\r\n}\r\n\r\nexport interface Plan {\r\n  id: string;\r\n  goal: string;\r\n  steps: PlanStep[];\r\n  estimatedDuration?: number;\r\n}\r\n\r\nexport function AgentPlanner() {\r\n  const [goal, setGoal] = useState('');\r\n  const [plan, setPlan] = useState<Plan | null>(null);\r\n  const [executing, setExecuting] = useState(false);\r\n  const [results, setResults] = useState<Array<{ stepId: string; success: boolean; result?: unknown; error?: string }>>([]);\r\n  const [mode, setMode] = useState<string>('');\r\n\r\n  const generatePlan = async () => {\r\n    if (!goal.trim()) return;\r\n\r\n    try {\r\n      const generatedPlan = await ipc.agent.generatePlanFromGoal({\r\n        goal,\r\n        mode: mode || undefined,\r\n      });\r\n      setPlan(generatedPlan);\r\n      setResults([]);\r\n    } catch (error) {\r\n      console.error('Failed to generate plan:', error);\r\n      alert(`Failed to generate plan: ${error instanceof Error ? error.message : String(error)}`);\r\n    }\r\n  };\r\n\r\n  const executePlan = async () => {\r\n    if (!plan) return;\r\n\r\n    setExecuting(true);\r\n    setResults([]);\r\n\r\n    try {\r\n      const result = await ipc.agent.executePlan({\r\n        planId: plan.id,\r\n        plan,\r\n      }) as { results: Array<{ stepId: string; success: boolean; result?: unknown; error?: string }> };\r\n      setResults(result.results || []);\r\n    } catch (error) {\r\n      console.error('Failed to execute plan:', error);\r\n      alert(`Failed to execute plan: ${error instanceof Error ? error.message : String(error)}`);\r\n    } finally {\r\n      setExecuting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-4 p-6 bg-gray-900/50 rounded-lg border border-gray-800\">\r\n      <div className=\"flex items-center gap-2\">\r\n        <Sparkles className=\"w-5 h-5 text-purple-400\" />\r\n        <h2 className=\"text-lg font-semibold text-gray-100\">Agent Planner</h2>\r\n      </div>\r\n\r\n      {/* Goal Input */}\r\n      <div className=\"flex flex-col gap-2\">\r\n        <label className=\"text-sm text-gray-400\">Goal</label>\r\n        <textarea\r\n          value={goal}\r\n          onChange={(e) => setGoal(e.target.value)}\r\n          placeholder=\"What do you want the agent to accomplish? (e.g., 'Research quantum computing breakthroughs')\"\r\n          className=\"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500\"\r\n          rows={3}\r\n        />\r\n        <input\r\n          type=\"text\"\r\n          value={mode}\r\n          onChange={(e) => setMode(e.target.value)}\r\n          placeholder=\"Mode (optional): research, trade, game, etc.\"\r\n          className=\"px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500\"\r\n        />\r\n        <button\r\n          onClick={generatePlan}\r\n          disabled={!goal.trim()}\r\n          className=\"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-700 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center justify-center gap-2\"\r\n        >\r\n          <Sparkles size={16} />\r\n          Generate Plan\r\n        </button>\r\n      </div>\r\n\r\n      {/* Plan Display */}\r\n      {plan && (\r\n        <div className=\"flex flex-col gap-3\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <h3 className=\"text-sm font-semibold text-gray-300\">Generated Plan</h3>\r\n            <div className=\"text-xs text-gray-500\">\r\n              {plan.steps.length} steps â€¢ ~{plan.estimatedDuration || 0}s\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex flex-col gap-2\">\r\n            {plan.steps.map((step, index) => (\r\n              <motion.div\r\n                key={step.id}\r\n                initial={{ opacity: 0, y: 10 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                className=\"px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-lg\"\r\n              >\r\n                <div className=\"flex items-start gap-3\">\r\n                  <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-purple-600/20 flex items-center justify-center text-purple-400 text-xs font-semibold\">\r\n                    {index + 1}\r\n                  </div>\r\n                  <div className=\"flex-1\">\r\n                    <div className=\"flex items-center gap-2 mb-1\">\r\n                      <span className=\"text-sm font-medium text-gray-200\">{step.action}</span>\r\n                      {results.find(r => r.stepId === step.id) && (\r\n                        results.find(r => r.stepId === step.id)?.success ? (\r\n                          <CheckCircle2 size={14} className=\"text-green-400\" />\r\n                        ) : (\r\n                          <XCircle size={14} className=\"text-red-400\" />\r\n                        )\r\n                      )}\r\n                    </div>\r\n                    <div className=\"text-xs text-gray-400 mb-1\">\r\n                      {Object.entries(step.args).map(([key, value]) => (\r\n                        <span key={key} className=\"mr-2\">\r\n                          <span className=\"text-gray-500\">{key}:</span> {String(value).substring(0, 50)}\r\n                        </span>\r\n                      ))}\r\n                    </div>\r\n                    {step.expectedOutput && (\r\n                      <div className=\"text-xs text-gray-500 italic\">\r\n                        Expected: {step.expectedOutput}\r\n                      </div>\r\n                    )}\r\n                    {results.find(r => r.stepId === step.id)?.error && (\r\n                      <div className=\"text-xs text-red-400 mt-1\">\r\n                        Error: {results.find(r => r.stepId === step.id)?.error}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </motion.div>\r\n            ))}\r\n          </div>\r\n\r\n          <button\r\n            onClick={executePlan}\r\n            disabled={executing}\r\n            className=\"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-700 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex items-center justify-center gap-2\"\r\n          >\r\n            {executing ? (\r\n              <>\r\n                <Loader2 size={16} className=\"animate-spin\" />\r\n                Executing...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Play size={16} />\r\n                Execute Plan\r\n              </>\r\n            )}\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n","import { useMemo, useState } from 'react';\nimport { motion } from 'framer-motion';\nimport { Bot, ExternalLink, Loader2, Pin, PinOff, Send, Sparkles, Timer } from 'lucide-react';\n\nimport { ipc } from '../../lib/ipc-typed';\nimport { useTabsStore } from '../../state/tabsStore';\nimport { showToast } from '../../state/toastStore';\n\ntype DockEntry = {\n  id: string;\n  prompt: string;\n  answer: string;\n  timestamp: number;\n  latencyMs: number;\n  tokens: number;\n  model: string;\n  sources: string[];\n  scrape?: {\n    status: number;\n    cached: boolean;\n    fetchedAt?: string;\n  };\n};\n\nconst createId = () => {\n  if (typeof crypto !== 'undefined' && 'randomUUID' in crypto) {\n    return crypto.randomUUID();\n  }\n  return `dock-${Math.random().toString(36).slice(2, 10)}`;\n};\n\nconst estimateTokens = (prompt: string, answer: string) => {\n  const combined = prompt.length + answer.length;\n  return Math.max(32, Math.round(combined / 4));\n};\n\nexport function AIDockPanel() {\n  const [prompt, setPrompt] = useState('');\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [pinned, setPinned] = useState(true);\n  const [history, setHistory] = useState<DockEntry[]>([]);\n  const activeTab = useTabsStore(state => {\n    const tab = state.tabs.find(t => t.id === state.activeId);\n    return tab ? { url: tab.url, title: tab.title } : null;\n  });\n\n  const latest = history[0];\n\n  const contextLabel = useMemo(() => {\n    if (!activeTab?.url) {\n      return 'general';\n    }\n    try {\n      const parsed = new URL(activeTab.url);\n      return parsed.hostname;\n    } catch {\n      return 'current page';\n    }\n  }, [activeTab?.url]);\n\n  const handleSubmit = async (event: React.FormEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    const question = prompt.trim();\n    if (!question || isSubmitting) {\n      return;\n    }\n\n    if (!activeTab?.url) {\n      showToast('error', 'Open a tab to provide page context.');\n      return;\n    }\n\n    setIsSubmitting(true);\n    const started = performance.now();\n    let jobId: string | null = null;\n\n    try {\n      const response = await ipc.agent.askWithScrape({\n        url: activeTab.url,\n        question,\n        task: 'qa',\n        waitFor: 8,\n      });\n\n      // Handle 202 enqueued response - poll for result\n      if (response.status === 'enqueued' && response.jobId) {\n        jobId = response.jobId;\n        showToast('info', 'Fetching page safely... This may take a few seconds.');\n\n        // Poll for result\n        const pollInterval = setInterval(async () => {\n          try {\n            const resultEndpoint =\n              process.env.AGENT_QUERY_ENDPOINT?.replace('/api/agent/query', '') ||\n              'http://127.0.0.1:4000';\n            const resultResponse = await fetch(`${resultEndpoint}/api/agent/result/${jobId}/qa`, {\n              method: 'GET',\n              headers: { 'content-type': 'application/json' },\n            });\n\n            if (resultResponse.ok) {\n              clearInterval(pollInterval);\n              const result = await resultResponse.json();\n              if (result.status === 'complete' && result.agentResult) {\n                const agentResult = result.agentResult;\n                const answer = agentResult.answer?.trim() || 'No answer returned yet.';\n                const sources =\n                  Array.isArray(agentResult.sources) && agentResult.sources.length > 0\n                    ? agentResult.sources.map((s: { url: string }) => s.url)\n                    : [activeTab.url];\n\n                const modelName =\n                  typeof agentResult.model === 'string'\n                    ? agentResult.model\n                    : agentResult.model?.name || 'agent:auto';\n                const tokens =\n                  typeof agentResult.model === 'object' && agentResult.model.tokensUsed\n                    ? agentResult.model.tokensUsed\n                    : estimateTokens(question, answer);\n\n                const latencyMs = Math.round(performance.now() - started);\n\n                const entry: DockEntry = {\n                  id: jobId || createId(),\n                  prompt: question,\n                  answer,\n                  timestamp: Date.now(),\n                  latencyMs,\n                  tokens,\n                  model: modelName,\n                  sources,\n                  scrape: {\n                    status: agentResult.provenance?.status || 200,\n                    cached: agentResult.provenance?.cached || false,\n                    fetchedAt: agentResult.provenance?.fetchedAt,\n                  },\n                };\n\n                setHistory(prev => [entry, ...prev].slice(0, 5));\n                setPrompt('');\n                setIsSubmitting(false);\n              }\n            } else if (resultResponse.status === 404) {\n              // Still pending, continue polling\n            } else {\n              clearInterval(pollInterval);\n              throw new Error(`Polling failed: ${resultResponse.status}`);\n            }\n          } catch (error) {\n            clearInterval(pollInterval);\n            console.error('[AIDockPanel] polling failed', error);\n            showToast('error', 'Failed to get result');\n            setIsSubmitting(false);\n          }\n        }, 1000); // Poll every 1 second\n\n        // Timeout after 30 seconds\n        setTimeout(() => {\n          clearInterval(pollInterval);\n          if (isSubmitting) {\n            setIsSubmitting(false);\n            showToast('error', 'Request timed out. Please try again.');\n          }\n        }, 30000);\n\n        return;\n      }\n\n      // Handle immediate response (200)\n      const answer = response?.answer?.trim() || 'No answer returned yet.';\n      const sources =\n        Array.isArray(response?.sources) && response.sources.length > 0\n          ? response.sources\n          : [activeTab.url];\n\n      const modelName =\n        typeof response?.model === 'string'\n          ? response.model\n          : (typeof response?.model === 'object' &&\n            response.model !== null &&\n            'name' in response.model\n              ? (response.model as { name?: string }).name\n              : typeof response?.model === 'string'\n                ? response.model\n                : undefined) || 'agent:auto';\n      const tokens =\n        typeof response?.model === 'object' &&\n        (response.model as { tokensUsed?: number })?.tokensUsed\n          ? (response.model as { tokensUsed: number }).tokensUsed\n          : estimateTokens(question, answer);\n\n      const latencyMs = Math.round(performance.now() - started);\n\n      const entry: DockEntry = {\n        id: response?.jobId ?? createId(),\n        prompt: question,\n        answer,\n        timestamp: Date.now(),\n        latencyMs,\n        tokens,\n        model: modelName,\n        sources,\n        scrape: response?.scrape,\n      };\n\n      setHistory(prev => [entry, ...prev].slice(0, 5));\n      setPrompt('');\n    } catch (error) {\n      console.error('[AIDockPanel] ask failed', error);\n      showToast('error', error instanceof Error ? error.message : 'AI Dock request failed');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const populateFollowUp = () => {\n    if (!latest) return;\n    setPrompt(`Follow up on \"${latest.prompt}\": `);\n  };\n\n  return (\n    <section aria-label=\"AI Dock\" className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <p className=\"text-xs uppercase tracking-wide text-gray-400\">AI Dock</p>\n          <p className=\"text-sm text-gray-300\">Ask questions about the {contextLabel}</p>\n        </div>\n        <button\n          type=\"button\"\n          onClick={() => setPinned(state => !state)}\n          className={`inline-flex items-center gap-1 rounded-lg border px-2 py-1 text-xs transition ${\n            pinned\n              ? 'border-blue-500/60 bg-blue-500/10 text-blue-200'\n              : 'border-slate-700/60 bg-slate-900/60 text-slate-300 hover:bg-slate-800'\n          }`}\n        >\n          {pinned ? <Pin size={14} /> : <PinOff size={14} />}\n          {pinned ? 'Pinned' : 'Pin'}\n        </button>\n      </div>\n\n      <form onSubmit={handleSubmit} className=\"space-y-2\">\n        <label htmlFor=\"ai-dock-question\" className=\"sr-only\">\n          Ask the agent a question\n        </label>\n        <textarea\n          id=\"ai-dock-question\"\n          value={prompt}\n          onChange={event => setPrompt(event.target.value)}\n          disabled={isSubmitting}\n          rows={3}\n          placeholder=\"Ask Omni about this page, summarize findings, or request an action...\"\n          className=\"w-full rounded-xl border border-slate-700/70 bg-slate-900/60 px-3 py-2 text-sm text-gray-200 placeholder:text-gray-500 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500/40\"\n        />\n        <div className=\"flex items-center justify-between text-xs text-gray-500\">\n          <span>{prompt.length} chars</span>\n          <button\n            type=\"submit\"\n            disabled={!prompt.trim() || isSubmitting}\n            className=\"inline-flex items-center gap-2 rounded-full bg-blue-600/80 px-3 py-1.5 text-sm font-medium text-white transition hover:bg-blue-600 disabled:opacity-60\"\n          >\n            {isSubmitting ? <Loader2 size={14} className=\"animate-spin\" /> : <Send size={14} />}\n            Ask\n          </button>\n        </div>\n      </form>\n\n      {latest && (\n        <motion.div\n          layout\n          className=\"space-y-3 rounded-xl border border-slate-700/70 bg-slate-900/60 p-3\"\n        >\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2 text-sm font-medium text-gray-200\">\n              <Sparkles size={16} className=\"text-blue-300\" />\n              Latest answer\n            </div>\n            <button\n              type=\"button\"\n              onClick={populateFollowUp}\n              className=\"text-xs font-medium text-blue-300 hover:text-blue-200\"\n            >\n              Ask follow-up\n            </button>\n          </div>\n          <p className=\"text-sm text-gray-300 whitespace-pre-wrap\">{latest.answer}</p>\n          {latest.scrape && (\n            <div className=\"text-xs text-gray-500 flex flex-wrap items-center gap-3\">\n              <span>{latest.scrape.cached ? 'Cached result' : 'Fresh fetch'}</span>\n              <span>HTTP {latest.scrape.status}</span>\n              {latest.scrape.fetchedAt && (\n                <span>{new Date(latest.scrape.fetchedAt).toLocaleTimeString()}</span>\n              )}\n            </div>\n          )}\n          <div className=\"rounded-lg border border-slate-800/70 bg-slate-950/60 p-2 text-xs text-gray-400\">\n            <div className=\"flex flex-wrap items-center gap-3\">\n              <span className=\"inline-flex items-center gap-1\">\n                <Bot size={12} /> {latest.model}\n              </span>\n              <span className=\"inline-flex items-center gap-1\">\n                <Timer size={12} /> {latest.latencyMs} ms\n              </span>\n              <span>{latest.tokens} tokens (est.)</span>\n              <span>{new Date(latest.timestamp).toLocaleTimeString()}</span>\n            </div>\n            {latest.sources.length > 0 && (\n              <div className=\"mt-2 flex flex-wrap items-center gap-2\">\n                <span className=\"text-gray-500\">Sources:</span>\n                {latest.sources.map((source, index) => (\n                  <button\n                    key={`${latest.id}-source-${index}`}\n                    type=\"button\"\n                    onClick={() => window.open(source, '_blank')}\n                    className=\"inline-flex items-center gap-1 rounded-full border border-slate-800/70 px-2 py-0.5 text-[11px] text-blue-200 hover:border-blue-500/60\"\n                  >\n                    <ExternalLink size={12} />\n                    {source.replace(/https?:\\/\\//, '').slice(0, 42)}\n                  </button>\n                ))}\n              </div>\n            )}\n          </div>\n        </motion.div>\n      )}\n\n      {history.length > 1 && (\n        <div className=\"space-y-2\">\n          <div className=\"text-xs uppercase tracking-wide text-gray-500\">Recent questions</div>\n          <div className=\"space-y-2\">\n            {history.slice(1).map(entry => (\n              <button\n                key={entry.id}\n                type=\"button\"\n                onClick={() => setPrompt(entry.prompt)}\n                className=\"w-full rounded-xl border border-transparent bg-slate-900/40 p-3 text-left text-sm text-gray-300 transition hover:border-slate-700/70\"\n              >\n                <div className=\"flex items-center justify-between text-xs text-gray-500\">\n                  <span>{new Date(entry.timestamp).toLocaleTimeString()}</span>\n                  <span>{entry.tokens} tokens</span>\n                </div>\n                <p className=\"mt-1 line-clamp-2 text-sm text-gray-200\">{entry.prompt}</p>\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n    </section>\n  );\n}\n","/**\n * SmartActionButton - AI-generated action button with visual feedback\n * Based on Figma UI/UX Prototype Flow redesign\n */\n\nimport { useState } from 'react';\nimport { motion } from 'framer-motion';\nimport {\n  Navigation,\n  ExternalLink,\n  Copy,\n  FileText,\n  Search,\n  Loader2,\n  CheckCircle2,\n  XCircle,\n} from 'lucide-react';\n\nexport type SmartActionType =\n  | 'navigate'\n  | 'openTab'\n  | 'duplicateTab'\n  | 'notes'\n  | 'research'\n  | 'copy'\n  | 'search';\n\nexport interface SmartAction {\n  id: string;\n  type: SmartActionType;\n  label: string;\n  description?: string;\n  icon?: React.ReactNode;\n  onClick: () => void | Promise<void>;\n}\n\nconst actionIcons: Record<SmartActionType, React.ReactNode> = {\n  navigate: <Navigation size={16} />,\n  openTab: <ExternalLink size={16} />,\n  duplicateTab: <ExternalLink size={16} />,\n  notes: <FileText size={16} />,\n  research: <Search size={16} />,\n  copy: <Copy size={16} />,\n  search: <Search size={16} />,\n};\n\nconst actionColors: Record<SmartActionType, string> = {\n  navigate: 'blue',\n  openTab: 'green',\n  duplicateTab: 'purple',\n  notes: 'amber',\n  research: 'indigo',\n  copy: 'gray',\n  search: 'blue',\n};\n\nexport interface SmartActionButtonProps {\n  action: SmartAction;\n  compact?: boolean;\n}\n\nexport function SmartActionButton({ action, compact = false }: SmartActionButtonProps) {\n  const [status, setStatus] = useState<'idle' | 'loading' | 'success' | 'error'>('idle');\n\n  const color = actionColors[action.type];\n  const icon = action.icon || actionIcons[action.type];\n\n  const handleClick = async () => {\n    setStatus('loading');\n    try {\n      await action.onClick();\n      setStatus('success');\n      setTimeout(() => setStatus('idle'), 2000);\n    } catch (error) {\n      console.error('[SmartActionButton] Action failed:', error);\n      setStatus('error');\n      setTimeout(() => setStatus('idle'), 2000);\n    }\n  };\n\n  const getStatusIcon = () => {\n    switch (status) {\n      case 'loading':\n        return <Loader2 size={14} className=\"animate-spin\" />;\n      case 'success':\n        return <CheckCircle2 size={14} className=\"text-green-400\" />;\n      case 'error':\n        return <XCircle size={14} className=\"text-red-400\" />;\n      default:\n        return icon;\n    }\n  };\n\n  const getColorClasses = () => {\n    const base = `border-${color}-500/40 bg-${color}-500/15 hover:bg-${color}-500/25 text-${color}-200`;\n    if (status === 'success') {\n      return `border-green-500/40 bg-green-500/15 text-green-200`;\n    }\n    if (status === 'error') {\n      return `border-red-500/40 bg-red-500/15 text-red-200`;\n    }\n    return base;\n  };\n\n  return (\n    <motion.button\n      onClick={handleClick}\n      disabled={status === 'loading'}\n      whileHover={{ scale: status === 'idle' ? 1.02 : 1 }}\n      whileTap={{ scale: 0.98 }}\n      className={`\n        flex items-center gap-2 px-3 py-2 rounded-lg border transition-all\n        ${getColorClasses()}\n        ${compact ? 'text-xs' : 'text-sm'}\n        ${status === 'loading' ? 'cursor-wait opacity-75' : 'cursor-pointer'}\n        focus:outline-none focus:ring-2 focus:ring-${color}-500/40\n      `}\n      title={action.description || action.label}\n    >\n      {getStatusIcon()}\n      {!compact && <span className=\"font-medium\">{action.label}</span>}\n      {action.description && !compact && (\n        <span className=\"text-xs opacity-75 truncate max-w-[200px]\">{action.description}</span>\n      )}\n    </motion.button>\n  );\n}\n\nexport interface SmartActionGroupProps {\n  actions: SmartAction[];\n  compact?: boolean;\n  className?: string;\n}\n\nexport function SmartActionGroup({\n  actions,\n  compact = false,\n  className = '',\n}: SmartActionGroupProps) {\n  if (actions.length === 0) return null;\n\n  return (\n    <div className={`flex flex-wrap gap-2 ${className}`}>\n      {actions.map(action => (\n        <SmartActionButton key={action.id} action={action} compact={compact} />\n      ))}\n    </div>\n  );\n}\n","/**\n * EnhancedAIPanel - AI Assistant Panel with Smart Actions and Voice Input\n * Based on Figma UI/UX Prototype Flow redesign\n */\n\nimport { useState, useRef, useEffect } from 'react';\nimport { motion } from 'framer-motion';\nimport { Sparkles, Send, X, Loader2, Copy, Check } from 'lucide-react';\nimport { SmartActionGroup, type SmartAction } from './SmartActionButton';\nimport { ipc } from '../../lib/ipc-typed';\nimport { useTabsStore } from '../../state/tabsStore';\nimport VoiceButton from '../VoiceButton';\n\nexport interface EnhancedAIPanelProps {\n  onClose?: () => void;\n  initialQuery?: string;\n}\n\nexport function EnhancedAIPanel({ onClose, initialQuery = '' }: EnhancedAIPanelProps) {\n  const [query, setQuery] = useState(initialQuery);\n  const [response, setResponse] = useState<string>('');\n  const [isStreaming, setIsStreaming] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [copied, setCopied] = useState(false);\n  const [smartActions, setSmartActions] = useState<SmartAction[]>([]);\n  const responseEndRef = useRef<HTMLDivElement>(null);\n  const { activeId, tabs } = useTabsStore();\n  const activeTab = tabs.find(t => t.id === activeId);\n\n  // Auto-scroll to bottom as response streams\n  useEffect(() => {\n    if (responseEndRef.current && isStreaming) {\n      responseEndRef.current.scrollIntoView({ behavior: 'smooth' });\n    }\n  }, [response, isStreaming]);\n\n  // Generate smart actions from response\n  useEffect(() => {\n    if (!response || isStreaming) {\n      setSmartActions([]);\n      return;\n    }\n\n    // Extract potential actions from response\n    const actions: SmartAction[] = [];\n\n    // Check for URLs in response\n    const urlRegex = /https?:\\/\\/[^\\s]+/g;\n    const urls = response.match(urlRegex) || [];\n    urls.slice(0, 3).forEach((url, idx) => {\n      actions.push({\n        id: `navigate-${idx}`,\n        type: 'navigate',\n        label: 'Open URL',\n        description: url,\n        onClick: async () => {\n          await ipc.tabs.create(url);\n        },\n      });\n    });\n\n    // Add research action if query is research-related\n    if (query.toLowerCase().includes('research') || query.toLowerCase().includes('find')) {\n      actions.push({\n        id: 'research',\n        type: 'research',\n        label: 'Research This',\n        description: 'Start research session',\n        onClick: async () => {\n          // Trigger research mode\n          const { useAppStore } = await import('../../state/appStore');\n          useAppStore.getState().setMode('Research');\n        },\n      });\n    }\n\n    // Add copy action\n    if (response.length > 0) {\n      actions.push({\n        id: 'copy',\n        type: 'copy',\n        label: 'Copy Response',\n        onClick: async () => {\n          await navigator.clipboard.writeText(response);\n          setCopied(true);\n          setTimeout(() => setCopied(false), 2000);\n        },\n      });\n    }\n\n    setSmartActions(actions);\n  }, [response, query, isStreaming]);\n\n  const handleSubmit = async () => {\n    if (!query.trim() || isStreaming) return;\n\n    setError(null);\n    setResponse('');\n    setIsStreaming(true);\n    setSmartActions([]);\n\n    try {\n      // Stream AI response\n      await ipc.redix.stream(\n        query,\n        {\n          sessionId: `ai-panel-${Date.now()}`,\n        },\n        chunk => {\n          if (chunk.type === 'token' && chunk.text) {\n            setResponse(prev => prev + chunk.text);\n          } else if (chunk.type === 'done') {\n            setIsStreaming(false);\n          } else if (chunk.type === 'error') {\n            setIsStreaming(false);\n            setError(chunk.error || 'Failed to get AI response');\n          }\n        }\n      );\n    } catch (err) {\n      console.error('[EnhancedAIPanel] Error:', err);\n      setIsStreaming(false);\n      setError('Failed to get AI response. Please try again.');\n    }\n  };\n\n  const handleVoiceResult = (text: string) => {\n    setQuery(text);\n    // Auto-submit after voice input\n    setTimeout(() => {\n      handleSubmit();\n    }, 300);\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSubmit();\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col h-full bg-gray-900/95 backdrop-blur-xl\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between p-4 border-b border-gray-800/50\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"flex items-center justify-center w-8 h-8 rounded-full bg-emerald-500/20\">\n            <Sparkles size={16} className=\"text-emerald-400\" />\n          </div>\n          <h3 className=\"text-sm font-semibold text-gray-100\">AI Assistant</h3>\n        </div>\n        {onClose && (\n          <button\n            onClick={onClose}\n            className=\"p-1.5 rounded-lg text-gray-400 hover:text-gray-200 hover:bg-gray-800/60 transition-colors\"\n          >\n            <X size={16} />\n          </button>\n        )}\n      </div>\n\n      {/* Input Area */}\n      <div className=\"p-4 border-b border-gray-800/50 space-y-3\">\n        <div className=\"flex items-end gap-2\">\n          <div className=\"flex-1 relative\">\n            <textarea\n              value={query}\n              onChange={e => setQuery(e.target.value)}\n              onKeyDown={handleKeyDown}\n              placeholder=\"Ask AI assistant... (or use voice input)\"\n              className=\"w-full px-4 py-3 pr-12 bg-gray-800/60 border border-gray-700/50 rounded-lg text-sm text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/40 focus:border-emerald-500/40 resize-none\"\n              rows={3}\n              disabled={isStreaming}\n            />\n            <div className=\"absolute bottom-3 right-3 flex items-center gap-2\">\n              {query && (\n                <button\n                  onClick={handleSubmit}\n                  disabled={isStreaming || !query.trim()}\n                  className=\"p-1.5 rounded-lg bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-500/40 text-emerald-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                  title=\"Send (Enter)\"\n                >\n                  {isStreaming ? (\n                    <Loader2 size={14} className=\"animate-spin\" />\n                  ) : (\n                    <Send size={14} />\n                  )}\n                </button>\n              )}\n            </div>\n          </div>\n          <div className=\"flex flex-col gap-2\">\n            <VoiceButton onResult={handleVoiceResult} small={true} />\n          </div>\n        </div>\n\n        {/* Context Display */}\n        {activeTab && (\n          <div className=\"text-xs text-gray-500 flex items-center gap-2 px-2\">\n            <span>Context:</span>\n            <span className=\"text-gray-400 truncate\">{activeTab.title || activeTab.url}</span>\n          </div>\n        )}\n      </div>\n\n      {/* Response Area */}\n      <div className=\"flex-1 overflow-y-auto p-4\">\n        {isStreaming && !response && (\n          <div className=\"flex items-center gap-3 text-gray-400 py-8\">\n            <Loader2 size={16} className=\"animate-spin text-emerald-400\" />\n            <span className=\"text-sm\">AI is thinking...</span>\n          </div>\n        )}\n\n        {error && (\n          <div className=\"rounded-lg border border-red-500/40 bg-red-500/10 px-4 py-3 text-sm text-red-200\">\n            <p className=\"font-medium\">Error</p>\n            <p className=\"mt-1 text-xs text-red-300/80\">{error}</p>\n          </div>\n        )}\n\n        {response && (\n          <motion.div\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"space-y-4\"\n          >\n            <div className=\"prose prose-invert prose-sm max-w-none text-gray-200\">\n              <div className=\"whitespace-pre-wrap break-words\">\n                {response}\n                {isStreaming && (\n                  <span className=\"inline-block w-2 h-4 ml-1 bg-emerald-400 animate-pulse\" />\n                )}\n              </div>\n              <div ref={responseEndRef} />\n            </div>\n\n            {/* Smart Actions */}\n            {smartActions.length > 0 && (\n              <div className=\"pt-4 border-t border-gray-800/50\">\n                <div className=\"text-xs font-semibold text-gray-400 mb-3 uppercase tracking-wide\">\n                  Quick Actions\n                </div>\n                <SmartActionGroup actions={smartActions} />\n              </div>\n            )}\n\n            {/* Copy Button */}\n            {response && (\n              <div className=\"flex items-center justify-end pt-2\">\n                <button\n                  onClick={async () => {\n                    await navigator.clipboard.writeText(response);\n                    setCopied(true);\n                    setTimeout(() => setCopied(false), 2000);\n                  }}\n                  className=\"flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-800/60 hover:bg-gray-800 border border-gray-700/50 text-gray-300 hover:text-gray-100 transition-colors\"\n                >\n                  {copied ? (\n                    <>\n                      <Check size={14} />\n                      <span>Copied!</span>\n                    </>\n                  ) : (\n                    <>\n                      <Copy size={14} />\n                      <span>Copy</span>\n                    </>\n                  )}\n                </button>\n              </div>\n            )}\n          </motion.div>\n        )}\n\n        {!response && !isStreaming && !error && (\n          <div className=\"text-center py-12 text-gray-400\">\n            <Sparkles size={32} className=\"mx-auto mb-3 opacity-50\" />\n            <p className=\"text-sm mb-1\">Ask me anything</p>\n            <p className=\"text-xs text-gray-500\">\n              I can help with research, explanations, navigation, and more\n            </p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","/**\n * RightPanel - Enhanced Agent Console with live streams\n */\n\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  X,\n  Brain,\n  Zap,\n  FileText,\n  Shield,\n  ListChecks,\n  Activity,\n  Sparkles,\n  Share2,\n  Leaf,\n  ShieldCheck,\n  KeyRound,\n  Lock,\n} from 'lucide-react';\nimport { useState, useEffect, useRef } from 'react';\nimport { AgentPlan, AgentStep, ConsentRequest } from '../../lib/ipc-events';\nimport { useIPCEvent } from '../../lib/use-ipc-event';\nimport { AgentPlanner } from '../AgentPlanner';\nimport { useConsentOverlayStore } from '../../state/consentOverlayStore';\nimport { PrivacyDashboard } from '../integrations/PrivacyDashboard';\nimport type { ConsentRecord, ConsentActionType } from '../../types/consent';\nimport { formatDistanceToNow } from 'date-fns';\nimport { AIDockPanel } from '../ai/AIDockPanel';\nimport { EnhancedAIPanel } from '../ai/EnhancedAIPanel';\n\nconst ACTION_LABELS: Record<ConsentActionType, string> = {\n  download: 'Download file',\n  form_submit: 'Submit form',\n  login: 'Login',\n  scrape: 'Scrape content',\n  export_data: 'Export data',\n  access_clipboard: 'Clipboard access',\n  access_camera: 'Camera access',\n  access_microphone: 'Microphone access',\n  access_filesystem: 'Filesystem access',\n  ai_cloud: 'Cloud AI usage',\n};\n\nconst statusLabel = (record: ConsentRecord): { label: string; tone: string } => {\n  if (record.revokedAt) {\n    return { label: 'Revoked', tone: 'text-red-400 bg-red-500/10 border-red-500/40' };\n  }\n  if (record.approved) {\n    return { label: 'Approved', tone: 'text-emerald-300 bg-emerald-500/10 border-emerald-500/40' };\n  }\n  return { label: 'Pending', tone: 'text-amber-300 bg-amber-500/10 border-amber-500/40' };\n};\n\ninterface RightPanelProps {\n  open: boolean;\n  onClose: () => void;\n}\n\nconst tabs = [\n  { id: 'planner', icon: Sparkles, label: 'Planner' },\n  { id: 'plan', icon: ListChecks, label: 'Plan' },\n  { id: 'actions', icon: Zap, label: 'Actions' },\n  { id: 'privacy', icon: Lock, label: 'Privacy' },\n  { id: 'logs', icon: Activity, label: 'Logs' },\n  { id: 'memory', icon: FileText, label: 'Memory' },\n  { id: 'consent', icon: Shield, label: 'Consent' },\n  { id: 'trust', icon: ShieldCheck, label: 'Trust' },\n  { id: 'eco', icon: Leaf, label: 'Eco' },\n  { id: 'identity', icon: KeyRound, label: 'Identity' },\n  { id: 'nexus', icon: Share2, label: 'Nexus' },\n];\n\nexport function RightPanel({ open, onClose }: RightPanelProps) {\n  const [activeTab, setActiveTab] = useState('planner');\n  const [plan, setPlan] = useState<AgentPlan | null>(null);\n  const [steps, setSteps] = useState<AgentStep[]>([]);\n  const [logs, setLogs] = useState<string[]>([]);\n  const [consentRecords, setConsentRecords] = useState<ConsentRecord[]>([]);\n  const [dryRun, setDryRun] = useState(false);\n  const logsEndRef = useRef<HTMLDivElement>(null);\n  const consentRefresh = useConsentOverlayStore(state => state.refresh);\n  const consentList = useConsentOverlayStore(state => state.records);\n  const openConsentDashboard = useConsentOverlayStore(state => state.open);\n\n  // Listen for agent plan\n  useIPCEvent<AgentPlan>(\n    'agent:plan',\n    data => {\n      setPlan(data);\n    },\n    []\n  );\n\n  // Listen for agent steps\n  useIPCEvent<AgentStep>(\n    'agent:step',\n    data => {\n      setSteps(prev => [...prev, data]);\n    },\n    []\n  );\n\n  // Listen for agent logs\n  useIPCEvent<AgentStep>(\n    'agent:log',\n    data => {\n      setLogs(prev => [\n        ...prev,\n        `${new Date(data.timestamp).toLocaleTimeString()}: ${data.content}`,\n      ]);\n    },\n    []\n  );\n\n  // Listen for consent requests\n  useIPCEvent<ConsentRequest>(\n    'agent:consent:request',\n    () => {\n      void consentRefresh();\n    },\n    [consentRefresh]\n  );\n\n  // Auto-scroll logs\n  useEffect(() => {\n    if (activeTab === 'logs' && logsEndRef.current) {\n      logsEndRef.current.scrollIntoView({ behavior: 'smooth' });\n    }\n  }, [logs, activeTab]);\n\n  useEffect(() => {\n    setConsentRecords(consentList);\n  }, [consentList]);\n\n  useEffect(() => {\n    if (open && activeTab === 'consent') {\n      void consentRefresh();\n    }\n  }, [open, activeTab, consentRefresh]);\n\n  return (\n    <AnimatePresence>\n      {open && (\n        <motion.aside\n          initial={{ x: 400, opacity: 0 }}\n          animate={{ x: 0, opacity: 1 }}\n          exit={{ x: 400, opacity: 0 }}\n          transition={{ duration: 0.3, ease: 'easeInOut' }}\n          className=\"flex w-96 flex-col border-l border-gray-800/50 bg-gray-900/95 shadow-2xl backdrop-blur-xl\"\n        >\n          {/* Header */}\n          <div className=\"flex items-center justify-between border-b border-gray-800/50 p-4\">\n            <h2 className=\"flex items-center gap-2 text-lg font-semibold text-gray-200\">\n              <Brain size={20} className=\"text-blue-400\" />\n              Agent Console\n            </h2>\n            <button\n              onClick={onClose}\n              className=\"rounded-lg p-1.5 text-gray-400 transition-colors hover:bg-gray-800/60 hover:text-gray-200\"\n            >\n              <X size={18} />\n            </button>\n          </div>\n\n          {/* Enhanced AI Panel */}\n          {activeTab === 'planner' && (\n            <div className=\"border-b border-gray-800/50\">\n              <EnhancedAIPanel />\n            </div>\n          )}\n\n          {/* Legacy AI Dock (fallback) */}\n          {activeTab !== 'planner' && (\n            <div className=\"border-b border-gray-800/50 p-4\">\n              <AIDockPanel />\n            </div>\n          )}\n\n          {/* Tabs */}\n          <div className=\"flex overflow-x-auto border-b border-gray-800/50\">\n            {tabs.map(tab => {\n              const Icon = tab.icon;\n              return (\n                <button\n                  key={tab.id}\n                  onClick={() => setActiveTab(tab.id)}\n                  className={`relative flex min-w-[80px] flex-shrink-0 items-center justify-center gap-2 px-4 py-3 text-sm font-medium transition-colors ${activeTab === tab.id ? 'text-blue-400' : 'text-gray-500 hover:text-gray-300'} `}\n                >\n                  <Icon size={16} />\n                  <span className=\"hidden sm:inline\">{tab.label}</span>\n                  {activeTab === tab.id && (\n                    <motion.div\n                      className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-500\"\n                      layoutId=\"activeTab\"\n                    />\n                  )}\n                </button>\n              );\n            })}\n          </div>\n\n          {/* Content */}\n          <div className=\"flex-1 overflow-y-auto p-4\">\n            {activeTab === 'planner' && <AgentPlanner />}\n\n            {activeTab === 'plan' && (\n              <div className=\"space-y-4\">\n                {plan ? (\n                  <>\n                    <div className=\"rounded-lg border border-gray-700/30 bg-gray-800/40 p-4\">\n                      <div className=\"mb-2 text-xs text-gray-400\">Task: {plan.taskId}</div>\n                      <div className=\"space-y-2\">\n                        {plan.steps.map((step, idx) => (\n                          <div key={step.id} className=\"flex items-start gap-2 text-sm\">\n                            <div className=\"flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-blue-600/20 text-xs font-medium text-blue-400\">\n                              {idx + 1}\n                            </div>\n                            <div className=\"flex-1\">\n                              <div className=\"text-gray-200\">{step.description}</div>\n                              {step.tool && (\n                                <div className=\"mt-0.5 text-xs text-gray-500\">\n                                  Tool: {step.tool}\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                    <div className=\"flex items-center justify-between text-xs\">\n                      <div className=\"flex items-center gap-4\">\n                        <span className=\"text-gray-400\">\n                          Tokens: <span className=\"text-gray-200\">{plan.remaining.tokens}</span>/\n                          {plan.budget.tokens}\n                        </span>\n                        <span className=\"text-gray-400\">\n                          Time: <span className=\"text-gray-200\">{plan.remaining.seconds}s</span>/\n                          {plan.budget.seconds}s\n                        </span>\n                      </div>\n                    </div>\n                  </>\n                ) : (\n                  <div className=\"py-8 text-center text-xs text-gray-500\">\n                    No active plan. Create a task to see the agent's reasoning.\n                  </div>\n                )}\n              </div>\n            )}\n\n            {activeTab === 'actions' && (\n              <div className=\"space-y-2\">\n                <div className=\"mb-3 text-sm text-gray-400\">Tool Calls & Actions</div>\n                {steps.length > 0 ? (\n                  <div className=\"space-y-2\">\n                    {steps.map((step, idx) => (\n                      <motion.div\n                        key={idx}\n                        initial={{ opacity: 0, x: -10 }}\n                        animate={{ opacity: 1, x: 0 }}\n                        className=\"rounded border border-gray-700/30 bg-gray-800/40 p-3\"\n                      >\n                        <div className=\"mb-1 flex items-center justify-between\">\n                          <span className=\"text-xs font-medium text-gray-300\">{step.type}</span>\n                          <span className=\"text-xs text-gray-500\">\n                            {new Date(step.timestamp).toLocaleTimeString()}\n                          </span>\n                        </div>\n                        <div className=\"mt-1 whitespace-pre-wrap text-xs text-gray-400\">\n                          {step.content}\n                        </div>\n                      </motion.div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"py-8 text-center text-xs text-gray-500\">No actions yet</div>\n                )}\n              </div>\n            )}\n\n            {activeTab === 'logs' && (\n              <div className=\"space-y-1 font-mono text-xs\">\n                <div className=\"mb-2 text-sm text-gray-400\">Live Log Stream</div>\n                <div className=\"max-h-96 overflow-y-auto rounded bg-gray-950 p-3\">\n                  {logs.length > 0 ? (\n                    <>\n                      {logs.map((log, idx) => (\n                        <div key={idx} className=\"py-0.5 text-gray-400\">\n                          {log}\n                        </div>\n                      ))}\n                      <div ref={logsEndRef} />\n                    </>\n                  ) : (\n                    <div className=\"py-8 text-center text-gray-600\">No logs yet</div>\n                  )}\n                </div>\n              </div>\n            )}\n\n            {activeTab === 'memory' && (\n              <div className=\"space-y-2\">\n                <div className=\"mb-3 text-sm text-gray-400\">Session Notes & Data</div>\n                <div className=\"py-8 text-center text-xs text-gray-500\">No session data</div>\n              </div>\n            )}\n\n            {activeTab === 'consent' && (\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center justify-between text-sm text-gray-400\">\n                  <span>Consent Ledger</span>\n                  <button\n                    onClick={() => void openConsentDashboard()}\n                    className=\"rounded-lg border border-slate-700/60 bg-slate-900/70 px-2 py-1 text-[11px] text-gray-300 hover:bg-slate-900/90\"\n                  >\n                    Open dashboard\n                  </button>\n                </div>\n                {consentRecords.length > 0 ? (\n                  <div className=\"space-y-2\">\n                    {consentRecords.slice(0, 6).map(record => {\n                      const status = statusLabel(record);\n                      return (\n                        <div\n                          key={record.id}\n                          className=\"space-y-2 rounded-xl border border-slate-700/60 bg-slate-900/60 p-3\"\n                        >\n                          <div className=\"flex items-center justify-between text-xs text-gray-400\">\n                            <span className=\"font-medium text-gray-300\">\n                              {ACTION_LABELS[record.action.type]}\n                            </span>\n                            <span className={`rounded-full border px-2 py-0.5 ${status.tone}`}>\n                              {status.label}\n                            </span>\n                          </div>\n                          <div className=\"text-[11px] text-gray-500\">\n                            {record.action.description}\n                          </div>\n                          <div className=\"flex items-center gap-2 text-[10px] text-gray-600\">\n                            <span>\n                              {formatDistanceToNow(new Date(record.timestamp), { addSuffix: true })}\n                            </span>\n                            {record.action.target && <span>â€¢ {record.action.target}</span>}\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                ) : (\n                  <div className=\"py-8 text-center text-xs text-gray-500\">\n                    No consent records yet\n                  </div>\n                )}\n              </div>\n            )}\n\n            {activeTab === 'privacy' && <PrivacyDashboard />}\n\n            {activeTab === 'trust' && (\n              <div className=\"py-8 text-center text-xs text-gray-500\">\n                Trust panel is not available in this build\n              </div>\n            )}\n\n            {activeTab === 'eco' && (\n              <div className=\"py-8 text-center text-xs text-gray-500\">\n                Eco impact panel is not available in this build\n              </div>\n            )}\n\n            {activeTab === 'identity' && (\n              <div className=\"py-8 text-center text-xs text-gray-500\">\n                Identity vault panel is not available in this build\n              </div>\n            )}\n\n            {activeTab === 'nexus' && (\n              <div className=\"py-8 text-center text-xs text-gray-500\">\n                Extension nexus panel is not available in this build\n              </div>\n            )}\n          </div>\n\n          {/* Footer: Controls */}\n          <div className=\"space-y-2 border-t border-gray-800/50 p-4\">\n            <div className=\"flex items-center gap-2 text-xs text-gray-500\">\n              <input\n                type=\"checkbox\"\n                id=\"dry-run\"\n                checked={dryRun}\n                onChange={e => setDryRun(e.target.checked)}\n                className=\"rounded\"\n              />\n              <label htmlFor=\"dry-run\" className=\"cursor-pointer\">\n                Dry-Run Mode\n              </label>\n            </div>\n            {plan && (\n              <div className=\"flex flex-wrap items-center gap-2 text-xs\">\n                <span className=\"rounded bg-blue-500/20 px-2 py-1 text-blue-400\">\n                  {plan.remaining.tokens} tokens\n                </span>\n                <span className=\"rounded bg-green-500/20 px-2 py-1 text-green-400\">\n                  {plan.remaining.seconds}s\n                </span>\n                <span className=\"rounded bg-purple-500/20 px-2 py-1 text-purple-400\">\n                  {plan.remaining.requests} requests\n                </span>\n              </div>\n            )}\n          </div>\n        </motion.aside>\n      )}\n    </AnimatePresence>\n  );\n}\n"],"file":"RightPanel-DtmRQd7t.js"}