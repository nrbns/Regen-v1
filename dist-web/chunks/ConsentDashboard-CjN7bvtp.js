import{r as m,j as e,b2 as w,O as _,D as S,t as R,bj as C,X as L,ab as D}from"./vendor-react-gmX1Lmvt.js";import{f as z}from"./AppShell-CJtR0Pw4.js";import{i as A}from"./core-ai-yFIunLTZ.js";import{m as E}from"./vendor-framer-motion-DDE19Uim.js";import{u as T,R as I,B as P,C as U}from"./vendor-reactflow-BGigvD3b.js";import{f as F}from"./vendor-utils-5Vdoy44w.js";import"./vendor-react-dom-Bkb6jJ_S.js";import"./vendor-Vl2WtvH-.js";import"../assets/index-D9cF9G1U.js";import"./vendor-zustand-BWsgwsXr.js";import"./mode-research-BclgCwOH.js";import"./core-memory-DmK-uh9X.js";import"./mode-docs-FcsoolLb.js";import"./vendor-pdf-ejcqEZLU.js";import"./vendor-mammoth-BPQIafDs.js";import"@tauri-apps/api/core";import"./mode-manager.ts-DwguZmJt.js";import"./History-kg0LrAO3.js";import"./Downloads-CU-ngJEB.js";import"./OmniDesk-C5fSodZ1.js";import"./WorkspacesPanel-3geKynW_.js";import"./bookmarksStore-CAScveEF.js";import"./workspacesStore-BSqEl-CQ.js";import"./tradeStore-CHfkU4NA.js";import"./dataService-HUHZrGu9.js";import"./registry-CG5fPtjR.js";import"./trustDashboardStore-BRaGSCcb.js";function B(){const[s,n]=m.useState(null),[r,o]=m.useState(!1),[i,g]=m.useState(null),u=async()=>{try{o(!0);const a=await A.consent.vault.export();n(a),o(!1)}catch(a){g(a instanceof Error?a.message:String(a)),o(!1)}};m.useEffect(()=>{u()},[]);const h=()=>{if(!s)return;const a=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),d=URL.createObjectURL(a),c=document.createElement("a");c.href=d,c.download=`consent-vault-${s.updatedAt}.json`,c.click(),URL.revokeObjectURL(d)};return e.jsxs("div",{className:"rounded-3xl border border-emerald-500/30 bg-emerald-950/20 p-4 text-emerald-100 shadow-[0_20px_60px_rgba(16,185,129,0.25)]",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-emerald-200",children:[e.jsx(w,{size:16})," Quantum Consent Vault"]}),e.jsx("div",{className:"text-xs text-emerald-100/70",children:"Each consent is sealed with a hash-chain signature. Export receipts for audits."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>void u(),className:"rounded-lg border border-emerald-400/40 bg-emerald-500/10 px-2 py-1 text-[11px] text-emerald-100 hover:bg-emerald-500/20",disabled:r,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{size:12,className:r?"animate-spin":""}),"Refresh"]})}),e.jsx("button",{type:"button",onClick:h,disabled:!s,className:"rounded-lg border border-emerald-400/40 bg-emerald-500/10 px-2 py-1 text-[11px] text-emerald-100 hover:bg-emerald-500/20 disabled:cursor-not-allowed disabled:opacity-60",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{size:12})," Export"]})})]})]}),i&&e.jsx("div",{className:"mt-3 rounded-lg border border-rose-500/40 bg-rose-500/10 px-3 py-2 text-[11px] text-rose-100",children:i}),!i&&e.jsxs("div",{className:"mt-4 max-h-64 overflow-y-auto rounded-2xl border border-emerald-500/15 bg-emerald-900/30",children:[!s&&r&&e.jsx("div",{className:"p-6 text-center text-xs text-emerald-100/70",children:"Loading quantum receipts…"}),s&&!r&&e.jsxs("div",{className:"divide-y divide-emerald-500/10 text-[11px]",children:[s.entries.map(a=>{const d=typeof a.metadata=="object"&&a.metadata!==null?a.metadata:void 0,c=typeof d?.risk=="string"?d.risk:void 0,l=typeof d?.target=="string"?d.target:void 0;return e.jsxs(E.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.18},className:"space-y-1 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-emerald-100",children:[e.jsx("span",{className:"font-medium uppercase tracking-wide text-[10px]",children:a.actionType}),e.jsx("span",{className:"text-emerald-200/70",children:new Date(a.timestamp).toLocaleString()})]}),e.jsxs("div",{className:"text-emerald-100/90 break-all",children:["Chain hash: ",a.chainHash]}),e.jsxs("div",{className:"text-emerald-100/70 break-all",children:["Signature: ",a.signature]}),c&&e.jsxs("div",{className:"text-emerald-100/70",children:["Risk: ",c]}),l&&e.jsxs("div",{className:"text-emerald-100/70 break-all",children:["Target: ",l]})]},a.chainHash)}),s.entries.length===0&&e.jsx("div",{className:"p-6 text-center text-xs text-emerald-200/70",children:"Ledger empty. Approve a consent request to generate the first block."})]})]}),s&&e.jsxs("div",{className:"mt-3 text-[10px] text-emerald-200/60",children:["Anchor hash: ",s.anchor]})]})}const p={download:"Download file",form_submit:"Submit form",login:"Login",scrape:"Scrape content",export_data:"Export data",access_clipboard:"Access clipboard",access_camera:"Access camera",access_microphone:"Access microphone",access_filesystem:"Filesystem access",ai_cloud:"Use cloud AI provider"},H=[{value:"all",label:"All actions"},{value:"download",label:p.download},{value:"form_submit",label:p.form_submit},{value:"login",label:p.login},{value:"scrape",label:p.scrape},{value:"export_data",label:p.export_data},{value:"access_clipboard",label:p.access_clipboard},{value:"access_camera",label:p.access_camera},{value:"access_microphone",label:p.access_microphone},{value:"access_filesystem",label:p.access_filesystem},{value:"ai_cloud",label:p.ai_cloud}],V=[{value:"all",label:"All statuses"},{value:"pending",label:"Pending"},{value:"approved",label:"Approved"},{value:"revoked",label:"Revoked"}],f={pending:0,approved:260,revoked:520},$=80,q=130,M=(f.approved+f.pending)/2,G=(f.revoked+f.approved)/2,X={pending:"border-slate-700/60 bg-slate-900/80 text-gray-200",approved:"border-emerald-500/40 bg-emerald-500/10 text-emerald-100",revoked:"border-red-500/40 bg-red-500/10 text-red-100"};function Y(s){return s==="high"?e.jsx(R,{size:14,className:"text-red-300"}):s==="medium"?e.jsx(C,{size:14,className:"text-amber-300"}):e.jsx(w,{size:14,className:"text-emerald-300"})}const Z=({data:s})=>{const{label:n,description:r,status:o,risk:i}=s;return e.jsxs("div",{className:`w-56 rounded-2xl border px-4 py-3 shadow-lg shadow-black/30 transition-colors duration-200 ${X[o]}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-xs font-semibold leading-tight line-clamp-1",children:n}),Y(i)]}),e.jsx("div",{className:"mt-2 text-[11px] leading-snug text-gray-300/80 line-clamp-3",children:r||"No additional context provided."}),o==="pending"&&e.jsxs("div",{className:"mt-3 rounded-lg border border-dashed border-amber-400/60 bg-amber-500/10 px-2 py-1 text-[10px] text-amber-100",children:["Drag into ",e.jsx("span",{className:"font-semibold",children:"Approve"})," or ",e.jsx("span",{className:"font-semibold",children:"Reject"})," lanes"]}),o==="approved"&&e.jsx("div",{className:"mt-3 rounded-lg border border-emerald-500/30 bg-emerald-500/10 px-2 py-1 text-[10px] text-emerald-100",children:"Approved and logged in ledger"}),o==="revoked"&&e.jsx("div",{className:"mt-3 rounded-lg border border-red-500/30 bg-red-500/10 px-2 py-1 text-[10px] text-red-100",children:"Revoked – access blocked"})]})},J={consent:Z};function K(s){return s.revokedAt?"revoked":s.approved?"approved":"pending"}function Q(s){const n={pending:[],approved:[],revoked:[]};return s.forEach(r=>{const o=K(r);n[o].push(r)}),["pending","approved","revoked"].flatMap(r=>n[r].slice(0,6).map((i,g)=>({id:i.id,type:"consent",position:{x:f[r],y:$+g*q},data:{record:i,label:p[i.action.type]??i.action.type,description:i.action.description??"—",status:r,risk:i.action.risk},draggable:r==="pending"})))}function W({records:s,onApprove:n,onRevoke:r,loading:o}){const[i,g,u]=T([]),h=m.useMemo(()=>[],[]);m.useEffect(()=>{g(Q(s))},[s,g]);const a=(c,l,b)=>{g(v=>v.map(x=>x.id===c?{...x,position:{x:f[l],y:b},data:{...x.data,status:l},draggable:l==="pending"}:x))},d=async(c,l)=>{const b=l.data?.record;if(!b||o){a(l.id,"pending",l.position.y);return}const{x:v,y:x}=l.position;if(v>=G){a(l.id,"revoked",x);try{await r(b.id)}catch(j){console.warn("[ConsentFlowGraph] revoke failed",j),a(l.id,"pending",x)}return}if(v>=M){a(l.id,"approved",x);try{await n(b.id)}catch(j){console.warn("[ConsentFlowGraph] approve failed",j),a(l.id,"pending",x)}return}a(l.id,"pending",x)};return e.jsxs("div",{className:"relative h-[360px] w-full overflow-hidden rounded-3xl border border-slate-800/60 bg-slate-950/40",children:[e.jsxs("div",{className:"pointer-events-none absolute inset-0 grid grid-cols-3",children:[e.jsxs("div",{className:"flex flex-col items-center justify-start gap-2 pt-4",children:[e.jsx("span",{className:"rounded-full border border-slate-700/60 bg-slate-900/70 px-3 py-1 text-[10px] uppercase tracking-[0.3em] text-gray-400",children:"Pending"}),e.jsx("span",{className:"text-[9px] text-gray-500",children:"Review requested actions"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-start gap-2 pt-4",children:[e.jsx("span",{className:"rounded-full border border-emerald-500/40 bg-emerald-500/10 px-3 py-1 text-[10px] uppercase tracking-[0.3em] text-emerald-200",children:"Approve"}),e.jsx("span",{className:"text-[9px] text-emerald-200/80",children:"Drop here to grant consent"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-start gap-2 pt-4",children:[e.jsx("span",{className:"rounded-full border border-red-500/40 bg-red-500/10 px-3 py-1 text-[10px] uppercase tracking-[0.3em] text-red-200",children:"Reject"}),e.jsx("span",{className:"text-[9px] text-red-200/80",children:"Drop here to revoke or deny"})]})]}),s.length===0&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center text-sm text-gray-500",children:"No consent requests yet — drag-to-approve suggestions will appear here."}),e.jsxs(I,{nodes:i,edges:h,onNodesChange:u,onNodeDragStop:d,nodeTypes:J,fitView:!0,fitViewOptions:{padding:.2},minZoom:.85,maxZoom:1.4,nodesDraggable:!0,nodesConnectable:!1,elementsSelectable:!1,zoomOnDoubleClick:!1,zoomOnScroll:!1,zoomOnPinch:!1,panOnDrag:!1,preventScrolling:!1,proOptions:{hideAttribution:!0},className:"h-full w-full",children:[e.jsx(P,{gap:24,color:"rgba(148, 163, 184, 0.15)"}),e.jsx(U,{position:"bottom-right",showInteractive:!1})]})]})}const ee=s=>s.revokedAt?{label:"Revoked",tone:"text-red-400 bg-red-500/10 border-red-500/40"}:s.approved?{label:"Approved",tone:"text-emerald-300 bg-emerald-500/10 border-emerald-500/40"}:{label:"Pending",tone:"text-amber-300 bg-amber-500/10 border-amber-500/40"},te=s=>s==="high"?e.jsx(R,{size:14,className:"text-red-400"}):s==="medium"?e.jsx(C,{size:14,className:"text-amber-400"}):e.jsx(w,{size:14,className:"text-emerald-400"});function Ae(){const{visible:s,records:n,loading:r,error:o,filter:i,close:g,refresh:u,setFilter:h,approve:a,revoke:d}=z(),[c,l]=m.useState(!1);m.useEffect(()=>{if(!s)return;const t=setInterval(()=>{u()},2e4);return()=>clearInterval(t)},[s,u]);const b=m.useMemo(()=>n.filter(t=>!t.approved).length,[n]),v=m.useMemo(()=>n.filter(t=>!!t.revokedAt).length,[n]),x=m.useMemo(()=>n.filter(t=>t.approved&&!t.revokedAt).length,[n]),j=async()=>{try{l(!0);const t=await A.consent.export(),y=new Blob([t],{type:"application/json"}),k=URL.createObjectURL(y),N=document.createElement("a");N.href=k,N.download=`regen-consent-ledger-${new Date().toISOString()}.json`,document.body.appendChild(N),N.click(),N.remove(),URL.revokeObjectURL(k)}catch(t){console.error("Failed to export consent ledger",t)}finally{l(!1)}},O=t=>{const y=ee(t),k=F(new Date(t.timestamp),{addSuffix:!0});return e.jsxs("div",{className:"rounded-2xl border border-slate-700/60 bg-slate-900/60 p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-200",children:[te(t.action.risk),e.jsx("span",{children:p[t.action.type]})]}),e.jsx("span",{className:`rounded-full border px-2 py-0.5 text-[11px] ${y.tone}`,children:y.label})]}),e.jsx("div",{className:"text-xs text-gray-400 leading-relaxed whitespace-pre-wrap",children:t.action.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-[11px] text-gray-500",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Target:"})," ",e.jsx("span",{className:"text-gray-200",children:t.action.target??"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Risk:"})," ",e.jsx("span",{className:"text-gray-200 capitalize",children:t.action.risk})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Requested:"})," ",e.jsx("span",{className:"text-gray-200",children:k})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Ledger ID:"})," ",e.jsxs("span",{className:"text-gray-500 font-mono text-[10px]",children:[t.id.slice(0,8),"…"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-gray-500",children:[e.jsx("span",{children:"Signature:"}),e.jsxs("span",{className:"font-mono truncate text-gray-600",children:[t.signature.slice(0,24),"…"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-[11px] text-gray-500",children:["User: ",e.jsx("span",{className:"text-gray-300",children:t.userId})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!t.approved&&!t.revokedAt&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>a(t.id),className:"rounded-lg border border-emerald-500/60 bg-emerald-500/10 px-3 py-1 text-xs font-medium text-emerald-200 hover:bg-emerald-500/20",children:"Approve"}),e.jsx("button",{onClick:()=>d(t.id),className:"rounded-lg border border-red-500/60 bg-red-500/10 px-3 py-1 text-xs font-medium text-red-300 hover:bg-red-500/20",children:"Reject"})]}),t.approved&&!t.revokedAt&&e.jsx("button",{onClick:()=>d(t.id),className:"rounded-lg border border-amber-500/50 bg-amber-500/10 px-3 py-1 text-xs font-medium text-amber-200 hover:bg-amber-500/20",children:"Revoke"})]})]})]},t.id)};return s?e.jsxs("div",{className:"fixed inset-0 z-[1100] flex items-center justify-center bg-black/75 backdrop-blur-sm",children:[e.jsxs(E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"relative w-[min(900px,92vw)] max-h-[90vh] overflow-hidden rounded-3xl border border-slate-700/70 bg-slate-950/95 text-gray-100 shadow-2xl",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-slate-800/60 px-6 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs uppercase tracking-wide text-emerald-300/80",children:[e.jsx(C,{size:14})," Consent Playground"]}),e.jsx("div",{className:"text-lg font-semibold text-white",children:"Review & control ethical AI memory"}),e.jsxs("div",{className:"text-[11px] text-gray-500",children:["Pending ",b," · Approved ",x," · Revoked ",v]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:j,disabled:c,className:"flex items-center gap-2 rounded-xl border border-slate-700/60 bg-slate-900/70 px-3 py-2 text-xs text-gray-200 hover:bg-slate-900/90 disabled:opacity-50",children:[e.jsx(S,{size:14,className:c?"animate-pulse":""})," Export Ledger"]}),e.jsx("button",{onClick:()=>u(),disabled:r,className:"rounded-xl border border-slate-700/60 bg-slate-900/70 p-2 text-gray-300 hover:bg-slate-900/90 disabled:opacity-50","aria-label":"Refresh consent ledger",children:e.jsx(_,{size:15,className:r?"animate-spin":""})}),e.jsx("button",{onClick:()=>g(),className:"rounded-full border border-slate-700/60 bg-slate-900/70 p-2 text-gray-300 hover:bg-slate-900/90","aria-label":"Close consent dashboard",children:e.jsx(L,{size:16})})]})]}),e.jsxs("div",{className:"flex flex-col gap-4 p-6 overflow-y-auto max-h-[75vh]",children:[e.jsx(W,{records:n,onApprove:a,onRevoke:d,loading:r}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-[minmax(0,1fr),auto]",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-gray-400",children:[e.jsx(D,{size:14}),e.jsx("select",{value:i.type??"all",onChange:t=>void h({type:t.target.value}),className:"rounded-lg border border-slate-700/60 bg-slate-900/70 px-2 py-1 text-gray-200",children:H.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("select",{value:i.status??"all",onChange:t=>void h({status:t.target.value}),className:"rounded-lg border border-slate-700/60 bg-slate-900/70 px-2 py-1 text-gray-200",children:V.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})}),o&&e.jsx("div",{className:"rounded-xl border border-red-500/50 bg-red-500/10 px-4 py-2 text-xs text-red-200",children:o}),r?e.jsx("div",{className:"flex items-center justify-center py-12 text-sm text-gray-400",children:"Loading consent ledger…"}):n.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 py-16 text-center text-sm text-gray-500",children:[e.jsx(w,{size:32,className:"text-emerald-400"}),e.jsx("div",{children:"No consent records yet. Run agent actions to populate the ledger."})]}):e.jsx("div",{className:"grid gap-3",children:n.map(O)})]})]}),e.jsx(B,{})]}):null}export{Ae as ConsentDashboard};
//# sourceMappingURL=ConsentDashboard-CjN7bvtp.js.map
