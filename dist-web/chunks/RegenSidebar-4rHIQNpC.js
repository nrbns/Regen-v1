const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/core-ai-yFIunLTZ.js","chunks/vendor-zustand-BWsgwsXr.js","chunks/vendor-react-gmX1Lmvt.js","chunks/vendor-react-dom-Bkb6jJ_S.js","chunks/vendor-Vl2WtvH-.js","chunks/mode-manager.ts-DwguZmJt.js","chunks/core-memory-DmK-uh9X.js"])))=>i.map(i=>d[i]);
import{t as j,i as w,a as K,_ as B}from"./core-ai-yFIunLTZ.js";import{r,j as e,ba as W,b9 as Q,b as _,M as $,X as A,S as P,bW as q,c2 as G,o as X,m as z,g as J,l as Z}from"./vendor-react-gmX1Lmvt.js";import"./vendor-zustand-BWsgwsXr.js";import"./vendor-Vl2WtvH-.js";import"./mode-manager.ts-DwguZmJt.js";import"./core-memory-DmK-uh9X.js";import"./vendor-react-dom-Bkb6jJ_S.js";function Y({sessionId:C,mode:N,onCommand:S,onClose:h}){const[l,v]=r.useState(!1),[u,m]=r.useState(!1),[i,I]=r.useState(!0),c=r.useRef(null),d=r.useRef(null),R=r.useRef(null);r.useEffect(()=>{const o=window.SpeechRecognition||window.webkitSpeechRecognition;if(o){const s=new o;s.continuous=!0,s.interimResults=!1,s.lang="en-US,ta-IN,hi-IN",s.onresult=async f=>{const k=Array.from(f.results).map(L=>L[0]?.transcript).join(" ").trim();k&&!u&&(m(!0),await T(k),m(!1))},s.onerror=f=>{console.error("Speech recognition error:",f.error),f.error!=="no-speech"&&(j.error("Voice recognition error. Please try again."),v(!1))},s.onend=()=>{if(l&&!u)try{s.start()}catch{}},c.current=s}return d.current=window.speechSynthesis,()=>{c.current&&c.current.stop(),d.current&&d.current.cancel()}},[l,u]);const T=async o=>{if(o.toLowerCase().includes("stop")||o.toLowerCase().includes("cancel")){R.current&&R.current.abort(),p("Stopped hands-free actions.");return}try{const s=await w.regen.query({sessionId:C,message:o,mode:N,source:"voice"});if(s.commands&&s.commands.length>0)for(const f of s.commands)S&&S(f);i&&s.text&&p(s.text)}catch(s){console.error("[HandsFree] Command failed:",s),p("Sorry, I encountered an error. Please try again.")}},p=o=>{if(!d.current||!i)return;d.current.cancel();const s=new SpeechSynthesisUtterance(o);s.lang="en-US",s.rate=1,s.pitch=1,s.volume=1,d.current.speak(s)},F=()=>{if(!c.current){j.error("Voice recognition not available in this browser");return}if(l)c.current.stop(),v(!1),d.current&&d.current.cancel();else try{c.current.start(),v(!0),p("Hands-free mode activated. I'm listening...")}catch(o){console.error("Failed to start recognition:",o),j.error("Failed to start voice recognition")}};return e.jsxs("div",{className:"fixed bottom-6 right-6 z-50 flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-gray-900 border border-gray-700 rounded-lg p-2 shadow-lg",children:[e.jsx("button",{onClick:()=>I(!i),className:`p-2 rounded transition-colors ${i?"bg-green-600 text-white hover:bg-green-700":"bg-gray-800 text-gray-400 hover:bg-gray-700"}`,"aria-label":i?"Disable TTS":"Enable TTS",children:i?e.jsx(W,{className:"w-4 h-4"}):e.jsx(Q,{className:"w-4 h-4"})}),e.jsx("button",{onClick:F,className:`p-3 rounded-full transition-colors ${l?"bg-red-600 text-white hover:bg-red-700 animate-pulse":"bg-blue-600 text-white hover:bg-blue-700"}`,"aria-label":l?"Stop listening":"Start listening",children:l?e.jsx(_,{className:"w-5 h-5"}):e.jsx($,{className:"w-5 h-5"})}),h&&e.jsx("button",{onClick:h,className:"p-2 text-gray-400 hover:text-gray-300 transition-colors","aria-label":"Close",children:e.jsx(A,{className:"w-4 h-4"})})]}),l&&e.jsx("div",{className:"bg-blue-600 text-white text-xs px-3 py-1 rounded-full",children:u?"Processing...":"Listening..."})]})}function ie(){const[C,N]=r.useState([]),[S,h]=r.useState(""),[l,v]=r.useState(!1),[u,m]=r.useState(!1),[i,I]=r.useState(!1),[c,d]=r.useState("research"),[R]=r.useState(()=>`regen-${Date.now()}`),[T]=r.useState(!1),[p,F]=r.useState(""),o=r.useRef(null),s=r.useRef(null),f=r.useRef(null),{tabs:k,activeId:L}=K(),x=k.find(t=>t.id===L);r.useEffect(()=>{o.current?.scrollIntoView({behavior:"smooth"})},[C]),r.useEffect(()=>{const t=window.SpeechRecognition||window.webkitSpeechRecognition;if(t){const a=new t;a.continuous=!1,a.interimResults=!1,a.lang="en-US",a.onresult=b=>{const n=Array.from(b.results).map(g=>g[0]?.transcript).join(" ").trim();n&&(h(n),O(n)),m(!1)},a.onerror=b=>{console.error("Speech recognition error:",b.error),j.error("Voice recognition failed. Please try again."),m(!1)},a.onend=()=>{m(!1)},s.current=a}return()=>{s.current&&s.current.stop()}},[]);const[E,V]=r.useState(null),O=async t=>{const a=t||S.trim();if(!a)return;if(E){const n=a.toLowerCase().trim(),g=n==="yes"||n==="y"||n==="confirm";if(g||n==="no"||n==="n"||n==="cancel"){try{const y=await w.regen.tradeConfirm({orderId:E.orderId,confirmed:g,pendingOrder:E.pendingOrder}),M={id:`msg-${Date.now()}`,role:"assistant",content:g?`✅ Order placed successfully! Order ID: ${y.orderId||"N/A"}`:"❌ Order cancelled.",timestamp:Date.now()};N(D=>[...D,M]),V(null)}catch(y){console.error("[Regen] Trade confirmation failed:",y),j.error("Failed to process trade confirmation")}h("");return}}v(!0),h("");const b={id:`msg-${Date.now()}`,role:"user",content:a,timestamp:Date.now()};N(n=>[...n,b]);try{const g=f.current?.getClientId()||`client-${Date.now()}`,y={id:`msg-${Date.now()}-streaming`,role:"assistant",content:"",timestamp:Date.now(),done:!1};if(N(D=>[...D,y]),!(await fetch("http://localhost:4000/api/agent/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientId:g,sessionId:R,message:a,mode:c,source:t?"voice":"text",tabId:x?.id,context:x?{url:x.url,title:x.title}:void 0})})).ok)throw new Error("Query failed")}catch(n){console.error("[Regen] Query failed:",n),j.error("Failed to get response from Regen");const g={id:`msg-${Date.now()+1}`,role:"assistant",content:"Sorry, I encountered an error. Please try again.",timestamp:Date.now()};N(y=>[...y,g])}finally{v(!1)}},H=()=>{if(!s.current){j.error("Voice recognition not available in this browser");return}u?(s.current.stop(),m(!1)):(s.current.start(),m(!0))},U=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),O())};return e.jsxs("div",{className:"flex flex-col h-full bg-gray-900 border-l border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-blue-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Regen"}),T?e.jsx(q,{className:"w-4 h-4 text-green-500","aria-label":"Connected"}):e.jsx(G,{className:"w-4 h-4 text-red-500","aria-label":"Disconnected"})]}),e.jsx("button",{onClick:async()=>{const{useAppStore:t}=await B(async()=>{const{useAppStore:a}=await import("./core-ai-yFIunLTZ.js").then(b=>b.Q);return{useAppStore:a}},__vite__mapDeps([0,1,2,3,4,5,6]));t.getState().setRegenSidebarOpen(!1)},className:"text-gray-400 hover:text-gray-300 transition-colors","aria-label":"Close",children:e.jsx(A,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex gap-2 p-3 border-b border-gray-700",children:[e.jsxs("button",{onClick:()=>d("research"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-colors ${c==="research"?"bg-blue-600 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"}`,children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Research"})]}),e.jsxs("button",{onClick:()=>d("trade"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-colors ${c==="trade"?"bg-green-600 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"}`,children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Trade"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[C.length===0&&e.jsxs("div",{className:"text-center text-gray-400 mt-8",children:[e.jsx(P,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Ask me anything or use voice commands"}),p&&e.jsx("p",{className:"text-xs mt-2 text-blue-400",children:p}),e.jsx("p",{className:"text-xs mt-2 text-gray-500",children:c==="research"?e.jsxs(e.Fragment,{children:['Try: "Find 5 best brokers for intraday trading in India and give detailed pros/cons"',e.jsx("br",{}),'or "Compare Zerodha, Upstox, Angel One for intraday trading"']}):e.jsxs(e.Fragment,{children:['Try: "Buy 10 shares of TCS at market"',e.jsx("br",{}),'or "Set SL at 1% and target 3%"']})})]}),C.map(t=>e.jsx("div",{className:`flex ${t.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-lg px-4 py-2 ${t.role==="user"?"bg-blue-600 text-white":"bg-gray-800 text-gray-200"}`,children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.content}),t.commands&&t.commands.length>0&&e.jsxs("div",{className:"mt-2 text-xs opacity-75",children:[t.commands.length," command(s) executed"]})]})},t.id)),l&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-800 rounded-lg px-4 py-2",children:e.jsx(J,{className:"w-4 h-4 animate-spin text-gray-400"})})}),e.jsx("div",{ref:o})]}),e.jsxs("div",{className:"px-4 py-2 border-t border-gray-700 flex items-center justify-between bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:"Hands-Free Mode"}),e.jsx("button",{onClick:()=>I(!i),className:`relative w-10 h-5 rounded-full transition-colors ${i?"bg-blue-600":"bg-gray-700"}`,"aria-label":"Toggle hands-free mode",children:e.jsx("span",{className:`absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full transition-transform ${i?"translate-x-5":"translate-x-0"}`})})]}),i&&e.jsxs("div",{className:"text-xs text-blue-400 animate-pulse flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"}),e.jsx("span",{children:"Listening..."})]})]}),e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:H,className:`p-2 rounded transition-colors ${u?"bg-red-600 text-white":"bg-gray-800 text-gray-400 hover:bg-gray-700"}`,"aria-label":u?"Stop listening":"Start voice input",children:u?e.jsx(_,{className:"w-5 h-5"}):e.jsx($,{className:"w-5 h-5"})}),e.jsx("input",{type:"text",value:S,onChange:t=>h(t.target.value),onKeyPress:U,placeholder:"Ask Regen anything...",className:"flex-1 bg-gray-800 text-gray-200 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:l}),e.jsx("button",{onClick:()=>O(),disabled:l||!S.trim(),className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Send",children:e.jsx(Z,{className:"w-5 h-5"})})]})}),i&&e.jsx(Y,{sessionId:R,mode:c,onCommand:async t=>{try{switch(t.type){case"OPEN_TAB":t.payload.url&&await w.regen.openTab({url:t.payload.url});break;case"SCROLL":t.payload.tabId&&await w.regen.scroll({tabId:t.payload.tabId,amount:t.payload.amount||500});break;case"CLICK_ELEMENT":t.payload.tabId&&t.payload.elementId&&await w.regen.clickElement({tabId:t.payload.tabId,selector:t.payload.elementId});break;case"GO_BACK":x?.id&&await w.tabs.goBack(x.id);break;case"GO_FORWARD":x?.id&&await w.tabs.goForward(x.id);break}}catch(a){console.error("[HandsFree] Command execution failed:",a)}},onClose:()=>I(!1)})]})}export{ie as RegenSidebar};
//# sourceMappingURL=RegenSidebar-4rHIQNpC.js.map
