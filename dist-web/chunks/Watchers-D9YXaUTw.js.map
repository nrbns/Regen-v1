{"version":3,"file":"Watchers-D9YXaUTw.js","sources":["../../src/routes/Watchers.tsx"],"sourcesContent":["// @ts-nocheck\r\n\r\nimport { useEffect, useMemo, useState } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { AlarmPlus, RefreshCw, Trash2, Activity } from 'lucide-react';\r\nimport { ipc } from '../lib/ipc-typed';\r\nimport { ipcEvents, PageWatcher } from '../lib/ipc-events';\r\n\r\ninterface WatcherFormState {\r\n  url: string;\r\n  intervalMinutes: number;\r\n}\r\n\r\nconst statusColors: Record<PageWatcher['status'], string> = {\r\n  idle: 'text-emerald-300 bg-emerald-500/10 border-emerald-500/30',\r\n  checking: 'text-blue-300 bg-blue-500/10 border-blue-500/30',\r\n  changed: 'text-amber-300 bg-amber-500/10 border-amber-500/30',\r\n  error: 'text-red-300 bg-red-500/10 border-red-500/30',\r\n};\r\n\r\nexport default function WatchersPage() {\r\n  const [watchers, setWatchers] = useState<PageWatcher[]>([]);\r\n  const [form, setForm] = useState<WatcherFormState>({ url: '', intervalMinutes: 15 });\r\n  const [loading, setLoading] = useState(true);\r\n  const [adding, setAdding] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const load = async () => {\r\n      try {\r\n        const list = await ipc.watchers.list();\r\n        if (Array.isArray(list)) {\r\n          setWatchers(list);\r\n        }\r\n      } catch (err) {\r\n        console.error('Failed to load watchers:', err);\r\n        setError(err instanceof Error ? err.message : String(err));\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    load();\r\n    const unsubscribeUpdated = ipcEvents.on<PageWatcher[]>('watchers:updated', (payload) => {\r\n      if (Array.isArray(payload)) {\r\n        setWatchers(payload);\r\n      }\r\n    });\r\n    const unsubscribeChanged = ipcEvents.on<PageWatcher>('watchers:changed', (payload) => {\r\n      if (payload?.id) {\r\n        setWatchers((prev) =>\r\n          prev.map((watcher) => (watcher.id === payload.id ? { ...watcher, ...payload } : watcher)),\r\n        );\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      unsubscribeUpdated();\r\n      unsubscribeChanged();\r\n    };\r\n  }, []);\r\n\r\n  const sortedWatchers = useMemo(\r\n    () =>\r\n      [...watchers].sort((a, b) => {\r\n        const aTime = a.lastChangeAt || a.lastCheckedAt || a.createdAt;\r\n        const bTime = b.lastChangeAt || b.lastCheckedAt || b.createdAt;\r\n        return bTime - aTime;\r\n      }),\r\n    [watchers],\r\n  );\r\n\r\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault();\r\n    setError(null);\r\n    if (!form.url.trim()) {\r\n      setError('Enter a valid URL.');\r\n      return;\r\n    }\r\n    setAdding(true);\r\n    try {\r\n      await ipc.watchers.add({ url: form.url.trim(), intervalMinutes: form.intervalMinutes });\r\n      setForm({ url: '', intervalMinutes: form.intervalMinutes });\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : String(err);\r\n      setError(message);\r\n    } finally {\r\n      setAdding(false);\r\n    }\r\n  };\r\n\r\n  const handleRemove = async (id: string) => {\r\n    try {\r\n      await ipc.watchers.remove(id);\r\n    } catch (err) {\r\n      console.error('Failed to remove watcher', err);\r\n    }\r\n  };\r\n\r\n  const handleTrigger = async (id: string) => {\r\n    try {\r\n      await ipc.watchers.trigger(id);\r\n    } catch (err) {\r\n      console.error('Failed to trigger watcher', err);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"h-full w-full bg-[#1A1D28] text-gray-100 flex flex-col\">\r\n      <header className=\"p-6 border-b border-gray-800/50 flex items-center justify-between\">\r\n        <div>\r\n          <h2 className=\"text-2xl font-bold flex items-center gap-2\">\r\n            <Activity size={22} className=\"text-emerald-400\" />\r\n            Page Change Watchers\r\n          </h2>\r\n          <p className=\"text-sm text-gray-400 mt-1\">\r\n            Receive alerts when tracked pages change. Checks run automatically at the interval you choose.\r\n          </p>\r\n        </div>\r\n      </header>\r\n\r\n      <main className=\"flex-1 overflow-y-auto p-6 space-y-6\">\r\n        <section className=\"bg-gray-900/70 rounded-xl border border-gray-800/60 p-5 shadow-lg shadow-black/20\">\r\n          <h3 className=\"text-lg font-semibold text-gray-200 flex items-center gap-2\">\r\n            <AlarmPlus size={18} />\r\n            Add watcher\r\n          </h3>\r\n          <p className=\"text-sm text-gray-400 mt-1\">\r\n            We’ll keep a hash of the page content and alert you whenever it changes.\r\n          </p>\r\n          <form onSubmit={handleSubmit} className=\"mt-4 flex flex-col gap-3 md:flex-row md:items-end\">\r\n            <div className=\"flex-1\">\r\n              <label className=\"block text-xs uppercase tracking-wide text-gray-500 mb-2\">Page URL</label>\r\n              <input\r\n                type=\"url\"\r\n                required\r\n                value={form.url}\r\n                onChange={(e) => setForm((prev) => ({ ...prev, url: e.target.value }))}\r\n                placeholder=\"https://example.com/page\"\r\n                className=\"w-full px-4 py-2.5 rounded-lg bg-gray-800/80 border border-gray-700/60 text-sm text-gray-100 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/50\"\r\n              />\r\n            </div>\r\n            <div className=\"w-full md:w-36\">\r\n              <label className=\"block text-xs uppercase tracking-wide text-gray-500 mb-2\">\r\n                Check every (minutes)\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                min={1}\r\n                max={1440}\r\n                value={form.intervalMinutes}\r\n                onChange={(e) =>\r\n                  setForm((prev) => ({ ...prev, intervalMinutes: Number.parseInt(e.target.value || '15', 10) }))\r\n                }\r\n                className=\"w-full px-4 py-2.5 rounded-lg bg-gray-800/80 border border-gray-700/60 text-sm text-gray-100 focus:outline-none focus:ring-2 focus:ring-emerald-500/50\"\r\n              />\r\n            </div>\r\n            <button\r\n              type=\"submit\"\r\n              disabled={adding}\r\n              className=\"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-emerald-600 hover:bg-emerald-500 transition disabled:opacity-60 text-sm font-semibold\"\r\n            >\r\n              {adding ? 'Adding…' : 'Add watcher'}\r\n            </button>\r\n          </form>\r\n          {error && <p className=\"text-sm text-red-400 mt-3\">{error}</p>}\r\n        </section>\r\n\r\n        <section>\r\n          <div className=\"flex items-center justify-between mb-3\">\r\n            <h3 className=\"text-lg font-semibold text-gray-200 flex items-center gap-2\">\r\n              Active watchers\r\n              <span className=\"text-xs text-gray-500\">({watchers.length})</span>\r\n            </h3>\r\n          </div>\r\n\r\n          {loading ? (\r\n            <div className=\"flex items-center justify-center py-20 text-gray-400 text-sm\">Loading watchers…</div>\r\n          ) : sortedWatchers.length === 0 ? (\r\n            <div className=\"flex flex-col items-center justify-center py-20 text-center text-gray-500\">\r\n              <p className=\"text-sm\">No watchers yet. Add a page to start monitoring changes.</p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-3\">\r\n              {sortedWatchers.map((watcher) => (\r\n                <motion.div\r\n                  key={watcher.id}\r\n                  initial={{ opacity: 0, y: 8 }}\r\n                  animate={{ opacity: 1, y: 0 }}\r\n                  className=\"bg-gray-900/60 border border-gray-800/60 rounded-lg p-4 hover:bg-gray-900/80 transition-all\"\r\n                >\r\n                  <div className=\"flex flex-col gap-3 md:flex-row md:items-start md:justify-between\">\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"flex items-center gap-2 mb-1\">\r\n                        <span\r\n                          className={`text-[11px] font-semibold uppercase tracking-wide px-2 py-0.5 rounded-full border ${statusColors[watcher.status]}`}\r\n                        >\r\n                          {watcher.status}\r\n                        </span>\r\n                        <span className=\"text-xs text-gray-500\">\r\n                          Every {watcher.intervalMinutes} min • Created{' '}\r\n                          {new Date(watcher.createdAt).toLocaleString()}\r\n                        </span>\r\n                      </div>\r\n                      <a\r\n                        href={watcher.url}\r\n                        target=\"_blank\"\r\n                        rel=\"noreferrer\"\r\n                        className=\"text-sm font-medium text-emerald-200 truncate hover:underline\"\r\n                        title={watcher.url}\r\n                      >\r\n                        {watcher.url}\r\n                      </a>\r\n                      <div className=\"text-xs text-gray-500 mt-1 space-x-3\">\r\n                        {watcher.lastCheckedAt && (\r\n                          <span>Last check: {new Date(watcher.lastCheckedAt).toLocaleString()}</span>\r\n                        )}\r\n                        {watcher.lastChangeAt && (\r\n                          <span className=\"text-amber-300\">\r\n                            Last change detected: {new Date(watcher.lastChangeAt).toLocaleString()}\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                      {watcher.error && (\r\n                        <div className=\"mt-2 text-xs text-red-400\">\r\n                          Error: {watcher.error}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <motion.button\r\n                        onClick={() => handleTrigger(watcher.id)}\r\n                        whileHover={{ scale: 1.05 }}\r\n                        whileTap={{ scale: 0.95 }}\r\n                        className=\"p-2 rounded-lg bg-gray-800/60 hover:bg-gray-800 border border-gray-700/60 text-gray-300 hover:text-blue-400 transition-colors\"\r\n                        title=\"Run check now\"\r\n                      >\r\n                        <RefreshCw size={16} />\r\n                      </motion.button>\r\n                      <motion.button\r\n                        onClick={() => handleRemove(watcher.id)}\r\n                        whileHover={{ scale: 1.05 }}\r\n                        whileTap={{ scale: 0.95 }}\r\n                        className=\"p-2 rounded-lg bg-gray-800/60 hover:bg-gray-800 border border-gray-700/60 text-gray-300 hover:text-red-400 transition-colors\"\r\n                        title=\"Remove watcher\"\r\n                      >\r\n                        <Trash2 size={16} />\r\n                      </motion.button>\r\n                    </div>\r\n                  </div>\r\n                </motion.div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </section>\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":["statusColors","WatchersPage","watchers","setWatchers","useState","form","setForm","loading","setLoading","adding","setAdding","error","setError","useEffect","list","ipc","err","unsubscribeUpdated","ipcEvents","payload","unsubscribeChanged","prev","watcher","sortedWatchers","useMemo","a","b","aTime","handleSubmit","e","message","handleRemove","id","handleTrigger","jsxs","jsx","Activity","AlarmPlus","motion","RefreshCw","Trash2"],"mappings":"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"}