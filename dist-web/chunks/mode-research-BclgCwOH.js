const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/core-ai-yFIunLTZ.js","chunks/vendor-zustand-BWsgwsXr.js","chunks/vendor-react-gmX1Lmvt.js","chunks/vendor-react-dom-Bkb6jJ_S.js","chunks/vendor-Vl2WtvH-.js","chunks/mode-manager.ts-DwguZmJt.js","chunks/core-memory-DmK-uh9X.js","chunks/workspacesStore-BSqEl-CQ.js","assets/index-D9cF9G1U.js","chunks/vendor-framer-motion-DDE19Uim.js","chunks/vendor-utils-5Vdoy44w.js","chunks/mode-docs-FcsoolLb.js","chunks/vendor-pdf-ejcqEZLU.js","chunks/vendor-mammoth-BPQIafDs.js","assets/index-D7i95XKH.css"])))=>i.map(i=>d[i]);
import{_ as oe,i as Z,u as Ce,t as H,a as ur,b as Ft,r as hr,c as ns,e as Ot,f as as}from"./core-ai-yFIunLTZ.js";import{r as b,j as s,M as is,b as os,S as he,I as cs,E as Xe,C as ls,c as ds,F as jt,D as us,d as hs,e as ms,T as ps,f as gs,L as fs,g as mr,h as xs,B as qt,i as bs,k as ys,X as pr,l as gr,G as ws,m as vs,o as fr,p as it,Z as js,U as Ss,R as Ns,q as ks}from"./vendor-react-gmX1Lmvt.js";import{l as zt}from"./vendor-utils-5Vdoy44w.js";import{s as _s}from"./core-memory-DmK-uh9X.js";import{p as $s,a as Cs}from"./mode-docs-FcsoolLb.js";import{m as ee,A as xr}from"./vendor-framer-motion-DDE19Uim.js";import{c as Ye,p as St}from"./vendor-zustand-BWsgwsXr.js";import{Z as As,o as re,n as Re,s as V,e as Ze,a as je,b as br,c as yr}from"./vendor-Vl2WtvH-.js";var Rs=Object.defineProperty,Es=(t,e,r)=>e in t?Rs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ts=(t,e,r)=>Es(t,e+"",r);class Is{constructor(){Ts(this,"prefix","[OMNI]")}formatMessage(e,...r){const n=new Date().toISOString();return`${this.prefix} [${n}] [${e.toUpperCase()}]`}info(...e){console.log(this.formatMessage("info"),...e)}warn(...e){console.warn(this.formatMessage("warn"),...e)}error(...e){console.error(this.formatMessage("error"),...e)}debug(...e){}}const M=new Is;var Ls=Object.defineProperty,Ms=(t,e,r)=>e in t?Ls(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ot=(t,e,r)=>Ms(t,typeof e!="symbol"?e+"":e,r);class Ds{constructor(){ot(this,"events",[]),ot(this,"maxEvents",1e3),ot(this,"enabled",!0)}track(e,r){if(!this.enabled)return;const n={name:e,timestamp:Date.now(),data:r};this.events.push(n),this.events.length>this.maxEvents&&this.events.shift()}getEvents(){return[...this.events]}getEventsByName(e){return this.events.filter(r=>r.name===e)}clear(){this.events=[]}setEnabled(e){this.enabled=e}async sendToBackend(e){}async flush(){this.events.length!==0&&([...this.events],this.events=[])}}const wr=new Ds;function Se(t,e){wr.track(t,e)}const hi=Object.freeze(Object.defineProperty({__proto__:null,analytics:wr,track:Se},Symbol.toStringTag,{value:"Module"})),Pe="http://127.0.0.1:7700",Qe="regen2026";async function Ps(t,e="id"){try{if((await fetch(`${Pe}/indexes/${t}`,{headers:{"X-Meili-API-Key":Qe}})).ok){console.log(`[MeiliSearch] Index "${t}" already exists`);return}const n=await fetch(`${Pe}/indexes`,{method:"POST",headers:{"Content-Type":"application/json","X-Meili-API-Key":Qe},body:JSON.stringify({uid:t,primaryKey:e})});if(!n.ok){const a=await n.text();throw new Error(`Failed to create index: ${a}`)}console.log(`[MeiliSearch] Created index "${t}"`)}catch(r){const n=String(r);throw!n.includes("401")&&!n.includes("Unauthorized")&&!n.includes("missing_authorization")&&console.error(`[MeiliSearch] Error ensuring index "${t}":`,r),r}}async function mi(t,e,r="id"){if(!e||e.length===0)return console.warn(`[MeiliSearch] No documents to index for "${t}"`),[];await Ps(t,r);const n=[];for(let i=0;i<e.length;i+=900)n.push(e.slice(i,i+900));const a=[];for(const i of n)try{const o=JSON.stringify(i),d=new Blob([o]).size/(1024*1024);if(d>10){console.warn(`[MeiliSearch] Batch too large (${d.toFixed(2)}MB), splitting further...`);for(let l=0;l<i.length;l+=100){const u=i.slice(l,l+100),h=await Bt(t,u);a.push(h)}continue}const c=await Bt(t,i);a.push(c)}catch(o){throw console.error("[MeiliSearch] Failed to index batch:",o),o}return console.log(`[MeiliSearch] Indexed ${e.length} documents in ${n.length} batch(es)`),a}async function Bt(t,e){const r=await fetch(`${Pe}/indexes/${t}/documents`,{method:"POST",headers:{"Content-Type":"application/json","X-Meili-API-Key":Qe},body:JSON.stringify(e)});if(!r.ok){const a=await r.text();throw console.error("[MeiliSearch] Indexing failed:",a),new Error(`MeiliSearch indexing failed: ${a}`)}const n=await r.json();return console.log(`[MeiliSearch] Enqueued task ${n.taskUid} – ${e.length} docs`),n}async function pi(t){try{const e=await fetch(`${Pe}/multi-search`,{method:"POST",headers:{"X-Meili-API-Key":Qe,"Content-Type":"application/json"},body:JSON.stringify({queries:t})});if(!e.ok){const n=await e.text();throw new Error(`MeiliSearch multi-search failed: ${n}`)}return await e.json()}catch(e){throw console.error("[MeiliSearch] Multi-search error:",e),e}}async function Us(){try{return(await fetch(`${Pe}/health`,{method:"GET"})).ok}catch{return!1}}function Fs(t,e){const[r,n]=b.useState(t);return b.useEffect(()=>{const a=setTimeout(()=>{n(t)},e);return()=>{clearTimeout(a)}},[t,e]),r}const Os=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2),vr=Ye(t=>({toasts:[],show:({type:e,message:r},n)=>t(a=>{const i=Os(),o={id:i,type:e,message:r,timestamp:Date.now(),duration:n?.duration};return n?.duration&&n.duration>0&&setTimeout(()=>{vr.getState().dismiss(i)},n.duration),{toasts:[...a.toasts,o].slice(-4)}}),dismiss:e=>t(r=>({toasts:r.toasts.filter(n=>n.id!==e)}))}));function $e(t,e,r){vr.getState().show({type:t,message:e},r)}function jr(t){const e=[];return t.forEach(r=>{r&&(Array.isArray(r)?e.push(...jr(r)):e.push(String(r)))}),e}function Sr(...t){return jr(t).filter(e=>e.trim().length>0).join(" ")}var qs=Object.defineProperty,zs=(t,e,r)=>e in t?qs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ct=(t,e,r)=>zs(t,typeof e!="symbol"?e+"":e,r);class Bs{constructor(e=100,r){ct(this,"cache",new Map),ct(this,"maxSize"),ct(this,"ttl"),this.maxSize=e,this.ttl=r}get(e){const r=this.cache.get(e);return r?this.ttl&&Date.now()-r.timestamp>this.ttl?(this.cache.delete(e),null):(r.accessCount++,r.lastAccessed=Date.now(),this.cache.delete(e),this.cache.set(e,r),r.value):null}set(e,r){this.cache.delete(e);const n=Date.now();if(this.cache.set(e,{value:r,timestamp:n,accessCount:0,lastAccessed:n}),this.cache.size>this.maxSize){const a=this.cache.keys().next().value;a&&this.cache.delete(a)}}has(e){const r=this.cache.get(e);return r?this.ttl&&Date.now()-r.timestamp>this.ttl?(this.cache.delete(e),!1):!0:!1}delete(e){return this.cache.delete(e)}clear(){this.cache.clear()}getStats(){return{size:this.cache.size,maxSize:this.maxSize,entries:Array.from(this.cache.entries()).map(([e,r])=>({key:e,accessCount:r.accessCount,age:Date.now()-r.timestamp,lastAccessed:r.lastAccessed}))}}keys(){return Array.from(this.cache.keys())}}var Ws=Object.defineProperty,Gs=(t,e,r)=>e in t?Ws(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Wt=(t,e,r)=>Gs(t,typeof e!="symbol"?e+"":e,r);const Hs="regen_cache",ne="cache_entries",Ks=1;class Vs{constructor(){Wt(this,"db",null),Wt(this,"initPromise",null),this.initPromise=this.init()}async init(){return new Promise((e,r)=>{const n=indexedDB.open(Hs,Ks);n.onerror=()=>{console.error("[DiskCache] Failed to open IndexedDB"),r(new Error("Failed to open IndexedDB"))},n.onsuccess=()=>{this.db=n.result,e()},n.onupgradeneeded=a=>{const i=a.target.result;i.objectStoreNames.contains(ne)||i.createObjectStore(ne)}})}async ensureReady(){if(this.initPromise&&await this.initPromise,!this.db)throw new Error("IndexedDB not initialized")}async get(e){return await this.ensureReady(),new Promise((r,n)=>{const o=this.db.transaction([ne],"readonly").objectStore(ne).get(e);o.onsuccess=()=>{const d=o.result;if(!d){r(null);return}if(d.ttl&&Date.now()-d.timestamp>d.ttl){this.delete(e).catch(console.error),r(null);return}r(d.value)},o.onerror=()=>{n(new Error("Failed to read from cache"))}})}async set(e,r,n){await this.ensureReady();const a={value:r,timestamp:Date.now(),ttl:n};return new Promise((i,o)=>{const l=this.db.transaction([ne],"readwrite").objectStore(ne).put(a,e);l.onsuccess=()=>{i()},l.onerror=()=>{o(new Error("Failed to write to cache"))}})}async delete(e){return await this.ensureReady(),new Promise((r,n)=>{const o=this.db.transaction([ne],"readwrite").objectStore(ne).delete(e);o.onsuccess=()=>{r()},o.onerror=()=>{n(new Error("Failed to delete from cache"))}})}async clear(){return await this.ensureReady(),new Promise((e,r)=>{const i=this.db.transaction([ne],"readwrite").objectStore(ne).clear();i.onsuccess=()=>{e()},i.onerror=()=>{r(new Error("Failed to clear cache"))}})}async cleanExpired(){return await this.ensureReady(),new Promise((e,r)=>{const i=this.db.transaction([ne],"readwrite").objectStore(ne).openCursor();let o=0;i.onsuccess=d=>{const c=d.target.result;if(c){const l=c.value;l.ttl&&Date.now()-l.timestamp>l.ttl&&(c.delete(),o++),c.continue()}else e(o)},i.onerror=()=>{r(new Error("Failed to clean expired entries"))}})}}var Qs=Object.defineProperty,Js=(t,e,r)=>e in t?Qs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lt=(t,e,r)=>Js(t,typeof e!="symbol"?e+"":e,r);class Xs{constructor(e=100,r={ttl:36e5,useDisk:!0,useMemory:!0}){lt(this,"memoryCache"),lt(this,"diskCache"),lt(this,"defaultOptions"),this.memoryCache=new Bs(e,r.ttl),this.diskCache=new Vs,this.defaultOptions=r,typeof window<"u"&&setInterval(()=>{this.cleanExpired().catch(n=>{M.warn("Failed to clean expired cache entries",n)})},3e5)}async get(e,r){const n={...this.defaultOptions,...r};if(n.useMemory){const a=this.memoryCache.get(e);if(a!=null)return M.debug(`Cache hit (memory): ${e}`),a}if(n.useDisk)try{const a=await this.diskCache.get(e);if(a!=null)return M.debug(`Cache hit (disk): ${e}`),n.useMemory&&this.memoryCache.set(e,a),a}catch(a){M.warn(`Failed to read from disk cache: ${e}`,a)}return M.debug(`Cache miss: ${e}`),null}async set(e,r,n){const a={...this.defaultOptions,...n};if(a.useMemory&&this.memoryCache.set(e,r),a.useDisk)try{await this.diskCache.set(e,r,a.ttl)}catch(i){M.warn(`Failed to write to disk cache: ${e}`,i)}}async has(e,r){const n={...this.defaultOptions,...r};return n.useMemory&&this.memoryCache.has(e)?!0:n.useDisk?await this.get(e,r)!==null:!1}async delete(e){this.memoryCache.delete(e);try{await this.diskCache.delete(e)}catch(r){M.warn(`Failed to delete from disk cache: ${e}`,r)}}async clear(){this.memoryCache.clear();try{await this.diskCache.clear()}catch(e){M.warn("Failed to clear disk cache",e)}}async cleanExpired(){try{return await this.diskCache.cleanExpired()}catch(e){return M.warn("Failed to clean expired cache entries",e),0}}getStats(){return{memory:this.memoryCache.getStats()}}}const Gt=new Xs;var Ys=Object.defineProperty,Zs=(t,e,r)=>e in t?Ys(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ze=(t,e,r)=>Zs(t,typeof e!="symbol"?e+"":e,r);class en{constructor(){ze(this,"metrics",[]),ze(this,"scrapeMetrics",[]),ze(this,"agentMetrics",[]),ze(this,"maxMetrics",1e3)}record(e,r,n="ms",a){const i={name:e,value:r,unit:n,timestamp:Date.now(),tags:a};this.metrics.push(i),this.metrics.length>this.maxMetrics&&this.metrics.shift(),M.debug("Metric recorded",i)}recordScrape(e){this.scrapeMetrics.push(e),this.scrapeMetrics.length>this.maxMetrics&&this.scrapeMetrics.shift(),M.debug("Scrape metric recorded",e)}recordAgent(e){this.agentMetrics.push(e),this.agentMetrics.length>this.maxMetrics&&this.agentMetrics.shift(),M.debug("Agent metric recorded",e)}getMetrics(e,r){let n=this.metrics;return e&&(n=n.filter(a=>a.name===e)),r&&(n=n.filter(a=>a.tags?Object.entries(r).every(([i,o])=>a.tags[i]===o):!1)),n}getScrapeMetrics(){return[...this.scrapeMetrics]}getAgentMetrics(){return[...this.agentMetrics]}getSummary(){const e=this.scrapeMetrics.length>0?this.scrapeMetrics.reduce((a,i)=>a+i.duration,0)/this.scrapeMetrics.length:0,r=this.agentMetrics.length>0?this.agentMetrics.reduce((a,i)=>a+i.duration,0)/this.agentMetrics.length:0,n=this.agentMetrics.length>0?this.agentMetrics.filter(a=>a.success).length/this.agentMetrics.length:0;return{totalMetrics:this.metrics.length,totalScrapes:this.scrapeMetrics.length,totalAgentRuns:this.agentMetrics.length,avgScrapeDuration:e,avgAgentDuration:r,agentSuccessRate:n}}clear(){this.metrics=[],this.scrapeMetrics=[],this.agentMetrics=[]}}const ft=new en;var tn=Object.defineProperty,rn=(t,e,r)=>e in t?tn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ht=(t,e,r)=>rn(t,typeof e!="symbol"?e+"":e,r);class sn{constructor(){Ht(this,"spans",new Map),Ht(this,"activeSpans",[])}startSpan(e,r){const n=`span-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,a=this.activeSpans[this.activeSpans.length-1],i={id:n,name:e,startTime:performance.now(),tags:r,children:[]};if(a){const o=this.spans.get(a);o&&o.children.push(i)}return this.spans.set(n,i),this.activeSpans.push(n),M.debug(`[Tracer] Started span: ${e}`,{spanId:n,tags:r}),n}endSpan(e,r){const n=this.spans.get(e);if(!n){M.warn(`[Tracer] Span not found: ${e}`);return}n.endTime=performance.now(),n.duration=n.endTime-n.startTime,r&&(n.error=r);const a=this.activeSpans.indexOf(e);a!==-1&&this.activeSpans.splice(a,1),M.debug(`[Tracer] Ended span: ${n.name}`,{spanId:e,duration:n.duration,error:r})}getTrace(e){return this.spans.get(e)}getRootSpans(){return Array.from(this.spans.values()).filter(e=>!Array.from(this.spans.values()).some(r=>r.children.includes(e)))}clear(){this.spans.clear(),this.activeSpans=[]}}const dt=new sn;async function nn(t,e,r){const n=dt.startSpan(t,r);try{const a=await Promise.resolve(e());return dt.endSpan(n),a}catch(a){throw dt.endSpan(n,a instanceof Error?a.message:String(a)),a}}var an=Object.defineProperty,on=(t,e,r)=>e in t?an(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,cn=(t,e,r)=>on(t,e+"",r);class ln{constructor(){cn(this,"tools",new Map)}register(e){this.tools.set(e.name,e),M.info(`[AgentRegistry] Registered tool: ${e.name}`)}get(e){return this.tools.get(e)}getAll(){return Array.from(this.tools.values())}has(e){return this.tools.has(e)}}const ce=new ln;ce.register({name:"scrapePage",description:"Scrape content from a URL",execute:async t=>{const{url:e}=t;if(!e)throw new Error("URL required");const r=`scrape:${e}`,n=await Gt.get(r);if(n)return M.debug(`[AgentTool] Cache hit for scrape: ${e}`),n;try{const a=performance.now(),i={url:e,title:"Scraped Page",content:"Mock content - implement actual scraping",scrapedAt:Date.now()},o=performance.now()-a;return ft.recordScrape({url:e,duration:o,size:JSON.stringify(i).length,cached:!1,timestamp:Date.now()}),await Gt.set(r,i,{ttl:36e5}),i}catch(a){throw M.error(`[AgentTool] Failed to scrape: ${e}`,a),a}}});ce.register({name:"summarizeText",description:"Summarize text content",execute:async t=>{const{text:e,maxLength:r=200}=t;if(!e)throw new Error("Text required");const n=e.length>r?e.slice(0,r)+"...":e;return{summary:n,originalLength:e.length,summaryLength:n.length}}});ce.register({name:"searchWeb",description:"Search the web for information",execute:async t=>{const{query:e,maxResults:r=5}=t;if(!e)throw new Error("Query required");return{query:e,results:Array.from({length:r},(n,a)=>({title:`Result ${a+1} for "${e}"`,url:`https://example.com/result-${a+1}`,snippet:`This is a mock search result for "${e}"`}))}}});const dn={open_tabs:!0,close_tabs:!1,navigate_tabs:!0,save_workspaces:!0,delete_workspaces:!1,send_network_requests:!0,access_local_files:!1,execute_external_scripts:!1,modify_settings:!1},un=Ye()(St((t,e)=>({capabilities:dn,experimentalToolsEnabled:!1,externalPluginsEnabled:!1,setCapability:(r,n)=>{t(a=>({capabilities:{...a.capabilities,[r]:n}})),M.info(`[Capabilities] ${r} ${n?"enabled":"disabled"}`)},setExperimentalTools:r=>{t({experimentalToolsEnabled:r}),M.info(`[Capabilities] Experimental tools ${r?"enabled":"disabled"}`)},setExternalPlugins:r=>{t({externalPluginsEnabled:r}),M.info(`[Capabilities] External plugins ${r?"enabled":"disabled"}`)},checkCapability:r=>e().capabilities[r]??!1}),{name:"regen_capabilities_v1"}));function hn(t){return un.getState().checkCapability(t)}function gi(){return{open_tabs:"Allow agent to open new tabs",close_tabs:"Allow agent to close tabs",navigate_tabs:"Allow agent to navigate between tabs",save_workspaces:"Allow agent to save workspaces",delete_workspaces:"Allow agent to delete workspaces",send_network_requests:"Allow agent to make network requests to external sites",access_local_files:"Allow agent to access local filesystem",execute_external_scripts:"Allow agent to execute external scripts",modify_settings:"Allow agent to modify application settings"}}function Ge(t){if(!hn(t))throw new Error(`Capability required: ${t}. Enable it in Settings > Safety.`)}var mn=Object.defineProperty,pn=(t,e,r)=>e in t?mn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Kt=(t,e,r)=>pn(t,typeof e!="symbol"?e+"":e,r);class gn{constructor(){Kt(this,"tools",new Map),Kt(this,"rateLimiters",new Map)}register(e){this.tools.set(e.name,e),M.info(`[ToolRegistryV2] Registered tool: ${e.name} (${e.category||"general"})`)}get(e){return this.tools.get(e)}getAll(){return Array.from(this.tools.values())}getByCategory(e){return Array.from(this.tools.values()).filter(r=>r.category===e)}async execute(e,r,n){const a=this.tools.get(e);if(!a)throw new Error(`Tool not found: ${e}`);if(a.rateLimit&&!this.checkRateLimit(e,a.rateLimit))throw new Error(`Rate limit exceeded for tool: ${e}`);try{const i=a.inputSchema.parse(r),o=await a.run(i,n);return a.outputSchema.parse(o)}catch(i){throw i instanceof As?(M.error(`[ToolRegistryV2] Validation error for ${e}:`,i.errors),new Error(`Invalid input for tool ${e}: ${i.errors.map(o=>o.message).join(", ")}`)):i}}checkRateLimit(e,r){const n=Date.now(),a=this.rateLimiters.get(e);return!a||n>a.resetAt?(this.rateLimiters.set(e,{count:1,resetAt:n+r.window}),!0):a.count>=r.requests?!1:(a.count++,!0)}}const ye=new gn;ye.register({name:"scrape_page",description:"Scrape content from a URL",inputSchema:re({url:V().url(),extract:Ze(["text","html","markdown"]).optional().default("text")}),outputSchema:re({url:V(),title:V(),content:V(),scrapedAt:Re()}),category:"research",run:async(t,e)=>{const r=ce.get("scrapePage");if(!r)throw new Error("scrapePage tool not found");return r.execute(t)}});ye.register({name:"summarize_text",description:"Summarize text content",inputSchema:re({text:V(),maxLength:Re().optional().default(200),format:Ze(["bullet","paragraph","list"]).optional().default("paragraph")}),outputSchema:re({summary:V(),originalLength:Re(),summaryLength:Re()}),category:"general",run:async(t,e)=>{const r=ce.get("summarizeText");if(!r)throw new Error("summarizeText tool not found");const n=await r.execute(t);return e.memory.remember("preference","summary_format",t.format),n}});ye.register({name:"search_web",description:"Search the web for information",inputSchema:re({query:V(),maxResults:Re().optional().default(5),sources:je(V()).optional()}),outputSchema:re({query:V(),results:je(re({title:V(),url:V(),snippet:V()}))}),category:"research",rateLimit:{requests:10,window:6e4},run:async(t,e)=>{const r=ce.get("searchWeb");if(!r)throw new Error("searchWeb tool not found");return r.execute(t)}});ye.register({name:"extract_table",description:"Extract tables from a page or document",inputSchema:re({url:V().url().optional(),html:V().optional(),tableIndex:Re().optional().default(0)}),outputSchema:re({table:je(je(V())),headers:je(V()).optional()}),category:"docs",run:async(t,e)=>{throw new Error("extract_table not yet implemented")}});ye.register({name:"manage_tabs",description:"Create, close, or switch tabs",inputSchema:re({action:Ze(["create","close","switch","list"]),url:V().url().optional(),tabId:V().optional()}),outputSchema:re({success:br(),tabId:V().optional(),tabs:je(yr()).optional()}),category:"general",run:async(t,e)=>{const{ipc:r}=await oe(async()=>{const{ipc:i}=await import("./core-ai-yFIunLTZ.js").then(o=>o.U);return{ipc:i}},__vite__mapDeps([0,1,2,3,4,5,6])),{useTabsStore:n}=await oe(async()=>{const{useTabsStore:i}=await import("./core-ai-yFIunLTZ.js").then(o=>o.S);return{useTabsStore:i}},__vite__mapDeps([0,1,2,3,4,5,6])),a=t;switch(a.action){case"create":if(Ge("open_tabs"),!a.url)throw new Error("URL required for create action");const i=await r.tabs.create(a.url);let o=null;return i&&(typeof i=="object"&&"id"in i&&typeof i.id=="string"?o=i.id:typeof i=="string"&&(o=i),o&&n.getState().setActive(o)),{success:!0,tabId:o||void 0};case"close":if(Ge("close_tabs"),!a.tabId)throw new Error("tabId required for close action");return await r.tabs.close({id:a.tabId}),{success:!0};case"switch":if(Ge("navigate_tabs"),!a.tabId)throw new Error("tabId required for switch action");return n.getState().setActive(a.tabId),await r.tabs.activate({id:a.tabId}),{success:!0,tabId:a.tabId};case"list":return{success:!0,tabs:n.getState().tabs};default:throw new Error(`Unknown action: ${t.action}`)}}});ye.register({name:"manage_workspaces",description:"Create, restore, or list workspaces",inputSchema:re({action:Ze(["create","restore","list"]),name:V().optional(),workspaceId:V().optional()}),outputSchema:re({success:br(),workspaceId:V().optional(),workspaces:je(yr()).optional()}),category:"general",run:async(t,e)=>{const{useWorkspacesStore:r}=await oe(async()=>{const{useWorkspacesStore:o}=await import("./workspacesStore-BSqEl-CQ.js");return{useWorkspacesStore:o}},__vite__mapDeps([7,1,2,3,4,0,5,6])),{useTabsStore:n}=await oe(async()=>{const{useTabsStore:o}=await import("./core-ai-yFIunLTZ.js").then(d=>d.S);return{useTabsStore:o}},__vite__mapDeps([0,1,2,3,4,5,6])),{useAppStore:a}=await oe(async()=>{const{useAppStore:o}=await import("./core-ai-yFIunLTZ.js").then(d=>d.Q);return{useAppStore:o}},__vite__mapDeps([0,1,2,3,4,5,6])),i=t;switch(i.action){case"create":if(Ge("save_workspaces"),!i.name)throw new Error("name required for create action");const o=n.getState().tabs,d=a.getState().mode;return{success:!0,workspaceId:r.getState().add({name:i.name,tabs:o,mode:d})};case"restore":if(!i.workspaceId)throw new Error("workspaceId required for restore action");if(!r.getState().get(i.workspaceId))throw new Error("Workspace not found");return{success:!0,workspaceId:i.workspaceId};case"list":return{success:!0,workspaces:r.getState().workspaces};default:throw new Error(`Unknown action: ${t.action}`)}}});const Le={initial:{opacity:.3},animate:{opacity:[.3,.6,.3],transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}};function ut({variant:t="text",lines:e=3,className:r="",children:n}){if(n)return s.jsx("div",{className:`animate-pulse ${r}`,children:s.jsx(ee.div,{variants:Le,initial:"initial",animate:"animate",className:"h-full w-full rounded bg-gray-800/50",children:n})});switch(t){case"text":return s.jsx("div",{className:`space-y-2 ${r}`,children:Array.from({length:e}).map((a,i)=>s.jsx(ee.div,{variants:Le,initial:"initial",animate:"animate",className:"h-4 rounded bg-gray-800/50",style:{width:i===e-1?"75%":"100%"}},i))});case"card":return s.jsxs(ee.div,{variants:Le,initial:"initial",animate:"animate",className:`rounded-lg border border-gray-800 bg-gray-900/50 p-4 ${r}`,children:[s.jsx("div",{className:"mb-3 h-4 w-3/4 rounded bg-gray-800/50"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"h-3 w-full rounded bg-gray-800/50"}),s.jsx("div",{className:"h-3 w-5/6 rounded bg-gray-800/50"})]})]});case"list":return s.jsx("div",{className:`space-y-3 ${r}`,children:Array.from({length:e}).map((a,i)=>s.jsxs(ee.div,{variants:Le,initial:"initial",animate:"animate",className:"flex items-center gap-3 rounded-lg border border-gray-800 bg-gray-900/50 p-3",children:[s.jsx("div",{className:"h-10 w-10 flex-shrink-0 rounded-full bg-gray-800/50"}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx("div",{className:"h-4 w-3/4 rounded bg-gray-800/50"}),s.jsx("div",{className:"h-3 w-1/2 rounded bg-gray-800/50"})]})]},i))});case"table":return s.jsx("div",{className:`space-y-2 ${r}`,children:Array.from({length:e}).map((a,i)=>s.jsxs(ee.div,{variants:Le,initial:"initial",animate:"animate",className:"flex gap-4 rounded border border-gray-800 bg-gray-900/50 p-3",children:[s.jsx("div",{className:"h-4 w-1/4 rounded bg-gray-800/50"}),s.jsx("div",{className:"h-4 w-1/4 rounded bg-gray-800/50"}),s.jsx("div",{className:"h-4 w-1/4 rounded bg-gray-800/50"}),s.jsx("div",{className:"h-4 w-1/4 rounded bg-gray-800/50"})]},i))});default:return null}}function fi({message:t="AI is thinking..."}){return s.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-gray-800 bg-gray-900/50 p-4",children:[s.jsx(ee.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"h-5 w-5 flex-shrink-0 rounded-full border-2 border-gray-700 border-t-emerald-400"}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx("div",{className:"h-4 w-32 rounded bg-gray-800/50",children:t}),s.jsx("div",{className:"h-3 w-48 rounded bg-gray-800/50"})]})]})}var fn=Object.defineProperty,xn=(t,e,r)=>e in t?fn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Vt=(t,e,r)=>xn(t,typeof e!="symbol"?e+"":e,r);class bn{constructor(e="browse",r){Vt(this,"context","browse"),Vt(this,"sessionId"),this.context=e,this.sessionId=r||`stagehand-${Date.now()}`}async findElement(e){if(typeof e=="string")return document.querySelector(e);if(e.text)return Array.from(document.querySelectorAll("*")).find(n=>n.textContent?.includes(e.text))||null;if(e.role)return document.querySelector(`[role="${e.role}"]`)||null;if(e.label){const r=document.querySelector(`label[for="${e.label}"]`);if(r){const n=r.getAttribute("for");return n?document.getElementById(n):null}}return e.testId&&document.querySelector(`[data-testid="${e.testId}"]`)||null}async wait(e,r=5e3){const n=Date.now();for(;Date.now()-n<r;){const a=await this.findElement(e);if(a)return a;await new Promise(i=>setTimeout(i,100))}throw new Error(`Element not found: ${JSON.stringify(e)}`)}async click(e){const r=await this.wait(e);if(r instanceof HTMLElement)r.click();else throw new Error("Element is not clickable")}async type(e,r){const n=await this.wait(e);if(n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement)n.focus(),n.value=r,n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0}));else throw new Error("Element is not an input or textarea")}async fill(e,r){await this.type(e,r)}async select(e,r){const n=await this.wait(e);if(n instanceof HTMLSelectElement)n.value=r,n.dispatchEvent(new Event("change",{bubbles:!0}));else throw new Error("Element is not a select")}async scroll(e,r="down"){(await this.wait(e)).scrollIntoView({behavior:"smooth",block:"center"})}async extract(e,r){const n=await this.wait(e);return r?n.getAttribute(r)||"":n.textContent||""}async screenshot(e){return e?await this.wait(e):document.body,new Promise(r=>{r("data:image/png;base64,placeholder")})}async navigate(e){window.location.href=e,await this.wait({text:"loading"},1e3).catch(()=>{})}async evaluate(e){return new Function(e)()}async sequence(e){const r=[];for(const n of e){let a;switch(n.type){case"click":await this.click(n.selector);break;case"type":await this.type(n.selector,n.text);break;case"wait":await this.wait(n.selector,n.timeout);break;case"scroll":await this.scroll(n.selector,n.direction);break;case"screenshot":a=await this.screenshot(n.selector);break;case"extract":a=await this.extract(n.selector,n.attribute);break;case"navigate":await this.navigate(n.url);break;case"evaluate":a=await this.evaluate(n.script);break;case"fill":await this.fill(n.selector,n.value);break;case"select":await this.select(n.selector,n.value);break}r.push(a)}return r}getState(){return{url:window.location.href,title:document.title,context:this.context,sessionId:this.sessionId}}}function Nr(t="browse",e){return new bn(t,e)}typeof window<"u"&&(window.stagehand=Nr("browse"));function yn(t={}){const{context:e="browse",sessionId:r}=t,n=b.useMemo(()=>Nr(e,r),[e,r]),a=b.useCallback(async u=>await n.sequence(u),[n]),i=b.useCallback(async u=>{await n.click(u)},[n]),o=b.useCallback(async(u,h)=>{await n.type(u,h)},[n]),d=b.useCallback(async(u,h)=>await n.wait(u,h),[n]),c=b.useCallback(async(u,h)=>await n.extract(u,h),[n]),l=b.useCallback(async u=>{await n.navigate(u)},[n]);return{stagehand:n,execute:a,click:i,type:o,wait:d,extract:c,navigate:l,getState:()=>n.getState()}}let kr=null,ht=null;async function Je(){const t={status:"checking",meiliSearch:!1,localSearch:!0,lastChecked:Date.now()};try{const e=await Promise.race([Us(),new Promise(r=>setTimeout(()=>r(!1),2e3))]);t.meiliSearch=e,e?t.status="healthy":(t.status="degraded",t.error="MeiliSearch unavailable, using local search only")}catch(e){t.status="degraded",t.error=e instanceof Error?e.message:"Unknown error",t.meiliSearch=!1}return kr=t,t}function xt(){return kr}function wn(t=3e4){ht&&clearInterval(ht),Je().catch(console.error),ht=setInterval(()=>{Je().catch(console.error)},t)}async function vn(){try{const t=await Je();return{success:t.status!=="offline",meiliSearch:t.meiliSearch,localSearch:t.localSearch,message:t.status==="healthy"?"Search system ready (MeiliSearch + Local)":t.status==="degraded"?"Search system ready (Local only - MeiliSearch unavailable)":"Search system offline"}}catch(t){return{success:!1,meiliSearch:!1,localSearch:!0,message:`Search verification failed: ${t instanceof Error?t.message:"Unknown error"}`}}}const xi=Object.freeze(Object.defineProperty({__proto__:null,checkSearchHealth:Je,getSearchHealth:xt,startSearchHealthMonitoring:wn,verifySearchSystem:vn},Symbol.toStringTag,{value:"Module"})),jn=.62;async function _r(t,e){if(!t||!t.trim())return[];try{const r=await Z.hybridSearch.search(t,e?.limit,e?.language);return Sn(r).map(a=>{const i=a.domain||Nn(a.url),o=typeof a.score=="number"?a.score:typeof a.relevance_score=="number"?a.relevance_score:jn;return{title:a.title||a.url||"Untitled result",url:a.url??"",snippet:a.snippet??"",source:a.source||a.metadata?.provider||"web",score:o,domain:i,metadata:a.metadata??{}}})}catch(r){return console.warn("[MultiSourceSearch] Failed to fetch hybrid results:",r),[]}}function Sn(t){if(!t)return[];if(Array.isArray(t))return t.filter(Qt);if(typeof t=="object"){const e=t.results;if(Array.isArray(e))return e.filter(Qt)}return[]}function Qt(t){return typeof t=="object"&&t!==null}function Nn(t){if(!t)return"";try{return new URL(t).hostname.replace(/^www\./,"")}catch{return""}}const bi=Object.freeze(Object.defineProperty({__proto__:null,multiSourceSearch:_r},Symbol.toStringTag,{value:"Module"}));async function $r(t,e){const r=window.__BING_API_KEY;if(!r||r==="your_bing_api_key_here")return console.warn("[BingSearch] API key not configured"),[];if(!t||t.trim().length<2)return[];try{const n=e?.count||10,a=e?.offset||0,i=e?.market||e?.language||"en-US",c=await fetch("http://localhost:3000/api/proxy/bing/search",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({q:t.trim(),count:n,offset:a,mkt:i})});if(!c.ok){const h=await c.json().catch(()=>({}));return h.fallback?console.warn("[BingSearch] Bing API unavailable, using fallback:",h.message):console.warn("[BingSearch] API request failed:",c.status,c.statusText),[]}const l=await c.json();if(l.ok&&l.results)return l.results.map(h=>({id:h.id||h.url,name:h.name||h.title||"",url:h.url,snippet:h.snippet||h.description||"",displayUrl:h.displayUrl||h.url,datePublished:h.datePublished,dateLastCrawled:h.dateLastCrawled}));const u=l;return u.webPages?.value?u.webPages.value:[]}catch(n){return console.warn("[BingSearch] Search failed:",n),[]}}function Cr(t){return t.map(e=>{try{const n=new URL(e.url).hostname.replace(/^www\./,"");return{title:e.name,url:e.url,snippet:e.snippet,domain:n}}catch{return{title:e.name,url:e.url,snippet:e.snippet,domain:e.displayUrl||""}}})}const kn={hi:"in-hi",ta:"in-ta",te:"in-te",bn:"in-bn",mr:"in-mr",kn:"in-kn",ml:"in-ml",gu:"in-gu",pa:"in-pa",ur:"pk-ur",en:"us-en",es:"es-es",fr:"fr-fr",de:"de-de",pt:"pt-pt",zh:"cn-zh",ja:"jp-ja",ru:"ru-ru"};function Ar(t){return!t||t==="auto"?"us-en":kn[t]||"us-en"}async function me(t,e){if(!t||t.trim().length<1)return null;const n=t.trim().replace(/\s+/g," ").replace(/[^\w\s\-.,!?]/g,"").trim();if(n.length<1)return null;try{if(typeof window<"u"&&window.__TAURI__)try{const{invoke:l}=await oe(async()=>{const{invoke:h}=await import("@tauri-apps/api/core");return{invoke:h}},[]),u=await l("search_proxy",{query:n});if(u&&typeof u=="object")return console.debug("[DuckDuckGo] Using Tauri search_proxy (activated)"),u}catch{}const a=Ar(e),i=a.split("-")[0],o=`https://api.duckduckgo.com/?q=${encodeURIComponent(n)}&format=json&no_redirect=1&skip_disambig=1&kl=${a}&hl=${i}`,d=new AbortController,c=setTimeout(()=>d.abort(),8e3);try{const l=await fetch(o,{headers:{Accept:"application/json","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"},signal:d.signal});if(clearTimeout(c),!l.ok){if(console.warn("[DuckDuckGo] API request failed:",l.status),n.length>50&&l.status===429){const h=n.split(" ").slice(0,5).join(" ");return me(h,e)}return null}const u=await l.json();return u&&(u.AbstractText||u.Answer||u.Definition||u.Results&&u.Results.length>0)?u:null}catch(l){return clearTimeout(c),l instanceof Error&&l.name==="AbortError"?console.warn("[DuckDuckGo] Request timeout"):console.warn("[DuckDuckGo] Fetch failed:",l),null}}catch(a){return console.warn("[DuckDuckGo] Search failed:",a),null}}function Ne(t){if(!t)return[];const e=[];return t.Heading&&t.AbstractText&&e.push({title:t.Heading,url:t.AbstractURL,snippet:t.AbstractText,type:"instant"}),t.Answer&&e.push({title:t.AnswerType||"Answer",snippet:t.Answer,type:"instant"}),t.Definition&&e.push({title:t.DefinitionSource||"Definition",url:t.DefinitionURL,snippet:t.Definition,type:"instant"}),t.Results&&t.Results.length>0&&t.Results.slice(0,10).forEach(r=>{e.push({title:r.Text||r.FirstURL,url:r.FirstURL,snippet:r.Text||"",type:"result"})}),t.RelatedTopics&&t.RelatedTopics.length>0&&t.RelatedTopics.slice(0,5).forEach(r=>{e.push({title:r.Text||r.Name||"Related",url:r.FirstURL,snippet:"",type:"related"})}),e}async function Rr(t,e){if(!t||t.trim().length<2)return[];try{const r=e?.count||10,n=Ar(e?.language),a=n.split("-")[0],i=`https://html.duckduckgo.com/html/?q=${encodeURIComponent(t.trim())}&kl=${n}&hl=${a}`;let o;try{if(typeof window<"u"&&window.__TAURI__)try{const S=await me(t,e?.language);if(S)return Ne(S).map(p=>({title:p.title,url:p.url||"",snippet:p.snippet,domain:p.url?new URL(p.url).hostname.replace(/^www\./,""):""}))}catch(S){console.debug("[DuckDuckGo] Tauri search_proxy failed, trying direct fetch:",S)}const w=await fetch(i,{headers:{Accept:"text/html","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"},mode:"cors"});if(!w.ok){console.warn("[DuckDuckGo] Web search failed:",w.status);const S=await me(t,e?.language);return S?Ne(S).map(p=>({title:p.title,url:p.url||"",snippet:p.snippet,domain:p.url?new URL(p.url).hostname.replace(/^www\./,""):""})):[]}o=await w.text()}catch(w){console.debug("[DuckDuckGo] Web search blocked (CORS or network), trying instant API:",w);try{const S=await me(t,e?.language);if(S)return Ne(S).map(p=>({title:p.title,url:p.url||"",snippet:p.snippet,domain:p.url?new URL(p.url).hostname.replace(/^www\./,""):""}))}catch{}return[]}const d=[],c=/<a[^>]*href="([^"]+)"[^>]*class="[^"]*result__a[^"]*"[^>]*>([\s\S]*?)<\/a>/gi,l=/<a[^>]*class="[^"]*result__snippet[^"]*"[^>]*>([\s\S]*?)<\/a>/gi;let u;const h=[],x=[];for(;(u=c.exec(o))!==null&&h.length<r;){const w=u[1],S=u[2].replace(/<[^>]*>/g,"").trim();w&&S&&h.push({url:w,title:S})}for(;(u=l.exec(o))!==null&&x.length<r;){const w=u[1].replace(/<[^>]*>/g,"").trim();w&&x.push(w)}for(let w=0;w<Math.min(h.length,r);w++)try{let S=h[w].url;if(S.startsWith("/l/?kh=")){const $=S.match(/uddg=([^&]+)/);$&&(S=decodeURIComponent($[1]))}else S.startsWith("http")||(S=`https://${S}`);const p=new URL(S).hostname.replace(/^www\./,"");d.push({title:h[w].title,url:S,snippet:x[w]||"",domain:p})}catch{}return d}catch(r){return console.warn("[DuckDuckGo] Web search failed:",r),[]}}async function Nt(t,e){if(!t||t.trim().length<2)return[];const r=e?.count||10,n=e?.language;if(e?.preferBing!==!1)try{const i=await $r(t,{count:r,language:n});if(i.length>0)return Cr(i).map((d,c)=>({...d,provider:"bing",score:.9-c*.05}))}catch(i){console.debug("[LiveWebSearch] Bing search failed, trying DuckDuckGo:",i)}try{const i=await Rr(t,{count:r,language:n});if(i.length>0)return i.map((o,d)=>({...o,provider:"duckduckgo",score:.8-d*.05}))}catch(i){console.debug("[LiveWebSearch] DuckDuckGo web search failed:",i)}try{const i=await me(t,n);if(i)return Ne(i).filter(c=>c.type==="result"&&c.url).slice(0,r).map((c,l)=>{try{const h=new URL(c.url).hostname.replace(/^www\./,"");return{title:c.title,url:c.url,snippet:c.snippet,domain:h,provider:"duckduckgo",score:.7-l*.05}}catch{return{title:c.title,url:c.url,snippet:c.snippet,domain:"",provider:"duckduckgo",score:.7-l*.05}}})}catch(i){console.debug("[LiveWebSearch] DuckDuckGo instant search failed:",i)}return[]}function _n(){const t=window.__BING_API_KEY;return t&&t!=="your_bing_api_key_here"||!0}const yi=Object.freeze(Object.defineProperty({__proto__:null,isLiveWebSearchAvailable:_n,performLiveWebSearch:Nt},Symbol.toStringTag,{value:"Module"})),$n=["as","bn","brx","doi","gom","gu","hi","kn","ks","mai","ml","mni","mr","ne","or","pa","sa","sat","sd","ta","te","ur"],Cn={hi:[/[\u0900-\u097F]/,/\b(है|हो|कर|से|में|को|का|के|की|पर|इस|उस|वह|यह|क्या|कैसे|कहाँ|कब|क्यों)\b/],ta:[/[\u0B80-\u0BFF]/,/\b(ஆக|இது|அது|என்ன|எப்படி|எங்கே|எப்போது|ஏன்)\b/],te:[/[\u0C00-\u0C7F]/,/\b(అది|ఇది|ఏమి|ఎలా|ఎక్కడ|ఎప్పుడు|ఎందుకు)\b/],bn:[/[\u0980-\u09FF]/,/\b(এটা|সেটা|কি|কিভাবে|কোথায়|কখন|কেন)\b/],mr:[/[\u0900-\u097F]/,/\b(हे|ते|कर|पासून|मध्ये|ला|चा|चे|ची|वर|हा|ती|काय|कसे|कुठे|कधी|का)\b/],kn:[/[\u0C80-\u0CFF]/,/\b(ಇದು|ಅದು|ಏನು|ಹೇಗೆ|ಎಲ್ಲಿ|ಎಂದು|ಏಕೆ)\b/],ml:[/[\u0D00-\u0D7F]/,/\b(ഇത്|അത്|എന്ത്|എങ്ങനെ|എവിടെ|എപ്പോൾ|എന്തുകൊണ്ട്)\b/],gu:[/[\u0A80-\u0AFF]/,/\b(આ|તે|કર|માં|ને|નો|ની|ના|પર|આ|તે|શું|કેવી|ક્યાં|ક્યારે|શા માટે)\b/],pa:[/[\u0A00-\u0A7F]/,/\b(ਇਹ|ਉਹ|ਕੀ|ਕਿਵੇਂ|ਕਿੱਥੇ|ਕਦੋਂ|ਕਿਉਂ)\b/],ur:[/[\u0600-\u06FF]/,/\b(یہ|وہ|کیا|کیسے|کہاں|کب|کیوں)\b/],or:[/[\u0B00-\u0B7F]/,/\b(ଏହା|ସେହା|କଣ|କିପରି|କେଉଁଠି|କେବେ|କାହିଁକି)\b/],as:[/[\u0980-\u09FF]/,/\b(এই|সেই|কি|কেনেকৈ|ক’ত|কেতিয়া|কিয়)\b/],ne:[/[\u0900-\u097F]/,/\b(यो|त्यो|के|कसरी|कहाँ|कहिले|किन)\b/],sa:[/[\u0900-\u097F]/,/\b(एतत्|तत्|किम्|कथम्|कुत्र|कदा|किमर्थम्)\b/]};function kt(t){return $n.includes(t)}function An(t){if(!t||t.trim().length<2)return{language:"en",confidence:.5,method:"fallback",isIndic:!1};const e={};for(const[n,a]of Object.entries(Cn)){let i=0;for(const o of a){const d=t.match(o);d&&(i+=d.length)}i>0&&(e[n]=i)}if(Object.keys(e).length>0){const n=Object.entries(e).reduce((o,d)=>e[o[0]]>e[d[0]]?o:d)[0],a=e[n],i=Math.min(.9,.5+a/t.length*.4);return{language:n,confidence:i,method:"client",isIndic:kt(n)}}return/[a-zA-Z]/.test(t)?{language:"en",confidence:.7,method:"client",isIndic:!1}:{language:"en",confidence:.5,method:"fallback",isIndic:!1}}async function Rn(t){try{const{ipc:e}=await oe(async()=>{const{ipc:n}=await import("./core-ai-yFIunLTZ.js").then(a=>a.U);return{ipc:n}},__vite__mapDeps([0,1,2,3,4,5,6])),r=await e.research?.queryEnhanced?.({query:`Detect language: ${t.slice(0,500)}`,language:"auto"}).catch(()=>null);if(r&&typeof r=="object"&&"detectedLanguage"in r){const n=r.detectedLanguage||"en";return{language:n,confidence:r.confidence||.95,method:"indicbert",isIndic:kt(n)}}}catch(e){M.warn("[LanguageDetection] IndicBERT detection failed:",e)}return null}async function En(t){try{const{ipc:e}=await oe(async()=>{const{ipc:n}=await import("./core-ai-yFIunLTZ.js").then(a=>a.U);return{ipc:n}},__vite__mapDeps([0,1,2,3,4,5,6])),r=await e.research?.queryEnhanced?.({query:`Detect language with mBART: ${t.slice(0,500)}`,language:"auto"}).catch(()=>null);if(r&&typeof r=="object"&&"detectedLanguage"in r){const n=r.detectedLanguage||"en";return{language:n,confidence:r.confidence||.9,method:"mbart",isIndic:kt(n)}}}catch(e){M.warn("[LanguageDetection] mBART detection failed:",e)}return null}async function bt(t,e){if(!t||t.trim().length<2)return{language:"en",confidence:.5,method:"fallback",isIndic:!1};const r=t.trim(),n=e?.preferIndic??!0;if((e?.useBackend??!0)&&typeof window<"u"&&navigator.onLine){if(n){const o=await Rn(r);if(o&&o.confidence>.8)return o}const i=await En(r);if(i&&i.confidence>.8)return i}return An(r)}const yt={code:"en",nativeName:"English",englishName:"English",accent:"#38bdf8",gradient:["#2563eb","#38bdf8"],waveform:["#38bdf8","#a5f3fc"]},Tn={en:yt,hi:{code:"hi",nativeName:"हिन्दी",englishName:"Hindi",accent:"#f97316",gradient:["#f97316","#ec4899"],waveform:["#f97316","#facc15"]},ta:{code:"ta",nativeName:"தமிழ்",englishName:"Tamil",accent:"#a855f7",gradient:["#a855f7","#ec4899"],waveform:["#a855f7","#f472b6"]},bn:{code:"bn",nativeName:"বাংলা",englishName:"Bengali",accent:"#fbbf24",gradient:["#fbbf24","#f97316"],waveform:["#f97316","#fbbf24"]},te:{code:"te",nativeName:"తెలుగు",englishName:"Telugu",accent:"#fb7185",gradient:["#fb7185","#f97316"],waveform:["#fb7185","#fcd34d"]},mr:{code:"mr",nativeName:"मराठी",englishName:"Marathi",accent:"#22d3ee",gradient:["#22d3ee","#3b82f6"],waveform:["#22d3ee","#a78bfa"]}};function He(t){if(!t||t==="auto")return yt;const e=t.toLowerCase();return Tn[e]||yt}const In={hi:"hi-IN",ta:"ta-IN",te:"te-IN",bn:"bn-IN",mr:"mr-IN",kn:"kn-IN",ml:"ml-IN",gu:"gu-IN",pa:"pa-IN",ur:"ur-PK",en:"en-US",es:"es-ES",fr:"fr-FR",de:"de-DE",zh:"zh-CN",ja:"ja-JP",ko:"ko-KR",ru:"ru-RU",pt:"pt-PT",ar:"ar-SA"};function Jt(t){return!t||t==="auto"?"en-US":In[t]||t.includes("-")?t:`${t}-${t.toUpperCase()}`}const Ln={hi:"हिंदी",ta:"தமிழ்",te:"తెలుగు",bn:"বাংলা",mr:"मराठी",kn:"ಕನ್ನಡ",ml:"മലയാളം",gu:"ગુજરાતી",pa:"ਪੰਜਾਬੀ",ur:"اردو",en:"English",es:"Español",fr:"Français",de:"Deutsch",zh:"中文",ja:"日本語",ko:"한국어",ru:"Русский",pt:"Português",ar:"العربية"};function Mn({onResult:t,small:e}){const[r,n]=b.useState(!1),[a,i]=b.useState(!1),[o,d]=b.useState(!1),c=b.useRef(null),l=b.useRef(null),u=Ce(p=>p.language||"auto"),h=Ln[u]||u||"auto",x=He(u);b.useEffect(()=>{const p=window.SpeechRecognition||window.webkitSpeechRecognition;if(p)try{const $=new p;$.continuous=!1,$.interimResults=!1,$.lang=Jt(u),$.onresult=q=>{try{d(!0);const g=(Array.isArray(q.results)?Array.from(q.results):[]).map(_=>_?.[0]?.transcript).filter(_=>_&&typeof _=="string").join(" ").trim();g&&(H.success(`Voice input received in ${h}`),t(g)),n(!1),d(!1)}catch(U){console.error("[VoiceButton] Error processing speech result:",U),n(!1),d(!1),H.error("Failed to process speech recognition result.")}},$.onerror=q=>{console.error("[VoiceButton] Speech recognition error:",q.error),n(!1),d(!1),m(),q.error==="not-allowed"?H.error("Microphone permission denied. Please enable it in your browser settings."):q.error==="no-speech"?H.error(`No speech detected in ${h}. Please try again.`):H.error("Speech recognition failed. Please try again.")},$.onend=()=>{n(!1),d(!1),m()},c.current=$,i(!0)}catch($){console.error("[VoiceButton] Failed to initialize speech recognition:",$),i(!1)}else i(!1)},[t,u]),b.useEffect(()=>{c.current&&(c.current.lang=Jt(u))},[u]);const w=async()=>{const p=c.current;if(!p||!a){H.error("Speech recognition is not available in this browser. Please use a supported browser like Chrome or Edge.");return}if(r){try{p.stop(),n(!1),m()}catch($){console.error("[VoiceButton] Failed to stop recognition:",$)}return}try{n(!0),d(!0),H.info(`Listening in ${h}... Speak now`),p.start(),S()}catch($){console.error("[VoiceButton] Failed to start recognition:",$),n(!1),d(!1),m(),H.error("Failed to start voice recognition. Please try again.")}},S=()=>{if(l.current)return;const p=()=>{r?l.current=requestAnimationFrame(p):l.current=null};p()},m=()=>{l.current&&(cancelAnimationFrame(l.current),l.current=null)};return b.useEffect(()=>(r||m(),()=>m()),[r]),s.jsx("button",{type:"button",className:`${e?"px-2 py-1 text-[11px]":"px-3 py-2 text-xs"} ml-2 rounded-lg transition-all focus:outline-none focus:ring-2 focus:ring-blue-400/50 ${r?"text-white shadow-lg":"bg-neutral-800 text-gray-300 hover:bg-neutral-700"} ${o?"animate-pulse":""}`,onClick:w,onKeyDown:p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),w())},"aria-label":r?`Stop voice recognition (${h})`:`Start voice search (${h})`,"aria-pressed":r,title:`Voice search in ${h}`,disabled:!a,style:r?{background:`linear-gradient(120deg, ${x.gradient[0]}, ${x.gradient[1]})`,boxShadow:`0 12px 24px ${x.gradient[0]}40`}:void 0,children:s.jsx("div",{className:"flex items-center gap-2",children:r?s.jsxs(s.Fragment,{children:[s.jsx(is,{className:"h-4 w-4 animate-pulse"}),!e&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsxs("div",{className:"flex h-4 items-end gap-0.5",children:[s.jsx("div",{className:"w-0.5 rounded-full",style:{height:"60%",animation:"waveform 1s ease-in-out infinite",animationDelay:"0ms",background:`linear-gradient(180deg, ${x.waveform[0]}, ${x.waveform[1]})`}}),s.jsx("div",{className:"w-0.5 rounded-full",style:{height:"80%",animation:"waveform 1s ease-in-out infinite",animationDelay:"200ms",background:`linear-gradient(180deg, ${x.waveform[0]}, ${x.waveform[1]})`}}),s.jsx("div",{className:"w-0.5 rounded-full",style:{height:"100%",animation:"waveform 1s ease-in-out infinite",animationDelay:"400ms",background:`linear-gradient(180deg, ${x.waveform[0]}, ${x.waveform[1]})`}}),s.jsx("div",{className:"w-0.5 rounded-full",style:{height:"70%",animation:"waveform 1s ease-in-out infinite",animationDelay:"600ms",background:`linear-gradient(180deg, ${x.waveform[0]}, ${x.waveform[1]})`}}),s.jsx("div",{className:"w-0.5 rounded-full",style:{height:"90%",animation:"waveform 1s ease-in-out infinite",animationDelay:"800ms",background:`linear-gradient(180deg, ${x.waveform[0]}, ${x.waveform[1]})`}})]}),s.jsx("style",{children:`
                  @keyframes waveform {
                    0%, 100% { transform: scaleY(0.5); opacity: 0.7; }
                    50% { transform: scaleY(1); opacity: 1; }
                  }
                `}),s.jsx("span",{className:"ml-1 text-xs",children:h})]})]}):s.jsxs(s.Fragment,{children:[s.jsx(os,{className:"h-4 w-4"}),!e&&s.jsx("span",{className:"text-xs",children:h})]})})})}function Dn(){const{stagehand:t,execute:e,click:r,type:n,extract:a}=yn({context:"research"});return b.useEffect(()=>(typeof window<"u"&&(window.researchStagehand={stagehand:t,execute:e,click:r,type:n,extract:a,search:async i=>{await r({text:"Search"}),await n('input[type="search"]',i),await r('button[type="submit"]')},getSources:async()=>await a(".source-list")}),()=>{typeof window<"u"&&delete window.researchStagehand}),[t,e,r,n,a]),null}let be=null,wt={};async function Pn(){if(be)return be;try{const t=await fetch("/lunr-index.json");if(!t.ok)throw new Error("No index available");const{index:e,documents:r}=await t.json();return be=zt.Index.load(e),wt=r,be}catch{return be=zt(function(){this.ref("id"),this.field("title",{boost:10}),this.field("body")}),wt={},be}}async function xe(t){return await Pn(),be?be.search(t).slice(0,10).map(r=>{const n=wt[r.ref];return n?{id:n.id,title:n.title,snippet:n.body.slice(0,180)+(n.body.length>180?"...":"")}:{id:r.ref,title:"Unknown",snippet:""}}):[]}const Un=8e3,Fn=10;async function Xt(t,e){if(!t||t.trim().length<1)return[];const r=t.trim(),n=e?.count||Fn,a=e?.language,i=e?.timeout||Un,o=e?.preferProvider||"auto",d=[];(o==="auto"||o==="brave"||o==="multi")&&d.push(_r(r,{limit:n,language:a}).then(c=>c.map((l,u)=>({title:l.title,url:l.url,snippet:l.snippet,domain:l.domain,provider:l.source==="brave"?"brave":l.source==="bing"?"bing":"multi",score:l.score||.9-u*.05,timestamp:Date.now()}))).catch(()=>[])),(o==="auto"||o==="duckduckgo")&&d.push(Rr(r,{count:n,language:a}).then(c=>c.map((l,u)=>({title:l.title,url:l.url,snippet:l.snippet,domain:l.domain,provider:"duckduckgo",score:.85-u*.05,timestamp:Date.now()}))).catch(()=>[])),(o==="auto"||o==="bing")&&d.push($r(r,{count:n,language:a}).then(c=>Cr(c).map((u,h)=>({title:u.title,url:u.url,snippet:u.snippet,domain:u.domain,provider:"bing",score:.9-h*.05,timestamp:Date.now()}))).catch(()=>[])),d.push(Nt(r,{count:n,language:a}).then(c=>c.map(l=>({title:l.title,url:l.url,snippet:l.snippet,domain:l.domain,provider:l.provider==="bing"?"bing":"duckduckgo",score:l.score,timestamp:Date.now()}))).catch(()=>[])),d.push(me(r,a).then(c=>c?Ne(c).filter(u=>u.url&&u.type==="result").slice(0,n).map((u,h)=>{try{const x=new URL(u.url);return{title:u.title,url:u.url,snippet:u.snippet,domain:x.hostname.replace(/^www\./,""),provider:"duckduckgo",score:.75-h*.05,timestamp:Date.now()}}catch{return{title:u.title,url:u.url,snippet:u.snippet,domain:"",provider:"duckduckgo",score:.75-h*.05,timestamp:Date.now()}}}):[]).catch(()=>[])),d.push(xe(r).then(c=>c.map((l,u)=>({title:l.title,url:"",snippet:l.snippet,domain:"local",provider:"local",score:.7-u*.03,timestamp:Date.now()}))).catch(()=>[]));try{const c=await Promise.race([Promise.allSettled(d).then(h=>{for(const w of h)if(w.status==="fulfilled"&&w.value.length>0)return w.value;const x=[];for(const w of h)w.status==="fulfilled"&&x.push(...w.value);return x}),new Promise((h,x)=>setTimeout(()=>x(new Error("Search timeout")),i))]),l=new Set,u=c.filter(h=>!h.url||l.has(h.url)?!1:(l.add(h.url),!0)).sort((h,x)=>x.score-h.score).slice(0,n);return u.length>0?u:Yt(r,n)}catch(c){return console.warn("[OptimizedSearch] All search engines failed, using fallback:",c),Yt(r,n)}}function Yt(t,e){const r="fallback";return[{title:`Search results for "${t}"`,url:`https://duckduckgo.com/?q=${encodeURIComponent(t)}`,snippet:`Click to search "${t}" on DuckDuckGo directly.`,domain:"duckduckgo.com",provider:r,score:.5,timestamp:Date.now()},{title:`Google Search: ${t}`,url:`https://www.google.com/search?q=${encodeURIComponent(t)}`,snippet:`Click to search "${t}" on Google.`,domain:"google.com",provider:r,score:.5,timestamp:Date.now()},{title:`Bing Search: ${t}`,url:`https://www.bing.com/search?q=${encodeURIComponent(t)}`,snippet:`Click to search "${t}" on Bing.`,domain:"bing.com",provider:r,score:.5,timestamp:Date.now()}].slice(0,e)}const On=["169.254.169.254","metadata.google.internal","169.254.169.254","localhost","127.0.0.1","::1","0.0.0.0","metadata.azure.com","169.254.169.254","fd00::","fe80::"],qn=["http:","https:"];function zn(t){try{const e=new URL(t);return qn.includes(e.protocol)?On.includes(e.hostname)?(M.warn(`[UrlSafety] Blocked host: ${e.hostname}`),!1):e.hostname==="localhost"||e.hostname.endsWith(".localhost")?(M.warn(`[UrlSafety] Blocked localhost variant: ${e.hostname}`),!1):Bn(e.hostname)?(M.warn(`[UrlSafety] Blocked private IP: ${e.hostname}`),!1):!0:(M.warn(`[UrlSafety] Blocked protocol: ${e.protocol}`),!1)}catch(e){return M.error(`[UrlSafety] Invalid URL: ${t}`,e),!1}}function Bn(t){return[/^10\./,/^172\.(1[6-9]|2[0-9]|3[0-1])\./,/^192\.168\./,/^127\./,/^::1$/].some(r=>r.test(t))}function Ke(t){return zn(t)?{safe:!0}:{safe:!1,reason:"OmniAgent blocked an unsafe URL. Internal and private network addresses are not allowed."}}const Zt=(typeof window<"u"?window.__OB_API_BASE__:"")||void 0||void 0||"";async function Wn(t,e={}){if(!Zt||t.length===0)return[];const r=[],n=[];for(const a of t){const i=Ke(a);i.safe?r.push(a):(n.push({url:a,reason:i.reason||"Unsafe URL"}),M.warn("[Scraper] Blocked unsafe URL",{url:a,reason:i.reason}))}if(r.length===0)return n.length>0&&M.error("[Scraper] All URLs blocked by security check",n),n.map(({url:a,reason:i})=>({url:a,error:i||"URL blocked by security policy"}));n.length>0&&M.warn("[Scraper] Some URLs blocked, proceeding with safe URLs",{blocked:n.length,safe:r.length});try{const a=[];for(const i of r)try{const o=await fetch(`${Zt.replace(/\/$/,"")}/api/scrape`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:i})});if(!o.ok){const c=await o.json().catch(()=>({error:"unknown"}));console.warn("[Scraper] Backend returned error for",i,o.status,c),a.push({url:i,error:c.error||c.message||"Scrape failed"});continue}const d=await o.json();if(d.ok&&d.page)a.push({url:d.page.url||i,title:d.page.title,excerpt:d.page.excerpt,content:d.page.text,wordCount:d.page.text?.split(/\s+/).length||0,lang:"auto"});else{const c=d;if(c.results&&c.results.length>0){const l=c.results[0];a.push({url:l.url,finalUrl:l.final_url,status:l.status,title:l.title,description:l.description,image:l.image,excerpt:l.excerpt,content:l.content,wordCount:l.word_count,lang:l.lang,contentHash:l.content_hash,rendered:l.rendered,fromCache:l.from_cache,fetchedAt:l.fetched_at,metadata:l.metadata})}else a.push({url:i,error:"Unexpected response format"})}}catch(o){console.warn("[Scraper] Failed to scrape",i,o),a.push({url:i,error:o instanceof Error?o.message:"Unknown error"})}return a}catch(a){return console.warn("[Scraper] Failed to fetch sources",a),[]}}const Er={hindi:["hindi","हिंदी"],tamil:["tamil","தமிழ்"],telugu:["telugu","తెలుగు"],bengali:["bengali","bangla","বাংলা"],marathi:["marathi","मराठी"],kannada:["kannada","ಕನ್ನಡ"],malayalam:["malayalam","മലയാളം"],gujarati:["gujarati","ગુજરાતી"],punjabi:["punjabi","ਪੰਜਾਬੀ"],urdu:["urdu","اردو"],english:["english"],spanish:["spanish","español"],french:["french","français"],german:["german","deutsch"],chinese:["chinese","中文"],japanese:["japanese","日本語"],korean:["korean","한국어"],russian:["russian","Русский"],portuguese:["portuguese","português"],arabic:["arabic","العربية"]},Ve={hindi:"hi",tamil:"ta",telugu:"te",bengali:"bn",marathi:"mr",kannada:"kn",malayalam:"ml",gujarati:"gu",punjabi:"pa",urdu:"ur",english:"en",spanish:"es",french:"fr",german:"de",chinese:"zh",japanese:"ja",korean:"ko",russian:"ru",portuguese:"pt",arabic:"ar"},er=["research","search","find","look up","investigate","explore","analyze","study"];function Gn(t){const e=t.toLowerCase().trim(),r=t.trim();if(!er.some(c=>e.includes(c)))return{isResearchCommand:!1,query:r,originalText:r};let a,i=r;const o=/research\s+in\s+(\w+)(?:\s+about\s+(.+))?/i,d=r.match(o);if(d){const c=d[1].toLowerCase();a=Hn(c),i=d[2]||r.replace(o,"").trim()}if(!a)for(const[c,l]of Object.entries(Er)){for(const u of l){const h=new RegExp(`research\\s+${u}\\s+(.+)$`,"i"),x=r.match(h);if(x){a=Ve[c],i=x[1].trim();break}}if(a)break}if(!a){const c=/research\s+(?:about\s+)?(.+)$/i,l=r.match(c);l?i=l[1].trim():i=r.replace(new RegExp(`(${er.join("|")})\\s+`,"gi"),"").trim()}return i=i.replace(/^(in|about|on|for|regarding|concerning)\s+/i,"").trim(),{isResearchCommand:!0,language:a,query:i||r,originalText:r}}function Hn(t){const e=t.toLowerCase();for(const[r,n]of Object.entries(Er))if(n.some(a=>a.toLowerCase()===e))return Ve[r];if(Ve[e])return Ve[e]}function Kn(t,e={}){const r=e.maxLength||200,n=e.minLength||50,a=t.replace(/\s+/g," ").trim();if(a.length<=r)return a;const i=a.split(/[.!?]\s+/);let o="";for(const c of i)if((o+c).length<=r)o+=(o?". ":"")+c;else break;if(o.length>=n)return o+(o.endsWith(".")?"":".");const d=a.split(/\s+/);o="";for(const c of d)if((o+c).length<=r)o+=(o?" ":"")+c;else break;return o+(o.endsWith(".")?"":".")}async function Vn(t,e={}){if(!t||t.trim().length<10)return{summary:t.trim(),confidence:1,method:"fallback"};const r=e.language||"auto";if(e.useOfflineModel!==!1&&typeof window<"u"&&typeof window.transformers<"u")try{const{pipeline:i}=window.transformers,d=await(await i("summarization","facebook/mbart-large-50-many-to-many-mmt",{device:"cpu"}))(t,{max_length:e.maxLength||200,min_length:e.minLength||50,do_sample:!1});if(d&&d[0]&&d[0].summary_text)return{summary:d[0].summary_text,confidence:.9,method:"mbart",language:r!=="auto"?r:"en"}}catch(i){M.warn("[OfflineSummarizer] Transformers.js mBART failed, using extraction:",i)}const a=Kn(t,e);return{summary:a,confidence:a.length>=(e.minLength||50)?.7:.5,method:"extraction",language:r!=="auto"?r:"en"}}const Me=960,De=420,Qn={"research-query":"#60a5fa","research-source":"#a855f7","research-evidence":"#facc15"};function tr(t){return t==="research-query"||t==="research-source"||t==="research-evidence"}function Jn(t,e){if(!t||!e)return null;const{nodes:r,edges:n}=t;if(!Array.isArray(r)||r.length===0)return null;const a=new Map;if(r.forEach(g=>{g?.key&&a.set(g.key,g)}),!a.get(e))return null;const o=n.filter(g=>{const _=a.get(g.src),F=a.get(g.dst);return tr(_?.type)&&tr(F?.type)}),d=new Set([e]);let c=!0;for(;c;){c=!1;for(const g of o)d.has(g.src)&&!d.has(g.dst)?(d.add(g.dst),c=!0):d.has(g.dst)&&!d.has(g.src)&&(d.add(g.src),c=!0)}const l=Array.from(d).map(g=>a.get(g)).filter(g=>!!g);if(l.length<=1)return null;const u=o.filter(g=>d.has(g.src)&&d.has(g.dst)),h=new Map,x={x:Me/2,y:De/2};h.set(e,{...x});const w=l.filter(g=>g.type==="research-source"),S=l.filter(g=>g.type==="research-evidence"),m=Math.min(Me,De)*.35,p=w.length>0?Math.PI*2/w.length:0,$=-Math.PI/2;w.forEach((g,_)=>{const F=$+p*_,L=x.x+m*Math.cos(F),X=x.y+m*Math.sin(F);h.set(g.key,{x:L,y:X,angle:F})});const q=new Map;u.forEach(g=>{const _=a.get(g.src),F=a.get(g.dst);if(!(!_||!F)){if(_.type==="research-source"&&F.type==="research-evidence"){const L=q.get(_.key)??[];L.includes(F.key)||(L.push(F.key),q.set(_.key,L))}else if(_.type==="research-evidence"&&F.type==="research-source"){const L=q.get(F.key)??[];L.includes(_.key)||(L.push(_.key),q.set(F.key,L))}}}),S.forEach(g=>{const _=u.find(ae=>ae.dst===g.key&&a.get(ae.src)?.type==="research-source")||u.find(ae=>ae.src===g.key&&a.get(ae.dst)?.type==="research-source"),F=_&&a.get(_.src)?.type==="research-source"?_.src:_&&a.get(_.dst)?.type==="research-source"?_.dst:null;if(!F||!h.has(F)){const ae=m*.2;h.set(g.key,{x:x.x+(Math.random()-.5)*ae,y:x.y+(Math.random()-.5)*ae});return}const L=h.get(F),X=q.get(F)??[],Y=X.indexOf(g.key),W=Math.max(.4,Math.min(1.2,X.length*.18)),O=L.angle!==void 0?L.angle:Math.atan2(L.y-x.y,L.x-x.x),Te=(Y-(X.length-1)/2)*W,te=Math.min(140,m*.6),Ue=O+Te;h.set(g.key,{x:L.x+te*Math.cos(Ue),y:L.y+te*Math.sin(Ue)})});const U=l.map(g=>({...g,position:h.get(g.key)??{...x}})),G=u.map(g=>({...g,source:h.get(g.src),target:h.get(g.dst)}));return{nodes:U,edges:G}}function Xn({query:t,queryKey:e,graphData:r,activeSourceId:n,onSelectSource:a,onOpenSource:i}){const o=b.useMemo(()=>Jn(r,e),[r,e]),d=b.useRef(null),[c,l]=b.useState(null);if(!o||o.nodes.length<=1)return s.jsxs("div",{className:"flex h-[320px] w-full flex-col items-center justify-center gap-3 rounded-xl border border-dashed border-white/10 bg-black/10 text-center",children:[s.jsx("p",{className:"text-sm text-gray-400",children:"Run a research query to generate a live evidence graph."}),s.jsx("p",{className:"text-xs text-gray-500",children:"The graph links your question to vetted sources and their key evidence."})]});const u=new Map(o.nodes.map(m=>[m.key,m])),h=m=>{if(m.type==="research-source"){const p=m.meta?.url||m.meta?.fragmentUrl;p&&i(p),a(m.key)}else if(m.type==="research-evidence"){const p=m.meta?.sourceKey;p&&a(p);const $=m.meta?.fragmentUrl||m.meta?.url;$&&i($)}},x=m=>{switch(m.type){case"research-query":return 42;case"research-source":return m.key===n?26:22;case"research-evidence":return 16;default:return 18}},w=m=>m.type==="research-source"&&m.key===n?"#34d399":Qn[m.type??""]??"#818cf8",S=m=>{const p=u.get(m.src)?.type,$=u.get(m.dst)?.type;return p==="research-source"&&$==="research-source"?{stroke:"#f97316",strokeWidth:1.6,strokeDasharray:"4 4",opacity:.7}:p==="research-source"&&$==="research-evidence"?{stroke:"#a855f7",strokeWidth:1.4,opacity:.55}:{stroke:"#60a5fa",strokeWidth:Math.max(1.2,Math.min(2.6,(m.weight??40)/50)),opacity:.65}};return s.jsxs("div",{ref:d,className:"relative h-[360px] w-full overflow-hidden rounded-xl border border-white/10 bg-gradient-to-br from-[#05060c] via-[#0b0e18] to-[#11162a] shadow-inner shadow-black/30",children:[s.jsxs("svg",{viewBox:`0 0 ${Me} ${De}`,className:"h-full w-full",role:"presentation",children:[s.jsx("defs",{children:s.jsxs("radialGradient",{id:"queryGlow",r:"65%",children:[s.jsx("stop",{offset:"0%",stopColor:"#60a5fa",stopOpacity:"0.55"}),s.jsx("stop",{offset:"100%",stopColor:"#60a5fa",stopOpacity:"0"})]})}),o.edges.map(m=>{if(!m.source||!m.target)return null;const p=S(m);return s.jsx("g",{children:s.jsx("line",{x1:m.source.x,y1:m.source.y,x2:m.target.x,y2:m.target.y,stroke:p.stroke,strokeWidth:p.strokeWidth,strokeDasharray:p.strokeDasharray,opacity:p.opacity})},`${m.src}-${m.dst}-${m.rel??"edge"}`)}),o.nodes.map(m=>{const p=m.position,$=x(m),q=w(m);return s.jsxs("g",{transform:`translate(${p.x}, ${p.y})`,tabIndex:m.type==="research-query"?-1:0,role:m.type==="research-query"?"group":"button","aria-label":m.type==="research-source"?`Source: ${m.title??m.meta?.domain??"unknown"}`:m.type==="research-evidence"?`Evidence: ${m.title??"excerpt"}`:`Query node for ${t}`,onFocus:U=>{if((m.type==="research-source"||m.type==="research-evidence")&&d.current?.getBoundingClientRect()){const g=p.x*(U.currentTarget.ownerSVGElement?.clientWidth??1)/Me,_=p.y*(U.currentTarget.ownerSVGElement?.clientHeight??1)/De;l({node:m,x:g,y:_})}},onBlur:()=>l(null),onMouseEnter:U=>{const G=d.current?.getBoundingClientRect();if(!G)return;const g=G.width/Me,_=G.height/De;l({node:m,x:p.x*g,y:p.y*_})},onMouseLeave:()=>l(null),onClick:()=>h(m),onKeyDown:U=>{(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),h(m))},children:[m.type==="research-query"&&s.jsx("circle",{r:$*1.8,fill:"url(#queryGlow)",opacity:.4}),s.jsx("circle",{r:$,fill:q,opacity:m.type==="research-query"?.85:.75,stroke:m.type==="research-source"&&m.key===n?"#34d399":"#0f172a",strokeWidth:m.type==="research-source"&&m.key===n?3:1.5}),s.jsx("text",{x:0,y:$+16,textAnchor:"middle",className:"select-none",fill:"#cbd5f5",fontSize:12,children:m.type==="research-query"?"Question":m.type==="research-source"?m.meta?.domain??"Source":"Evidence"})]},m.key)})]}),c&&s.jsxs("div",{className:"pointer-events-none absolute z-10 w-[240px] max-w-[80vw] rounded-xl border border-white/10 bg-black/80 px-3 py-2 text-xs text-gray-200 shadow-lg backdrop-blur",style:{left:Math.min(Math.max(c.x+12,8),(d.current?.clientWidth??0)-220),top:Math.min(Math.max(c.y+12,8),(d.current?.clientHeight??0)-120)},children:[s.jsx("div",{className:"text-[11px] uppercase tracking-wide text-gray-400",children:c.node.type==="research-query"?"Question":c.node.type==="research-source"?"Source":"Evidence"}),s.jsx("div",{className:"mt-1 font-medium text-gray-100",children:c.node.title||c.node.meta?.domain||"Untitled"}),c.node.type==="research-source"&&c.node.meta?.url&&s.jsx("div",{className:"mt-1 truncate text-[11px] text-blue-200",children:c.node.meta.url}),c.node.meta?.snippet&&s.jsx("div",{className:"mt-2 line-clamp-3 text-[11px] text-gray-400",children:c.node.meta.snippet})]}),s.jsxs("div",{className:"pointer-events-none absolute bottom-3 right-3 flex flex-wrap items-center gap-2 rounded-full border border-white/10 bg-black/60 px-3 py-1 text-[10px] uppercase tracking-wide text-gray-400",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-[#60a5fa]/80"}),"Question"]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-[#a855f7]/80"}),"Sources"]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-[#facc15]/80"}),"Evidence"]})]})]})}const rr={news:"News",academic:"Academic",documentation:"Docs",forum:"Forum",other:"Web"},sr={news:"bg-blue-500/10 text-blue-200 border-blue-500/30",academic:"bg-purple-500/10 text-purple-200 border-purple-500/30",documentation:"bg-emerald-500/10 text-emerald-200 border-emerald-500/30",forum:"bg-amber-500/10 text-amber-200 border-amber-500/30",other:"bg-slate-500/10 text-slate-200 border-slate-500/30"};function Yn({source:t,index:e,isActive:r,onActivate:n,onOpen:a}){const[i,o]=b.useState(!1),d=t.url??`source-${e}`,c=typeof t.metadata?.provider=="string"?t.metadata.provider:void 0,l=Number.isFinite(t.relevanceScore)?t.relevanceScore:null,u=t.sourceType||t.type||"other",h=!!t.url,x=t.fetchedAt?new Date(t.fetchedAt).toLocaleString():null,w=t.lang?t.lang.toUpperCase():null,S=!!t.metadata?.selectorMatched,m=b.useMemo(()=>i?t.text||t.snippet||t.excerpt||"":t.excerpt||t.snippet||(t.text?`${t.text.slice(0,220)}${t.text.length>220?"…":""}`:""),[i,t.excerpt,t.snippet,t.text]),p=()=>{n(d)};return s.jsxs("article",{className:`rounded-2xl border p-4 transition-colors ${r?"border-blue-500/50 bg-blue-500/5 shadow-[0_0_30px_rgba(59,130,246,0.15)]":"border-white/10 bg-white/[0.02] hover:border-white/20"}`,children:[s.jsxs("header",{className:"flex flex-wrap items-start gap-3",children:[s.jsxs("button",{type:"button",onClick:p,className:"flex-1 text-left",children:[s.jsxs("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:["Source ",e+1]}),s.jsx("h4",{className:"mt-0.5 text-base font-semibold text-white hover:text-blue-200 transition-colors",children:t.title||t.url||"Untitled source"}),s.jsx("p",{className:"text-xs text-gray-500",children:t.domain||c||"unknown-domain"})]}),s.jsxs("div",{className:"flex flex-col items-end gap-2 text-xs",children:[s.jsx("span",{className:`rounded-full border px-2 py-0.5 capitalize ${sr[u]??sr.other}`,children:rr[u]??rr.other}),c&&s.jsx("span",{className:"rounded-full border border-white/10 px-2 py-0.5 text-[10px] uppercase tracking-wide text-gray-400",children:c}),l!==null&&s.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-white/10 px-2 py-0.5 text-[11px] text-gray-300",children:[s.jsx(he,{size:12,className:"text-blue-200"}),Math.round(l)]})]})]}),t.image&&s.jsx("div",{className:"mt-3 h-36 overflow-hidden rounded-xl border border-white/10 bg-white/[0.04]",children:s.jsx("img",{src:t.image,alt:t.title||"Preview",className:"h-full w-full object-cover",loading:"lazy"})}),s.jsx("p",{className:"mt-3 text-sm text-gray-300 leading-relaxed whitespace-pre-line",children:m}),s.jsxs("footer",{className:"mt-4 flex flex-wrap items-center gap-3 text-[11px] text-gray-400",children:[t.wordCount&&t.wordCount>0&&s.jsxs("span",{className:"rounded-full border border-white/10 px-2 py-0.5",children:[t.wordCount.toLocaleString()," words"]}),w&&s.jsxs("span",{className:"rounded-full border border-white/10 px-2 py-0.5",children:["Lang ",w]}),t.rendered&&s.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-indigo-500/40 bg-indigo-500/10 px-2 py-0.5 text-indigo-200",children:[s.jsx(cs,{size:11}),"Rendered"]}),t.fromCache&&s.jsx("span",{className:"rounded-full border border-emerald-400/30 bg-emerald-500/10 px-2 py-0.5 text-emerald-200",children:"Cached"}),S&&s.jsx("span",{className:"rounded-full border border-blue-400/30 bg-blue-500/10 px-2 py-0.5 text-blue-200",children:"Focused extract"}),x&&s.jsx("span",{className:"rounded-full border border-white/10 px-2 py-0.5",children:x})]}),s.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 text-sm",children:[s.jsxs("button",{type:"button",onClick:()=>h&&a(t.url),disabled:!h,className:`inline-flex items-center gap-1 rounded-lg border px-3 py-1.5 text-xs font-medium ${h?"border-white/20 text-white hover:border-blue-400/50 hover:text-blue-100":"border-white/5 text-gray-500 cursor-not-allowed"}`,children:[h?"Open source":"No link",s.jsx(Xe,{size:14})]}),s.jsx("button",{type:"button",onClick:()=>o($=>!$),className:"inline-flex items-center gap-1 rounded-lg border border-white/10 px-3 py-1.5 text-xs text-gray-300 hover:text-white",children:i?s.jsxs(s.Fragment,{children:["Collapse",s.jsx(ls,{size:14})]}):s.jsxs(s.Fragment,{children:["Expand details",s.jsx(ds,{size:14})]})})]})]})}function Zn({summary:t,citations:e,inlineEvidence:r=[],sources:n,activeSourceId:a,onActivate:i,onOpenSource:o,onExport:d}){const[c,l]=b.useState(null),[u,h]=b.useState(null),x=b.useMemo(()=>{if(!r||r.length===0)return t.split(/(\[(\d+)\])/g).map(($,q)=>{const U=$.match(/^\[(\d+)\]$/);if(U){const G=parseInt(U[1],10),g=e.find(_=>_.index===G);if(g){const _=n[g.sourceIndex],F=_?.url??`source-${g.sourceIndex}`;return s.jsx(nr,{index:G,source:_,sourceKey:F,isActive:a===F,isHovered:c===G,onHover:l,onActivate:i,onOpenSource:o},`citation-${G}-${q}`)}}return s.jsx("span",{children:$},`text-${q}`)});const S=[];let m=0;return[...r].sort(($,q)=>$.from-q.from).forEach($=>{$.from>m&&S.push({text:t.slice(m,$.from)}),S.push({text:t.slice($.from,$.to),citation:$.citationIndex,sourceIndex:$.sourceIndex}),m=$.to}),m<t.length&&S.push({text:t.slice(m)}),S.map(($,q)=>{if($.citation!==void 0&&$.sourceIndex!==void 0){const U=n[$.sourceIndex],G=U?.url??`source-${$.sourceIndex}`;return s.jsxs("span",{children:[s.jsx(nr,{index:$.citation,source:U,sourceKey:G,isActive:a===G,isHovered:c===$.citation,onHover:l,onActivate:i,onOpenSource:o}),$.text]},`part-${q}`)}return s.jsx("span",{children:$.text},`text-${q}`)})},[t,e,r,n,a,c,i,o]),w=async S=>{h(S);try{if(d)await d(S);else{const m={query:"",summary:t,citations:e.map(p=>({index:p.index,source:n[p.sourceIndex],quote:p.quote,confidence:p.confidence})),sources:n.map(p=>({title:p.title,url:p.url,domain:p.domain}))};if(S==="markdown"){let p=`# Research Summary

`;p+=`${t}

`,p+=`## Citations

`,e.forEach(G=>{const g=n[G.sourceIndex];p+=`[${G.index}] ${g?.title||"Unknown"} (${g?.url||""})
`,p+=`  Confidence: ${(G.confidence*100).toFixed(0)}%
`,G.quote&&(p+=`  Quote: "${G.quote}"
`),p+=`
`}),p+=`## Sources

`,n.forEach((G,g)=>{p+=`${g+1}. [${G.title}](${G.url}) - ${G.domain}
`});const $=new Blob([p],{type:"text/markdown"}),q=URL.createObjectURL($),U=document.createElement("a");U.href=q,U.download=`research-${Date.now()}.md`,U.click(),URL.revokeObjectURL(q)}else await Z.research.export({format:"markdown",sources:n.map(p=>p.url),includeNotes:!0})}}catch(m){console.error("Export failed:",m)}finally{h(null)}};return s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-sm leading-relaxed text-gray-200 whitespace-pre-wrap",children:x}),d&&s.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[s.jsx(ee.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>w("markdown"),disabled:u!==null,className:"p-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition-colors disabled:opacity-50",title:"Export as Markdown",children:s.jsx(jt,{size:16,className:u==="markdown"?"animate-pulse":""})}),s.jsx(ee.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>w("pdf"),disabled:u!==null,className:"p-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition-colors disabled:opacity-50",title:"Export as PDF",children:s.jsx(us,{size:16,className:u==="pdf"?"animate-pulse":""})})]})]})})}function nr({index:t,source:e,sourceKey:r,isActive:n,isHovered:a,onHover:i,onActivate:o,onOpenSource:d}){return s.jsxs(ee.sup,{className:`inline-flex items-center gap-1 mx-0.5 px-1.5 py-0.5 rounded text-[10px] font-semibold cursor-pointer transition-all ${n?"bg-blue-500/30 text-blue-200 border border-blue-400/50":a?"bg-blue-500/20 text-blue-300 border border-blue-400/30":"bg-white/10 text-gray-300 border border-white/10 hover:bg-white/15"}`,onMouseEnter:()=>i(t),onMouseLeave:()=>i(null),onClick:c=>{c.preventDefault(),c.stopPropagation(),o(r),e?.url&&d(e.url)},whileHover:{scale:1.1},whileTap:{scale:.95},title:e?`${e.title} - ${e.domain}`:`Citation ${t}`,children:["[",t,"]",a&&e&&s.jsx(Xe,{size:10,className:"opacity-70"})]})}function ea({evidence:t,sources:e,activeEvidenceId:r,onEvidenceClick:n}){const{activeId:a}=ur(),i=b.useRef(new Map);return b.useEffect(()=>{if(!a||!r){i.current.forEach(l=>l()),i.current.clear();return}const o=t.find(l=>l.id===r);if(!o)return;const d=e[o.sourceIndex];return d?((async()=>{try{const u=(await Z.tabs.list()).find(S=>S.id===a);if(!u||!u.url)return;const h=new URL(d.url),x=new URL(u.url);if(h.hostname!==x.hostname)return;const w=`
          (function() {
            const quote = ${JSON.stringify(o.quote)};
            const context = ${JSON.stringify(o.context)};
            
            // Try to find the quote in the page
            const walker = document.createTreeWalker(
              document.body,
              NodeFilter.SHOW_TEXT,
              null
            );
            
            let node;
            const matches = [];
            while (node = walker.nextNode()) {
              const text = node.textContent;
              if (text && text.includes(quote)) {
                matches.push(node);
              }
            }
            
            if (matches.length > 0) {
              // Highlight the first match
              const match = matches[0];
              const range = document.createRange();
              const startIndex = match.textContent.indexOf(quote);
              if (startIndex !== -1) {
                range.setStart(match, startIndex);
                range.setEnd(match, startIndex + quote.length);
                
                const highlight = document.createElement('mark');
                highlight.style.backgroundColor = 'rgba(59, 130, 246, 0.4)';
                highlight.style.color = 'inherit';
                highlight.style.padding = '2px 4px';
                highlight.style.borderRadius = '3px';
                highlight.style.boxShadow = '0 0 8px rgba(59, 130, 246, 0.6)';
                highlight.className = 'regen-evidence-highlight';
                highlight.setAttribute('data-evidence-id', ${JSON.stringify(r)});
                
                try {
                  range.surroundContents(highlight);
                  
                  // Scroll into view
                  highlight.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  
                  // Store cleanup function
                  window.__omnib_evidence_cleanup = function() {
                    const parent = highlight.parentNode;
                    if (parent) {
                      parent.replaceChild(document.createTextNode(quote), highlight);
                      parent.normalize();
                    }
                  };
                } catch (e) {
                  console.warn('Failed to highlight evidence:', e);
                }
              }
            }
          })();
        `;o.fragmentUrl?await Z.tabs.navigate(a,o.fragmentUrl):console.log("Evidence highlight requires fragment URL or backend script injection support"),i.current.set(r,()=>{})}catch(l){console.warn("Failed to highlight evidence:",l)}})(),()=>{i.current.forEach(l=>l()),i.current.clear()}):void 0},[a,r,t,e]),null}function ta({open:t,answers:e,selectedIds:r,onToggleSelect:n,onClose:a,onRemove:i}){const o=r.map(l=>e.find(u=>u.id===l)).filter(Boolean),d=b.useMemo(()=>{if(o.length<2)return{sharedDomains:[]};const[l,u]=o,h=new Set((l.sources??[]).map(S=>S.domain||S.url)),x=new Set((u.sources??[]).map(S=>S.domain||S.url));return{sharedDomains:[...h].filter(S=>S&&x.has(S))}},[o]),c=b.useMemo(()=>{if(o.length<2)return[];const[l,u]=o;return sa(l.summary,u.summary,l.id,u.id)},[o]);return s.jsx(xr,{children:t&&s.jsxs(ee.aside,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",stiffness:200,damping:30},className:"fixed inset-x-0 bottom-0 z-[80] max-h-[70vh] overflow-hidden rounded-t-3xl border border-white/10 bg-[#070912]/95 shadow-2xl shadow-black/40 backdrop-blur",children:[s.jsxs("div",{className:"flex items-center justify-between border-b border-white/5 px-6 py-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs uppercase tracking-wide text-sky-300",children:"Compare answers"}),s.jsxs("p",{className:"text-sm text-gray-400",children:[e.length," saved • select up to 2"]})]}),s.jsxs("button",{type:"button",onClick:a,className:"inline-flex items-center gap-1 rounded-full border border-white/10 px-3 py-1.5 text-xs text-gray-200 hover:border-white/30",children:[s.jsx(hs,{size:14}),"Close"]})]}),s.jsxs("div",{className:"grid gap-4 border-b border-white/5 px-6 py-4 md:grid-cols-2",children:[e.length===0&&s.jsx("div",{className:"col-span-2 rounded-2xl border border-white/10 bg-white/[0.02] px-4 py-6 text-center text-sm text-gray-400",children:"Save answers from Research Mode to compare them here."}),e.map(l=>{const u=r.includes(l.id);return s.jsxs("button",{type:"button",onClick:()=>n(l.id),className:`rounded-2xl border px-4 py-3 text-left transition-all ${u?"border-sky-500/60 bg-sky-500/10 shadow-[0_0_35px_rgba(56,189,248,0.2)]":"border-white/10 bg-white/[0.02] hover:border-white/20"}`,children:[s.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[s.jsx("span",{children:new Date(l.createdAt).toLocaleString()}),s.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-white/10 px-2 py-0.5 text-[10px] uppercase tracking-wide text-gray-300",children:[s.jsx(ms,{size:12,className:"text-emerald-300"}),(l.provider||l.model||"ai").toUpperCase()]})]}),s.jsx("p",{className:"mt-2 line-clamp-3 text-sm text-gray-200",children:l.summary}),s.jsxs("div",{className:"mt-3 flex items-center gap-2 text-[11px] text-gray-400",children:[s.jsxs("span",{children:[l.sources.length," sources"]}),s.jsx("span",{children:"•"}),s.jsxs("span",{children:["Authority bias ",l.settings.authorityBias,"%"]}),s.jsx("span",{children:"•"}),s.jsx("span",{children:l.settings.region})]}),s.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs",children:[s.jsx("span",{className:"text-sky-300",children:u?"Selected":"Tap to select"}),s.jsxs("button",{type:"button",onClick:h=>{h.stopPropagation(),i(l.id)},className:"inline-flex items-center gap-1 rounded-full border border-red-500/30 px-2 py-0.5 text-[10px] uppercase tracking-wide text-red-200 hover:border-red-400",children:[s.jsx(ps,{size:12}),"Remove"]})]})]},l.id)})]}),s.jsxs("div",{className:"grid gap-4 px-6 py-4 md:grid-cols-2",children:[o.length===0&&s.jsx("div",{className:"col-span-2 rounded-2xl border border-dashed border-white/10 bg-white/[0.02] px-4 py-6 text-center text-sm text-gray-400",children:"Select two answers above to view a detailed comparison."}),o.slice(0,2).map(l=>s.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/[0.02] p-4",children:[s.jsxs("header",{className:"flex items-center justify-between text-xs text-gray-400",children:[s.jsxs("span",{className:"inline-flex items-center gap-1 text-white",children:[s.jsx(he,{size:12,className:"text-sky-300"}),l.query]}),s.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.jsx(gs,{size:12}),new Date(l.createdAt).toLocaleTimeString()]})]}),s.jsx("p",{className:"mt-3 text-sm text-gray-200 whitespace-pre-line",children:l.summary}),s.jsxs("div",{className:"mt-3 grid gap-2 text-xs text-gray-400 sm:grid-cols-3",children:[s.jsx(mt,{label:"Confidence",value:ra(l.confidence)}),s.jsx(mt,{label:"Sources",value:`${l.sources.length}`}),s.jsx(mt,{label:"Settings",value:`${l.settings.authorityBias}% authority`})]})]},l.id)),o.length>=2&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/[0.02] p-4",children:[s.jsxs("h4",{className:"flex items-center gap-2 text-sm font-semibold text-white",children:[s.jsx(fs,{size:14,className:"text-sky-300"}),"Shared sources (",d.sharedDomains.length,")"]}),s.jsx("ul",{className:"mt-3 space-y-1 text-xs text-gray-300",children:d.sharedDomains.length>0?d.sharedDomains.map(l=>s.jsx("li",{className:"rounded border border-white/10 px-2 py-1",children:l},l)):s.jsx("li",{className:"text-gray-500",children:"No overlapping domains."})})]}),s.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/[0.02] p-4",children:[s.jsx("h4",{className:"text-sm font-semibold text-white",children:"Unique takeaways"}),s.jsx("ul",{className:"mt-3 space-y-2 text-sm text-gray-300",children:c.length>0?c.map(l=>s.jsxs("li",{className:"rounded border border-white/10 px-3 py-2",children:[s.jsx("span",{className:"text-[11px] uppercase tracking-wide text-sky-300",children:l.owner===o[0].id?"Answer A":"Answer B"}),s.jsx("p",{className:"text-gray-200",children:l.text})]},l.text)):s.jsx("li",{className:"text-gray-500",children:"Summaries are largely aligned."})})]})]})]})]})})}function mt({label:t,value:e}){return s.jsxs("div",{className:"rounded border border-white/10 px-3 py-2",children:[s.jsx("p",{className:"text-[10px] uppercase tracking-wide text-gray-500",children:t}),s.jsx("p",{className:"text-sm font-semibold text-white",children:e??"—"})]})}function ra(t){return typeof t!="number"?"—":`${Math.round(t*100)}%`}function sa(t,e,r,n){const a=ar(t).map(l=>({id:`a-${l}`,text:l})),i=ar(e).map(l=>({id:`b-${l}`,text:l})),o=new Set(a.map(l=>l.text)),d=new Set(i.map(l=>l.text)),c=[];return a.forEach(l=>{d.has(l.text)||c.push({owner:r,text:l.text})}),i.forEach(l=>{o.has(l.text)||c.push({owner:n,text:l.text})}),c.slice(0,6)}function ar(t){return t.split(new RegExp("(?<=[.!?])\\s+")).map(e=>e.trim()).filter(Boolean)}const Tr=b.createContext({sidebarWidth:240,navHeight:64,rightPanelWidth:0}),Ir=()=>b.useContext(Tr);function na({children:t,sidebarWidth:e=240,navHeight:r=64,rightPanelWidth:n=0,...a}){return s.jsx(Tr.Provider,{value:{sidebarWidth:e,navHeight:r,rightPanelWidth:n},children:s.jsx("div",{className:"flex h-full w-full flex-col overflow-hidden","data-testid":"layout-engine-root",...a,children:t})})}function aa({sticky:t=!0,className:e,children:r,...n}){const{navHeight:a}=Ir();return s.jsx("header",{className:Sr("flex-shrink-0 border-b border-slate-700/50 bg-slate-900/95 backdrop-blur-xl",t&&"sticky top-0 z-40",e),style:{height:a},...n,children:r})}function ia({sidebar:t,rightPanel:e,sidebarCollapsed:r=!1,rightPanelCollapsed:n=!1,className:a,children:i,...o}){const{sidebarWidth:d,rightPanelWidth:c}=Ir();return s.jsxs("div",{className:Sr("flex flex-1 min-h-0 overflow-hidden",a),...o,children:[t&&s.jsx(ee.aside,{initial:!1,animate:{width:r?0:d,opacity:r?0:1},transition:{duration:.2,ease:"easeInOut"},className:"flex-shrink-0 border-r border-slate-700/50 bg-slate-900/60 overflow-hidden",style:{width:r?0:d},children:s.jsx("div",{className:"h-full overflow-y-auto",children:t})}),s.jsx("main",{className:"flex-1 min-w-0 overflow-hidden bg-slate-950",children:i}),e&&s.jsx(ee.aside,{initial:!1,animate:{width:n?0:c||320,opacity:n?0:1},transition:{duration:.2,ease:"easeInOut"},className:"flex-shrink-0 border-l border-slate-700/50 bg-slate-900/60 overflow-hidden",style:{width:n?0:c||320},children:s.jsx("div",{className:"h-full overflow-y-auto",children:e})})]})}const oa=6,ca=Ye()(St((t,e)=>({entries:[],addEntry(r){const n=Date.now(),a={...r,id:`compare-${n}-${Math.random().toString(36).slice(2,8)}`,createdAt:n};return t(i=>{const o=i.entries.filter(c=>c.summary!==r.summary||c.query!==r.query);return{entries:[a,...o].slice(0,oa)}}),a},removeEntry(r){t(n=>({entries:n.entries.filter(a=>a.id!==r)}))},clear(){t({entries:[]})}}),{name:"research:compare-store",version:1})),ir=(typeof window<"u"?window.__OB_API_BASE__:"")||void 0||void 0||"";async function la(t,e={}){if(!ir)throw new Error("API base URL not configured");const r=await fetch(`${ir.replace(/\/$/,"")}/api/research/deep-scan`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t,urls:e.urls,max_pages:e.maxPages??5,allow_render:e.allowRender??!0})});if(!r.ok){const n=await r.text().catch(()=>r.statusText);throw new Error(n||"Failed to run deep scan")}return await r.json()}function da({pageSnapshot:t,editorState:e,onClose:r}){const[n,a]=b.useState([]),[i,o]=b.useState(""),[d,c]=b.useState(!1),[l,u]=b.useState(null),[h,x]=b.useState(!1),[w,S]=b.useState(""),[m,p]=b.useState(null),$=b.useRef(null),q=b.useRef(null);b.useEffect(()=>{U()},[]),b.useEffect(()=>{const L=X=>{if(X.jobId!==m)return;const Y=X.chunk;Y.type==="token"?a(W=>{const O=W[W.length-1];return O&&O.role==="assistant"&&O.streaming?[...W.slice(0,-1),{...O,content:O.content+Y.data}]:W}):Y.type==="patch"?a(W=>{const O=W[W.length-1];return O&&O.role==="assistant"?[...W.slice(0,-1),{...O,patches:[...O.patches||[],Y.data]}]:W}):Y.type==="citation"?a(W=>{const O=W[W.length-1];return O&&O.role==="assistant"?[...W.slice(0,-1),{...O,citations:[...O.citations||[],Y.data]}]:W}):Y.type==="done"?(c(!1),a(W=>{const O=W[W.length-1];return O&&O.role==="assistant"&&O.streaming?[...W.slice(0,-1),{...O,streaming:!1}]:W})):Y.type==="error"&&(c(!1),$e("error",`Cursor error: ${Y.data}`),a(W=>{const O=W[W.length-1];return O&&O.streaming?[...W.slice(0,-1),{...O,streaming:!1,content:O.content+`

[Error: ${Y.data}]`}]:W}))};return window.electron?.ipcRenderer?.on("cursor:stream",L),()=>{window.electron?.ipcRenderer?.removeListener("cursor:stream",L)}},[m]),b.useEffect(()=>{$.current?.scrollIntoView({behavior:"smooth"})},[n]);const U=async()=>{try{const L=await Z.cursor.checkApiKey();u(L.hasKey)}catch(L){console.error("[CursorChat] Failed to check API key",L),u(!1)}},G=async()=>{if(!w.trim()){$e("error","API key cannot be empty");return}try{await Z.cursor.setApiKey({apiKey:w.trim()}),u(!0),x(!1),S(""),$e("success","API key saved securely")}catch(L){console.error("[CursorChat] Failed to set API key",L),$e("error","Failed to save API key")}},g=async L=>{if(L.preventDefault(),!i.trim()||d||!l)return;const X=i.trim();o("");const Y={id:`msg-${Date.now()}-user`,role:"user",content:X,timestamp:Date.now()},W={id:`msg-${Date.now()}-assistant`,role:"assistant",content:"",timestamp:Date.now(),streaming:!0};a(O=>[...O,Y,W]),c(!0);try{const O=await Z.cursor.query({question:X,pageSnapshot:t,editorState:e,useWebSocket:!1});p(O.jobId)}catch(O){console.error("[CursorChat] Query failed",O),$e("error",O instanceof Error?O.message:"Query failed"),c(!1),a(Te=>Te.slice(0,-1))}},_=()=>{q.current&&q.current.abort(),c(!1),p(null)},F=async()=>{try{await Z.cursor.clearHistory(),a([]),$e("success","Conversation history cleared")}catch(L){console.error("[CursorChat] Failed to clear history",L)}};return l===null?s.jsx("div",{className:"flex items-center justify-center p-8",children:s.jsx(mr,{className:"animate-spin text-blue-500",size:24})}):l?s.jsxs("div",{className:"flex flex-col h-full bg-slate-900/60 border border-slate-700/70 rounded-xl overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-700/70",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(qt,{className:"text-blue-400",size:20}),s.jsx("h3",{className:"text-sm font-semibold text-gray-200",children:"Cursor AI"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[(t||e)&&s.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400",children:[t&&s.jsx(jt,{size:12}),e&&s.jsx(bs,{size:12})]}),s.jsx("button",{onClick:()=>x(!0),className:"p-1.5 rounded hover:bg-slate-800 transition",title:"Settings",children:s.jsx(ys,{size:16,className:"text-gray-400"})}),r&&s.jsx("button",{onClick:r,className:"p-1.5 rounded hover:bg-slate-800 transition",title:"Close",children:s.jsx(pr,{size:16,className:"text-gray-400"})})]})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[n.length===0&&s.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center space-y-2",children:[s.jsx(qt,{className:"text-gray-500",size:48}),s.jsx("p",{className:"text-sm text-gray-400",children:"Ask Cursor AI anything about this page or code"})]}),s.jsx(xr,{children:n.map(L=>s.jsx(ee.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${L.role==="user"?"justify-end":"justify-start"}`,children:s.jsxs("div",{className:`max-w-[80%] rounded-lg p-3 ${L.role==="user"?"bg-blue-600/80 text-white":"bg-slate-800/80 text-gray-200"}`,children:[s.jsx("p",{className:"text-sm whitespace-pre-wrap",children:L.content}),L.streaming&&s.jsx("span",{className:"inline-block w-2 h-4 bg-blue-400 ml-1 animate-pulse"}),L.citations&&L.citations.length>0&&s.jsx("div",{className:"mt-2 pt-2 border-t border-slate-700 space-y-1",children:L.citations.map((X,Y)=>s.jsxs("a",{href:X.url||X.file,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-300 hover:text-blue-200 flex items-center gap-1",children:[s.jsx(Xe,{size:12}),X.file||X.url]},Y))})]})},L.id))}),s.jsx("div",{ref:$})]}),s.jsxs("form",{onSubmit:g,className:"p-4 border-t border-slate-700/70 space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"text",value:i,onChange:L=>o(L.target.value),placeholder:"Ask Cursor AI...",disabled:d,className:"flex-1 px-3 py-2 bg-slate-800/80 border border-slate-700/70 rounded-lg text-sm text-gray-200 placeholder:text-gray-500 focus:outline-none focus:border-blue-500 disabled:opacity-50"}),d?s.jsx("button",{type:"button",onClick:_,className:"px-4 py-2 bg-red-600/80 text-white rounded-lg hover:bg-red-700 transition",children:"Cancel"}):s.jsx("button",{type:"submit",disabled:!i.trim(),className:"px-4 py-2 bg-blue-600/80 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:s.jsx(gr,{size:16})})]}),s.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[s.jsx("button",{type:"button",onClick:F,className:"hover:text-gray-400 transition",children:"Clear history"}),s.jsxs("span",{children:[n.length," messages"]})]})]}),h&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>x(!1),children:s.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl p-6 max-w-md w-full mx-4",onClick:L=>L.stopPropagation(),children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:"Cursor API Key"}),s.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Your API key will be stored securely using your OS keychain."}),s.jsx("input",{type:"password",value:w,onChange:L=>S(L.target.value),placeholder:"Enter Cursor API key",className:"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-sm text-gray-200 mb-4 focus:outline-none focus:border-blue-500"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:G,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Save"}),s.jsx("button",{onClick:()=>{x(!1),S("")},className:"px-4 py-2 bg-slate-800 text-gray-300 rounded-lg hover:bg-slate-700 transition",children:"Cancel"})]})]})})]}):s.jsxs("div",{className:"flex flex-col items-center justify-center p-8 space-y-4",children:[s.jsx(xs,{className:"text-yellow-500",size:48}),s.jsx("h3",{className:"text-lg font-semibold text-gray-200",children:"Cursor API Key Required"}),s.jsx("p",{className:"text-sm text-gray-400 text-center max-w-md",children:"Please configure your Cursor API key to use the AI assistant. Your key will be stored securely using your OS keychain."}),s.jsx("button",{onClick:()=>x(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Configure API Key"})]})}async function ua(t){return nn(`agent:${t.type}`,async()=>{const e=performance.now();Se("agent_task_started",{taskType:t.type});try{let r;switch(t.type){case"quick_summary":{r=await Lr(t);break}case"deep_research":{r=await ha(t);break}case"compare_urls":{r=await ma(t);break}case"explain_page":{r=await pa(t);break}default:throw new Error(`Unknown task type: ${t.type}`)}const n=performance.now()-e;return ft.recordAgent({agentId:"regen",runId:`run-${Date.now()}`,duration:n,success:!0,timestamp:Date.now()}),Se("agent_task_completed",{taskType:t.type,duration:n}),r}catch(r){const n=performance.now()-e;throw ft.recordAgent({agentId:"regen",runId:`run-${Date.now()}`,duration:n,success:!1,timestamp:Date.now()}),Se("agent_task_failed",{taskType:t.type,error:String(r)}),M.error("[Agent] Task failed",{task:t,error:r}),r}},{taskType:t.type})}async function Lr(t){const e=ce.get("scrapePage");if(!e)throw new Error("scrapePage tool not found");const r=await e.execute({url:t.url}),n=ce.get("summarizeText");if(!n)throw new Error("summarizeText tool not found");const a=await n.execute({text:r.content,maxLength:300});return{type:"quick_summary",content:a.summary,sources:[{url:t.url,title:r.title}],metadata:{originalLength:r.content.length,summaryLength:a.summary.length}}}async function ha(t){const e=t.maxSources??3,r=ce.get("searchWeb");if(!r)throw new Error("searchWeb tool not found");const n=await r.execute({query:t.topic,maxResults:e}),a=ce.get("scrapePage");if(!a)throw new Error("scrapePage tool not found");const i=await Promise.all(n.results.slice(0,e).map(async d=>{try{const c=await a.execute({url:d.url});return{url:d.url,title:c.title||d.title}}catch(c){return M.warn(`[Agent] Failed to scrape ${d.url}`,c),{url:d.url,title:d.title}}}));return{type:"deep_research",content:`Research on "${t.topic}":

${n.results.map((d,c)=>`${c+1}. ${d.title}
   ${d.snippet}`).join(`

`)}`,sources:i,metadata:{topic:t.topic,sourceCount:i.length}}}async function ma(t){const e=ce.get("scrapePage");if(!e)throw new Error("scrapePage tool not found");const r=await Promise.all(t.urls.map(async a=>{try{const i=await e.execute({url:a});return{url:a,title:i.title,content:i.content}}catch(i){return M.warn(`[Agent] Failed to scrape ${a}`,i),{url:a,title:"Unknown",content:""}}}));return{type:"compare_urls",content:`Comparison of ${t.urls.length} pages:

${r.map((a,i)=>`${i+1}. ${a.title} (${a.url})
   ${a.content.slice(0,200)}...`).join(`

`)}`,sources:r.map(a=>({url:a.url,title:a.title})),metadata:{urlCount:t.urls.length}}}async function pa(t){const e=await Lr({url:t.url});return{...e,type:"explain_page",content:`Explanation of ${e.sources?.[0]?.title||t.url}:

${e.content}`}}var ga=Object.defineProperty,fa=(t,e,r)=>e in t?ga(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xa=(t,e,r)=>fa(t,e+"",r);class ba{constructor(){xa(this,"toolRegistry",new Map)}registerTool(e,r){this.toolRegistry.set(e,r),M.info(`[AgentGraph] Registered tool: ${e}`)}createPlan(e,r){return{id:`plan-${Date.now()}-${Math.random().toString(36).slice(2)}`,nodes:r.map(n=>({...n,id:n.id||`node-${Date.now()}-${Math.random().toString(36).slice(2)}`,retryCount:0,maxRetries:n.maxRetries??3,timeout:n.timeout??3e4})),metadata:{goal:e,createdAt:Date.now()}}}async runPlan(e,r){const n=performance.now(),a=[],i=new Map;M.info(`[AgentGraph] Executing plan: ${e.id} (${e.nodes.length} nodes)`),Se("agent_plan_started",{planId:e.id,nodeCount:e.nodes.length});try{for(const u of e.nodes){const h=performance.now();try{const x=await this.resolveNodeInput(u,i),w=this.toolRegistry.get(u.tool);if(!w)throw new Error(`Tool not found: ${u.tool}`);const S=await this.executeWithTimeout(()=>w(x,{planId:e.id,nodeId:u.id,previousResults:i,memory:r}),u.timeout||3e4),m=performance.now()-h;a.push({nodeId:u.id,success:!0,output:S,duration:m}),i.set(u.id,S),M.info(`[AgentGraph] Node ${u.id} completed in ${m.toFixed(0)}ms`),r.remember("task_history",`node:${u.id}`,{tool:u.tool,success:!0,timestamp:Date.now()})}catch(x){const w=performance.now()-h,S=x instanceof Error?x.message:String(x);if((u.retryCount||0)<(u.maxRetries||3)){u.retryCount=(u.retryCount||0)+1,M.warn(`[AgentGraph] Node ${u.id} failed, retrying (${u.retryCount}/${u.maxRetries})`);const m=await this.retryNode(u,i,r);a.push(m),m.success&&m.output&&i.set(u.id,m.output)}else a.push({nodeId:u.id,success:!1,error:S,duration:w}),M.error(`[AgentGraph] Node ${u.id} failed after retries: ${S}`)}}const o=performance.now()-n,d=a.every(u=>u.success),c=a[a.length-1]?.output,l={planId:e.id,success:d,results:a,finalOutput:c,totalDuration:o};return Se("agent_plan_completed",{planId:e.id,success:d,nodeCount:e.nodes.length,duration:o}),l}catch(o){const d=performance.now()-n,c=o instanceof Error?o.message:String(o);return Se("agent_plan_failed",{planId:e.id,error:c}),{planId:e.id,success:!1,results:a,error:c,totalDuration:d}}}async resolveNodeInput(e,r){if(!e.inputFrom||e.inputFrom.length===0)return e.input;const n={...e.input};for(const a of e.inputFrom){const i=r.get(a);i&&(typeof i=="object"&&i!==null?Object.assign(n,i):n[a]=i)}return n}async executeWithTimeout(e,r){return Promise.race([e(),new Promise((n,a)=>setTimeout(()=>a(new Error(`Execution timeout after ${r}ms`)),r))])}async retryNode(e,r,n){const a=performance.now();try{const i=await this.resolveNodeInput(e,r),o=this.toolRegistry.get(e.tool);if(!o)throw new Error(`Tool not found: ${e.tool}`);const d=await this.executeWithTimeout(()=>o(i,{planId:"retry",nodeId:e.id,previousResults:r,memory:n}),e.timeout||3e4);return{nodeId:e.id,success:!0,output:d,duration:performance.now()-a}}catch(i){return{nodeId:e.id,success:!1,error:i instanceof Error?i.message:String(i),duration:performance.now()-a}}}}const Ee=new ba,ve=Ye()(St((t,e)=>({items:[],add:r=>{const n=e().items.find(a=>a.key===r.key&&a.type===r.type);if(n)e().update(n.id,{value:r.value,lastUsedAt:Date.now(),usageCount:n.usageCount+1});else{const a={...r,id:`memory-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,createdAt:Date.now(),lastUsedAt:Date.now(),usageCount:1};t(i=>({items:[...i.items,a]}))}},update:(r,n)=>t(a=>({items:a.items.map(i=>i.id===r?{...i,...n}:i)})),getByKey:r=>e().items.find(n=>n.key===r),getByType:r=>e().items.filter(n=>n.type===r),clear:()=>t({items:[]})}),{name:"regen_agent_memory_v1"}));class ya{get(e){const r=ve.getState().getByKey(e);return r?(ve.getState().update(r.id,{lastUsedAt:Date.now()}),r.value):null}set(e,r){ve.getState().add({type:"fact",key:e,value:r})}remember(e,r,n){ve.getState().add({type:e,key:r,value:n}),M.debug(`[AgentMemory] Remembered ${e}: ${r}`)}getPreferences(){const e=ve.getState().getByType("preference"),r={};return e.forEach(n=>{r[n.key]=n.value}),r}getTaskHistory(e=10){return ve.getState().getByType("task_history").sort((n,a)=>a.lastUsedAt-n.lastUsedAt).slice(0,e)}findPatterns(e){return ve.getState().getByType(e).sort((n,a)=>a.usageCount-n.usageCount).slice(0,5)}inferPreferences(){const e=this.findPatterns("task_history"),r={},n=e.filter(i=>typeof i.value=="object"&&i.value!==null&&"topic"in i.value).map(i=>i.value.topic);n.length>0&&(r.common_research_topics=n);const a=e.filter(i=>typeof i.value=="object"&&i.value!==null&&"format"in i.value).map(i=>i.value.format);if(a.length>0){const i=a[0];r.preferred_summary_format=i}return r}}const Mr=new ya;async function wa(t){M.info(`[AgentPlanner] Planning for goal: ${t}`);const e=t.toLowerCase();return e.includes("research")&&e.includes("compare")?va(t):e.includes("summarize")||e.includes("explain")?ja(t):e.includes("extract")&&e.includes("date")?Sa(t):Na(t)}function va(t){const e=[{id:"search",tool:"search_web",input:{query:or(t),maxResults:5}},{id:"scrape",tool:"scrape_page",input:{},inputFrom:["search"]},{id:"extract",tool:"extract_table",input:{},inputFrom:["scrape"]},{id:"summarize",tool:"summarize_text",input:{format:"bullet"},inputFrom:["extract"]},{id:"save",tool:"manage_workspaces",input:{action:"create",name:`Research: ${or(t)}`},inputFrom:["scrape"]}];return Ee.createPlan(t,e)}function ja(t){const e=[{id:"scrape",tool:"scrape_page",input:{url:Dr(t)||"current_page"}},{id:"summarize",tool:"summarize_text",input:{format:Mr.getPreferences().preferred_summary_format||"paragraph"},inputFrom:["scrape"]}];return Ee.createPlan(t,e)}function Sa(t){const e=[{id:"scrape",tool:"scrape_page",input:{url:Dr(t)||"current_page"}},{id:"extract",tool:"extract_table",input:{},inputFrom:["scrape"]}];return Ee.createPlan(t,e)}function Na(t){let e="search_web";t.toLowerCase().includes("summarize")||t.toLowerCase().includes("explain")?e="summarize_text":(t.toLowerCase().includes("scrape")||t.toLowerCase().includes("read"))&&(e="scrape_page");const r=[{id:"execute",tool:e,input:{query:t}}];return Ee.createPlan(t,r)}function or(t){const e=t.match(/research\s+(.+?)(?:\s+and|$)/i);return e?e[1].trim():t}function Dr(t){const e=t.match(/https?:\/\/[^\s]+/);return e?e[0]:null}async function ka(t){const e=await wa(t),r=await Ee.runPlan(e,Mr);if(!r.success)throw new Error(r.error||"Plan execution failed");return r.finalOutput}function _a(){const t=ye.getAll();t.forEach(e=>{Ee.registerTool(e.name,async(r,n)=>ye.execute(e.name,r,n))}),M.info(`[AgentSystem] Initialized with ${t.length} tools`)}async function $a(t){return ka(t)}_a();function Ca({currentUrl:t,onResult:e}){const[r,n]=b.useState(""),[a,i]=b.useState(!1),o=async d=>{if(d.preventDefault(),!(!r.trim()||a)){i(!0);try{let c;if(r.toLowerCase().includes("research")&&(r.toLowerCase().includes("compare")||r.toLowerCase().includes("save")||r.toLowerCase().includes("workspace")))c=await $a(r),e?.({type:"complex_plan",content:typeof c=="string"?c:JSON.stringify(c,null,2),sources:[]});else{let u;if(t&&(r.toLowerCase().includes("explain")||r.toLowerCase().includes("this page"))){const h=Ke(t);if(!h.safe){H.error(h.reason||"Unsafe URL"),i(!1);return}u={type:"explain_page",url:t}}else if(r.toLowerCase().includes("compare")&&r.includes("http")){const h=r.match(/https?:\/\/[^\s]+/g)||[];if(h.length>=2){if(!h.every(w=>Ke(w).safe)){H.error("One or more URLs are unsafe"),i(!1);return}u={type:"compare_urls",urls:h}}else u={type:"deep_research",topic:r}}else if(r.toLowerCase().includes("research")||r.length>50)u={type:"deep_research",topic:r};else if(t){const h=Ke(t);if(!h.safe){H.error(h.reason||"Unsafe URL"),i(!1);return}u={type:"quick_summary",url:t}}else u={type:"deep_research",topic:r};c=await ua(u),e?.(c)}H.success("OmniAgent completed!")}catch(c){console.error("OmniAgent error",c),H.error(c instanceof Error?c.message:"OmniAgent failed")}finally{i(!1)}}};return s.jsx("div",{className:"border-t border-slate-800 bg-slate-900/50 p-4",children:s.jsxs("form",{onSubmit:o,className:"space-y-3",children:[s.jsxs("div",{className:"mb-2 flex items-center gap-2 text-sm text-gray-400",children:[s.jsx(he,{size:14}),s.jsx("span",{children:"Ask OmniAgent"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{id:"omni-agent-query",name:"omni-agent-query",type:"text",value:r,onChange:d=>n(d.target.value),placeholder:t?"Explain this page, research a topic, or compare URLs...":"Research a topic, compare URLs, or ask a question...",disabled:a,className:"flex-1 rounded-lg border border-slate-700 bg-slate-800 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/50 disabled:opacity-50"}),s.jsx("button",{type:"submit",disabled:!r.trim()||a,className:"flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 transition-colors hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-50",children:a?s.jsxs(s.Fragment,{children:[s.jsx(mr,{size:14,className:"animate-spin"}),s.jsx("span",{className:"text-xs",children:"Processing..."})]}):s.jsxs(s.Fragment,{children:[s.jsx(gr,{size:14}),s.jsx("span",{className:"text-xs",children:"Ask"})]})})]}),s.jsx("div",{className:"text-xs text-gray-500",children:'Examples: "Explain this page", "Research benefits of intermittent fasting", "Compare https://example.com and https://example.org"'})]})})}function Aa(t){const[e,r]=b.useState({connected:!1,events:[],streamedAnswer:"",sources:[],reasoningSteps:[],citations:[],done:!1,error:null}),n=b.useRef(null),a=b.useRef(null),i=b.useRef(0),o=5,d=b.useCallback(()=>{if(!t)return;const c=window.location.protocol==="https:"?"wss:":"ws:",l=window.location.host,u=`${c}//${l}/agent/stream?clientId=research-${Date.now()}&sessionId=research-session`;try{const h=new WebSocket(u);n.current=h,h.onopen=()=>{console.log("[useResearchWS] ✓ WebSocket connected"),r(w=>({...w,connected:!0,error:null})),i.current=0;const x={type:"subscribe",jobId:t};console.log("[useResearchWS] Sending subscribe message:",x),h.send(JSON.stringify(x))},h.onmessage=x=>{try{const w=JSON.parse(x.data);if(console.log("[useResearchWS] Received message:",{type:w.type,eventType:w.eventType,jobId:w.jobId,expectedJobId:t}),w.type==="subscribed"&&w.jobId===t){console.log("[useResearchWS] ✓ Subscribed to job",t);return}w.type==="research.event"&&w.jobId===t&&(console.log("[useResearchWS] Processing research event:",w.eventType),r(S=>{const m=[...S.events,w];let p={...S,events:m};switch(w.eventType){case"started":p={...p,streamedAnswer:"",done:!1};break;case"sources":w.data?.sources&&(p={...p,sources:w.data.sources});break;case"chunk":w.data?.token&&(p={...p,streamedAnswer:S.streamedAnswer+w.data.token});break;case"done":w.data&&(p={...p,streamedAnswer:w.data.answer||w.data.fullResponse||S.streamedAnswer,reasoningSteps:w.data.reasoningSteps||[],citations:w.data.citations||[],done:!0});break;case"reasoning":w.data?.steps&&(p={...p,reasoningSteps:w.data.steps});break;case"error":p={...p,error:w.data?.error||"Unknown error",done:!0};break}return p}))}catch(w){console.error("[useResearchWS] Failed to parse message",w)}},h.onclose=x=>{console.log("[useResearchWS] WebSocket closed",{code:x.code,reason:x.reason,wasClean:x.wasClean}),r(w=>({...w,connected:!1})),!e.done&&i.current<o&&(i.current++,a.current=setTimeout(()=>{console.log(`[useResearchWS] Reconnecting (attempt ${i.current})...`),d()},1e3*i.current))},h.onerror=x=>{console.error("[useResearchWS] ✗ WebSocket error",x),r(w=>({...w,error:"WebSocket connection error"}))}}catch(h){console.error("[useResearchWS] Failed to create WebSocket",h),r(x=>({...x,error:"Failed to connect"}))}},[t,e.done]);return b.useEffect(()=>{if(!t){console.log("[useResearchWS] No jobId provided, resetting state"),r({connected:!1,events:[],streamedAnswer:"",sources:[],reasoningSteps:[],citations:[],done:!1,error:null});return}return console.log("[useResearchWS] Connecting for jobId:",t),d(),()=>{if(console.log("[useResearchWS] Cleaning up connection for jobId:",t),a.current&&clearTimeout(a.current),n.current)try{n.current.close()}catch{}}},[t,d]),e}const Ra=(t,e)=>{const r=[],n=t.toLowerCase(),a=e.toLowerCase();return n.includes("compare")||n.includes("vs")?r.push("What are the key differences?","Which one is better?","What are the pros and cons?"):n.includes("what is")||n.includes("define")?r.push("How does it work?","What are the benefits?","What are the use cases?"):n.includes("how to")||n.includes("how do")?r.push("What are the prerequisites?","What are common mistakes?","What are best practices?"):n.includes("why")?r.push("What are the causes?","What are the effects?","Can you explain more?"):r.push("Tell me more","What are the key points?","Can you elaborate?"),(a.includes("benefit")||a.includes("advantage"))&&r.push("What are the disadvantages?","What are the alternatives?"),(a.includes("example")||a.includes("instance"))&&r.push("Give me more examples","Show me real-world applications"),r.slice(0,6)};function Ea(t){return t?t.replace(/\[(\d+)\]/g,(e,r)=>`<sup class="text-indigo-600 font-semibold cursor-pointer hover:text-indigo-800 transition-colors inline-block ml-0.5" title="Citation ${r}">[${r}]</sup>`).replace(/\[s(\d+)\]/gi,(e,r)=>`<sup class="text-indigo-600 font-semibold cursor-pointer hover:text-indigo-800 transition-colors inline-block ml-0.5" title="Source ${r}">[${r}]</sup>`).replace(/\n/g,"<br/>"):""}function Ta(){return s.jsxs("div",{className:"animate-pulse space-y-3",children:[s.jsx("div",{className:"h-4 w-full rounded bg-gray-200"}),s.jsx("div",{className:"h-4 w-5/6 rounded bg-gray-200"}),s.jsx("div",{className:"h-4 w-4/6 rounded bg-gray-200"}),s.jsx("div",{className:"mt-4 h-4 w-3/4 rounded bg-gray-200"}),s.jsx("div",{className:"h-4 w-full rounded bg-gray-200"})]})}function Ia(){const[t,e]=b.useState({jobId:null,query:"",answer:"",sources:[],reasoningSteps:[],citations:[],done:!1,error:null,selectedSource:null,showReasoning:!1,isStreaming:!1}),[r,n]=b.useState(6),[a,i]=b.useState(!1),[o,d]=b.useState([]),[c,l]=b.useState("web-search"),[u,h]=b.useState(!0),x=b.useRef(null),w=b.useRef(null),S=Ft(g=>g.mode),m=Ft(g=>g.setMode),p=Aa(t.jobId||null);b.useEffect(()=>{p.streamedAnswer&&(e(g=>({...g,answer:p.streamedAnswer,isStreaming:!p.done})),h(!1)),p.sources.length>0&&(e(g=>({...g,sources:p.sources.map((_,F)=>({id:_.url||`source-${F}`,url:_.url,title:_.title||"Untitled",snippet:_.snippet||"",score:_.score||.5,source:_.source||"unknown"}))})),setTimeout(()=>{w.current?.scrollIntoView({behavior:"smooth",block:"nearest"})},100)),p.reasoningSteps.length>0&&e(g=>({...g,reasoningSteps:p.reasoningSteps.map((_,F)=>({step:F+1,text:typeof _=="string"?_:_.text||"",evidence:typeof _=="object"&&"citations"in _?_.citations?.map(String):void 0}))})),p.citations.length>0&&e(g=>({...g,citations:p.citations.map(_=>({id:String(_.id||_.position||""),url:_.url,title:_.title||"Untitled"}))})),p.done&&(e(g=>({...g,done:!0,isStreaming:!1})),h(!1),t.query&&t.answer&&d(Ra(t.query,t.answer))),p.error&&(e(g=>({...g,error:p.error||null,isStreaming:!1})),h(!1))},[p,t.query,t.answer]),b.useEffect(()=>{x.current&&t.isStreaming&&(x.current.scrollTop=x.current.scrollHeight)},[t.answer,t.isStreaming]);const $=async g=>{if(g.trim()){e(_=>({..._,query:g.trim(),jobId:null,answer:"",sources:[],reasoningSteps:[],citations:[],done:!1,error:null,selectedSource:null,isStreaming:!0})),d([]),h(!0);try{const _=await hr.run({query:g.trim(),lang:"auto",clientId:`client-${Date.now()}`,sessionId:`session-${Date.now()}`,maxSources:r,mode:c==="web-search"||c==="reasoning"?"deep":"fast",options:{maxChunks:12,model:"llama3.1"}});if(_.jobId)e(F=>({...F,jobId:_.jobId}));else throw new Error("No jobId returned")}catch(_){console.error("[RegenResearch] Failed to start research:",_),e(F=>({...F,error:_.message||"Failed to start research",isStreaming:!1})),h(!1)}}},q=g=>{g.trim()&&$(g)},U=g=>{q(g)},G=g=>{e(_=>({..._,selectedSource:g}))};return s.jsxs("div",{className:"flex h-full flex-col bg-gradient-to-b from-[#eef2ff] to-[#dbe4ff]",children:[s.jsx("div",{className:"sticky top-0 z-10 border-b border-gray-200 bg-white px-6 py-4 shadow-sm",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("img",{src:"/logo.png",alt:"Regen",className:"h-8 w-8 object-contain",onError:g=>{g.target.style.display="none"}}),s.jsx("h1",{className:"text-[20px] font-semibold text-gray-800",children:"Regen Research"})]}),s.jsxs("div",{className:"flex items-center gap-1 rounded-lg border border-gray-200 bg-gray-100 p-1",children:[s.jsxs("button",{onClick:()=>m("Browse"),className:`flex items-center gap-1.5 rounded-md px-3 py-1.5 text-sm font-medium transition-all ${S==="Browse"?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-md shadow-indigo-500/30":"text-gray-600 hover:bg-gray-200 hover:text-gray-900"}`,title:"Switch to Browse Mode",children:[s.jsx(ws,{size:14}),s.jsx("span",{className:"hidden sm:inline",children:"Browse"})]}),s.jsxs("button",{onClick:()=>m("Research"),className:`flex items-center gap-1.5 rounded-md px-3 py-1.5 text-sm font-medium transition-all ${S==="Research"?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-md shadow-indigo-500/30":"text-gray-600 hover:bg-gray-200 hover:text-gray-900"}`,title:"Switch to Research Mode",children:[s.jsx(he,{size:14}),s.jsx("span",{className:"hidden sm:inline",children:"Research"})]}),s.jsxs("button",{onClick:()=>m("Trade"),className:`flex items-center gap-1.5 rounded-md px-3 py-1.5 text-sm font-medium transition-all ${S==="Trade"?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-md shadow-indigo-500/30":"text-gray-600 hover:bg-gray-200 hover:text-gray-900"}`,title:"Switch to Trade Mode",children:[s.jsx(vs,{size:14}),s.jsx("span",{className:"hidden sm:inline",children:"Trade"})]})]})]})}),s.jsxs("div",{className:"grid flex-1 grid-cols-1 gap-4 overflow-hidden p-4 lg:grid-cols-12",children:[s.jsxs("div",{className:"flex flex-col gap-4 lg:col-span-3",children:[s.jsxs("div",{className:"rounded-xl border border-gray-100 bg-white p-6 shadow-[0_4px_14px_rgba(0,0,0,0.08)]",children:[s.jsxs("form",{onSubmit:g=>{g.preventDefault();const F=new FormData(g.currentTarget).get("query")||"";$(F)},className:"flex flex-col gap-3",children:[s.jsx("input",{type:"text",name:"query",defaultValue:t.query,placeholder:"Ask anything…",className:"w-full rounded-lg border border-gray-300 bg-gray-50/80 px-4 py-3 text-[15px] placeholder-gray-500 transition-all focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",disabled:t.isStreaming}),s.jsxs("button",{type:"submit",disabled:t.isStreaming,className:"flex w-full items-center justify-center gap-2 rounded-lg bg-gradient-to-r from-indigo-500 to-purple-600 py-3 font-semibold text-white shadow-md transition-all hover:scale-[1.02] hover:shadow-lg disabled:cursor-not-allowed disabled:opacity-50 disabled:hover:scale-100",children:[s.jsx(he,{className:"h-4 w-4"}),t.isStreaming?"Researching...":"🔍 Research"]})]}),s.jsxs("div",{className:"mt-4 border-t border-gray-200 pt-4",children:[s.jsx("p",{className:"mb-2 text-xs font-medium text-gray-600",children:"Agent Mode:"}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs("button",{onClick:()=>l("web-search"),className:`rounded-md px-3 py-1.5 text-xs font-medium transition ${c==="web-search"?"border border-indigo-300 bg-indigo-100 text-indigo-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[s.jsx(fr,{className:"mr-1 inline h-3 w-3"}),"Web Search"]}),s.jsxs("button",{onClick:()=>l("reasoning"),className:`rounded-md px-3 py-1.5 text-xs font-medium transition ${c==="reasoning"?"border border-indigo-300 bg-indigo-100 text-indigo-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[s.jsx(it,{className:"mr-1 inline h-3 w-3"}),"Reasoning"]}),s.jsxs("button",{onClick:()=>l("summarizer"),className:`rounded-md px-3 py-1.5 text-xs font-medium transition ${c==="summarizer"?"border border-indigo-300 bg-indigo-100 text-indigo-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[s.jsx(js,{className:"mr-1 inline h-3 w-3"}),"Summarizer"]})]})]}),t.jobId&&s.jsx("div",{className:"mt-4 border-t border-gray-200 pt-4",children:s.jsxs("form",{onSubmit:g=>{g.preventDefault();const F=new FormData(g.currentTarget).get("followUp")||"";F.trim()&&q(F)},className:"flex gap-2",children:[s.jsx("input",{type:"text",name:"followUp",placeholder:"Refine: Why is BankNifty more volatile?",className:"flex-1 rounded-lg border border-gray-300 bg-gray-50/80 px-3 py-2 text-[14px] placeholder-gray-500 transition focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500",disabled:t.isStreaming}),s.jsx("button",{type:"submit",disabled:t.isStreaming,className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700 disabled:opacity-50",children:"Ask"})]})}),s.jsxs("div",{className:"mt-4 border-t border-gray-200 pt-4",children:[s.jsx("h5",{className:"mb-2 text-sm font-semibold text-gray-800",children:"Agent Settings"}),s.jsx("div",{className:"mb-2 text-xs text-gray-600",children:"Max sources to fetch"}),s.jsx("input",{type:"range",min:1,max:12,value:r,onChange:g=>n(Number(g.target.value)),className:"w-full",disabled:t.isStreaming}),s.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:[r," sources"]})]})]}),t.jobId&&s.jsx("div",{className:"rounded-xl border border-gray-100 bg-white p-4 shadow-[0_4px_14px_rgba(0,0,0,0.08)]",children:s.jsxs("div",{className:"text-xs text-gray-500",children:[s.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[s.jsx("div",{className:`h-2 w-2 rounded-full ${p.connected?"animate-pulse bg-green-500":"bg-gray-400"}`}),p.connected?"Connected":"Connecting..."]}),t.isStreaming&&s.jsx("div",{className:"font-medium text-indigo-600",children:"Streaming answer..."}),t.done&&s.jsx("div",{className:"font-medium text-green-600",children:"Research complete"}),t.error&&s.jsxs("div",{className:"font-medium text-red-600",children:["Error: ",t.error]})]})})]}),s.jsx("div",{className:"flex flex-col lg:col-span-6",children:s.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden rounded-xl border border-gray-100 bg-white p-6 shadow-[0_4px_14px_rgba(0,0,0,0.08)]",children:[s.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[s.jsx("h2",{className:"text-[20px] font-semibold text-gray-800",children:"Answer"}),t.reasoningSteps.length>0&&s.jsxs("button",{onClick:()=>e(g=>({...g,showReasoning:!g.showReasoning})),className:"flex items-center gap-2 rounded-lg bg-gray-100 px-3 py-1.5 text-sm text-gray-700 transition hover:bg-gray-200",children:[s.jsx(it,{className:"h-4 w-4"}),t.showReasoning?"Hide":"Show"," Reasoning"]})]}),t.isStreaming&&s.jsxs("div",{className:"mb-4 flex items-center gap-2 text-sm text-gray-500",children:[s.jsx("div",{className:"h-2 w-2 animate-pulse rounded-full bg-green-500"}),s.jsx("span",{children:"Generating answer…"})]}),s.jsx("div",{ref:x,className:"flex-1 overflow-y-auto text-[15px] leading-relaxed text-gray-900",children:u&&!t.answer?s.jsx(Ta,{}):t.answer?s.jsx("div",{className:"animate-fadeIn whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:Ea(t.answer)}}):s.jsx("div",{className:"italic text-gray-400",children:"Waiting for answer..."})}),t.done&&o.length>0&&s.jsxs("div",{className:"animate-fadeIn mt-6 border-t border-gray-200 pt-6",children:[s.jsx("p",{className:"mb-3 text-sm font-semibold text-gray-700",children:"Follow-up questions"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:o.map((g,_)=>s.jsx("button",{onClick:()=>U(g),className:"rounded-full bg-gray-100 px-3 py-1.5 text-sm text-gray-700 transition hover:scale-105 hover:bg-gray-200",children:g},_))})]}),t.showReasoning&&t.reasoningSteps.length>0&&s.jsxs("div",{className:"animate-fadeIn mt-6 border-t border-gray-200 pt-6",children:[s.jsxs("h3",{className:"mb-3 flex items-center gap-2 text-sm font-semibold text-gray-800",children:[s.jsx(it,{className:"h-4 w-4"}),"Reasoning Chain"]}),s.jsx("div",{className:"space-y-3",children:t.reasoningSteps.map((g,_)=>s.jsxs("div",{className:"animate-fadeIn rounded-lg bg-gray-50 p-3 text-sm",style:{animationDelay:`${_*.1}s`},children:[s.jsxs("div",{className:"mb-1 font-medium text-gray-700",children:["Step ",g.step,": ",g.text]}),g.evidence&&g.evidence.length>0&&s.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Evidence: ",g.evidence.join(", ")]})]},_))})]}),t.citations.length>0&&s.jsxs("div",{className:"animate-fadeIn mt-6 border-t border-gray-200 pt-6",children:[s.jsx("h3",{className:"mb-3 text-sm font-semibold text-gray-800",children:"Citations"}),s.jsx("div",{className:"space-y-2",children:t.citations.map((g,_)=>s.jsxs("div",{className:"text-xs text-gray-600",children:["[",g.id,"] ",g.title," -"," ",s.jsx("a",{href:g.url,target:"_blank",rel:"noopener noreferrer",className:"text-indigo-600 hover:underline",children:g.url})]},_))})]})]})}),s.jsxs("div",{className:"flex flex-col gap-4 lg:col-span-3",children:[s.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden rounded-xl border border-gray-100 bg-white p-4 shadow-[0_4px_14px_rgba(0,0,0,0.08)]",children:[s.jsx("h4",{className:"mb-3 text-sm font-semibold text-gray-800",children:"Sources"}),s.jsx("div",{className:"flex-1 space-y-2 overflow-y-auto",children:t.sources.length===0?s.jsx("div",{className:"py-8 text-center text-xs text-gray-400",children:t.isStreaming?s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"mx-auto h-3 w-3/4 animate-pulse rounded bg-gray-200"}),s.jsx("div",{className:"mx-auto h-3 w-1/2 animate-pulse rounded bg-gray-200"}),s.jsx("p",{className:"mt-4",children:"Fetching sources..."})]}):"No sources yet"}):s.jsxs(s.Fragment,{children:[t.sources.map((g,_)=>s.jsxs("div",{onClick:()=>G(g),className:`animate-fadeIn group cursor-pointer rounded-lg border p-3 transition ${t.selectedSource?.url===g.url?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:bg-gray-50"}`,style:{animationDelay:`${_*.05}s`},children:[s.jsx("p",{className:"line-clamp-2 text-sm font-medium text-gray-800 transition-colors group-hover:text-indigo-600",children:g.title||"Untitled"}),s.jsx("p",{className:"mt-1 truncate text-xs text-gray-500",children:new URL(g.url).hostname}),g.snippet&&s.jsx("p",{className:"mt-2 line-clamp-2 text-xs text-gray-600",children:g.snippet}),g.score&&s.jsxs("p",{className:"mt-1 text-xs text-gray-400",children:["Score: ",g.score.toFixed(2)]})]},g.id||_)),s.jsx("div",{ref:w})]})})]}),s.jsxs("div",{className:"rounded-xl border border-gray-100 bg-white p-4 shadow-[0_4px_14px_rgba(0,0,0,0.08)]",children:[s.jsx("h4",{className:"mb-3 text-sm font-semibold text-gray-800",children:"Source Preview"}),t.selectedSource?s.jsxs("div",{className:"animate-fadeIn whitespace-pre-wrap text-sm font-[450] leading-relaxed text-gray-700",children:[s.jsx("div",{className:"mb-1 font-medium text-gray-800",children:t.selectedSource.title}),s.jsxs("a",{href:t.selectedSource.url,target:"_blank",rel:"noopener noreferrer",className:"mb-2 flex items-center gap-1 text-xs text-indigo-600 hover:underline",children:[t.selectedSource.url,s.jsx(Xe,{className:"h-3 w-3"})]}),s.jsx("div",{className:"mt-2 text-xs text-gray-600",children:t.selectedSource.snippet})]}):s.jsx("div",{className:"text-xs text-gray-400",children:"Click a source to preview."})]})]})]}),s.jsx("div",{className:"border-t border-gray-200 bg-white/80 px-6 py-3 backdrop-blur-sm",children:s.jsx("div",{className:"text-xs text-gray-500",children:'💡 Tip: Streamed answers update as sources & LLM tokens arrive. Use "Show reasoning" to reveal chain-of-thought for transparency.'})})]})}var La=Object.defineProperty,Ma=(t,e,r)=>e in t?La(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Da=(t,e,r)=>Ma(t,e+"",r);const pt={hi:{code:"hi",name:"Hindi",nativeName:"हिंदी",locale:"hi-IN",script:"Devanagari"},ta:{code:"ta",name:"Tamil",nativeName:"தமிழ்",locale:"ta-IN",script:"Tamil"},te:{code:"te",name:"Telugu",nativeName:"తెలుగు",locale:"te-IN",script:"Telugu"},ml:{code:"ml",name:"Malayalam",nativeName:"മലയാളം",locale:"ml-IN",script:"Malayalam"},kn:{code:"kn",name:"Kannada",nativeName:"ಕನ್ನಡ",locale:"kn-IN",script:"Kannada"},bn:{code:"bn",name:"Bengali",nativeName:"বাংলা",locale:"bn-IN",script:"Bengali"},mr:{code:"mr",name:"Marathi",nativeName:"मराठी",locale:"mr-IN",script:"Devanagari"},gu:{code:"gu",name:"Gujarati",nativeName:"ગુજરાતી",locale:"gu-IN",script:"Gujarati"},en:{code:"en",name:"English",nativeName:"English",locale:"en-US",script:"Latin"},auto:{code:"auto",name:"Auto-detect",nativeName:"Auto",locale:"en-US",script:"Auto"}};class Pa{constructor(){Da(this,"cache",new Map)}async detectLanguage(e){const r=`detect:${e.slice(0,100)}`,n=this.cache.get(r);if(n)return n;if(typeof window<"u"&&window.__TAURI__)try{const i=(await window.__TAURI__.invoke("detect_language",{text:e})).language||"en";return this.cache.set(r,i),i}catch(a){console.error("[MultiLanguageAI] Detection failed:",a)}return this.heuristicDetect(e)}heuristicDetect(e){return/[\u0900-\u097F]/.test(e)?"hi":/[\u0B80-\u0BFF]/.test(e)?"ta":/[\u0C00-\u0C7F]/.test(e)?"te":/[\u0D00-\u0D7F]/.test(e)?"ml":/[\u0C80-\u0CFF]/.test(e)?"kn":/[\u0980-\u09FF]/.test(e)?"bn":/[\u0A80-\u0AFF]/.test(e)?"gu":"en"}async translate(e,r,n){if((!n||n==="auto")&&(n=await this.detectLanguage(e)),n===r)return e;const a=`translate:${n}:${r}:${e.slice(0,100)}`,i=this.cache.get(a);if(i)return i;if(typeof window<"u"&&window.__TAURI__)try{const d=(await window.__TAURI__.invoke("translate_text",{text:e,sourceLang:n,targetLang:r})).translated||e;return this.cache.set(a,d),d}catch(o){console.error("[MultiLanguageAI] Translation failed:",o)}return e}async search(e,r=["en"],n){const a=[],i=await this.detectLanguage(e);for(const o of r){let d=e;o!==i&&o!=="auto"&&(d=await this.translate(e,o,i));try{const c=await this.performSearch(d,o);a.push({language:o,results:c.slice(0,n?.limit||10)})}catch(c){console.error(`[MultiLanguageAI] Search failed for ${o}:`,c)}}return a}async summarize(e,r="en",n){const a=await this.detectLanguage(e);let i=e;if(e.length>(n?.maxLength||500))if(typeof window<"u"&&window.__TAURI__)try{i=(await window.__TAURI__.invoke("summarize_text",{text:e,language:a,maxLength:n?.maxLength||500})).summary||e}catch(o){console.error("[MultiLanguageAI] Summarization failed:",o),i=e.slice(0,n?.maxLength||500)+"..."}else i=e.slice(0,n?.maxLength||500)+"...";return a!==r&&r!=="auto"&&(i=await this.translate(i,r,a)),i}async performSearch(e,r){return[]}getLanguageMetadata(e){return pt[e]||pt.en}getSupportedLanguages(){return Object.keys(pt)}clearCache(){this.cache.clear()}}const cr=new Pa;function Ua(){const[t,e]=b.useState(""),[r,n]=b.useState(null),[a,i]=b.useState(null),[o,d]=b.useState(!1),[c,l]=b.useState(null),[u,h]=b.useState("en"),x=Ce(f=>f.language||"auto"),[w,S]=b.useState(null),[m,p]=b.useState(!1),[$,q]=b.useState(50),[U,G]=b.useState("global"),[g,_]=b.useState(null),[F,L]=b.useState(!0),[X,Y]=b.useState(null),[W,O]=b.useState([]),[Te,te]=b.useState(!1),[Ue,ae]=b.useState(!1),[le,_t]=b.useState([]),[$t,Ct]=b.useState(!1),At=b.useRef(null),et=b.useRef(null),{activeId:pe,tabs:we}=ur(),Or=Ce(f=>f.searchEngine!=="mock"),{containers:tt,activeContainerId:qr,setContainers:Rt}=ns(),Et=b.useRef(""),Tt=Fs(t,300),{entries:Fe,addEntry:It,removeEntry:Lt}=ca(),[zr,rt]=b.useState(!1),[Br,Oe]=b.useState([]),[Mt,Dt]=b.useState(!1),se=b.useRef({}),[Ie,Wr]=b.useState(!1),[Gr,Pt]=b.useState(!1),[Hr,st]=b.useState([]),[Kr,nt]=b.useState(null),[qe,Vr]=b.useState(!0);b.useEffect(()=>{tt.length===0&&Z.containers.list().then(f=>{Array.isArray(f)&&Rt(f)}).catch(f=>{console.warn("[Research] Failed to load containers for badge",f)})},[tt.length,Rt]),b.useEffect(()=>{const f=v=>{const{query:T}=v.detail;T&&(e(T),H.success(`Researching: ${T}`,{duration:3e3}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("research:trigger",{detail:{query:T}}))},500))};return window.addEventListener("wispr:research",f),()=>window.removeEventListener("wispr:research",f)},[]),b.useEffect(()=>{const f=v=>{const{query:T,symbol:E,language:D}=v.detail;if(T)e(T),setTimeout(()=>{ie(T)},500),H.success(`Researching: ${T}`,{duration:3e3});else if(E){const R=`${E} fundamentals and recent news`;e(R),setTimeout(()=>{ie(R)},500),H.success(`Researching ${E}...`,{duration:3e3})}};return window.addEventListener("handoff:research",f),()=>{window.removeEventListener("handoff:research",f)}},[]),b.useEffect(()=>{Oe(f=>f.filter(v=>Fe.some(T=>T.id===v)))},[Fe]),b.useEffect(()=>{Ie||(st([]),nt(null))},[Ie]);const ke=b.useMemo(()=>(100-$)/100,[$]),_e=b.useMemo(()=>$/100,[$]),ge=b.useCallback(async()=>{if(!(typeof window>"u"||!window.graph?.all))try{const f=await window.graph.all();f&&Array.isArray(f.nodes)&&_(f)}catch(f){console.warn("[Research] Failed to load graph snapshot",f)}},[]);b.useCallback(async({searchQuery:f,context:v,aggregatedSources:T,aggregatedProviderNames:E,scrapedSnapshots:D=[]})=>{try{let R="",z=null;const J=await Ot.runTask({kind:"search",prompt:f,context:v,mode:"research",metadata:{includeCounterpoints:m,region:U!=="global"?U:void 0,recencyWeight:ke,authorityWeight:_e,language:x!=="auto"?x:void 0},llm:{temperature:.2,maxTokens:1e3}},y=>{y.type==="token"&&typeof y.data=="string"?R+=y.data:y.type==="done"&&typeof y.data!="string"&&(z=y.data)}),C=z??J;se.current={provider:C?.provider||"ai",model:C?.model};let A=R||C?.text||"";if(!A&&typeof navigator<"u"&&!navigator.onLine)try{const y=[];if(D.length>0&&D.forEach(k=>{k.excerpt&&y.push(k.excerpt),k.text&&y.push(k.text)}),T.length>0&&T.forEach(k=>{k.snippet&&y.push(k.snippet),k.title&&y.push(k.title)}),y.length>0){const k=await Vn(y.join(" "),{maxLength:500,minLength:100,language:x!=="auto"?x:"en",useOfflineModel:!0});k.summary&&(A=k.summary,se.current={provider:"offline-mbart",model:k.method==="mbart"?"mBART":"extraction"})}}catch(y){console.warn("[Research] Offline summarization failed:",y)}if(A&&typeof window<"u"&&window.graph)try{const y=A.split(/[.,;]/).slice(0,5);for(const k of y){const P=k.trim();P.length>3&&P.length<50&&await window.graph.add({id:`research-${Date.now()}-${Math.random()}`,label:P,type:"research-concept"})}await ge()}catch(y){console.debug("[Research] Auto-graph generation failed:",y)}const B=[...T];C?.citations&&C.citations.length>0&&B.push(...C.citations.map((y,k)=>{let P=y.source||"";try{y.url&&(P=new URL(y.url).hostname)}catch{P=y.source||""}const Q=ue(P);return{id:`ai-citation-${k}`,title:y.title||y.url||`Source ${k+1}`,url:y.url||"",domain:P,snippet:y.snippet||"",text:y.snippet||"",type:Q,sourceType:Q,relevanceScore:95-k*3,timestamp:Date.now(),metadata:{provider:"ai-citation"}}})),le.length>0&&B.push(...le.map((y,k)=>({id:y.id,title:y.name,url:"",domain:"uploaded",snippet:y.text.slice(0,200)+(y.text.length>200?"...":""),text:y.text,type:"documentation",sourceType:"documentation",relevanceScore:98-k,timestamp:Date.now(),metadata:{provider:"uploaded-doc"}})));try{const y=await xe(f);B.push(...y.map((k,P)=>({id:`local-${k.id}`,title:k.title,url:"",domain:"local",snippet:k.snippet,text:k.snippet,type:"documentation",sourceType:"documentation",relevanceScore:85-P*3,timestamp:Date.now(),metadata:{provider:"local-index"}})))}catch(y){console.debug("[Research] Local search failed:",y)}const N=C?.citations?.map((y,k)=>({id:`citation-${k}`,text:y.title||y.url||`Source ${k+1}`,url:y.url||"",position:A.indexOf(y.title||"")>=0?A.indexOf(y.title||""):k*50}))||[],j=fe(B);n({query:f,summary:A||"No answer generated",sources:j.slice(0,16),citations:N,inlineEvidence:[],contradictions:[],verification:{score:.8,confidence:"high",suggestions:[`AI-generated response using ${C?.provider||"unknown"} (${C?.model||"unknown"})`,...C?.citations?.length?[`${C.citations.length} citation(s) included`]:[]]},confidence:Math.min(.95,Math.max(.45,C?.confidence??.82))});return}catch(R){if(console.warn("[Research] AI engine failed, falling back to legacy search:",R),T.length>0){const C=E.length>0?E.map(j=>vt(j)).join(", "):"multi-source web";se.current={provider:C,model:"aggregate"};const A=fe(T),B=A.slice(0,3).map(j=>j.title).join("; "),N=D.find(j=>j.excerpt)?.excerpt;n({query:f,summary:N?.length?N:B.length>0?`Multi-source (${C}) search returned ${A.length} results. Top hits: ${B}.`:`Multi-source (${C}) search returned ${A.length} results.`,sources:A.slice(0,16),citations:[],inlineEvidence:[],contradictions:[],verification:{score:.65,confidence:"medium",suggestions:[`Review ${C} sources manually.`]},confidence:.62});return}const z=await me(f);if(z){se.current={provider:"duckduckgo",model:"instant-answer"};const C=Ne(z),A=await xe(f).catch(()=>[]),B=[...z.Heading&&z.AbstractText?[{id:"duck-instant",title:z.Heading,url:z.AbstractURL||"",domain:z.AbstractURL?Ae(z.AbstractURL):"duckduckgo.com",snippet:z.AbstractText,text:z.AbstractText,type:"news",sourceType:"news",relevanceScore:100,timestamp:Date.now(),metadata:{provider:"duckduckgo"}}]:[],...C.filter(N=>N.type==="result"&&N.url).map((N,j)=>{const y=N.url?Ae(N.url):"",k=ue(y);return{id:`duck-result-${j}`,title:N.title,url:N.url||"",domain:y,snippet:N.snippet,text:N.snippet,type:k,sourceType:k,relevanceScore:85-j*5,timestamp:Date.now(),metadata:{provider:"duckduckgo"}}}),...A.map((N,j)=>({id:`local-${N.id}`,title:N.title,url:"",domain:"local",snippet:N.snippet,text:N.snippet,type:"documentation",sourceType:"documentation",relevanceScore:90-j*3,timestamp:Date.now(),metadata:{provider:"local-index"}}))];n({query:f,summary:z.AbstractText||z.Answer||z.Definition||`Found ${B.length} result${B.length===1?"":"s"} for "${f}"`,sources:fe(B).slice(0,16),citations:[],inlineEvidence:[],contradictions:[],verification:{score:.7,confidence:"medium",suggestions:["Results from DuckDuckGo Instant Answer API"]},confidence:.58});return}const J=await xe(f).catch(()=>[]);if(J.length>0){se.current={provider:"local-index",model:"documents"},n({query:f,summary:`Found ${J.length} local result${J.length===1?"":"s"}`,sources:J.map((C,A)=>({id:`local-${C.id}`,title:C.title,url:"",domain:"local",snippet:C.snippet,text:C.snippet,type:"documentation",sourceType:"documentation",relevanceScore:90-A*3,timestamp:Date.now(),metadata:{provider:"local-index"}})),citations:[],inlineEvidence:[],contradictions:[],verification:{score:.6,confidence:"low",suggestions:["Results from local index only"]},confidence:.52});return}throw R}},[_e,m,U,ke,ge,le]);const Qr=b.useCallback(f=>{Oe(v=>v.includes(f)?v.filter(T=>T!==f):v.length>=2?[...v.slice(1),f]:[...v,f])},[]),Jr=b.useCallback(f=>{Lt(f),Oe(v=>v.filter(T=>T!==f)),H.info("Removed saved answer.")},[Lt]),Xr=b.useCallback(()=>{if(!r){H.info("Run a research query before saving.");return}const f=It({query:r.query,summary:r.summary,provider:se.current.provider,model:se.current.model,confidence:r.confidence,sources:r.sources,citations:r.citations,settings:{includeCounterpoints:m,authorityBias:$,region:U}});Oe([f.id]),rt(!0),H.success("Answer saved to compare drawer.")},[r,It,m,$,U]),Yr=b.useCallback(async f=>{Pt(!0),nt(null),st([]);try{const v=await la(f,{maxPages:5});return st(v.steps),v}catch(v){const T=v instanceof Error?v.message:"Deep scan failed.";throw nt(T),H.error(T),v}finally{Pt(!1)}},[]),Zr=b.useCallback(async f=>{const v={mode:"research",includeCounterpoints:m,region:U!=="global"?U:void 0,recencyWeight:ke,authorityWeight:_e},T=we.find(E=>E.id===pe);T&&(v.active_tab={url:T.url,title:T.title}),le.length>0&&(v.documents=le.map(E=>({name:E.name,text:E.text.slice(0,5e3),type:E.type,size:E.size})));try{const D=(await _s(f,{limit:5,minSimilarity:.6})).map(R=>({value:R.event.value,metadata:R.event.metadata,id:R.event.id,type:R.event.type,similarity:R.similarity}));D.length>0&&(v.memories=D)}catch(E){console.warn("[Research] Failed to fetch memory context:",E)}return v},[pe,we,m,U,ke,_e,le]),es=b.useMemo(()=>r?.query?lr(r.query):null,[r?.query]),ts=async f=>{if(!f||f.length===0)return;Ct(!0);const v=[];for(const T of Array.from(f))try{const E=T.type.toLowerCase(),D=T.name.toLowerCase();let R="";if(E==="application/pdf"||D.endsWith(".pdf"))R=await $s(T);else if(E==="application/vnd.openxmlformats-officedocument.wordprocessingml.document"||D.endsWith(".docx"))R=await Cs(T);else if(E==="text/plain"||E==="text/markdown"||D.endsWith(".txt")||D.endsWith(".md"))R=await T.text();else{console.warn(`[Research] Unsupported file type: ${E} (${T.name})`);continue}R.trim().length>0&&v.push({id:`doc-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,file:T,name:T.name,text:R.trim(),type:E||"unknown",size:T.size})}catch(E){console.error(`[Research] Failed to parse file ${T.name}:`,E)}_t(T=>[...T,...v]),Ct(!1)},rs=f=>{_t(v=>v.filter(T=>T.id!==f))},ie=async f=>{const v=typeof f=="string"?f:t;if(!v.trim())return;oe(async()=>{const{telemetryMetrics:C}=await import("../assets/index-D9cF9G1U.js").then(A=>A.t);return{telemetryMetrics:C}},__vite__mapDeps([8,0,1,2,3,4,5,6,9,10,11,12,13,14])).then(({telemetryMetrics:C})=>{C.trackFeature("search_executed",{mode:"research"})}).catch(()=>{});const T=performance.now();if(x==="auto"&&v.trim().length>2)try{const C=await cr.detectLanguage(v);h(C),C!=="en"&&(Ce.getState().setLanguage(C),console.log("[Research] Auto-detected language:",C))}catch{try{const C=await bt(v,{preferIndic:!0,useBackend:!0});if(C.confidence>.7){const A=C.language;(A!=="en"||C.isIndic)&&(Ce.getState().setLanguage(A),h(A))}}catch(C){console.warn("[Research] Language auto-detection failed:",C)}}const E=x!=="auto"?x:u;if(E&&E!=="en")try{const C=await cr.translate(v,"en",E);console.log("[Research] Original query:",v,"English:",C)}catch(C){console.warn("[Research] Query translation failed:",C)}d(!0),l("Researching..."),H.loading("Researching...",{duration:0}),i(null),n(null),S(null);const D=xt();if(D&&D.status==="offline"){i("Search system is offline. Please check your connection."),d(!1),H.error("Search system offline");return}let R=[],z=[],J=[];try{if(!Or){se.current={provider:"mock",model:"offline"},n(si(v));return}const C=await Zr(v);if(Ie){const A=await Yr(v);R=A.sources.map((B,N)=>Xa(B,N)),z=["deep-scan"],C.deep_scan={created_at:A.created_at,steps:A.steps}}else{let A=null;const B=typeof window<"u"&&!!window.__TAURI__;if(B&&Z)try{const N=await Z.invoke("research_api",{query:v});N&&(A={summary:N.summary||N.answer||"",sources:(N.sources||[]).map((j,y)=>({title:j.Text||j.title||`Source ${y+1}`,url:j.FirstURL||j.url||"",snippet:j.Text||j.snippet||"",sourceType:"web"})),citations:N.citations||0,hallucination:N.hallucination||"medium"},console.log("[Research] Tauri IPC returned result:",A))}catch(N){console.warn("[Research] Tauri IPC failed, trying HTTP API:",N)}if(!A)if(as())A=null;else try{A=await hr.queryEnhanced({query:v,maxSources:12,includeCounterpoints:m,recencyWeight:ke,authorityWeight:_e,language:x!=="auto"?x:void 0})}catch{}if(A&&(A.sources&&A.sources.length>0&&(R=A.sources.map((N,j)=>({id:`backend-${j}`,title:N.title||"Untitled",url:N.url||"",domain:N.domain||new URL(N.url||"http://example.com").hostname,snippet:N.snippet||"",text:N.snippet||"",type:N.sourceType||"other",sourceType:N.sourceType||"other",relevanceScore:Math.round((N.relevanceScore||.5)*100),timestamp:N.timestamp||Date.now(),metadata:{provider:"backend-api"}})),z=["backend-api"]),A.summary&&(C.backend_summary=A.summary),(A.citations!==void 0||A.hallucination)&&(C.backend_metrics={citations:A.citations||0,hallucination:A.hallucination||"medium"}),console.log(`[Research] Backend API returned ${R.length} results with summary and metrics`)),R.length===0)try{const j=(await Xt(v,{count:20,language:x,timeout:1e4})).map(y=>({title:y.title,url:y.url,snippet:y.snippet,source:y.provider,score:y.score,domain:y.domain}));if(j.length>0){R=j.map((k,P)=>Ja(k,P)),z=Array.from(new Set(j.map(k=>typeof k.source=="string"?k.source.toLowerCase():"web"))),C.multi_source_results=j.slice(0,8).map(k=>({title:k.title,url:k.url,snippet:k.snippet.slice(0,300),provider:k.source,score:k.score}));const y=R.filter(k=>!!k.url).slice(0,4).map(k=>k.url);y.length>0&&(J=await Wn(y,{max_chars:12e3,allow_render:!0}),J.length>0&&(R=Ya(R,J),C.scraped_sources=J.slice(0,3).map(k=>({url:k.finalUrl??k.url,title:k.title,excerpt:k.excerpt?.slice(0,400),word_count:k.wordCount,rendered:k.rendered}))))}}catch(N){console.warn("[Research] Multi-source search failed:",N)}if(R.length===0)try{const N=await Nt(v,{count:15,language:x!=="auto"?x:void 0});N.length>0&&(R=N.map((j,y)=>({id:`live-${j.provider}-${y}`,title:j.title,url:j.url,domain:j.domain,snippet:j.snippet,text:j.snippet,type:ue(j.domain),sourceType:ue(j.domain),relevanceScore:Math.round(j.score*100),timestamp:Date.now(),metadata:{provider:j.provider}})),z=Array.from(new Set(N.map(j=>j.provider))),console.log(`[Research] Live web search returned ${N.length} results from ${z.join(", ")}`))}catch(N){console.warn("[Research] Live web search failed:",N)}if(A&&(A.summary||A.answer)&&R.length>0){const N=fe(R),j=A.citations||R.length||0,y=A.hallucination||"medium",k=y==="low"?.2:y==="medium"?.5:.8,P=Math.min(j/Math.max(R.length,1)*100,100),Q=performance.now()-T;oe(async()=>{const{telemetryMetrics:I}=await import("../assets/index-D9cF9G1U.js").then(K=>K.t);return{telemetryMetrics:I}},__vite__mapDeps([8,0,1,2,3,4,5,6,9,10,11,12,13,14])).then(({telemetryMetrics:I})=>{I.trackPerformance("search_latency",Q,"ms",{provider:"backend",resultCount:N.length})}).catch(()=>{}),n({query:v,summary:A.summary||A.answer||"",sources:N.slice(0,16),citations:A.citations||[],inlineEvidence:[],contradictions:A.contradictions||[],verification:{verified:y==="low",claimDensity:R.length,citationCoverage:P,ungroundedClaims:[],hallucinationRisk:k,suggestions:y==="high"?["Consider verifying with additional sources"]:[]},confidence:A.confidence||(y==="low"?.8:.6),language:A.language||x,languageLabel:A.languageLabel||He(x).nativeName,languageConfidence:A.languageConfidence||.9}),d(!1),l(null),H.dismiss();return}if(B&&Z&&R.length===0)try{let N="",j=0,y="medium";const k=I=>{typeof I.detail=="string"&&(N+=I.detail,n(K=>({...K,query:v,summary:N,sources:K?.sources||[],citations:K?.citations||[],inlineEvidence:[],contradictions:[],verification:{verified:y==="low",claimDensity:R.length,citationCoverage:j>0?Math.min(j/Math.max(R.length,1)*100,100):0,ungroundedClaims:[],hallucinationRisk:y==="low"?.2:y==="medium"?.5:.8,suggestions:y==="high"?["Consider verifying with additional sources"]:[]},confidence:y==="low"?.8:.6,language:x,languageLabel:He(x).nativeName,languageConfidence:.9})))},P=I=>{I.detail&&(j=I.detail.citations||0,y=I.detail.hallucination||"medium")},Q=I=>{I.detail&&(N=I.detail.response||N,j=I.detail.citations||j,y=I.detail.hallucination||y),window.removeEventListener("research-token",k),window.removeEventListener("research-metrics",P),window.removeEventListener("research-end",Q),d(!1),l(null),H.dismiss()};window.addEventListener("research-token",k),window.addEventListener("research-metrics",P),window.addEventListener("research-end",Q),await Z.invoke("research_stream",{query:v}),n({query:v,summary:"",sources:[],citations:[],inlineEvidence:[],contradictions:[],verification:{verified:!1,claimDensity:0,citationCoverage:0,ungroundedClaims:[],hallucinationRisk:.5,suggestions:[]},confidence:.5,language:x,languageLabel:He(x).nativeName,languageConfidence:.9});return}catch(N){console.warn("[Research] Tauri streaming failed:",N)}}try{let A="",B=null;const N=await Ot.runTask({kind:"search",prompt:v,context:C,mode:"research",metadata:{includeCounterpoints:m,region:U!=="global"?U:void 0,recencyWeight:ke,authorityWeight:_e,language:x!=="auto"?x:void 0},llm:{temperature:.2,maxTokens:1e3}},I=>{I.type==="token"&&typeof I.data=="string"?A+=I.data:I.type==="done"&&typeof I.data!="string"&&(B=I.data)}),j=B??N;se.current={provider:j?.provider||"ai",model:j?.model};const y=A||j?.text||"";if(y&&typeof window<"u"&&window.graph)try{const I=y.split(/[.,;]/).slice(0,5);for(const K of I){const de=K.trim();de.length>3&&de.length<50&&await window.graph.add({id:`research-${Date.now()}-${Math.random()}`,label:de,type:"research-concept"})}await ge()}catch(I){console.debug("[Research] Auto-graph generation failed:",I)}const k=[...R];j?.citations&&j.citations.length>0&&k.push(...j.citations.map((I,K)=>{let de=I.source||"";try{I.url&&(de=new URL(I.url).hostname)}catch{de=I.source||""}const Ut=ue(de);return{id:`ai-citation-${K}`,title:I.title||I.url||`Source ${K+1}`,url:I.url||"",domain:de,snippet:I.snippet||"",text:I.snippet||"",type:Ut,sourceType:Ut,relevanceScore:95-K*3,timestamp:Date.now(),metadata:{provider:"ai-citation"}}})),le.length>0&&k.push(...le.map((I,K)=>({id:I.id,title:I.name,url:"",domain:"uploaded",snippet:I.text.slice(0,200)+(I.text.length>200?"...":""),text:I.text,type:"documentation",sourceType:"documentation",relevanceScore:98-K,timestamp:Date.now(),metadata:{provider:"uploaded-doc"}})));try{const I=await xe(v);k.push(...I.map((K,de)=>({id:`local-${K.id}`,title:K.title,url:"",domain:"local",snippet:K.snippet,text:K.snippet,type:"documentation",sourceType:"documentation",relevanceScore:85-de*3,timestamp:Date.now(),metadata:{provider:"local-index"}})))}catch(I){console.debug("[Research] Local search failed:",I)}const P=j?.citations?.map((I,K)=>({id:`citation-${K}`,text:I.title||I.url||`Source ${K+1}`,url:I.url||"",position:y.indexOf(I.title||"")>=0?y.indexOf(I.title||""):K*50}))||[],Q=fe(k);n({query:v,summary:y||"No answer generated",sources:Q.slice(0,16),citations:P,inlineEvidence:[],contradictions:[],verification:{score:.8,confidence:"high",suggestions:[`AI-generated response using ${j?.provider||"unknown"} (${j?.model||"unknown"})`,...j?.citations?.length?[`${j.citations.length} citation(s) included`]:[]]},confidence:Math.min(.95,Math.max(.45,j?.confidence??.82))});return}catch(A){if(console.warn("[Research] AI engine failed, falling back to legacy search:",A),R.length>0){const j=z.length>0?z.map(Q=>vt(Q)).join(", "):"multi-source web",y=fe(R),k=y.slice(0,3).map(Q=>Q.title).join("; "),P=J.find(Q=>Q.excerpt)?.excerpt;se.current={provider:"multi-source",model:"aggregate"},n({query:v,summary:P?.length?P:k.length>0?`Multi-source (${j}) search returned ${y.length} results. Top hits: ${k}.`:`Multi-source (${j}) search returned ${y.length} results.`,sources:y.slice(0,16),citations:[],inlineEvidence:[],contradictions:[],verification:{score:.65,confidence:"medium",suggestions:[`Review ${j} sources manually.`]},confidence:.62});return}const B=await Xt(v,{count:10,language:x,timeout:6e3});if(B.length>0){const j=B.map((y,k)=>({id:`opt-fallback-${k}`,title:y.title,url:y.url,domain:y.domain,snippet:y.snippet,text:y.snippet,type:ue(y.domain),sourceType:ue(y.domain),relevanceScore:y.score*100,timestamp:y.timestamp,metadata:{provider:y.provider}}));n({query:v,summary:`Found ${j.length} result${j.length===1?"":"s"} for "${v}"`,sources:fe(j).slice(0,16),citations:[],inlineEvidence:[],contradictions:[],verification:{score:.65,confidence:"medium",suggestions:[`Results from ${B[0]?.provider||"optimized"} search`]},confidence:.6});return}const N=await me(v,x);if(N){se.current={provider:"duckduckgo",model:"instant-answer"};const j=Ne(N),y=await xe(v).catch(()=>[]),k=[...N.Heading&&N.AbstractText?[{id:"duck-instant",title:N.Heading,url:N.AbstractURL||"",domain:N.AbstractURL?Ae(N.AbstractURL):"duckduckgo.com",snippet:N.AbstractText,text:N.AbstractText,type:"news",sourceType:"news",relevanceScore:100,timestamp:Date.now()}]:[],...j.filter(P=>P.type==="result"&&P.url).map((P,Q)=>{const I=P.url?Ae(P.url):"",K=ue(I);return{id:`duck-result-${Q}`,title:P.title,url:P.url||"",domain:I,snippet:P.snippet,text:P.snippet,type:K,sourceType:K,relevanceScore:85-Q*5,timestamp:Date.now()}}),...y.map((P,Q)=>({id:`local-${P.id}`,title:P.title,url:"",domain:"local",snippet:P.snippet,text:P.snippet,type:"documentation",sourceType:"documentation",relevanceScore:90-Q*3,timestamp:Date.now(),metadata:{provider:"local-index"}}))];n({query:v,summary:N.AbstractText||N.Answer||N.Definition||`Found ${k.length} result${k.length===1?"":"s"} for "${v}"`,sources:fe(k).slice(0,16),citations:[],inlineEvidence:[],contradictions:[],verification:{score:.7,confidence:"medium",suggestions:["Results from DuckDuckGo Instant Answer API"]},confidence:.58})}else{const j=await xe(v).catch(()=>[]);if(j.length>0)se.current={provider:"local-index",model:"documents"},n({query:v,summary:`Found ${j.length} local result${j.length===1?"":"s"}`,sources:j.map((y,k)=>({id:`local-${y.id}`,title:y.title,url:"",domain:"local",snippet:y.snippet,text:y.snippet,type:"documentation",sourceType:"documentation",relevanceScore:90-k*3,timestamp:Date.now(),metadata:{provider:"local-index"}})),citations:[],inlineEvidence:[],contradictions:[],verification:{score:.6,confidence:"low",suggestions:["Results from local index only"]},confidence:.52});else throw new Error("No search results available. Please check your connection or try a different query.")}}}catch(C){console.error("Research query failed:",C);const A=C instanceof Error?C.message:"Unable to complete the research request. Please try again.",B=xt();if(B&&!B.meiliSearch&&B.localSearch)try{console.log("[Research] Attempting offline search fallback...");const j=await xe(v,{limit:10});if(j&&j.length>0){const y=j.map((k,P)=>({id:`local-${P}`,url:k.url||"",title:k.title||"Local Result",snippet:k.snippet||"",sourceType:"local",relevanceScore:k.score||50}));n({query:v,summary:`Found ${j.length} local result(s) for "${v}"`,sources:y,citations:y.length,confidence:.6,processingTimeMs:100}),H.success(`Found ${j.length} local result(s)`),i(null);return}}catch(j){console.warn("[Research] Offline fallback also failed:",j)}i(`Search failed: ${A}. ${B?.error?`(${B.error})`:""}`),H.error(`Search failed: ${A}`);const N=performance.now()-T;oe(async()=>{const{telemetryMetrics:j}=await import("../assets/index-D9cF9G1U.js").then(y=>y.t);return{telemetryMetrics:j}},__vite__mapDeps([8,0,1,2,3,4,5,6,9,10,11,12,13,14])).then(({telemetryMetrics:j})=>{j.trackPerformance("search_latency",N,"ms",{provider:"failed",error:A})}).catch(()=>{})}finally{d(!1),l(null),H.dismiss()}};b.useEffect(()=>{const f=v=>{const T=v.detail;T?.query&&(e(T.query),setTimeout(()=>{ie(T.query)},100))};return window.addEventListener("research:quickstart",f),()=>{window.removeEventListener("research:quickstart",f)}},[]),b.useEffect(()=>{ge()},[ge]),b.useEffect(()=>{if(!r||typeof window>"u"||!window.graph?.add)return;const f=JSON.stringify({query:r.query,sources:r.sources.map(E=>E.url||E.title),citations:r.citations?.length??0,evidence:(r.inlineEvidence??[]).length});if(Et.current===f){ge();return}Et.current=f;const v=lr(r.query),T=r.sources.map((E,D)=>({src:v,dst:We(E,D),rel:"supports",weight:Math.round(E.relevanceScore||40)}));window.graph.add({key:v,type:"research-query",title:r.query.slice(0,160),meta:{query:r.query,createdAt:Date.now()}},T),r.sources.forEach((E,D)=>{const R=We(E,D),z=(r.inlineEvidence??[]).filter(C=>C.sourceIndex===D).slice(0,6),J=z.map(C=>({src:R,dst:dr(R,C.citationIndex??C.from??D),rel:"evidence",weight:1}));window.graph.add({key:R,type:"research-source",title:E.title,meta:{url:E.url,domain:E.domain,snippet:E.snippet||E.text?.slice(0,140),relevance:E.relevanceScore}},J),z.forEach(C=>{const A=dr(R,C.citationIndex??C.from??D),B=r.citations?.find(N=>N.index===C.citationIndex);window.graph.add({key:A,type:"research-evidence",title:B?.quote||C.quote||"Highlighted evidence",meta:{sourceKey:R,snippet:B?.quote||C.quote,fragmentUrl:C?.quoteUrl||E.url}})})}),(r.contradictions??[]).forEach(E=>{if(!Array.isArray(E.sources)||E.sources.length<2)return;const[D,...R]=E.sources,z=r.sources[D];if(!z)return;const J=We(z,D);R.forEach(C=>{const A=r.sources[C];if(!A)return;const B=We(A,C);window.graph.add({key:J,type:"research-source"},[{src:J,dst:B,rel:"contradicts",weight:E.severityScore??(E.disagreement==="major"?2:1)}])})}),ge()},[r,ge]);const at=async f=>{try{pe?await Z.tabs.navigate(pe,f):await Z.tabs.create(f)}catch(v){console.error("Failed to open URL:",v)}},ss=f=>{e(f),ie(f)};return b.useEffect(()=>{const f=Tt.trim();if(!f||f.length<2){O([]),te(!1);return}const v=typeof navigator<"u"&&!navigator.onLine;ae(!0),(async()=>{const E=[];if(!v)try{let D=!1;await Z.redix.stream(f,{onChunk:R=>{!D&&R.trim()&&(D=!0,E.push({title:`Ask Redix: ${f}`,subtitle:"Get AI-powered research suggestions",action:()=>{e(f),te(!1),ie(f)}}))},onError:()=>{}})}catch{}if(E.length===0&&!v)try{const D=await me(f);D?.Heading&&E.push({title:D.Heading,subtitle:D.AbstractText?.slice(0,100)||"Instant answer from DuckDuckGo",action:()=>{e(f),te(!1),ie(f)}})}catch{}try{const D=await Z.history.search(f);Array.isArray(D)&&D.length>0&&D.slice(0,5).forEach(R=>{E.find(z=>z.title===R.title)||E.push({title:R.title||R.url||"Untitled",subtitle:R.url,action:()=>{e(R.title||R.url),te(!1),ie(R.title||R.url)}})})}catch{}we.forEach(D=>{const R=D.title||"Untitled",z=D.url||"";(R.toLowerCase().includes(f.toLowerCase())||z.toLowerCase().includes(f.toLowerCase()))&&!E.find(J=>J.title===R)&&E.push({title:R,subtitle:z,action:()=>{e(R),te(!1),ie(R)}})}),O(E),te(E.length>0),ae(!1)})()},[Tt,we]),b.useEffect(()=>{const f=v=>{et.current&&!et.current.contains(v.target)&&te(!1)};return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]),s.jsxs(s.Fragment,{children:[s.jsx(Dn,{}),s.jsxs(na,{sidebarWidth:0,navHeight:0,className:"mode-theme mode-theme--research bg-[#0f111a] text-gray-100",children:[s.jsxs(aa,{sticky:!1,className:"border-b border-white/5 bg-black/20 backdrop-blur",children:[s.jsxs("div",{className:"flex items-center justify-between px-6 pb-3 pt-6",children:[s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("h1",{className:"text-xl font-semibold text-white",children:"Research Mode"}),s.jsx("p",{className:"text-sm text-gray-400",children:"Aggregate evidence, generate traceable answers, and surface counterpoints without leaving the browser."})]}),s.jsxs("div",{className:"ml-4 flex flex-shrink-0 items-center gap-2",children:[s.jsx("button",{type:"button",onClick:()=>Vr(f=>!f),className:`rounded-lg border px-3 py-1.5 text-sm transition ${qe?"border-emerald-500/60 bg-emerald-500/10 text-emerald-200":"border-white/20 bg-white/10 text-gray-300 hover:bg-white/20"}`,title:qe?"Switch to Standard View":"Switch to Enhanced Multilingual View",children:s.jsxs("span",{className:"flex items-center gap-1.5",children:[s.jsx(he,{size:14}),qe?"Enhanced":"Standard"]})}),s.jsx("button",{type:"button",onClick:()=>Dt(f=>!f),className:`rounded-lg border px-3 py-1.5 text-sm transition ${Mt?"border-blue-500/60 bg-blue-500/10 text-blue-200":"border-white/20 bg-white/10 text-gray-300 hover:bg-white/20"}`,title:"Toggle Cursor AI Assistant",children:s.jsxs("span",{className:"flex items-center gap-1.5",children:[s.jsx(he,{size:14}),"Cursor AI"]})}),s.jsx(Ga,{containers:tt,activeContainerId:qr})]})]}),s.jsx("div",{className:"flex-shrink-0 px-6 pb-5",children:s.jsxs("div",{className:"relative max-w-4xl",ref:et,children:[s.jsxs("form",{onSubmit:async f=>{f.preventDefault(),te(!1),await ie()},className:"flex w-full items-center gap-3 rounded-2xl border border-white/10 bg-white/5 px-4 py-3 shadow-inner shadow-black/40 transition-all focus-within:border-blue-500/50 focus-within:ring-1 focus-within:ring-blue-500/20",children:[s.jsx(fr,{size:18,className:"flex-shrink-0 text-gray-500"}),s.jsx("input",{id:"research-query-input",name:"research-query",className:"flex-1 bg-transparent text-base text-white placeholder:text-gray-500 focus:outline-none",value:t,onChange:f=>{e(f.target.value),te(!0),f.target.value.length>3&&bt(f.target.value).then(v=>{h(v.language)}).catch(()=>{})},onFocus:()=>{W.length>0&&te(!0)},placeholder:(()=>{const f=x==="auto"?u:x;return f==="hi"?"हिंदी में पूछें: iPhone vs Samsung की तुलना करें":f==="ta"?"தமிழில் கேளுங்கள்: iPhone vs Samsung ஒப்பிடுக":"Ask in Hindi: Compare iPhone vs Samsung"})(),disabled:o}),s.jsxs("div",{className:"flex items-center gap-2",children:[Ue&&s.jsx(Skeleton,{variant:"text",width:80,height:16,className:"text-xs"}),s.jsx("input",{id:"research-file-input",name:"research-file",ref:At,type:"file",multiple:!0,accept:".pdf,.docx,.txt,.md",onChange:f=>ts(f.target.files),className:"hidden"}),s.jsxs("button",{type:"button",onClick:()=>At.current?.click(),disabled:$t,className:"flex items-center gap-1.5 rounded-lg border border-white/20 bg-white/10 px-3 py-1.5 text-sm text-gray-100 hover:bg-white/20 disabled:cursor-not-allowed disabled:opacity-40",title:"Upload documents (PDF, DOCX, TXT, MD)",children:[s.jsx(Ss,{size:14}),$t?"Processing…":"Upload"]}),s.jsx("button",{type:"submit",disabled:o||!t.trim(),className:"rounded-lg border border-white/20 bg-white/10 px-3 py-1.5 text-sm text-gray-100 hover:bg-white/20 disabled:cursor-not-allowed disabled:opacity-40",children:o?"Researching…":"Run research"}),s.jsx(Mn,{onResult:f=>{const v=Gn(f);if(v.isResearchCommand){if(v.language){const T=Ce.getState();T.language!==v.language&&(T.setLanguage(v.language),H.success(`Language set to ${v.language.toUpperCase()}`))}e(v.query),setTimeout(()=>ie(v.query),120)}else e(f),setTimeout(()=>ie(f),120)},small:!0})]})]}),Te&&W.length>0&&s.jsx("div",{className:"absolute left-0 right-0 top-full z-[100] mt-2 max-h-[400px] min-h-[120px] overflow-y-auto rounded-xl border border-white/10 bg-[#111422] shadow-xl shadow-black/50",children:s.jsx("div",{className:"space-y-1 p-2",children:W.map((f,v)=>s.jsxs("button",{type:"button",onClick:()=>{f.action?.()},className:"w-full rounded-lg px-3 py-2.5 text-left transition-colors hover:bg-white/5 focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[s.jsx("div",{className:"line-clamp-1 text-sm font-medium text-white",children:f.title}),f.subtitle&&s.jsx("div",{className:"mt-0.5 line-clamp-1 text-xs text-gray-400",children:f.subtitle})]},v))})})]})}),le.length>0&&s.jsx("div",{className:"flex-shrink-0 px-6 pb-3",children:s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsx("span",{className:"text-xs font-medium text-gray-400",children:"Uploaded documents:"}),le.map(f=>s.jsxs("div",{className:"group flex items-center gap-2 rounded-lg border border-white/10 bg-white/5 px-3 py-1.5 text-xs text-gray-300",children:[s.jsx(jt,{size:12,className:"text-gray-400"}),s.jsx("span",{className:"max-w-[200px] truncate",children:f.name}),s.jsxs("span",{className:"text-gray-500",children:["(",(f.size/1024).toFixed(1)," KB)"]}),s.jsx("button",{type:"button",onClick:()=>rs(f.id),className:"ml-1 rounded p-0.5 opacity-0 transition-opacity hover:bg-white/10 group-hover:opacity-100",title:"Remove document",children:s.jsx(pr,{size:12,className:"text-gray-400 hover:text-gray-200"})})]},f.id))]})})]}),s.jsx(ia,{className:"flex min-h-0 flex-1 gap-6 overflow-hidden px-6 pb-6",children:qe?s.jsx("div",{className:"flex-1 overflow-hidden rounded-2xl border border-white/5 bg-[#111422] shadow-xl shadow-black/30",children:s.jsx(Ia,{})}):s.jsxs(s.Fragment,{children:[s.jsxs("section",{className:"relative flex-1 overflow-hidden rounded-2xl border border-white/5 bg-[#111422] shadow-xl shadow-black/30",children:[s.jsx("div",{className:"absolute inset-x-0 top-0 h-px bg-gradient-to-r from-transparent via-blue-400/40 to-transparent"}),s.jsxs("div",{className:"flex h-full flex-col space-y-4 p-5",children:[s.jsx(Oa,{authorityBias:$,includeCounterpoints:m,region:U,loading:o,onAuthorityBiasChange:q,onIncludeCounterpointsChange:p,onRegionChange:f=>G(f),deepScanEnabled:Ie,onDeepScanToggle:f=>Wr(f)}),Ie&&s.jsx(qa,{loading:Gr,steps:Hr,error:Kr}),a&&s.jsx("div",{className:"rounded-xl border border-red-500/40 bg-red-500/10 px-4 py-3 text-sm text-red-200 backdrop-blur",children:a}),o&&s.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-4",children:[s.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border border-blue-400/20 bg-blue-400/10 px-4 py-2 text-blue-200",children:[s.jsx(he,{size:14,className:"animate-pulse"}),"Gathering sources and evaluating evidence…"]}),s.jsxs("div",{className:"w-full max-w-2xl space-y-4",children:[s.jsx(ut,{variant:"card"}),s.jsx(ut,{variant:"list",lines:3}),s.jsx(ut,{variant:"text",lines:4})]}),s.jsx("p",{className:"text-xs text-gray-500",children:"Cross-checking accuracy, bias, and contradictions before presenting the answer."})]}),!o&&r&&s.jsxs("div",{className:"flex-1 space-y-4 overflow-y-auto pr-1",children:[s.jsx(ea,{evidence:r.evidence||[],sources:r.sources,activeEvidenceId:X,onEvidenceClick:Y}),s.jsx(za,{result:r,onOpenSource:at,activeSourceId:w,onActiveSourceChange:S,onSaveForCompare:Xr,onShowCompare:()=>rt(!0),compareCount:Fe.length}),s.jsx(Za,{showGraph:F,onToggleGraph:()=>L(f=>!f),query:r.query,queryKey:es,graphData:g,activeSourceId:w,onSelectSource:S,onOpenSource:at})]}),!o&&!r&&!a&&s.jsx(Pr,{onRunExample:ss})]})]}),s.jsx(Wa,{result:r,loading:o,onOpenSource:at,activeSourceId:w,onSelectSource:S})]})}),s.jsx(ta,{open:zr,answers:Fe,selectedIds:Br,onToggleSelect:Qr,onClose:()=>rt(!1),onRemove:Jr}),Mt&&s.jsx("div",{className:"fixed inset-y-0 right-0 z-50 flex w-96 flex-col border-l border-slate-700/70 bg-slate-900/95 shadow-2xl backdrop-blur-xl",children:s.jsx(da,{pageSnapshot:pe&&we.find(f=>f.id===pe)?{url:we.find(f=>f.id===pe)?.url||"",title:we.find(f=>f.id===pe)?.title||"",html:void 0}:void 0,onClose:()=>Dt(!1)})})]})]})}const Fa=[{value:"global",label:"Global"},{value:"us",label:"United States"},{value:"uk",label:"United Kingdom"},{value:"eu",label:"Europe"},{value:"asia",label:"Asia Pacific"}];function Oa({authorityBias:t,includeCounterpoints:e,region:r,loading:n,onAuthorityBiasChange:a,onIncludeCounterpointsChange:i,onRegionChange:o,deepScanEnabled:d,onDeepScanToggle:c}){return s.jsxs("div",{className:"grid gap-4 rounded-2xl border border-white/10 bg-white/[0.04] px-5 py-4 text-xs text-gray-200 shadow-inner shadow-black/30 sm:grid-cols-[minmax(0,_1fr)_auto_auto]",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-gray-400",children:"Recency vs authority"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-[11px] text-gray-500",children:"Recency"}),s.jsx("div",{className:"relative flex-1",children:s.jsx("input",{type:"range",min:0,max:100,value:t,disabled:n,onChange:l=>a(Number(l.target.value)),className:"h-1 w-full cursor-pointer accent-blue-500 disabled:opacity-40"})}),s.jsx("span",{className:"text-[11px] text-gray-500",children:"Authority"}),s.jsxs("span",{className:"rounded border border-blue-500/40 bg-blue-500/10 px-2 py-0.5 text-[11px] text-blue-200",children:[t,"%"]})]})]}),s.jsxs("label",{className:"flex items-center gap-2 rounded-lg border border-white/5 bg-white/5 px-3 py-2 text-[11px]",children:[s.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-white/20 bg-transparent text-blue-500 focus:ring-blue-500 disabled:opacity-40",checked:e,disabled:n,onChange:l=>i(l.target.checked)}),"Include counterpoints"]}),s.jsxs("label",{className:"flex items-center gap-2 rounded-lg border border-white/5 bg-white/5 px-3 py-2 text-[11px]",children:["Region",s.jsx("select",{value:r,disabled:n,onChange:l=>o(l.target.value),className:"rounded border border-white/10 bg-[#0c0e18] px-2 py-1 text-[11px] text-gray-200 focus:border-blue-500 focus:outline-none focus:ring-0 disabled:opacity-40",children:Fa.map(l=>s.jsx("option",{value:l.value,children:l.label},l.value))})]}),s.jsxs("label",{className:"flex items-center gap-2 rounded-lg border border-indigo-500/40 bg-indigo-500/10 px-3 py-2 text-[11px] text-indigo-100 sm:col-span-3",children:[s.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5 rounded border-indigo-400/60 bg-transparent text-indigo-300 focus:ring-indigo-400 disabled:opacity-40",checked:d,disabled:n,onChange:l=>c(l.target.checked)}),s.jsxs("div",{className:"flex flex-col gap-0.5",children:[s.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide",children:"Deep scan"}),s.jsxs("span",{className:"text-[11px] text-indigo-200/80",children:["Analyze multiple pages with scraper context (",d?"on":"off",")"]})]})]})]})}function qa({loading:t,steps:e,error:r}){return s.jsxs("div",{className:"rounded-2xl border border-indigo-500/30 bg-indigo-500/5 px-4 py-3 text-xs text-indigo-100",children:[s.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-[11px] uppercase tracking-wide text-indigo-200",children:"Deep scan progress"}),s.jsx("p",{className:"text-[11px] text-indigo-200/70",children:e.length>0?`${e.length} checkpoints recorded`:"Preparing sources via scraper"})]}),t&&s.jsx(Skeleton,{variant:"circular",width:16,height:16,className:"animate-pulse"})]}),r&&s.jsx("p",{className:"mb-2 rounded-lg border border-red-500/40 bg-red-500/10 px-3 py-1 text-red-200",children:r}),s.jsx("ol",{className:"space-y-1 text-[11px] text-indigo-100/90",children:(e.length>0?e:[{label:"Gathering sources…",status:t?"running":"complete",started_at:"",completed_at:""}]).map((n,a)=>s.jsxs("li",{className:"rounded border border-indigo-500/20 px-3 py-1",children:[s.jsx("span",{className:"font-semibold",children:n.label}),s.jsx("span",{className:"ml-2 text-indigo-200/70",children:n.status}),n.detail&&s.jsx("span",{className:"ml-2 text-indigo-200/70",children:n.detail})]},`${n.label}-${a}`))})]})}function za({result:t,activeSourceId:e,onActiveSourceChange:r,onOpenSource:n,onSaveForCompare:a,onShowCompare:i,compareCount:o}){const d=Math.round(t.confidence*100),c=t.verification,l=u=>t.sources[u]?.url??`source-${u}`;return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("section",{className:"rounded-2xl border border-white/5 bg-white/5 px-6 py-5 shadow-inner shadow-black/30",children:[s.jsxs("header",{className:"mb-4 flex flex-wrap items-center justify-between gap-3",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-base font-semibold text-white",children:"AI answer with citations"}),s.jsxs("p",{className:"text-xs text-gray-400",children:[t.sources.length," sources considered • Confidence ",d,"%"]})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[c&&s.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-medium ${c.verified?"border border-emerald-500/50 bg-emerald-500/10 text-emerald-200":"border border-amber-500/50 bg-amber-500/10 text-amber-200"}`,children:c.verified?"Verified":"Needs review"}),s.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center gap-1 rounded-full border border-white/15 px-3 py-1 text-xs text-gray-200 hover:border-white/40",children:"Save for compare"}),s.jsxs("button",{type:"button",onClick:i,className:"inline-flex items-center gap-1 rounded-full border border-sky-500/40 bg-sky-500/10 px-3 py-1 text-xs text-sky-100 hover:border-sky-400/70",children:["Open compare (",o,")"]})]})]}),s.jsx(Zn,{summary:t.summary,citations:t.citations,inlineEvidence:t.inlineEvidence,sources:t.sources,activeSourceId:e,onActivate:u=>{r(u);const h=t.sources.findIndex(x=>(x.url??`source-${t.sources.indexOf(x)}`)===u);if(h!==-1){const x=t.evidence?.find(w=>w.sourceIndex===h);x&&setActiveEvidenceId(x.id)}},onOpenSource:n,onExport:async u=>{try{if(u==="markdown"){let h=`# Research: ${t.query}

`;h+=`## Summary

${t.summary}

`,h+=`## Citations

`,t.citations.forEach(m=>{const p=t.sources[m.sourceIndex];h+=`[${m.index}] **${p?.title||"Unknown"}**
`,h+=`  - URL: ${p?.url||""}
`,h+=`  - Domain: ${p?.domain||""}
`,h+=`  - Confidence: ${(m.confidence*100).toFixed(0)}%
`,m.quote&&(h+=`  - Quote: "${m.quote}"
`),h+=`
`}),h+=`## Sources

`,t.sources.forEach((m,p)=>{h+=`${p+1}. **[${m.title}](${m.url})** - ${m.domain}
`,m.snippet&&(h+=`   ${m.snippet}
`),h+=`
`});const x=new Blob([h],{type:"text/markdown"}),w=URL.createObjectURL(x),S=document.createElement("a");S.href=w,S.download=`research-${Date.now()}.md`,S.click(),URL.revokeObjectURL(w)}else await Z.research.export({format:"markdown",sources:t.sources.map(h=>h.url),includeNotes:!0})}catch(h){console.error("Export failed:",h)}}}),t.citations.length>0&&s.jsxs("div",{className:"mt-5 rounded-xl border border-white/5 bg-[#1a1d2a] px-4 py-3",children:[s.jsx("h3",{className:"mb-2 text-[11px] font-semibold uppercase tracking-wide text-gray-400",children:"Citations"}),s.jsx("ul",{className:"space-y-2",children:t.citations.map(u=>{const h=t.sources[u.sourceIndex],x=l(u.sourceIndex),w=e===x;return h?s.jsxs("li",{className:`rounded-lg border px-3 py-2 text-xs transition-colors ${w?"border-blue-500/40 bg-blue-500/10 text-blue-100":"border-white/5 bg-white/[0.02] text-gray-300 hover:border-blue-400/40 hover:bg-blue-400/5"}`,children:[s.jsxs("button",{className:"font-semibold text-indigo-300 hover:text-indigo-200",onClick:()=>{r(x),n(h.url)},children:["[",u.index,"] ",h.title]}),s.jsxs("div",{className:"text-[11px] text-gray-500",children:["Confidence ",(u.confidence*100).toFixed(0),"% • ",h.domain]})]},u.index):null})})]})]}),c&&s.jsx(ei,{verification:c}),s.jsx(Ha,{sources:t.sources,activeSourceId:e,onActivate:r,onOpenSource:n})]})}const Ba={high:"Critical evidence",medium:"Supporting evidence",low:"Context"};function Wa({result:t,loading:e,onOpenSource:r,activeSourceId:n,onSelectSource:a}){if(e)return s.jsxs("aside",{className:"w-[310px] shrink-0 space-y-4 overflow-y-auto rounded-2xl border border-white/5 bg-[#0f1220] p-4 shadow-inner shadow-black/50",children:[s.jsx("div",{className:"h-20 animate-pulse rounded-xl bg-white/5"}),s.jsx("div",{className:"h-32 animate-pulse rounded-xl bg-white/5"}),s.jsx("div",{className:"h-32 animate-pulse rounded-xl bg-white/5"})]});if(!t)return s.jsx("aside",{className:"w-[310px] shrink-0 overflow-y-auto rounded-2xl border border-white/5 bg-[#0f1220] p-5 shadow-inner shadow-black/50",children:s.jsxs("div",{className:"space-y-4 text-sm text-gray-400",children:[s.jsx("div",{className:"rounded-xl border border-white/10 bg-white/[0.03] px-3 py-2 text-xs text-gray-300",children:s.jsxs("p",{className:"flex items-center gap-2 text-gray-200",children:[s.jsx(he,{size:14,className:"text-blue-300"}),"Try questions that need multiple independent sources."]})}),s.jsx(Pr,{onRunExample:a,minimal:!0})]})});const i=(t.evidence??[]).slice(0,3),o=(t.contradictions??[]).slice(0,2),d=n;return s.jsxs("aside",{className:"w-[310px] shrink-0 space-y-4 overflow-y-auto rounded-2xl border border-white/5 bg-[#0f1220] p-5 shadow-inner shadow-black/50",children:[s.jsxs("div",{className:"space-y-2 rounded-xl border border-white/10 bg-white/[0.04] px-4 py-3",children:[s.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400",children:[s.jsx("span",{children:"Confidence"}),s.jsxs("span",{className:"text-sm font-semibold text-blue-200",children:[(t.confidence*100).toFixed(0),"%"]})]}),s.jsx("div",{className:"h-1.5 w-full overflow-hidden rounded bg-white/10",children:s.jsx("div",{className:"h-full rounded bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500",style:{width:`${Math.min(100,Math.max(0,t.confidence*100))}%`}})}),s.jsxs("p",{className:"text-[11px] text-gray-500",children:[t.sources.length," vetted sources • ",t.citations.length," inline citations"]}),s.jsxs("button",{className:"inline-flex items-center gap-2 rounded border border-white/10 bg-white/[0.03] px-2 py-1 text-[11px] text-gray-300 hover:border-blue-400/40 hover:text-blue-200",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),children:[s.jsx(Ns,{size:12}),"Adjust research settings"]})]}),i.length>0&&s.jsxs("div",{className:"space-y-3 rounded-xl border border-blue-500/20 bg-blue-500/[0.07] px-4 py-3",children:[s.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs text-blue-100",children:[s.jsx("span",{className:"font-semibold uppercase tracking-wide",children:"Key evidence"}),s.jsxs("span",{children:[i.length," of ",(t.evidence??[]).length]})]}),s.jsx("div",{className:"space-y-2 text-xs text-blue-100/90",children:i.map(c=>{const l=t.sources[c.sourceIndex];if(!l)return null;const u=l.url??`source-${c.sourceIndex}`,h=d===u;return s.jsxs("button",{onClick:()=>{a(u),r(c.fragmentUrl||l.url)},className:`w-full rounded-lg border px-3 py-2 text-left transition-colors ${h?"border-blue-300 bg-blue-400/20":"border-blue-400/30 hover:bg-blue-400/15"}`,children:[s.jsxs("div",{className:"flex items-center justify-between gap-2 text-[10px] uppercase tracking-wide text-blue-200/80",children:[s.jsx("span",{children:Ba[c.importance]}),s.jsx("span",{children:l.domain})]}),s.jsx("p",{className:"mt-1 line-clamp-3 text-[11px] text-blue-50/90",children:c.quote})]},c.id)})})]}),o.length>0&&s.jsxs("div",{className:"space-y-2 rounded-xl border border-amber-500/20 bg-amber-500/[0.07] px-4 py-3",children:[s.jsxs("div",{className:"flex items-center justify-between text-xs text-amber-100",children:[s.jsx("span",{className:"font-semibold uppercase tracking-wide",children:"Contradictions"}),s.jsx("span",{children:o.length})]}),s.jsx("ul",{className:"space-y-2 text-[11px] text-amber-50/90",children:o.map((c,l)=>{const u=c.disagreement==="major"?"Major":"Minor";return s.jsxs("li",{className:"rounded-lg border border-amber-400/30 bg-amber-500/10 p-3",children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsx("span",{className:"font-semibold text-amber-100",children:c.claim}),s.jsx("span",{className:"text-amber-200",children:u})]}),s.jsx("p",{className:"mt-1 text-amber-100/70",children:c.summary||"Investigate differing positions."}),s.jsxs("button",{onClick:()=>{const h=c.sources[0];if(typeof h=="number"){const x=t.sources[h];x&&(a(x.url??`source-${h}`),r(x.url))}},className:"mt-2 inline-flex items-center gap-1 text-[11px] text-amber-200 hover:text-amber-100",children:["View sources",s.jsx(ks,{size:12})]})]},`${c.claim}-${l}`)})})]}),t.biasProfile&&s.jsxs("div",{className:"space-y-2 rounded-xl border border-sky-500/20 bg-sky-500/[0.06] px-4 py-3 text-xs text-sky-100",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"font-semibold uppercase tracking-wide",children:"Bias snapshot"}),s.jsxs("span",{children:[t.biasProfile.authorityBias,"% authority"]})]}),s.jsx("div",{className:"h-1.5 w-full overflow-hidden rounded bg-sky-500/20",children:s.jsx("div",{className:"h-full bg-gradient-to-r from-sky-500 via-blue-500 to-purple-500",style:{width:`${t.biasProfile.authorityBias}%`}})}),s.jsx("div",{className:"space-y-1 pt-2",children:t.biasProfile.domainMix.slice(0,3).map(c=>s.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[s.jsx("span",{children:Fr(c.type)}),s.jsxs("span",{children:[c.percentage,"%"]})]},c.type))})]}),t.taskChains&&t.taskChains.length>0&&s.jsxs("div",{className:"space-y-2 rounded-xl border border-purple-500/20 bg-purple-500/[0.07] px-4 py-3",children:[s.jsxs("div",{className:"flex items-center justify-between text-xs text-purple-100",children:[s.jsx("span",{className:"font-semibold uppercase tracking-wide",children:"Next checks"}),s.jsx("span",{children:t.taskChains.length})]}),s.jsx("ol",{className:"space-y-2 text-[11px] text-purple-50/80",children:t.taskChains.flatMap(c=>c.steps).filter(c=>c.status!=="done").slice(0,3).map(c=>s.jsxs("li",{className:"rounded-lg border border-purple-400/30 bg-purple-400/10 px-3 py-2",children:[s.jsx("span",{className:"font-semibold text-purple-100",children:c.title}),s.jsx("p",{className:"text-purple-100/70",children:c.description})]},c.id))})]}),s.jsx(Ca,{currentUrl:activeId&&tabs.find(c=>c.id===activeId)?tabs.find(c=>c.id===activeId)?.url:void 0,onResult:c=>{console.log("OmniAgent result:",c)}})]})}function Ga({containers:t,activeContainerId:e}){const r=t.find(n=>n.id===e)??t.find(n=>n.id==="default");return r?s.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1.5 text-xs text-gray-200 shadow-inner shadow-black/20",children:[s.jsx("span",{className:"h-2.5 w-2.5 rounded-full",style:{backgroundColor:r.color??"#6366f1"}}),s.jsx("span",{className:"font-medium",children:r.name}),s.jsx("span",{className:"text-[10px] uppercase tracking-wide text-gray-400",children:Fr(r.scope??"session")})]}):null}function Pr({onRunExample:t,minimal:e=!1}){const[r,n]=b.useState("en"),[a,i]=b.useState(0);b.useEffect(()=>{(async()=>{try{const l=await bt(navigator.language||"en");n(l.language),i(l.confidence)}catch{n("en")}})()},[]);const o=b.useMemo(()=>r==="hi"?["Nifty vs BankNifty की तुलना करें","iPhone vs Samsung की तुलना करें","भारत में AI नियमों का सारांश"]:r==="ta"?["Nifty vs BankNifty ஒப்பிடுக","iPhone vs Samsung ஒப்பிடுக","இந்தியாவில் AI விதிகளின் சுருக்கம்"]:["Compare Nifty vs BankNifty","Compare iPhone vs Samsung","Summarize AI regulations in India"],[r]),d=b.useMemo(()=>r==="hi"?{title:"Research Mode में आपका स्वागत है",subtitle:'हिंदी/तमिल/अंग्रेजी में पूछें: "Nifty vs BankNifty की तुलना करें"',button:"उदाहरण आज़माएं"}:r==="ta"?{title:"Research Modeக்கு வரவேற்கிறோம்",subtitle:'தமிழ்/ஹிந்தி/ஆங்கிலத்தில் கேளுங்கள்: "Nifty vs BankNifty ஒப்பிடுக"',button:"எடுத்துக்காட்டு முயற்சிக்கவும்"}:{title:"Welcome to Research Mode",subtitle:'Ask in Hindi/Tamil/English: "Compare Nifty vs BankNifty"',button:"Try Example"},[r]);return e?s.jsx("ul",{className:"space-y-2 text-xs text-gray-400",children:o.slice(0,2).map(c=>s.jsx("li",{children:s.jsx("button",{className:"text-left text-gray-300 hover:text-blue-200",onClick:()=>t(c),children:c})},c))}):s.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-6 rounded-2xl bg-gradient-to-br from-purple-900/40 via-blue-900/40 to-purple-900/40 px-10 py-16 text-center",children:[s.jsx(ee.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},className:"flex h-16 w-16 items-center justify-center rounded-full border-2 border-white/20 bg-white/10 text-blue-300 shadow-lg",children:s.jsx(he,{size:32})}),s.jsxs(ee.div,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1,duration:.3},className:"space-y-3",children:[s.jsx("h1",{className:"text-3xl font-bold text-white",children:d.title}),s.jsx("p",{className:"max-w-md text-base text-gray-300",children:d.subtitle})]}),s.jsxs(ee.div,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2,duration:.3},className:"flex w-full max-w-md flex-col gap-3",children:[o.map((c,l)=>s.jsxs("button",{onClick:()=>t(c),className:"group relative overflow-hidden rounded-xl border border-white/20 bg-white/10 px-6 py-4 text-left text-gray-200 transition-all hover:border-blue-400/60 hover:bg-blue-500/20 hover:shadow-lg hover:shadow-blue-500/20",children:[s.jsxs("div",{className:"relative z-10 flex items-center gap-3",children:[s.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-blue-500/20 text-blue-300",children:l+1}),s.jsx("span",{className:"font-medium",children:c})]}),s.jsx(ee.div,{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10",initial:{x:"-100%"},whileHover:{x:0},transition:{duration:.3}})]},c)),s.jsx("button",{onClick:()=>t(o[0]),className:"mt-2 rounded-xl bg-gradient-to-r from-blue-600 to-purple-600 px-6 py-3 font-bold text-white shadow-lg transition-all hover:from-blue-700 hover:to-purple-700 hover:shadow-xl",children:d.button})]}),a>.5&&s.jsxs(ee.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"text-xs text-gray-400",children:["Detected: ",r.toUpperCase()," (",(a*100).toFixed(0),"% confidence)"]})]})}function Ha({sources:t,activeSourceId:e,onActivate:r,onOpenSource:n}){if(!t||t.length===0)return null;const a=t.reduce((o,d)=>{const c=typeof d.metadata?.provider=="string"?d.metadata.provider.toLowerCase():"";return c&&(o[c]=(o[c]??0)+1),o},{}),i=Object.entries(a).sort((o,d)=>d[1]-o[1]).slice(0,3).map(([o,d])=>`${vt(o)} (${d})`).join(" • ")||"Ranked by relevance & consensus";return s.jsxs("section",{className:"rounded-2xl border border-white/10 bg-white/[0.03] p-4",children:[s.jsx("header",{className:"mb-4 flex flex-wrap items-center justify-between gap-2",children:s.jsxs("div",{children:[s.jsxs("h3",{className:"text-sm font-semibold text-white",children:["Sources (",t.length,")"]}),s.jsx("p",{className:"text-xs text-gray-500",children:i})]})}),s.jsx("div",{className:"flex flex-col gap-3",children:t.map((o,d)=>{const c=o.url??`source-${d}`;return s.jsx(Yn,{source:o,index:d,isActive:e===c,onActivate:r,onOpen:n},o.url||d)})})]})}const Ka=["nytimes","cnn","bbc","guardian","reuters","bloomberg","apnews","wsj","cnbc","financialtimes","washingtonpost"],Va=["reddit","stack","stackoverflow","stackexchange","discord","forum","forums","quora","medium"],Qa=["docs","developer","dev.","api.","learn.","support.","help.","manual","reference","wikipedia","wiki","kubernetes","cloud.google","learn.microsoft"];function Ja(t,e){const r=t.domain||Ae(t.url),n=typeof t.source=="string"?t.source:"web",a=ue(r,n),i=Number.isFinite(t.score)?t.score:.62,o=t.metadata||{},d=typeof o.timestamp=="number"?o.timestamp:typeof o.dateLastCrawled=="string"?Date.parse(o.dateLastCrawled):void 0;return{id:`multi-${e}-${n}`,title:t.title,url:t.url,domain:r,snippet:t.snippet||"",text:t.snippet||t.title,type:a,sourceType:a,relevanceScore:Math.round(Math.max(.45,i)*100),timestamp:Number.isFinite(d)?d:Date.now(),metadata:{provider:n,rawScore:t.score,...t.metadata}}}function Xa(t,e){const r=t.domain||Ae(t.url),n=ue(r);return{id:t.id||`deep-${e}`,title:t.title||t.url||`Deep scan source ${e+1}`,url:t.url||"",domain:r||"deep-scan",snippet:t.snippet||"",text:t.text||t.snippet||"",type:n,sourceType:n,relevanceScore:t.relevanceScore??80-e*2,metadata:{...t.metadata||{},provider:"deep-scan"},image:t.image,wordCount:t.wordCount,lang:t.lang,contentHash:t.contentHash,fromCache:t.fromCache,rendered:t.rendered,fetchedAt:t.fetchedAt}}function ue(t,e){const r=(t||"").toLowerCase();return r.endsWith(".edu")||r.includes(".ac.")||r.includes("arxiv")||r.includes("researchgate")?"academic":r.endsWith(".gov")||r.includes(".gov.")?"documentation":r&&Ka.some(n=>r.includes(n))?"news":r&&Va.some(n=>r.includes(n))?"forum":r&&Qa.some(n=>r.includes(n))?"documentation":!r&&e&&e.toLowerCase().includes("bing")?"news":"other"}function fe(t){const e=new Set;return t.filter(r=>{const n=r.url||`${r.domain}|${r.title}`;return n?e.has(n)?!1:(e.add(n),!0):!0})}function gt(t){return t?t.replace(/\/+$/,"").toLowerCase():""}function Ya(t,e){if(!e||e.length===0)return t;const r=new Map;return e.forEach(n=>{[n.finalUrl,n.url].filter(Boolean).forEach(i=>{r.set(gt(i),n)})}),t.map(n=>{const a=r.get(gt(n.url))||r.get(gt(n.metadata?.canonicalUrl));return a?{...n,snippet:a.excerpt||n.snippet,text:a.content||n.text||a.excerpt||n.snippet,excerpt:a.excerpt||n.excerpt,image:a.image||n.image,contentHash:a.contentHash||n.contentHash,wordCount:a.wordCount??n.wordCount,lang:a.lang||n.lang,fromCache:a.fromCache??n.fromCache,rendered:a.rendered??n.rendered,fetchedAt:a.fetchedAt||n.fetchedAt,metadata:{...n.metadata||{},...a.metadata||{}}}:n})}function Ae(t){if(!t)return"";try{return new URL(t).hostname.replace(/^www\./,"")}catch{return""}}function vt(t){if(!t)return"web";const e=t.replace(/[-_]/g," ").trim();return e?e.charAt(0).toUpperCase()+e.slice(1):"web"}function Za({showGraph:t,onToggleGraph:e,query:r,queryKey:n,graphData:a,activeSourceId:i,onSelectSource:o,onOpenSource:d}){const c=a&&Array.isArray(a.nodes)&&a.nodes.some(l=>typeof l?.type=="string"&&l.type.startsWith("research-"));return s.jsxs("section",{className:"rounded-2xl border border-white/10 bg-white/[0.03] px-4 py-4 shadow-inner shadow-black/20",children:[s.jsxs("header",{className:"mb-3 flex flex-wrap items-center justify-between gap-3",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-semibold text-white",children:"Knowledge graph"}),s.jsxs("p",{className:"text-xs text-gray-400",children:["Connections for “",r.slice(0,60),r.length>60?"…":"","” across sources and evidence."]})]}),s.jsx("button",{type:"button",onClick:e,className:"rounded-lg border border-white/10 bg-white/10 px-3 py-1.5 text-xs text-gray-200 hover:border-blue-400/40 hover:text-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-400/40",children:t?"Hide graph":"Show graph"})]}),t?s.jsx(Xn,{query:r,queryKey:n,graphData:a,activeSourceId:i,onSelectSource:o,onOpenSource:d}):s.jsx("div",{className:"rounded-xl border border-dashed border-white/10 bg-white/[0.02] px-4 py-10 text-center text-xs text-gray-400",children:"Graph hidden. Toggle “Show graph” to explore relationships again."}),!c&&t&&s.jsx("div",{className:"mt-3 rounded-lg border border-white/10 bg-blue-500/5 px-3 py-2 text-[11px] text-blue-200",children:"First research run captured. Subsequent questions will layer onto this graph for deeper context."})]})}function ei({verification:t}){return t?s.jsxs("section",{className:"space-y-3 rounded border border-neutral-800 bg-neutral-900/40 p-4",children:[s.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[s.jsx("h3",{className:"text-sm font-semibold text-gray-200",children:"Verification summary"}),s.jsx("span",{className:`rounded border px-2 py-1 text-xs font-medium ${t.verified?"border-emerald-500/40 bg-emerald-500/10 text-emerald-200":"border-amber-500/40 bg-amber-500/10 text-amber-200"}`,children:t.verified?"Pass":"Review suggested"})]}),s.jsxs("div",{className:"grid gap-3 text-xs text-gray-300 sm:grid-cols-4",children:[s.jsx(Be,{label:"Claim density",value:`${t.claimDensity.toFixed(1)} / 100 words`}),s.jsx(Be,{label:"Citation coverage",value:`${t.citationCoverage.toFixed(0)}%`}),s.jsx(Be,{label:"Hallucination risk",value:`${(t.hallucinationRisk*100).toFixed(0)}%`}),s.jsx(Be,{label:"Ungrounded claims",value:`${t.ungroundedClaims.length}`})]}),t.ungroundedClaims.length>0&&s.jsxs("details",{className:"rounded border border-amber-500/20 bg-amber-500/5 px-3 py-2 text-xs text-amber-200",children:[s.jsxs("summary",{className:"cursor-pointer font-semibold text-amber-300",children:["Ungrounded claims (",t.ungroundedClaims.length,")"]}),s.jsx("ul",{className:"mt-2 space-y-1 text-[11px] text-amber-100",children:t.ungroundedClaims.map((e,r)=>s.jsxs("li",{children:[s.jsx("span",{className:"font-medium capitalize",children:e.severity}),": ",e.text]},`${e.position}-${r}`))})]}),t.suggestions.length>0&&s.jsxs("div",{className:"space-y-1 text-xs text-gray-300",children:[s.jsx("h4",{className:"font-semibold text-gray-200",children:"Suggestions"}),s.jsx("ul",{className:"list-inside list-disc space-y-1 text-gray-400",children:t.suggestions.map((e,r)=>s.jsx("li",{children:e},`${e}-${r}`))})]})]}):null}function Be({label:t,value:e}){return s.jsxs("div",{className:"flex flex-col gap-1 rounded border border-neutral-800 bg-neutral-950/60 p-3",children:[s.jsx("span",{className:"text-[11px] uppercase tracking-wide text-gray-500",children:t}),s.jsx("span",{className:"text-sm font-semibold text-gray-200",children:e})]})}function ti(t){if(!t)return"";const e=t.replace(/\s+/g," ").trim();if(!e)return"";const r=e.charAt(0).toUpperCase()+e.slice(1);return/[.!?]$/.test(r)?r:`${r}.`}function ri(t,e){let r="";const n=[],a=[];let i=0;t.forEach((u,h)=>{const x=h>0&&h%2===0;if(h>0){const q=x?`

`:" ";r+=q,i+=q.length}const w=i;r+=u.text;const S=i+u.text.length,m=h+1;n.push({from:w,to:S,citationIndex:m,sourceIndex:u.sourceIndex,quote:u.quote});const p=e[u.sourceIndex],$=p?Math.min(1,Math.max(.2,(p.relevanceScore||40)/80)):.5;a.push({index:m,sourceIndex:u.sourceIndex,quote:u.quote.slice(0,140),confidence:$}),i=S});const o=r.trim(),d=Array.from(new Set(t.map(u=>u.sourceIndex))),c=d.reduce((u,h)=>u+(e[h]?.relevanceScore??50),0)/Math.max(1,d.length),l=Math.max(.35,Math.min(1,c/60*Math.min(1,d.length/3)));return{summary:o,inlineEvidence:n,citations:a,confidence:l}}function si(t){const e=[{url:"https://example.com/research",title:`Overview of ${t}`,text:`Mock content discussing ${t}.`,snippet:`A concise overview of ${t} with supporting context.`,domain:"example.com",relevanceScore:68,sourceType:"documentation",type:"documentation",timestamp:Date.now()-1728e5},{url:"https://knowledge.example.org/article",title:`In-depth analysis of ${t}`,text:`Extended mock analysis for ${t}.`,snippet:`Detailed analysis exploring key aspects of ${t}.`,domain:"knowledge.example.org",relevanceScore:72,sourceType:"academic",type:"academic",timestamp:Date.now()-432e6}],r=e.map((c,l)=>({text:ti(c.snippet||c.text),sourceIndex:l,quote:c.snippet||c.text.slice(0,140)})),{summary:n,inlineEvidence:a,citations:i,confidence:o}=ri(r,e);return{query:t,sources:e,summary:n,citations:i,confidence:o,verification:{verified:!0,claimDensity:8.5,citationCoverage:92,ungroundedClaims:[],hallucinationRisk:.1,suggestions:["Mock verification successful."]},inlineEvidence:a}}function Ur(t){let e=0;for(let r=0;r<t.length;r+=1)e=(e<<5)-e+t.charCodeAt(r),e|=0;return Math.abs(e).toString(36)}function lr(t){return`research-query:${Ur(t.slice(0,256))}`}function We(t,e){return t?.url?t.url:`research-source:${e}:${Ur(t?.title||String(e))}`}function dr(t,e){return`${t}#evidence:${e}`}function Fr(t){return!t||t.length===0?t:t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}const wi=Object.freeze(Object.defineProperty({__proto__:null,default:Ua},Symbol.toStringTag,{value:"Module"}));export{fi as A,Mn as V,Fs as a,un as b,Sr as c,Us as d,Ps as e,ye as f,gi as g,hi as h,mi as i,xi as j,bi as k,M as l,pi as m,yi as n,wi as o,$e as s,Se as t,yn as u};
//# sourceMappingURL=mode-research-BclgCwOH.js.map
