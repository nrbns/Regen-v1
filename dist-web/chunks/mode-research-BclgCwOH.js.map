{"version":3,"mappings":"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","names":["Logger","__publicField","level","_args","timestamp","args","log","AnalyticsService","name","data","event","e","enabled","_event","analytics","track","MEILI_URL","MASTER_KEY","ensureIndex","index","primaryKey","createRes","err","error","errorMsg","indexDocuments","docs","batches","tasks","batch","jsonString","sizeMB","i","miniBatch","task","indexBatch","res","multiSearch","queries","checkMeiliSearch","useDebounce","value","delay","debouncedValue","setDebouncedValue","useState","useEffect","handler","generateId","useToastStore","create","set","type","message","options","state","id","toast","showToast","flatten","values","result","cn","inputs","MemoryCache","maxSize","ttl","key","entry","now","firstKey","DB_NAME","STORE_NAME","DB_VERSION","DiskCache","resolve","reject","request","db","deleted","cursor","CacheManager","memorySize","defaultOptions","opts","memoryValue","diskValue","cacheManager","MetricsCollector","unit","tags","metric","filtered","m","scrapeAvg","sum","agentAvg","agentSuccessRate","metricsCollector","Tracer","spanId","parentId","span","parent","s","tracer","traceFunction","fn","ToolRegistry","tool","toolRegistry","input","url","cacheKey","cached","startTime","duration","text","maxLength","summary","query","maxResults","_","DEFAULT_CAPABILITIES","useCapabilityStore","persist","get","capability","hasCapability","getCapabilityDescriptions","requireCapability","ToolRegistryV2","category","ctx","validatedInput","output","z.ZodError","limit","limiter","toolRegistryV2","z.object","z.string","z.enum","z.number","_ctx","v1Tool","v1Registry","z.array","_input","z.boolean","z.any","ipc","__vitePreload","n","useTabsStore","typedInput","newTab","tabId","useWorkspacesStore","useAppStore","tabs","mode","shimmerAnimation","LoadingSkeleton","variant","lines","className","children","jsx","motion","jsxs","AIThinkingSkeleton","StagehandAPI","context","sessionId","selector","el","label","timeout","element","_direction","attribute","script","actions","results","action","createStagehand","useStagehand","stagehand","useMemo","execute","useCallback","click","wait","extract","navigate","healthCache","healthCheckInterval","checkSearchHealth","health","meiliAvailable","getSearchHealth","startSearchHealthMonitoring","intervalMs","verifySearchSystem","DEFAULT_RESULT_SCORE","multiSourceSearch","response","normalizeHybridResults","item","domain","deriveDomain","score","payload","isHybridResult","candidates","fetchBingSearch","apiKey","count","offset","market","errorData","bingData","formatBingResults","LANGUAGE_LOCALE_MAP","getDuckLocale","lang","fetchDuckDuckGoInstant","language","cleanQuery","invoke","locale","langCode","controller","timeoutId","shortQuery","fetchError","formatDuckDuckGoResults","formatted","rt","fetchDuckDuckGoWeb","searchUrl","html","instantResult","f","tauriError","linkRegex","snippetRegex","match","links","snippets","title","snippet","fullUrl","urlMatch","performLiveWebSearch","bingResults","idx","duckResults","isLiveWebSearchAvailable","bingKey","INDIC_LANGUAGES","LANGUAGE_PATTERNS","isIndicLanguage","detectLanguageClient","scores","patterns","pattern","matches","detectedLang","a","b","maxScore","confidence","detectLanguageIndicBERT","detectLanguagemBART","detectLanguage","trimmedText","preferIndic","indicResult","mbartResult","DEFAULT_META","META_MAP","getLanguageMeta","code","normalized","getSpeechRecognitionLocale","LANGUAGE_LABELS","VoiceButton","onResult","small","active","setActive","isAvailable","setIsAvailable","isProcessing","setIsProcessing","recogRef","useRef","animationRef","useSettingsStore","langLabel","languageMeta","SR","r","t","stopWaveformAnimation","start","startWaveformAnimation","animate","Fragment","Mic","MicOff","ResearchStagehandIntegration","loadIndex","documents","lunr","searchLocal","h","d","DEFAULT_TIMEOUT","DEFAULT_COUNT","optimizedSearch","normalizedQuery","preferProvider","searchPromises","urlObj","settled","allResults","seenUrls","deduplicated","getFallbackResults","fallbackProvider","BLOCKED_HOSTS","ALLOWED_PROTOCOLS","isUrlSafe","urlString","isPrivateIP","hostname","validateUrlForAgent","API_BASE","scrapeResearchSources","urls","_options","safeUrls","blockedUrls","validation","reason","oldFormat","LANGUAGE_KEYWORDS","LANGUAGE_CODE_MAP","RESEARCH_TRIGGERS","parseResearchVoiceCommand","lowerText","originalText","trigger","detectedLanguage","inPattern","inMatch","langKeyword","findLanguageCode","langName","keywords","keyword","aboutPattern","aboutMatch","lowerKeyword","k","extractSummary","minLength","sentences","sentence","words","word","summarizeOffline","pipeline","extracted","WIDTH","HEIGHT","COLORS","allowedType","buildLayout","graphData","queryKey","nodes","edges","nodeMap","node","filteredEdges","edge","sourceNode","targetNode","includeKeys","changed","subsetNodes","subsetEdges","positions","center","sourceNodes","evidenceNodes","radius","angleStep","baseAngle","angle","x","y","childrenBySource","src","dst","entries","parentEdge","parentKey","jitterRadius","parentPosition","siblings","spread","baseDirection","childRadius","laidOutNodes","laidOutEdges","ResearchGraphView","activeSourceId","onSelectSource","onOpenSource","layout","containerRef","hover","setHover","handleNodeActivate","sourceKey","fragmentUrl","getNodeRadius","getNodeColor","getEdgeStyle","sourceType","targetType","style","position","color","rect","scaleX","scaleY","SOURCE_LABEL","BADGE_STYLE","SourceCard","source","isActive","onActivate","onOpen","expanded","setExpanded","provider","relevance","canOpen","fetchedAtLabel","languageLabel","selectorMatched","preview","handleActivate","Sparkles","Info","ExternalLink","prev","ChevronUp","ChevronDown","AnswerWithCitations","citations","inlineEvidence","sources","onExport","hoveredCitation","setHoveredCitation","exporting","setExporting","renderedText","part","citationIndex","citation","c","CitationMarker","parts","lastPos","evidence","handleExport","format","_exportData","markdown","blob","FileText","Download","isHovered","onHover","EvidenceOverlay","activeEvidenceId","_onEvidenceClick","activeId","highlightRefs","cleanup","activeEvidence","activeTab","sourceUrl","tabUrl","_highlightScript","CompareAnswersPanel","open","answers","selectedIds","onToggleSelect","onClose","onRemove","selectedAnswers","answer","overlapStats","first","second","firstDomains","secondDomains","differenceSummary","extractUniqueSentences","AnimatePresence","ChevronLeft","isSelected","Shield","Trash2","Calendar","StatBlock","formatPercent","Layers","diff","ownerA","ownerB","sentencesA","normalizeSentences","sentencesB","setA","setB","uniques","paragraph","LayoutContext","createContext","useLayout","useContext","LayoutEngine","sidebarWidth","navHeight","rightPanelWidth","props","LayoutHeader","sticky","LayoutBody","sidebar","rightPanel","sidebarCollapsed","rightPanelCollapsed","MAX_ENTRIES","useResearchCompareStore","_get","newEntry","existing","runDeepScan","errorText","CursorChat","pageSnapshot","editorState","messages","setMessages","setInput","isStreaming","setIsStreaming","hasApiKey","setHasApiKey","showSettings","setShowSettings","apiKeyInput","setApiKeyInput","currentJobId","setCurrentJobId","messagesEndRef","abortControllerRef","checkApiKey","handleStream","chunk","last","handleSetApiKey","handleSubmit","question","userMessage","assistantMessage","handleCancel","handleClearHistory","Loader2","Bot","Code","Settings","X","msg","cite","Send","AlertCircle","runAgent","handleQuickSummary","handleDeepResearch","handleCompareUrls","handleExplainPage","scrapeTool","scraped","summarizeTool","maxSources","searchTool","searchResults","AgentTaskGraph","goal","plan","memory","previousResults","nodeStartTime","resolvedInput","toolHandler","errorMessage","retryResult","totalDuration","success","finalOutput","mergedInput","sourceNodeId","sourceOutput","agentTaskGraph","useMemoryStore","newItem","updates","AgentMemoryImpl","preferences","researchTopics","p","summaryFormats","mostCommon","agentMemory","planFromGoal","goalLower","createResearchComparePlan","createSummaryPlan","createExtractDatesPlan","createSimplePlan","extractQuery","extractUrl","executePlanFromGoal","initializeAgentSystem","tools","executeAgentGoal","OmniAgentInput","currentUrl","setQuery","loading","setLoading","urlMatches","useResearchWS","jobId","setState","wsRef","reconnectTimeoutRef","reconnectAttempts","maxReconnectAttempts","connect","protocol","host","wsUrl","ws","subscribeMsg","newEvents","newState","generateFollowUpSuggestions","suggestions","lowerQuery","lowerAnswer","injectCitations","num","AnswerSkeleton","RegenResearchPanel","setMaxSources","_isPaused","_setIsPaused","followUpSuggestions","setFollowUpSuggestions","agentMode","setAgentMode","isInitialLoad","setIsInitialLoad","answerRef","sourcesEndRef","currentMode","setMode","wsState","step","handleSearch","researchApi","handleFollowUp","followUpQuery","handleSuggestionClick","suggestion","handleSourceClick","Globe","TrendingUp","Search","Brain","Zap","followUp","LANGUAGE_METADATA","MultiLanguageAI","detected","targetLang","sourceLang","translated","languages","searchQuery","_query","_language","multiLanguageAI","ResearchPanel","setResult","setError","_loadingMessage","setLoadingMessage","setDetectedLang","setActiveSourceId","includeCounterpoints","setIncludeCounterpoints","authorityBias","setAuthorityBias","region","setRegion","setGraphData","showGraph","setShowGraph","setActiveEvidenceId","autocompleteSuggestions","setAutocompleteSuggestions","showAutocomplete","setShowAutocomplete","autocompleteLoading","setAutocompleteLoading","uploadedDocuments","setUploadedDocuments","uploading","setUploading","fileInputRef","autocompleteRef","useHybridSearch","containers","activeContainerId","setContainers","useContainerStore","graphSignatureRef","debouncedQuery","compareEntries","addCompareEntry","removeCompareEntry","comparePanelOpen","setComparePanelOpen","compareSelection","setCompareSelection","cursorPanelOpen","setCursorPanelOpen","aiMetaRef","deepScanEnabled","setDeepScanEnabled","deepScanLoading","setDeepScanLoading","deepScanSteps","setDeepScanSteps","deepScanError","setDeepScanError","useEnhancedView","setUseEnhancedView","list","handleWisprResearch","researchQuery","handleHandoff","handoffQuery","symbol","_handoffLanguage","recencyWeight","authorityWeight","refreshGraph","snapshot","aggregatedSources","aggregatedProviderNames","scrapedSnapshots","streamedText","streamedResult","aiResult","aiEngine","finalResult","finalAnswer","sourceTexts","offlineSummary","concepts","concept","trimmed","graphError","citationType","inferSourceType","doc","localResults","lr","localError","inlineCitations","dedupedSources","dedupeResearchSources","aiError","providerLabel","formatProviderName","dedupedAggregated","topTitles","scrapedSummary","duckResult","extractDomain","handleToggleCompareSelection","entryId","handleRemoveCompare","handleSaveForCompare","saved","runDeepScanFlow","buildSearchContext","tab","relevantMemories","semanticSearchMemories","buildQueryKey","handleFileUpload","files","newDocuments","file","fileType","fileName","extractedText","parsePdfFile","parseDocxFile","handleRemoveDocument","telemetryMetrics","searchStartTime","detection","fallbackError","currentLang","englishQuery","searchHealth","generateMockResult","deepScanResult","mapDeepScanSourceToResearchSource","backendResult","isTauri","tauriResult","isWebMode","multiSourceResults","hit","mapMultiSourceResultToSource","urlsToScrape","mergeScrapedSnapshots","multiSourceError","liveResults","liveSearchError","hallucination","hallucinationRisk","citationCoverage","searchLatency","streamCitations","streamHallucination","handleToken","handleMetrics","handleEnd","streamError","optimizedResults","localSources","handleQuickstart","detail","signature","currentQueryKey","queryEdges","buildSourceKey","relatedEvidence","evidenceEdges","buildEvidenceKey","evidenceKey","contradiction","rest","baseSource","baseKey","targetIdx","targetSource","targetKey","handleOpenUrl","handleRunExample","example","isOffline","hasResults","history","handleClickOutside","ActiveContainerBadge","effectiveLang","Upload","parsed","settingsStore","ResearchControls","DeepScanStatus","ResearchResultView","ResearchGraphSection","EmptyState","InsightsSidebar","REGION_OPTIONS","onAuthorityBiasChange","onIncludeCounterpointsChange","onRegionChange","onDeepScanToggle","option","steps","onActiveSourceChange","onSaveForCompare","onShowCompare","compareCount","confidencePercent","verification","getSourceKey","sourceIndex","VerificationSummary","SourcesList","importanceLabel","topEvidence","contradictions","activeEvidenceKey","RefreshCcw","severity","firstSource","ChevronRight","capitalize","chain","activeContainer","container","onRunExample","minimal","langConfidence","setLangConfidence","examples","welcomeText","providerCounts","acc","providerSummary","NEWS_DOMAIN_HINTS","FORUM_DOMAIN_HINTS","DOCUMENTATION_DOMAIN_HINTS","baseScore","extendedMeta","parsedTimestamp","hint","seen","normalizeSourceUrl","snapshots","snapshotMap","candidate","onToggleGraph","hasGraphData","Metric","claim","normaliseMockSnippet","cleaned","composeMockSummary","segments","summaryBuilder","segment","isNewParagraph","separator","from","to","uniqueSources","avgRelevance","mockSources","simpleHash","hash","str"],"ignoreList":[],"sources":["../../src/utils/logger.ts","../../src/services/analytics.ts","../../src/lib/meili.ts","../../src/utils/useDebounce.ts","../../src/state/toastStore.ts","../../src/lib/utils.ts","../../src/core/cache/memory-cache.ts","../../src/core/cache/disk-cache.ts","../../src/core/cache/cache-manager.ts","../../src/core/observability/metrics.ts","../../src/core/observability/tracer.ts","../../src/agent/registry.ts","../../src/core/security/capabilities.ts","../../src/core/agent/tools/v2.ts","../../src/components/common/LoadingSkeleton.tsx","../../src/utils/stagehand-api.ts","../../src/hooks/useStagehand.ts","../../src/services/searchHealth.ts","../../src/services/multiSourceSearch.ts","../../src/services/bingSearch.ts","../../src/services/duckDuckGoSearch.ts","../../src/services/liveWebSearch.ts","../../src/services/languageDetection.ts","../../src/constants/languageMeta.ts","../../src/components/VoiceButton.tsx","../../src/modes/research/stagehand-integration.tsx","../../src/utils/lunrIndex.ts","../../src/services/optimizedSearch.ts","../../src/core/security/urlSafety.ts","../../src/services/researchScraper.ts","../../src/utils/voiceCommandParser.ts","../../src/services/offlineSummarizer.ts","../../src/components/research/ResearchGraphView.tsx","../../src/components/research/SourceCard.tsx","../../src/components/research/AnswerWithCitations.tsx","../../src/components/research/EvidenceOverlay.tsx","../../src/components/research/CompareAnswers.tsx","../../src/ui/layout-engine.tsx","../../src/state/researchCompareStore.ts","../../src/services/deepScan.ts","../../src/components/cursor/CursorChat.tsx","../../src/agent/runAgent.ts","../../src/core/agent/graph.ts","../../src/core/agent/memory.ts","../../src/core/agent/planner.ts","../../src/core/agent/integration.ts","../../src/components/OmniAgentInput.tsx","../../src/hooks/useResearchWS.ts","../../src/components/research/RegenResearchPanel.tsx","../../src/core/language/multiLanguageAI.ts","../../src/modes/research/index.tsx"],"sourcesContent":["/**\n * Centralized Logging - Tier 1\n * Wrapper for console logs with consistent formatting\n */\n\ntype LogLevel = 'info' | 'warn' | 'error' | 'debug';\n\nclass Logger {\n  private prefix = '[OMNI]';\n\n  private formatMessage(level: LogLevel, ..._args: unknown[]): string {\n    const timestamp = new Date().toISOString();\n    return `${this.prefix} [${timestamp}] [${level.toUpperCase()}]`;\n  }\n\n  info(...args: unknown[]) {\n    console.log(this.formatMessage('info'), ...args);\n  }\n\n  warn(...args: unknown[]) {\n    console.warn(this.formatMessage('warn'), ...args);\n  }\n\n  error(...args: unknown[]) {\n    console.error(this.formatMessage('error'), ...args);\n  }\n\n  debug(...args: unknown[]) {\n    if (process.env.NODE_ENV === 'development') {\n      console.debug(this.formatMessage('debug'), ...args);\n    }\n  }\n}\n\nexport const log = new Logger();\n","/**\n * Analytics Service - Tier 2\n * Event logging for user behavior tracking\n */\n\nexport type EventName =\n  | 'app_open'\n  | 'app_close'\n  | 'tab_created'\n  | 'tab_closed'\n  | 'tab_switched'\n  | 'bookmark_added'\n  | 'bookmark_removed'\n  | 'workspace_saved'\n  | 'workspace_restored'\n  | 'workspace_deleted'\n  | 'summary_requested'\n  | 'agent_task_started'\n  | 'agent_task_completed'\n  | 'agent_task_failed'\n  | 'settings_changed'\n  | 'mode_switched'\n  | 'error_shown'\n  | 'feedback_submitted'\n  | 'command_bar_opened'\n  | 'command_bar_executed'\n  | 'plugin_registered'\n  | 'plugin_enabled'\n  | 'plugin_disabled'\n  | 'auth_session_restored'\n  | 'auth_magic_link_requested'\n  | 'auth_device_code_requested'\n  | 'auth_magic_link_verified'\n  | 'auth_device_code_verified'\n  | 'auth_anonymous_session_created'\n  | 'auth_signed_out'\n  | 'sync_enabled'\n  | 'sync_disabled'\n  | 'sync_pushed'\n  | 'sync_conflicts'\n  | 'sync_completed'\n  | 'sync_failed';\n\nexport type AnalyticsEvent = {\n  name: EventName;\n  timestamp: number;\n  data?: Record<string, unknown>;\n};\n\nclass AnalyticsService {\n  private events: AnalyticsEvent[] = [];\n  private maxEvents = 1000;\n  private enabled = true;\n\n  /**\n   * Track an event\n   */\n  track(name: EventName, data?: Record<string, unknown>): void {\n    if (!this.enabled) return;\n\n    const event: AnalyticsEvent = {\n      name,\n      timestamp: Date.now(),\n      data,\n    };\n\n    this.events.push(event);\n\n    // Trim if over limit\n    if (this.events.length > this.maxEvents) {\n      this.events.shift();\n    }\n\n    // Log to console in dev\n    if (process.env.NODE_ENV === 'development') {\n      console.log('[ANALYTICS]', event);\n    }\n\n    // In production, could send to backend\n    // this.sendToBackend(event).catch(console.error);\n  }\n\n  /**\n   * Get all events\n   */\n  getEvents(): AnalyticsEvent[] {\n    return [...this.events];\n  }\n\n  /**\n   * Get events by name\n   */\n  getEventsByName(name: EventName): AnalyticsEvent[] {\n    return this.events.filter(e => e.name === name);\n  }\n\n  /**\n   * Clear all events\n   */\n  clear(): void {\n    this.events = [];\n  }\n\n  /**\n   * Enable/disable analytics\n   */\n  setEnabled(enabled: boolean): void {\n    this.enabled = enabled;\n  }\n\n  /**\n   * Send events to backend (for future implementation)\n   */\n  private async sendToBackend(_event: AnalyticsEvent): Promise<void> {\n    try {\n      // In production, POST to /api/analytics\n      // await fetch('/api/analytics', {\n      //   method: 'POST',\n      //   headers: { 'Content-Type': 'application/json' },\n      //   body: JSON.stringify(event),\n      // });\n    } catch (error) {\n      console.error('[Analytics] Failed to send event to backend', error);\n    }\n  }\n\n  /**\n   * Flush all events to backend\n   */\n  async flush(): Promise<void> {\n    if (this.events.length === 0) return;\n\n    const _eventsToSend = [...this.events];\n    this.events = [];\n\n    // In production, batch send\n    // await fetch('/api/analytics/batch', {\n    //   method: 'POST',\n    //   headers: { 'Content-Type': 'application/json' },\n    //   body: JSON.stringify({ events: eventsToSend }),\n    // });\n  }\n}\n\n// Singleton instance\nexport const analytics = new AnalyticsService();\n\n// Convenience function\nexport function track(name: EventName, data?: Record<string, unknown>): void {\n  analytics.track(name, data);\n}\n","// MeiliSearch Client - Proper Indexing & Search\r\n// Fixes: 429 errors, stuck tasks, wrong URLs, encoding issues\r\n\r\nconst MEILI_URL = 'http://127.0.0.1:7700';\r\nconst MASTER_KEY = 'regen2026'; // Match the key in main.rs (can also use \"regen123\")\r\n\r\nexport interface MeiliDocument {\r\n  id: string | number;\r\n  [key: string]: any;\r\n}\r\n\r\nexport interface MeiliTask {\r\n  taskUid: number;\r\n  status: string;\r\n  type: string;\r\n}\r\n\r\n/**\r\n * Create index if it doesn't exist\r\n */\r\nexport async function ensureIndex(index: string, primaryKey: string = 'id'): Promise<void> {\r\n  try {\r\n    // Check if index exists\r\n    const checkRes = await fetch(`${MEILI_URL}/indexes/${index}`, {\r\n      headers: {\r\n        'X-Meili-API-Key': MASTER_KEY,\r\n      },\r\n    });\r\n\r\n    if (checkRes.ok) {\r\n      console.log(`[MeiliSearch] Index \"${index}\" already exists`);\r\n      return;\r\n    }\r\n\r\n    // Create index\r\n    const createRes = await fetch(`${MEILI_URL}/indexes`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'X-Meili-API-Key': MASTER_KEY,\r\n      },\r\n      body: JSON.stringify({\r\n        uid: index,\r\n        primaryKey: primaryKey,\r\n      }),\r\n    });\r\n\r\n    if (!createRes.ok) {\r\n      const err = await createRes.text();\r\n      throw new Error(`Failed to create index: ${err}`);\r\n    }\r\n\r\n    console.log(`[MeiliSearch] Created index \"${index}\"`);\r\n  } catch (error) {\r\n    // Suppress MeiliSearch errors - it's optional and may not be running\r\n    // Only log if it's not an auth/connection error\r\n    const errorMsg = String(error);\r\n    if (\r\n      !errorMsg.includes('401') &&\r\n      !errorMsg.includes('Unauthorized') &&\r\n      !errorMsg.includes('missing_authorization')\r\n    ) {\r\n      console.error(`[MeiliSearch] Error ensuring index \"${index}\":`, error);\r\n    }\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Index documents in safe batches (max 900 per batch, max 10MB)\r\n */\r\nexport async function indexDocuments(\r\n  index: string,\r\n  docs: MeiliDocument[],\r\n  primaryKey: string = 'id'\r\n): Promise<MeiliTask[]> {\r\n  if (!docs || docs.length === 0) {\r\n    console.warn(`[MeiliSearch] No documents to index for \"${index}\"`);\r\n    return [];\r\n  }\r\n\r\n  // Ensure index exists\r\n  await ensureIndex(index, primaryKey);\r\n\r\n  // Split into safe batches (max 900 docs per batch)\r\n  const batches: MeiliDocument[][] = [];\r\n  for (let i = 0; i < docs.length; i += 900) {\r\n    batches.push(docs.slice(i, i + 900));\r\n  }\r\n\r\n  const tasks: MeiliTask[] = [];\r\n\r\n  for (const batch of batches) {\r\n    try {\r\n      // Validate JSON size (max 10MB)\r\n      const jsonString = JSON.stringify(batch);\r\n      const sizeMB = new Blob([jsonString]).size / (1024 * 1024);\r\n\r\n      if (sizeMB > 10) {\r\n        console.warn(\r\n          `[MeiliSearch] Batch too large (${sizeMB.toFixed(2)}MB), splitting further...`\r\n        );\r\n        // Split this batch even smaller\r\n        for (let i = 0; i < batch.length; i += 100) {\r\n          const miniBatch = batch.slice(i, i + 100);\r\n          const task = await indexBatch(index, miniBatch);\r\n          tasks.push(task);\r\n        }\r\n        continue;\r\n      }\r\n\r\n      const task = await indexBatch(index, batch);\r\n      tasks.push(task);\r\n    } catch (error) {\r\n      console.error(`[MeiliSearch] Failed to index batch:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  console.log(`[MeiliSearch] Indexed ${docs.length} documents in ${batches.length} batch(es)`);\r\n  return tasks;\r\n}\r\n\r\n/**\r\n * Index a single batch of documents\r\n */\r\nasync function indexBatch(index: string, batch: MeiliDocument[]): Promise<MeiliTask> {\r\n  const res = await fetch(`${MEILI_URL}/indexes/${index}/documents`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'X-Meili-API-Key': MASTER_KEY,\r\n    },\r\n    body: JSON.stringify(batch),\r\n  });\r\n\r\n  if (!res.ok) {\r\n    const err = await res.text();\r\n    console.error(`[MeiliSearch] Indexing failed:`, err);\r\n    throw new Error(`MeiliSearch indexing failed: ${err}`);\r\n  }\r\n\r\n  const task = (await res.json()) as MeiliTask;\r\n  console.log(`[MeiliSearch] Enqueued task ${task.taskUid}  ${batch.length} docs`);\r\n\r\n  return task;\r\n}\r\n\r\n/**\r\n * Wait for task to complete\r\n */\r\nexport async function waitForTask(taskUid: number, timeout: number = 5000): Promise<boolean> {\r\n  const startTime = Date.now();\r\n\r\n  while (Date.now() - startTime < timeout) {\r\n    try {\r\n      const res = await fetch(`${MEILI_URL}/tasks/${taskUid}`, {\r\n        headers: {\r\n          'X-Meili-API-Key': MASTER_KEY,\r\n        },\r\n      });\r\n\r\n      if (!res.ok) {\r\n        return false;\r\n      }\r\n\r\n      const task = await res.json();\r\n\r\n      if (task.status === 'succeeded') {\r\n        console.log(`[MeiliSearch] Task ${taskUid} succeeded`);\r\n        return true;\r\n      }\r\n\r\n      if (task.status === 'failed') {\r\n        console.error(`[MeiliSearch] Task ${taskUid} failed:`, task.error);\r\n        return false;\r\n      }\r\n\r\n      // Still processing, wait a bit\r\n      await new Promise(resolve => setTimeout(resolve, 200));\r\n    } catch (error) {\r\n      console.error(`[MeiliSearch] Error checking task ${taskUid}:`, error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  console.warn(`[MeiliSearch] Task ${taskUid} timeout after ${timeout}ms`);\r\n  return false;\r\n}\r\n\r\n/**\r\n * Search documents\r\n */\r\nexport async function searchDocuments(\r\n  index: string,\r\n  query: string,\r\n  options?: {\r\n    limit?: number;\r\n    offset?: number;\r\n    filter?: string;\r\n    sort?: string[];\r\n  }\r\n): Promise<{ hits: any[]; estimatedTotalHits: number; processingTimeMs: number }> {\r\n  try {\r\n    const searchParams = new URLSearchParams({\r\n      q: query,\r\n      limit: String(options?.limit || 20),\r\n      offset: String(options?.offset || 0),\r\n    });\r\n\r\n    if (options?.filter) {\r\n      searchParams.append('filter', options.filter);\r\n    }\r\n\r\n    if (options?.sort) {\r\n      searchParams.append('sort', JSON.stringify(options.sort));\r\n    }\r\n\r\n    const res = await fetch(`${MEILI_URL}/indexes/${index}/search?${searchParams}`, {\r\n      headers: {\r\n        'X-Meili-API-Key': MASTER_KEY,\r\n      },\r\n    });\r\n\r\n    if (!res.ok) {\r\n      const err = await res.text();\r\n      throw new Error(`MeiliSearch search failed: ${err}`);\r\n    }\r\n\r\n    const result = await res.json();\r\n    return result;\r\n  } catch (error) {\r\n    console.error(`[MeiliSearch] Search error:`, error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Multi-search across multiple indexes\r\n */\r\nexport async function multiSearch(\r\n  queries: Array<{\r\n    indexUid: string;\r\n    q: string;\r\n    limit?: number;\r\n    filter?: string;\r\n    sort?: string[];\r\n  }>\r\n): Promise<{\r\n  results: Array<{\r\n    indexUid: string;\r\n    hits: any[];\r\n    estimatedTotalHits: number;\r\n    processingTimeMs: number;\r\n  }>;\r\n}> {\r\n  try {\r\n    const res = await fetch(`${MEILI_URL}/multi-search`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'X-Meili-API-Key': MASTER_KEY,\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({ queries }),\r\n    });\r\n\r\n    if (!res.ok) {\r\n      const err = await res.text();\r\n      throw new Error(`MeiliSearch multi-search failed: ${err}`);\r\n    }\r\n\r\n    const result = await res.json();\r\n    return result;\r\n  } catch (error) {\r\n    console.error(`[MeiliSearch] Multi-search error:`, error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete documents\r\n */\r\nexport async function deleteDocuments(\r\n  index: string,\r\n  documentIds: (string | number)[]\r\n): Promise<MeiliTask> {\r\n  const res = await fetch(`${MEILI_URL}/indexes/${index}/documents/delete-batch`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'X-Meili-API-Key': MASTER_KEY,\r\n    },\r\n    body: JSON.stringify(documentIds),\r\n  });\r\n\r\n  if (!res.ok) {\r\n    const err = await res.text();\r\n    throw new Error(`MeiliSearch delete failed: ${err}`);\r\n  }\r\n\r\n  return (await res.json()) as MeiliTask;\r\n}\r\n\r\n/**\r\n * Check if MeiliSearch is running\r\n */\r\nexport async function checkMeiliSearch(): Promise<boolean> {\r\n  try {\r\n    const res = await fetch(`${MEILI_URL}/health`, {\r\n      method: 'GET',\r\n    });\r\n    return res.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n","/**\n * useDebounce hook - Telepathy Upgrade Phase 1\n * Debounce value changes for performance\n */\n\nimport { useEffect, useState } from 'react';\n\nexport function useDebounce<T>(value: T, delay: number): T {\n  const [debouncedValue, setDebouncedValue] = useState<T>(value);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      setDebouncedValue(value);\n    }, delay);\n\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [value, delay]);\n\n  return debouncedValue;\n}\n","import { create } from 'zustand';\n\ntype ToastType = 'info' | 'success' | 'error' | 'warning';\n\nexport type ToastItem = {\n  id: string;\n  type: ToastType;\n  message: string;\n  timestamp: number;\n  duration?: number; // Optional duration (0 = persistent)\n};\n\ntype ToastState = {\n  toasts: ToastItem[];\n  show: (toast: Omit<ToastItem, 'id' | 'timestamp'>, options?: { duration?: number }) => void;\n  dismiss: (id: string) => void;\n};\n\nconst generateId = () => {\n  if (typeof crypto !== 'undefined' && 'randomUUID' in crypto) {\n    return crypto.randomUUID();\n  }\n  return Math.random().toString(36).slice(2);\n};\n\nexport const useToastStore = create<ToastState>(set => ({\n  toasts: [],\n  show: ({ type, message }, options) =>\n    set(state => {\n      const id = generateId();\n      const toast: ToastItem = {\n        id,\n        type,\n        message,\n        timestamp: Date.now(),\n        duration: options?.duration,\n      };\n\n      // Auto-dismiss if duration is set (and not 0)\n      if (options?.duration && options.duration > 0) {\n        setTimeout(() => {\n          useToastStore.getState().dismiss(id);\n        }, options.duration);\n      }\n\n      return {\n        toasts: [...state.toasts, toast].slice(-4),\n      };\n    }),\n  dismiss: id =>\n    set(state => ({\n      toasts: state.toasts.filter(toast => toast.id !== id),\n    })),\n}));\n\nexport function showToast(type: ToastType, message: string, options?: { duration?: number }) {\n  useToastStore.getState().show({ type, message }, options);\n}\n","/**\r\n * Utility helpers shared across UI layers.\r\n */\r\n\r\ntype ClassValue = string | number | null | undefined | false | ClassValue[];\r\n\r\nfunction flatten(values: ClassValue[]): string[] {\r\n  const result: string[] = [];\r\n  values.forEach((value) => {\r\n    if (!value) {\r\n      return;\r\n    }\r\n    if (Array.isArray(value)) {\r\n      result.push(...flatten(value));\r\n    } else {\r\n      result.push(String(value));\r\n    }\r\n  });\r\n  return result;\r\n}\r\n\r\nexport function cn(...inputs: ClassValue[]): string {\r\n  return flatten(inputs)\r\n    .filter((value) => value.trim().length > 0)\r\n    .join(' ');\r\n}\r\n\r\n","/**\r\n * In-Memory LRU Cache - Tier 2\r\n * Fast, size-limited cache for frequently accessed data\r\n */\r\n\r\nexport interface CacheEntry<T> {\r\n  value: T;\r\n  timestamp: number;\r\n  accessCount: number;\r\n  lastAccessed: number;\r\n}\r\n\r\nexport class MemoryCache<T = unknown> {\r\n  private cache: Map<string, CacheEntry<T>> = new Map();\r\n  private maxSize: number;\r\n  private ttl?: number; // Time to live in milliseconds\r\n\r\n  constructor(maxSize: number = 100, ttl?: number) {\r\n    this.maxSize = maxSize;\r\n    this.ttl = ttl;\r\n  }\r\n\r\n  /**\r\n   * Get value from cache\r\n   */\r\n  get(key: string): T | null {\r\n    const entry = this.cache.get(key);\r\n\r\n    if (!entry) {\r\n      return null;\r\n    }\r\n\r\n    // Check TTL\r\n    if (this.ttl && Date.now() - entry.timestamp > this.ttl) {\r\n      this.cache.delete(key);\r\n      return null;\r\n    }\r\n\r\n    // Update access stats\r\n    entry.accessCount++;\r\n    entry.lastAccessed = Date.now();\r\n\r\n    // Move to end (LRU)\r\n    this.cache.delete(key);\r\n    this.cache.set(key, entry);\r\n\r\n    return entry.value;\r\n  }\r\n\r\n  /**\r\n   * Set value in cache\r\n   */\r\n  set(key: string, value: T): void {\r\n    // Remove if exists\r\n    this.cache.delete(key);\r\n\r\n    // Add new entry\r\n    const now = Date.now();\r\n    this.cache.set(key, {\r\n      value,\r\n      timestamp: now,\r\n      accessCount: 0,\r\n      lastAccessed: now,\r\n    });\r\n\r\n    // Evict oldest if over limit\r\n    if (this.cache.size > this.maxSize) {\r\n      const firstKey = this.cache.keys().next().value;\r\n      if (firstKey) {\r\n        this.cache.delete(firstKey);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if key exists and is valid\r\n   */\r\n  has(key: string): boolean {\r\n    const entry = this.cache.get(key);\r\n    if (!entry) return false;\r\n\r\n    // Check TTL\r\n    if (this.ttl && Date.now() - entry.timestamp > this.ttl) {\r\n      this.cache.delete(key);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Delete key from cache\r\n   */\r\n  delete(key: string): boolean {\r\n    return this.cache.delete(key);\r\n  }\r\n\r\n  /**\r\n   * Clear all cache\r\n   */\r\n  clear(): void {\r\n    this.cache.clear();\r\n  }\r\n\r\n  /**\r\n   * Get cache stats\r\n   */\r\n  getStats() {\r\n    return {\r\n      size: this.cache.size,\r\n      maxSize: this.maxSize,\r\n      entries: Array.from(this.cache.entries()).map(([key, entry]) => ({\r\n        key,\r\n        accessCount: entry.accessCount,\r\n        age: Date.now() - entry.timestamp,\r\n        lastAccessed: entry.lastAccessed,\r\n      })),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get all keys\r\n   */\r\n  keys(): string[] {\r\n    return Array.from(this.cache.keys());\r\n  }\r\n}\r\n","/**\r\n * Persistent Disk Cache - Tier 2\r\n * Uses IndexedDB for persistent storage with TTL support\r\n */\r\n\r\nexport interface DiskCacheEntry<T> {\r\n  value: T;\r\n  timestamp: number;\r\n  ttl?: number;\r\n}\r\n\r\nconst DB_NAME = 'regen_cache';\r\nconst STORE_NAME = 'cache_entries';\r\nconst DB_VERSION = 1;\r\n\r\nexport class DiskCache<T = unknown> {\r\n  private db: IDBDatabase | null = null;\r\n  private initPromise: Promise<void> | null = null;\r\n\r\n  constructor() {\r\n    this.initPromise = this.init();\r\n  }\r\n\r\n  private async init(): Promise<void> {\r\n    return new Promise((resolve, reject) => {\r\n      const request = indexedDB.open(DB_NAME, DB_VERSION);\r\n\r\n      request.onerror = () => {\r\n        console.error('[DiskCache] Failed to open IndexedDB');\r\n        reject(new Error('Failed to open IndexedDB'));\r\n      };\r\n\r\n      request.onsuccess = () => {\r\n        this.db = request.result;\r\n        resolve();\r\n      };\r\n\r\n      request.onupgradeneeded = event => {\r\n        const db = (event.target as IDBOpenDBRequest).result;\r\n        if (!db.objectStoreNames.contains(STORE_NAME)) {\r\n          db.createObjectStore(STORE_NAME);\r\n        }\r\n      };\r\n    });\r\n  }\r\n\r\n  private async ensureReady(): Promise<void> {\r\n    if (this.initPromise) {\r\n      await this.initPromise;\r\n    }\r\n    if (!this.db) {\r\n      throw new Error('IndexedDB not initialized');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get value from disk cache\r\n   */\r\n  async get(key: string): Promise<T | null> {\r\n    await this.ensureReady();\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db!.transaction([STORE_NAME], 'readonly');\r\n      const store = transaction.objectStore(STORE_NAME);\r\n      const request = store.get(key);\r\n\r\n      request.onsuccess = () => {\r\n        const entry = request.result as DiskCacheEntry<T> | undefined;\r\n\r\n        if (!entry) {\r\n          resolve(null);\r\n          return;\r\n        }\r\n\r\n        // Check TTL\r\n        if (entry.ttl && Date.now() - entry.timestamp > entry.ttl) {\r\n          // Expired, delete and return null\r\n          this.delete(key).catch(console.error);\r\n          resolve(null);\r\n          return;\r\n        }\r\n\r\n        resolve(entry.value);\r\n      };\r\n\r\n      request.onerror = () => {\r\n        reject(new Error('Failed to read from cache'));\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set value in disk cache\r\n   */\r\n  async set(key: string, value: T, ttl?: number): Promise<void> {\r\n    await this.ensureReady();\r\n\r\n    const entry: DiskCacheEntry<T> = {\r\n      value,\r\n      timestamp: Date.now(),\r\n      ttl,\r\n    };\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db!.transaction([STORE_NAME], 'readwrite');\r\n      const store = transaction.objectStore(STORE_NAME);\r\n      const request = store.put(entry, key);\r\n\r\n      request.onsuccess = () => {\r\n        resolve();\r\n      };\r\n\r\n      request.onerror = () => {\r\n        reject(new Error('Failed to write to cache'));\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Delete key from cache\r\n   */\r\n  async delete(key: string): Promise<void> {\r\n    await this.ensureReady();\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db!.transaction([STORE_NAME], 'readwrite');\r\n      const store = transaction.objectStore(STORE_NAME);\r\n      const request = store.delete(key);\r\n\r\n      request.onsuccess = () => {\r\n        resolve();\r\n      };\r\n\r\n      request.onerror = () => {\r\n        reject(new Error('Failed to delete from cache'));\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear all cache\r\n   */\r\n  async clear(): Promise<void> {\r\n    await this.ensureReady();\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db!.transaction([STORE_NAME], 'readwrite');\r\n      const store = transaction.objectStore(STORE_NAME);\r\n      const request = store.clear();\r\n\r\n      request.onsuccess = () => {\r\n        resolve();\r\n      };\r\n\r\n      request.onerror = () => {\r\n        reject(new Error('Failed to clear cache'));\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clean expired entries\r\n   */\r\n  async cleanExpired(): Promise<number> {\r\n    await this.ensureReady();\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db!.transaction([STORE_NAME], 'readwrite');\r\n      const store = transaction.objectStore(STORE_NAME);\r\n      const request = store.openCursor();\r\n      let deleted = 0;\r\n\r\n      request.onsuccess = event => {\r\n        const cursor = (event.target as IDBRequest<IDBCursorWithValue>).result;\r\n        if (cursor) {\r\n          const entry = cursor.value as DiskCacheEntry<T>;\r\n          if (entry.ttl && Date.now() - entry.timestamp > entry.ttl) {\r\n            cursor.delete();\r\n            deleted++;\r\n          }\r\n          cursor.continue();\r\n        } else {\r\n          resolve(deleted);\r\n        }\r\n      };\r\n\r\n      request.onerror = () => {\r\n        reject(new Error('Failed to clean expired entries'));\r\n      };\r\n    });\r\n  }\r\n}\r\n","/**\n * Unified Cache Manager - Tier 2\n * Multi-layer cache: memory (LRU) + disk (persistent)\n */\n\nimport { MemoryCache } from './memory-cache';\nimport { DiskCache } from './disk-cache';\nimport { log } from '../../utils/logger';\n\nexport interface CacheOptions {\n  ttl?: number; // Time to live in milliseconds\n  useDisk?: boolean; // Whether to use disk cache\n  useMemory?: boolean; // Whether to use memory cache\n}\n\nexport class CacheManager {\n  private memoryCache: MemoryCache;\n  private diskCache: DiskCache;\n  private defaultOptions: CacheOptions;\n\n  constructor(\n    memorySize: number = 100,\n    defaultOptions: CacheOptions = {\n      ttl: 3600000, // 1 hour default\n      useDisk: true,\n      useMemory: true,\n    }\n  ) {\n    this.memoryCache = new MemoryCache(memorySize, defaultOptions.ttl);\n    this.diskCache = new DiskCache();\n    this.defaultOptions = defaultOptions;\n\n    // Clean expired entries periodically\n    if (typeof window !== 'undefined') {\n      setInterval(() => {\n        this.cleanExpired().catch(error => {\n          log.warn('Failed to clean expired cache entries', error);\n        });\n      }, 300000); // Every 5 minutes\n    }\n  }\n\n  /**\n   * Get value from cache (checks memory first, then disk)\n   */\n  async get<T>(key: string, options?: CacheOptions): Promise<T | null> {\n    const opts = { ...this.defaultOptions, ...options };\n\n    // Check memory cache first\n    if (opts.useMemory) {\n      const memoryValue = this.memoryCache.get(key);\n      if (memoryValue !== null && memoryValue !== undefined) {\n        log.debug(`Cache hit (memory): ${key}`);\n        return memoryValue as T;\n      }\n    }\n\n    // Check disk cache\n    if (opts.useDisk) {\n      try {\n        const diskValue = await this.diskCache.get(key);\n        if (diskValue !== null && diskValue !== undefined) {\n          log.debug(`Cache hit (disk): ${key}`);\n          // Populate memory cache\n          if (opts.useMemory) {\n            this.memoryCache.set(key, diskValue);\n          }\n          return diskValue as T;\n        }\n      } catch (error) {\n        log.warn(`Failed to read from disk cache: ${key}`, error);\n      }\n    }\n\n    log.debug(`Cache miss: ${key}`);\n    return null;\n  }\n\n  /**\n   * Set value in cache (writes to both memory and disk)\n   */\n  async set<T>(key: string, value: T, options?: CacheOptions): Promise<void> {\n    const opts = { ...this.defaultOptions, ...options };\n\n    // Write to memory cache\n    if (opts.useMemory) {\n      this.memoryCache.set(key, value);\n    }\n\n    // Write to disk cache\n    if (opts.useDisk) {\n      try {\n        await this.diskCache.set(key, value, opts.ttl);\n      } catch (error) {\n        log.warn(`Failed to write to disk cache: ${key}`, error);\n      }\n    }\n  }\n\n  /**\n   * Check if key exists\n   */\n  async has(key: string, options?: CacheOptions): Promise<boolean> {\n    const opts = { ...this.defaultOptions, ...options };\n\n    if (opts.useMemory && this.memoryCache.has(key)) {\n      return true;\n    }\n\n    if (opts.useDisk) {\n      const value = await this.get(key, options);\n      return value !== null;\n    }\n\n    return false;\n  }\n\n  /**\n   * Delete key from cache\n   */\n  async delete(key: string): Promise<void> {\n    this.memoryCache.delete(key);\n    try {\n      await this.diskCache.delete(key);\n    } catch (error) {\n      log.warn(`Failed to delete from disk cache: ${key}`, error);\n    }\n  }\n\n  /**\n   * Clear all cache\n   */\n  async clear(): Promise<void> {\n    this.memoryCache.clear();\n    try {\n      await this.diskCache.clear();\n    } catch (error) {\n      log.warn('Failed to clear disk cache', error);\n    }\n  }\n\n  /**\n   * Clean expired entries\n   */\n  async cleanExpired(): Promise<number> {\n    try {\n      return await this.diskCache.cleanExpired();\n    } catch (error) {\n      log.warn('Failed to clean expired cache entries', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Get cache statistics\n   */\n  getStats() {\n    return {\n      memory: this.memoryCache.getStats(),\n    };\n  }\n}\n\n// Singleton instance\nexport const cacheManager = new CacheManager();\n","/**\n * Metrics Collection - Tier 2\n * Performance timings, scrape metrics, AI agent execution traces\n */\n\nimport { log } from '../../utils/logger';\n\nexport interface Metric {\n  name: string;\n  value: number;\n  unit: string;\n  timestamp: number;\n  tags?: Record<string, string>;\n}\n\nexport interface ScrapeMetric {\n  url: string;\n  duration: number;\n  size: number;\n  cached: boolean;\n  timestamp: number;\n}\n\nexport interface AgentMetric {\n  agentId: string;\n  runId: string;\n  duration: number;\n  tokensUsed?: number;\n  success: boolean;\n  timestamp: number;\n}\n\nexport class MetricsCollector {\n  private metrics: Metric[] = [];\n  private scrapeMetrics: ScrapeMetric[] = [];\n  private agentMetrics: AgentMetric[] = [];\n  private maxMetrics = 1000;\n\n  /**\n   * Record a metric\n   */\n  record(name: string, value: number, unit: string = 'ms', tags?: Record<string, string>): void {\n    const metric: Metric = {\n      name,\n      value,\n      unit,\n      timestamp: Date.now(),\n      tags,\n    };\n\n    this.metrics.push(metric);\n\n    // Trim if over limit\n    if (this.metrics.length > this.maxMetrics) {\n      this.metrics.shift();\n    }\n\n    log.debug('Metric recorded', metric);\n  }\n\n  /**\n   * Record scrape metric\n   */\n  recordScrape(metric: ScrapeMetric): void {\n    this.scrapeMetrics.push(metric);\n\n    if (this.scrapeMetrics.length > this.maxMetrics) {\n      this.scrapeMetrics.shift();\n    }\n\n    log.debug('Scrape metric recorded', metric);\n  }\n\n  /**\n   * Record agent metric\n   */\n  recordAgent(metric: AgentMetric): void {\n    this.agentMetrics.push(metric);\n\n    if (this.agentMetrics.length > this.maxMetrics) {\n      this.agentMetrics.shift();\n    }\n\n    log.debug('Agent metric recorded', metric);\n  }\n\n  /**\n   * Get metrics by name\n   */\n  getMetrics(name?: string, tags?: Record<string, string>): Metric[] {\n    let filtered = this.metrics;\n\n    if (name) {\n      filtered = filtered.filter(m => m.name === name);\n    }\n\n    if (tags) {\n      filtered = filtered.filter(m => {\n        if (!m.tags) return false;\n        return Object.entries(tags).every(([key, value]) => m.tags![key] === value);\n      });\n    }\n\n    return filtered;\n  }\n\n  /**\n   * Get scrape metrics\n   */\n  getScrapeMetrics(): ScrapeMetric[] {\n    return [...this.scrapeMetrics];\n  }\n\n  /**\n   * Get agent metrics\n   */\n  getAgentMetrics(): AgentMetric[] {\n    return [...this.agentMetrics];\n  }\n\n  /**\n   * Get summary statistics\n   */\n  getSummary() {\n    const scrapeAvg =\n      this.scrapeMetrics.length > 0\n        ? this.scrapeMetrics.reduce((sum, m) => sum + m.duration, 0) / this.scrapeMetrics.length\n        : 0;\n\n    const agentAvg =\n      this.agentMetrics.length > 0\n        ? this.agentMetrics.reduce((sum, m) => sum + m.duration, 0) / this.agentMetrics.length\n        : 0;\n\n    const agentSuccessRate =\n      this.agentMetrics.length > 0\n        ? this.agentMetrics.filter(m => m.success).length / this.agentMetrics.length\n        : 0;\n\n    return {\n      totalMetrics: this.metrics.length,\n      totalScrapes: this.scrapeMetrics.length,\n      totalAgentRuns: this.agentMetrics.length,\n      avgScrapeDuration: scrapeAvg,\n      avgAgentDuration: agentAvg,\n      agentSuccessRate,\n    };\n  }\n\n  /**\n   * Clear all metrics\n   */\n  clear(): void {\n    this.metrics = [];\n    this.scrapeMetrics = [];\n    this.agentMetrics = [];\n  }\n}\n\n// Singleton instance\nexport const metricsCollector = new MetricsCollector();\n\n/**\n * Performance timing helper\n */\nexport function timeFunction<T>(name: string, fn: () => T | Promise<T>): Promise<T> {\n  const start = performance.now();\n  return Promise.resolve(fn()).then(\n    result => {\n      const duration = performance.now() - start;\n      metricsCollector.record(name, duration, 'ms');\n      return result;\n    },\n    error => {\n      const duration = performance.now() - start;\n      metricsCollector.record(`${name}:error`, duration, 'ms', { error: String(error) });\n      throw error;\n    }\n  );\n}\n","/**\n * Execution Tracer - Tier 2\n * Trace AI agent execution for debugging and observability\n */\n\nimport { log } from '../../utils/logger';\n\nexport interface TraceSpan {\n  id: string;\n  name: string;\n  startTime: number;\n  endTime?: number;\n  duration?: number;\n  tags?: Record<string, string | number | boolean>;\n  children: TraceSpan[];\n  error?: string;\n}\n\nexport class Tracer {\n  private spans: Map<string, TraceSpan> = new Map();\n  private activeSpans: string[] = [];\n\n  /**\n   * Start a trace span\n   */\n  startSpan(name: string, tags?: Record<string, string | number | boolean>): string {\n    const spanId = `span-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\n    const parentId = this.activeSpans[this.activeSpans.length - 1];\n\n    const span: TraceSpan = {\n      id: spanId,\n      name,\n      startTime: performance.now(),\n      tags,\n      children: [],\n    };\n\n    // Add as child of parent if exists\n    if (parentId) {\n      const parent = this.spans.get(parentId);\n      if (parent) {\n        parent.children.push(span);\n      }\n    }\n\n    this.spans.set(spanId, span);\n    this.activeSpans.push(spanId);\n\n    log.debug(`[Tracer] Started span: ${name}`, { spanId, tags });\n    return spanId;\n  }\n\n  /**\n   * End a trace span\n   */\n  endSpan(spanId: string, error?: string): void {\n    const span = this.spans.get(spanId);\n    if (!span) {\n      log.warn(`[Tracer] Span not found: ${spanId}`);\n      return;\n    }\n\n    span.endTime = performance.now();\n    span.duration = span.endTime - span.startTime;\n    if (error) {\n      span.error = error;\n    }\n\n    // Remove from active spans\n    const index = this.activeSpans.indexOf(spanId);\n    if (index !== -1) {\n      this.activeSpans.splice(index, 1);\n    }\n\n    log.debug(`[Tracer] Ended span: ${span.name}`, { spanId, duration: span.duration, error });\n  }\n\n  /**\n   * Get trace for a span\n   */\n  getTrace(spanId: string): TraceSpan | undefined {\n    return this.spans.get(spanId);\n  }\n\n  /**\n   * Get all root spans\n   */\n  getRootSpans(): TraceSpan[] {\n    return Array.from(this.spans.values()).filter(span => {\n      // Root span if not a child of any other span\n      return !Array.from(this.spans.values()).some(s => s.children.includes(span));\n    });\n  }\n\n  /**\n   * Clear all traces\n   */\n  clear(): void {\n    this.spans.clear();\n    this.activeSpans = [];\n  }\n}\n\n// Singleton instance\nexport const tracer = new Tracer();\n\n/**\n * Trace a function execution\n */\nexport async function traceFunction<T>(\n  name: string,\n  fn: () => T | Promise<T>,\n  tags?: Record<string, string | number | boolean>\n): Promise<T> {\n  const spanId = tracer.startSpan(name, tags);\n  try {\n    const result = await Promise.resolve(fn());\n    tracer.endSpan(spanId);\n    return result;\n  } catch (error) {\n    tracer.endSpan(spanId, error instanceof Error ? error.message : String(error));\n    throw error;\n  }\n}\n","/**\n * Agent Tool Registry - Tier 2\n * Registry of available tools for OmniAgent\n */\n\nimport { log } from '../utils/logger';\nimport { cacheManager } from '../core/cache';\nimport { metricsCollector } from '../core/observability';\n\nexport type AgentTool = (input: unknown) => Promise<unknown>;\n\nexport interface ToolDefinition {\n  name: string;\n  description: string;\n  execute: AgentTool;\n}\n\nclass ToolRegistry {\n  private tools: Map<string, ToolDefinition> = new Map();\n\n  /**\n   * Register a tool\n   */\n  register(tool: ToolDefinition): void {\n    this.tools.set(tool.name, tool);\n    log.info(`[AgentRegistry] Registered tool: ${tool.name}`);\n  }\n\n  /**\n   * Get a tool by name\n   */\n  get(name: string): ToolDefinition | undefined {\n    return this.tools.get(name);\n  }\n\n  /**\n   * Get all tools\n   */\n  getAll(): ToolDefinition[] {\n    return Array.from(this.tools.values());\n  }\n\n  /**\n   * Check if tool exists\n   */\n  has(name: string): boolean {\n    return this.tools.has(name);\n  }\n}\n\n// Singleton instance\nexport const toolRegistry = new ToolRegistry();\n\n/**\n * Built-in tools\n */\n\n// Scrape a page\ntoolRegistry.register({\n  name: 'scrapePage',\n  description: 'Scrape content from a URL',\n  execute: async (input: unknown) => {\n    const { url } = input as { url: string };\n    if (!url) throw new Error('URL required');\n\n    // Check cache first\n    const cacheKey = `scrape:${url}`;\n    const cached = await cacheManager.get(cacheKey);\n    if (cached) {\n      log.debug(`[AgentTool] Cache hit for scrape: ${url}`);\n      return cached;\n    }\n\n    // For now, use IPC to scrape (or mock)\n    try {\n      const startTime = performance.now();\n      // In Electron, use ipc.scrape.enqueue\n      // For web, we'd need a backend API\n      const result = {\n        url,\n        title: 'Scraped Page',\n        content: 'Mock content - implement actual scraping',\n        scrapedAt: Date.now(),\n      };\n\n      const duration = performance.now() - startTime;\n      metricsCollector.recordScrape({\n        url,\n        duration,\n        size: JSON.stringify(result).length,\n        cached: false,\n        timestamp: Date.now(),\n      });\n\n      // Cache result\n      await cacheManager.set(cacheKey, result, { ttl: 3600000 }); // 1 hour\n\n      return result;\n    } catch (error) {\n      log.error(`[AgentTool] Failed to scrape: ${url}`, error);\n      throw error;\n    }\n  },\n});\n\n// Summarize text\ntoolRegistry.register({\n  name: 'summarizeText',\n  description: 'Summarize text content',\n  execute: async (input: unknown) => {\n    const { text, maxLength = 200 } = input as { text: string; maxLength?: number };\n    if (!text) throw new Error('Text required');\n\n    // For now, simple truncation\n    // In production, use AI model\n    const summary = text.length > maxLength ? text.slice(0, maxLength) + '...' : text;\n\n    return {\n      summary,\n      originalLength: text.length,\n      summaryLength: summary.length,\n    };\n  },\n});\n\n// Search web (mock for now)\ntoolRegistry.register({\n  name: 'searchWeb',\n  description: 'Search the web for information',\n  execute: async (input: unknown) => {\n    const { query, maxResults = 5 } = input as { query: string; maxResults?: number };\n    if (!query) throw new Error('Query required');\n\n    // Mock search results\n    // In production, use actual search API\n    return {\n      query,\n      results: Array.from({ length: maxResults }, (_, i) => ({\n        title: `Result ${i + 1} for \"${query}\"`,\n        url: `https://example.com/result-${i + 1}`,\n        snippet: `This is a mock search result for \"${query}\"`,\n      })),\n    };\n  },\n});\n","/**\r\n * Agent Capability Controls - Tier 3 Pillar 4\r\n * Whitelist and permission system for agent actions\r\n */\r\n\r\nimport { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\nimport { log } from '../../utils/logger';\r\n\r\nexport type AgentCapability =\r\n  | 'open_tabs'\r\n  | 'close_tabs'\r\n  | 'navigate_tabs'\r\n  | 'save_workspaces'\r\n  | 'delete_workspaces'\r\n  | 'send_network_requests'\r\n  | 'access_local_files'\r\n  | 'execute_external_scripts'\r\n  | 'modify_settings';\r\n\r\nexport type CapabilityConfig = {\r\n  capability: AgentCapability;\r\n  enabled: boolean;\r\n  description: string;\r\n};\r\n\r\ntype CapabilityState = {\r\n  capabilities: Record<AgentCapability, boolean>;\r\n  experimentalToolsEnabled: boolean;\r\n  externalPluginsEnabled: boolean;\r\n  setCapability: (capability: AgentCapability, enabled: boolean) => void;\r\n  setExperimentalTools: (enabled: boolean) => void;\r\n  setExternalPlugins: (enabled: boolean) => void;\r\n  checkCapability: (capability: AgentCapability) => boolean;\r\n};\r\n\r\nconst DEFAULT_CAPABILITIES: Record<AgentCapability, boolean> = {\r\n  open_tabs: true,\r\n  close_tabs: false, // Disabled by default for safety\r\n  navigate_tabs: true,\r\n  save_workspaces: true,\r\n  delete_workspaces: false, // Disabled by default\r\n  send_network_requests: true,\r\n  access_local_files: false, // Disabled by default\r\n  execute_external_scripts: false, // Disabled by default\r\n  modify_settings: false, // Disabled by default\r\n};\r\n\r\nexport const useCapabilityStore = create<CapabilityState>()(\r\n  persist(\r\n    (set, get) => ({\r\n      capabilities: DEFAULT_CAPABILITIES,\r\n      experimentalToolsEnabled: false,\r\n      externalPluginsEnabled: false,\r\n\r\n      setCapability: (capability, enabled) => {\r\n        set(state => ({\r\n          capabilities: {\r\n            ...state.capabilities,\r\n            [capability]: enabled,\r\n          },\r\n        }));\r\n        log.info(`[Capabilities] ${capability} ${enabled ? 'enabled' : 'disabled'}`);\r\n      },\r\n\r\n      setExperimentalTools: enabled => {\r\n        set({ experimentalToolsEnabled: enabled });\r\n        log.info(`[Capabilities] Experimental tools ${enabled ? 'enabled' : 'disabled'}`);\r\n      },\r\n\r\n      setExternalPlugins: enabled => {\r\n        set({ externalPluginsEnabled: enabled });\r\n        log.info(`[Capabilities] External plugins ${enabled ? 'enabled' : 'disabled'}`);\r\n      },\r\n\r\n      checkCapability: capability => {\r\n        return get().capabilities[capability] ?? false;\r\n      },\r\n    }),\r\n    {\r\n      name: 'regen_capabilities_v1',\r\n    }\r\n  )\r\n);\r\n\r\n/**\r\n * Check if a capability is enabled\r\n */\r\nexport function hasCapability(capability: AgentCapability): boolean {\r\n  return useCapabilityStore.getState().checkCapability(capability);\r\n}\r\n\r\n/**\r\n * Get capability descriptions\r\n */\r\nexport function getCapabilityDescriptions(): Record<AgentCapability, string> {\r\n  return {\r\n    open_tabs: 'Allow agent to open new tabs',\r\n    close_tabs: 'Allow agent to close tabs',\r\n    navigate_tabs: 'Allow agent to navigate between tabs',\r\n    save_workspaces: 'Allow agent to save workspaces',\r\n    delete_workspaces: 'Allow agent to delete workspaces',\r\n    send_network_requests: 'Allow agent to make network requests to external sites',\r\n    access_local_files: 'Allow agent to access local filesystem',\r\n    execute_external_scripts: 'Allow agent to execute external scripts',\r\n    modify_settings: 'Allow agent to modify application settings',\r\n  };\r\n}\r\n\r\n/**\r\n * Capability guard for agent tools\r\n */\r\nexport function requireCapability(capability: AgentCapability): void {\r\n  if (!hasCapability(capability)) {\r\n    throw new Error(`Capability required: ${capability}. Enable it in Settings > Safety.`);\r\n  }\r\n}\r\n","/**\n * Tool Registry v2 - Tier 3 Pillar 1\n * Declarative tool definitions with schemas\n */\n\nimport { z } from 'zod';\nimport type { ToolContext } from '../graph';\nimport { toolRegistry as v1Registry } from '../../../agent/registry';\nimport { log } from '../../../utils/logger';\nimport { requireCapability } from '../../security/capabilities';\n\nexport type ToolDef = {\n  name: string;\n  description: string;\n  inputSchema: z.ZodSchema;\n  outputSchema: z.ZodSchema;\n  run: (input: unknown, ctx: ToolContext) => Promise<unknown>;\n  category?: 'research' | 'trade' | 'docs' | 'threat' | 'general';\n  requiresAuth?: boolean;\n  rateLimit?: {\n    requests: number;\n    window: number; // milliseconds\n  };\n};\n\nclass ToolRegistryV2 {\n  private tools: Map<string, ToolDef> = new Map();\n  private rateLimiters: Map<string, { count: number; resetAt: number }> = new Map();\n\n  /**\n   * Register a tool\n   */\n  register(tool: ToolDef): void {\n    this.tools.set(tool.name, tool);\n    log.info(`[ToolRegistryV2] Registered tool: ${tool.name} (${tool.category || 'general'})`);\n  }\n\n  /**\n   * Get a tool by name\n   */\n  get(name: string): ToolDef | undefined {\n    return this.tools.get(name);\n  }\n\n  /**\n   * Get all tools\n   */\n  getAll(): ToolDef[] {\n    return Array.from(this.tools.values());\n  }\n\n  /**\n   * Get tools by category\n   */\n  getByCategory(category: ToolDef['category']): ToolDef[] {\n    return Array.from(this.tools.values()).filter(tool => tool.category === category);\n  }\n\n  /**\n   * Execute a tool with validation\n   */\n  async execute(name: string, input: unknown, ctx: ToolContext): Promise<unknown> {\n    const tool = this.tools.get(name);\n    if (!tool) {\n      throw new Error(`Tool not found: ${name}`);\n    }\n\n    // Check rate limit\n    if (tool.rateLimit && !this.checkRateLimit(name, tool.rateLimit)) {\n      throw new Error(`Rate limit exceeded for tool: ${name}`);\n    }\n\n    // Validate input\n    try {\n      const validatedInput = tool.inputSchema.parse(input);\n      const output = await tool.run(validatedInput, ctx);\n      const validatedOutput = tool.outputSchema.parse(output);\n      return validatedOutput;\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        log.error(`[ToolRegistryV2] Validation error for ${name}:`, error.errors);\n        throw new Error(\n          `Invalid input for tool ${name}: ${error.errors.map(e => e.message).join(', ')}`\n        );\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Check rate limit\n   */\n  private checkRateLimit(name: string, limit: { requests: number; window: number }): boolean {\n    const now = Date.now();\n    const limiter = this.rateLimiters.get(name);\n\n    if (!limiter || now > limiter.resetAt) {\n      // Reset or initialize\n      this.rateLimiters.set(name, {\n        count: 1,\n        resetAt: now + limit.window,\n      });\n      return true;\n    }\n\n    if (limiter.count >= limit.requests) {\n      return false;\n    }\n\n    limiter.count++;\n    return true;\n  }\n}\n\n// Singleton instance\nexport const toolRegistryV2 = new ToolRegistryV2();\n\n/**\n * Register built-in tools\n */\n\n// Scrape page tool\ntoolRegistryV2.register({\n  name: 'scrape_page',\n  description: 'Scrape content from a URL',\n  inputSchema: z.object({\n    url: z.string().url(),\n    extract: z.enum(['text', 'html', 'markdown']).optional().default('text'),\n  }),\n  outputSchema: z.object({\n    url: z.string(),\n    title: z.string(),\n    content: z.string(),\n    scrapedAt: z.number(),\n  }),\n  category: 'research',\n  run: async (input, _ctx) => {\n    const v1Tool = v1Registry.get('scrapePage');\n    if (!v1Tool) throw new Error('scrapePage tool not found');\n    return v1Tool.execute(input);\n  },\n});\n\n// Summarize text tool\ntoolRegistryV2.register({\n  name: 'summarize_text',\n  description: 'Summarize text content',\n  inputSchema: z.object({\n    text: z.string(),\n    maxLength: z.number().optional().default(200),\n    format: z.enum(['bullet', 'paragraph', 'list']).optional().default('paragraph'),\n  }),\n  outputSchema: z.object({\n    summary: z.string(),\n    originalLength: z.number(),\n    summaryLength: z.number(),\n  }),\n  category: 'general',\n  run: async (input, ctx) => {\n    const v1Tool = v1Registry.get('summarizeText');\n    if (!v1Tool) throw new Error('summarizeText tool not found');\n    const result = await v1Tool.execute(input);\n    // Remember format preference\n    ctx.memory.remember('preference', 'summary_format', (input as any).format);\n    return result;\n  },\n});\n\n// Search web tool\ntoolRegistryV2.register({\n  name: 'search_web',\n  description: 'Search the web for information',\n  inputSchema: z.object({\n    query: z.string(),\n    maxResults: z.number().optional().default(5),\n    sources: z.array(z.string()).optional(),\n  }),\n  outputSchema: z.object({\n    query: z.string(),\n    results: z.array(\n      z.object({\n        title: z.string(),\n        url: z.string(),\n        snippet: z.string(),\n      })\n    ),\n  }),\n  category: 'research',\n  rateLimit: {\n    requests: 10,\n    window: 60000, // 1 minute\n  },\n  run: async (input, _ctx) => {\n    const v1Tool = v1Registry.get('searchWeb');\n    if (!v1Tool) throw new Error('searchWeb tool not found');\n    return v1Tool.execute(input);\n  },\n});\n\n// Extract table tool\ntoolRegistryV2.register({\n  name: 'extract_table',\n  description: 'Extract tables from a page or document',\n  inputSchema: z.object({\n    url: z.string().url().optional(),\n    html: z.string().optional(),\n    tableIndex: z.number().optional().default(0),\n  }),\n  outputSchema: z.object({\n    table: z.array(z.array(z.string())),\n    headers: z.array(z.string()).optional(),\n  }),\n  category: 'docs',\n  run: async (_input, _ctx) => {\n    // TODO: Implement table extraction\n    throw new Error('extract_table not yet implemented');\n  },\n});\n\n// Manage tabs tool\ntoolRegistryV2.register({\n  name: 'manage_tabs',\n  description: 'Create, close, or switch tabs',\n  inputSchema: z.object({\n    action: z.enum(['create', 'close', 'switch', 'list']),\n    url: z.string().url().optional(),\n    tabId: z.string().optional(),\n  }),\n  outputSchema: z.object({\n    success: z.boolean(),\n    tabId: z.string().optional(),\n    tabs: z.array(z.any()).optional(),\n  }),\n  category: 'general',\n  run: async (input, _ctx) => {\n    const { ipc } = await import('../../../lib/ipc-typed');\n    const { useTabsStore } = await import('../../../state/tabsStore');\n    const typedInput = input as {\n      action: 'create' | 'close' | 'switch' | 'list';\n      url?: string;\n      tabId?: string;\n    };\n\n    switch (typedInput.action) {\n      case 'create':\n        requireCapability('open_tabs');\n        if (!typedInput.url) throw new Error('URL required for create action');\n        const newTab = await ipc.tabs.create(typedInput.url);\n        let tabId: string | null = null;\n        if (newTab) {\n          if (typeof newTab === 'object' && 'id' in newTab && typeof newTab.id === 'string') {\n            tabId = newTab.id;\n          } else if (typeof newTab === 'string') {\n            tabId = newTab;\n          }\n          if (tabId) {\n            useTabsStore.getState().setActive(tabId);\n          }\n        }\n        return { success: true, tabId: tabId || undefined };\n      case 'close':\n        requireCapability('close_tabs');\n        if (!typedInput.tabId) throw new Error('tabId required for close action');\n        await ipc.tabs.close({ id: typedInput.tabId });\n        return { success: true };\n      case 'switch':\n        requireCapability('navigate_tabs');\n        if (!typedInput.tabId) throw new Error('tabId required for switch action');\n        useTabsStore.getState().setActive(typedInput.tabId);\n        await ipc.tabs.activate({ id: typedInput.tabId });\n        return { success: true, tabId: typedInput.tabId };\n      case 'list':\n        const tabs = useTabsStore.getState().tabs;\n        return { success: true, tabs };\n      default:\n        throw new Error(`Unknown action: ${(input as any).action}`);\n    }\n  },\n});\n\n// Manage workspaces tool\ntoolRegistryV2.register({\n  name: 'manage_workspaces',\n  description: 'Create, restore, or list workspaces',\n  inputSchema: z.object({\n    action: z.enum(['create', 'restore', 'list']),\n    name: z.string().optional(),\n    workspaceId: z.string().optional(),\n  }),\n  outputSchema: z.object({\n    success: z.boolean(),\n    workspaceId: z.string().optional(),\n    workspaces: z.array(z.any()).optional(),\n  }),\n  category: 'general',\n  run: async (input, _ctx) => {\n    const { useWorkspacesStore } = await import('../../../state/workspacesStore');\n    const { useTabsStore } = await import('../../../state/tabsStore');\n    const { useAppStore } = await import('../../../state/appStore');\n    const typedInput = input as {\n      action: 'create' | 'restore' | 'list';\n      name?: string;\n      workspaceId?: string;\n    };\n\n    switch (typedInput.action) {\n      case 'create':\n        requireCapability('save_workspaces');\n        if (!typedInput.name) throw new Error('name required for create action');\n        const tabs = useTabsStore.getState().tabs;\n        const mode = useAppStore.getState().mode;\n        const workspaceId = useWorkspacesStore.getState().add({\n          name: typedInput.name,\n          tabs,\n          mode,\n        });\n        return { success: true, workspaceId };\n      case 'restore':\n        if (!typedInput.workspaceId) throw new Error('workspaceId required for restore action');\n        const workspace = useWorkspacesStore.getState().get(typedInput.workspaceId);\n        if (!workspace) throw new Error('Workspace not found');\n        // Restore logic would go here\n        return { success: true, workspaceId: typedInput.workspaceId };\n      case 'list':\n        const workspaces = useWorkspacesStore.getState().workspaces;\n        return { success: true, workspaces };\n      default:\n        throw new Error(`Unknown action: ${(input as any).action}`);\n    }\n  },\n});\n","/**\n * LoadingSkeleton - Reusable skeleton loader for AI operations\n * Provides visual feedback during async operations\n */\n\nimport { motion } from 'framer-motion';\n\ninterface SkeletonProps {\n  variant?: 'text' | 'card' | 'list' | 'table' | 'custom';\n  lines?: number;\n  className?: string;\n  children?: React.ReactNode;\n}\n\nconst shimmerAnimation = {\n  initial: { opacity: 0.3 },\n  animate: {\n    opacity: [0.3, 0.6, 0.3],\n    transition: {\n      duration: 1.5,\n      repeat: Infinity,\n      ease: 'easeInOut',\n    },\n  },\n};\n\nexport function LoadingSkeleton({\n  variant = 'text',\n  lines = 3,\n  className = '',\n  children,\n}: SkeletonProps) {\n  if (children) {\n    return (\n      <div className={`animate-pulse ${className}`}>\n        <motion.div\n          variants={shimmerAnimation}\n          initial=\"initial\"\n          animate=\"animate\"\n          className=\"h-full w-full rounded bg-gray-800/50\"\n        >\n          {children}\n        </motion.div>\n      </div>\n    );\n  }\n\n  switch (variant) {\n    case 'text':\n      return (\n        <div className={`space-y-2 ${className}`}>\n          {Array.from({ length: lines }).map((_, i) => (\n            <motion.div\n              key={i}\n              variants={shimmerAnimation}\n              initial=\"initial\"\n              animate=\"animate\"\n              className=\"h-4 rounded bg-gray-800/50\"\n              style={{ width: i === lines - 1 ? '75%' : '100%' }}\n            />\n          ))}\n        </div>\n      );\n\n    case 'card':\n      return (\n        <motion.div\n          variants={shimmerAnimation}\n          initial=\"initial\"\n          animate=\"animate\"\n          className={`rounded-lg border border-gray-800 bg-gray-900/50 p-4 ${className}`}\n        >\n          <div className=\"mb-3 h-4 w-3/4 rounded bg-gray-800/50\" />\n          <div className=\"space-y-2\">\n            <div className=\"h-3 w-full rounded bg-gray-800/50\" />\n            <div className=\"h-3 w-5/6 rounded bg-gray-800/50\" />\n          </div>\n        </motion.div>\n      );\n\n    case 'list':\n      return (\n        <div className={`space-y-3 ${className}`}>\n          {Array.from({ length: lines }).map((_, i) => (\n            <motion.div\n              key={i}\n              variants={shimmerAnimation}\n              initial=\"initial\"\n              animate=\"animate\"\n              className=\"flex items-center gap-3 rounded-lg border border-gray-800 bg-gray-900/50 p-3\"\n            >\n              <div className=\"h-10 w-10 flex-shrink-0 rounded-full bg-gray-800/50\" />\n              <div className=\"flex-1 space-y-2\">\n                <div className=\"h-4 w-3/4 rounded bg-gray-800/50\" />\n                <div className=\"h-3 w-1/2 rounded bg-gray-800/50\" />\n              </div>\n            </motion.div>\n          ))}\n        </div>\n      );\n\n    case 'table':\n      return (\n        <div className={`space-y-2 ${className}`}>\n          {Array.from({ length: lines }).map((_, i) => (\n            <motion.div\n              key={i}\n              variants={shimmerAnimation}\n              initial=\"initial\"\n              animate=\"animate\"\n              className=\"flex gap-4 rounded border border-gray-800 bg-gray-900/50 p-3\"\n            >\n              <div className=\"h-4 w-1/4 rounded bg-gray-800/50\" />\n              <div className=\"h-4 w-1/4 rounded bg-gray-800/50\" />\n              <div className=\"h-4 w-1/4 rounded bg-gray-800/50\" />\n              <div className=\"h-4 w-1/4 rounded bg-gray-800/50\" />\n            </motion.div>\n          ))}\n        </div>\n      );\n\n    default:\n      return null;\n  }\n}\n\n/**\n * AIThinkingSkeleton - Specialized skeleton for AI operations\n */\nexport function AIThinkingSkeleton({ message = 'AI is thinking...' }: { message?: string }) {\n  return (\n    <div className=\"flex items-center gap-3 rounded-lg border border-gray-800 bg-gray-900/50 p-4\">\n      <motion.div\n        animate={{ rotate: 360 }}\n        transition={{ duration: 1, repeat: Infinity, ease: 'linear' }}\n        className=\"h-5 w-5 flex-shrink-0 rounded-full border-2 border-gray-700 border-t-emerald-400\"\n      />\n      <div className=\"flex-1 space-y-2\">\n        <div className=\"h-4 w-32 rounded bg-gray-800/50\">{message}</div>\n        <div className=\"h-3 w-48 rounded bg-gray-800/50\" />\n      </div>\n    </div>\n  );\n}\n","/**\r\n * Stagehand-style Scripting API\r\n * Developer-friendly automation API for all modes\r\n * Inspired by Stagehand: https://github.com/cloudflare/stagehand\r\n */\r\n\r\n/**\r\n * Element selector types\r\n */\r\nexport type Selector = string | { text?: string; role?: string; label?: string; testId?: string };\r\n\r\n/**\r\n * Action types\r\n */\r\nexport type Action = \r\n  | { type: 'click'; selector: Selector }\r\n  | { type: 'type'; selector: Selector; text: string }\r\n  | { type: 'wait'; selector: Selector; timeout?: number }\r\n  | { type: 'scroll'; selector: Selector; direction?: 'up' | 'down' | 'left' | 'right' }\r\n  | { type: 'screenshot'; selector?: Selector }\r\n  | { type: 'extract'; selector: Selector; attribute?: string }\r\n  | { type: 'navigate'; url: string }\r\n  | { type: 'evaluate'; script: string }\r\n  | { type: 'fill'; selector: Selector; value: string }\r\n  | { type: 'select'; selector: Selector; value: string };\r\n\r\n/**\r\n * Stagehand-style automation API\r\n */\r\nexport class StagehandAPI {\r\n  private context: 'research' | 'trade' | 'agent' | 'browse' = 'browse';\r\n  private sessionId: string;\r\n\r\n  constructor(context: 'research' | 'trade' | 'agent' | 'browse' = 'browse', sessionId?: string) {\r\n    this.context = context;\r\n    this.sessionId = sessionId || `stagehand-${Date.now()}`;\r\n  }\r\n\r\n  /**\r\n   * Find element by selector\r\n   */\r\n  private async findElement(selector: Selector): Promise<Element | null> {\r\n    if (typeof selector === 'string') {\r\n      // CSS selector\r\n      return document.querySelector(selector);\r\n    }\r\n\r\n    // Smart selector\r\n    if (selector.text) {\r\n      // Find by text content\r\n      const elements = Array.from(document.querySelectorAll('*'));\r\n      return elements.find(el => el.textContent?.includes(selector.text!)) || null;\r\n    }\r\n\r\n    if (selector.role) {\r\n      return document.querySelector(`[role=\"${selector.role}\"]`) || null;\r\n    }\r\n\r\n    if (selector.label) {\r\n      const label = document.querySelector(`label[for=\"${selector.label}\"]`);\r\n      if (label) {\r\n        const id = label.getAttribute('for');\r\n        return id ? document.getElementById(id) : null;\r\n      }\r\n    }\r\n\r\n    if (selector.testId) {\r\n      return document.querySelector(`[data-testid=\"${selector.testId}\"]`) || null;\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Wait for element to appear\r\n   */\r\n  async wait(selector: Selector, timeout: number = 5000): Promise<Element> {\r\n    const startTime = Date.now();\r\n    \r\n    while (Date.now() - startTime < timeout) {\r\n      const element = await this.findElement(selector);\r\n      if (element) {\r\n        return element;\r\n      }\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n    }\r\n\r\n    throw new Error(`Element not found: ${JSON.stringify(selector)}`);\r\n  }\r\n\r\n  /**\r\n   * Click element\r\n   */\r\n  async click(selector: Selector): Promise<void> {\r\n    const element = await this.wait(selector);\r\n    if (element instanceof HTMLElement) {\r\n      element.click();\r\n    } else {\r\n      throw new Error('Element is not clickable');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Type text into element\r\n   */\r\n  async type(selector: Selector, text: string): Promise<void> {\r\n    const element = await this.wait(selector);\r\n    if (element instanceof HTMLInputElement || element instanceof HTMLTextAreaElement) {\r\n      element.focus();\r\n      element.value = text;\r\n      element.dispatchEvent(new Event('input', { bubbles: true }));\r\n      element.dispatchEvent(new Event('change', { bubbles: true }));\r\n    } else {\r\n      throw new Error('Element is not an input or textarea');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fill form field\r\n   */\r\n  async fill(selector: Selector, value: string): Promise<void> {\r\n    await this.type(selector, value);\r\n  }\r\n\r\n  /**\r\n   * Select option in dropdown\r\n   */\r\n  async select(selector: Selector, value: string): Promise<void> {\r\n    const element = await this.wait(selector);\r\n    if (element instanceof HTMLSelectElement) {\r\n      element.value = value;\r\n      element.dispatchEvent(new Event('change', { bubbles: true }));\r\n    } else {\r\n      throw new Error('Element is not a select');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Scroll to element\r\n   */\r\n  async scroll(selector: Selector, _direction: 'up' | 'down' | 'left' | 'right' = 'down'): Promise<void> {\r\n    const element = await this.wait(selector);\r\n    element.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n  }\r\n\r\n  /**\r\n   * Extract text or attribute from element\r\n   */\r\n  async extract(selector: Selector, attribute?: string): Promise<string> {\r\n    const element = await this.wait(selector);\r\n    if (attribute) {\r\n      return element.getAttribute(attribute) || '';\r\n    }\r\n    return element.textContent || '';\r\n  }\r\n\r\n  /**\r\n   * Take screenshot (returns data URL)\r\n   */\r\n  async screenshot(selector?: Selector): Promise<string> {\r\n    // Use html2canvas or similar for screenshot\r\n    const _target = selector ? await this.wait(selector) : document.body;\r\n    \r\n    // Simplified - in production, use html2canvas\r\n    return new Promise((resolve) => {\r\n      // Placeholder - implement with html2canvas\r\n      resolve('data:image/png;base64,placeholder');\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Navigate to URL\r\n   */\r\n  async navigate(url: string): Promise<void> {\r\n    window.location.href = url;\r\n    await this.wait({ text: 'loading' }, 1000).catch(() => {});\r\n  }\r\n\r\n  /**\r\n   * Evaluate JavaScript in page context\r\n   */\r\n  async evaluate(script: string): Promise<any> {\r\n    return new Function(script)();\r\n  }\r\n\r\n  /**\r\n   * Execute sequence of actions\r\n   */\r\n  async sequence(actions: Action[]): Promise<any[]> {\r\n    const results: any[] = [];\r\n    for (const action of actions) {\r\n      let result: any;\r\n      \r\n      switch (action.type) {\r\n        case 'click':\r\n          await this.click(action.selector);\r\n          break;\r\n        case 'type':\r\n          await this.type(action.selector, action.text);\r\n          break;\r\n        case 'wait':\r\n          await this.wait(action.selector, action.timeout);\r\n          break;\r\n        case 'scroll':\r\n          await this.scroll(action.selector, action.direction);\r\n          break;\r\n        case 'screenshot':\r\n          result = await this.screenshot(action.selector);\r\n          break;\r\n        case 'extract':\r\n          result = await this.extract(action.selector, action.attribute);\r\n          break;\r\n        case 'navigate':\r\n          await this.navigate(action.url);\r\n          break;\r\n        case 'evaluate':\r\n          result = await this.evaluate(action.script);\r\n          break;\r\n        case 'fill':\r\n          await this.fill(action.selector, action.value);\r\n          break;\r\n        case 'select':\r\n          await this.select(action.selector, action.value);\r\n          break;\r\n      }\r\n      \r\n      results.push(result);\r\n    }\r\n    \r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Get current page state\r\n   */\r\n  getState(): {\r\n    url: string;\r\n    title: string;\r\n    context: string;\r\n    sessionId: string;\r\n  } {\r\n    return {\r\n      url: window.location.href,\r\n      title: document.title,\r\n      context: this.context,\r\n      sessionId: this.sessionId,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Create Stagehand API instance\r\n */\r\nexport function createStagehand(\r\n  context: 'research' | 'trade' | 'agent' | 'browse' = 'browse',\r\n  sessionId?: string\r\n): StagehandAPI {\r\n  return new StagehandAPI(context, sessionId);\r\n}\r\n\r\n/**\r\n * Global Stagehand instance (for console access)\r\n */\r\ndeclare global {\r\n  interface Window {\r\n    stagehand: StagehandAPI;\r\n  }\r\n}\r\n\r\n// Auto-create global instance\r\nif (typeof window !== 'undefined') {\r\n  window.stagehand = createStagehand('browse');\r\n}\r\n\r\n","/**\r\n * useStagehand Hook\r\n * React hook for Stagehand-style scripting in components\r\n */\r\n\r\nimport { useMemo, useCallback } from 'react';\r\nimport { createStagehand, Action } from '../utils/stagehand-api';\r\n\r\ninterface UseStagehandOptions {\r\n  context?: 'research' | 'trade' | 'agent' | 'browse';\r\n  sessionId?: string;\r\n}\r\n\r\nexport function useStagehand(options: UseStagehandOptions = {}) {\r\n  const { context = 'browse', sessionId } = options;\r\n\r\n  const stagehand = useMemo(() => {\r\n    return createStagehand(context, sessionId);\r\n  }, [context, sessionId]);\r\n\r\n  /**\r\n   * Execute action sequence\r\n   */\r\n  const execute = useCallback(async (actions: Action[]) => {\r\n    return await stagehand.sequence(actions);\r\n  }, [stagehand]);\r\n\r\n  /**\r\n   * Quick actions\r\n   */\r\n  const click = useCallback(async (selector: any) => {\r\n    await stagehand.click(selector);\r\n  }, [stagehand]);\r\n\r\n  const type = useCallback(async (selector: any, text: string) => {\r\n    await stagehand.type(selector, text);\r\n  }, [stagehand]);\r\n\r\n  const wait = useCallback(async (selector: any, timeout?: number) => {\r\n    return await stagehand.wait(selector, timeout);\r\n  }, [stagehand]);\r\n\r\n  const extract = useCallback(async (selector: any, attribute?: string) => {\r\n    return await stagehand.extract(selector, attribute);\r\n  }, [stagehand]);\r\n\r\n  const navigate = useCallback(async (url: string) => {\r\n    await stagehand.navigate(url);\r\n  }, [stagehand]);\r\n\r\n  return {\r\n    stagehand,\r\n    execute,\r\n    click,\r\n    type,\r\n    wait,\r\n    extract,\r\n    navigate,\r\n    getState: () => stagehand.getState(),\r\n  };\r\n}\r\n\r\n","/**\r\n * Search Health Check Service\r\n * Monitors MeiliSearch status and provides health indicators\r\n */\r\n\r\nimport { checkMeiliSearch } from '../lib/meili';\r\n\r\nexport type SearchHealthStatus = 'healthy' | 'degraded' | 'offline' | 'checking';\r\n\r\nexport interface SearchHealth {\r\n  status: SearchHealthStatus;\r\n  meiliSearch: boolean;\r\n  localSearch: boolean;\r\n  lastChecked: number;\r\n  error?: string;\r\n}\r\n\r\nlet healthCache: SearchHealth | null = null;\r\nlet healthCheckInterval: ReturnType<typeof setInterval> | null = null;\r\n\r\n/**\r\n * Check search system health\r\n */\r\nexport async function checkSearchHealth(): Promise<SearchHealth> {\r\n  const health: SearchHealth = {\r\n    status: 'checking',\r\n    meiliSearch: false,\r\n    localSearch: true, // Local search (Lunr) is always available\r\n    lastChecked: Date.now(),\r\n  };\r\n\r\n  try {\r\n    // Check MeiliSearch\r\n    const meiliAvailable = await Promise.race([\r\n      checkMeiliSearch(),\r\n      new Promise<boolean>(resolve => setTimeout(() => resolve(false), 2000)), // 2s timeout\r\n    ]);\r\n\r\n    health.meiliSearch = meiliAvailable;\r\n\r\n    // Determine overall status\r\n    if (meiliAvailable) {\r\n      health.status = 'healthy';\r\n    } else {\r\n      // MeiliSearch down, but local search available\r\n      health.status = 'degraded';\r\n      health.error = 'MeiliSearch unavailable, using local search only';\r\n    }\r\n  } catch (error) {\r\n    health.status = 'degraded';\r\n    health.error = error instanceof Error ? error.message : 'Unknown error';\r\n    health.meiliSearch = false;\r\n  }\r\n\r\n  healthCache = health;\r\n  return health;\r\n}\r\n\r\n/**\r\n * Get cached health status\r\n */\r\nexport function getSearchHealth(): SearchHealth | null {\r\n  return healthCache;\r\n}\r\n\r\n/**\r\n * Start periodic health checks\r\n */\r\nexport function startSearchHealthMonitoring(intervalMs: number = 30000): void {\r\n  if (healthCheckInterval) {\r\n    clearInterval(healthCheckInterval);\r\n  }\r\n\r\n  // Initial check\r\n  checkSearchHealth().catch(console.error);\r\n\r\n  // Periodic checks\r\n  healthCheckInterval = setInterval(() => {\r\n    checkSearchHealth().catch(console.error);\r\n  }, intervalMs);\r\n}\r\n\r\n/**\r\n * Stop health monitoring\r\n */\r\nexport function stopSearchHealthMonitoring(): void {\r\n  if (healthCheckInterval) {\r\n    clearInterval(healthCheckInterval);\r\n    healthCheckInterval = null;\r\n  }\r\n}\r\n\r\n/**\r\n * Verify search system on startup\r\n */\r\nexport async function verifySearchSystem(): Promise<{\r\n  success: boolean;\r\n  meiliSearch: boolean;\r\n  localSearch: boolean;\r\n  message: string;\r\n}> {\r\n  try {\r\n    const health = await checkSearchHealth();\r\n\r\n    return {\r\n      success: health.status !== 'offline',\r\n      meiliSearch: health.meiliSearch,\r\n      localSearch: health.localSearch,\r\n      message:\r\n        health.status === 'healthy'\r\n          ? 'Search system ready (MeiliSearch + Local)'\r\n          : health.status === 'degraded'\r\n            ? 'Search system ready (Local only - MeiliSearch unavailable)'\r\n            : 'Search system offline',\r\n    };\r\n  } catch (error) {\r\n    return {\r\n      success: false,\r\n      meiliSearch: false,\r\n      localSearch: true,\r\n      message: `Search verification failed: ${error instanceof Error ? error.message : 'Unknown error'}`,\r\n    };\r\n  }\r\n}\r\n\r\n","import { ipc } from '../lib/ipc-typed';\r\n\r\nexport type MultiSourceProvider = 'brave' | 'bing' | 'duckduckgo' | 'custom' | string;\r\n\r\nexport interface MultiSourceSearchResult {\r\n  title: string;\r\n  url: string;\r\n  snippet: string;\r\n  source: MultiSourceProvider;\r\n  score: number;\r\n  domain: string;\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\nexport interface MultiSourceSearchOptions {\r\n  limit?: number;\r\n  language?: string;\r\n}\r\n\r\ntype HybridSearchItem = {\r\n  title?: string;\r\n  url?: string;\r\n  snippet?: string;\r\n  source?: string;\r\n  domain?: string;\r\n  score?: number;\r\n  relevance_score?: number;\r\n  metadata?: Record<string, unknown> & { provider?: string };\r\n};\r\n\r\nconst DEFAULT_RESULT_SCORE = 0.62;\r\n\r\nexport async function multiSourceSearch(\r\n  query: string,\r\n  options?: MultiSourceSearchOptions\r\n): Promise<MultiSourceSearchResult[]> {\r\n  if (!query || !query.trim()) {\r\n    return [];\r\n  }\r\n\r\n  try {\r\n    // Pass language to backend if available\r\n    const response = await ipc.hybridSearch.search(query, options?.limit, options?.language);\r\n    const rawResults = normalizeHybridResults(response);\r\n\r\n    return rawResults.map(item => {\r\n      const domain = item.domain || deriveDomain(item.url);\r\n      const score =\r\n        typeof item.score === 'number'\r\n          ? item.score\r\n          : typeof item.relevance_score === 'number'\r\n            ? item.relevance_score\r\n            : DEFAULT_RESULT_SCORE;\r\n\r\n      return {\r\n        title: item.title || item.url || 'Untitled result',\r\n        url: item.url ?? '',\r\n        snippet: item.snippet ?? '',\r\n        source: (item.source || item.metadata?.provider || 'web') as MultiSourceProvider,\r\n        score,\r\n        domain,\r\n        metadata: item.metadata ?? {},\r\n      };\r\n    });\r\n  } catch (error) {\r\n    console.warn('[MultiSourceSearch] Failed to fetch hybrid results:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\nfunction normalizeHybridResults(payload: unknown): HybridSearchItem[] {\r\n  if (!payload) {\r\n    return [];\r\n  }\r\n\r\n  if (Array.isArray(payload)) {\r\n    return payload.filter(isHybridResult);\r\n  }\r\n\r\n  if (typeof payload === 'object') {\r\n    const candidates = (payload as { results?: unknown }).results;\r\n    if (Array.isArray(candidates)) {\r\n      return candidates.filter(isHybridResult);\r\n    }\r\n  }\r\n\r\n  return [];\r\n}\r\n\r\nfunction isHybridResult(entry: unknown): entry is HybridSearchItem {\r\n  return typeof entry === 'object' && entry !== null;\r\n}\r\n\r\nfunction deriveDomain(url?: string): string {\r\n  if (!url) return '';\r\n  try {\r\n    const parsed = new URL(url);\r\n    return parsed.hostname.replace(/^www\\./, '');\r\n  } catch {\r\n    return '';\r\n  }\r\n}\r\n","/**\n * Bing Web Search API client\n * Requires BING_API_KEY environment variable\n */\n\nexport interface BingSearchResult {\n  id: string;\n  name: string;\n  url: string;\n  snippet: string;\n  displayUrl: string;\n  datePublished?: string;\n  dateLastCrawled?: string;\n}\n\nexport interface BingSearchResponse {\n  webPages?: {\n    value: BingSearchResult[];\n    totalEstimatedMatches?: number;\n  };\n  rankingResponse?: any;\n}\n\n/**\n * Fetch web search results from Bing API\n */\nexport async function fetchBingSearch(\n  query: string,\n  options?: {\n    count?: number;\n    offset?: number;\n    language?: string;\n    market?: string;\n  }\n): Promise<BingSearchResult[]> {\n  const apiKey = import.meta.env.VITE_BING_API_KEY || (window as any).__BING_API_KEY;\n\n  if (!apiKey || apiKey === 'your_bing_api_key_here') {\n    console.warn('[BingSearch] API key not configured');\n    return [];\n  }\n\n  if (!query || query.trim().length < 2) {\n    return [];\n  }\n\n  try {\n    const count = options?.count || 10;\n    const offset = options?.offset || 0;\n    const market = options?.market || options?.language || 'en-US';\n\n    // Use backend proxy instead of direct Bing API call\n    // This avoids Tracking Prevention and keeps API keys secure\n    const API_BASE = import.meta.env.VITE_API_BASE_URL || 'http://localhost:3000';\n    const proxyUrl = `${API_BASE}/api/proxy/bing/search`;\n\n    const response = await fetch(proxyUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n      },\n      body: JSON.stringify({\n        q: query.trim(),\n        count,\n        offset,\n        mkt: market,\n      }),\n    });\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      if (errorData.fallback) {\n        console.warn('[BingSearch] Bing API unavailable, using fallback:', errorData.message);\n      } else {\n        console.warn('[BingSearch] API request failed:', response.status, response.statusText);\n      }\n      return [];\n    }\n\n    const data = await response.json();\n\n    // Handle proxy response format\n    if (data.ok && data.results) {\n      // Proxy returns results directly\n      return data.results.map((item: any) => ({\n        id: item.id || item.url,\n        name: item.name || item.title || '',\n        url: item.url,\n        snippet: item.snippet || item.description || '',\n        displayUrl: item.displayUrl || item.url,\n        datePublished: item.datePublished,\n        dateLastCrawled: item.dateLastCrawled,\n      }));\n    }\n\n    // Fallback: try to parse as Bing response format\n    const bingData = data as BingSearchResponse;\n    if (bingData.webPages?.value) {\n      return bingData.webPages.value;\n    }\n\n    return [];\n  } catch (error) {\n    console.warn('[BingSearch] Search failed:', error);\n    return [];\n  }\n}\n\n/**\n * Format Bing results for research mode\n */\nexport function formatBingResults(results: BingSearchResult[]): Array<{\n  title: string;\n  url: string;\n  snippet: string;\n  domain: string;\n}> {\n  return results.map(result => {\n    try {\n      const urlObj = new URL(result.url);\n      const domain = urlObj.hostname.replace(/^www\\./, '');\n\n      return {\n        title: result.name,\n        url: result.url,\n        snippet: result.snippet,\n        domain,\n      };\n    } catch {\n      return {\n        title: result.name,\n        url: result.url,\n        snippet: result.snippet,\n        domain: result.displayUrl || '',\n      };\n    }\n  });\n}\n","// DuckDuckGo Instant Answer API client\r\n// No API key required - public endpoint\r\n// Also supports HTML scraping for full web results\r\n\r\nexport type DuckDuckGoResult = {\r\n  Heading?: string;\r\n  AbstractText?: string;\r\n  AbstractURL?: string;\r\n  AbstractSource?: string;\r\n  RelatedTopics?: Array<{\r\n    FirstURL?: string;\r\n    Text?: string;\r\n    Name?: string;\r\n  }>;\r\n  Results?: Array<{\r\n    FirstURL: string;\r\n    Text: string;\r\n  }>;\r\n  Answer?: string;\r\n  AnswerType?: string;\r\n  Definition?: string;\r\n  DefinitionURL?: string;\r\n  DefinitionSource?: string;\r\n  Image?: string;\r\n  ImageIsLogo?: number;\r\n  Infobox?: any;\r\n  Redirect?: string;\r\n};\r\n\r\nconst LANGUAGE_LOCALE_MAP: Record<string, string> = {\r\n  hi: 'in-hi',\r\n  ta: 'in-ta',\r\n  te: 'in-te',\r\n  bn: 'in-bn',\r\n  mr: 'in-mr',\r\n  kn: 'in-kn',\r\n  ml: 'in-ml',\r\n  gu: 'in-gu',\r\n  pa: 'in-pa',\r\n  ur: 'pk-ur',\r\n  en: 'us-en',\r\n  es: 'es-es',\r\n  fr: 'fr-fr',\r\n  de: 'de-de',\r\n  pt: 'pt-pt',\r\n  zh: 'cn-zh',\r\n  ja: 'jp-ja',\r\n  ru: 'ru-ru',\r\n};\r\n\r\nfunction getDuckLocale(lang?: string): string {\r\n  if (!lang || lang === 'auto') return 'us-en';\r\n  return LANGUAGE_LOCALE_MAP[lang] || 'us-en';\r\n}\r\n\r\nexport async function fetchDuckDuckGoInstant(\r\n  query: string,\r\n  language?: string\r\n): Promise<DuckDuckGoResult | null> {\r\n  if (!query || query.trim().length < 1) return null;\r\n\r\n  const normalizedQuery = query.trim();\r\n  \r\n  // OPTIMIZATION: Normalize query - remove extra spaces, handle special characters\r\n  const cleanQuery = normalizedQuery\r\n    .replace(/\\s+/g, ' ')\r\n    .replace(/[^\\w\\s\\-.,!?]/g, '')\r\n    .trim();\r\n\r\n  if (cleanQuery.length < 1) return null;\r\n\r\n  try {\r\n    // Try Tauri search_proxy first (bypasses CORS and activates DuckDuckGo)\r\n    if (typeof window !== 'undefined' && (window as any).__TAURI__) {\r\n      try {\r\n        const { invoke } = await import('@tauri-apps/api/core');\r\n        const result = await invoke('search_proxy', { query: cleanQuery });\r\n        if (result && typeof result === 'object') {\r\n          console.debug('[DuckDuckGo] Using Tauri search_proxy (activated)');\r\n          return result as DuckDuckGoResult;\r\n        }\r\n      } catch (tauriError) {\r\n        // Fall through to direct fetch\r\n        if (import.meta.env.DEV) {\r\n          console.debug('[DuckDuckGo] Tauri search_proxy failed, using direct fetch:', tauriError);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Fallback: Direct fetch to DuckDuckGo API with retry logic\r\n    const locale = getDuckLocale(language);\r\n    const langCode = locale.split('-')[0];\r\n    const url = `https://api.duckduckgo.com/?q=${encodeURIComponent(cleanQuery)}&format=json&no_redirect=1&skip_disambig=1&kl=${locale}&hl=${langCode}`;\r\n    \r\n    // OPTIMIZATION: Add timeout and retry logic\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), 8000); // 8 second timeout\r\n    \r\n    try {\r\n      const res = await fetch(url, {\r\n        headers: {\r\n          Accept: 'application/json',\r\n          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',\r\n        },\r\n        signal: controller.signal,\r\n      });\r\n\r\n      clearTimeout(timeoutId);\r\n\r\n      if (!res.ok) {\r\n        console.warn('[DuckDuckGo] API request failed:', res.status);\r\n        // Retry once with a simpler query if it's a long query\r\n        if (cleanQuery.length > 50 && res.status === 429) {\r\n          const shortQuery = cleanQuery.split(' ').slice(0, 5).join(' ');\r\n          return fetchDuckDuckGoInstant(shortQuery, language);\r\n        }\r\n        return null;\r\n      }\r\n\r\n      const data = (await res.json()) as DuckDuckGoResult;\r\n      \r\n      // OPTIMIZATION: Validate response has useful data\r\n      if (data && (data.AbstractText || data.Answer || data.Definition || (data.Results && data.Results.length > 0))) {\r\n        return data;\r\n      }\r\n      \r\n      // If no useful data, return null to trigger fallback\r\n      return null;\r\n    } catch (fetchError) {\r\n      clearTimeout(timeoutId);\r\n      if (fetchError instanceof Error && fetchError.name === 'AbortError') {\r\n        console.warn('[DuckDuckGo] Request timeout');\r\n      } else {\r\n        console.warn('[DuckDuckGo] Fetch failed:', fetchError);\r\n      }\r\n      return null;\r\n    }\r\n  } catch (error) {\r\n    console.warn('[DuckDuckGo] Search failed:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function formatDuckDuckGoResults(result: DuckDuckGoResult | null): Array<{\r\n  title: string;\r\n  url?: string;\r\n  snippet: string;\r\n  type: 'instant' | 'result' | 'related';\r\n}> {\r\n  if (!result) return [];\r\n\r\n  const formatted: Array<{\r\n    title: string;\r\n    url?: string;\r\n    snippet: string;\r\n    type: 'instant' | 'result' | 'related';\r\n  }> = [];\r\n\r\n  // Instant Answer\r\n  if (result.Heading && result.AbstractText) {\r\n    formatted.push({\r\n      title: result.Heading,\r\n      url: result.AbstractURL,\r\n      snippet: result.AbstractText,\r\n      type: 'instant',\r\n    });\r\n  }\r\n\r\n  // Answer box\r\n  if (result.Answer) {\r\n    formatted.push({\r\n      title: result.AnswerType || 'Answer',\r\n      snippet: result.Answer,\r\n      type: 'instant',\r\n    });\r\n  }\r\n\r\n  // Definition\r\n  if (result.Definition) {\r\n    formatted.push({\r\n      title: result.DefinitionSource || 'Definition',\r\n      url: result.DefinitionURL,\r\n      snippet: result.Definition,\r\n      type: 'instant',\r\n    });\r\n  }\r\n\r\n  // Web Results - Extract more results from Instant Answer API\r\n  if (result.Results && result.Results.length > 0) {\r\n    result.Results.slice(0, 10).forEach(r => {\r\n      formatted.push({\r\n        title: r.Text || r.FirstURL,\r\n        url: r.FirstURL,\r\n        snippet: r.Text || '',\r\n        type: 'result',\r\n      });\r\n    });\r\n  }\r\n\r\n  // Related Topics\r\n  if (result.RelatedTopics && result.RelatedTopics.length > 0) {\r\n    result.RelatedTopics.slice(0, 5).forEach(rt => {\r\n      formatted.push({\r\n        title: rt.Text || rt.Name || 'Related',\r\n        url: rt.FirstURL,\r\n        snippet: '',\r\n        type: 'related',\r\n      });\r\n    });\r\n  }\r\n\r\n  return formatted;\r\n}\r\n\r\n/**\r\n * Fetch full web search results from DuckDuckGo HTML\r\n * This scrapes the HTML search page since DuckDuckGo doesn't have a public web search API\r\n * Note: May require CORS proxy in browser environments\r\n */\r\nexport async function fetchDuckDuckGoWeb(\r\n  query: string,\r\n  options?: {\r\n    count?: number;\r\n    language?: string;\r\n  }\r\n): Promise<\r\n  Array<{\r\n    title: string;\r\n    url: string;\r\n    snippet: string;\r\n    domain: string;\r\n  }>\r\n> {\r\n  if (!query || query.trim().length < 2) {\r\n    return [];\r\n  }\r\n\r\n  try {\r\n    const count = options?.count || 10;\r\n    const locale = getDuckLocale(options?.language);\r\n    const langCode = locale.split('-')[0];\r\n\r\n    // Use DuckDuckGo HTML search page\r\n    const searchUrl = `https://html.duckduckgo.com/html/?q=${encodeURIComponent(query.trim())}&kl=${locale}&hl=${langCode}`;\r\n\r\n    // Try to use Tauri search_proxy if available, otherwise direct fetch\r\n    let html: string;\r\n    try {\r\n      // Check if we're in Tauri and can use search_proxy command\r\n      if (typeof window !== 'undefined' && (window as any).__TAURI__) {\r\n        try {\r\n          // Use Tauri invoke to call search_proxy (bypasses CORS)\r\n          // Note: search_proxy returns JSON, not HTML, so we'll use the instant API instead\r\n          // For HTML scraping, we need a different approach\r\n          const instantResult = await fetchDuckDuckGoInstant(query, options?.language);\r\n          if (instantResult) {\r\n            // Convert instant results to web results format\r\n            const formatted = formatDuckDuckGoResults(instantResult);\r\n            return formatted.map(f => ({\r\n              title: f.title,\r\n              url: f.url || '',\r\n              snippet: f.snippet,\r\n              domain: f.url ? new URL(f.url).hostname.replace(/^www\\./, '') : '',\r\n            }));\r\n          }\r\n        } catch (tauriError) {\r\n          console.debug('[DuckDuckGo] Tauri search_proxy failed, trying direct fetch:', tauriError);\r\n        }\r\n      }\r\n\r\n      // Fallback: Direct fetch (may fail due to CORS in browser)\r\n      const response = await fetch(searchUrl, {\r\n        headers: {\r\n          Accept: 'text/html',\r\n          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',\r\n        },\r\n        mode: 'cors',\r\n      });\r\n\r\n      if (!response.ok) {\r\n        console.warn('[DuckDuckGo] Web search failed:', response.status);\r\n        // Fallback to instant API\r\n        const instantResult = await fetchDuckDuckGoInstant(query, options?.language);\r\n        if (instantResult) {\r\n          const formatted = formatDuckDuckGoResults(instantResult);\r\n          return formatted.map(f => ({\r\n            title: f.title,\r\n            url: f.url || '',\r\n            snippet: f.snippet,\r\n            domain: f.url ? new URL(f.url).hostname.replace(/^www\\./, '') : '',\r\n          }));\r\n        }\r\n        return [];\r\n      }\r\n\r\n      html = await response.text();\r\n    } catch (fetchError) {\r\n      // CORS or network error - try instant API as fallback\r\n      console.debug(\r\n        '[DuckDuckGo] Web search blocked (CORS or network), trying instant API:',\r\n        fetchError\r\n      );\r\n      try {\r\n        const instantResult = await fetchDuckDuckGoInstant(query, options?.language);\r\n        if (instantResult) {\r\n          const formatted = formatDuckDuckGoResults(instantResult);\r\n          return formatted.map(f => ({\r\n            title: f.title,\r\n            url: f.url || '',\r\n            snippet: f.snippet,\r\n            domain: f.url ? new URL(f.url).hostname.replace(/^www\\./, '') : '',\r\n          }));\r\n        }\r\n      } catch {\r\n        // Both failed\r\n      }\r\n      return [];\r\n    }\r\n\r\n    const results: Array<{ title: string; url: string; snippet: string; domain: string }> = [];\r\n\r\n    // Parse HTML results - DuckDuckGo HTML structure\r\n    // Modern structure uses data-testid or class-based selectors\r\n    const linkRegex =\r\n      /<a[^>]*href=\"([^\"]+)\"[^>]*class=\"[^\"]*result__a[^\"]*\"[^>]*>([\\s\\S]*?)<\\/a>/gi;\r\n    const snippetRegex = /<a[^>]*class=\"[^\"]*result__snippet[^\"]*\"[^>]*>([\\s\\S]*?)<\\/a>/gi;\r\n\r\n    let match;\r\n    const links: Array<{ url: string; title: string }> = [];\r\n    const snippets: string[] = [];\r\n\r\n    // Extract links\r\n    while ((match = linkRegex.exec(html)) !== null && links.length < count) {\r\n      const url = match[1];\r\n      const title = match[2].replace(/<[^>]*>/g, '').trim();\r\n      if (url && title) {\r\n        links.push({ url, title });\r\n      }\r\n    }\r\n\r\n    // Extract snippets\r\n    while ((match = snippetRegex.exec(html)) !== null && snippets.length < count) {\r\n      const snippet = match[1].replace(/<[^>]*>/g, '').trim();\r\n      if (snippet) {\r\n        snippets.push(snippet);\r\n      }\r\n    }\r\n\r\n    // Combine links and snippets\r\n    for (let i = 0; i < Math.min(links.length, count); i++) {\r\n      try {\r\n        // DuckDuckGo returns relative URLs that need to be resolved\r\n        let fullUrl = links[i].url;\r\n        if (fullUrl.startsWith('/l/?kh=')) {\r\n          // DuckDuckGo redirect URL - extract actual URL\r\n          const urlMatch = fullUrl.match(/uddg=([^&]+)/);\r\n          if (urlMatch) {\r\n            fullUrl = decodeURIComponent(urlMatch[1]);\r\n          }\r\n        } else if (!fullUrl.startsWith('http')) {\r\n          // Relative URL\r\n          fullUrl = `https://${fullUrl}`;\r\n        }\r\n\r\n        const urlObj = new URL(fullUrl);\r\n        const domain = urlObj.hostname.replace(/^www\\./, '');\r\n\r\n        results.push({\r\n          title: links[i].title,\r\n          url: fullUrl,\r\n          snippet: snippets[i] || '',\r\n          domain,\r\n        });\r\n      } catch {\r\n        // Skip invalid URLs\r\n      }\r\n    }\r\n\r\n    return results;\r\n  } catch (error) {\r\n    console.warn('[DuckDuckGo] Web search failed:', error);\r\n    return [];\r\n  }\r\n}\r\n","/**\n * Live Web Search Service\n * Provides unified interface for DuckDuckGo and Bing web search\n * Falls back gracefully when APIs are unavailable\n */\n\nimport { fetchBingSearch, formatBingResults } from './bingSearch';\nimport {\n  fetchDuckDuckGoWeb,\n  fetchDuckDuckGoInstant,\n  formatDuckDuckGoResults,\n} from './duckDuckGoSearch';\n\nexport interface LiveSearchResult {\n  title: string;\n  url: string;\n  snippet: string;\n  domain: string;\n  provider: 'bing' | 'duckduckgo';\n  score: number;\n}\n\nexport interface LiveSearchOptions {\n  count?: number;\n  language?: string;\n  preferBing?: boolean; // Prefer Bing if API key is available\n}\n\n/**\n * Perform live web search using available providers\n * Tries Bing first (if API key available), then DuckDuckGo\n */\nexport async function performLiveWebSearch(\n  query: string,\n  options?: LiveSearchOptions\n): Promise<LiveSearchResult[]> {\n  if (!query || query.trim().length < 2) {\n    return [];\n  }\n\n  const count = options?.count || 10;\n  const language = options?.language;\n  const preferBing = options?.preferBing !== false; // Default to true\n\n  // Try Bing first if preferred and API key is available\n  if (preferBing) {\n    try {\n      const bingResults = await fetchBingSearch(query, {\n        count,\n        language,\n      });\n\n      if (bingResults.length > 0) {\n        const formatted = formatBingResults(bingResults);\n        return formatted.map((result, idx) => ({\n          ...result,\n          provider: 'bing' as const,\n          score: 0.9 - idx * 0.05, // Higher scores for Bing results\n        }));\n      }\n    } catch (error) {\n      console.debug('[LiveWebSearch] Bing search failed, trying DuckDuckGo:', error);\n    }\n  }\n\n  // Fallback to DuckDuckGo web search\n  try {\n    const duckResults = await fetchDuckDuckGoWeb(query, {\n      count,\n      language,\n    });\n\n    if (duckResults.length > 0) {\n      return duckResults.map((result, idx) => ({\n        ...result,\n        provider: 'duckduckgo' as const,\n        score: 0.8 - idx * 0.05, // Slightly lower scores for DuckDuckGo\n      }));\n    }\n  } catch (error) {\n    console.debug('[LiveWebSearch] DuckDuckGo web search failed:', error);\n  }\n\n  // Final fallback: Try DuckDuckGo Instant Answer API (limited results)\n  try {\n    const instantResult = await fetchDuckDuckGoInstant(query, language);\n    if (instantResult) {\n      const formatted = formatDuckDuckGoResults(instantResult);\n      const webResults = formatted.filter(f => f.type === 'result' && f.url).slice(0, count);\n\n      return webResults.map((result, idx) => {\n        try {\n          const urlObj = new URL(result.url!);\n          const domain = urlObj.hostname.replace(/^www\\./, '');\n          return {\n            title: result.title,\n            url: result.url!,\n            snippet: result.snippet,\n            domain,\n            provider: 'duckduckgo' as const,\n            score: 0.7 - idx * 0.05,\n          };\n        } catch {\n          return {\n            title: result.title,\n            url: result.url!,\n            snippet: result.snippet,\n            domain: '',\n            provider: 'duckduckgo' as const,\n            score: 0.7 - idx * 0.05,\n          };\n        }\n      });\n    }\n  } catch (error) {\n    console.debug('[LiveWebSearch] DuckDuckGo instant search failed:', error);\n  }\n\n  return [];\n}\n\n/**\n * Check if live web search is available\n */\nexport function isLiveWebSearchAvailable(): boolean {\n  // Bing is available if API key is set\n  const bingKey = import.meta.env.VITE_BING_API_KEY || (window as any).__BING_API_KEY;\n  const hasBing = bingKey && bingKey !== 'your_bing_api_key_here';\n\n  // DuckDuckGo is always available (no API key needed)\n  return hasBing || true; // At least DuckDuckGo is always available\n}\n","/**\n * Language Auto-Detection Service\n * Uses IndicBERT/mBART models for accurate language detection\n * Falls back to lightweight client-side detection when backend unavailable\n *\n * Supports 22 Indic languages + 100+ global languages\n */\n\nimport { log } from '../utils/logger';\n// import { isBhashiniSupported, getBhashiniSupportedLanguages } from './bhashiniService'; // Reserved for future use\n\n// Language detection result\nexport interface LanguageDetectionResult {\n  language: string; // ISO 639-1 language code\n  confidence: number; // 0.0 to 1.0\n  method: 'indicbert' | 'mbart' | 'client' | 'fallback';\n  isIndic: boolean;\n}\n\n// Supported Indic languages (22 languages)\nconst INDIC_LANGUAGES = [\n  'as', // Assamese\n  'bn', // Bengali\n  'brx', // Bodo\n  'doi', // Dogri\n  'gom', // Konkani\n  'gu', // Gujarati\n  'hi', // Hindi\n  'kn', // Kannada\n  'ks', // Kashmiri\n  'mai', // Maithili\n  'ml', // Malayalam\n  'mni', // Manipuri\n  'mr', // Marathi\n  'ne', // Nepali\n  'or', // Odia\n  'pa', // Punjabi\n  'sa', // Sanskrit\n  'sat', // Santali\n  'sd', // Sindhi\n  'ta', // Tamil\n  'te', // Telugu\n  'ur', // Urdu\n] as const;\n\n// Common language patterns for rule-based detection\nconst LANGUAGE_PATTERNS: Record<string, RegExp[]> = {\n  hi: [\n    /[\\u0900-\\u097F]/, // Devanagari script\n    /\\b(||||||||||||||||||)\\b/,\n  ],\n  ta: [\n    /[\\u0B80-\\u0BFF]/, // Tamil script\n    /\\b(|||||||)\\b/,\n  ],\n  te: [\n    /[\\u0C00-\\u0C7F]/, // Telugu script\n    /\\b(||||||)\\b/,\n  ],\n  bn: [\n    /[\\u0980-\\u09FF]/, // Bengali script\n    /\\b(||||||)\\b/,\n  ],\n  mr: [\n    /[\\u0900-\\u097F]/, // Devanagari (Marathi uses same script as Hindi)\n    /\\b(||||||||||||||||)\\b/,\n  ],\n  kn: [\n    /[\\u0C80-\\u0CFF]/, // Kannada script\n    /\\b(||||||)\\b/,\n  ],\n  ml: [\n    /[\\u0D00-\\u0D7F]/, // Malayalam script\n    /\\b(||||||)\\b/,\n  ],\n  gu: [\n    /[\\u0A80-\\u0AFF]/, // Gujarati script\n    /\\b(||||||||||||||| )\\b/,\n  ],\n  pa: [\n    /[\\u0A00-\\u0A7F]/, // Gurmukhi script\n    /\\b(||||||)\\b/,\n  ],\n  ur: [\n    /[\\u0600-\\u06FF]/, // Arabic script (Urdu)\n    /\\b(||||||)\\b/,\n  ],\n  or: [\n    /[\\u0B00-\\u0B7F]/, // Odia script\n    /\\b(||||||)\\b/,\n  ],\n  as: [\n    /[\\u0980-\\u09FF]/, // Bengali script (Assamese)\n    /\\b(||||||)\\b/,\n  ],\n  ne: [\n    /[\\u0900-\\u097F]/, // Devanagari (Nepali)\n    /\\b(||||||)\\b/,\n  ],\n  sa: [\n    /[\\u0900-\\u097F]/, // Devanagari (Sanskrit)\n    /\\b(||||||)\\b/,\n  ],\n};\n\n/**\n * Check if a language code is Indic\n */\nexport function isIndicLanguage(lang: string): boolean {\n  return INDIC_LANGUAGES.includes(lang as any);\n}\n\n/**\n * Client-side language detection using pattern matching\n * Fast and lightweight, works offline\n */\nfunction detectLanguageClient(text: string): LanguageDetectionResult {\n  if (!text || text.trim().length < 2) {\n    return {\n      language: 'en',\n      confidence: 0.5,\n      method: 'fallback',\n      isIndic: false,\n    };\n  }\n\n  // Check for Indic language patterns\n  const scores: Record<string, number> = {};\n\n  for (const [lang, patterns] of Object.entries(LANGUAGE_PATTERNS)) {\n    let score = 0;\n    for (const pattern of patterns) {\n      const matches = text.match(pattern);\n      if (matches) {\n        score += matches.length;\n      }\n    }\n    if (score > 0) {\n      scores[lang] = score;\n    }\n  }\n\n  // Find language with highest score\n  if (Object.keys(scores).length > 0) {\n    const detectedLang = Object.entries(scores).reduce((a, b) =>\n      scores[a[0]] > scores[b[0]] ? a : b\n    )[0];\n    const maxScore = scores[detectedLang];\n    const confidence = Math.min(0.9, 0.5 + (maxScore / text.length) * 0.4);\n\n    return {\n      language: detectedLang,\n      confidence,\n      method: 'client',\n      isIndic: isIndicLanguage(detectedLang),\n    };\n  }\n\n  // Check for common English patterns\n  const englishPattern = /[a-zA-Z]/;\n  if (englishPattern.test(text)) {\n    return {\n      language: 'en',\n      confidence: 0.7,\n      method: 'client',\n      isIndic: false,\n    };\n  }\n\n  // Default fallback\n  return {\n    language: 'en',\n    confidence: 0.5,\n    method: 'fallback',\n    isIndic: false,\n  };\n}\n\n/**\n * Detect language using IndicBERT (via backend API)\n * More accurate for Indic languages\n */\nasync function detectLanguageIndicBERT(text: string): Promise<LanguageDetectionResult | null> {\n  try {\n    // Check if backend API is available\n    const { ipc } = await import('../lib/ipc-typed');\n\n    // Try to call backend language detection endpoint\n    // Note: This assumes backend has IndicBERT model loaded\n    const result = await ipc.research\n      ?.queryEnhanced?.({\n        query: `Detect language: ${text.slice(0, 500)}`,\n        language: 'auto',\n      })\n      .catch(() => null);\n\n    if (result && typeof result === 'object' && 'detectedLanguage' in result) {\n      const detectedLang = (result as any).detectedLanguage || 'en';\n      return {\n        language: detectedLang,\n        confidence: (result as any).confidence || 0.95,\n        method: 'indicbert',\n        isIndic: isIndicLanguage(detectedLang),\n      };\n    }\n  } catch (error) {\n    log.warn('[LanguageDetection] IndicBERT detection failed:', error);\n  }\n\n  return null;\n}\n\n/**\n * Detect language using mBART (via backend API)\n * Good for multilingual text\n */\nasync function detectLanguagemBART(text: string): Promise<LanguageDetectionResult | null> {\n  try {\n    // Check if backend API is available\n    const { ipc } = await import('../lib/ipc-typed');\n\n    // Try to call backend language detection endpoint with mBART\n    const result = await ipc.research\n      ?.queryEnhanced?.({\n        query: `Detect language with mBART: ${text.slice(0, 500)}`,\n        language: 'auto',\n      })\n      .catch(() => null);\n\n    if (result && typeof result === 'object' && 'detectedLanguage' in result) {\n      const detectedLang = (result as any).detectedLanguage || 'en';\n      return {\n        language: detectedLang,\n        confidence: (result as any).confidence || 0.9,\n        method: 'mbart',\n        isIndic: isIndicLanguage(detectedLang),\n      };\n    }\n  } catch (error) {\n    log.warn('[LanguageDetection] mBART detection failed:', error);\n  }\n\n  return null;\n}\n\n/**\n * Auto-detect language of text\n * Tries IndicBERT/mBART first, falls back to client-side detection\n */\nexport async function detectLanguage(\n  text: string,\n  options?: {\n    preferIndic?: boolean; // Prefer Indic language detection\n    useBackend?: boolean; // Use backend models (IndicBERT/mBART)\n  }\n): Promise<LanguageDetectionResult> {\n  if (!text || text.trim().length < 2) {\n    return {\n      language: 'en',\n      confidence: 0.5,\n      method: 'fallback',\n      isIndic: false,\n    };\n  }\n\n  const trimmedText = text.trim();\n  const preferIndic = options?.preferIndic ?? true;\n  const useBackend = options?.useBackend ?? true;\n\n  // If backend is available and enabled, try IndicBERT/mBART\n  if (useBackend && typeof window !== 'undefined' && navigator.onLine) {\n    // For Indic languages, try IndicBERT first\n    if (preferIndic) {\n      const indicResult = await detectLanguageIndicBERT(trimmedText);\n      if (indicResult && indicResult.confidence > 0.8) {\n        return indicResult;\n      }\n    }\n\n    // Try mBART for general multilingual detection\n    const mbartResult = await detectLanguagemBART(trimmedText);\n    if (mbartResult && mbartResult.confidence > 0.8) {\n      return mbartResult;\n    }\n  }\n\n  // Fallback to client-side detection\n  return detectLanguageClient(trimmedText);\n}\n\n/**\n * Detect multiple languages in text (for mixed-language content)\n */\nexport async function detectLanguages(\n  text: string,\n  options?: {\n    maxLanguages?: number;\n    minConfidence?: number;\n  }\n): Promise<LanguageDetectionResult[]> {\n  const maxLanguages = options?.maxLanguages ?? 3;\n  const minConfidence = options?.minConfidence ?? 0.6;\n\n  // Split text into sentences/segments\n  const segments = text.split(/[.!?]\\s+/).filter(s => s.trim().length > 10);\n\n  if (segments.length === 0) {\n    return [await detectLanguage(text)];\n  }\n\n  // Detect language for each segment\n  const results = await Promise.all(segments.map(seg => detectLanguage(seg)));\n\n  // Aggregate results\n  const languageScores: Record<string, { count: number; totalConfidence: number }> = {};\n\n  for (const result of results) {\n    if (result.confidence >= minConfidence) {\n      if (!languageScores[result.language]) {\n        languageScores[result.language] = { count: 0, totalConfidence: 0 };\n      }\n      languageScores[result.language].count++;\n      languageScores[result.language].totalConfidence += result.confidence;\n    }\n  }\n\n  // Sort by count and confidence\n  const sorted = Object.entries(languageScores)\n    .map(([lang, stats]) => ({\n      language: lang,\n      confidence: stats.totalConfidence / stats.count,\n      count: stats.count,\n      method: 'client' as const,\n      isIndic: isIndicLanguage(lang),\n    }))\n    .sort((a, b) => b.count - a.count || b.confidence - a.confidence)\n    .slice(0, maxLanguages);\n\n  return sorted.length > 0 ? sorted : [await detectLanguage(text)];\n}\n\n/**\n * Get supported languages for detection\n */\nexport function getSupportedLanguages(): string[] {\n  return [\n    ...INDIC_LANGUAGES,\n    'en', // English\n    'es', // Spanish\n    'fr', // French\n    'de', // German\n    'pt', // Portuguese\n    'zh', // Chinese\n    'ja', // Japanese\n    'ko', // Korean\n    'ru', // Russian\n    'ar', // Arabic\n    'fa', // Persian\n    'tr', // Turkish\n    'id', // Indonesian\n    'th', // Thai\n    'vi', // Vietnamese\n  ];\n}\n","export type LanguageMeta = {\r\n  code: string;\r\n  nativeName: string;\r\n  englishName: string;\r\n  accent: string;\r\n  gradient: [string, string];\r\n  waveform: [string, string];\r\n};\r\n\r\nconst DEFAULT_META: LanguageMeta = {\r\n  code: 'en',\r\n  nativeName: 'English',\r\n  englishName: 'English',\r\n  accent: '#38bdf8',\r\n  gradient: ['#2563eb', '#38bdf8'],\r\n  waveform: ['#38bdf8', '#a5f3fc'],\r\n};\r\n\r\nconst META_MAP: Record<string, LanguageMeta> = {\r\n  en: DEFAULT_META,\r\n  hi: {\r\n    code: 'hi',\r\n    nativeName: '',\r\n    englishName: 'Hindi',\r\n    accent: '#f97316',\r\n    gradient: ['#f97316', '#ec4899'],\r\n    waveform: ['#f97316', '#facc15'],\r\n  },\r\n  ta: {\r\n    code: 'ta',\r\n    nativeName: '',\r\n    englishName: 'Tamil',\r\n    accent: '#a855f7',\r\n    gradient: ['#a855f7', '#ec4899'],\r\n    waveform: ['#a855f7', '#f472b6'],\r\n  },\r\n  bn: {\r\n    code: 'bn',\r\n    nativeName: '',\r\n    englishName: 'Bengali',\r\n    accent: '#fbbf24',\r\n    gradient: ['#fbbf24', '#f97316'],\r\n    waveform: ['#f97316', '#fbbf24'],\r\n  },\r\n  te: {\r\n    code: 'te',\r\n    nativeName: '',\r\n    englishName: 'Telugu',\r\n    accent: '#fb7185',\r\n    gradient: ['#fb7185', '#f97316'],\r\n    waveform: ['#fb7185', '#fcd34d'],\r\n  },\r\n  mr: {\r\n    code: 'mr',\r\n    nativeName: '',\r\n    englishName: 'Marathi',\r\n    accent: '#22d3ee',\r\n    gradient: ['#22d3ee', '#3b82f6'],\r\n    waveform: ['#22d3ee', '#a78bfa'],\r\n  },\r\n};\r\n\r\nexport function getLanguageMeta(code?: string): LanguageMeta {\r\n  if (!code || code === 'auto') return DEFAULT_META;\r\n  const normalized = code.toLowerCase();\r\n  return META_MAP[normalized] || DEFAULT_META;\r\n}\r\n","import { useEffect, useRef, useState } from 'react';\nimport { toast } from '../utils/toast';\nimport { useSettingsStore } from '../state/settingsStore';\nimport { Mic, MicOff } from 'lucide-react';\nimport { getLanguageMeta } from '../constants/languageMeta';\n\ntype Props = { onResult: (text: string) => void; small?: boolean };\n\nconst LANGUAGE_LOCALE_MAP: Record<string, string> = {\n  hi: 'hi-IN',\n  ta: 'ta-IN',\n  te: 'te-IN',\n  bn: 'bn-IN',\n  mr: 'mr-IN',\n  kn: 'kn-IN',\n  ml: 'ml-IN',\n  gu: 'gu-IN',\n  pa: 'pa-IN',\n  ur: 'ur-PK',\n  en: 'en-US',\n  es: 'es-ES',\n  fr: 'fr-FR',\n  de: 'de-DE',\n  zh: 'zh-CN',\n  ja: 'ja-JP',\n  ko: 'ko-KR',\n  ru: 'ru-RU',\n  pt: 'pt-PT',\n  ar: 'ar-SA',\n};\n\nfunction getSpeechRecognitionLocale(lang?: string): string {\n  if (!lang || lang === 'auto') return 'en-US';\n  return LANGUAGE_LOCALE_MAP[lang] || lang.includes('-') ? lang : `${lang}-${lang.toUpperCase()}`;\n}\n\nconst LANGUAGE_LABELS: Record<string, string> = {\n  hi: '',\n  ta: '',\n  te: '',\n  bn: '',\n  mr: '',\n  kn: '',\n  ml: '',\n  gu: '',\n  pa: '',\n  ur: '',\n  en: 'English',\n  es: 'Espaol',\n  fr: 'Franais',\n  de: 'Deutsch',\n  zh: '',\n  ja: '',\n  ko: '',\n  ru: '',\n  pt: 'Portugus',\n  ar: '',\n};\n\nexport default function VoiceButton({ onResult, small }: Props) {\n  const [active, setActive] = useState(false);\n  const [isAvailable, setIsAvailable] = useState(false);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const recogRef = useRef<any>(null);\n  const animationRef = useRef<number | null>(null);\n  const language = useSettingsStore(state => state.language || 'auto');\n  const langLabel = LANGUAGE_LABELS[language] || language || 'auto';\n  const languageMeta = getLanguageMeta(language);\n\n  useEffect(() => {\n    const SR: any = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\n    if (SR) {\n      try {\n        const r = new SR();\n        r.continuous = false;\n        r.interimResults = false;\n        r.lang = getSpeechRecognitionLocale(language);\n        r.onresult = (e: any) => {\n          try {\n            setIsProcessing(true);\n            const results = Array.isArray(e.results) ? Array.from(e.results) : [];\n            const transcripts = results\n              .map((res: any) => res?.[0]?.transcript)\n              .filter((t: any) => t && typeof t === 'string');\n            const t = transcripts.join(' ').trim();\n            if (t) {\n              // Show success toast with language info\n              toast.success(`Voice input received in ${langLabel}`);\n              onResult(t);\n            }\n            setActive(false);\n            setIsProcessing(false);\n          } catch (error) {\n            console.error('[VoiceButton] Error processing speech result:', error);\n            setActive(false);\n            setIsProcessing(false);\n            toast.error('Failed to process speech recognition result.');\n          }\n        };\n        r.onerror = (e: any) => {\n          console.error('[VoiceButton] Speech recognition error:', e.error);\n          setActive(false);\n          setIsProcessing(false);\n          stopWaveformAnimation();\n          if (e.error === 'not-allowed') {\n            toast.error('Microphone permission denied. Please enable it in your browser settings.');\n          } else if (e.error === 'no-speech') {\n            toast.error(`No speech detected in ${langLabel}. Please try again.`);\n          } else {\n            toast.error('Speech recognition failed. Please try again.');\n          }\n        };\n        r.onend = () => {\n          setActive(false);\n          setIsProcessing(false);\n          stopWaveformAnimation();\n        };\n        recogRef.current = r;\n        setIsAvailable(true);\n      } catch (error) {\n        console.error('[VoiceButton] Failed to initialize speech recognition:', error);\n        setIsAvailable(false);\n      }\n    } else {\n      setIsAvailable(false);\n    }\n  }, [onResult, language]);\n\n  // Update language when it changes\n  useEffect(() => {\n    if (recogRef.current) {\n      recogRef.current.lang = getSpeechRecognitionLocale(language);\n    }\n  }, [language]);\n\n  const start = async () => {\n    const SR: any = recogRef.current;\n    if (!SR || !isAvailable) {\n      toast.error(\n        'Speech recognition is not available in this browser. Please use a supported browser like Chrome or Edge.'\n      );\n      return;\n    }\n\n    // Check if already active\n    if (active) {\n      try {\n        SR.stop();\n        setActive(false);\n        stopWaveformAnimation();\n      } catch (error) {\n        console.error('[VoiceButton] Failed to stop recognition:', error);\n      }\n      return;\n    }\n\n    try {\n      setActive(true);\n      setIsProcessing(true);\n      // Show loading toast with language info\n      toast.info(`Listening in ${langLabel}... Speak now`);\n      SR.start();\n\n      // Start waveform animation\n      startWaveformAnimation();\n    } catch (error: any) {\n      console.error('[VoiceButton] Failed to start recognition:', error);\n      setActive(false);\n      setIsProcessing(false);\n      stopWaveformAnimation();\n      toast.error('Failed to start voice recognition. Please try again.');\n    }\n  };\n\n  const startWaveformAnimation = () => {\n    if (animationRef.current) return;\n    const animate = () => {\n      if (active) {\n        animationRef.current = requestAnimationFrame(animate);\n      } else {\n        animationRef.current = null;\n      }\n    };\n    animate();\n  };\n\n  const stopWaveformAnimation = () => {\n    if (animationRef.current) {\n      cancelAnimationFrame(animationRef.current);\n      animationRef.current = null;\n    }\n  };\n\n  useEffect(() => {\n    if (!active) {\n      stopWaveformAnimation();\n    }\n    return () => stopWaveformAnimation();\n  }, [active]);\n\n  return (\n    <button\n      type=\"button\"\n      className={`${small ? 'px-2 py-1 text-[11px]' : 'px-3 py-2 text-xs'} ml-2 rounded-lg transition-all focus:outline-none focus:ring-2 focus:ring-blue-400/50 ${\n        active ? 'text-white shadow-lg' : 'bg-neutral-800 text-gray-300 hover:bg-neutral-700'\n      } ${isProcessing ? 'animate-pulse' : ''}`}\n      onClick={start}\n      onKeyDown={e => {\n        if (e.key === 'Enter' || e.key === ' ') {\n          e.preventDefault();\n          start();\n        }\n      }}\n      aria-label={\n        active ? `Stop voice recognition (${langLabel})` : `Start voice search (${langLabel})`\n      }\n      aria-pressed={active}\n      title={`Voice search in ${langLabel}`}\n      disabled={!isAvailable}\n      style={\n        active\n          ? {\n              background: `linear-gradient(120deg, ${languageMeta.gradient[0]}, ${languageMeta.gradient[1]})`,\n              boxShadow: `0 12px 24px ${languageMeta.gradient[0]}40`,\n            }\n          : undefined\n      }\n    >\n      <div className=\"flex items-center gap-2\">\n        {active ? (\n          <>\n            <Mic className=\"h-4 w-4 animate-pulse\" />\n            {!small && (\n              <div className=\"flex items-center gap-1\">\n                {/* Waveform visualization - animated bars */}\n                <div className=\"flex h-4 items-end gap-0.5\">\n                  <div\n                    className=\"w-0.5 rounded-full\"\n                    style={{\n                      height: '60%',\n                      animation: 'waveform 1s ease-in-out infinite',\n                      animationDelay: '0ms',\n                      background: `linear-gradient(180deg, ${languageMeta.waveform[0]}, ${languageMeta.waveform[1]})`,\n                    }}\n                  />\n                  <div\n                    className=\"w-0.5 rounded-full\"\n                    style={{\n                      height: '80%',\n                      animation: 'waveform 1s ease-in-out infinite',\n                      animationDelay: '200ms',\n                      background: `linear-gradient(180deg, ${languageMeta.waveform[0]}, ${languageMeta.waveform[1]})`,\n                    }}\n                  />\n                  <div\n                    className=\"w-0.5 rounded-full\"\n                    style={{\n                      height: '100%',\n                      animation: 'waveform 1s ease-in-out infinite',\n                      animationDelay: '400ms',\n                      background: `linear-gradient(180deg, ${languageMeta.waveform[0]}, ${languageMeta.waveform[1]})`,\n                    }}\n                  />\n                  <div\n                    className=\"w-0.5 rounded-full\"\n                    style={{\n                      height: '70%',\n                      animation: 'waveform 1s ease-in-out infinite',\n                      animationDelay: '600ms',\n                      background: `linear-gradient(180deg, ${languageMeta.waveform[0]}, ${languageMeta.waveform[1]})`,\n                    }}\n                  />\n                  <div\n                    className=\"w-0.5 rounded-full\"\n                    style={{\n                      height: '90%',\n                      animation: 'waveform 1s ease-in-out infinite',\n                      animationDelay: '800ms',\n                      background: `linear-gradient(180deg, ${languageMeta.waveform[0]}, ${languageMeta.waveform[1]})`,\n                    }}\n                  />\n                </div>\n                <style>{`\n                  @keyframes waveform {\n                    0%, 100% { transform: scaleY(0.5); opacity: 0.7; }\n                    50% { transform: scaleY(1); opacity: 1; }\n                  }\n                `}</style>\n                <span className=\"ml-1 text-xs\">{langLabel}</span>\n              </div>\n            )}\n          </>\n        ) : (\n          <>\n            <MicOff className=\"h-4 w-4\" />\n            {!small && <span className=\"text-xs\">{langLabel}</span>}\n          </>\n        )}\n      </div>\n    </button>\n  );\n}\n","/**\r\n * Stagehand Integration for Research Mode\r\n * Adds developer-friendly scripting API\r\n */\r\n\r\nimport { useEffect } from 'react';\r\nimport { useStagehand } from '../../hooks/useStagehand';\r\n\r\nexport function ResearchStagehandIntegration() {\r\n  const { stagehand, execute, click, type, extract } = useStagehand({\r\n    context: 'research',\r\n  });\r\n\r\n  useEffect(() => {\r\n    // Expose Stagehand API to window for console access\r\n    if (typeof window !== 'undefined') {\r\n      (window as any).researchStagehand = {\r\n        stagehand,\r\n        execute,\r\n        click,\r\n        type,\r\n        extract,\r\n        // Research-specific helpers\r\n        search: async (query: string) => {\r\n          await click({ text: 'Search' });\r\n          await type('input[type=\"search\"]', query);\r\n          await click('button[type=\"submit\"]');\r\n        },\r\n        getSources: async () => {\r\n          const sources = await extract('.source-list');\r\n          return sources;\r\n        },\r\n      };\r\n    }\r\n\r\n    return () => {\r\n      if (typeof window !== 'undefined') {\r\n        delete (window as any).researchStagehand;\r\n      }\r\n    };\r\n  }, [stagehand, execute, click, type, extract]);\r\n\r\n  return null; // This is a side-effect component\r\n}\r\n\r\n","// Lightweight local search using Lunr\n// npm i lunr\n// @ts-ignore - lunr types may not be available\nimport lunr from 'lunr';\n\ntype IndexDoc = { id: string; title: string; body: string };\n\nlet idx: any = null;\nlet docs: Record<string, IndexDoc> = {};\n\nexport async function loadIndex() {\n  if (idx) return idx;\n  \n  try {\n    const res = await fetch('/lunr-index.json');\n    if (!res.ok) throw new Error('No index available');\n    const { index, documents } = await res.json();\n    \n    // Reconstruct lunr index\n    idx = lunr.Index.load(index);\n    docs = documents;\n    return idx;\n  } catch {\n    // Fallback: build minimal in-memory index (empty)\n    idx = lunr(function (this: any) {\n      this.ref('id');\n      this.field('title', { boost: 10 });\n      this.field('body');\n    });\n    docs = {};\n    return idx;\n  }\n}\n\nexport async function searchLocal(query: string): Promise<Array<{ id: string; title: string; snippet: string }>> {\n  await loadIndex();\n  if (!idx) return [];\n  \n  const hits = idx.search(query);\n  return hits.slice(0, 10).map((h: any) => {\n    const d = docs[h.ref];\n    if (!d) return { id: h.ref, title: 'Unknown', snippet: '' };\n    return { \n      id: d.id, \n      title: d.title, \n      snippet: d.body.slice(0, 180) + (d.body.length > 180 ? '...' : '')\n    };\n  });\n}\n\n","/**\r\n * Optimized Multi-Engine Search Service\r\n * Tries multiple search engines with intelligent fallbacks\r\n * Works with any query/name and optimizes results\r\n */\r\n\r\nimport { fetchDuckDuckGoInstant, fetchDuckDuckGoWeb, formatDuckDuckGoResults } from './duckDuckGoSearch';\r\nimport { fetchBingSearch, formatBingResults } from './bingSearch';\r\nimport { multiSourceSearch } from './multiSourceSearch';\r\nimport { performLiveWebSearch } from './liveWebSearch';\r\nimport { searchLocal } from '../utils/lunrIndex';\r\n\r\nexport interface OptimizedSearchResult {\r\n  title: string;\r\n  url: string;\r\n  snippet: string;\r\n  domain: string;\r\n  provider: 'duckduckgo' | 'bing' | 'brave' | 'multi' | 'local' | 'fallback';\r\n  score: number;\r\n  timestamp: number;\r\n}\r\n\r\nexport interface OptimizedSearchOptions {\r\n  count?: number;\r\n  language?: string;\r\n  timeout?: number; // Timeout in milliseconds\r\n  preferProvider?: 'duckduckgo' | 'bing' | 'brave' | 'multi' | 'auto';\r\n}\r\n\r\nconst DEFAULT_TIMEOUT = 8000; // 8 seconds\r\nconst DEFAULT_COUNT = 10;\r\n\r\n/**\r\n * Optimized search that tries multiple engines with intelligent fallbacks\r\n * Guarantees results for any query/name\r\n */\r\nexport async function optimizedSearch(\r\n  query: string,\r\n  options?: OptimizedSearchOptions\r\n): Promise<OptimizedSearchResult[]> {\r\n  if (!query || query.trim().length < 1) {\r\n    return [];\r\n  }\r\n\r\n  const normalizedQuery = query.trim();\r\n  const count = options?.count || DEFAULT_COUNT;\r\n  const language = options?.language;\r\n  const timeout = options?.timeout || DEFAULT_TIMEOUT;\r\n  const preferProvider = options?.preferProvider || 'auto';\r\n\r\n  // Strategy: Try multiple engines in parallel, use first successful result\r\n  const searchPromises: Array<Promise<OptimizedSearchResult[]>> = [];\r\n\r\n  // 1. Try backend hybrid search (Brave/Bing/Multi-source) - fastest and most reliable\r\n  if (preferProvider === 'auto' || preferProvider === 'brave' || preferProvider === 'multi') {\r\n    searchPromises.push(\r\n      multiSourceSearch(normalizedQuery, { limit: count, language })\r\n        .then(results =>\r\n          results.map((r, idx) => ({\r\n            title: r.title,\r\n            url: r.url,\r\n            snippet: r.snippet,\r\n            domain: r.domain,\r\n            provider: (r.source === 'brave' ? 'brave' : r.source === 'bing' ? 'bing' : 'multi') as OptimizedSearchResult['provider'],\r\n            score: r.score || 0.9 - idx * 0.05,\r\n            timestamp: Date.now(),\r\n          }))\r\n        )\r\n        .catch(() => [])\r\n    );\r\n  }\r\n\r\n  // 2. Try DuckDuckGo Web Search (no API key needed)\r\n  if (preferProvider === 'auto' || preferProvider === 'duckduckgo') {\r\n    searchPromises.push(\r\n      fetchDuckDuckGoWeb(normalizedQuery, { count, language })\r\n        .then(results =>\r\n          results.map((r, idx) => ({\r\n            title: r.title,\r\n            url: r.url,\r\n            snippet: r.snippet,\r\n            domain: r.domain,\r\n            provider: 'duckduckgo' as const,\r\n            score: 0.85 - idx * 0.05,\r\n            timestamp: Date.now(),\r\n          }))\r\n        )\r\n        .catch(() => [])\r\n    );\r\n  }\r\n\r\n  // 3. Try Bing Search (if API key available)\r\n  if (preferProvider === 'auto' || preferProvider === 'bing') {\r\n    searchPromises.push(\r\n      fetchBingSearch(normalizedQuery, { count, language })\r\n        .then(results => {\r\n          const formatted = formatBingResults(results);\r\n          return formatted.map((r, idx) => ({\r\n            title: r.title,\r\n            url: r.url,\r\n            snippet: r.snippet,\r\n            domain: r.domain,\r\n            provider: 'bing' as const,\r\n            score: 0.9 - idx * 0.05,\r\n            timestamp: Date.now(),\r\n          }));\r\n        })\r\n        .catch(() => [])\r\n    );\r\n  }\r\n\r\n  // 4. Try Live Web Search (Bing + DuckDuckGo fallback)\r\n  searchPromises.push(\r\n    performLiveWebSearch(normalizedQuery, { count, language })\r\n      .then(results =>\r\n        results.map(r => ({\r\n          title: r.title,\r\n          url: r.url,\r\n          snippet: r.snippet,\r\n          domain: r.domain,\r\n          provider: r.provider === 'bing' ? 'bing' : 'duckduckgo',\r\n          score: r.score,\r\n          timestamp: Date.now(),\r\n        }))\r\n      )\r\n      .catch(() => [])\r\n  );\r\n\r\n  // 5. Try DuckDuckGo Instant Answer API (always available, limited results)\r\n  searchPromises.push(\r\n    fetchDuckDuckGoInstant(normalizedQuery, language)\r\n      .then(result => {\r\n        if (!result) return [];\r\n        const formatted = formatDuckDuckGoResults(result);\r\n        return formatted\r\n          .filter(f => f.url && f.type === 'result')\r\n          .slice(0, count)\r\n          .map((f, idx) => {\r\n            try {\r\n              const urlObj = new URL(f.url!);\r\n              return {\r\n                title: f.title,\r\n                url: f.url!,\r\n                snippet: f.snippet,\r\n                domain: urlObj.hostname.replace(/^www\\./, ''),\r\n                provider: 'duckduckgo' as const,\r\n                score: 0.75 - idx * 0.05,\r\n                timestamp: Date.now(),\r\n              };\r\n            } catch {\r\n              return {\r\n                title: f.title,\r\n                url: f.url!,\r\n                snippet: f.snippet,\r\n                domain: '',\r\n                provider: 'duckduckgo' as const,\r\n                score: 0.75 - idx * 0.05,\r\n                timestamp: Date.now(),\r\n              };\r\n            }\r\n          });\r\n      })\r\n      .catch(() => [])\r\n  );\r\n\r\n  // 6. Try local search (offline fallback)\r\n  searchPromises.push(\r\n    searchLocal(normalizedQuery)\r\n      .then(results =>\r\n        results.map((r, idx) => ({\r\n          title: r.title,\r\n          url: '', // Local results don't have URLs\r\n          snippet: r.snippet,\r\n          domain: 'local',\r\n          provider: 'local' as const,\r\n          score: 0.7 - idx * 0.03,\r\n          timestamp: Date.now(),\r\n        }))\r\n      )\r\n      .catch(() => [])\r\n  );\r\n\r\n  // Race: Use first successful result, or combine all if needed\r\n  try {\r\n    const results = await Promise.race([\r\n      Promise.allSettled(searchPromises).then(settled => {\r\n        // Find first successful result\r\n        for (const result of settled) {\r\n          if (result.status === 'fulfilled' && result.value.length > 0) {\r\n            return result.value;\r\n          }\r\n        }\r\n        // If no single provider succeeded, combine all results\r\n        const allResults: OptimizedSearchResult[] = [];\r\n        for (const result of settled) {\r\n          if (result.status === 'fulfilled') {\r\n            allResults.push(...result.value);\r\n          }\r\n        }\r\n        return allResults;\r\n      }),\r\n      new Promise<OptimizedSearchResult[]>((_, reject) =>\r\n        setTimeout(() => reject(new Error('Search timeout')), timeout)\r\n      ),\r\n    ]);\r\n\r\n    // Deduplicate by URL\r\n    const seenUrls = new Set<string>();\r\n    const deduplicated = results\r\n      .filter(r => {\r\n        if (!r.url || seenUrls.has(r.url)) return false;\r\n        seenUrls.add(r.url);\r\n        return true;\r\n      })\r\n      .sort((a, b) => b.score - a.score) // Sort by score\r\n      .slice(0, count);\r\n\r\n    return deduplicated.length > 0 ? deduplicated : getFallbackResults(normalizedQuery, count);\r\n  } catch (error) {\r\n    console.warn('[OptimizedSearch] All search engines failed, using fallback:', error);\r\n    return getFallbackResults(normalizedQuery, count);\r\n  }\r\n}\r\n\r\n/**\r\n * Generate fallback results when all search engines fail\r\n * Creates synthetic results based on query\r\n */\r\nfunction getFallbackResults(query: string, count: number): OptimizedSearchResult[] {\r\n  // Try one more time with DuckDuckGo Instant (most reliable)\r\n  const fallbackProvider: OptimizedSearchResult['provider'] = 'fallback';\r\n  return [\r\n    {\r\n      title: `Search results for \"${query}\"`,\r\n      url: `https://duckduckgo.com/?q=${encodeURIComponent(query)}`,\r\n      snippet: `Click to search \"${query}\" on DuckDuckGo directly.`,\r\n      domain: 'duckduckgo.com',\r\n      provider: fallbackProvider,\r\n      score: 0.5,\r\n      timestamp: Date.now(),\r\n    },\r\n    {\r\n      title: `Google Search: ${query}`,\r\n      url: `https://www.google.com/search?q=${encodeURIComponent(query)}`,\r\n      snippet: `Click to search \"${query}\" on Google.`,\r\n      domain: 'google.com',\r\n      provider: fallbackProvider,\r\n      score: 0.5,\r\n      timestamp: Date.now(),\r\n    },\r\n    {\r\n      title: `Bing Search: ${query}`,\r\n      url: `https://www.bing.com/search?q=${encodeURIComponent(query)}`,\r\n      snippet: `Click to search \"${query}\" on Bing.`,\r\n      domain: 'bing.com',\r\n      provider: fallbackProvider,\r\n      score: 0.5,\r\n      timestamp: Date.now(),\r\n    },\r\n  ].slice(0, count);\r\n}\r\n\r\n/**\r\n * Quick search - tries fastest providers first\r\n */\r\nexport async function quickSearch(\r\n  query: string,\r\n  options?: OptimizedSearchOptions\r\n): Promise<OptimizedSearchResult[]> {\r\n  if (!query || query.trim().length < 1) {\r\n    return [];\r\n  }\r\n\r\n  const normalizedQuery = query.trim();\r\n  const count = options?.count || 5; // Fewer results for quick search\r\n  const language = options?.language;\r\n\r\n  // Try fastest providers first\r\n  try {\r\n    // 1. Backend hybrid search (fastest)\r\n    const hybridResults = await multiSourceSearch(normalizedQuery, { limit: count, language });\r\n    if (hybridResults.length > 0) {\r\n      return hybridResults.map((r, idx) => {\r\n        let provider: OptimizedSearchResult['provider'] = 'multi';\r\n        if (r.source === 'brave') provider = 'brave';\r\n        else if (r.source === 'bing') provider = 'bing';\r\n        else if (r.source === 'duckduckgo') provider = 'duckduckgo';\r\n        \r\n        return {\r\n          title: r.title,\r\n          url: r.url,\r\n          snippet: r.snippet,\r\n          domain: r.domain,\r\n          provider,\r\n          score: r.score || 0.9 - idx * 0.05,\r\n          timestamp: Date.now(),\r\n        };\r\n      });\r\n    }\r\n  } catch {\r\n    // Continue to next provider\r\n  }\r\n\r\n  // 2. DuckDuckGo Instant (always available)\r\n  try {\r\n    const instantResult = await fetchDuckDuckGoInstant(normalizedQuery, language);\r\n    if (instantResult) {\r\n      const formatted = formatDuckDuckGoResults(instantResult);\r\n      const results = formatted\r\n        .filter(f => f.url && f.type === 'result')\r\n        .slice(0, count)\r\n        .map((f, idx) => {\r\n          try {\r\n            const urlObj = new URL(f.url!);\r\n            return {\r\n              title: f.title,\r\n              url: f.url!,\r\n              snippet: f.snippet,\r\n              domain: urlObj.hostname.replace(/^www\\./, ''),\r\n              provider: 'duckduckgo' as const,\r\n              score: 0.85 - idx * 0.05,\r\n              timestamp: Date.now(),\r\n            };\r\n          } catch {\r\n            return {\r\n              title: f.title,\r\n              url: f.url!,\r\n              snippet: f.snippet,\r\n              domain: '',\r\n              provider: 'duckduckgo' as const,\r\n              score: 0.85 - idx * 0.05,\r\n              timestamp: Date.now(),\r\n            };\r\n          }\r\n        });\r\n      if (results.length > 0) return results;\r\n    }\r\n  } catch {\r\n    // Continue to fallback\r\n  }\r\n\r\n  // 3. Fallback\r\n  return getFallbackResults(normalizedQuery, count);\r\n}\r\n\r\n/**\r\n * Check which search providers are available\r\n */\r\nexport async function checkSearchProviders(): Promise<{\r\n  duckduckgo: boolean;\r\n  bing: boolean;\r\n  brave: boolean;\r\n  multi: boolean;\r\n  local: boolean;\r\n}> {\r\n  const bingKey = import.meta.env.VITE_BING_API_KEY || (window as any).__BING_API_KEY;\r\n  const hasBing = bingKey && bingKey !== 'your_bing_api_key_here';\r\n\r\n  // Test DuckDuckGo\r\n  let hasDuckDuckGo = false;\r\n  try {\r\n    const testResult = await fetchDuckDuckGoInstant('test', 'en');\r\n    hasDuckDuckGo = testResult !== null;\r\n  } catch {\r\n    hasDuckDuckGo = false;\r\n  }\r\n\r\n  // Test backend hybrid search\r\n  let hasBrave = false;\r\n  let hasMulti = false;\r\n  try {\r\n    const testResults = await multiSourceSearch('test', { limit: 1 });\r\n    hasBrave = testResults.some(r => r.source === 'brave');\r\n    hasMulti = testResults.length > 0;\r\n  } catch {\r\n    hasBrave = false;\r\n    hasMulti = false;\r\n  }\r\n\r\n  // Local search is always available\r\n  const hasLocal = true;\r\n\r\n  return {\r\n    duckduckgo: hasDuckDuckGo,\r\n    bing: hasBing,\r\n    brave: hasBrave,\r\n    multi: hasMulti,\r\n    local: hasLocal,\r\n  };\r\n}\r\n\r\n","/**\n * URL Safety Checks - Tier 2\n * Basic security guardrails for agent operations\n */\n\nimport { log } from '../../utils/logger';\n\n// Blocked hosts (internal/metadata endpoints) - Tier 1: Enhanced security\nconst BLOCKED_HOSTS = [\n  '169.254.169.254', // AWS metadata\n  'metadata.google.internal', // GCP metadata\n  '169.254.169.254', // Azure metadata\n  'localhost',\n  '127.0.0.1',\n  '::1',\n  '0.0.0.0',\n  'metadata.azure.com', // Azure metadata\n  '169.254.169.254', // EC2 metadata\n  'fd00::', // IPv6 private\n  'fe80::', // IPv6 link-local\n];\n\n// Allowed protocols\nconst ALLOWED_PROTOCOLS = ['http:', 'https:'];\n\n/**\n * Check if URL is safe for agent operations\n */\nexport function isUrlSafe(urlString: string): boolean {\n  try {\n    const url = new URL(urlString);\n\n    // Check protocol\n    if (!ALLOWED_PROTOCOLS.includes(url.protocol)) {\n      log.warn(`[UrlSafety] Blocked protocol: ${url.protocol}`);\n      return false;\n    }\n\n    // Check blocked hosts\n    if (BLOCKED_HOSTS.includes(url.hostname)) {\n      log.warn(`[UrlSafety] Blocked host: ${url.hostname}`);\n      return false;\n    }\n\n    // Check for localhost variants\n    if (url.hostname === 'localhost' || url.hostname.endsWith('.localhost')) {\n      log.warn(`[UrlSafety] Blocked localhost variant: ${url.hostname}`);\n      return false;\n    }\n\n    // Check for private IP ranges\n    if (isPrivateIP(url.hostname)) {\n      log.warn(`[UrlSafety] Blocked private IP: ${url.hostname}`);\n      return false;\n    }\n\n    return true;\n  } catch (error) {\n    log.error(`[UrlSafety] Invalid URL: ${urlString}`, error);\n    return false;\n  }\n}\n\n/**\n * Check if hostname is a private IP\n */\nfunction isPrivateIP(hostname: string): boolean {\n  // Simple check for common private IP patterns\n  const privatePatterns = [\n    /^10\\./,\n    /^172\\.(1[6-9]|2[0-9]|3[0-1])\\./,\n    /^192\\.168\\./,\n    /^127\\./,\n    /^::1$/,\n  ];\n\n  return privatePatterns.some(pattern => pattern.test(hostname));\n}\n\n/**\n * Validate URL before agent operation\n */\nexport function validateUrlForAgent(url: string): { safe: boolean; reason?: string } {\n  if (!isUrlSafe(url)) {\n    return {\n      safe: false,\n      reason:\n        'OmniAgent blocked an unsafe URL. Internal and private network addresses are not allowed.',\n    };\n  }\n\n  return { safe: true };\n}\n","import { validateUrlForAgent } from '../core/security/urlSafety';\nimport { log } from '../utils/logger';\n\nconst API_BASE =\n  (typeof window !== 'undefined' ? window.__OB_API_BASE__ : '') ||\n  import.meta.env.VITE_APP_API_URL ||\n  import.meta.env.VITE_API_BASE_URL ||\n  '';\n\nexport interface ScrapeSourcePayload {\n  urls: string[];\n  allow_render?: boolean;\n  use_cache?: boolean;\n  selectors?: string[];\n  max_chars?: number;\n}\n\nexport interface ScrapedSourceResult {\n  url: string;\n  finalUrl?: string;\n  status?: number;\n  title?: string;\n  description?: string;\n  image?: string;\n  excerpt?: string;\n  content?: string;\n  wordCount?: number;\n  lang?: string;\n  contentHash?: string;\n  rendered?: boolean;\n  fromCache?: boolean;\n  fetchedAt?: string;\n  metadata?: Record<string, unknown>;\n  error?: string;\n}\n\ninterface BackendScrapeResponse {\n  results: Array<{\n    url: string;\n    final_url?: string;\n    status?: number;\n    title?: string;\n    description?: string;\n    image?: string;\n    excerpt?: string;\n    content?: string;\n    word_count?: number;\n    lang?: string;\n    content_hash?: string;\n    rendered?: boolean;\n    from_cache?: boolean;\n    fetched_at?: string;\n    metadata?: Record<string, unknown>;\n  }>;\n}\n\nexport async function scrapeResearchSources(\n  urls: string[],\n  _options: Omit<ScrapeSourcePayload, 'urls'> = {}\n): Promise<ScrapedSourceResult[]> {\n  if (!API_BASE || urls.length === 0) {\n    return [];\n  }\n\n  // Tier 1: Security guardrails - validate all URLs before scraping\n  const safeUrls: string[] = [];\n  const blockedUrls: Array<{ url: string; reason: string }> = [];\n\n  for (const url of urls) {\n    const validation = validateUrlForAgent(url);\n    if (validation.safe) {\n      safeUrls.push(url);\n    } else {\n      blockedUrls.push({ url, reason: validation.reason || 'Unsafe URL' });\n      log.warn('[Scraper] Blocked unsafe URL', { url, reason: validation.reason });\n    }\n  }\n\n  // If all URLs are blocked, return empty with error info\n  if (safeUrls.length === 0) {\n    if (blockedUrls.length > 0) {\n      log.error('[Scraper] All URLs blocked by security check', blockedUrls);\n    }\n    return blockedUrls.map(({ url, reason }) => ({\n      url,\n      error: reason || 'URL blocked by security policy',\n    }));\n  }\n\n  // If some URLs are blocked, log warning but continue with safe ones\n  if (blockedUrls.length > 0) {\n    log.warn('[Scraper] Some URLs blocked, proceeding with safe URLs', {\n      blocked: blockedUrls.length,\n      safe: safeUrls.length,\n    });\n  }\n\n  try {\n    // Scrape each URL individually (new route format expects single URL)\n    const results: ScrapedSourceResult[] = [];\n\n    for (const url of safeUrls) {\n      try {\n        const response = await fetch(`${API_BASE.replace(/\\/$/, '')}/api/scrape`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({ url }), // Send single URL\n        });\n\n        if (!response.ok) {\n          const errorData = await response.json().catch(() => ({ error: 'unknown' }));\n          console.warn('[Scraper] Backend returned error for', url, response.status, errorData);\n          results.push({\n            url,\n            error: errorData.error || errorData.message || 'Scrape failed',\n          });\n          continue;\n        }\n\n        const payload = await response.json();\n\n        // Handle new route format: { ok: true, page: {...} }\n        if (payload.ok && payload.page) {\n          results.push({\n            url: payload.page.url || url,\n            title: payload.page.title,\n            excerpt: payload.page.excerpt,\n            content: payload.page.text,\n            wordCount: payload.page.text?.split(/\\s+/).length || 0,\n            lang: 'auto', // Language detection can be added later\n          });\n        } else {\n          // Fallback: try to parse as old format\n          const oldFormat = payload as BackendScrapeResponse;\n          if (oldFormat.results && oldFormat.results.length > 0) {\n            const result = oldFormat.results[0];\n            results.push({\n              url: result.url,\n              finalUrl: result.final_url,\n              status: result.status,\n              title: result.title,\n              description: result.description,\n              image: result.image,\n              excerpt: result.excerpt,\n              content: result.content,\n              wordCount: result.word_count,\n              lang: result.lang,\n              contentHash: result.content_hash,\n              rendered: result.rendered,\n              fromCache: result.from_cache,\n              fetchedAt: result.fetched_at,\n              metadata: result.metadata,\n            });\n          } else {\n            results.push({\n              url,\n              error: 'Unexpected response format',\n            });\n          }\n        }\n      } catch (error) {\n        console.warn('[Scraper] Failed to scrape', url, error);\n        results.push({\n          url,\n          error: error instanceof Error ? error.message : 'Unknown error',\n        });\n      }\n    }\n\n    return results;\n  } catch (error) {\n    console.warn('[Scraper] Failed to fetch sources', error);\n    return [];\n  }\n}\n","/**\n * Voice Command Parser for Research Mode\n * Parses voice commands like \"Research in Bengali about AI\" or \"Research about quantum computing\"\n */\n\nconst LANGUAGE_KEYWORDS: Record<string, string[]> = {\n  hindi: ['hindi', ''],\n  tamil: ['tamil', ''],\n  telugu: ['telugu', ''],\n  bengali: ['bengali', 'bangla', ''],\n  marathi: ['marathi', ''],\n  kannada: ['kannada', ''],\n  malayalam: ['malayalam', ''],\n  gujarati: ['gujarati', ''],\n  punjabi: ['punjabi', ''],\n  urdu: ['urdu', ''],\n  english: ['english'],\n  spanish: ['spanish', 'espaol'],\n  french: ['french', 'franais'],\n  german: ['german', 'deutsch'],\n  chinese: ['chinese', ''],\n  japanese: ['japanese', ''],\n  korean: ['korean', ''],\n  russian: ['russian', ''],\n  portuguese: ['portuguese', 'portugus'],\n  arabic: ['arabic', ''],\n};\n\nconst LANGUAGE_CODE_MAP: Record<string, string> = {\n  hindi: 'hi',\n  tamil: 'ta',\n  telugu: 'te',\n  bengali: 'bn',\n  marathi: 'mr',\n  kannada: 'kn',\n  malayalam: 'ml',\n  gujarati: 'gu',\n  punjabi: 'pa',\n  urdu: 'ur',\n  english: 'en',\n  spanish: 'es',\n  french: 'fr',\n  german: 'de',\n  chinese: 'zh',\n  japanese: 'ja',\n  korean: 'ko',\n  russian: 'ru',\n  portuguese: 'pt',\n  arabic: 'ar',\n};\n\nconst RESEARCH_TRIGGERS = [\n  'research',\n  'search',\n  'find',\n  'look up',\n  'investigate',\n  'explore',\n  'analyze',\n  'study',\n];\n\nexport interface ParsedVoiceCommand {\n  isResearchCommand: boolean;\n  language?: string;\n  query: string;\n  originalText: string;\n}\n\n/**\n * Parse voice command to extract research query and language\n */\nexport function parseResearchVoiceCommand(text: string): ParsedVoiceCommand {\n  const lowerText = text.toLowerCase().trim();\n  const originalText = text.trim();\n\n  // Check if it's a research command\n  const isResearchCommand = RESEARCH_TRIGGERS.some(trigger => lowerText.includes(trigger));\n\n  if (!isResearchCommand) {\n    return {\n      isResearchCommand: false,\n      query: originalText,\n      originalText,\n    };\n  }\n\n  // Extract language from phrases like \"research in [language]\" or \"research [language]\"\n  let detectedLanguage: string | undefined;\n  let query = originalText;\n\n  // Pattern 1: \"research in [language] about [query]\"\n  const inPattern = /research\\s+in\\s+(\\w+)(?:\\s+about\\s+(.+))?/i;\n  const inMatch = originalText.match(inPattern);\n  if (inMatch) {\n    const langKeyword = inMatch[1].toLowerCase();\n    detectedLanguage = findLanguageCode(langKeyword);\n    query = inMatch[2] || originalText.replace(inPattern, '').trim();\n  }\n\n  // Pattern 2: \"research [language] [query]\" (without \"in\")\n  if (!detectedLanguage) {\n    for (const [langName, keywords] of Object.entries(LANGUAGE_KEYWORDS)) {\n      for (const keyword of keywords) {\n        const pattern = new RegExp(`research\\\\s+${keyword}\\\\s+(.+)$`, 'i');\n        const match = originalText.match(pattern);\n        if (match) {\n          detectedLanguage = LANGUAGE_CODE_MAP[langName];\n          query = match[1].trim();\n          break;\n        }\n      }\n      if (detectedLanguage) break;\n    }\n  }\n\n  // Pattern 3: \"research about [query]\" or \"research [query]\"\n  if (!detectedLanguage) {\n    const aboutPattern = /research\\s+(?:about\\s+)?(.+)$/i;\n    const aboutMatch = originalText.match(aboutPattern);\n    if (aboutMatch) {\n      query = aboutMatch[1].trim();\n    } else {\n      // Remove research trigger words and clean up\n      query = originalText\n        .replace(new RegExp(`(${RESEARCH_TRIGGERS.join('|')})\\\\s+`, 'gi'), '')\n        .trim();\n    }\n  }\n\n  // Clean up query - remove common filler words\n  query = query.replace(/^(in|about|on|for|regarding|concerning)\\s+/i, '').trim();\n\n  return {\n    isResearchCommand: true,\n    language: detectedLanguage,\n    query: query || originalText, // Fallback to original if query is empty\n    originalText,\n  };\n}\n\n/**\n * Find language code from keyword\n */\nfunction findLanguageCode(keyword: string): string | undefined {\n  const lowerKeyword = keyword.toLowerCase();\n\n  for (const [langName, keywords] of Object.entries(LANGUAGE_KEYWORDS)) {\n    if (keywords.some(k => k.toLowerCase() === lowerKeyword)) {\n      return LANGUAGE_CODE_MAP[langName];\n    }\n  }\n\n  // Direct code match\n  if (LANGUAGE_CODE_MAP[lowerKeyword]) {\n    return LANGUAGE_CODE_MAP[lowerKeyword];\n  }\n\n  return undefined;\n}\n\n/**\n * Check if text contains a research command\n */\nexport function isResearchCommand(text: string): boolean {\n  return parseResearchVoiceCommand(text).isResearchCommand;\n}\n","/**\n * Offline Summarization Service\n * Uses mBART model for multilingual summarization when offline\n * Falls back to simple extraction when model unavailable\n */\n\nimport { log } from '../utils/logger';\n\nexport interface SummarizationOptions {\n  maxLength?: number;\n  minLength?: number;\n  language?: string;\n  useOfflineModel?: boolean;\n}\n\nexport interface SummarizationResult {\n  summary: string;\n  confidence: number;\n  method: 'mbart' | 'extraction' | 'fallback';\n  language?: string;\n}\n\n// Simple extraction-based summarization (fallback when mBART unavailable)\nfunction extractSummary(text: string, options: SummarizationOptions = {}): string {\n  const maxLength = options.maxLength || 200;\n  const minLength = options.minLength || 50;\n\n  // Remove extra whitespace and normalize\n  const normalized = text.replace(/\\s+/g, ' ').trim();\n\n  // If text is already short enough, return as-is\n  if (normalized.length <= maxLength) {\n    return normalized;\n  }\n\n  // Try to find a good sentence boundary\n  const sentences = normalized.split(/[.!?]\\s+/);\n  let summary = '';\n\n  for (const sentence of sentences) {\n    if ((summary + sentence).length <= maxLength) {\n      summary += (summary ? '. ' : '') + sentence;\n    } else {\n      break;\n    }\n  }\n\n  // If we have a summary, return it\n  if (summary.length >= minLength) {\n    return summary + (summary.endsWith('.') ? '' : '.');\n  }\n\n  // Fallback: truncate at word boundary\n  const words = normalized.split(/\\s+/);\n  summary = '';\n  for (const word of words) {\n    if ((summary + word).length <= maxLength) {\n      summary += (summary ? ' ' : '') + word;\n    } else {\n      break;\n    }\n  }\n\n  return summary + (summary.endsWith('.') ? '' : '.');\n}\n\n/**\n * Summarize text using offline mBART model (if available) or extraction\n */\nexport async function summarizeOffline(\n  text: string,\n  options: SummarizationOptions = {}\n): Promise<SummarizationResult> {\n  if (!text || text.trim().length < 10) {\n    return {\n      summary: text.trim(),\n      confidence: 1.0,\n      method: 'fallback',\n    };\n  }\n\n  const language = options.language || 'auto';\n  const useOfflineModel = options.useOfflineModel !== false; // Default to true\n\n  // Try to use mBART model if available (via local inference)\n  if (useOfflineModel && typeof window !== 'undefined') {\n    // Try to use local Transformers.js or similar if available\n    if (typeof (window as any).transformers !== 'undefined') {\n      try {\n        // Use Transformers.js for client-side mBART inference\n        const { pipeline } = (window as any).transformers;\n        const summarizer = await pipeline(\n          'summarization',\n          'facebook/mbart-large-50-many-to-many-mmt',\n          {\n            device: 'cpu', // Use CPU for offline\n          }\n        );\n\n        const result = await summarizer(text, {\n          max_length: options.maxLength || 200,\n          min_length: options.minLength || 50,\n          do_sample: false,\n        });\n\n        if (result && result[0] && result[0].summary_text) {\n          return {\n            summary: result[0].summary_text,\n            confidence: 0.9,\n            method: 'mbart',\n            language: language !== 'auto' ? language : 'en',\n          };\n        }\n      } catch (error) {\n        log.warn('[OfflineSummarizer] Transformers.js mBART failed, using extraction:', error);\n      }\n    }\n  }\n\n  // Fallback to extraction-based summarization\n  const extracted = extractSummary(text, options);\n  return {\n    summary: extracted,\n    confidence: extracted.length >= (options.minLength || 50) ? 0.7 : 0.5,\n    method: 'extraction',\n    language: language !== 'auto' ? language : 'en',\n  };\n}\n\n/**\n * Summarize multiple texts and combine\n */\nexport async function summarizeMultiple(\n  texts: string[],\n  options: SummarizationOptions = {}\n): Promise<SummarizationResult> {\n  if (texts.length === 0) {\n    return {\n      summary: '',\n      confidence: 0,\n      method: 'fallback',\n    };\n  }\n\n  if (texts.length === 1) {\n    return summarizeOffline(texts[0], options);\n  }\n\n  // Summarize each text individually\n  const summaries = await Promise.all(texts.map(text => summarizeOffline(text, options)));\n\n  // Combine summaries\n  const combined = summaries\n    .map(s => s.summary)\n    .filter(s => s.length > 0)\n    .join(' ');\n\n  // Re-summarize the combined text if it's too long\n  if (combined.length > (options.maxLength || 200) * 2) {\n    return summarizeOffline(combined, options);\n  }\n\n  return {\n    summary: combined,\n    confidence: summaries.reduce((acc, s) => acc + s.confidence, 0) / summaries.length,\n    method: summaries.some(s => s.method === 'mbart') ? 'mbart' : 'extraction',\n    language: options.language !== 'auto' ? options.language : 'en',\n  };\n}\n","import { useMemo, useRef, useState } from 'react';\r\n\r\ntype GraphNode = {\r\n  key: string;\r\n  type?: string;\r\n  title?: string;\r\n  meta?: Record<string, any>;\r\n  created_at?: number;\r\n};\r\n\r\ntype GraphEdge = {\r\n  src: string;\r\n  dst: string;\r\n  rel?: string;\r\n  weight?: number;\r\n  created_at?: number;\r\n};\r\n\r\nexport type ResearchGraphData = {\r\n  nodes: GraphNode[];\r\n  edges: GraphEdge[];\r\n};\r\n\r\ntype PositionedNode = GraphNode & {\r\n  position: { x: number; y: number };\r\n};\r\n\r\ntype PositionedEdge = GraphEdge & {\r\n  source: { x: number; y: number } | undefined;\r\n  target: { x: number; y: number } | undefined;\r\n};\r\n\r\nconst WIDTH = 960;\r\nconst HEIGHT = 420;\r\n\r\nconst COLORS: Record<string, string> = {\r\n  'research-query': '#60a5fa',\r\n  'research-source': '#a855f7',\r\n  'research-evidence': '#facc15',\r\n};\r\n\r\nfunction allowedType(type?: string) {\r\n  return type === 'research-query' || type === 'research-source' || type === 'research-evidence';\r\n}\r\n\r\nfunction buildLayout(graphData: ResearchGraphData | null, queryKey: string | null) {\r\n  if (!graphData || !queryKey) {\r\n    return null;\r\n  }\r\n  const { nodes, edges } = graphData;\r\n  if (!Array.isArray(nodes) || nodes.length === 0) return null;\r\n  const nodeMap = new Map<string, GraphNode>();\r\n  nodes.forEach((node) => {\r\n    if (node?.key) {\r\n      nodeMap.set(node.key, node);\r\n    }\r\n  });\r\n  const queryNode = nodeMap.get(queryKey);\r\n  if (!queryNode) return null;\r\n\r\n  const filteredEdges = edges.filter((edge) => {\r\n    const sourceNode = nodeMap.get(edge.src);\r\n    const targetNode = nodeMap.get(edge.dst);\r\n    return allowedType(sourceNode?.type) && allowedType(targetNode?.type);\r\n  });\r\n\r\n  const includeKeys = new Set<string>([queryKey]);\r\n  let changed = true;\r\n  while (changed) {\r\n    changed = false;\r\n    for (const edge of filteredEdges) {\r\n      if (includeKeys.has(edge.src) && !includeKeys.has(edge.dst)) {\r\n        includeKeys.add(edge.dst);\r\n        changed = true;\r\n      } else if (includeKeys.has(edge.dst) && !includeKeys.has(edge.src)) {\r\n        includeKeys.add(edge.src);\r\n        changed = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  const subsetNodes = Array.from(includeKeys)\r\n    .map((key) => nodeMap.get(key))\r\n    .filter((node): node is GraphNode => Boolean(node));\r\n\r\n  if (subsetNodes.length <= 1) {\r\n    return null;\r\n  }\r\n\r\n  const subsetEdges = filteredEdges.filter((edge) => includeKeys.has(edge.src) && includeKeys.has(edge.dst));\r\n\r\n  const positions = new Map<string, { x: number; y: number; angle?: number }>();\r\n  const center = { x: WIDTH / 2, y: HEIGHT / 2 };\r\n  positions.set(queryKey, { ...center });\r\n\r\n  const sourceNodes = subsetNodes.filter((node) => node.type === 'research-source');\r\n  const evidenceNodes = subsetNodes.filter((node) => node.type === 'research-evidence');\r\n\r\n  const radius = Math.min(WIDTH, HEIGHT) * 0.35;\r\n  const angleStep = sourceNodes.length > 0 ? (Math.PI * 2) / sourceNodes.length : 0;\r\n  const baseAngle = -Math.PI / 2;\r\n\r\n  sourceNodes.forEach((node, index) => {\r\n    const angle = baseAngle + angleStep * index;\r\n    const x = center.x + radius * Math.cos(angle);\r\n    const y = center.y + radius * Math.sin(angle);\r\n    positions.set(node.key, { x, y, angle });\r\n  });\r\n\r\n  const childrenBySource = new Map<string, string[]>();\r\n  subsetEdges.forEach((edge) => {\r\n    const src = nodeMap.get(edge.src);\r\n    const dst = nodeMap.get(edge.dst);\r\n    if (!src || !dst) return;\r\n    if (src.type === 'research-source' && dst.type === 'research-evidence') {\r\n      const entries = childrenBySource.get(src.key) ?? [];\r\n      if (!entries.includes(dst.key)) {\r\n        entries.push(dst.key);\r\n        childrenBySource.set(src.key, entries);\r\n      }\r\n    } else if (src.type === 'research-evidence' && dst.type === 'research-source') {\r\n      const entries = childrenBySource.get(dst.key) ?? [];\r\n      if (!entries.includes(src.key)) {\r\n        entries.push(src.key);\r\n        childrenBySource.set(dst.key, entries);\r\n      }\r\n    }\r\n  });\r\n\r\n  evidenceNodes.forEach((node) => {\r\n    const parentEdge =\r\n      subsetEdges.find(\r\n        (edge) =>\r\n          edge.dst === node.key && nodeMap.get(edge.src)?.type === 'research-source',\r\n      ) ||\r\n      subsetEdges.find(\r\n        (edge) =>\r\n          edge.src === node.key && nodeMap.get(edge.dst)?.type === 'research-source',\r\n      );\r\n\r\n    const parentKey =\r\n      parentEdge && nodeMap.get(parentEdge.src)?.type === 'research-source'\r\n        ? parentEdge.src\r\n        : parentEdge && nodeMap.get(parentEdge.dst)?.type === 'research-source'\r\n        ? parentEdge.dst\r\n        : null;\r\n\r\n    if (!parentKey || !positions.has(parentKey)) {\r\n      const jitterRadius = radius * 0.2;\r\n      positions.set(node.key, {\r\n        x: center.x + (Math.random() - 0.5) * jitterRadius,\r\n        y: center.y + (Math.random() - 0.5) * jitterRadius,\r\n      });\r\n      return;\r\n    }\r\n\r\n    const parentPosition = positions.get(parentKey)!;\r\n    const siblings = childrenBySource.get(parentKey) ?? [];\r\n    const index = siblings.indexOf(node.key);\r\n    const spread = Math.max(0.4, Math.min(1.2, siblings.length * 0.18));\r\n    const baseDirection =\r\n      parentPosition.angle !== undefined\r\n        ? parentPosition.angle\r\n        : Math.atan2(parentPosition.y - center.y, parentPosition.x - center.x);\r\n    const offset = (index - (siblings.length - 1) / 2) * spread;\r\n    const childRadius = Math.min(140, radius * 0.6);\r\n    const angle = baseDirection + offset;\r\n\r\n    positions.set(node.key, {\r\n      x: parentPosition.x + childRadius * Math.cos(angle),\r\n      y: parentPosition.y + childRadius * Math.sin(angle),\r\n    });\r\n  });\r\n\r\n  const laidOutNodes: PositionedNode[] = subsetNodes.map((node) => ({\r\n    ...node,\r\n    position: positions.get(node.key) ?? { ...center },\r\n  }));\r\n\r\n  const laidOutEdges: PositionedEdge[] = subsetEdges.map((edge) => ({\r\n    ...edge,\r\n    source: positions.get(edge.src),\r\n    target: positions.get(edge.dst),\r\n  }));\r\n\r\n  return {\r\n    nodes: laidOutNodes,\r\n    edges: laidOutEdges,\r\n  };\r\n}\r\n\r\ntype ResearchGraphViewProps = {\r\n  query: string;\r\n  queryKey: string | null;\r\n  graphData: ResearchGraphData | null;\r\n  activeSourceId: string | null;\r\n  onSelectSource(sourceKey: string): void;\r\n  onOpenSource(url: string): void;\r\n};\r\n\r\nexport function ResearchGraphView({\r\n  query,\r\n  queryKey,\r\n  graphData,\r\n  activeSourceId,\r\n  onSelectSource,\r\n  onOpenSource,\r\n}: ResearchGraphViewProps) {\r\n  const layout = useMemo(() => buildLayout(graphData, queryKey), [graphData, queryKey]);\r\n  const containerRef = useRef<HTMLDivElement | null>(null);\r\n  const [hover, setHover] = useState<{\r\n    node: PositionedNode;\r\n    x: number;\r\n    y: number;\r\n  } | null>(null);\r\n\r\n  if (!layout || layout.nodes.length <= 1) {\r\n    return (\r\n      <div className=\"flex h-[320px] w-full flex-col items-center justify-center gap-3 rounded-xl border border-dashed border-white/10 bg-black/10 text-center\">\r\n        <p className=\"text-sm text-gray-400\">\r\n          Run a research query to generate a live evidence graph.\r\n        </p>\r\n        <p className=\"text-xs text-gray-500\">\r\n          The graph links your question to vetted sources and their key evidence.\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const nodeMap = new Map(layout.nodes.map((node) => [node.key, node]));\r\n\r\n  const handleNodeActivate = (node: PositionedNode) => {\r\n    if (node.type === 'research-source') {\r\n      const url = node.meta?.url || node.meta?.fragmentUrl;\r\n      if (url) {\r\n        onOpenSource(url);\r\n      }\r\n      onSelectSource(node.key);\r\n    } else if (node.type === 'research-evidence') {\r\n      const sourceKey = node.meta?.sourceKey;\r\n      if (sourceKey) {\r\n        onSelectSource(sourceKey);\r\n      }\r\n      const fragmentUrl = node.meta?.fragmentUrl || node.meta?.url;\r\n      if (fragmentUrl) {\r\n        onOpenSource(fragmentUrl);\r\n      }\r\n    }\r\n  };\r\n\r\n  const getNodeRadius = (node: GraphNode) => {\r\n    switch (node.type) {\r\n      case 'research-query':\r\n        return 42;\r\n      case 'research-source':\r\n        return node.key === activeSourceId ? 26 : 22;\r\n      case 'research-evidence':\r\n        return 16;\r\n      default:\r\n        return 18;\r\n    }\r\n  };\r\n\r\n  const getNodeColor = (node: GraphNode) => {\r\n    if (node.type === 'research-source' && node.key === activeSourceId) {\r\n      return '#34d399';\r\n    }\r\n    return COLORS[node.type ?? ''] ?? '#818cf8';\r\n  };\r\n\r\n  const getEdgeStyle = (edge: PositionedEdge) => {\r\n    const sourceType = nodeMap.get(edge.src)?.type;\r\n    const targetType = nodeMap.get(edge.dst)?.type;\r\n\r\n    if (\r\n      sourceType === 'research-source' &&\r\n      targetType === 'research-source'\r\n    ) {\r\n      return {\r\n        stroke: '#f97316',\r\n        strokeWidth: 1.6,\r\n        strokeDasharray: '4 4',\r\n        opacity: 0.7,\r\n      };\r\n    }\r\n\r\n    if (\r\n      sourceType === 'research-source' &&\r\n      targetType === 'research-evidence'\r\n    ) {\r\n      return {\r\n        stroke: '#a855f7',\r\n        strokeWidth: 1.4,\r\n        opacity: 0.55,\r\n      };\r\n    }\r\n\r\n    return {\r\n      stroke: '#60a5fa',\r\n      strokeWidth: Math.max(1.2, Math.min(2.6, (edge.weight ?? 40) / 50)),\r\n      opacity: 0.65,\r\n    };\r\n  };\r\n\r\n  return (\r\n    <div\r\n      ref={containerRef}\r\n      className=\"relative h-[360px] w-full overflow-hidden rounded-xl border border-white/10 bg-gradient-to-br from-[#05060c] via-[#0b0e18] to-[#11162a] shadow-inner shadow-black/30\"\r\n    >\r\n      <svg\r\n        viewBox={`0 0 ${WIDTH} ${HEIGHT}`}\r\n        className=\"h-full w-full\"\r\n        role=\"presentation\"\r\n      >\r\n        <defs>\r\n          <radialGradient id=\"queryGlow\" r=\"65%\">\r\n            <stop offset=\"0%\" stopColor=\"#60a5fa\" stopOpacity=\"0.55\" />\r\n            <stop offset=\"100%\" stopColor=\"#60a5fa\" stopOpacity=\"0\" />\r\n          </radialGradient>\r\n        </defs>\r\n        {layout.edges.map((edge) => {\r\n          if (!edge.source || !edge.target) return null;\r\n          const style = getEdgeStyle(edge);\r\n          return (\r\n            <g key={`${edge.src}-${edge.dst}-${edge.rel ?? 'edge'}`}>\r\n              <line\r\n                x1={edge.source.x}\r\n                y1={edge.source.y}\r\n                x2={edge.target.x}\r\n                y2={edge.target.y}\r\n                stroke={style.stroke}\r\n                strokeWidth={style.strokeWidth}\r\n                strokeDasharray={style.strokeDasharray}\r\n                opacity={style.opacity}\r\n              />\r\n            </g>\r\n          );\r\n        })}\r\n\r\n        {layout.nodes.map((node) => {\r\n          const position = node.position;\r\n          const radius = getNodeRadius(node);\r\n          const color = getNodeColor(node);\r\n\r\n          return (\r\n            <g\r\n              key={node.key}\r\n              transform={`translate(${position.x}, ${position.y})`}\r\n              tabIndex={node.type === 'research-query' ? -1 : 0}\r\n              role={node.type === 'research-query' ? 'group' : 'button'}\r\n              aria-label={\r\n                node.type === 'research-source'\r\n                  ? `Source: ${node.title ?? node.meta?.domain ?? 'unknown'}`\r\n                  : node.type === 'research-evidence'\r\n                  ? `Evidence: ${node.title ?? 'excerpt'}`\r\n                  : `Query node for ${query}`\r\n              }\r\n              onFocus={(event) => {\r\n                if (node.type === 'research-source' || node.type === 'research-evidence') {\r\n                  const rect = containerRef.current?.getBoundingClientRect();\r\n                  if (rect) {\r\n                    const x = position.x * (event.currentTarget.ownerSVGElement?.clientWidth ?? 1) / WIDTH;\r\n                    const y = position.y * (event.currentTarget.ownerSVGElement?.clientHeight ?? 1) / HEIGHT;\r\n                    setHover({ node, x, y });\r\n                  }\r\n                }\r\n              }}\r\n              onBlur={() => setHover(null)}\r\n              onMouseEnter={(_event) => {\r\n                const rect = containerRef.current?.getBoundingClientRect();\r\n                if (!rect) return;\r\n                const scaleX = rect.width / WIDTH;\r\n                const scaleY = rect.height / HEIGHT;\r\n                setHover({\r\n                  node,\r\n                  x: position.x * scaleX,\r\n                  y: position.y * scaleY,\r\n                });\r\n              }}\r\n              onMouseLeave={() => setHover(null)}\r\n              onClick={() => handleNodeActivate(node)}\r\n              onKeyDown={(event) => {\r\n                if (event.key === 'Enter' || event.key === ' ') {\r\n                  event.preventDefault();\r\n                  handleNodeActivate(node);\r\n                }\r\n              }}\r\n            >\r\n              {node.type === 'research-query' && (\r\n                <circle r={radius * 1.8} fill=\"url(#queryGlow)\" opacity={0.4} />\r\n              )}\r\n              <circle\r\n                r={radius}\r\n                fill={color}\r\n                opacity={node.type === 'research-query' ? 0.85 : 0.75}\r\n                stroke={node.type === 'research-source' && node.key === activeSourceId ? '#34d399' : '#0f172a'}\r\n                strokeWidth={node.type === 'research-source' && node.key === activeSourceId ? 3 : 1.5}\r\n              />\r\n              <text\r\n                x={0}\r\n                y={radius + 16}\r\n                textAnchor=\"middle\"\r\n                className=\"select-none\"\r\n                fill=\"#cbd5f5\"\r\n                fontSize={12}\r\n              >\r\n                {node.type === 'research-query'\r\n                  ? 'Question'\r\n                  : node.type === 'research-source'\r\n                  ? node.meta?.domain ?? 'Source'\r\n                  : 'Evidence'}\r\n              </text>\r\n            </g>\r\n          );\r\n        })}\r\n      </svg>\r\n\r\n      {hover && (\r\n        <div\r\n          className=\"pointer-events-none absolute z-10 w-[240px] max-w-[80vw] rounded-xl border border-white/10 bg-black/80 px-3 py-2 text-xs text-gray-200 shadow-lg backdrop-blur\"\r\n          style={{\r\n            left: Math.min(\r\n              Math.max(hover.x + 12, 8),\r\n              (containerRef.current?.clientWidth ?? 0) - 220,\r\n            ),\r\n            top: Math.min(\r\n              Math.max(hover.y + 12, 8),\r\n              (containerRef.current?.clientHeight ?? 0) - 120,\r\n            ),\r\n          }}\r\n        >\r\n          <div className=\"text-[11px] uppercase tracking-wide text-gray-400\">\r\n            {hover.node.type === 'research-query'\r\n              ? 'Question'\r\n              : hover.node.type === 'research-source'\r\n              ? 'Source'\r\n              : 'Evidence'}\r\n          </div>\r\n          <div className=\"mt-1 font-medium text-gray-100\">\r\n            {hover.node.title || hover.node.meta?.domain || 'Untitled'}\r\n          </div>\r\n          {hover.node.type === 'research-source' && hover.node.meta?.url && (\r\n            <div className=\"mt-1 truncate text-[11px] text-blue-200\">\r\n              {hover.node.meta.url}\r\n            </div>\r\n          )}\r\n          {hover.node.meta?.snippet && (\r\n            <div className=\"mt-2 line-clamp-3 text-[11px] text-gray-400\">\r\n              {hover.node.meta.snippet}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"pointer-events-none absolute bottom-3 right-3 flex flex-wrap items-center gap-2 rounded-full border border-white/10 bg-black/60 px-3 py-1 text-[10px] uppercase tracking-wide text-gray-400\">\r\n        <span className=\"flex items-center gap-1\">\r\n          <span className=\"h-2.5 w-2.5 rounded-full bg-[#60a5fa]/80\" />\r\n          Question\r\n        </span>\r\n        <span className=\"flex items-center gap-1\">\r\n          <span className=\"h-2.5 w-2.5 rounded-full bg-[#a855f7]/80\" />\r\n          Sources\r\n        </span>\r\n        <span className=\"flex items-center gap-1\">\r\n          <span className=\"h-2.5 w-2.5 rounded-full bg-[#facc15]/80\" />\r\n          Evidence\r\n        </span>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n","import { useMemo, useState } from 'react';\nimport { ChevronDown, ChevronUp, ExternalLink, Info, Sparkles } from 'lucide-react';\nimport type { ResearchSource } from '../../types/research';\n\ntype SourceCardProps = {\n  source: ResearchSource;\n  index: number;\n  isActive: boolean;\n  onActivate(sourceKey: string): void;\n  onOpen(url: string): void;\n};\n\nconst SOURCE_LABEL: Record<string, string> = {\n  news: 'News',\n  academic: 'Academic',\n  documentation: 'Docs',\n  forum: 'Forum',\n  other: 'Web',\n};\n\nconst BADGE_STYLE: Record<string, string> = {\n  news: 'bg-blue-500/10 text-blue-200 border-blue-500/30',\n  academic: 'bg-purple-500/10 text-purple-200 border-purple-500/30',\n  documentation: 'bg-emerald-500/10 text-emerald-200 border-emerald-500/30',\n  forum: 'bg-amber-500/10 text-amber-200 border-amber-500/30',\n  other: 'bg-slate-500/10 text-slate-200 border-slate-500/30',\n};\n\nexport function SourceCard({ source, index, isActive, onActivate, onOpen }: SourceCardProps) {\n  const [expanded, setExpanded] = useState(false);\n  const sourceKey = source.url ?? `source-${index}`;\n  const provider =\n    typeof source.metadata?.provider === 'string' ? source.metadata.provider : undefined;\n  const relevance = Number.isFinite(source.relevanceScore) ? source.relevanceScore : null;\n  const type = source.sourceType || source.type || 'other';\n  const canOpen = Boolean(source.url);\n  const fetchedAtLabel = source.fetchedAt ? new Date(source.fetchedAt).toLocaleString() : null;\n  const languageLabel = source.lang ? source.lang.toUpperCase() : null;\n  const selectorMatched = Boolean(source.metadata?.selectorMatched);\n\n  const preview = useMemo(() => {\n    if (expanded) {\n      return source.text || source.snippet || source.excerpt || '';\n    }\n    return (\n      source.excerpt ||\n      source.snippet ||\n      (source.text ? `${source.text.slice(0, 220)}${source.text.length > 220 ? '' : ''}` : '')\n    );\n  }, [expanded, source.excerpt, source.snippet, source.text]);\n\n  const handleActivate = () => {\n    onActivate(sourceKey);\n  };\n\n  return (\n    <article\n      className={`rounded-2xl border p-4 transition-colors ${\n        isActive\n          ? 'border-blue-500/50 bg-blue-500/5 shadow-[0_0_30px_rgba(59,130,246,0.15)]'\n          : 'border-white/10 bg-white/[0.02] hover:border-white/20'\n      }`}\n    >\n      <header className=\"flex flex-wrap items-start gap-3\">\n        <button type=\"button\" onClick={handleActivate} className=\"flex-1 text-left\">\n          <p className=\"text-xs uppercase tracking-wide text-gray-500\">Source {index + 1}</p>\n          <h4 className=\"mt-0.5 text-base font-semibold text-white hover:text-blue-200 transition-colors\">\n            {source.title || source.url || 'Untitled source'}\n          </h4>\n          <p className=\"text-xs text-gray-500\">{source.domain || provider || 'unknown-domain'}</p>\n        </button>\n        <div className=\"flex flex-col items-end gap-2 text-xs\">\n          <span\n            className={`rounded-full border px-2 py-0.5 capitalize ${BADGE_STYLE[type] ?? BADGE_STYLE.other}`}\n          >\n            {SOURCE_LABEL[type] ?? SOURCE_LABEL.other}\n          </span>\n          {provider && (\n            <span className=\"rounded-full border border-white/10 px-2 py-0.5 text-[10px] uppercase tracking-wide text-gray-400\">\n              {provider}\n            </span>\n          )}\n          {relevance !== null && (\n            <span className=\"inline-flex items-center gap-1 rounded-full border border-white/10 px-2 py-0.5 text-[11px] text-gray-300\">\n              <Sparkles size={12} className=\"text-blue-200\" />\n              {Math.round(relevance)}\n            </span>\n          )}\n        </div>\n      </header>\n\n      {source.image && (\n        <div className=\"mt-3 h-36 overflow-hidden rounded-xl border border-white/10 bg-white/[0.04]\">\n          <img\n            src={source.image}\n            alt={source.title || 'Preview'}\n            className=\"h-full w-full object-cover\"\n            loading=\"lazy\"\n          />\n        </div>\n      )}\n\n      <p className=\"mt-3 text-sm text-gray-300 leading-relaxed whitespace-pre-line\">{preview}</p>\n\n      <footer className=\"mt-4 flex flex-wrap items-center gap-3 text-[11px] text-gray-400\">\n        {source.wordCount && source.wordCount > 0 && (\n          <span className=\"rounded-full border border-white/10 px-2 py-0.5\">\n            {source.wordCount.toLocaleString()} words\n          </span>\n        )}\n        {languageLabel && (\n          <span className=\"rounded-full border border-white/10 px-2 py-0.5\">\n            Lang {languageLabel}\n          </span>\n        )}\n        {source.rendered && (\n          <span className=\"inline-flex items-center gap-1 rounded-full border border-indigo-500/40 bg-indigo-500/10 px-2 py-0.5 text-indigo-200\">\n            <Info size={11} />\n            Rendered\n          </span>\n        )}\n        {source.fromCache && (\n          <span className=\"rounded-full border border-emerald-400/30 bg-emerald-500/10 px-2 py-0.5 text-emerald-200\">\n            Cached\n          </span>\n        )}\n        {selectorMatched && (\n          <span className=\"rounded-full border border-blue-400/30 bg-blue-500/10 px-2 py-0.5 text-blue-200\">\n            Focused extract\n          </span>\n        )}\n        {fetchedAtLabel && (\n          <span className=\"rounded-full border border-white/10 px-2 py-0.5\">{fetchedAtLabel}</span>\n        )}\n      </footer>\n\n      <div className=\"mt-3 flex flex-wrap gap-2 text-sm\">\n        <button\n          type=\"button\"\n          onClick={() => canOpen && onOpen(source.url)}\n          disabled={!canOpen}\n          className={`inline-flex items-center gap-1 rounded-lg border px-3 py-1.5 text-xs font-medium ${\n            canOpen\n              ? 'border-white/20 text-white hover:border-blue-400/50 hover:text-blue-100'\n              : 'border-white/5 text-gray-500 cursor-not-allowed'\n          }`}\n        >\n          {canOpen ? 'Open source' : 'No link'}\n          <ExternalLink size={14} />\n        </button>\n        <button\n          type=\"button\"\n          onClick={() => setExpanded(prev => !prev)}\n          className=\"inline-flex items-center gap-1 rounded-lg border border-white/10 px-3 py-1.5 text-xs text-gray-300 hover:text-white\"\n        >\n          {expanded ? (\n            <>\n              Collapse\n              <ChevronUp size={14} />\n            </>\n          ) : (\n            <>\n              Expand details\n              <ChevronDown size={14} />\n            </>\n          )}\n        </button>\n      </div>\n    </article>\n  );\n}\n","/**\n * AnswerWithCitations - Displays research summary with inline citations\n */\n\nimport { useMemo, useState } from 'react';\nimport { ExternalLink, FileText, Download } from 'lucide-react';\nimport type { ResearchInlineEvidence, ResearchCitation, ResearchSource } from '../../types/research';\nimport { motion } from 'framer-motion';\nimport { ipc } from '../../lib/ipc-typed';\n\ninterface AnswerWithCitationsProps {\n  summary: string;\n  citations: ResearchCitation[];\n  inlineEvidence?: ResearchInlineEvidence[];\n  sources: ResearchSource[];\n  activeSourceId: string | null;\n  onActivate: (sourceKey: string) => void;\n  onOpenSource: (url: string) => void;\n  onExport?: (format: 'markdown' | 'pdf') => void;\n}\n\nexport function AnswerWithCitations({\n  summary,\n  citations,\n  inlineEvidence = [],\n  sources,\n  activeSourceId,\n  onActivate,\n  onOpenSource,\n  onExport,\n}: AnswerWithCitationsProps) {\n  const [hoveredCitation, setHoveredCitation] = useState<number | null>(null);\n  const [exporting, setExporting] = useState<'markdown' | 'pdf' | null>(null);\n\n  // Build text with inline citations\n  const renderedText = useMemo(() => {\n    if (!inlineEvidence || inlineEvidence.length === 0) {\n      // Fallback: render summary with citation markers\n      return summary.split(/(\\[(\\d+)\\])/g).map((part, idx) => {\n        const match = part.match(/^\\[(\\d+)\\]$/);\n        if (match) {\n          const citationIndex = parseInt(match[1], 10);\n          const citation = citations.find(c => c.index === citationIndex);\n          if (citation) {\n            const source = sources[citation.sourceIndex];\n            const sourceKey = source?.url ?? `source-${citation.sourceIndex}`;\n            return (\n              <CitationMarker\n                key={`citation-${citationIndex}-${idx}`}\n                index={citationIndex}\n                source={source}\n                sourceKey={sourceKey}\n                isActive={activeSourceId === sourceKey}\n                isHovered={hoveredCitation === citationIndex}\n                onHover={setHoveredCitation}\n                onActivate={onActivate}\n                onOpenSource={onOpenSource}\n              />\n            );\n          }\n        }\n        return <span key={`text-${idx}`}>{part}</span>;\n      });\n    }\n\n    // Use inline evidence for precise citation placement\n    const parts: Array<{ text: string; citation?: number; sourceIndex?: number }> = [];\n    let lastPos = 0;\n\n    // Sort inline evidence by position\n    const sortedEvidence = [...inlineEvidence].sort((a, b) => a.from - b.from);\n\n    sortedEvidence.forEach((evidence) => {\n      if (evidence.from > lastPos) {\n        parts.push({ text: summary.slice(lastPos, evidence.from) });\n      }\n      parts.push({\n        text: summary.slice(evidence.from, evidence.to),\n        citation: evidence.citationIndex,\n        sourceIndex: evidence.sourceIndex,\n      });\n      lastPos = evidence.to;\n    });\n\n    if (lastPos < summary.length) {\n      parts.push({ text: summary.slice(lastPos) });\n    }\n\n    return parts.map((part, idx) => {\n      if (part.citation !== undefined && part.sourceIndex !== undefined) {\n        // const citation = citations.find(c => c.index === part.citation); // Unused for now\n        const source = sources[part.sourceIndex];\n        const sourceKey = source?.url ?? `source-${part.sourceIndex}`;\n        return (\n          <span key={`part-${idx}`}>\n            <CitationMarker\n              index={part.citation}\n              source={source}\n              sourceKey={sourceKey}\n              isActive={activeSourceId === sourceKey}\n              isHovered={hoveredCitation === part.citation}\n              onHover={setHoveredCitation}\n              onActivate={onActivate}\n              onOpenSource={onOpenSource}\n            />\n            {part.text}\n          </span>\n        );\n      }\n      return <span key={`text-${idx}`}>{part.text}</span>;\n    });\n  }, [summary, citations, inlineEvidence, sources, activeSourceId, hoveredCitation, onActivate, onOpenSource]);\n\n  const handleExport = async (format: 'markdown' | 'pdf') => {\n    setExporting(format);\n    try {\n      if (onExport) {\n        await onExport(format);\n      } else {\n        // Default export implementation\n        const _exportData = {\n          query: '',\n          summary,\n          citations: citations.map(c => ({\n            index: c.index,\n            source: sources[c.sourceIndex],\n            quote: c.quote,\n            confidence: c.confidence,\n          })),\n          sources: sources.map(s => ({\n            title: s.title,\n            url: s.url,\n            domain: s.domain,\n          })),\n        };\n\n        if (format === 'markdown') {\n          let markdown = `# Research Summary\\n\\n`;\n          markdown += `${summary}\\n\\n`;\n          markdown += `## Citations\\n\\n`;\n          citations.forEach(c => {\n            const source = sources[c.sourceIndex];\n            markdown += `[${c.index}] ${source?.title || 'Unknown'} (${source?.url || ''})\\n`;\n            markdown += `  Confidence: ${(c.confidence * 100).toFixed(0)}%\\n`;\n            if (c.quote) {\n              markdown += `  Quote: \"${c.quote}\"\\n`;\n            }\n            markdown += `\\n`;\n          });\n          markdown += `## Sources\\n\\n`;\n          sources.forEach((s, idx) => {\n            markdown += `${idx + 1}. [${s.title}](${s.url}) - ${s.domain}\\n`;\n          });\n\n          const blob = new Blob([markdown], { type: 'text/markdown' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = `research-${Date.now()}.md`;\n          a.click();\n          URL.revokeObjectURL(url);\n        } else {\n          // PDF export would require a library like jsPDF or IPC call\n          await ipc.research.export({\n            format: 'markdown', // Fallback to markdown for now\n            sources: sources.map(s => s.url),\n            includeNotes: true,\n          });\n        }\n      }\n    } catch (error) {\n      console.error('Export failed:', error);\n    } finally {\n      setExporting(null);\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <p className=\"text-sm leading-relaxed text-gray-200 whitespace-pre-wrap\">\n          {renderedText}\n        </p>\n        {onExport && (\n          <div className=\"flex items-center gap-2 ml-4\">\n            <motion.button\n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.95 }}\n              onClick={() => handleExport('markdown')}\n              disabled={exporting !== null}\n              className=\"p-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition-colors disabled:opacity-50\"\n              title=\"Export as Markdown\"\n            >\n              <FileText size={16} className={exporting === 'markdown' ? 'animate-pulse' : ''} />\n            </motion.button>\n            <motion.button\n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.95 }}\n              onClick={() => handleExport('pdf')}\n              disabled={exporting !== null}\n              className=\"p-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition-colors disabled:opacity-50\"\n              title=\"Export as PDF\"\n            >\n              <Download size={16} className={exporting === 'pdf' ? 'animate-pulse' : ''} />\n            </motion.button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\ninterface CitationMarkerProps {\n  index: number;\n  source: ResearchSource | undefined;\n  sourceKey: string;\n  isActive: boolean;\n  isHovered: boolean;\n  onHover: (index: number | null) => void;\n  onActivate: (sourceKey: string) => void;\n  onOpenSource: (url: string) => void;\n}\n\nfunction CitationMarker({\n  index,\n  source,\n  sourceKey,\n  isActive,\n  isHovered,\n  onHover,\n  onActivate,\n  onOpenSource,\n}: CitationMarkerProps) {\n  return (\n    <motion.sup\n      className={`inline-flex items-center gap-1 mx-0.5 px-1.5 py-0.5 rounded text-[10px] font-semibold cursor-pointer transition-all ${\n        isActive\n          ? 'bg-blue-500/30 text-blue-200 border border-blue-400/50'\n          : isHovered\n          ? 'bg-blue-500/20 text-blue-300 border border-blue-400/30'\n          : 'bg-white/10 text-gray-300 border border-white/10 hover:bg-white/15'\n      }`}\n      onMouseEnter={() => onHover(index)}\n      onMouseLeave={() => onHover(null)}\n      onClick={(e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        onActivate(sourceKey);\n        if (source?.url) {\n          onOpenSource(source.url);\n        }\n      }}\n      whileHover={{ scale: 1.1 }}\n      whileTap={{ scale: 0.95 }}\n      title={source ? `${source.title} - ${source.domain}` : `Citation ${index}`}\n    >\n      [{index}]\n      {isHovered && source && (\n        <ExternalLink size={10} className=\"opacity-70\" />\n      )}\n    </motion.sup>\n  );\n}\n\n","/**\n * EvidenceOverlay - Highlights evidence on source pages when citations are clicked\n */\n\nimport { useEffect, useRef } from 'react';\nimport { ipc } from '../../lib/ipc-typed';\nimport { useTabsStore } from '../../state/tabsStore';\nimport type { ResearchEvidence, ResearchSource } from '../../types/research';\n\ninterface EvidenceOverlayProps {\n  evidence: ResearchEvidence[];\n  sources: ResearchSource[];\n  activeEvidenceId: string | null;\n  onEvidenceClick?: (evidenceId: string) => void;\n}\n\nexport function EvidenceOverlay({\n  evidence,\n  sources,\n  activeEvidenceId,\n  onEvidenceClick: _onEvidenceClick,\n}: EvidenceOverlayProps) {\n  const { activeId } = useTabsStore();\n  const highlightRefs = useRef<Map<string, () => void>>(new Map());\n\n  useEffect(() => {\n    if (!activeId || !activeEvidenceId) {\n      // Clear all highlights\n      highlightRefs.current.forEach(cleanup => cleanup());\n      highlightRefs.current.clear();\n      return;\n    }\n\n    const activeEvidence = evidence.find(e => e.id === activeEvidenceId);\n    if (!activeEvidence) return;\n\n    const source = sources[activeEvidence.sourceIndex];\n    if (!source) return;\n\n    // Get current tab URL to verify we're on the right page\n    const highlightEvidence = async () => {\n      try {\n        const tabs = await ipc.tabs.list();\n        const activeTab = tabs.find(t => t.id === activeId);\n        if (!activeTab || !activeTab.url) return;\n\n        const sourceUrl = new URL(source.url);\n        const tabUrl = new URL(activeTab.url);\n\n        // Only highlight if we're on the same domain\n        if (sourceUrl.hostname !== tabUrl.hostname) {\n          return;\n        }\n\n        // Inject highlight script into the page\n        const _highlightScript = `\n          (function() {\n            const quote = ${JSON.stringify(activeEvidence.quote)};\n            const context = ${JSON.stringify(activeEvidence.context)};\n            \n            // Try to find the quote in the page\n            const walker = document.createTreeWalker(\n              document.body,\n              NodeFilter.SHOW_TEXT,\n              null\n            );\n            \n            let node;\n            const matches = [];\n            while (node = walker.nextNode()) {\n              const text = node.textContent;\n              if (text && text.includes(quote)) {\n                matches.push(node);\n              }\n            }\n            \n            if (matches.length > 0) {\n              // Highlight the first match\n              const match = matches[0];\n              const range = document.createRange();\n              const startIndex = match.textContent.indexOf(quote);\n              if (startIndex !== -1) {\n                range.setStart(match, startIndex);\n                range.setEnd(match, startIndex + quote.length);\n                \n                const highlight = document.createElement('mark');\n                highlight.style.backgroundColor = 'rgba(59, 130, 246, 0.4)';\n                highlight.style.color = 'inherit';\n                highlight.style.padding = '2px 4px';\n                highlight.style.borderRadius = '3px';\n                highlight.style.boxShadow = '0 0 8px rgba(59, 130, 246, 0.6)';\n                highlight.className = 'regen-evidence-highlight';\n                highlight.setAttribute('data-evidence-id', ${JSON.stringify(activeEvidenceId)});\n                \n                try {\n                  range.surroundContents(highlight);\n                  \n                  // Scroll into view\n                  highlight.scrollIntoView({ behavior: 'smooth', block: 'center' });\n                  \n                  // Store cleanup function\n                  window.__omnib_evidence_cleanup = function() {\n                    const parent = highlight.parentNode;\n                    if (parent) {\n                      parent.replaceChild(document.createTextNode(quote), highlight);\n                      parent.normalize();\n                    }\n                  };\n                } catch (e) {\n                  console.warn('Failed to highlight evidence:', e);\n                }\n              }\n            }\n          })();\n        `;\n\n        // Execute script in the page context via devtools or navigate to fragment\n        if (activeEvidence.fragmentUrl) {\n          // Navigate to fragment URL which should highlight the evidence\n          await ipc.tabs.navigate(activeId, activeEvidence.fragmentUrl);\n        } else {\n          // Try to scroll to quote if we can't inject script\n          // This is a fallback - full script injection would require backend support\n          console.log(\n            'Evidence highlight requires fragment URL or backend script injection support'\n          );\n        }\n\n        // Store cleanup (for future script injection support)\n        highlightRefs.current.set(activeEvidenceId, () => {\n          // Cleanup would be handled by page navigation or script removal\n          // Currently relies on fragment URLs for highlighting\n        });\n      } catch (error) {\n        console.warn('Failed to highlight evidence:', error);\n      }\n    };\n\n    highlightEvidence();\n\n    return () => {\n      // Cleanup on unmount or when evidence changes\n      highlightRefs.current.forEach(cleanup => cleanup());\n      highlightRefs.current.clear();\n    };\n  }, [activeId, activeEvidenceId, evidence, sources]);\n\n  // This component doesn't render anything visible\n  // It just manages evidence highlighting in the active tab\n  return null;\n}\n","import { useMemo } from 'react';\nimport { AnimatePresence, motion } from 'framer-motion';\nimport { Calendar, ChevronLeft, Layers, Shield, Sparkles, Trash2 } from 'lucide-react';\nimport type { ComparedAnswer } from '../../state/researchCompareStore';\n\ntype CompareAnswersProps = {\n  open: boolean;\n  answers: ComparedAnswer[];\n  selectedIds: string[];\n  onToggleSelect: (id: string) => void;\n  onClose: () => void;\n  onRemove: (id: string) => void;\n};\n\nexport function CompareAnswersPanel({\n  open,\n  answers,\n  selectedIds,\n  onToggleSelect,\n  onClose,\n  onRemove,\n}: CompareAnswersProps) {\n  const selectedAnswers = selectedIds\n    .map(id => answers.find(answer => answer.id === id))\n    .filter(Boolean) as ComparedAnswer[];\n\n  const overlapStats = useMemo(() => {\n    if (selectedAnswers.length < 2) {\n      return { sharedDomains: [] as string[] };\n    }\n    const [first, second] = selectedAnswers;\n    const firstDomains = new Set((first.sources ?? []).map(source => source.domain || source.url));\n    const secondDomains = new Set(\n      (second.sources ?? []).map(source => source.domain || source.url)\n    );\n    const sharedDomains = [...firstDomains].filter(domain => domain && secondDomains.has(domain));\n    return { sharedDomains };\n  }, [selectedAnswers]);\n\n  const differenceSummary = useMemo(() => {\n    if (selectedAnswers.length < 2) {\n      return [];\n    }\n    const [first, second] = selectedAnswers;\n    return extractUniqueSentences(first.summary, second.summary, first.id, second.id);\n  }, [selectedAnswers]);\n\n  return (\n    <AnimatePresence>\n      {open && (\n        <motion.aside\n          initial={{ y: '100%' }}\n          animate={{ y: 0 }}\n          exit={{ y: '100%' }}\n          transition={{ type: 'spring', stiffness: 200, damping: 30 }}\n          className=\"fixed inset-x-0 bottom-0 z-[80] max-h-[70vh] overflow-hidden rounded-t-3xl border border-white/10 bg-[#070912]/95 shadow-2xl shadow-black/40 backdrop-blur\"\n        >\n          <div className=\"flex items-center justify-between border-b border-white/5 px-6 py-4\">\n            <div>\n              <p className=\"text-xs uppercase tracking-wide text-sky-300\">Compare answers</p>\n              <p className=\"text-sm text-gray-400\">{answers.length} saved  select up to 2</p>\n            </div>\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"inline-flex items-center gap-1 rounded-full border border-white/10 px-3 py-1.5 text-xs text-gray-200 hover:border-white/30\"\n            >\n              <ChevronLeft size={14} />\n              Close\n            </button>\n          </div>\n\n          <div className=\"grid gap-4 border-b border-white/5 px-6 py-4 md:grid-cols-2\">\n            {answers.length === 0 && (\n              <div className=\"col-span-2 rounded-2xl border border-white/10 bg-white/[0.02] px-4 py-6 text-center text-sm text-gray-400\">\n                Save answers from Research Mode to compare them here.\n              </div>\n            )}\n            {answers.map(answer => {\n              const isSelected = selectedIds.includes(answer.id);\n              return (\n                <button\n                  key={answer.id}\n                  type=\"button\"\n                  onClick={() => onToggleSelect(answer.id)}\n                  className={`rounded-2xl border px-4 py-3 text-left transition-all ${\n                    isSelected\n                      ? 'border-sky-500/60 bg-sky-500/10 shadow-[0_0_35px_rgba(56,189,248,0.2)]'\n                      : 'border-white/10 bg-white/[0.02] hover:border-white/20'\n                  }`}\n                >\n                  <div className=\"flex items-center justify-between text-xs text-gray-500\">\n                    <span>{new Date(answer.createdAt).toLocaleString()}</span>\n                    <span className=\"inline-flex items-center gap-1 rounded-full border border-white/10 px-2 py-0.5 text-[10px] uppercase tracking-wide text-gray-300\">\n                      <Shield size={12} className=\"text-emerald-300\" />\n                      {(answer.provider || answer.model || 'ai').toUpperCase()}\n                    </span>\n                  </div>\n                  <p className=\"mt-2 line-clamp-3 text-sm text-gray-200\">{answer.summary}</p>\n                  <div className=\"mt-3 flex items-center gap-2 text-[11px] text-gray-400\">\n                    <span>{answer.sources.length} sources</span>\n                    <span></span>\n                    <span>Authority bias {answer.settings.authorityBias}%</span>\n                    <span></span>\n                    <span>{answer.settings.region}</span>\n                  </div>\n                  <div className=\"mt-3 flex items-center justify-between text-xs\">\n                    <span className=\"text-sky-300\">\n                      {isSelected ? 'Selected' : 'Tap to select'}\n                    </span>\n                    <button\n                      type=\"button\"\n                      onClick={event => {\n                        event.stopPropagation();\n                        onRemove(answer.id);\n                      }}\n                      className=\"inline-flex items-center gap-1 rounded-full border border-red-500/30 px-2 py-0.5 text-[10px] uppercase tracking-wide text-red-200 hover:border-red-400\"\n                    >\n                      <Trash2 size={12} />\n                      Remove\n                    </button>\n                  </div>\n                </button>\n              );\n            })}\n          </div>\n\n          <div className=\"grid gap-4 px-6 py-4 md:grid-cols-2\">\n            {selectedAnswers.length === 0 && (\n              <div className=\"col-span-2 rounded-2xl border border-dashed border-white/10 bg-white/[0.02] px-4 py-6 text-center text-sm text-gray-400\">\n                Select two answers above to view a detailed comparison.\n              </div>\n            )}\n\n            {selectedAnswers.slice(0, 2).map(answer => (\n              <div\n                key={answer.id}\n                className=\"rounded-2xl border border-white/10 bg-white/[0.02] p-4\"\n              >\n                <header className=\"flex items-center justify-between text-xs text-gray-400\">\n                  <span className=\"inline-flex items-center gap-1 text-white\">\n                    <Sparkles size={12} className=\"text-sky-300\" />\n                    {answer.query}\n                  </span>\n                  <span className=\"inline-flex items-center gap-1\">\n                    <Calendar size={12} />\n                    {new Date(answer.createdAt).toLocaleTimeString()}\n                  </span>\n                </header>\n                <p className=\"mt-3 text-sm text-gray-200 whitespace-pre-line\">{answer.summary}</p>\n                <div className=\"mt-3 grid gap-2 text-xs text-gray-400 sm:grid-cols-3\">\n                  <StatBlock label=\"Confidence\" value={formatPercent(answer.confidence)} />\n                  <StatBlock label=\"Sources\" value={`${answer.sources.length}`} />\n                  <StatBlock\n                    label=\"Settings\"\n                    value={`${answer.settings.authorityBias}% authority`}\n                  />\n                </div>\n              </div>\n            ))}\n\n            {selectedAnswers.length >= 2 && (\n              <>\n                <div className=\"rounded-2xl border border-white/10 bg-white/[0.02] p-4\">\n                  <h4 className=\"flex items-center gap-2 text-sm font-semibold text-white\">\n                    <Layers size={14} className=\"text-sky-300\" />\n                    Shared sources ({overlapStats.sharedDomains.length})\n                  </h4>\n                  <ul className=\"mt-3 space-y-1 text-xs text-gray-300\">\n                    {overlapStats.sharedDomains.length > 0 ? (\n                      overlapStats.sharedDomains.map(domain => (\n                        <li key={domain} className=\"rounded border border-white/10 px-2 py-1\">\n                          {domain}\n                        </li>\n                      ))\n                    ) : (\n                      <li className=\"text-gray-500\">No overlapping domains.</li>\n                    )}\n                  </ul>\n                </div>\n                <div className=\"rounded-2xl border border-white/10 bg-white/[0.02] p-4\">\n                  <h4 className=\"text-sm font-semibold text-white\">Unique takeaways</h4>\n                  <ul className=\"mt-3 space-y-2 text-sm text-gray-300\">\n                    {differenceSummary.length > 0 ? (\n                      differenceSummary.map(diff => (\n                        <li key={diff.text} className=\"rounded border border-white/10 px-3 py-2\">\n                          <span className=\"text-[11px] uppercase tracking-wide text-sky-300\">\n                            {diff.owner === selectedAnswers[0].id ? 'Answer A' : 'Answer B'}\n                          </span>\n                          <p className=\"text-gray-200\">{diff.text}</p>\n                        </li>\n                      ))\n                    ) : (\n                      <li className=\"text-gray-500\">Summaries are largely aligned.</li>\n                    )}\n                  </ul>\n                </div>\n              </>\n            )}\n          </div>\n        </motion.aside>\n      )}\n    </AnimatePresence>\n  );\n}\n\ntype StatBlockProps = {\n  label: string;\n  value?: string;\n};\n\nfunction StatBlock({ label, value }: StatBlockProps) {\n  return (\n    <div className=\"rounded border border-white/10 px-3 py-2\">\n      <p className=\"text-[10px] uppercase tracking-wide text-gray-500\">{label}</p>\n      <p className=\"text-sm font-semibold text-white\">{value ?? ''}</p>\n    </div>\n  );\n}\n\nfunction formatPercent(value?: number) {\n  if (typeof value !== 'number') {\n    return '';\n  }\n  return `${Math.round(value * 100)}%`;\n}\n\nfunction extractUniqueSentences(\n  a: string,\n  b: string,\n  ownerA: string,\n  ownerB: string\n): Array<{ owner: string; text: string }> {\n  const sentencesA = normalizeSentences(a).map(text => ({ id: `a-${text}`, text }));\n  const sentencesB = normalizeSentences(b).map(text => ({ id: `b-${text}`, text }));\n  const setA = new Set(sentencesA.map(sentence => sentence.text));\n  const setB = new Set(sentencesB.map(sentence => sentence.text));\n  const uniques: Array<{ owner: string; text: string }> = [];\n\n  sentencesA.forEach(sentence => {\n    if (!setB.has(sentence.text)) {\n      uniques.push({ owner: ownerA, text: sentence.text });\n    }\n  });\n\n  sentencesB.forEach(sentence => {\n    if (!setA.has(sentence.text)) {\n      uniques.push({ owner: ownerB, text: sentence.text });\n    }\n  });\n\n  return uniques.slice(0, 6);\n}\n\nfunction normalizeSentences(paragraph: string): string[] {\n  return paragraph\n    .split(/(?<=[.!?])\\s+/)\n    .map(sentence => sentence.trim())\n    .filter(Boolean);\n}\n","/**\n * Layout Engine - Unified layout structure\n * Provides consistent sidebar, navigation, and main content areas\n */\n\nimport React, { createContext, useContext } from 'react';\nimport { motion } from 'framer-motion';\nimport { cn } from '../lib/utils';\n\ninterface LayoutContextValue {\n  sidebarWidth: number;\n  navHeight: number;\n  rightPanelWidth: number;\n}\n\nconst LayoutContext = createContext<LayoutContextValue>({\n  sidebarWidth: 240,\n  navHeight: 64,\n  rightPanelWidth: 0,\n});\n\nexport const useLayout = () => useContext(LayoutContext);\n\ninterface LayoutEngineProps {\n  children: React.ReactNode;\n  sidebarWidth?: number;\n  navHeight?: number;\n  rightPanelWidth?: number;\n}\n\n/**\n * Main Layout Engine - Provides consistent structure\n */\nexport function LayoutEngine({\n  children,\n  sidebarWidth = 240,\n  navHeight = 64,\n  rightPanelWidth = 0,\n  ...props\n}: LayoutEngineProps & React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <LayoutContext.Provider value={{ sidebarWidth, navHeight, rightPanelWidth }}>\n      <div\n        className=\"flex h-full w-full flex-col overflow-hidden\"\n        data-testid=\"layout-engine-root\"\n        {...props}\n      >\n        {children}\n      </div>\n    </LayoutContext.Provider>\n  );\n}\n\ninterface LayoutHeaderProps extends React.HTMLAttributes<HTMLElement> {\n  sticky?: boolean;\n}\n\n/**\n * Layout Header - Top navigation area\n */\nexport function LayoutHeader({ sticky = true, className, children, ...props }: LayoutHeaderProps) {\n  const { navHeight } = useLayout();\n  return (\n    <header\n      className={cn(\n        'flex-shrink-0 border-b border-slate-700/50 bg-slate-900/95 backdrop-blur-xl',\n        sticky && 'sticky top-0 z-40',\n        className\n      )}\n      style={{ height: navHeight }}\n      {...props}\n    >\n      {children}\n    </header>\n  );\n}\n\ninterface LayoutBodyProps extends React.HTMLAttributes<HTMLDivElement> {\n  sidebar?: React.ReactNode;\n  rightPanel?: React.ReactNode;\n  sidebarCollapsed?: boolean;\n  rightPanelCollapsed?: boolean;\n}\n\n/**\n * Layout Body - Main content area with optional sidebars\n */\nexport function LayoutBody({\n  sidebar,\n  rightPanel,\n  sidebarCollapsed = false,\n  rightPanelCollapsed = false,\n  className,\n  children,\n  ...props\n}: LayoutBodyProps) {\n  const { sidebarWidth, rightPanelWidth } = useLayout();\n\n  return (\n    <div className={cn('flex flex-1 min-h-0 overflow-hidden', className)} {...props}>\n      {/* Left Sidebar */}\n      {sidebar && (\n        <motion.aside\n          initial={false}\n          animate={{\n            width: sidebarCollapsed ? 0 : sidebarWidth,\n            opacity: sidebarCollapsed ? 0 : 1,\n          }}\n          transition={{ duration: 0.2, ease: 'easeInOut' }}\n          className=\"flex-shrink-0 border-r border-slate-700/50 bg-slate-900/60 overflow-hidden\"\n          style={{ width: sidebarCollapsed ? 0 : sidebarWidth }}\n        >\n          <div className=\"h-full overflow-y-auto\">{sidebar}</div>\n        </motion.aside>\n      )}\n\n      {/* Main Content */}\n      <main className=\"flex-1 min-w-0 overflow-hidden bg-slate-950\">{children}</main>\n\n      {/* Right Panel */}\n      {rightPanel && (\n        <motion.aside\n          initial={false}\n          animate={{\n            width: rightPanelCollapsed ? 0 : rightPanelWidth || 320,\n            opacity: rightPanelCollapsed ? 0 : 1,\n          }}\n          transition={{ duration: 0.2, ease: 'easeInOut' }}\n          className=\"flex-shrink-0 border-l border-slate-700/50 bg-slate-900/60 overflow-hidden\"\n          style={{ width: rightPanelCollapsed ? 0 : rightPanelWidth || 320 }}\n        >\n          <div className=\"h-full overflow-y-auto\">{rightPanel}</div>\n        </motion.aside>\n      )}\n    </div>\n  );\n}\n\ninterface LayoutFooterProps extends React.HTMLAttributes<HTMLElement> {\n  sticky?: boolean;\n}\n\n/**\n * Layout Footer - Bottom area\n */\nexport function LayoutFooter({ sticky = false, className, children, ...props }: LayoutFooterProps) {\n  return (\n    <footer\n      className={cn(\n        'flex-shrink-0 border-t border-slate-700/50 bg-slate-900/95 backdrop-blur-xl',\n        sticky && 'sticky bottom-0 z-40',\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </footer>\n  );\n}\n\n/**\n * Layout Section - Content section with consistent spacing\n */\ninterface LayoutSectionProps extends React.HTMLAttributes<HTMLElement> {\n  spacing?: 'none' | 'sm' | 'md' | 'lg' | 'xl';\n  padded?: boolean;\n}\n\nconst sectionSpacing = {\n  none: '',\n  sm: 'py-3',\n  md: 'py-6',\n  lg: 'py-8',\n  xl: 'py-12',\n};\n\nexport function LayoutSection({\n  spacing = 'md',\n  padded = true,\n  className,\n  children,\n  ...props\n}: LayoutSectionProps) {\n  return (\n    <section\n      className={cn(\n        'w-full',\n        sectionSpacing[spacing],\n        padded && 'px-[var(--layout-page-padding)]',\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </section>\n  );\n}\n\n/**\n * Layout Grid - Responsive grid system\n */\ninterface LayoutGridProps extends React.HTMLAttributes<HTMLDivElement> {\n  cols?: 1 | 2 | 3 | 4 | 6 | 12;\n  gap?: 'sm' | 'md' | 'lg';\n}\n\nconst gridCols = {\n  1: 'grid-cols-1',\n  2: 'grid-cols-1 md:grid-cols-2',\n  3: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3',\n  4: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-4',\n  6: 'grid-cols-2 md:grid-cols-3 lg:grid-cols-6',\n  12: 'grid-cols-12',\n};\n\nconst gridGap = {\n  sm: 'gap-2',\n  md: 'gap-4',\n  lg: 'gap-6',\n};\n\nexport function LayoutGrid({\n  cols = 3,\n  gap = 'md',\n  className,\n  children,\n  ...props\n}: LayoutGridProps) {\n  return (\n    <div className={cn('grid', gridCols[cols], gridGap[gap], className)} {...props}>\n      {children}\n    </div>\n  );\n}\n","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport type { ResearchResult, ResearchSource } from '../types/research';\n\nexport type ComparedAnswer = {\n  id: string;\n  query: string;\n  summary: string;\n  createdAt: number;\n  provider?: string;\n  model?: string;\n  confidence?: number;\n  sources: ResearchSource[];\n  citations: ResearchResult['citations'];\n  settings: {\n    includeCounterpoints: boolean;\n    authorityBias: number;\n    region: string;\n  };\n};\n\ntype ResearchCompareState = {\n  entries: ComparedAnswer[];\n  addEntry(entry: Omit<ComparedAnswer, 'id' | 'createdAt'>): ComparedAnswer;\n  removeEntry(id: string): void;\n  clear(): void;\n};\n\nconst MAX_ENTRIES = 6;\n\nexport const useResearchCompareStore = create<ResearchCompareState>()(\n  persist(\n    (set, _get) => ({\n      entries: [],\n      addEntry(entry) {\n        const now = Date.now();\n        const newEntry: ComparedAnswer = {\n          ...entry,\n          id: `compare-${now}-${Math.random().toString(36).slice(2, 8)}`,\n          createdAt: now,\n        };\n\n        set(state => {\n          const existing = state.entries.filter(\n            item => item.summary !== entry.summary || item.query !== entry.query\n          );\n          const next = [newEntry, ...existing].slice(0, MAX_ENTRIES);\n          return { entries: next };\n        });\n\n        return newEntry;\n      },\n      removeEntry(id) {\n        set(state => ({ entries: state.entries.filter(entry => entry.id !== id) }));\n      },\n      clear() {\n        set({ entries: [] });\n      },\n    }),\n    {\n      name: 'research:compare-store',\n      version: 1,\n    }\n  )\n);\n","const API_BASE =\n  (typeof window !== 'undefined' ? window.__OB_API_BASE__ : '') ||\n  import.meta.env.VITE_APP_API_URL ||\n  import.meta.env.VITE_API_BASE_URL ||\n  '';\n\nexport type DeepScanStep = {\n  label: string;\n  status: 'running' | 'complete' | 'error';\n  detail?: string;\n  started_at: string;\n  completed_at?: string;\n};\n\nexport type DeepScanSource = {\n  id?: string;\n  title?: string;\n  url?: string;\n  domain?: string;\n  snippet?: string;\n  text?: string;\n  sourceType?: string;\n  relevanceScore?: number;\n  metadata?: Record<string, unknown>;\n  image?: string;\n  wordCount?: number;\n  lang?: string;\n  contentHash?: string;\n  fromCache?: boolean;\n  rendered?: boolean;\n  fetchedAt?: string;\n};\n\nexport type DeepScanResponse = {\n  query: string;\n  sources: DeepScanSource[];\n  search_results: Array<Record<string, unknown>>;\n  steps: DeepScanStep[];\n  created_at: string;\n};\n\ntype DeepScanOptions = {\n  urls?: string[];\n  maxPages?: number;\n  allowRender?: boolean;\n};\n\nexport async function runDeepScan(\n  query: string,\n  options: DeepScanOptions = {}\n): Promise<DeepScanResponse> {\n  if (!API_BASE) {\n    throw new Error('API base URL not configured');\n  }\n\n  const response = await fetch(`${API_BASE.replace(/\\/$/, '')}/api/research/deep-scan`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      query,\n      urls: options.urls,\n      max_pages: options.maxPages ?? 5,\n      allow_render: options.allowRender ?? true,\n    }),\n  });\n\n  if (!response.ok) {\n    const errorText = await response.text().catch(() => response.statusText);\n    throw new Error(errorText || 'Failed to run deep scan');\n  }\n\n  return (await response.json()) as DeepScanResponse;\n}\n","/**\n * Cursor AI Chat Component\n * Displays streaming chat interface with Cursor AI\n */\n\nimport { useState, useEffect, useRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Bot,\n  Send,\n  Loader2,\n  X,\n  Settings,\n  Code,\n  FileText,\n  ExternalLink,\n  AlertCircle,\n} from 'lucide-react';\nimport { ipc } from '../../lib/ipc-typed';\nimport { showToast } from '../../state/toastStore';\n\ninterface CursorMessage {\n  id: string;\n  role: 'user' | 'assistant';\n  content: string;\n  timestamp: number;\n  streaming?: boolean;\n  patches?: Array<{ file: string; start: number; end: number; newText: string }>;\n  citations?: Array<{ file?: string; url?: string; span: [number, number] }>;\n}\n\ninterface CursorChatProps {\n  pageSnapshot?: {\n    url: string;\n    title: string;\n    html?: string;\n    text?: string;\n  };\n  editorState?: {\n    filePath: string;\n    content: string;\n    language?: string;\n    cursorLine?: number;\n    cursorCol?: number;\n  };\n  onClose?: () => void;\n}\n\nexport function CursorChat({ pageSnapshot, editorState, onClose }: CursorChatProps) {\n  const [messages, setMessages] = useState<CursorMessage[]>([]);\n  const [input, setInput] = useState('');\n  const [isStreaming, setIsStreaming] = useState(false);\n  const [hasApiKey, setHasApiKey] = useState<boolean | null>(null);\n  const [showSettings, setShowSettings] = useState(false);\n  const [apiKeyInput, setApiKeyInput] = useState('');\n  const [currentJobId, setCurrentJobId] = useState<string | null>(null);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const abortControllerRef = useRef<AbortController | null>(null);\n\n  // Check API key on mount\n  useEffect(() => {\n    checkApiKey();\n  }, []);\n\n  // Listen for streaming chunks\n  useEffect(() => {\n    const handleStream = (event: {\n      jobId: string;\n      chunk: { type: string; data: unknown; sequenceId?: number };\n    }) => {\n      if (event.jobId !== currentJobId) return;\n\n      const chunk = event.chunk;\n      if (chunk.type === 'token') {\n        setMessages(prev => {\n          const last = prev[prev.length - 1];\n          if (last && last.role === 'assistant' && last.streaming) {\n            return [\n              ...prev.slice(0, -1),\n              {\n                ...last,\n                content: last.content + (chunk.data as string),\n              },\n            ];\n          }\n          return prev;\n        });\n      } else if (chunk.type === 'patch') {\n        // Handle code patches\n        setMessages(prev => {\n          const last = prev[prev.length - 1];\n          if (last && last.role === 'assistant') {\n            return [\n              ...prev.slice(0, -1),\n              {\n                ...last,\n                patches: [\n                  ...(last.patches || []),\n                  chunk.data as NonNullable<CursorMessage['patches']>[number],\n                ],\n              },\n            ];\n          }\n          return prev;\n        });\n      } else if (chunk.type === 'citation') {\n        // Handle citations\n        setMessages(prev => {\n          const last = prev[prev.length - 1];\n          if (last && last.role === 'assistant') {\n            return [\n              ...prev.slice(0, -1),\n              {\n                ...last,\n                citations: [\n                  ...(last.citations || []),\n                  chunk.data as NonNullable<CursorMessage['citations']>[number],\n                ],\n              },\n            ];\n          }\n          return prev;\n        });\n      } else if (chunk.type === 'done') {\n        setIsStreaming(false);\n        setMessages(prev => {\n          const last = prev[prev.length - 1];\n          if (last && last.role === 'assistant' && last.streaming) {\n            return [\n              ...prev.slice(0, -1),\n              {\n                ...last,\n                streaming: false,\n              },\n            ];\n          }\n          return prev;\n        });\n      } else if (chunk.type === 'error') {\n        setIsStreaming(false);\n        showToast('error', `Cursor error: ${chunk.data}`);\n        setMessages(prev => {\n          const last = prev[prev.length - 1];\n          if (last && last.streaming) {\n            return [\n              ...prev.slice(0, -1),\n              {\n                ...last,\n                streaming: false,\n                content: last.content + `\\n\\n[Error: ${chunk.data}]`,\n              },\n            ];\n          }\n          return prev;\n        });\n      }\n    };\n\n    // @ts-ignore - Electron IPC\n    window.electron?.ipcRenderer?.on('cursor:stream', handleStream);\n\n    return () => {\n      // @ts-ignore\n      window.electron?.ipcRenderer?.removeListener('cursor:stream', handleStream);\n    };\n  }, [currentJobId]);\n\n  // Auto-scroll to bottom\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  const checkApiKey = async () => {\n    try {\n      const result = await ipc.cursor.checkApiKey();\n      setHasApiKey(result.hasKey);\n    } catch (error) {\n      console.error('[CursorChat] Failed to check API key', error);\n      setHasApiKey(false);\n    }\n  };\n\n  const handleSetApiKey = async () => {\n    if (!apiKeyInput.trim()) {\n      showToast('error', 'API key cannot be empty');\n      return;\n    }\n\n    try {\n      await ipc.cursor.setApiKey({ apiKey: apiKeyInput.trim() });\n      setHasApiKey(true);\n      setShowSettings(false);\n      setApiKeyInput('');\n      showToast('success', 'API key saved securely');\n    } catch (error) {\n      console.error('[CursorChat] Failed to set API key', error);\n      showToast('error', 'Failed to save API key');\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!input.trim() || isStreaming || !hasApiKey) return;\n\n    const question = input.trim();\n    setInput('');\n\n    // Add user message\n    const userMessage: CursorMessage = {\n      id: `msg-${Date.now()}-user`,\n      role: 'user',\n      content: question,\n      timestamp: Date.now(),\n    };\n\n    // Add assistant placeholder\n    const assistantMessage: CursorMessage = {\n      id: `msg-${Date.now()}-assistant`,\n      role: 'assistant',\n      content: '',\n      timestamp: Date.now(),\n      streaming: true,\n    };\n\n    setMessages(prev => [...prev, userMessage, assistantMessage]);\n    setIsStreaming(true);\n\n    try {\n      const response = await ipc.cursor.query({\n        question,\n        pageSnapshot,\n        editorState,\n        useWebSocket: false, // Use SSE for now\n      });\n\n      setCurrentJobId(response.jobId);\n    } catch (error) {\n      console.error('[CursorChat] Query failed', error);\n      showToast('error', error instanceof Error ? error.message : 'Query failed');\n      setIsStreaming(false);\n      setMessages(prev => prev.slice(0, -1)); // Remove assistant placeholder\n    }\n  };\n\n  const handleCancel = () => {\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort();\n    }\n    setIsStreaming(false);\n    setCurrentJobId(null);\n  };\n\n  const handleClearHistory = async () => {\n    try {\n      await ipc.cursor.clearHistory();\n      setMessages([]);\n      showToast('success', 'Conversation history cleared');\n    } catch (error) {\n      console.error('[CursorChat] Failed to clear history', error);\n    }\n  };\n\n  if (hasApiKey === null) {\n    return (\n      <div className=\"flex items-center justify-center p-8\">\n        <Loader2 className=\"animate-spin text-blue-500\" size={24} />\n      </div>\n    );\n  }\n\n  if (!hasApiKey) {\n    return (\n      <div className=\"flex flex-col items-center justify-center p-8 space-y-4\">\n        <AlertCircle className=\"text-yellow-500\" size={48} />\n        <h3 className=\"text-lg font-semibold text-gray-200\">Cursor API Key Required</h3>\n        <p className=\"text-sm text-gray-400 text-center max-w-md\">\n          Please configure your Cursor API key to use the AI assistant. Your key will be stored\n          securely using your OS keychain.\n        </p>\n        <button\n          onClick={() => setShowSettings(true)}\n          className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition\"\n        >\n          Configure API Key\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col h-full bg-slate-900/60 border border-slate-700/70 rounded-xl overflow-hidden\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between p-4 border-b border-slate-700/70\">\n        <div className=\"flex items-center gap-2\">\n          <Bot className=\"text-blue-400\" size={20} />\n          <h3 className=\"text-sm font-semibold text-gray-200\">Cursor AI</h3>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          {(pageSnapshot || editorState) && (\n            <div className=\"flex items-center gap-1 text-xs text-gray-400\">\n              {pageSnapshot && <FileText size={12} />}\n              {editorState && <Code size={12} />}\n            </div>\n          )}\n          <button\n            onClick={() => setShowSettings(true)}\n            className=\"p-1.5 rounded hover:bg-slate-800 transition\"\n            title=\"Settings\"\n          >\n            <Settings size={16} className=\"text-gray-400\" />\n          </button>\n          {onClose && (\n            <button\n              onClick={onClose}\n              className=\"p-1.5 rounded hover:bg-slate-800 transition\"\n              title=\"Close\"\n            >\n              <X size={16} className=\"text-gray-400\" />\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Messages */}\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n        {messages.length === 0 && (\n          <div className=\"flex flex-col items-center justify-center h-full text-center space-y-2\">\n            <Bot className=\"text-gray-500\" size={48} />\n            <p className=\"text-sm text-gray-400\">Ask Cursor AI anything about this page or code</p>\n          </div>\n        )}\n\n        <AnimatePresence>\n          {messages.map(msg => (\n            <motion.div\n              key={msg.id}\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}\n            >\n              <div\n                className={`max-w-[80%] rounded-lg p-3 ${\n                  msg.role === 'user'\n                    ? 'bg-blue-600/80 text-white'\n                    : 'bg-slate-800/80 text-gray-200'\n                }`}\n              >\n                <p className=\"text-sm whitespace-pre-wrap\">{msg.content}</p>\n                {msg.streaming && (\n                  <span className=\"inline-block w-2 h-4 bg-blue-400 ml-1 animate-pulse\" />\n                )}\n                {msg.citations && msg.citations.length > 0 && (\n                  <div className=\"mt-2 pt-2 border-t border-slate-700 space-y-1\">\n                    {msg.citations.map((cite, idx) => (\n                      <a\n                        key={idx}\n                        href={cite.url || cite.file}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"text-xs text-blue-300 hover:text-blue-200 flex items-center gap-1\"\n                      >\n                        <ExternalLink size={12} />\n                        {cite.file || cite.url}\n                      </a>\n                    ))}\n                  </div>\n                )}\n              </div>\n            </motion.div>\n          ))}\n        </AnimatePresence>\n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* Input */}\n      <form onSubmit={handleSubmit} className=\"p-4 border-t border-slate-700/70 space-y-2\">\n        <div className=\"flex items-center gap-2\">\n          <input\n            type=\"text\"\n            value={input}\n            onChange={e => setInput(e.target.value)}\n            placeholder=\"Ask Cursor AI...\"\n            disabled={isStreaming}\n            className=\"flex-1 px-3 py-2 bg-slate-800/80 border border-slate-700/70 rounded-lg text-sm text-gray-200 placeholder:text-gray-500 focus:outline-none focus:border-blue-500 disabled:opacity-50\"\n          />\n          {isStreaming ? (\n            <button\n              type=\"button\"\n              onClick={handleCancel}\n              className=\"px-4 py-2 bg-red-600/80 text-white rounded-lg hover:bg-red-700 transition\"\n            >\n              Cancel\n            </button>\n          ) : (\n            <button\n              type=\"submit\"\n              disabled={!input.trim()}\n              className=\"px-4 py-2 bg-blue-600/80 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\n            >\n              <Send size={16} />\n            </button>\n          )}\n        </div>\n        <div className=\"flex items-center justify-between text-xs text-gray-500\">\n          <button\n            type=\"button\"\n            onClick={handleClearHistory}\n            className=\"hover:text-gray-400 transition\"\n          >\n            Clear history\n          </button>\n          <span>{messages.length} messages</span>\n        </div>\n      </form>\n\n      {/* Settings Modal */}\n      {showSettings && (\n        <div\n          className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\"\n          onClick={() => setShowSettings(false)}\n        >\n          <div\n            className=\"bg-slate-900 border border-slate-700 rounded-xl p-6 max-w-md w-full mx-4\"\n            onClick={e => e.stopPropagation()}\n          >\n            <h3 className=\"text-lg font-semibold text-gray-200 mb-4\">Cursor API Key</h3>\n            <p className=\"text-sm text-gray-400 mb-4\">\n              Your API key will be stored securely using your OS keychain.\n            </p>\n            <input\n              type=\"password\"\n              value={apiKeyInput}\n              onChange={e => setApiKeyInput(e.target.value)}\n              placeholder=\"Enter Cursor API key\"\n              className=\"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-sm text-gray-200 mb-4 focus:outline-none focus:border-blue-500\"\n            />\n            <div className=\"flex items-center gap-2\">\n              <button\n                onClick={handleSetApiKey}\n                className=\"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition\"\n              >\n                Save\n              </button>\n              <button\n                onClick={() => {\n                  setShowSettings(false);\n                  setApiKeyInput('');\n                }}\n                className=\"px-4 py-2 bg-slate-800 text-gray-300 rounded-lg hover:bg-slate-700 transition\"\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","/**\r\n * OmniAgent Runner - Tier 2\r\n * Executes agent tasks using registered tools\r\n */\r\n\r\nimport { toolRegistry } from './registry';\r\nimport { log } from '../utils/logger';\r\nimport { metricsCollector, traceFunction } from '../core/observability';\r\nimport { track } from '../services/analytics';\r\n\r\nexport type AgentTask =\r\n  | { type: 'quick_summary'; url: string }\r\n  | { type: 'deep_research'; topic: string; maxSources?: number }\r\n  | { type: 'compare_urls'; urls: string[] }\r\n  | { type: 'explain_page'; url: string };\r\n\r\nexport interface AgentResult {\r\n  type: string;\r\n  content: string;\r\n  sources?: Array<{ url: string; title: string }>;\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\n/**\r\n * Run an agent task\r\n */\r\nexport async function runAgent(task: AgentTask): Promise<AgentResult> {\r\n  return traceFunction(\r\n    `agent:${task.type}`,\r\n    async () => {\r\n      const startTime = performance.now();\r\n      track('agent_task_started', { taskType: task.type });\r\n\r\n      try {\r\n        let result: AgentResult;\r\n\r\n        switch (task.type) {\r\n          case 'quick_summary': {\r\n            result = await handleQuickSummary(task);\r\n            break;\r\n          }\r\n          case 'deep_research': {\r\n            result = await handleDeepResearch(task);\r\n            break;\r\n          }\r\n          case 'compare_urls': {\r\n            result = await handleCompareUrls(task);\r\n            break;\r\n          }\r\n          case 'explain_page': {\r\n            result = await handleExplainPage(task);\r\n            break;\r\n          }\r\n          default:\r\n            throw new Error(`Unknown task type: ${(task as any).type}`);\r\n        }\r\n\r\n        const duration = performance.now() - startTime;\r\n        metricsCollector.recordAgent({\r\n          agentId: 'regen',\r\n          runId: `run-${Date.now()}`,\r\n          duration,\r\n          success: true,\r\n          timestamp: Date.now(),\r\n        });\r\n\r\n        track('agent_task_completed', { taskType: task.type, duration });\r\n        return result;\r\n      } catch (error) {\r\n        const duration = performance.now() - startTime;\r\n        metricsCollector.recordAgent({\r\n          agentId: 'regen',\r\n          runId: `run-${Date.now()}`,\r\n          duration,\r\n          success: false,\r\n          timestamp: Date.now(),\r\n        });\r\n\r\n        track('agent_task_failed', { taskType: task.type, error: String(error) });\r\n        log.error('[Agent] Task failed', { task, error });\r\n        throw error;\r\n      }\r\n    },\r\n    { taskType: task.type }\r\n  );\r\n}\r\n\r\n/**\r\n * Handle quick summary task\r\n */\r\nasync function handleQuickSummary(task: {\r\n  type: 'quick_summary';\r\n  url: string;\r\n}): Promise<AgentResult> {\r\n  const scrapeTool = toolRegistry.get('scrapePage');\r\n  if (!scrapeTool) throw new Error('scrapePage tool not found');\r\n\r\n  const scraped = (await scrapeTool.execute({ url: task.url })) as {\r\n    title: string;\r\n    content: string;\r\n  };\r\n\r\n  const summarizeTool = toolRegistry.get('summarizeText');\r\n  if (!summarizeTool) throw new Error('summarizeText tool not found');\r\n\r\n  const summary = (await summarizeTool.execute({\r\n    text: scraped.content,\r\n    maxLength: 300,\r\n  })) as { summary: string };\r\n\r\n  return {\r\n    type: 'quick_summary',\r\n    content: summary.summary,\r\n    sources: [{ url: task.url, title: scraped.title }],\r\n    metadata: {\r\n      originalLength: scraped.content.length,\r\n      summaryLength: summary.summary.length,\r\n    },\r\n  };\r\n}\r\n\r\n/**\r\n * Handle deep research task\r\n */\r\nasync function handleDeepResearch(task: {\r\n  type: 'deep_research';\r\n  topic: string;\r\n  maxSources?: number;\r\n}): Promise<AgentResult> {\r\n  const maxSources = task.maxSources ?? 3;\r\n  const searchTool = toolRegistry.get('searchWeb');\r\n  if (!searchTool) throw new Error('searchWeb tool not found');\r\n\r\n  const searchResults = (await searchTool.execute({\r\n    query: task.topic,\r\n    maxResults: maxSources,\r\n  })) as {\r\n    results: Array<{ title: string; url: string; snippet: string }>;\r\n  };\r\n\r\n  // Scrape top results\r\n  const scrapeTool = toolRegistry.get('scrapePage');\r\n  if (!scrapeTool) throw new Error('scrapePage tool not found');\r\n\r\n  const sources = await Promise.all(\r\n    searchResults.results.slice(0, maxSources).map(async result => {\r\n      try {\r\n        const scraped = (await scrapeTool.execute({ url: result.url })) as {\r\n          title: string;\r\n          content: string;\r\n        };\r\n        return { url: result.url, title: scraped.title || result.title };\r\n      } catch (error) {\r\n        log.warn(`[Agent] Failed to scrape ${result.url}`, error);\r\n        return { url: result.url, title: result.title };\r\n      }\r\n    })\r\n  );\r\n\r\n  // Combine content\r\n  const content = `Research on \"${task.topic}\":\\n\\n${searchResults.results\r\n    .map((r, i) => `${i + 1}. ${r.title}\\n   ${r.snippet}`)\r\n    .join('\\n\\n')}`;\r\n\r\n  return {\r\n    type: 'deep_research',\r\n    content,\r\n    sources,\r\n    metadata: {\r\n      topic: task.topic,\r\n      sourceCount: sources.length,\r\n    },\r\n  };\r\n}\r\n\r\n/**\r\n * Handle compare URLs task\r\n */\r\nasync function handleCompareUrls(task: {\r\n  type: 'compare_urls';\r\n  urls: string[];\r\n}): Promise<AgentResult> {\r\n  const scrapeTool = toolRegistry.get('scrapePage');\r\n  if (!scrapeTool) throw new Error('scrapePage tool not found');\r\n\r\n  const scraped = await Promise.all(\r\n    task.urls.map(async url => {\r\n      try {\r\n        const result = (await scrapeTool.execute({ url })) as {\r\n          title: string;\r\n          content: string;\r\n        };\r\n        return { url, title: result.title, content: result.content };\r\n      } catch (error) {\r\n        log.warn(`[Agent] Failed to scrape ${url}`, error);\r\n        return { url, title: 'Unknown', content: '' };\r\n      }\r\n    })\r\n  );\r\n\r\n  const content = `Comparison of ${task.urls.length} pages:\\n\\n${scraped\r\n    .map((s, i) => `${i + 1}. ${s.title} (${s.url})\\n   ${s.content.slice(0, 200)}...`)\r\n    .join('\\n\\n')}`;\r\n\r\n  return {\r\n    type: 'compare_urls',\r\n    content,\r\n    sources: scraped.map(s => ({ url: s.url, title: s.title })),\r\n    metadata: {\r\n      urlCount: task.urls.length,\r\n    },\r\n  };\r\n}\r\n\r\n/**\r\n * Handle explain page task\r\n */\r\nasync function handleExplainPage(task: {\r\n  type: 'explain_page';\r\n  url: string;\r\n}): Promise<AgentResult> {\r\n  const result = await handleQuickSummary({ type: 'quick_summary', url: task.url });\r\n  return {\r\n    ...result,\r\n    type: 'explain_page',\r\n    content: `Explanation of ${result.sources?.[0]?.title || task.url}:\\n\\n${result.content}`,\r\n  };\r\n}\r\n","/**\n * Agent Task Graph - Tier 3 Pillar 1\n * Graph-based multi-step task execution\n */\n\nimport { log } from '../../utils/logger';\nimport { track } from '../../services/analytics';\n\nexport type AgentNode = {\n  id: string;\n  tool: string; // Tool name from registry\n  input: Record<string, unknown>; // Tool input\n  inputFrom?: string[]; // Node IDs to get input from\n  retryCount?: number;\n  maxRetries?: number;\n  timeout?: number;\n};\n\nexport type AgentPlan = {\n  id: string;\n  nodes: AgentNode[];\n  metadata?: {\n    goal?: string;\n    userId?: string;\n    createdAt?: number;\n  };\n};\n\nexport type NodeResult = {\n  nodeId: string;\n  success: boolean;\n  output?: unknown;\n  error?: string;\n  duration: number;\n};\n\nexport type PlanExecutionResult = {\n  planId: string;\n  success: boolean;\n  results: NodeResult[];\n  finalOutput?: unknown;\n  error?: string;\n  totalDuration: number;\n};\n\ntype ToolRegistry = Map<string, (input: unknown, ctx: ToolContext) => Promise<unknown>>;\n\nexport interface ToolContext {\n  planId: string;\n  nodeId: string;\n  previousResults: Map<string, unknown>;\n  memory: AgentMemory;\n}\n\nexport interface AgentMemory {\n  get: (key: string) => unknown | null;\n  set: (key: string, value: unknown) => void;\n  remember: (type: 'preference' | 'fact' | 'task_history', key: string, value: unknown) => void;\n}\n\nclass AgentTaskGraph {\n  private toolRegistry: ToolRegistry = new Map();\n\n  /**\n   * Register a tool\n   */\n  registerTool(\n    name: string,\n    handler: (input: unknown, ctx: ToolContext) => Promise<unknown>\n  ): void {\n    this.toolRegistry.set(name, handler);\n    log.info(`[AgentGraph] Registered tool: ${name}`);\n  }\n\n  /**\n   * Create a plan from a goal\n   */\n  createPlan(goal: string, nodes: Omit<AgentNode, 'id'>[]): AgentPlan {\n    return {\n      id: `plan-${Date.now()}-${Math.random().toString(36).slice(2)}`,\n      nodes: nodes.map(node => ({\n        ...node,\n        id: (node as any).id || `node-${Date.now()}-${Math.random().toString(36).slice(2)}`,\n        retryCount: 0,\n        maxRetries: node.maxRetries ?? 3,\n        timeout: node.timeout ?? 30000, // 30s default\n      })),\n      metadata: {\n        goal,\n        createdAt: Date.now(),\n      },\n    };\n  }\n\n  /**\n   * Execute a plan\n   */\n  async runPlan(plan: AgentPlan, memory: AgentMemory): Promise<PlanExecutionResult> {\n    const startTime = performance.now();\n    const results: NodeResult[] = [];\n    const previousResults = new Map<string, unknown>();\n\n    log.info(`[AgentGraph] Executing plan: ${plan.id} (${plan.nodes.length} nodes)`);\n    track('agent_plan_started' as any, { planId: plan.id, nodeCount: plan.nodes.length });\n\n    try {\n      // Execute nodes in order (topological sort would be better for complex graphs)\n      for (const node of plan.nodes) {\n        const nodeStartTime = performance.now();\n\n        try {\n          // Resolve input from previous nodes\n          const resolvedInput = await this.resolveNodeInput(node, previousResults);\n\n          // Get tool handler\n          const toolHandler = this.toolRegistry.get(node.tool);\n          if (!toolHandler) {\n            throw new Error(`Tool not found: ${node.tool}`);\n          }\n\n          // Execute with timeout\n          const output = await this.executeWithTimeout(\n            () =>\n              toolHandler(resolvedInput, {\n                planId: plan.id,\n                nodeId: node.id,\n                previousResults,\n                memory,\n              }),\n            node.timeout || 30000\n          );\n\n          const duration = performance.now() - nodeStartTime;\n          results.push({\n            nodeId: node.id,\n            success: true,\n            output,\n            duration,\n          });\n\n          previousResults.set(node.id, output);\n          log.info(`[AgentGraph] Node ${node.id} completed in ${duration.toFixed(0)}ms`);\n\n          // Remember successful execution\n          memory.remember('task_history', `node:${node.id}`, {\n            tool: node.tool,\n            success: true,\n            timestamp: Date.now(),\n          });\n        } catch (error) {\n          const duration = performance.now() - nodeStartTime;\n          const errorMessage = error instanceof Error ? error.message : String(error);\n\n          // Retry logic\n          if ((node.retryCount || 0) < (node.maxRetries || 3)) {\n            node.retryCount = (node.retryCount || 0) + 1;\n            log.warn(\n              `[AgentGraph] Node ${node.id} failed, retrying (${node.retryCount}/${node.maxRetries})`\n            );\n\n            // Retry the node\n            const retryResult = await this.retryNode(node, previousResults, memory);\n            results.push(retryResult);\n            if (retryResult.success && retryResult.output) {\n              previousResults.set(node.id, retryResult.output);\n            }\n          } else {\n            results.push({\n              nodeId: node.id,\n              success: false,\n              error: errorMessage,\n              duration,\n            });\n\n            log.error(`[AgentGraph] Node ${node.id} failed after retries: ${errorMessage}`);\n            // Continue with other nodes (partial failure)\n          }\n        }\n      }\n\n      const totalDuration = performance.now() - startTime;\n      const success = results.every(r => r.success);\n      const finalOutput = results[results.length - 1]?.output;\n\n      const result: PlanExecutionResult = {\n        planId: plan.id,\n        success,\n        results,\n        finalOutput,\n        totalDuration,\n      };\n\n      track('agent_plan_completed' as any, {\n        planId: plan.id,\n        success,\n        nodeCount: plan.nodes.length,\n        duration: totalDuration,\n      });\n\n      return result;\n    } catch (error) {\n      const totalDuration = performance.now() - startTime;\n      const errorMessage = error instanceof Error ? error.message : String(error);\n\n      track('agent_plan_failed' as any, { planId: plan.id, error: errorMessage });\n\n      return {\n        planId: plan.id,\n        success: false,\n        results,\n        error: errorMessage,\n        totalDuration,\n      };\n    }\n  }\n\n  /**\n   * Resolve node input from previous results\n   */\n  private async resolveNodeInput(\n    node: AgentNode,\n    previousResults: Map<string, unknown>\n  ): Promise<unknown> {\n    if (!node.inputFrom || node.inputFrom.length === 0) {\n      return node.input;\n    }\n\n    // Merge inputs from previous nodes\n    const mergedInput = { ...node.input };\n    for (const sourceNodeId of node.inputFrom) {\n      const sourceOutput = previousResults.get(sourceNodeId);\n      if (sourceOutput) {\n        // Merge source output into input\n        if (typeof sourceOutput === 'object' && sourceOutput !== null) {\n          Object.assign(mergedInput, sourceOutput);\n        } else {\n          mergedInput[sourceNodeId] = sourceOutput;\n        }\n      }\n    }\n\n    return mergedInput;\n  }\n\n  /**\n   * Execute with timeout\n   */\n  private async executeWithTimeout<T>(fn: () => Promise<T>, timeout: number): Promise<T> {\n    return Promise.race([\n      fn(),\n      new Promise<T>((_, reject) =>\n        setTimeout(() => reject(new Error(`Execution timeout after ${timeout}ms`)), timeout)\n      ),\n    ]);\n  }\n\n  /**\n   * Retry a failed node\n   */\n  private async retryNode(\n    node: AgentNode,\n    previousResults: Map<string, unknown>,\n    memory: AgentMemory\n  ): Promise<NodeResult> {\n    const startTime = performance.now();\n\n    try {\n      const resolvedInput = await this.resolveNodeInput(node, previousResults);\n      const toolHandler = this.toolRegistry.get(node.tool);\n      if (!toolHandler) {\n        throw new Error(`Tool not found: ${node.tool}`);\n      }\n\n      const output = await this.executeWithTimeout(\n        () =>\n          toolHandler(resolvedInput, {\n            planId: 'retry',\n            nodeId: node.id,\n            previousResults,\n            memory,\n          }),\n        node.timeout || 30000\n      );\n\n      return {\n        nodeId: node.id,\n        success: true,\n        output,\n        duration: performance.now() - startTime,\n      };\n    } catch (error) {\n      return {\n        nodeId: node.id,\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        duration: performance.now() - startTime,\n      };\n    }\n  }\n}\n\n// Singleton instance\nexport const agentTaskGraph = new AgentTaskGraph();\n","/**\r\n * Agent Memory Layer - Tier 3 Pillar 1\r\n * Preference learning, task history, pattern recognition\r\n */\r\n\r\nimport { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\nimport { log } from '../../utils/logger';\r\n\r\nexport type MemoryType = 'preference' | 'fact' | 'task_history';\r\n\r\nexport type MemoryItem = {\r\n  id: string;\r\n  type: MemoryType;\r\n  key: string;\r\n  value: unknown;\r\n  createdAt: number;\r\n  lastUsedAt: number;\r\n  usageCount: number;\r\n};\r\n\r\nexport interface AgentMemory {\r\n  get: (key: string) => unknown | null;\r\n  set: (key: string, value: unknown) => void;\r\n  remember: (type: MemoryType, key: string, value: unknown) => void;\r\n  getPreferences: () => Record<string, unknown>;\r\n  getTaskHistory: (limit?: number) => MemoryItem[];\r\n  findPatterns: (type: MemoryType) => MemoryItem[];\r\n}\r\n\r\ntype MemoryState = {\r\n  items: MemoryItem[];\r\n  add: (item: Omit<MemoryItem, 'id' | 'createdAt' | 'lastUsedAt' | 'usageCount'>) => void;\r\n  update: (id: string, updates: Partial<MemoryItem>) => void;\r\n  getByKey: (key: string) => MemoryItem | undefined;\r\n  getByType: (type: MemoryType) => MemoryItem[];\r\n  clear: () => void;\r\n};\r\n\r\nconst useMemoryStore = create<MemoryState>()(\r\n  persist(\r\n    (set, get) => ({\r\n      items: [],\r\n      add: item => {\r\n        const existing = get().items.find(i => i.key === item.key && i.type === item.type);\r\n        if (existing) {\r\n          // Update existing\r\n          get().update(existing.id, {\r\n            value: item.value,\r\n            lastUsedAt: Date.now(),\r\n            usageCount: existing.usageCount + 1,\r\n          });\r\n        } else {\r\n          // Add new\r\n          const newItem: MemoryItem = {\r\n            ...item,\r\n            id: `memory-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,\r\n            createdAt: Date.now(),\r\n            lastUsedAt: Date.now(),\r\n            usageCount: 1,\r\n          };\r\n          set(state => ({ items: [...state.items, newItem] }));\r\n        }\r\n      },\r\n      update: (id, updates) =>\r\n        set(state => ({\r\n          items: state.items.map(item => (item.id === id ? { ...item, ...updates } : item)),\r\n        })),\r\n      getByKey: key => {\r\n        return get().items.find(item => item.key === key);\r\n      },\r\n      getByType: type => {\r\n        return get().items.filter(item => item.type === type);\r\n      },\r\n      clear: () => set({ items: [] }),\r\n    }),\r\n    {\r\n      name: 'regen_agent_memory_v1',\r\n    }\r\n  )\r\n);\r\n\r\n/**\r\n * Agent Memory implementation\r\n */\r\nexport class AgentMemoryImpl implements AgentMemory {\r\n  get(key: string): unknown | null {\r\n    const item = useMemoryStore.getState().getByKey(key);\r\n    if (item) {\r\n      // Update last used\r\n      useMemoryStore.getState().update(item.id, { lastUsedAt: Date.now() });\r\n      return item.value;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  set(key: string, value: unknown): void {\r\n    useMemoryStore.getState().add({\r\n      type: 'fact',\r\n      key,\r\n      value,\r\n    });\r\n  }\r\n\r\n  remember(type: MemoryType, key: string, value: unknown): void {\r\n    useMemoryStore.getState().add({\r\n      type,\r\n      key,\r\n      value,\r\n    });\r\n    log.debug(`[AgentMemory] Remembered ${type}: ${key}`);\r\n  }\r\n\r\n  getPreferences(): Record<string, unknown> {\r\n    const preferences = useMemoryStore.getState().getByType('preference');\r\n    const result: Record<string, unknown> = {};\r\n    preferences.forEach(item => {\r\n      result[item.key] = item.value;\r\n    });\r\n    return result;\r\n  }\r\n\r\n  getTaskHistory(limit = 10): MemoryItem[] {\r\n    const history = useMemoryStore\r\n      .getState()\r\n      .getByType('task_history')\r\n      .sort((a, b) => b.lastUsedAt - a.lastUsedAt)\r\n      .slice(0, limit);\r\n    return history;\r\n  }\r\n\r\n  findPatterns(type: MemoryType): MemoryItem[] {\r\n    const items = useMemoryStore.getState().getByType(type);\r\n    // Return most frequently used items\r\n    return items.sort((a, b) => b.usageCount - a.usageCount).slice(0, 5);\r\n  }\r\n\r\n  /**\r\n   * Infer preferences from usage patterns\r\n   */\r\n  inferPreferences(): Record<string, unknown> {\r\n    const patterns = this.findPatterns('task_history');\r\n    const preferences: Record<string, unknown> = {};\r\n\r\n    // Example: if user often researches AI + startups, suggest that preset\r\n    const researchTopics = patterns\r\n      .filter(p => typeof p.value === 'object' && p.value !== null && 'topic' in (p.value as any))\r\n      .map(p => (p.value as any).topic);\r\n\r\n    if (researchTopics.length > 0) {\r\n      preferences['common_research_topics'] = researchTopics;\r\n    }\r\n\r\n    // Example: if user prefers bullet summaries\r\n    const summaryFormats = patterns\r\n      .filter(p => typeof p.value === 'object' && p.value !== null && 'format' in (p.value as any))\r\n      .map(p => (p.value as any).format);\r\n\r\n    if (summaryFormats.length > 0) {\r\n      const mostCommon = summaryFormats[0];\r\n      preferences['preferred_summary_format'] = mostCommon;\r\n    }\r\n\r\n    return preferences;\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nexport const agentMemory = new AgentMemoryImpl();\r\n","/**\n * Agent Planner - Tier 3 Pillar 1\n * Convert natural language goals into executable plans\n */\n\nimport { agentTaskGraph } from './graph';\nimport { agentMemory } from './memory';\nimport type { AgentPlan, AgentNode } from './graph';\nimport { log } from '../../utils/logger';\n\n/**\n * Plan a multi-step task from a goal\n */\nexport async function planFromGoal(goal: string): Promise<AgentPlan> {\n  log.info(`[AgentPlanner] Planning for goal: ${goal}`);\n\n  // Simple heuristic-based planner (can be replaced with LLM later)\n  const goalLower = goal.toLowerCase();\n\n  // Example: \"Research 5 best AI browsers, compare features, give table, save as workspace\"\n  if (goalLower.includes('research') && goalLower.includes('compare')) {\n    return createResearchComparePlan(goal);\n  }\n\n  // Example: \"Summarize this page\"\n  if (goalLower.includes('summarize') || goalLower.includes('explain')) {\n    return createSummaryPlan(goal);\n  }\n\n  // Example: \"Extract key dates from this document\"\n  if (goalLower.includes('extract') && goalLower.includes('date')) {\n    return createExtractDatesPlan(goal);\n  }\n\n  // Default: simple single-step plan\n  return createSimplePlan(goal);\n}\n\n/**\n * Create a research and compare plan\n */\nfunction createResearchComparePlan(goal: string): AgentPlan {\n  const nodes: AgentNode[] = [\n    {\n      id: 'search',\n      tool: 'search_web',\n      input: {\n        query: extractQuery(goal),\n        maxResults: 5,\n      },\n    },\n    {\n      id: 'scrape',\n      tool: 'scrape_page',\n      input: {},\n      inputFrom: ['search'], // Get URLs from search results\n    },\n    {\n      id: 'extract',\n      tool: 'extract_table',\n      input: {},\n      inputFrom: ['scrape'],\n    },\n    {\n      id: 'summarize',\n      tool: 'summarize_text',\n      input: {\n        format: 'bullet',\n      },\n      inputFrom: ['extract'],\n    },\n    {\n      id: 'save',\n      tool: 'manage_workspaces',\n      input: {\n        action: 'create',\n        name: `Research: ${extractQuery(goal)}`,\n      },\n      inputFrom: ['scrape'],\n    },\n  ];\n\n  return agentTaskGraph.createPlan(goal, nodes);\n}\n\n/**\n * Create a summary plan\n */\nfunction createSummaryPlan(goal: string): AgentPlan {\n  const nodes: AgentNode[] = [\n    {\n      id: 'scrape',\n      tool: 'scrape_page',\n      input: {\n        url: extractUrl(goal) || 'current_page',\n      },\n    },\n    {\n      id: 'summarize',\n      tool: 'summarize_text',\n      input: {\n        format: agentMemory.getPreferences()['preferred_summary_format'] || 'paragraph',\n      },\n      inputFrom: ['scrape'],\n    },\n  ];\n\n  return agentTaskGraph.createPlan(goal, nodes);\n}\n\n/**\n * Create an extract dates plan\n */\nfunction createExtractDatesPlan(goal: string): AgentPlan {\n  const nodes: AgentNode[] = [\n    {\n      id: 'scrape',\n      tool: 'scrape_page',\n      input: {\n        url: extractUrl(goal) || 'current_page',\n      },\n    },\n    {\n      id: 'extract',\n      tool: 'extract_table',\n      input: {},\n      inputFrom: ['scrape'],\n    },\n  ];\n\n  return agentTaskGraph.createPlan(goal, nodes);\n}\n\n/**\n * Create a simple single-step plan\n */\nfunction createSimplePlan(goal: string): AgentPlan {\n  // Try to infer the tool from the goal\n  let tool = 'search_web';\n  if (goal.toLowerCase().includes('summarize') || goal.toLowerCase().includes('explain')) {\n    tool = 'summarize_text';\n  } else if (goal.toLowerCase().includes('scrape') || goal.toLowerCase().includes('read')) {\n    tool = 'scrape_page';\n  }\n\n  const nodes: AgentNode[] = [\n    {\n      id: 'execute',\n      tool,\n      input: {\n        query: goal,\n      },\n    },\n  ];\n\n  return agentTaskGraph.createPlan(goal, nodes);\n}\n\n/**\n * Extract query from goal\n */\nfunction extractQuery(goal: string): string {\n  // Simple extraction - can be enhanced with NLP\n  const match = goal.match(/research\\s+(.+?)(?:\\s+and|$)/i);\n  if (match) return match[1].trim();\n  return goal;\n}\n\n/**\n * Extract URL from goal\n */\nfunction extractUrl(goal: string): string | null {\n  const urlMatch = goal.match(/https?:\\/\\/[^\\s]+/);\n  return urlMatch ? urlMatch[0] : null;\n}\n\n/**\n * Execute a plan from a goal (high-level API)\n */\nexport async function executePlanFromGoal(goal: string): Promise<unknown> {\n  const plan = await planFromGoal(goal);\n  const result = await agentTaskGraph.runPlan(plan, agentMemory);\n\n  if (!result.success) {\n    throw new Error(result.error || 'Plan execution failed');\n  }\n\n  return result.finalOutput;\n}\n","/**\n * Agent Integration - Tier 3 Pillar 1\n * Wire up agent graph, tools, and memory\n */\n\nimport { agentTaskGraph } from './graph';\nimport { toolRegistryV2 } from './tools/v2';\nimport { executePlanFromGoal } from './planner';\nimport { log } from '../../utils/logger';\n\n/**\n * Initialize agent system\n */\nexport function initializeAgentSystem() {\n  // Register all v2 tools with the graph\n  const tools = toolRegistryV2.getAll();\n  tools.forEach(tool => {\n    agentTaskGraph.registerTool(tool.name, async (input, ctx) => {\n      return toolRegistryV2.execute(tool.name, input, ctx);\n    });\n  });\n\n  log.info(`[AgentSystem] Initialized with ${tools.length} tools`);\n}\n\n/**\n * High-level API: Execute a goal\n */\nexport async function executeAgentGoal(goal: string): Promise<unknown> {\n  return executePlanFromGoal(goal);\n}\n\n// Initialize on import\ninitializeAgentSystem();\n","/**\n * OmniAgent Input - Tier 2\n * \"Ask OmniAgent\" input in Research Mode\n */\n\nimport { useState } from 'react';\nimport { Send, Loader2, Sparkles } from 'lucide-react';\nimport { runAgent, type AgentTask } from '../agent/runAgent';\nimport { executeAgentGoal } from '../core/agent/integration';\nimport { toast } from '../utils/toast';\nimport { validateUrlForAgent } from '../core/security/urlSafety';\n\ninterface OmniAgentInputProps {\n  currentUrl?: string;\n  onResult?: (result: {\n    type: string;\n    content: string;\n    sources?: Array<{ url: string; title: string }>;\n  }) => void;\n}\n\nexport function OmniAgentInput({ currentUrl, onResult }: OmniAgentInputProps) {\n  const [query, setQuery] = useState('');\n  const [loading, setLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!query.trim() || loading) return;\n\n    setLoading(true);\n    try {\n      // Tier 3: Use new agent planner for complex goals\n      let result;\n\n      // Check if it's a complex multi-step goal\n      const isComplexGoal =\n        query.toLowerCase().includes('research') &&\n        (query.toLowerCase().includes('compare') ||\n          query.toLowerCase().includes('save') ||\n          query.toLowerCase().includes('workspace'));\n\n      if (isComplexGoal) {\n        // Use new agent graph system\n        result = await executeAgentGoal(query);\n        onResult?.({\n          type: 'complex_plan',\n          content: typeof result === 'string' ? result : JSON.stringify(result, null, 2),\n          sources: [],\n        });\n      } else {\n        // Use simple agent for quick tasks\n        let task: AgentTask;\n\n        if (\n          currentUrl &&\n          (query.toLowerCase().includes('explain') || query.toLowerCase().includes('this page'))\n        ) {\n          const validation = validateUrlForAgent(currentUrl);\n          if (!validation.safe) {\n            toast.error(validation.reason || 'Unsafe URL');\n            setLoading(false);\n            return;\n          }\n          task = { type: 'explain_page', url: currentUrl };\n        } else if (query.toLowerCase().includes('compare') && query.includes('http')) {\n          const urlMatches = query.match(/https?:\\/\\/[^\\s]+/g) || [];\n          if (urlMatches.length >= 2) {\n            const validation = urlMatches.every(url => validateUrlForAgent(url).safe);\n            if (!validation) {\n              toast.error('One or more URLs are unsafe');\n              setLoading(false);\n              return;\n            }\n            task = { type: 'compare_urls', urls: urlMatches };\n          } else {\n            task = { type: 'deep_research', topic: query };\n          }\n        } else if (query.toLowerCase().includes('research') || query.length > 50) {\n          task = { type: 'deep_research', topic: query };\n        } else if (currentUrl) {\n          const validation = validateUrlForAgent(currentUrl);\n          if (!validation.safe) {\n            toast.error(validation.reason || 'Unsafe URL');\n            setLoading(false);\n            return;\n          }\n          task = { type: 'quick_summary', url: currentUrl };\n        } else {\n          task = { type: 'deep_research', topic: query };\n        }\n\n        result = await runAgent(task);\n        onResult?.(result);\n      }\n\n      toast.success('OmniAgent completed!');\n    } catch (error) {\n      console.error('OmniAgent error', error);\n      toast.error(error instanceof Error ? error.message : 'OmniAgent failed');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"border-t border-slate-800 bg-slate-900/50 p-4\">\n      <form onSubmit={handleSubmit} className=\"space-y-3\">\n        <div className=\"mb-2 flex items-center gap-2 text-sm text-gray-400\">\n          <Sparkles size={14} />\n          <span>Ask OmniAgent</span>\n        </div>\n        <div className=\"flex gap-2\">\n          <input\n            id=\"omni-agent-query\"\n            name=\"omni-agent-query\"\n            type=\"text\"\n            value={query}\n            onChange={e => setQuery(e.target.value)}\n            placeholder={\n              currentUrl\n                ? 'Explain this page, research a topic, or compare URLs...'\n                : 'Research a topic, compare URLs, or ask a question...'\n            }\n            disabled={loading}\n            className=\"flex-1 rounded-lg border border-slate-700 bg-slate-800 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/50 disabled:opacity-50\"\n          />\n          <button\n            type=\"submit\"\n            disabled={!query.trim() || loading}\n            className=\"flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 transition-colors hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-50\"\n          >\n            {loading ? (\n              <>\n                <Loader2 size={14} className=\"animate-spin\" />\n                <span className=\"text-xs\">Processing...</span>\n              </>\n            ) : (\n              <>\n                <Send size={14} />\n                <span className=\"text-xs\">Ask</span>\n              </>\n            )}\n          </button>\n        </div>\n        <div className=\"text-xs text-gray-500\">\n          Examples: \"Explain this page\", \"Research benefits of intermittent fasting\", \"Compare\n          https://example.com and https://example.org\"\n        </div>\n      </form>\n    </div>\n  );\n}\n","/**\n * useResearchWS Hook\n * React hook to connect to WebSocket and subscribe to research job events\n */\n\nimport { useEffect, useRef, useState, useCallback } from 'react';\n\nexport interface ResearchEvent {\n  id: string;\n  jobId: string;\n  type: 'research.event' | 'subscribed';\n  eventType?: string;\n  data?: any;\n  timestamp: number;\n}\n\nexport interface ResearchWSState {\n  connected: boolean;\n  events: ResearchEvent[];\n  streamedAnswer: string;\n  sources: Array<{ url: string; title: string; snippet: string; source: string; score: number }>;\n  reasoningSteps: Array<{ step: number; text: string; citations: number[] }>;\n  citations: Array<{ id: number; url: string; title: string; position: number }>;\n  done: boolean;\n  error: string | null;\n}\n\n/**\n * Hook to subscribe to research job events via WebSocket\n */\nexport function useResearchWS(jobId: string | null) {\n  const [state, setState] = useState<ResearchWSState>({\n    connected: false,\n    events: [],\n    streamedAnswer: '',\n    sources: [],\n    reasoningSteps: [],\n    citations: [],\n    done: false,\n    error: null,\n  });\n\n  const wsRef = useRef<WebSocket | null>(null);\n  const reconnectTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const reconnectAttempts = useRef(0);\n  const maxReconnectAttempts = 5;\n\n  const connect = useCallback(() => {\n    if (!jobId) return;\n\n    // Determine WebSocket URL\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    const host = import.meta.env.VITE_WS_HOST || window.location.host;\n    const wsUrl = `${protocol}//${host}/agent/stream?clientId=research-${Date.now()}&sessionId=research-session`;\n\n    try {\n      const ws = new WebSocket(wsUrl);\n      wsRef.current = ws;\n\n      ws.onopen = () => {\n        console.log('[useResearchWS]  WebSocket connected');\n        setState(prev => ({ ...prev, connected: true, error: null }));\n        reconnectAttempts.current = 0;\n\n        // Subscribe to jobId\n        const subscribeMsg = { type: 'subscribe', jobId };\n        console.log('[useResearchWS] Sending subscribe message:', subscribeMsg);\n        ws.send(JSON.stringify(subscribeMsg));\n      };\n\n      ws.onmessage = event => {\n        try {\n          const msg = JSON.parse(event.data) as ResearchEvent;\n          console.log('[useResearchWS] Received message:', {\n            type: msg.type,\n            eventType: msg.eventType,\n            jobId: msg.jobId,\n            expectedJobId: jobId,\n          });\n\n          // Handle subscription confirmation\n          if (msg.type === 'subscribed' && msg.jobId === jobId) {\n            console.log('[useResearchWS]  Subscribed to job', jobId);\n            return;\n          }\n\n          // Handle research events\n          if (msg.type === 'research.event' && msg.jobId === jobId) {\n            console.log('[useResearchWS] Processing research event:', msg.eventType);\n            setState(prev => {\n              const newEvents = [...prev.events, msg];\n              let newState = { ...prev, events: newEvents };\n\n              // Handle different event types\n              switch (msg.eventType) {\n                case 'started':\n                  newState = { ...newState, streamedAnswer: '', done: false };\n                  break;\n\n                case 'sources':\n                  if (msg.data?.sources) {\n                    newState = { ...newState, sources: msg.data.sources };\n                  }\n                  break;\n\n                case 'chunk':\n                  if (msg.data?.token) {\n                    newState = {\n                      ...newState,\n                      streamedAnswer: prev.streamedAnswer + msg.data.token,\n                    };\n                  }\n                  break;\n\n                case 'done':\n                  if (msg.data) {\n                    newState = {\n                      ...newState,\n                      streamedAnswer:\n                        msg.data.answer || msg.data.fullResponse || prev.streamedAnswer,\n                      reasoningSteps: msg.data.reasoningSteps || [],\n                      citations: msg.data.citations || [],\n                      done: true,\n                    };\n                  }\n                  break;\n\n                case 'reasoning':\n                  if (msg.data?.steps) {\n                    newState = { ...newState, reasoningSteps: msg.data.steps };\n                  }\n                  break;\n\n                case 'error':\n                  newState = { ...newState, error: msg.data?.error || 'Unknown error', done: true };\n                  break;\n              }\n\n              return newState;\n            });\n          }\n        } catch (error) {\n          console.error('[useResearchWS] Failed to parse message', error);\n        }\n      };\n\n      ws.onclose = event => {\n        console.log('[useResearchWS] WebSocket closed', {\n          code: event.code,\n          reason: event.reason,\n          wasClean: event.wasClean,\n        });\n        setState(prev => ({ ...prev, connected: false }));\n\n        // Attempt reconnection if job is not done\n        if (!state.done && reconnectAttempts.current < maxReconnectAttempts) {\n          reconnectAttempts.current++;\n          reconnectTimeoutRef.current = setTimeout(() => {\n            console.log(`[useResearchWS] Reconnecting (attempt ${reconnectAttempts.current})...`);\n            connect();\n          }, 1000 * reconnectAttempts.current); // Exponential backoff\n        }\n      };\n\n      ws.onerror = error => {\n        console.error('[useResearchWS]  WebSocket error', error);\n        setState(prev => ({ ...prev, error: 'WebSocket connection error' }));\n      };\n    } catch (error) {\n      console.error('[useResearchWS] Failed to create WebSocket', error);\n      setState(prev => ({ ...prev, error: 'Failed to connect' }));\n    }\n  }, [jobId, state.done]);\n\n  useEffect(() => {\n    if (!jobId) {\n      console.log('[useResearchWS] No jobId provided, resetting state');\n      // Reset state when jobId is cleared\n      setState({\n        connected: false,\n        events: [],\n        streamedAnswer: '',\n        sources: [],\n        reasoningSteps: [],\n        citations: [],\n        done: false,\n        error: null,\n      });\n      return;\n    }\n\n    console.log('[useResearchWS] Connecting for jobId:', jobId);\n    connect();\n\n    return () => {\n      console.log('[useResearchWS] Cleaning up connection for jobId:', jobId);\n      // Cleanup\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n      if (wsRef.current) {\n        try {\n          wsRef.current.close();\n        } catch {\n          // Ignore close errors\n        }\n      }\n    };\n  }, [jobId, connect]);\n\n  return state;\n}\n","/**\n * Regen Research - Premium Perplexity-Style UI\n * Real-time streaming research with sources, reasoning, and citations\n * FULL WORKING VERSION with streaming, animations, and live updates\n */\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport { Sparkles, ExternalLink, Brain, Search, Zap, Globe, TrendingUp } from 'lucide-react';\nimport { useResearchWS } from '../../hooks/useResearchWS';\nimport { researchApi } from '../../lib/api-client';\nimport { useAppStore } from '../../state/appStore';\n\ninterface Source {\n  id: string;\n  url: string;\n  title: string;\n  snippet: string;\n  score?: number;\n  source?: string;\n  lang?: string;\n}\n\ninterface ReasoningStep {\n  step: number;\n  text: string;\n  evidence?: string[];\n}\n\ninterface ResearchState {\n  jobId: string | null;\n  query: string;\n  answer: string;\n  sources: Source[];\n  reasoningSteps: ReasoningStep[];\n  citations: Array<{ id: string; url: string; title: string }>;\n  done: boolean;\n  error: string | null;\n  selectedSource: Source | null;\n  showReasoning: boolean;\n  isStreaming: boolean;\n}\n\n// Follow-up suggestions based on query\nconst generateFollowUpSuggestions = (query: string, answer: string): string[] => {\n  const suggestions: string[] = [];\n  const lowerQuery = query.toLowerCase();\n  const lowerAnswer = answer.toLowerCase();\n\n  // Smart suggestions based on query type\n  if (lowerQuery.includes('compare') || lowerQuery.includes('vs')) {\n    suggestions.push(\n      'What are the key differences?',\n      'Which one is better?',\n      'What are the pros and cons?'\n    );\n  } else if (lowerQuery.includes('what is') || lowerQuery.includes('define')) {\n    suggestions.push('How does it work?', 'What are the benefits?', 'What are the use cases?');\n  } else if (lowerQuery.includes('how to') || lowerQuery.includes('how do')) {\n    suggestions.push(\n      'What are the prerequisites?',\n      'What are common mistakes?',\n      'What are best practices?'\n    );\n  } else if (lowerQuery.includes('why')) {\n    suggestions.push('What are the causes?', 'What are the effects?', 'Can you explain more?');\n  } else {\n    // Generic intelligent suggestions\n    suggestions.push('Tell me more', 'What are the key points?', 'Can you elaborate?');\n  }\n\n  // Add context-aware suggestions based on answer content\n  if (lowerAnswer.includes('benefit') || lowerAnswer.includes('advantage')) {\n    suggestions.push('What are the disadvantages?', 'What are the alternatives?');\n  }\n  if (lowerAnswer.includes('example') || lowerAnswer.includes('instance')) {\n    suggestions.push('Give me more examples', 'Show me real-world applications');\n  }\n\n  return suggestions.slice(0, 6);\n};\n\n// Inject Perplexity-style citation superscripts\nfunction injectCitations(text: string): string {\n  if (!text) return '';\n\n  // Match [1], [2], [s1], [source1] patterns\n  return text\n    .replace(/\\[(\\d+)\\]/g, (match, num) => {\n      return `<sup class=\"text-indigo-600 font-semibold cursor-pointer hover:text-indigo-800 transition-colors inline-block ml-0.5\" title=\"Citation ${num}\">[${num}]</sup>`;\n    })\n    .replace(/\\[s(\\d+)\\]/gi, (match, num) => {\n      return `<sup class=\"text-indigo-600 font-semibold cursor-pointer hover:text-indigo-800 transition-colors inline-block ml-0.5\" title=\"Source ${num}\">[${num}]</sup>`;\n    })\n    .replace(/\\n/g, '<br/>');\n}\n\n// Skeleton loader component\nfunction AnswerSkeleton() {\n  return (\n    <div className=\"animate-pulse space-y-3\">\n      <div className=\"h-4 w-full rounded bg-gray-200\"></div>\n      <div className=\"h-4 w-5/6 rounded bg-gray-200\"></div>\n      <div className=\"h-4 w-4/6 rounded bg-gray-200\"></div>\n      <div className=\"mt-4 h-4 w-3/4 rounded bg-gray-200\"></div>\n      <div className=\"h-4 w-full rounded bg-gray-200\"></div>\n    </div>\n  );\n}\n\nexport function RegenResearchPanel() {\n  const [state, setState] = useState<ResearchState>({\n    jobId: null,\n    query: '',\n    answer: '',\n    sources: [],\n    reasoningSteps: [],\n    citations: [],\n    done: false,\n    error: null,\n    selectedSource: null,\n    showReasoning: false,\n    isStreaming: false,\n  });\n\n  const [maxSources, setMaxSources] = useState(6);\n  const [_isPaused, _setIsPaused] = useState(false);\n  const [followUpSuggestions, setFollowUpSuggestions] = useState<string[]>([]);\n  const [agentMode, setAgentMode] = useState<'web-search' | 'reasoning' | 'summarizer'>(\n    'web-search'\n  );\n  const [isInitialLoad, setIsInitialLoad] = useState(true);\n  const answerRef = useRef<HTMLDivElement>(null);\n  const sourcesEndRef = useRef<HTMLDivElement>(null);\n\n  // Mode switching\n  const currentMode = useAppStore(state => state.mode);\n  const setMode = useAppStore(state => state.setMode);\n\n  // Use the research WebSocket hook\n  const wsState = useResearchWS(state.jobId || null);\n\n  // Sync WebSocket state to local state with real-time updates\n  useEffect(() => {\n    if (wsState.streamedAnswer) {\n      setState(prev => ({\n        ...prev,\n        answer: wsState.streamedAnswer,\n        isStreaming: !wsState.done,\n      }));\n      setIsInitialLoad(false);\n    }\n\n    if (wsState.sources.length > 0) {\n      setState(prev => ({\n        ...prev,\n        sources: wsState.sources.map((s, idx) => ({\n          id: s.url || `source-${idx}`,\n          url: s.url,\n          title: s.title || 'Untitled',\n          snippet: s.snippet || '',\n          score: s.score || 0.5,\n          source: s.source || 'unknown',\n        })),\n      }));\n\n      // Auto-scroll sources panel when new sources arrive\n      setTimeout(() => {\n        sourcesEndRef.current?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n      }, 100);\n    }\n\n    if (wsState.reasoningSteps.length > 0) {\n      setState(prev => ({\n        ...prev,\n        reasoningSteps: wsState.reasoningSteps.map((step, idx) => ({\n          step: idx + 1,\n          text: typeof step === 'string' ? step : step.text || '',\n          evidence:\n            typeof step === 'object' && 'citations' in step\n              ? step.citations?.map(String)\n              : undefined,\n        })),\n      }));\n    }\n\n    if (wsState.citations.length > 0) {\n      setState(prev => ({\n        ...prev,\n        citations: wsState.citations.map(c => ({\n          id: String(c.id || c.position || ''),\n          url: c.url,\n          title: c.title || 'Untitled',\n        })),\n      }));\n    }\n\n    if (wsState.done) {\n      setState(prev => ({ ...prev, done: true, isStreaming: false }));\n      setIsInitialLoad(false);\n\n      // Generate follow-up suggestions when done\n      if (state.query && state.answer) {\n        setFollowUpSuggestions(generateFollowUpSuggestions(state.query, state.answer));\n      }\n    }\n\n    if (wsState.error) {\n      setState(prev => ({ ...prev, error: wsState.error || null, isStreaming: false }));\n      setIsInitialLoad(false);\n    }\n  }, [wsState, state.query, state.answer]);\n\n  // Auto-scroll answer as it streams\n  useEffect(() => {\n    if (answerRef.current && state.isStreaming) {\n      answerRef.current.scrollTop = answerRef.current.scrollHeight;\n    }\n  }, [state.answer, state.isStreaming]);\n\n  const handleSearch = async (query: string) => {\n    if (!query.trim()) return;\n\n    setState(prev => ({\n      ...prev,\n      query: query.trim(),\n      jobId: null,\n      answer: '',\n      sources: [],\n      reasoningSteps: [],\n      citations: [],\n      done: false,\n      error: null,\n      selectedSource: null,\n      isStreaming: true,\n    }));\n\n    setFollowUpSuggestions([]);\n    setIsInitialLoad(true);\n\n    try {\n      const response = await researchApi.run({\n        query: query.trim(),\n        lang: 'auto',\n        clientId: `client-${Date.now()}`,\n        sessionId: `session-${Date.now()}`,\n        maxSources,\n        mode: agentMode === 'web-search' ? 'deep' : agentMode === 'reasoning' ? 'deep' : 'fast',\n        options: {\n          maxChunks: 12,\n          model: import.meta.env.VITE_OLLAMA_MODEL || 'llama3.1',\n        },\n      });\n\n      if (response.jobId) {\n        setState(prev => ({ ...prev, jobId: response.jobId }));\n      } else {\n        throw new Error('No jobId returned');\n      }\n    } catch (error: any) {\n      console.error('[RegenResearch] Failed to start research:', error);\n      setState(prev => ({\n        ...prev,\n        error: error.message || 'Failed to start research',\n        isStreaming: false,\n      }));\n      setIsInitialLoad(false);\n    }\n  };\n\n  const handleFollowUp = (followUpQuery: string) => {\n    if (!followUpQuery.trim()) return;\n    handleSearch(followUpQuery);\n  };\n\n  const handleSuggestionClick = (suggestion: string) => {\n    handleFollowUp(suggestion);\n  };\n\n  const handleSourceClick = (source: Source) => {\n    setState(prev => ({ ...prev, selectedSource: source }));\n  };\n\n  return (\n    <div className=\"flex h-full flex-col bg-gradient-to-b from-[#eef2ff] to-[#dbe4ff]\">\n      {/* Sticky Header */}\n      <div className=\"sticky top-0 z-10 border-b border-gray-200 bg-white px-6 py-4 shadow-sm\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <img\n              src=\"/logo.png\"\n              alt=\"Regen\"\n              className=\"h-8 w-8 object-contain\"\n              onError={e => {\n                // Fallback to icon if logo not found\n                (e.target as HTMLImageElement).style.display = 'none';\n              }}\n            />\n            <h1 className=\"text-[20px] font-semibold text-gray-800\">Regen Research</h1>\n          </div>\n\n          {/* Mode Switcher */}\n          <div className=\"flex items-center gap-1 rounded-lg border border-gray-200 bg-gray-100 p-1\">\n            <button\n              onClick={() => setMode('Browse')}\n              className={`flex items-center gap-1.5 rounded-md px-3 py-1.5 text-sm font-medium transition-all ${\n                currentMode === 'Browse'\n                  ? 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-md shadow-indigo-500/30'\n                  : 'text-gray-600 hover:bg-gray-200 hover:text-gray-900'\n              }`}\n              title=\"Switch to Browse Mode\"\n            >\n              <Globe size={14} />\n              <span className=\"hidden sm:inline\">Browse</span>\n            </button>\n            <button\n              onClick={() => setMode('Research')}\n              className={`flex items-center gap-1.5 rounded-md px-3 py-1.5 text-sm font-medium transition-all ${\n                currentMode === 'Research'\n                  ? 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-md shadow-indigo-500/30'\n                  : 'text-gray-600 hover:bg-gray-200 hover:text-gray-900'\n              }`}\n              title=\"Switch to Research Mode\"\n            >\n              <Sparkles size={14} />\n              <span className=\"hidden sm:inline\">Research</span>\n            </button>\n            <button\n              onClick={() => setMode('Trade')}\n              className={`flex items-center gap-1.5 rounded-md px-3 py-1.5 text-sm font-medium transition-all ${\n                currentMode === 'Trade'\n                  ? 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-md shadow-indigo-500/30'\n                  : 'text-gray-600 hover:bg-gray-200 hover:text-gray-900'\n              }`}\n              title=\"Switch to Trade Mode\"\n            >\n              <TrendingUp size={14} />\n              <span className=\"hidden sm:inline\">Trade</span>\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"grid flex-1 grid-cols-1 gap-4 overflow-hidden p-4 lg:grid-cols-12\">\n        {/* Left: Query & Controls */}\n        <div className=\"flex flex-col gap-4 lg:col-span-3\">\n          {/* Search Box - Premium Styling */}\n          <div className=\"rounded-xl border border-gray-100 bg-white p-6 shadow-[0_4px_14px_rgba(0,0,0,0.08)]\">\n            <form\n              onSubmit={e => {\n                e.preventDefault();\n                const formData = new FormData(e.currentTarget);\n                const query = (formData.get('query') as string) || '';\n                handleSearch(query);\n              }}\n              className=\"flex flex-col gap-3\"\n            >\n              <input\n                type=\"text\"\n                name=\"query\"\n                defaultValue={state.query}\n                placeholder=\"Ask anything\"\n                className=\"w-full rounded-lg border border-gray-300 bg-gray-50/80 px-4 py-3 text-[15px] placeholder-gray-500 transition-all focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500\"\n                disabled={state.isStreaming}\n              />\n              <button\n                type=\"submit\"\n                disabled={state.isStreaming}\n                className=\"flex w-full items-center justify-center gap-2 rounded-lg bg-gradient-to-r from-indigo-500 to-purple-600 py-3 font-semibold text-white shadow-md transition-all hover:scale-[1.02] hover:shadow-lg disabled:cursor-not-allowed disabled:opacity-50 disabled:hover:scale-100\"\n              >\n                <Sparkles className=\"h-4 w-4\" />\n                {state.isStreaming ? 'Researching...' : ' Research'}\n              </button>\n            </form>\n\n            {/* Agent Tools Bar - Functional */}\n            <div className=\"mt-4 border-t border-gray-200 pt-4\">\n              <p className=\"mb-2 text-xs font-medium text-gray-600\">Agent Mode:</p>\n              <div className=\"flex flex-wrap gap-2\">\n                <button\n                  onClick={() => setAgentMode('web-search')}\n                  className={`rounded-md px-3 py-1.5 text-xs font-medium transition ${\n                    agentMode === 'web-search'\n                      ? 'border border-indigo-300 bg-indigo-100 text-indigo-700'\n                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                  }`}\n                >\n                  <Search className=\"mr-1 inline h-3 w-3\" />\n                  Web Search\n                </button>\n                <button\n                  onClick={() => setAgentMode('reasoning')}\n                  className={`rounded-md px-3 py-1.5 text-xs font-medium transition ${\n                    agentMode === 'reasoning'\n                      ? 'border border-indigo-300 bg-indigo-100 text-indigo-700'\n                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                  }`}\n                >\n                  <Brain className=\"mr-1 inline h-3 w-3\" />\n                  Reasoning\n                </button>\n                <button\n                  onClick={() => setAgentMode('summarizer')}\n                  className={`rounded-md px-3 py-1.5 text-xs font-medium transition ${\n                    agentMode === 'summarizer'\n                      ? 'border border-indigo-300 bg-indigo-100 text-indigo-700'\n                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n                  }`}\n                >\n                  <Zap className=\"mr-1 inline h-3 w-3\" />\n                  Summarizer\n                </button>\n              </div>\n            </div>\n\n            {/* Follow-up Box */}\n            {state.jobId && (\n              <div className=\"mt-4 border-t border-gray-200 pt-4\">\n                <form\n                  onSubmit={e => {\n                    e.preventDefault();\n                    const formData = new FormData(e.currentTarget);\n                    const followUp = (formData.get('followUp') as string) || '';\n                    if (followUp.trim()) {\n                      handleFollowUp(followUp);\n                    }\n                  }}\n                  className=\"flex gap-2\"\n                >\n                  <input\n                    type=\"text\"\n                    name=\"followUp\"\n                    placeholder=\"Refine: Why is BankNifty more volatile?\"\n                    className=\"flex-1 rounded-lg border border-gray-300 bg-gray-50/80 px-3 py-2 text-[14px] placeholder-gray-500 transition focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500\"\n                    disabled={state.isStreaming}\n                  />\n                  <button\n                    type=\"submit\"\n                    disabled={state.isStreaming}\n                    className=\"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700 disabled:opacity-50\"\n                  >\n                    Ask\n                  </button>\n                </form>\n              </div>\n            )}\n\n            {/* Settings */}\n            <div className=\"mt-4 border-t border-gray-200 pt-4\">\n              <h5 className=\"mb-2 text-sm font-semibold text-gray-800\">Agent Settings</h5>\n              <div className=\"mb-2 text-xs text-gray-600\">Max sources to fetch</div>\n              <input\n                type=\"range\"\n                min={1}\n                max={12}\n                value={maxSources}\n                onChange={e => setMaxSources(Number(e.target.value))}\n                className=\"w-full\"\n                disabled={state.isStreaming}\n              />\n              <div className=\"mt-1 text-xs text-gray-500\">{maxSources} sources</div>\n            </div>\n          </div>\n\n          {/* Status */}\n          {state.jobId && (\n            <div className=\"rounded-xl border border-gray-100 bg-white p-4 shadow-[0_4px_14px_rgba(0,0,0,0.08)]\">\n              <div className=\"text-xs text-gray-500\">\n                <div className=\"mb-2 flex items-center gap-2\">\n                  <div\n                    className={`h-2 w-2 rounded-full ${\n                      wsState.connected ? 'animate-pulse bg-green-500' : 'bg-gray-400'\n                    }`}\n                  />\n                  {wsState.connected ? 'Connected' : 'Connecting...'}\n                </div>\n                {state.isStreaming && (\n                  <div className=\"font-medium text-indigo-600\">Streaming answer...</div>\n                )}\n                {state.done && <div className=\"font-medium text-green-600\">Research complete</div>}\n                {state.error && (\n                  <div className=\"font-medium text-red-600\">Error: {state.error}</div>\n                )}\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Middle: Streaming Answer */}\n        <div className=\"flex flex-col lg:col-span-6\">\n          <div className=\"flex flex-1 flex-col overflow-hidden rounded-xl border border-gray-100 bg-white p-6 shadow-[0_4px_14px_rgba(0,0,0,0.08)]\">\n            <div className=\"mb-4 flex items-center justify-between\">\n              <h2 className=\"text-[20px] font-semibold text-gray-800\">Answer</h2>\n              {state.reasoningSteps.length > 0 && (\n                <button\n                  onClick={() =>\n                    setState(prev => ({ ...prev, showReasoning: !prev.showReasoning }))\n                  }\n                  className=\"flex items-center gap-2 rounded-lg bg-gray-100 px-3 py-1.5 text-sm text-gray-700 transition hover:bg-gray-200\"\n                >\n                  <Brain className=\"h-4 w-4\" />\n                  {state.showReasoning ? 'Hide' : 'Show'} Reasoning\n                </button>\n              )}\n            </div>\n\n            {/* Streaming Indicator */}\n            {state.isStreaming && (\n              <div className=\"mb-4 flex items-center gap-2 text-sm text-gray-500\">\n                <div className=\"h-2 w-2 animate-pulse rounded-full bg-green-500\"></div>\n                <span>Generating answer</span>\n              </div>\n            )}\n\n            {/* Answer Content - With Skeleton or Streaming */}\n            <div\n              ref={answerRef}\n              className=\"flex-1 overflow-y-auto text-[15px] leading-relaxed text-gray-900\"\n            >\n              {isInitialLoad && !state.answer ? (\n                <AnswerSkeleton />\n              ) : state.answer ? (\n                <div\n                  className=\"animate-fadeIn whitespace-pre-wrap\"\n                  dangerouslySetInnerHTML={{\n                    __html: injectCitations(state.answer),\n                  }}\n                />\n              ) : (\n                <div className=\"italic text-gray-400\">Waiting for answer...</div>\n              )}\n            </div>\n\n            {/* Follow-up Questions - Auto-suggested */}\n            {state.done && followUpSuggestions.length > 0 && (\n              <div className=\"animate-fadeIn mt-6 border-t border-gray-200 pt-6\">\n                <p className=\"mb-3 text-sm font-semibold text-gray-700\">Follow-up questions</p>\n                <div className=\"flex flex-wrap gap-2\">\n                  {followUpSuggestions.map((s, i) => (\n                    <button\n                      key={i}\n                      onClick={() => handleSuggestionClick(s)}\n                      className=\"rounded-full bg-gray-100 px-3 py-1.5 text-sm text-gray-700 transition hover:scale-105 hover:bg-gray-200\"\n                    >\n                      {s}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* Reasoning Steps */}\n            {state.showReasoning && state.reasoningSteps.length > 0 && (\n              <div className=\"animate-fadeIn mt-6 border-t border-gray-200 pt-6\">\n                <h3 className=\"mb-3 flex items-center gap-2 text-sm font-semibold text-gray-800\">\n                  <Brain className=\"h-4 w-4\" />\n                  Reasoning Chain\n                </h3>\n                <div className=\"space-y-3\">\n                  {state.reasoningSteps.map((step, idx) => (\n                    <div\n                      key={idx}\n                      className=\"animate-fadeIn rounded-lg bg-gray-50 p-3 text-sm\"\n                      style={{ animationDelay: `${idx * 0.1}s` }}\n                    >\n                      <div className=\"mb-1 font-medium text-gray-700\">\n                        Step {step.step}: {step.text}\n                      </div>\n                      {step.evidence && step.evidence.length > 0 && (\n                        <div className=\"mt-1 text-xs text-gray-500\">\n                          Evidence: {step.evidence.join(', ')}\n                        </div>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* Citations */}\n            {state.citations.length > 0 && (\n              <div className=\"animate-fadeIn mt-6 border-t border-gray-200 pt-6\">\n                <h3 className=\"mb-3 text-sm font-semibold text-gray-800\">Citations</h3>\n                <div className=\"space-y-2\">\n                  {state.citations.map((citation, idx) => (\n                    <div key={idx} className=\"text-xs text-gray-600\">\n                      [{citation.id}] {citation.title} -{' '}\n                      <a\n                        href={citation.url}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"text-indigo-600 hover:underline\"\n                      >\n                        {citation.url}\n                      </a>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Right: Sources Preview */}\n        <div className=\"flex flex-col gap-4 lg:col-span-3\">\n          {/* Sources List */}\n          <div className=\"flex flex-1 flex-col overflow-hidden rounded-xl border border-gray-100 bg-white p-4 shadow-[0_4px_14px_rgba(0,0,0,0.08)]\">\n            <h4 className=\"mb-3 text-sm font-semibold text-gray-800\">Sources</h4>\n            <div className=\"flex-1 space-y-2 overflow-y-auto\">\n              {state.sources.length === 0 ? (\n                <div className=\"py-8 text-center text-xs text-gray-400\">\n                  {state.isStreaming ? (\n                    <div className=\"space-y-2\">\n                      <div className=\"mx-auto h-3 w-3/4 animate-pulse rounded bg-gray-200\"></div>\n                      <div className=\"mx-auto h-3 w-1/2 animate-pulse rounded bg-gray-200\"></div>\n                      <p className=\"mt-4\">Fetching sources...</p>\n                    </div>\n                  ) : (\n                    'No sources yet'\n                  )}\n                </div>\n              ) : (\n                <>\n                  {state.sources.map((source, idx) => (\n                    <div\n                      key={source.id || idx}\n                      onClick={() => handleSourceClick(source)}\n                      className={`animate-fadeIn group cursor-pointer rounded-lg border p-3 transition ${\n                        state.selectedSource?.url === source.url\n                          ? 'border-indigo-500 bg-indigo-50'\n                          : 'border-gray-200 hover:bg-gray-50'\n                      }`}\n                      style={{ animationDelay: `${idx * 0.05}s` }}\n                    >\n                      <p className=\"line-clamp-2 text-sm font-medium text-gray-800 transition-colors group-hover:text-indigo-600\">\n                        {source.title || 'Untitled'}\n                      </p>\n                      <p className=\"mt-1 truncate text-xs text-gray-500\">\n                        {new URL(source.url).hostname}\n                      </p>\n                      {source.snippet && (\n                        <p className=\"mt-2 line-clamp-2 text-xs text-gray-600\">{source.snippet}</p>\n                      )}\n                      {source.score && (\n                        <p className=\"mt-1 text-xs text-gray-400\">\n                          Score: {source.score.toFixed(2)}\n                        </p>\n                      )}\n                    </div>\n                  ))}\n                  <div ref={sourcesEndRef} />\n                </>\n              )}\n            </div>\n          </div>\n\n          {/* Source Preview */}\n          <div className=\"rounded-xl border border-gray-100 bg-white p-4 shadow-[0_4px_14px_rgba(0,0,0,0.08)]\">\n            <h4 className=\"mb-3 text-sm font-semibold text-gray-800\">Source Preview</h4>\n            {state.selectedSource ? (\n              <div className=\"animate-fadeIn whitespace-pre-wrap text-sm font-[450] leading-relaxed text-gray-700\">\n                <div className=\"mb-1 font-medium text-gray-800\">{state.selectedSource.title}</div>\n                <a\n                  href={state.selectedSource.url}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  className=\"mb-2 flex items-center gap-1 text-xs text-indigo-600 hover:underline\"\n                >\n                  {state.selectedSource.url}\n                  <ExternalLink className=\"h-3 w-3\" />\n                </a>\n                <div className=\"mt-2 text-xs text-gray-600\">{state.selectedSource.snippet}</div>\n              </div>\n            ) : (\n              <div className=\"text-xs text-gray-400\">Click a source to preview.</div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Footer Tip */}\n      <div className=\"border-t border-gray-200 bg-white/80 px-6 py-3 backdrop-blur-sm\">\n        <div className=\"text-xs text-gray-500\">\n           Tip: Streamed answers update as sources & LLM tokens arrive. Use \"Show reasoning\" to\n          reveal chain-of-thought for transparency.\n        </div>\n      </div>\n    </div>\n  );\n}\n","/**\n * Real-time Multi-Language AI\n * Supports Hindi, Tamil, Telugu, Malayalam, Kannada, Bengali, Marathi, Gujarati\n * Instant translation, search, summarization\n */\n\nexport type SupportedLanguage =\n  | 'hi' // Hindi\n  | 'ta' // Tamil\n  | 'te' // Telugu\n  | 'ml' // Malayalam\n  | 'kn' // Kannada\n  | 'bn' // Bengali\n  | 'mr' // Marathi\n  | 'gu' // Gujarati\n  | 'en' // English\n  | 'auto'; // Auto-detect\n\nexport interface LanguageMetadata {\n  code: string;\n  name: string;\n  nativeName: string;\n  locale: string;\n  script: string;\n}\n\nexport const LANGUAGE_METADATA: Record<SupportedLanguage, LanguageMetadata> = {\n  hi: {\n    code: 'hi',\n    name: 'Hindi',\n    nativeName: '',\n    locale: 'hi-IN',\n    script: 'Devanagari',\n  },\n  ta: {\n    code: 'ta',\n    name: 'Tamil',\n    nativeName: '',\n    locale: 'ta-IN',\n    script: 'Tamil',\n  },\n  te: {\n    code: 'te',\n    name: 'Telugu',\n    nativeName: '',\n    locale: 'te-IN',\n    script: 'Telugu',\n  },\n  ml: {\n    code: 'ml',\n    name: 'Malayalam',\n    nativeName: '',\n    locale: 'ml-IN',\n    script: 'Malayalam',\n  },\n  kn: {\n    code: 'kn',\n    name: 'Kannada',\n    nativeName: '',\n    locale: 'kn-IN',\n    script: 'Kannada',\n  },\n  bn: {\n    code: 'bn',\n    name: 'Bengali',\n    nativeName: '',\n    locale: 'bn-IN',\n    script: 'Bengali',\n  },\n  mr: {\n    code: 'mr',\n    name: 'Marathi',\n    nativeName: '',\n    locale: 'mr-IN',\n    script: 'Devanagari',\n  },\n  gu: {\n    code: 'gu',\n    name: 'Gujarati',\n    nativeName: '',\n    locale: 'gu-IN',\n    script: 'Gujarati',\n  },\n  en: {\n    code: 'en',\n    name: 'English',\n    nativeName: 'English',\n    locale: 'en-US',\n    script: 'Latin',\n  },\n  auto: {\n    code: 'auto',\n    name: 'Auto-detect',\n    nativeName: 'Auto',\n    locale: 'en-US',\n    script: 'Auto',\n  },\n};\n\nclass MultiLanguageAI {\n  private cache: Map<string, string> = new Map();\n\n  /**\n   * Detect language of text\n   */\n  async detectLanguage(text: string): Promise<SupportedLanguage> {\n    // Check cache\n    const cacheKey = `detect:${text.slice(0, 100)}`;\n    const cached = this.cache.get(cacheKey);\n    if (cached) {\n      return cached as SupportedLanguage;\n    }\n\n    // Use Tauri backend for detection\n    if (typeof window !== 'undefined' && window.__TAURI__) {\n      try {\n        const result = await window.__TAURI__.invoke('detect_language', { text });\n        const detected = (result as { language: string }).language || 'en';\n        this.cache.set(cacheKey, detected);\n        return detected as SupportedLanguage;\n      } catch (error) {\n        console.error('[MultiLanguageAI] Detection failed:', error);\n      }\n    }\n\n    // Fallback: simple heuristic detection\n    return this.heuristicDetect(text);\n  }\n\n  /**\n   * Heuristic language detection (fallback)\n   */\n  private heuristicDetect(text: string): SupportedLanguage {\n    // Check for Devanagari script (Hindi, Marathi)\n    if (/[\\u0900-\\u097F]/.test(text)) {\n      // More likely Hindi than Marathi\n      return 'hi';\n    }\n\n    // Check for Tamil script\n    if (/[\\u0B80-\\u0BFF]/.test(text)) {\n      return 'ta';\n    }\n\n    // Check for Telugu script\n    if (/[\\u0C00-\\u0C7F]/.test(text)) {\n      return 'te';\n    }\n\n    // Check for Malayalam script\n    if (/[\\u0D00-\\u0D7F]/.test(text)) {\n      return 'ml';\n    }\n\n    // Check for Kannada script\n    if (/[\\u0C80-\\u0CFF]/.test(text)) {\n      return 'kn';\n    }\n\n    // Check for Bengali script\n    if (/[\\u0980-\\u09FF]/.test(text)) {\n      return 'bn';\n    }\n\n    // Check for Gujarati script\n    if (/[\\u0A80-\\u0AFF]/.test(text)) {\n      return 'gu';\n    }\n\n    return 'en';\n  }\n\n  /**\n   * Translate text to target language\n   */\n  async translate(\n    text: string,\n    targetLang: SupportedLanguage,\n    sourceLang?: SupportedLanguage\n  ): Promise<string> {\n    // Auto-detect source if not provided\n    if (!sourceLang || sourceLang === 'auto') {\n      sourceLang = await this.detectLanguage(text);\n    }\n\n    // No translation needed if same language\n    if (sourceLang === targetLang) {\n      return text;\n    }\n\n    // Check cache\n    const cacheKey = `translate:${sourceLang}:${targetLang}:${text.slice(0, 100)}`;\n    const cached = this.cache.get(cacheKey);\n    if (cached) {\n      return cached;\n    }\n\n    // Use Tauri backend for translation\n    if (typeof window !== 'undefined' && window.__TAURI__) {\n      try {\n        const result = await window.__TAURI__.invoke('translate_text', {\n          text,\n          sourceLang,\n          targetLang,\n        });\n        const translated = (result as { translated: string }).translated || text;\n        this.cache.set(cacheKey, translated);\n        return translated;\n      } catch (error) {\n        console.error('[MultiLanguageAI] Translation failed:', error);\n      }\n    }\n\n    // Fallback: return original text\n    return text;\n  }\n\n  /**\n   * Search in multiple languages\n   */\n  async search(\n    query: string,\n    languages: SupportedLanguage[] = ['en'],\n    options?: { limit?: number }\n  ): Promise<Array<{ language: SupportedLanguage; results: unknown[] }>> {\n    const results: Array<{ language: SupportedLanguage; results: unknown[] }> = [];\n\n    // Detect query language\n    const detectedLang = await this.detectLanguage(query);\n\n    // Search in each language\n    for (const lang of languages) {\n      let searchQuery = query;\n\n      // Translate query if needed\n      if (lang !== detectedLang && lang !== 'auto') {\n        searchQuery = await this.translate(query, lang, detectedLang);\n      }\n\n      // Perform search (use existing search service)\n      try {\n        // This would integrate with your existing search service\n        const searchResults = await this.performSearch(searchQuery, lang);\n        results.push({\n          language: lang,\n          results: searchResults.slice(0, options?.limit || 10),\n        });\n      } catch (error) {\n        console.error(`[MultiLanguageAI] Search failed for ${lang}:`, error);\n      }\n    }\n\n    return results;\n  }\n\n  /**\n   * Summarize in target language\n   */\n  async summarize(\n    text: string,\n    targetLang: SupportedLanguage = 'en',\n    options?: { maxLength?: number }\n  ): Promise<string> {\n    // Detect source language\n    const sourceLang = await this.detectLanguage(text);\n\n    // Summarize in source language first (more accurate)\n    let summary = text;\n    if (text.length > (options?.maxLength || 500)) {\n      // Use Tauri backend for summarization\n      if (typeof window !== 'undefined' && window.__TAURI__) {\n        try {\n          const result = await window.__TAURI__.invoke('summarize_text', {\n            text,\n            language: sourceLang,\n            maxLength: options?.maxLength || 500,\n          });\n          summary = (result as { summary: string }).summary || text;\n        } catch (error) {\n          console.error('[MultiLanguageAI] Summarization failed:', error);\n          // Fallback: simple truncation\n          summary = text.slice(0, options?.maxLength || 500) + '...';\n        }\n      } else {\n        // Fallback: simple truncation\n        summary = text.slice(0, options?.maxLength || 500) + '...';\n      }\n    }\n\n    // Translate summary to target language if needed\n    if (sourceLang !== targetLang && targetLang !== 'auto') {\n      summary = await this.translate(summary, targetLang, sourceLang);\n    }\n\n    return summary;\n  }\n\n  /**\n   * Perform search (placeholder - integrate with your search service)\n   */\n  private async performSearch(_query: string, _language: SupportedLanguage): Promise<unknown[]> {\n    // This would integrate with your existing search infrastructure\n    // For now, return empty array\n    return [];\n  }\n\n  /**\n   * Get language metadata\n   */\n  getLanguageMetadata(lang: SupportedLanguage): LanguageMetadata {\n    return LANGUAGE_METADATA[lang] || LANGUAGE_METADATA.en;\n  }\n\n  /**\n   * Get all supported languages\n   */\n  getSupportedLanguages(): SupportedLanguage[] {\n    return Object.keys(LANGUAGE_METADATA) as SupportedLanguage[];\n  }\n\n  /**\n   * Clear cache\n   */\n  clearCache(): void {\n    this.cache.clear();\n  }\n}\n\n// Singleton instance\nexport const multiLanguageAI = new MultiLanguageAI();\n","// @ts-nocheck\n\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { ResearchStagehandIntegration } from './stagehand-integration';\nimport { Sparkles, RefreshCcw, ChevronRight, Search, Upload, FileText, X } from 'lucide-react';\nimport { motion } from 'framer-motion';\nimport { useSettingsStore } from '../../state/settingsStore';\nimport VoiceButton from '../../components/VoiceButton';\nimport { ipc } from '../../lib/ipc-typed';\n// Toast imported but not used in standard view - used in enhanced view\nimport { useTabsStore } from '../../state/tabsStore';\nimport { useDebounce } from '../../utils/useDebounce';\nimport { fetchDuckDuckGoInstant, formatDuckDuckGoResults } from '../../services/duckDuckGoSearch';\nimport { type MultiSourceSearchResult } from '../../services/multiSourceSearch';\nimport { performLiveWebSearch } from '../../services/liveWebSearch';\nimport { optimizedSearch } from '../../services/optimizedSearch';\nimport { scrapeResearchSources, type ScrapedSourceResult } from '../../services/researchScraper';\nimport { searchLocal } from '../../utils/lunrIndex';\nimport { aiEngine, type AITaskResult } from '../../core/ai';\nimport { semanticSearchMemories } from '../../core/supermemory/search';\nimport { parsePdfFile } from '../docs/parsers/pdf';\nimport { parseDocxFile } from '../docs/parsers/docx';\nimport { LoadingSkeleton } from '../../components/common/LoadingSkeleton';\nimport { parseResearchVoiceCommand } from '../../utils/voiceCommandParser';\nimport { detectLanguage } from '../../services/languageDetection';\nimport { summarizeOffline } from '../../services/offlineSummarizer';\nimport {\n  ResearchResult,\n  ResearchSource,\n  ResearchSourceType,\n  VerificationResult,\n  ResearchInlineEvidence,\n} from '../../types/research';\nimport { ContainerInfo } from '../../lib/ipc-events';\nimport { useContainerStore } from '../../state/containerStore';\nimport { ResearchGraphView } from '../../components/research/ResearchGraphView';\nimport { isWebMode } from '../../lib/env';\nimport { SourceCard } from '../../components/research/SourceCard';\nimport { AnswerWithCitations } from '../../components/research/AnswerWithCitations';\nimport { EvidenceOverlay } from '../../components/research/EvidenceOverlay';\nimport { CompareAnswersPanel } from '../../components/research/CompareAnswers';\nimport { LayoutEngine, LayoutHeader, LayoutBody } from '../../ui/layout-engine';\nimport { useResearchCompareStore } from '../../state/researchCompareStore';\nimport { toast } from '../../utils/toast';\nimport { runDeepScan, type DeepScanStep, type DeepScanSource } from '../../services/deepScan';\nimport { CursorChat } from '../../components/cursor/CursorChat';\nimport { OmniAgentInput } from '../../components/OmniAgentInput';\n// import ResearchModePanel from '../../components/research/ResearchModePanel'; // Reserved for future use\nimport { RegenResearchPanel } from '../../components/research/RegenResearchPanel';\nimport { researchApi } from '../../lib/api-client';\nimport { getLanguageMeta } from '../../constants/languageMeta';\nimport { getSearchHealth } from '../../services/searchHealth';\nimport { multiLanguageAI, type SupportedLanguage } from '../../core/language/multiLanguageAI';\n\ntype UploadedDocument = {\n  id: string;\n  file: File;\n  name: string;\n  text: string;\n  type: string;\n  size: number;\n};\n\ntype _ResearchPipelineArgs = {\n  searchQuery: string;\n  context: Record<string, unknown>;\n  aggregatedSources: ResearchSource[];\n  aggregatedProviderNames: string[];\n  scrapedSnapshots?: ScrapedSourceResult[];\n};\n\nexport default function ResearchPanel() {\n  const [query, setQuery] = useState('');\n  const [result, setResult] = useState<ResearchResult | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [_loadingMessage, setLoadingMessage] = useState<string | null>(null);\n  const [detectedLang, setDetectedLang] = useState<string>('en');\n  const language = useSettingsStore(s => s.language || 'auto');\n  const [activeSourceId, setActiveSourceId] = useState<string | null>(null);\n  const [includeCounterpoints, setIncludeCounterpoints] = useState(false);\n  const [authorityBias, setAuthorityBias] = useState(50); // 0 = recency, 100 = authority\n  const [region, setRegion] = useState<RegionOption>('global');\n  const [graphData, setGraphData] = useState<any>(null);\n  const [showGraph, setShowGraph] = useState(true);\n  const [activeEvidenceId, setActiveEvidenceId] = useState<string | null>(null);\n  const [autocompleteSuggestions, setAutocompleteSuggestions] = useState<\n    Array<{ title: string; subtitle?: string; action?: () => void }>\n  >([]);\n  const [showAutocomplete, setShowAutocomplete] = useState(false);\n  const [autocompleteLoading, setAutocompleteLoading] = useState(false);\n  const [uploadedDocuments, setUploadedDocuments] = useState<UploadedDocument[]>([]);\n  const [uploading, setUploading] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const autocompleteRef = useRef<HTMLDivElement>(null);\n  const { activeId, tabs } = useTabsStore();\n  const useHybridSearch = useSettingsStore(s => s.searchEngine !== 'mock');\n  const { containers, activeContainerId, setContainers } = useContainerStore();\n  const graphSignatureRef = useRef<string>('');\n  const debouncedQuery = useDebounce(query, 300);\n  const {\n    entries: compareEntries,\n    addEntry: addCompareEntry,\n    removeEntry: removeCompareEntry,\n  } = useResearchCompareStore();\n  const [comparePanelOpen, setComparePanelOpen] = useState(false);\n  const [compareSelection, setCompareSelection] = useState<string[]>([]);\n  const [cursorPanelOpen, setCursorPanelOpen] = useState(false);\n  const aiMetaRef = useRef<{ provider?: string; model?: string }>({});\n  const [deepScanEnabled, setDeepScanEnabled] = useState(false);\n  const [deepScanLoading, setDeepScanLoading] = useState(false);\n  const [deepScanSteps, setDeepScanSteps] = useState<DeepScanStep[]>([]);\n  const [deepScanError, setDeepScanError] = useState<string | null>(null);\n  const [useEnhancedView, setUseEnhancedView] = useState(true); // Default to enhanced multilingual view\n\n  useEffect(() => {\n    if (containers.length === 0) {\n      ipc.containers\n        .list()\n        .then(list => {\n          if (Array.isArray(list)) {\n            setContainers(list as ContainerInfo[]);\n          }\n        })\n        .catch(err => {\n          console.warn('[Research] Failed to load containers for badge', err);\n        });\n    }\n  }, [containers.length, setContainers]);\n\n  // Listen for handoff events from Trade mode\n  // WISPR Research Command Handler\n  useEffect(() => {\n    const handleWisprResearch = (event: CustomEvent) => {\n      const { query: researchQuery } = event.detail;\n      if (researchQuery) {\n        setQuery(researchQuery);\n        toast.success(`Researching: ${researchQuery}`, { duration: 3000 });\n        // Trigger search after a short delay - handleSearch will be called via query change\n        setTimeout(() => {\n          // Dispatch a custom event that will trigger search\n          window.dispatchEvent(\n            new CustomEvent('research:trigger', { detail: { query: researchQuery } })\n          );\n        }, 500);\n      }\n    };\n\n    window.addEventListener('wispr:research', handleWisprResearch as EventListener);\n    return () => window.removeEventListener('wispr:research', handleWisprResearch as EventListener);\n  }, []);\n\n  useEffect(() => {\n    const handleHandoff = (event: CustomEvent) => {\n      const { query: handoffQuery, symbol, language: _handoffLanguage } = event.detail;\n      if (handoffQuery) {\n        setQuery(handoffQuery);\n        // Trigger search after a short delay to allow mode switch\n        setTimeout(() => {\n          handleSearch(handoffQuery);\n        }, 500);\n        toast.success(`Researching: ${handoffQuery}`, {\n          duration: 3000,\n        });\n      } else if (symbol) {\n        const researchQuery = `${symbol} fundamentals and recent news`;\n        setQuery(researchQuery);\n        setTimeout(() => {\n          handleSearch(researchQuery);\n        }, 500);\n        toast.success(`Researching ${symbol}...`, {\n          duration: 3000,\n        });\n      }\n    };\n\n    window.addEventListener('handoff:research', handleHandoff as EventListener);\n    return () => {\n      window.removeEventListener('handoff:research', handleHandoff as EventListener);\n    };\n  }, []);\n\n  useEffect(() => {\n    setCompareSelection(prev => prev.filter(id => compareEntries.some(entry => entry.id === id)));\n  }, [compareEntries]);\n\n  useEffect(() => {\n    if (!deepScanEnabled) {\n      setDeepScanSteps([]);\n      setDeepScanError(null);\n    }\n  }, [deepScanEnabled]);\n\n  // Calculate weights from authorityBias - must be defined before callbacks that use them\n  const recencyWeight = useMemo(() => (100 - authorityBias) / 100, [authorityBias]);\n  const authorityWeight = useMemo(() => authorityBias / 100, [authorityBias]);\n\n  // refreshGraph must be defined before _runResearchAnswer which uses it\n  const refreshGraph = useCallback(async () => {\n    if (typeof window === 'undefined' || !window.graph?.all) return;\n    try {\n      const snapshot = await window.graph.all();\n      if (snapshot && Array.isArray(snapshot.nodes)) {\n        setGraphData(snapshot);\n      }\n    } catch (err) {\n      console.warn('[Research] Failed to load graph snapshot', err);\n    }\n  }, []);\n\n  const _runResearchAnswer = useCallback(\n    async ({\n      searchQuery,\n      context,\n      aggregatedSources,\n      aggregatedProviderNames,\n      scrapedSnapshots = [],\n    }: ResearchPipelineArgs) => {\n      try {\n        let streamedText = '';\n        let streamedResult: AITaskResult | null = null;\n\n        const aiResult = await aiEngine.runTask(\n          {\n            kind: 'search',\n            prompt: searchQuery,\n            context,\n            mode: 'research',\n            metadata: {\n              includeCounterpoints,\n              region: region !== 'global' ? region : undefined,\n              recencyWeight,\n              authorityWeight,\n              language: language !== 'auto' ? language : undefined,\n            },\n            llm: {\n              temperature: 0.2,\n              maxTokens: 1000,\n            },\n          },\n          event => {\n            if (event.type === 'token' && typeof event.data === 'string') {\n              streamedText += event.data;\n            } else if (event.type === 'done' && typeof event.data !== 'string') {\n              streamedResult = event.data as AITaskResult;\n            }\n          }\n        );\n\n        const finalResult = streamedResult ?? aiResult;\n        aiMetaRef.current = {\n          provider: finalResult?.provider || 'ai',\n          model: finalResult?.model,\n        };\n        let finalAnswer = streamedText || finalResult?.text || '';\n\n        // If offline and no answer, try offline mBART summarization\n        if (!finalAnswer && typeof navigator !== 'undefined' && !navigator.onLine) {\n          try {\n            // Collect all source text for summarization\n            const sourceTexts: string[] = [];\n            if (scrapedSnapshots.length > 0) {\n              scrapedSnapshots.forEach(snapshot => {\n                if (snapshot.excerpt) sourceTexts.push(snapshot.excerpt);\n                if (snapshot.text) sourceTexts.push(snapshot.text);\n              });\n            }\n            if (aggregatedSources.length > 0) {\n              aggregatedSources.forEach(source => {\n                if (source.snippet) sourceTexts.push(source.snippet);\n                if (source.title) sourceTexts.push(source.title);\n              });\n            }\n\n            if (sourceTexts.length > 0) {\n              const offlineSummary = await summarizeOffline(sourceTexts.join(' '), {\n                maxLength: 500,\n                minLength: 100,\n                language: language !== 'auto' ? language : 'en',\n                useOfflineModel: true,\n              });\n              if (offlineSummary.summary) {\n                finalAnswer = offlineSummary.summary;\n                aiMetaRef.current = {\n                  provider: 'offline-mbart',\n                  model: offlineSummary.method === 'mbart' ? 'mBART' : 'extraction',\n                };\n              }\n            }\n          } catch (error) {\n            console.warn('[Research] Offline summarization failed:', error);\n          }\n        }\n\n        if (finalAnswer && typeof window !== 'undefined' && window.graph) {\n          try {\n            const concepts = finalAnswer.split(/[.,;]/).slice(0, 5);\n            for (const concept of concepts) {\n              const trimmed = concept.trim();\n              if (trimmed.length > 3 && trimmed.length < 50) {\n                await window.graph.add({\n                  id: `research-${Date.now()}-${Math.random()}`,\n                  label: trimmed,\n                  type: 'research-concept',\n                });\n              }\n            }\n            await refreshGraph();\n          } catch (graphError) {\n            console.debug('[Research] Auto-graph generation failed:', graphError);\n          }\n        }\n\n        const sources: ResearchSource[] = [...aggregatedSources];\n\n        if (finalResult?.citations && finalResult.citations.length > 0) {\n          sources.push(\n            ...finalResult.citations.map((cite, idx) => {\n              let domain = cite.source || '';\n              try {\n                if (cite.url) {\n                  domain = new URL(cite.url).hostname;\n                }\n              } catch {\n                domain = cite.source || '';\n              }\n              const citationType: ResearchSourceType = inferSourceType(domain);\n              return {\n                id: `ai-citation-${idx}`,\n                title: cite.title || cite.url || `Source ${idx + 1}`,\n                url: cite.url || '',\n                domain,\n                snippet: cite.snippet || '',\n                text: cite.snippet || '',\n                type: citationType,\n                sourceType: citationType,\n                relevanceScore: 95 - idx * 3,\n                timestamp: Date.now(),\n                metadata: {\n                  provider: 'ai-citation',\n                },\n              };\n            })\n          );\n        }\n\n        if (uploadedDocuments.length > 0) {\n          sources.push(\n            ...uploadedDocuments.map((doc, idx) => ({\n              id: doc.id,\n              title: doc.name,\n              url: '',\n              domain: 'uploaded',\n              snippet: doc.text.slice(0, 200) + (doc.text.length > 200 ? '...' : ''),\n              text: doc.text,\n              type: 'documentation' as ResearchSourceType,\n              sourceType: 'documentation' as ResearchSourceType,\n              relevanceScore: 98 - idx,\n              timestamp: Date.now(),\n              metadata: {\n                provider: 'uploaded-doc',\n              },\n            }))\n          );\n        }\n\n        try {\n          const localResults = await searchLocal(searchQuery);\n          sources.push(\n            ...localResults.map((lr, idx) => ({\n              id: `local-${lr.id}`,\n              title: lr.title,\n              url: '',\n              domain: 'local',\n              snippet: lr.snippet,\n              text: lr.snippet,\n              type: 'documentation' as ResearchSourceType,\n              sourceType: 'documentation' as ResearchSourceType,\n              relevanceScore: 85 - idx * 3,\n              timestamp: Date.now(),\n              metadata: {\n                provider: 'local-index',\n              },\n            }))\n          );\n        } catch (localError) {\n          console.debug('[Research] Local search failed:', localError);\n        }\n\n        const inlineCitations =\n          finalResult?.citations?.map((cite, idx) => ({\n            id: `citation-${idx}`,\n            text: cite.title || cite.url || `Source ${idx + 1}`,\n            url: cite.url || '',\n            position:\n              finalAnswer.indexOf(cite.title || '') >= 0\n                ? finalAnswer.indexOf(cite.title || '')\n                : idx * 50,\n          })) || [];\n\n        const dedupedSources = dedupeResearchSources(sources);\n\n        setResult({\n          query: searchQuery,\n          summary: finalAnswer || 'No answer generated',\n          sources: dedupedSources.slice(0, 16),\n          citations: inlineCitations,\n          inlineEvidence: [],\n          contradictions: [],\n          verification: {\n            score: 0.8,\n            confidence: 'high',\n            suggestions: [\n              `AI-generated response using ${finalResult?.provider || 'unknown'} (${finalResult?.model || 'unknown'})`,\n              ...(finalResult?.citations?.length\n                ? [`${finalResult.citations.length} citation(s) included`]\n                : []),\n            ],\n          },\n          confidence: Math.min(0.95, Math.max(0.45, finalResult?.confidence ?? 0.82)),\n        });\n        return;\n      } catch (aiError) {\n        console.warn('[Research] AI engine failed, falling back to legacy search:', aiError);\n\n        if (aggregatedSources.length > 0) {\n          const providerLabel =\n            aggregatedProviderNames.length > 0\n              ? aggregatedProviderNames.map(provider => formatProviderName(provider)).join(', ')\n              : 'multi-source web';\n          aiMetaRef.current = {\n            provider: providerLabel,\n            model: 'aggregate',\n          };\n          const dedupedAggregated = dedupeResearchSources(aggregatedSources);\n          const topTitles = dedupedAggregated\n            .slice(0, 3)\n            .map(source => source.title)\n            .join('; ');\n          const scrapedSummary = scrapedSnapshots.find(snapshot => snapshot.excerpt)?.excerpt;\n          setResult({\n            query: searchQuery,\n            summary: scrapedSummary?.length\n              ? scrapedSummary\n              : topTitles.length > 0\n                ? `Multi-source (${providerLabel}) search returned ${dedupedAggregated.length} results. Top hits: ${topTitles}.`\n                : `Multi-source (${providerLabel}) search returned ${dedupedAggregated.length} results.`,\n            sources: dedupedAggregated.slice(0, 16),\n            citations: [],\n            inlineEvidence: [],\n            contradictions: [],\n            verification: {\n              score: 0.65,\n              confidence: 'medium',\n              suggestions: [`Review ${providerLabel} sources manually.`],\n            },\n            confidence: 0.62,\n          });\n          return;\n        }\n\n        const duckResult = await fetchDuckDuckGoInstant(searchQuery);\n        if (duckResult) {\n          aiMetaRef.current = {\n            provider: 'duckduckgo',\n            model: 'instant-answer',\n          };\n          const formatted = formatDuckDuckGoResults(duckResult);\n          const localResults = await searchLocal(searchQuery).catch(() => []);\n          const sources: ResearchSource[] = [\n            ...(duckResult.Heading && duckResult.AbstractText\n              ? [\n                  {\n                    id: 'duck-instant',\n                    title: duckResult.Heading,\n                    url: duckResult.AbstractURL || '',\n                    domain: duckResult.AbstractURL\n                      ? extractDomain(duckResult.AbstractURL)\n                      : 'duckduckgo.com',\n                    snippet: duckResult.AbstractText,\n                    text: duckResult.AbstractText,\n                    type: 'news' as ResearchSourceType,\n                    sourceType: 'news' as ResearchSourceType,\n                    relevanceScore: 100,\n                    timestamp: Date.now(),\n                    metadata: {\n                      provider: 'duckduckgo',\n                    },\n                  },\n                ]\n              : []),\n            ...formatted\n              .filter(f => f.type === 'result' && f.url)\n              .map((f, idx) => {\n                const domain = f.url ? extractDomain(f.url) : '';\n                const sourceType = inferSourceType(domain);\n                return {\n                  id: `duck-result-${idx}`,\n                  title: f.title,\n                  url: f.url || '',\n                  domain,\n                  snippet: f.snippet,\n                  text: f.snippet,\n                  type: sourceType,\n                  sourceType,\n                  relevanceScore: 85 - idx * 5,\n                  timestamp: Date.now(),\n                  metadata: {\n                    provider: 'duckduckgo',\n                  },\n                };\n              }),\n            ...localResults.map((lr, idx) => ({\n              id: `local-${lr.id}`,\n              title: lr.title,\n              url: '',\n              domain: 'local',\n              snippet: lr.snippet,\n              text: lr.snippet,\n              type: 'documentation' as ResearchSourceType,\n              sourceType: 'documentation' as ResearchSourceType,\n              relevanceScore: 90 - idx * 3,\n              timestamp: Date.now(),\n              metadata: {\n                provider: 'local-index',\n              },\n            })),\n          ];\n\n          setResult({\n            query: searchQuery,\n            summary:\n              duckResult.AbstractText ||\n              duckResult.Answer ||\n              duckResult.Definition ||\n              `Found ${sources.length} result${sources.length === 1 ? '' : 's'} for \"${searchQuery}\"`,\n            sources: dedupeResearchSources(sources).slice(0, 16),\n            citations: [],\n            inlineEvidence: [],\n            contradictions: [],\n            verification: {\n              score: 0.7,\n              confidence: 'medium',\n              suggestions: ['Results from DuckDuckGo Instant Answer API'],\n            },\n            confidence: 0.58,\n          });\n          return;\n        }\n\n        const localResults = await searchLocal(searchQuery).catch(() => []);\n        if (localResults.length > 0) {\n          aiMetaRef.current = {\n            provider: 'local-index',\n            model: 'documents',\n          };\n          setResult({\n            query: searchQuery,\n            summary: `Found ${localResults.length} local result${localResults.length === 1 ? '' : 's'}`,\n            sources: localResults.map((lr, idx) => ({\n              id: `local-${lr.id}`,\n              title: lr.title,\n              url: '',\n              domain: 'local',\n              snippet: lr.snippet,\n              text: lr.snippet,\n              type: 'documentation' as ResearchSourceType,\n              sourceType: 'documentation' as ResearchSourceType,\n              relevanceScore: 90 - idx * 3,\n              timestamp: Date.now(),\n              metadata: {\n                provider: 'local-index',\n              },\n            })),\n            citations: [],\n            inlineEvidence: [],\n            contradictions: [],\n            verification: {\n              score: 0.6,\n              confidence: 'low',\n              suggestions: ['Results from local index only'],\n            },\n            confidence: 0.52,\n          });\n          return;\n        }\n\n        throw aiError;\n      }\n    },\n    [authorityWeight, includeCounterpoints, region, recencyWeight, refreshGraph, uploadedDocuments]\n  );\n\n  const handleToggleCompareSelection = useCallback((id: string) => {\n    setCompareSelection(prev => {\n      if (prev.includes(id)) {\n        return prev.filter(entryId => entryId !== id);\n      }\n      if (prev.length >= 2) {\n        return [...prev.slice(1), id];\n      }\n      return [...prev, id];\n    });\n  }, []);\n\n  const handleRemoveCompare = useCallback(\n    (id: string) => {\n      removeCompareEntry(id);\n      setCompareSelection(prev => prev.filter(entryId => entryId !== id));\n      toast.info('Removed saved answer.');\n    },\n    [removeCompareEntry]\n  );\n\n  const handleSaveForCompare = useCallback(() => {\n    if (!result) {\n      toast.info('Run a research query before saving.');\n      return;\n    }\n    const saved = addCompareEntry({\n      query: result.query,\n      summary: result.summary,\n      provider: aiMetaRef.current.provider,\n      model: aiMetaRef.current.model,\n      confidence: result.confidence,\n      sources: result.sources,\n      citations: result.citations,\n      settings: {\n        includeCounterpoints,\n        authorityBias,\n        region,\n      },\n    });\n    setCompareSelection([saved.id]);\n    setComparePanelOpen(true);\n    toast.success('Answer saved to compare drawer.');\n  }, [result, addCompareEntry, includeCounterpoints, authorityBias, region]);\n\n  const runDeepScanFlow = useCallback(async (searchQuery: string) => {\n    setDeepScanLoading(true);\n    setDeepScanError(null);\n    setDeepScanSteps([]);\n    try {\n      const response = await runDeepScan(searchQuery, { maxPages: 5 });\n      setDeepScanSteps(response.steps);\n      return response;\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Deep scan failed.';\n      setDeepScanError(message);\n      toast.error(message);\n      throw error;\n    } finally {\n      setDeepScanLoading(false);\n    }\n  }, []);\n\n  const buildSearchContext = useCallback(\n    async (searchQuery: string) => {\n      const context: Record<string, unknown> = {\n        mode: 'research',\n        includeCounterpoints,\n        region: region !== 'global' ? region : undefined,\n        recencyWeight,\n        authorityWeight,\n      };\n\n      const activeTab = tabs.find(tab => tab.id === activeId);\n      if (activeTab) {\n        context.active_tab = {\n          url: activeTab.url,\n          title: activeTab.title,\n        };\n      }\n\n      if (uploadedDocuments.length > 0) {\n        context.documents = uploadedDocuments.map(doc => ({\n          name: doc.name,\n          text: doc.text.slice(0, 5000),\n          type: doc.type,\n          size: doc.size,\n        }));\n      }\n\n      try {\n        const memoryMatches = await semanticSearchMemories(searchQuery, {\n          limit: 5,\n          minSimilarity: 0.6,\n        });\n        const relevantMemories = memoryMatches.map(m => ({\n          value: m.event.value,\n          metadata: m.event.metadata,\n          id: m.event.id,\n          type: m.event.type,\n          similarity: m.similarity,\n        }));\n        if (relevantMemories.length > 0) {\n          context.memories = relevantMemories;\n        }\n      } catch (error) {\n        console.warn('[Research] Failed to fetch memory context:', error);\n      }\n\n      return context;\n    },\n    [\n      activeId,\n      tabs,\n      includeCounterpoints,\n      region,\n      recencyWeight,\n      authorityWeight,\n      uploadedDocuments,\n    ]\n  );\n\n  const queryKey = useMemo(\n    () => (result?.query ? buildQueryKey(result.query) : null),\n    [result?.query]\n  );\n\n  // File upload handlers\n  const handleFileUpload = async (files: FileList | null) => {\n    if (!files || files.length === 0) return;\n\n    setUploading(true);\n    const newDocuments: UploadedDocument[] = [];\n\n    for (const file of Array.from(files)) {\n      try {\n        const fileType = file.type.toLowerCase();\n        const fileName = file.name.toLowerCase();\n\n        let extractedText = '';\n\n        // Extract text based on file type\n        if (fileType === 'application/pdf' || fileName.endsWith('.pdf')) {\n          extractedText = await parsePdfFile(file);\n        } else if (\n          fileType === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' ||\n          fileName.endsWith('.docx')\n        ) {\n          extractedText = await parseDocxFile(file);\n        } else if (\n          fileType === 'text/plain' ||\n          fileType === 'text/markdown' ||\n          fileName.endsWith('.txt') ||\n          fileName.endsWith('.md')\n        ) {\n          // Plain text files\n          extractedText = await file.text();\n        } else {\n          console.warn(`[Research] Unsupported file type: ${fileType} (${file.name})`);\n          continue;\n        }\n\n        if (extractedText.trim().length > 0) {\n          newDocuments.push({\n            id: `doc-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,\n            file,\n            name: file.name,\n            text: extractedText.trim(),\n            type: fileType || 'unknown',\n            size: file.size,\n          });\n        }\n      } catch (err) {\n        console.error(`[Research] Failed to parse file ${file.name}:`, err);\n      }\n    }\n\n    setUploadedDocuments(prev => [...prev, ...newDocuments]);\n    setUploading(false);\n  };\n\n  const handleRemoveDocument = (id: string) => {\n    setUploadedDocuments(prev => prev.filter(doc => doc.id !== id));\n  };\n\n  const handleSearch = async (input?: string) => {\n    const searchQuery = typeof input === 'string' ? input : query;\n    if (!searchQuery.trim()) return;\n\n    // TELEMETRY FIX: Track search feature usage\n    import('../../services/telemetryMetrics')\n      .then(({ telemetryMetrics }) => {\n        telemetryMetrics.trackFeature('search_executed', { mode: 'research' });\n      })\n      .catch(() => {\n        // Telemetry not available\n      });\n\n    const searchStartTime = performance.now();\n\n    // Phase 2: Auto-detect language using multi-language AI\n    if (language === 'auto' && searchQuery.trim().length > 2) {\n      try {\n        // Use new multi-language AI for detection\n        const detectedLang = await multiLanguageAI.detectLanguage(searchQuery);\n        setDetectedLang(detectedLang);\n\n        if (detectedLang !== 'en') {\n          useSettingsStore.getState().setLanguage(detectedLang);\n          console.log('[Research] Auto-detected language:', detectedLang);\n        }\n      } catch {\n        // Fallback to old detection\n        try {\n          const detection = await detectLanguage(searchQuery, {\n            preferIndic: true,\n            useBackend: true,\n          });\n          if (detection.confidence > 0.7) {\n            const detectedLang = detection.language;\n            if (detectedLang !== 'en' || detection.isIndic) {\n              useSettingsStore.getState().setLanguage(detectedLang);\n              setDetectedLang(detectedLang);\n            }\n          }\n        } catch (fallbackError) {\n          console.warn('[Research] Language auto-detection failed:', fallbackError);\n        }\n      }\n    }\n\n    // Phase 2: Translate query if needed (for multi-language search)\n    const currentLang = language !== 'auto' ? language : detectedLang;\n    if (currentLang && currentLang !== 'en') {\n      try {\n        // Search in original language, but also prepare English version for backend\n        const englishQuery = await multiLanguageAI.translate(\n          searchQuery,\n          'en',\n          currentLang as SupportedLanguage\n        );\n        // Use both queries for better results\n        console.log('[Research] Original query:', searchQuery, 'English:', englishQuery);\n      } catch (error) {\n        console.warn('[Research] Query translation failed:', error);\n      }\n    }\n\n    setLoading(true);\n    setLoadingMessage('Researching...');\n    toast.loading('Researching...', { duration: 0 }); // Persistent loading toast\n    setError(null);\n    setResult(null);\n    setActiveSourceId(null);\n\n    // SEARCH SYSTEM VERIFICATION: Check search health before proceeding\n    const searchHealth = getSearchHealth();\n    if (searchHealth && searchHealth.status === 'offline') {\n      setError('Search system is offline. Please check your connection.');\n      setLoading(false);\n      toast.error('Search system offline');\n      return;\n    }\n\n    let aggregatedSources: ResearchSource[] = [];\n    let aggregatedProviderNames: string[] = [];\n    let scrapedSnapshots: ScrapedSourceResult[] = [];\n\n    try {\n      if (!useHybridSearch) {\n        aiMetaRef.current = {\n          provider: 'mock',\n          model: 'offline',\n        };\n        setResult(generateMockResult(searchQuery));\n        return;\n      }\n\n      const context: any = await buildSearchContext(searchQuery);\n\n      if (deepScanEnabled) {\n        const deepScanResult = await runDeepScanFlow(searchQuery);\n        aggregatedSources = deepScanResult.sources.map((source, idx) =>\n          mapDeepScanSourceToResearchSource(source, idx)\n        );\n        aggregatedProviderNames = ['deep-scan'];\n        context.deep_scan = {\n          created_at: deepScanResult.created_at,\n          steps: deepScanResult.steps,\n        };\n      } else {\n        // Try Tauri IPC first if available (real-time, streaming support)\n        let backendResult: any = null;\n        const isTauri = typeof window !== 'undefined' && !!(window as any).__TAURI__;\n\n        if (isTauri && ipc) {\n          try {\n            // Try research_api command (combines search + Ollama)\n            const tauriResult = await (ipc as any).invoke('research_api', { query: searchQuery });\n            if (tauriResult) {\n              backendResult = {\n                summary: tauriResult.summary || tauriResult.answer || '',\n                sources: (tauriResult.sources || []).map((s: any, idx: number) => ({\n                  title: s.Text || s.title || `Source ${idx + 1}`,\n                  url: s.FirstURL || s.url || '',\n                  snippet: s.Text || s.snippet || '',\n                  sourceType: 'web',\n                })),\n                citations: tauriResult.citations || 0,\n                hallucination: tauriResult.hallucination || 'medium',\n              };\n              console.log('[Research] Tauri IPC returned result:', backendResult);\n            }\n          } catch (tauriError) {\n            console.warn('[Research] Tauri IPC failed, trying HTTP API:', tauriError);\n          }\n        }\n\n        // Fallback to HTTP API if Tauri IPC not available or failed\n        // Skip in web mode - no backend available\n        if (!backendResult) {\n          // Check web mode before attempting API call\n          if (!isWebMode()) {\n            try {\n              backendResult = await researchApi.queryEnhanced({\n                query: searchQuery,\n                maxSources: 12,\n                includeCounterpoints,\n                recencyWeight,\n                authorityWeight,\n                language: language !== 'auto' ? language : undefined,\n              });\n            } catch {\n              // Silently fail - backend is optional\n              // Don't log connection errors - they're expected if backend is unavailable\n            }\n          } else {\n            // In web mode, backendResult remains null and code continues with fallback\n            backendResult = null;\n          }\n        }\n\n        if (backendResult) {\n          // Map sources\n          if (backendResult.sources && backendResult.sources.length > 0) {\n            aggregatedSources = backendResult.sources.map((source: any, idx: number) => ({\n              id: `backend-${idx}`,\n              title: source.title || 'Untitled',\n              url: source.url || '',\n              domain: source.domain || new URL(source.url || 'http://example.com').hostname,\n              snippet: source.snippet || '',\n              text: source.snippet || '',\n              type: source.sourceType || 'other',\n              sourceType: source.sourceType || 'other',\n              relevanceScore: Math.round((source.relevanceScore || 0.5) * 100),\n              timestamp: source.timestamp || Date.now(),\n              metadata: {\n                provider: 'backend-api',\n              },\n            }));\n            aggregatedProviderNames = ['backend-api'];\n          }\n\n          // Use backend summary if available\n          if (backendResult.summary) {\n            context.backend_summary = backendResult.summary;\n          }\n\n          // Store metrics for verification\n          if (backendResult.citations !== undefined || backendResult.hallucination) {\n            context.backend_metrics = {\n              citations: backendResult.citations || 0,\n              hallucination: backendResult.hallucination || 'medium',\n            };\n          }\n\n          console.log(\n            `[Research] Backend API returned ${aggregatedSources.length} results with summary and metrics`\n          );\n        }\n\n        // Fallback to multi-source search if backend API failed or returned no results\n        if (aggregatedSources.length === 0) {\n          try {\n            // OPTIMIZED SEARCH: Use optimized search service for better reliability\n            const optimizedResults = await optimizedSearch(searchQuery, {\n              count: 20,\n              language,\n              timeout: 10000,\n            });\n\n            // Convert optimized results to multi-source format\n            const multiSourceResults: MultiSourceSearchResult[] = optimizedResults.map(r => ({\n              title: r.title,\n              url: r.url,\n              snippet: r.snippet,\n              source: r.provider,\n              score: r.score,\n              domain: r.domain,\n            }));\n            if (multiSourceResults.length > 0) {\n              aggregatedSources = multiSourceResults.map((hit, idx) =>\n                mapMultiSourceResultToSource(hit, idx)\n              );\n              aggregatedProviderNames = Array.from(\n                new Set(\n                  multiSourceResults.map(hit =>\n                    typeof hit.source === 'string' ? hit.source.toLowerCase() : 'web'\n                  )\n                )\n              );\n              context.multi_source_results = multiSourceResults.slice(0, 8).map(hit => ({\n                title: hit.title,\n                url: hit.url,\n                snippet: hit.snippet.slice(0, 300),\n                provider: hit.source,\n                score: hit.score,\n              }));\n\n              const urlsToScrape = aggregatedSources\n                .filter(source => Boolean(source.url))\n                .slice(0, 4)\n                .map(source => source.url as string);\n              if (urlsToScrape.length > 0) {\n                scrapedSnapshots = await scrapeResearchSources(urlsToScrape, {\n                  max_chars: 12000,\n                  allow_render: true,\n                });\n                if (scrapedSnapshots.length > 0) {\n                  aggregatedSources = mergeScrapedSnapshots(aggregatedSources, scrapedSnapshots);\n                  context.scraped_sources = scrapedSnapshots.slice(0, 3).map(snapshot => ({\n                    url: snapshot.finalUrl ?? snapshot.url,\n                    title: snapshot.title,\n                    excerpt: snapshot.excerpt?.slice(0, 400),\n                    word_count: snapshot.wordCount,\n                    rendered: snapshot.rendered,\n                  }));\n                }\n              }\n            }\n          } catch (multiSourceError) {\n            console.warn('[Research] Multi-source search failed:', multiSourceError);\n          }\n        }\n\n        // Final fallback to live web search if all else fails\n        if (aggregatedSources.length === 0) {\n          try {\n            const liveResults = await performLiveWebSearch(searchQuery, {\n              count: 15,\n              language: language !== 'auto' ? language : undefined,\n            });\n\n            if (liveResults.length > 0) {\n              aggregatedSources = liveResults.map((hit, idx) => ({\n                id: `live-${hit.provider}-${idx}`,\n                title: hit.title,\n                url: hit.url,\n                domain: hit.domain,\n                snippet: hit.snippet,\n                text: hit.snippet,\n                type: inferSourceType(hit.domain),\n                sourceType: inferSourceType(hit.domain),\n                relevanceScore: Math.round(hit.score * 100),\n                timestamp: Date.now(),\n                metadata: {\n                  provider: hit.provider,\n                },\n              }));\n              aggregatedProviderNames = Array.from(new Set(liveResults.map(r => r.provider)));\n\n              console.log(\n                `[Research] Live web search returned ${liveResults.length} results from ${aggregatedProviderNames.join(', ')}`\n              );\n            }\n          } catch (liveSearchError) {\n            console.warn('[Research] Live web search failed:', liveSearchError);\n          }\n        }\n\n        // If we got a backend result with summary, use it directly\n        if (\n          backendResult &&\n          (backendResult.summary || backendResult.answer) &&\n          aggregatedSources.length > 0\n        ) {\n          const dedupedSources = dedupeResearchSources(aggregatedSources);\n\n          // Map backend metrics to verification\n          const citations = backendResult.citations || aggregatedSources.length || 0;\n          const hallucination = backendResult.hallucination || 'medium';\n          const hallucinationRisk =\n            hallucination === 'low' ? 0.2 : hallucination === 'medium' ? 0.5 : 0.8;\n          const citationCoverage = Math.min(\n            (citations / Math.max(aggregatedSources.length, 1)) * 100,\n            100\n          );\n\n          // TELEMETRY FIX: Track successful search latency\n          const searchLatency = performance.now() - searchStartTime;\n          import('../../services/telemetryMetrics')\n            .then(({ telemetryMetrics }) => {\n              telemetryMetrics.trackPerformance('search_latency', searchLatency, 'ms', {\n                provider: 'backend',\n                resultCount: dedupedSources.length,\n              });\n            })\n            .catch(() => {\n              // Telemetry not available\n            });\n\n          setResult({\n            query: searchQuery,\n            summary: backendResult.summary || backendResult.answer || '',\n            sources: dedupedSources.slice(0, 16),\n            citations: backendResult.citations || [],\n            inlineEvidence: [],\n            contradictions: backendResult.contradictions || [],\n            verification: {\n              verified: hallucination === 'low',\n              claimDensity: aggregatedSources.length,\n              citationCoverage: citationCoverage,\n              ungroundedClaims: [],\n              hallucinationRisk: hallucinationRisk,\n              suggestions:\n                hallucination === 'high' ? ['Consider verifying with additional sources'] : [],\n            },\n            confidence: backendResult.confidence || (hallucination === 'low' ? 0.8 : 0.6),\n            language: backendResult.language || language,\n            languageLabel: backendResult.languageLabel || getLanguageMeta(language).nativeName,\n            languageConfidence: backendResult.languageConfidence || 0.9,\n          });\n          setLoading(false);\n          setLoadingMessage(null);\n          toast.dismiss();\n          return;\n        }\n\n        // Try Tauri streaming if available and no result yet\n        // Reuse isTauri from above (line 835) - no need to redeclare\n        if (isTauri && ipc && aggregatedSources.length === 0) {\n          try {\n            // Set up streaming listeners\n            let streamedText = '';\n            let streamCitations = 0;\n            let streamHallucination = 'medium';\n\n            const handleToken = (e: CustomEvent) => {\n              if (typeof e.detail === 'string') {\n                streamedText += e.detail;\n                // Update result in real-time\n                setResult(prev => ({\n                  ...prev,\n                  query: searchQuery,\n                  summary: streamedText,\n                  sources: prev?.sources || [],\n                  citations: prev?.citations || [],\n                  inlineEvidence: [],\n                  contradictions: [],\n                  verification: {\n                    verified: streamHallucination === 'low',\n                    claimDensity: aggregatedSources.length,\n                    citationCoverage:\n                      streamCitations > 0\n                        ? Math.min(\n                            (streamCitations / Math.max(aggregatedSources.length, 1)) * 100,\n                            100\n                          )\n                        : 0,\n                    ungroundedClaims: [],\n                    hallucinationRisk:\n                      streamHallucination === 'low'\n                        ? 0.2\n                        : streamHallucination === 'medium'\n                          ? 0.5\n                          : 0.8,\n                    suggestions:\n                      streamHallucination === 'high'\n                        ? ['Consider verifying with additional sources']\n                        : [],\n                  },\n                  confidence: streamHallucination === 'low' ? 0.8 : 0.6,\n                  language: language,\n                  languageLabel: getLanguageMeta(language).nativeName,\n                  languageConfidence: 0.9,\n                }));\n              }\n            };\n\n            const handleMetrics = (e: CustomEvent) => {\n              if (e.detail) {\n                streamCitations = e.detail.citations || 0;\n                streamHallucination = e.detail.hallucination || 'medium';\n              }\n            };\n\n            const handleEnd = (e: CustomEvent) => {\n              if (e.detail) {\n                streamedText = e.detail.response || streamedText;\n                streamCitations = e.detail.citations || streamCitations;\n                streamHallucination = e.detail.hallucination || streamHallucination;\n              }\n              // Remove listeners\n              window.removeEventListener('research-token', handleToken as EventListener);\n              window.removeEventListener('research-metrics', handleMetrics as EventListener);\n              window.removeEventListener('research-end', handleEnd as EventListener);\n              setLoading(false);\n              setLoadingMessage(null);\n              toast.dismiss();\n            };\n\n            // Add listeners\n            window.addEventListener('research-token', handleToken as EventListener);\n            window.addEventListener('research-metrics', handleMetrics as EventListener);\n            window.addEventListener('research-end', handleEnd as EventListener);\n\n            // Start streaming (Tauri command expects query as first parameter, window is auto-injected)\n            await (ipc as any).invoke('research_stream', { query: searchQuery });\n\n            // Set initial result\n            setResult({\n              query: searchQuery,\n              summary: '',\n              sources: [],\n              citations: [],\n              inlineEvidence: [],\n              contradictions: [],\n              verification: {\n                verified: false,\n                claimDensity: 0,\n                citationCoverage: 0,\n                ungroundedClaims: [],\n                hallucinationRisk: 0.5,\n                suggestions: [],\n              },\n              confidence: 0.5,\n              language: language,\n              languageLabel: getLanguageMeta(language).nativeName,\n              languageConfidence: 0.9,\n            });\n\n            return; // Exit early, streaming will update result\n          } catch (streamError) {\n            console.warn('[Research] Tauri streaming failed:', streamError);\n            // Continue to fallback\n          }\n        }\n      }\n\n      // Use unified AI engine for research queries\n      try {\n        let streamedText = '';\n        let streamedResult: AITaskResult | null = null;\n\n        const aiResult = await aiEngine.runTask(\n          {\n            kind: 'search',\n            prompt: searchQuery,\n            context,\n            mode: 'research',\n            metadata: {\n              includeCounterpoints,\n              region: region !== 'global' ? region : undefined,\n              recencyWeight,\n              authorityWeight,\n              language: language !== 'auto' ? language : undefined,\n            },\n            llm: {\n              temperature: 0.2,\n              maxTokens: 1000,\n            },\n          },\n          event => {\n            if (event.type === 'token' && typeof event.data === 'string') {\n              streamedText += event.data;\n              // Update result with streaming text if needed\n            } else if (event.type === 'done' && typeof event.data !== 'string') {\n              streamedResult = event.data as AITaskResult;\n            }\n          }\n        );\n\n        const finalResult = streamedResult ?? aiResult;\n        aiMetaRef.current = {\n          provider: finalResult?.provider || 'ai',\n          model: finalResult?.model,\n        };\n        const finalAnswer = streamedText || finalResult?.text || '';\n\n        // Auto-generate graph from AI response if available\n        if (finalAnswer && typeof window !== 'undefined' && window.graph) {\n          try {\n            // Extract key concepts from AI response\n            const concepts = finalAnswer.split(/[.,;]/).slice(0, 5);\n            for (const concept of concepts) {\n              const trimmed = concept.trim();\n              if (trimmed.length > 3 && trimmed.length < 50) {\n                await window.graph.add({\n                  id: `research-${Date.now()}-${Math.random()}`,\n                  label: trimmed,\n                  type: 'research-concept',\n                });\n              }\n            }\n            await refreshGraph();\n          } catch (graphError) {\n            console.debug('[Research] Auto-graph generation failed:', graphError);\n          }\n        }\n\n        // Convert AI result to ResearchResult format\n        const sources: ResearchSource[] = [...aggregatedSources];\n\n        // Add citations from AI response as sources\n        if (finalResult?.citations && finalResult.citations.length > 0) {\n          sources.push(\n            ...finalResult.citations.map((cite, idx) => {\n              let domain = cite.source || '';\n              try {\n                if (cite.url) {\n                  domain = new URL(cite.url).hostname;\n                }\n              } catch {\n                // Invalid URL, use source or empty\n                domain = cite.source || '';\n              }\n              const citationType: ResearchSourceType = inferSourceType(domain);\n              return {\n                id: `ai-citation-${idx}`,\n                title: cite.title || cite.url || `Source ${idx + 1}`,\n                url: cite.url || '',\n                domain,\n                snippet: cite.snippet || '',\n                text: cite.snippet || '',\n                type: citationType,\n                sourceType: citationType,\n                relevanceScore: 95 - idx * 3,\n                timestamp: Date.now(),\n                metadata: {\n                  provider: 'ai-citation',\n                },\n              };\n            })\n          );\n        }\n\n        // Add uploaded documents as sources\n        if (uploadedDocuments.length > 0) {\n          sources.push(\n            ...uploadedDocuments.map((doc, idx) => ({\n              id: doc.id,\n              title: doc.name,\n              url: '',\n              domain: 'uploaded',\n              snippet: doc.text.slice(0, 200) + (doc.text.length > 200 ? '...' : ''),\n              text: doc.text,\n              type: 'documentation' as ResearchSourceType,\n              sourceType: 'documentation' as ResearchSourceType,\n              relevanceScore: 98 - idx, // High relevance for uploaded documents\n              timestamp: Date.now(),\n              metadata: {\n                provider: 'uploaded-doc',\n              },\n            }))\n          );\n        }\n\n        // Add local search results\n        try {\n          const localResults = await searchLocal(searchQuery);\n          sources.push(\n            ...localResults.map((lr, idx) => ({\n              id: `local-${lr.id}`,\n              title: lr.title,\n              url: '',\n              domain: 'local',\n              snippet: lr.snippet,\n              text: lr.snippet,\n              type: 'documentation' as ResearchSourceType,\n              sourceType: 'documentation' as ResearchSourceType,\n              relevanceScore: 85 - idx * 3,\n              timestamp: Date.now(),\n              metadata: {\n                provider: 'local-index',\n              },\n            }))\n          );\n        } catch (localError) {\n          console.debug('[Research] Local search failed:', localError);\n        }\n\n        // Build inline citations from AI response\n        const inlineCitations =\n          finalResult?.citations?.map((cite, idx) => ({\n            id: `citation-${idx}`,\n            text: cite.title || cite.url || `Source ${idx + 1}`,\n            url: cite.url || '',\n            position:\n              finalAnswer.indexOf(cite.title || '') >= 0\n                ? finalAnswer.indexOf(cite.title || '')\n                : idx * 50, // Approximate position\n          })) || [];\n\n        const dedupedSources = dedupeResearchSources(sources);\n\n        setResult({\n          query: searchQuery,\n          summary: finalAnswer || 'No answer generated',\n          sources: dedupedSources.slice(0, 16),\n          citations: inlineCitations,\n          inlineEvidence: [],\n          contradictions: [],\n          verification: {\n            score: 0.8,\n            confidence: 'high',\n            suggestions: [\n              `AI-generated response using ${finalResult?.provider || 'unknown'} (${finalResult?.model || 'unknown'})`,\n              ...(finalResult?.citations?.length\n                ? [`${finalResult.citations.length} citation(s) included`]\n                : []),\n            ],\n          },\n          confidence: Math.min(0.95, Math.max(0.45, finalResult?.confidence ?? 0.82)),\n        });\n        return;\n      } catch (aiError) {\n        console.warn('[Research] AI engine failed, falling back to legacy search:', aiError);\n\n        if (aggregatedSources.length > 0) {\n          const providerLabel =\n            aggregatedProviderNames.length > 0\n              ? aggregatedProviderNames.map(provider => formatProviderName(provider)).join(', ')\n              : 'multi-source web';\n          const dedupedAggregated = dedupeResearchSources(aggregatedSources);\n          const topTitles = dedupedAggregated\n            .slice(0, 3)\n            .map(source => source.title)\n            .join('; ');\n          const scrapedSummary = scrapedSnapshots.find(snapshot => snapshot.excerpt)?.excerpt;\n          aiMetaRef.current = {\n            provider: 'multi-source',\n            model: 'aggregate',\n          };\n\n          setResult({\n            query: searchQuery,\n            summary: scrapedSummary?.length\n              ? scrapedSummary\n              : topTitles.length > 0\n                ? `Multi-source (${providerLabel}) search returned ${dedupedAggregated.length} results. Top hits: ${topTitles}.`\n                : `Multi-source (${providerLabel}) search returned ${dedupedAggregated.length} results.`,\n            sources: dedupedAggregated.slice(0, 16),\n            citations: [],\n            inlineEvidence: [],\n            contradictions: [],\n            verification: {\n              score: 0.65,\n              confidence: 'medium',\n              suggestions: [`Review ${providerLabel} sources manually.`],\n            },\n            confidence: 0.62,\n          });\n          return;\n        }\n\n        // OPTIMIZED SEARCH: Try optimized search as primary fallback\n        const optimizedResults = await optimizedSearch(searchQuery, {\n          count: 10,\n          language,\n          timeout: 6000,\n        });\n\n        if (optimizedResults.length > 0) {\n          const sources: ResearchSource[] = optimizedResults.map((r, idx) => ({\n            id: `opt-fallback-${idx}`,\n            title: r.title,\n            url: r.url,\n            domain: r.domain,\n            snippet: r.snippet,\n            text: r.snippet,\n            type: inferSourceType(r.domain),\n            sourceType: inferSourceType(r.domain),\n            relevanceScore: r.score * 100,\n            timestamp: r.timestamp,\n            metadata: {\n              provider: r.provider,\n            },\n          }));\n\n          setResult({\n            query: searchQuery,\n            summary: `Found ${sources.length} result${sources.length === 1 ? '' : 's'} for \"${searchQuery}\"`,\n            sources: dedupeResearchSources(sources).slice(0, 16),\n            citations: [],\n            inlineEvidence: [],\n            contradictions: [],\n            verification: {\n              score: 0.65,\n              confidence: 'medium',\n              suggestions: [`Results from ${optimizedResults[0]?.provider || 'optimized'} search`],\n            },\n            confidence: 0.6,\n          });\n          return;\n        }\n\n        // Final fallback to DuckDuckGo Instant Answer API\n        const duckResult = await fetchDuckDuckGoInstant(searchQuery, language);\n        if (duckResult) {\n          aiMetaRef.current = {\n            provider: 'duckduckgo',\n            model: 'instant-answer',\n          };\n          const formatted = formatDuckDuckGoResults(duckResult);\n\n          // Also try local search\n          const localResults = await searchLocal(searchQuery).catch(() => []);\n\n          // Convert to ResearchResult format\n          const sources: ResearchSource[] = [\n            // DuckDuckGo instant answer\n            ...(duckResult.Heading && duckResult.AbstractText\n              ? [\n                  {\n                    id: 'duck-instant',\n                    title: duckResult.Heading,\n                    url: duckResult.AbstractURL || '',\n                    domain: duckResult.AbstractURL\n                      ? extractDomain(duckResult.AbstractURL)\n                      : 'duckduckgo.com',\n                    snippet: duckResult.AbstractText,\n                    text: duckResult.AbstractText,\n                    type: 'news' as ResearchSourceType,\n                    sourceType: 'news' as ResearchSourceType,\n                    relevanceScore: 100,\n                    timestamp: Date.now(),\n                  },\n                ]\n              : []),\n            // DuckDuckGo web results\n            ...formatted\n              .filter(f => f.type === 'result' && f.url)\n              .map((f, idx) => {\n                const domain = f.url ? extractDomain(f.url) : '';\n                const sourceType = inferSourceType(domain);\n                return {\n                  id: `duck-result-${idx}`,\n                  title: f.title,\n                  url: f.url || '',\n                  domain,\n                  snippet: f.snippet,\n                  text: f.snippet,\n                  type: sourceType,\n                  sourceType,\n                  relevanceScore: 85 - idx * 5,\n                  timestamp: Date.now(),\n                };\n              }),\n            // Local docs results\n            ...localResults.map((lr, idx) => ({\n              id: `local-${lr.id}`,\n              title: lr.title,\n              url: '',\n              domain: 'local',\n              snippet: lr.snippet,\n              text: lr.snippet,\n              type: 'documentation' as ResearchSourceType,\n              sourceType: 'documentation' as ResearchSourceType,\n              relevanceScore: 90 - idx * 3,\n              timestamp: Date.now(),\n              metadata: {\n                provider: 'local-index',\n              },\n            })),\n          ];\n\n          setResult({\n            query: searchQuery,\n            summary:\n              duckResult.AbstractText ||\n              duckResult.Answer ||\n              duckResult.Definition ||\n              `Found ${sources.length} result${sources.length === 1 ? '' : 's'} for \"${searchQuery}\"`,\n            sources: dedupeResearchSources(sources).slice(0, 16),\n            citations: [],\n            inlineEvidence: [],\n            contradictions: [],\n            verification: {\n              score: 0.7,\n              confidence: 'medium',\n              suggestions: ['Results from DuckDuckGo Instant Answer API'],\n            },\n            confidence: 0.58,\n          });\n        } else {\n          // Final fallback: try local search only\n          const localResults = await searchLocal(searchQuery).catch(() => []);\n          if (localResults.length > 0) {\n            aiMetaRef.current = {\n              provider: 'local-index',\n              model: 'documents',\n            };\n            setResult({\n              query: searchQuery,\n              summary: `Found ${localResults.length} local result${localResults.length === 1 ? '' : 's'}`,\n              sources: localResults.map((lr, idx) => ({\n                id: `local-${lr.id}`,\n                title: lr.title,\n                url: '',\n                domain: 'local',\n                snippet: lr.snippet,\n                text: lr.snippet,\n                type: 'documentation' as ResearchSourceType,\n                sourceType: 'documentation' as ResearchSourceType,\n                relevanceScore: 90 - idx * 3,\n                timestamp: Date.now(),\n                metadata: {\n                  provider: 'local-index',\n                },\n              })),\n              citations: [],\n              inlineEvidence: [],\n              contradictions: [],\n              verification: {\n                score: 0.6,\n                confidence: 'low',\n                suggestions: ['Results from local index only'],\n              },\n              confidence: 0.52,\n            });\n          } else {\n            throw new Error(\n              'No search results available. Please check your connection or try a different query.'\n            );\n          }\n        }\n      }\n    } catch (err) {\n      console.error('Research query failed:', err);\n\n      // SEARCH SYSTEM VERIFICATION: Enhanced error handling with offline fallback\n      const errorMessage =\n        err instanceof Error\n          ? err.message\n          : 'Unable to complete the research request. Please try again.';\n\n      // Try offline fallback if MeiliSearch is down\n      const searchHealth = getSearchHealth();\n      if (searchHealth && !searchHealth.meiliSearch && searchHealth.localSearch) {\n        try {\n          console.log('[Research] Attempting offline search fallback...');\n          const localResults = await searchLocal(searchQuery, { limit: 10 });\n          if (localResults && localResults.length > 0) {\n            // Convert local results to ResearchSource format\n            const localSources = localResults.map((result: any, idx: number) => ({\n              id: `local-${idx}`,\n              url: result.url || '',\n              title: result.title || 'Local Result',\n              snippet: result.snippet || '',\n              sourceType: 'local' as ResearchSourceType,\n              relevanceScore: result.score || 50,\n            }));\n\n            // Create a basic result from local search\n            setResult({\n              query: searchQuery,\n              summary: `Found ${localResults.length} local result(s) for \"${searchQuery}\"`,\n              sources: localSources,\n              citations: localSources.length,\n              confidence: 0.6,\n              processingTimeMs: 100,\n            });\n\n            toast.success(`Found ${localResults.length} local result(s)`);\n            setError(null);\n            return;\n          }\n        } catch (fallbackError) {\n          console.warn('[Research] Offline fallback also failed:', fallbackError);\n        }\n      }\n\n      setError(\n        `Search failed: ${errorMessage}. ${searchHealth?.error ? `(${searchHealth.error})` : ''}`\n      );\n      toast.error(`Search failed: ${errorMessage}`);\n\n      // TELEMETRY FIX: Track failed search latency\n      const searchLatency = performance.now() - searchStartTime;\n      import('../../services/telemetryMetrics')\n        .then(({ telemetryMetrics }) => {\n          telemetryMetrics.trackPerformance('search_latency', searchLatency, 'ms', {\n            provider: 'failed',\n            error: errorMessage,\n          });\n        })\n        .catch(() => {\n          // Telemetry not available\n        });\n    } finally {\n      setLoading(false);\n      setLoadingMessage(null);\n      toast.dismiss();\n    }\n  };\n\n  useEffect(() => {\n    const handleQuickstart = (event: Event) => {\n      const detail = (event as CustomEvent<{ query?: string }>).detail;\n      if (!detail?.query) return;\n      setQuery(detail.query);\n      setTimeout(() => {\n        void handleSearch(detail.query);\n      }, 100);\n    };\n\n    window.addEventListener('research:quickstart', handleQuickstart as EventListener);\n    return () => {\n      window.removeEventListener('research:quickstart', handleQuickstart as EventListener);\n    };\n  }, []);\n\n  useEffect(() => {\n    void refreshGraph();\n  }, [refreshGraph]);\n\n  useEffect(() => {\n    if (!result || typeof window === 'undefined' || !window.graph?.add) return;\n\n    const signature = JSON.stringify({\n      query: result.query,\n      sources: result.sources.map(source => source.url || source.title),\n      citations: result.citations?.length ?? 0,\n      evidence: (result.inlineEvidence ?? []).length,\n    });\n\n    if (graphSignatureRef.current === signature) {\n      void refreshGraph();\n      return;\n    }\n\n    graphSignatureRef.current = signature;\n    const currentQueryKey = buildQueryKey(result.query);\n\n    const queryEdges = result.sources.map((source, idx) => ({\n      src: currentQueryKey,\n      dst: buildSourceKey(source, idx),\n      rel: 'supports',\n      weight: Math.round(source.relevanceScore || 40),\n    }));\n\n    window.graph.add(\n      {\n        key: currentQueryKey,\n        type: 'research-query',\n        title: result.query.slice(0, 160),\n        meta: {\n          query: result.query,\n          createdAt: Date.now(),\n        },\n      },\n      queryEdges\n    );\n\n    result.sources.forEach((source, idx) => {\n      const sourceKey = buildSourceKey(source, idx);\n      const relatedEvidence = (result.inlineEvidence ?? [])\n        .filter(item => item.sourceIndex === idx)\n        .slice(0, 6);\n\n      const evidenceEdges = relatedEvidence.map(item => ({\n        src: sourceKey,\n        dst: buildEvidenceKey(sourceKey, item.citationIndex ?? item.from ?? idx),\n        rel: 'evidence',\n        weight: 1,\n      }));\n\n      window.graph.add(\n        {\n          key: sourceKey,\n          type: 'research-source',\n          title: source.title,\n          meta: {\n            url: source.url,\n            domain: source.domain,\n            snippet: source.snippet || source.text?.slice(0, 140),\n            relevance: source.relevanceScore,\n          },\n        },\n        evidenceEdges\n      );\n\n      relatedEvidence.forEach(item => {\n        const evidenceKey = buildEvidenceKey(sourceKey, item.citationIndex ?? item.from ?? idx);\n        const citation = result.citations?.find(entry => entry.index === item.citationIndex);\n        window.graph.add({\n          key: evidenceKey,\n          type: 'research-evidence',\n          title: citation?.quote || item.quote || 'Highlighted evidence',\n          meta: {\n            sourceKey,\n            snippet: citation?.quote || item.quote,\n            fragmentUrl: (item as any)?.quoteUrl || source.url,\n          },\n        });\n      });\n    });\n\n    (result.contradictions ?? []).forEach(contradiction => {\n      if (!Array.isArray(contradiction.sources) || contradiction.sources.length < 2) return;\n      const [first, ...rest] = contradiction.sources;\n      const baseSource = result.sources[first];\n      if (!baseSource) return;\n      const baseKey = buildSourceKey(baseSource, first);\n      rest.forEach(targetIdx => {\n        const targetSource = result.sources[targetIdx];\n        if (!targetSource) return;\n        const targetKey = buildSourceKey(targetSource, targetIdx);\n        window.graph.add({ key: baseKey, type: 'research-source' }, [\n          {\n            src: baseKey,\n            dst: targetKey,\n            rel: 'contradicts',\n            weight: contradiction.severityScore ?? (contradiction.disagreement === 'major' ? 2 : 1),\n          },\n        ]);\n      });\n    });\n\n    void refreshGraph();\n  }, [result, refreshGraph]);\n\n  const handleOpenUrl = async (url: string) => {\n    try {\n      if (activeId) {\n        await ipc.tabs.navigate(activeId, url);\n      } else {\n        await ipc.tabs.create(url);\n      }\n    } catch (error) {\n      console.error('Failed to open URL:', error);\n    }\n  };\n\n  const handleRunExample = (example: string) => {\n    setQuery(example);\n    void handleSearch(example);\n  };\n\n  // Autocomplete suggestions\n  useEffect(() => {\n    const trimmed = debouncedQuery.trim();\n    if (!trimmed || trimmed.length < 2) {\n      setAutocompleteSuggestions([]);\n      setShowAutocomplete(false);\n      return;\n    }\n\n    const isOffline = typeof navigator !== 'undefined' && !navigator.onLine;\n    setAutocompleteLoading(true);\n\n    const fetchSuggestions = async () => {\n      const suggestions: Array<{ title: string; subtitle?: string; action?: () => void }> = [];\n\n      // Try Redix streaming for live suggestions (if online)\n      if (!isOffline) {\n        try {\n          let hasResults = false;\n          await ipc.redix.stream(trimmed, {\n            onChunk: (chunk: string) => {\n              // Parse Redix suggestions from streaming response\n              // For now, show a simple suggestion\n              if (!hasResults && chunk.trim()) {\n                hasResults = true;\n                suggestions.push({\n                  title: `Ask Redix: ${trimmed}`,\n                  subtitle: 'Get AI-powered research suggestions',\n                  action: () => {\n                    setQuery(trimmed);\n                    setShowAutocomplete(false);\n                    void handleSearch(trimmed);\n                  },\n                });\n              }\n            },\n            onError: () => {\n              // Fall through to DuckDuckGo fallback\n            },\n          });\n        } catch {\n          // Fall through to DuckDuckGo fallback\n        }\n      }\n\n      // DuckDuckGo instant answer as fallback suggestion\n      if (suggestions.length === 0 && !isOffline) {\n        try {\n          const duckResult = await fetchDuckDuckGoInstant(trimmed);\n          if (duckResult?.Heading) {\n            suggestions.push({\n              title: duckResult.Heading,\n              subtitle: duckResult.AbstractText?.slice(0, 100) || 'Instant answer from DuckDuckGo',\n              action: () => {\n                setQuery(trimmed);\n                setShowAutocomplete(false);\n                void handleSearch(trimmed);\n              },\n            });\n          }\n        } catch {\n          // Silent fail - continue with other suggestions\n        }\n      }\n\n      // Fallback: Recent history\n      try {\n        const history = await ipc.history.search(trimmed);\n        if (Array.isArray(history) && history.length > 0) {\n          history.slice(0, 5).forEach((item: any) => {\n            if (!suggestions.find(s => s.title === item.title)) {\n              suggestions.push({\n                title: item.title || item.url || 'Untitled',\n                subtitle: item.url,\n                action: () => {\n                  setQuery(item.title || item.url);\n                  setShowAutocomplete(false);\n                  void handleSearch(item.title || item.url);\n                },\n              });\n            }\n          });\n        }\n      } catch {\n        // Silent fail\n      }\n\n      // Tab matches\n      tabs.forEach(tab => {\n        const title = tab.title || 'Untitled';\n        const tabUrl = tab.url || '';\n        if (\n          (title.toLowerCase().includes(trimmed.toLowerCase()) ||\n            tabUrl.toLowerCase().includes(trimmed.toLowerCase())) &&\n          !suggestions.find(s => s.title === title)\n        ) {\n          suggestions.push({\n            title,\n            subtitle: tabUrl,\n            action: () => {\n              setQuery(title);\n              setShowAutocomplete(false);\n              void handleSearch(title);\n            },\n          });\n        }\n      });\n\n      setAutocompleteSuggestions(suggestions);\n      setShowAutocomplete(suggestions.length > 0);\n      setAutocompleteLoading(false);\n    };\n\n    void fetchSuggestions();\n  }, [debouncedQuery, tabs]);\n\n  // Close autocomplete when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (autocompleteRef.current && !autocompleteRef.current.contains(event.target as Node)) {\n        setShowAutocomplete(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  return (\n    <>\n      <ResearchStagehandIntegration />\n      <LayoutEngine\n        sidebarWidth={0}\n        navHeight={0}\n        className=\"mode-theme mode-theme--research bg-[#0f111a] text-gray-100\"\n      >\n      <LayoutHeader sticky={false} className=\"border-b border-white/5 bg-black/20 backdrop-blur\">\n        <div className=\"flex items-center justify-between px-6 pb-3 pt-6\">\n          <div className=\"min-w-0 flex-1\">\n            <h1 className=\"text-xl font-semibold text-white\">Research Mode</h1>\n            <p className=\"text-sm text-gray-400\">\n              Aggregate evidence, generate traceable answers, and surface counterpoints without\n              leaving the browser.\n            </p>\n          </div>\n          <div className=\"ml-4 flex flex-shrink-0 items-center gap-2\">\n            <button\n              type=\"button\"\n              onClick={() => setUseEnhancedView(prev => !prev)}\n              className={`rounded-lg border px-3 py-1.5 text-sm transition ${\n                useEnhancedView\n                  ? 'border-emerald-500/60 bg-emerald-500/10 text-emerald-200'\n                  : 'border-white/20 bg-white/10 text-gray-300 hover:bg-white/20'\n              }`}\n              title={\n                useEnhancedView ? 'Switch to Standard View' : 'Switch to Enhanced Multilingual View'\n              }\n            >\n              <span className=\"flex items-center gap-1.5\">\n                <Sparkles size={14} />\n                {useEnhancedView ? 'Enhanced' : 'Standard'}\n              </span>\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => setCursorPanelOpen(prev => !prev)}\n              className={`rounded-lg border px-3 py-1.5 text-sm transition ${\n                cursorPanelOpen\n                  ? 'border-blue-500/60 bg-blue-500/10 text-blue-200'\n                  : 'border-white/20 bg-white/10 text-gray-300 hover:bg-white/20'\n              }`}\n              title=\"Toggle Cursor AI Assistant\"\n            >\n              <span className=\"flex items-center gap-1.5\">\n                <Sparkles size={14} />\n                Cursor AI\n              </span>\n            </button>\n            <ActiveContainerBadge containers={containers} activeContainerId={activeContainerId} />\n          </div>\n        </div>\n\n        <div className=\"flex-shrink-0 px-6 pb-5\">\n          <div className=\"relative max-w-4xl\" ref={autocompleteRef}>\n            <form\n              onSubmit={async e => {\n                e.preventDefault();\n                setShowAutocomplete(false);\n                await handleSearch();\n              }}\n              className=\"flex w-full items-center gap-3 rounded-2xl border border-white/10 bg-white/5 px-4 py-3 shadow-inner shadow-black/40 transition-all focus-within:border-blue-500/50 focus-within:ring-1 focus-within:ring-blue-500/20\"\n            >\n              <Search size={18} className=\"flex-shrink-0 text-gray-500\" />\n              <input\n                id=\"research-query-input\"\n                name=\"research-query\"\n                className=\"flex-1 bg-transparent text-base text-white placeholder:text-gray-500 focus:outline-none\"\n                value={query}\n                onChange={e => {\n                  setQuery(e.target.value);\n                  setShowAutocomplete(true);\n                  // Auto-detect language as user types\n                  if (e.target.value.length > 3) {\n                    detectLanguage(e.target.value)\n                      .then(result => {\n                        setDetectedLang(result.language);\n                      })\n                      .catch(() => {});\n                  }\n                }}\n                onFocus={() => {\n                  if (autocompleteSuggestions.length > 0) {\n                    setShowAutocomplete(true);\n                  }\n                }}\n                placeholder={(() => {\n                  const effectiveLang = language === 'auto' ? detectedLang : language;\n                  if (effectiveLang === 'hi')\n                    return '  : iPhone vs Samsung   ';\n                  if (effectiveLang === 'ta')\n                    return ' : iPhone vs Samsung ';\n                  return 'Ask in Hindi: Compare iPhone vs Samsung';\n                })()}\n                disabled={loading}\n              />\n              <div className=\"flex items-center gap-2\">\n                {autocompleteLoading && (\n                  <Skeleton variant=\"text\" width={80} height={16} className=\"text-xs\" />\n                )}\n                <input\n                  id=\"research-file-input\"\n                  name=\"research-file\"\n                  ref={fileInputRef}\n                  type=\"file\"\n                  multiple\n                  accept=\".pdf,.docx,.txt,.md\"\n                  onChange={e => handleFileUpload(e.target.files)}\n                  className=\"hidden\"\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => fileInputRef.current?.click()}\n                  disabled={uploading}\n                  className=\"flex items-center gap-1.5 rounded-lg border border-white/20 bg-white/10 px-3 py-1.5 text-sm text-gray-100 hover:bg-white/20 disabled:cursor-not-allowed disabled:opacity-40\"\n                  title=\"Upload documents (PDF, DOCX, TXT, MD)\"\n                >\n                  <Upload size={14} />\n                  {uploading ? 'Processing' : 'Upload'}\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={loading || !query.trim()}\n                  className=\"rounded-lg border border-white/20 bg-white/10 px-3 py-1.5 text-sm text-gray-100 hover:bg-white/20 disabled:cursor-not-allowed disabled:opacity-40\"\n                >\n                  {loading ? 'Researching' : 'Run research'}\n                </button>\n                <VoiceButton\n                  onResult={text => {\n                    // Parse voice command for research triggers and language\n                    const parsed = parseResearchVoiceCommand(text);\n\n                    if (parsed.isResearchCommand) {\n                      // Update language if detected in voice command\n                      if (parsed.language) {\n                        const settingsStore = useSettingsStore.getState();\n                        if (settingsStore.language !== parsed.language) {\n                          settingsStore.setLanguage(parsed.language);\n                          toast.success(`Language set to ${parsed.language.toUpperCase()}`);\n                        }\n                      }\n\n                      // Set query and trigger search\n                      setQuery(parsed.query);\n                      setTimeout(() => handleSearch(parsed.query), 120);\n                    } else {\n                      // Regular voice input - just set query and search\n                      setQuery(text);\n                      setTimeout(() => handleSearch(text), 120);\n                    }\n                  }}\n                  small\n                />\n              </div>\n            </form>\n            {showAutocomplete && autocompleteSuggestions.length > 0 && (\n              <div className=\"absolute left-0 right-0 top-full z-[100] mt-2 max-h-[400px] min-h-[120px] overflow-y-auto rounded-xl border border-white/10 bg-[#111422] shadow-xl shadow-black/50\">\n                <div className=\"space-y-1 p-2\">\n                  {autocompleteSuggestions.map((suggestion, idx) => (\n                    <button\n                      key={idx}\n                      type=\"button\"\n                      onClick={() => {\n                        suggestion.action?.();\n                      }}\n                      className=\"w-full rounded-lg px-3 py-2.5 text-left transition-colors hover:bg-white/5 focus:outline-none focus:ring-2 focus:ring-blue-500/50\"\n                    >\n                      <div className=\"line-clamp-1 text-sm font-medium text-white\">\n                        {suggestion.title}\n                      </div>\n                      {suggestion.subtitle && (\n                        <div className=\"mt-0.5 line-clamp-1 text-xs text-gray-400\">\n                          {suggestion.subtitle}\n                        </div>\n                      )}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Uploaded documents display */}\n        {uploadedDocuments.length > 0 && (\n          <div className=\"flex-shrink-0 px-6 pb-3\">\n            <div className=\"flex flex-wrap items-center gap-2\">\n              <span className=\"text-xs font-medium text-gray-400\">Uploaded documents:</span>\n              {uploadedDocuments.map(doc => (\n                <div\n                  key={doc.id}\n                  className=\"group flex items-center gap-2 rounded-lg border border-white/10 bg-white/5 px-3 py-1.5 text-xs text-gray-300\"\n                >\n                  <FileText size={12} className=\"text-gray-400\" />\n                  <span className=\"max-w-[200px] truncate\">{doc.name}</span>\n                  <span className=\"text-gray-500\">({(doc.size / 1024).toFixed(1)} KB)</span>\n                  <button\n                    type=\"button\"\n                    onClick={() => handleRemoveDocument(doc.id)}\n                    className=\"ml-1 rounded p-0.5 opacity-0 transition-opacity hover:bg-white/10 group-hover:opacity-100\"\n                    title=\"Remove document\"\n                  >\n                    <X size={12} className=\"text-gray-400 hover:text-gray-200\" />\n                  </button>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n      </LayoutHeader>\n\n      <LayoutBody className=\"flex min-h-0 flex-1 gap-6 overflow-hidden px-6 pb-6\">\n        {useEnhancedView ? (\n          <div className=\"flex-1 overflow-hidden rounded-2xl border border-white/5 bg-[#111422] shadow-xl shadow-black/30\">\n            {/* Use new streaming Perplexity-style UI */}\n            <RegenResearchPanel />\n          </div>\n        ) : (\n          <>\n            <section className=\"relative flex-1 overflow-hidden rounded-2xl border border-white/5 bg-[#111422] shadow-xl shadow-black/30\">\n              <div className=\"absolute inset-x-0 top-0 h-px bg-gradient-to-r from-transparent via-blue-400/40 to-transparent\" />\n              <div className=\"flex h-full flex-col space-y-4 p-5\">\n                <ResearchControls\n                  authorityBias={authorityBias}\n                  includeCounterpoints={includeCounterpoints}\n                  region={region}\n                  loading={loading}\n                  onAuthorityBiasChange={setAuthorityBias}\n                  onIncludeCounterpointsChange={setIncludeCounterpoints}\n                  onRegionChange={value => setRegion(value)}\n                  deepScanEnabled={deepScanEnabled}\n                  onDeepScanToggle={value => setDeepScanEnabled(value)}\n                />\n\n                {deepScanEnabled && (\n                  <DeepScanStatus\n                    loading={deepScanLoading}\n                    steps={deepScanSteps}\n                    error={deepScanError}\n                  />\n                )}\n\n                {error && (\n                  <div className=\"rounded-xl border border-red-500/40 bg-red-500/10 px-4 py-3 text-sm text-red-200 backdrop-blur\">\n                    {error}\n                  </div>\n                )}\n\n                {loading && (\n                  <div className=\"flex flex-1 flex-col items-center justify-center gap-4\">\n                    <div className=\"inline-flex items-center gap-2 rounded-full border border-blue-400/20 bg-blue-400/10 px-4 py-2 text-blue-200\">\n                      <Sparkles size={14} className=\"animate-pulse\" />\n                      Gathering sources and evaluating evidence\n                    </div>\n                    <div className=\"w-full max-w-2xl space-y-4\">\n                      <LoadingSkeleton variant=\"card\" />\n                      <LoadingSkeleton variant=\"list\" lines={3} />\n                      <LoadingSkeleton variant=\"text\" lines={4} />\n                    </div>\n                    <p className=\"text-xs text-gray-500\">\n                      Cross-checking accuracy, bias, and contradictions before presenting the\n                      answer.\n                    </p>\n                  </div>\n                )}\n\n                {!loading && result && (\n                  <div className=\"flex-1 space-y-4 overflow-y-auto pr-1\">\n                    <EvidenceOverlay\n                      evidence={result.evidence || []}\n                      sources={result.sources}\n                      activeEvidenceId={activeEvidenceId}\n                      onEvidenceClick={setActiveEvidenceId}\n                    />\n                    <ResearchResultView\n                      result={result}\n                      onOpenSource={handleOpenUrl}\n                      activeSourceId={activeSourceId}\n                      onActiveSourceChange={setActiveSourceId}\n                      onSaveForCompare={handleSaveForCompare}\n                      onShowCompare={() => setComparePanelOpen(true)}\n                      compareCount={compareEntries.length}\n                    />\n                    <ResearchGraphSection\n                      showGraph={showGraph}\n                      onToggleGraph={() => setShowGraph(prev => !prev)}\n                      query={result.query}\n                      queryKey={queryKey}\n                      graphData={graphData}\n                      activeSourceId={activeSourceId}\n                      onSelectSource={setActiveSourceId}\n                      onOpenSource={handleOpenUrl}\n                    />\n                  </div>\n                )}\n\n                {!loading && !result && !error && <EmptyState onRunExample={handleRunExample} />}\n              </div>\n            </section>\n\n            <InsightsSidebar\n              result={result}\n              loading={loading}\n              onOpenSource={handleOpenUrl}\n              activeSourceId={activeSourceId}\n              onSelectSource={setActiveSourceId}\n            />\n          </>\n        )}\n      </LayoutBody>\n      <CompareAnswersPanel\n        open={comparePanelOpen}\n        answers={compareEntries}\n        selectedIds={compareSelection}\n        onToggleSelect={handleToggleCompareSelection}\n        onClose={() => setComparePanelOpen(false)}\n        onRemove={handleRemoveCompare}\n      />\n      {cursorPanelOpen && (\n        <div className=\"fixed inset-y-0 right-0 z-50 flex w-96 flex-col border-l border-slate-700/70 bg-slate-900/95 shadow-2xl backdrop-blur-xl\">\n          <CursorChat\n            pageSnapshot={\n              activeId && tabs.find(t => t.id === activeId)\n                ? {\n                    url: tabs.find(t => t.id === activeId)?.url || '',\n                    title: tabs.find(t => t.id === activeId)?.title || '',\n                    html: undefined, // Could be enhanced to capture page HTML\n                  }\n                : undefined\n            }\n            onClose={() => setCursorPanelOpen(false)}\n          />\n        </div>\n      )}\n    </LayoutEngine>\n    </>\n  );\n}\n\ntype RegionOption = 'global' | 'us' | 'uk' | 'eu' | 'asia' | 'custom';\n\nconst REGION_OPTIONS: Array<{ value: RegionOption; label: string }> = [\n  { value: 'global', label: 'Global' },\n  { value: 'us', label: 'United States' },\n  { value: 'uk', label: 'United Kingdom' },\n  { value: 'eu', label: 'Europe' },\n  { value: 'asia', label: 'Asia Pacific' },\n];\n\ninterface ResearchControlsProps {\n  authorityBias: number;\n  includeCounterpoints: boolean;\n  region: RegionOption;\n  loading: boolean;\n  onAuthorityBiasChange(value: number): void;\n  onIncludeCounterpointsChange(value: boolean): void;\n  onRegionChange(value: RegionOption): void;\n  deepScanEnabled: boolean;\n  onDeepScanToggle(value: boolean): void;\n}\n\nfunction ResearchControls({\n  authorityBias,\n  includeCounterpoints,\n  region,\n  loading,\n  onAuthorityBiasChange,\n  onIncludeCounterpointsChange,\n  onRegionChange,\n  deepScanEnabled,\n  onDeepScanToggle,\n}: ResearchControlsProps) {\n  return (\n    <div className=\"grid gap-4 rounded-2xl border border-white/10 bg-white/[0.04] px-5 py-4 text-xs text-gray-200 shadow-inner shadow-black/30 sm:grid-cols-[minmax(0,_1fr)_auto_auto]\">\n      <div className=\"space-y-2\">\n        <span className=\"text-[11px] font-semibold uppercase tracking-wide text-gray-400\">\n          Recency vs authority\n        </span>\n        <div className=\"flex items-center gap-3\">\n          <span className=\"text-[11px] text-gray-500\">Recency</span>\n          <div className=\"relative flex-1\">\n            <input\n              type=\"range\"\n              min={0}\n              max={100}\n              value={authorityBias}\n              disabled={loading}\n              onChange={e => onAuthorityBiasChange(Number(e.target.value))}\n              className=\"h-1 w-full cursor-pointer accent-blue-500 disabled:opacity-40\"\n            />\n          </div>\n          <span className=\"text-[11px] text-gray-500\">Authority</span>\n          <span className=\"rounded border border-blue-500/40 bg-blue-500/10 px-2 py-0.5 text-[11px] text-blue-200\">\n            {authorityBias}%\n          </span>\n        </div>\n      </div>\n\n      <label className=\"flex items-center gap-2 rounded-lg border border-white/5 bg-white/5 px-3 py-2 text-[11px]\">\n        <input\n          type=\"checkbox\"\n          className=\"h-3.5 w-3.5 rounded border-white/20 bg-transparent text-blue-500 focus:ring-blue-500 disabled:opacity-40\"\n          checked={includeCounterpoints}\n          disabled={loading}\n          onChange={e => onIncludeCounterpointsChange(e.target.checked)}\n        />\n        Include counterpoints\n      </label>\n\n      <label className=\"flex items-center gap-2 rounded-lg border border-white/5 bg-white/5 px-3 py-2 text-[11px]\">\n        Region\n        <select\n          value={region}\n          disabled={loading}\n          onChange={e => onRegionChange(e.target.value as RegionOption)}\n          className=\"rounded border border-white/10 bg-[#0c0e18] px-2 py-1 text-[11px] text-gray-200 focus:border-blue-500 focus:outline-none focus:ring-0 disabled:opacity-40\"\n        >\n          {REGION_OPTIONS.map(option => (\n            <option key={option.value} value={option.value}>\n              {option.label}\n            </option>\n          ))}\n        </select>\n      </label>\n\n      <label className=\"flex items-center gap-2 rounded-lg border border-indigo-500/40 bg-indigo-500/10 px-3 py-2 text-[11px] text-indigo-100 sm:col-span-3\">\n        <input\n          type=\"checkbox\"\n          className=\"h-3.5 w-3.5 rounded border-indigo-400/60 bg-transparent text-indigo-300 focus:ring-indigo-400 disabled:opacity-40\"\n          checked={deepScanEnabled}\n          disabled={loading}\n          onChange={e => onDeepScanToggle(e.target.checked)}\n        />\n        <div className=\"flex flex-col gap-0.5\">\n          <span className=\"text-[11px] font-semibold uppercase tracking-wide\">Deep scan</span>\n          <span className=\"text-[11px] text-indigo-200/80\">\n            Analyze multiple pages with scraper context ({deepScanEnabled ? 'on' : 'off'})\n          </span>\n        </div>\n      </label>\n    </div>\n  );\n}\n\nfunction DeepScanStatus({\n  loading,\n  steps,\n  error,\n}: {\n  loading: boolean;\n  steps: DeepScanStep[];\n  error: string | null;\n}) {\n  return (\n    <div className=\"rounded-2xl border border-indigo-500/30 bg-indigo-500/5 px-4 py-3 text-xs text-indigo-100\">\n      <div className=\"mb-2 flex items-center justify-between\">\n        <div>\n          <p className=\"text-[11px] uppercase tracking-wide text-indigo-200\">Deep scan progress</p>\n          <p className=\"text-[11px] text-indigo-200/70\">\n            {steps.length > 0\n              ? `${steps.length} checkpoints recorded`\n              : 'Preparing sources via scraper'}\n          </p>\n        </div>\n        {loading && (\n          <Skeleton variant=\"circular\" width={16} height={16} className=\"animate-pulse\" />\n        )}\n      </div>\n      {error && (\n        <p className=\"mb-2 rounded-lg border border-red-500/40 bg-red-500/10 px-3 py-1 text-red-200\">\n          {error}\n        </p>\n      )}\n      <ol className=\"space-y-1 text-[11px] text-indigo-100/90\">\n        {(steps.length > 0\n          ? steps\n          : [\n              {\n                label: 'Gathering sources',\n                status: loading ? 'running' : 'complete',\n                started_at: '',\n                completed_at: '',\n              },\n            ]\n        ).map((step, idx) => (\n          <li\n            key={`${step.label}-${idx}`}\n            className=\"rounded border border-indigo-500/20 px-3 py-1\"\n          >\n            <span className=\"font-semibold\">{step.label}</span>\n            <span className=\"ml-2 text-indigo-200/70\">{step.status}</span>\n            {step.detail && <span className=\"ml-2 text-indigo-200/70\">{step.detail}</span>}\n          </li>\n        ))}\n      </ol>\n    </div>\n  );\n}\n\ninterface ResearchResultViewProps {\n  result: ResearchResult;\n  activeSourceId: string | null;\n  onActiveSourceChange(sourceKey: string): void;\n  onOpenSource(url: string): void;\n  onSaveForCompare(): void;\n  onShowCompare(): void;\n  compareCount: number;\n}\n\nfunction ResearchResultView({\n  result,\n  activeSourceId,\n  onActiveSourceChange,\n  onOpenSource,\n  onSaveForCompare,\n  onShowCompare,\n  compareCount,\n}: ResearchResultViewProps) {\n  const confidencePercent = Math.round(result.confidence * 100);\n  const verification = result.verification;\n  const getSourceKey = (sourceIndex: number) => {\n    const source = result.sources[sourceIndex];\n    return source?.url ?? `source-${sourceIndex}`;\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <section className=\"rounded-2xl border border-white/5 bg-white/5 px-6 py-5 shadow-inner shadow-black/30\">\n        <header className=\"mb-4 flex flex-wrap items-center justify-between gap-3\">\n          <div>\n            <h2 className=\"text-base font-semibold text-white\">AI answer with citations</h2>\n            <p className=\"text-xs text-gray-400\">\n              {result.sources.length} sources considered  Confidence {confidencePercent}%\n            </p>\n          </div>\n          <div className=\"flex flex-wrap items-center gap-2\">\n            {verification && (\n              <span\n                className={`rounded-full px-3 py-1 text-xs font-medium ${\n                  verification.verified\n                    ? 'border border-emerald-500/50 bg-emerald-500/10 text-emerald-200'\n                    : 'border border-amber-500/50 bg-amber-500/10 text-amber-200'\n                }`}\n              >\n                {verification.verified ? 'Verified' : 'Needs review'}\n              </span>\n            )}\n            <button\n              type=\"button\"\n              onClick={onSaveForCompare}\n              className=\"inline-flex items-center gap-1 rounded-full border border-white/15 px-3 py-1 text-xs text-gray-200 hover:border-white/40\"\n            >\n              Save for compare\n            </button>\n            <button\n              type=\"button\"\n              onClick={onShowCompare}\n              className=\"inline-flex items-center gap-1 rounded-full border border-sky-500/40 bg-sky-500/10 px-3 py-1 text-xs text-sky-100 hover:border-sky-400/70\"\n            >\n              Open compare ({compareCount})\n            </button>\n          </div>\n        </header>\n        <AnswerWithCitations\n          summary={result.summary}\n          citations={result.citations}\n          inlineEvidence={result.inlineEvidence}\n          sources={result.sources}\n          activeSourceId={activeSourceId}\n          onActivate={sourceKey => {\n            onActiveSourceChange(sourceKey);\n            // Find evidence for this source\n            const sourceIndex = result.sources.findIndex(\n              s => (s.url ?? `source-${result.sources.indexOf(s)}`) === sourceKey\n            );\n            if (sourceIndex !== -1) {\n              const evidence = result.evidence?.find(e => e.sourceIndex === sourceIndex);\n              if (evidence) {\n                setActiveEvidenceId(evidence.id);\n              }\n            }\n          }}\n          onOpenSource={onOpenSource}\n          onExport={async format => {\n            try {\n              if (format === 'markdown') {\n                let markdown = `# Research: ${result.query}\\n\\n`;\n                markdown += `## Summary\\n\\n${result.summary}\\n\\n`;\n                markdown += `## Citations\\n\\n`;\n                result.citations.forEach(c => {\n                  const source = result.sources[c.sourceIndex];\n                  markdown += `[${c.index}] **${source?.title || 'Unknown'}**\\n`;\n                  markdown += `  - URL: ${source?.url || ''}\\n`;\n                  markdown += `  - Domain: ${source?.domain || ''}\\n`;\n                  markdown += `  - Confidence: ${(c.confidence * 100).toFixed(0)}%\\n`;\n                  if (c.quote) {\n                    markdown += `  - Quote: \"${c.quote}\"\\n`;\n                  }\n                  markdown += `\\n`;\n                });\n                markdown += `## Sources\\n\\n`;\n                result.sources.forEach((s, idx) => {\n                  markdown += `${idx + 1}. **[${s.title}](${s.url})** - ${s.domain}\\n`;\n                  if (s.snippet) {\n                    markdown += `   ${s.snippet}\\n`;\n                  }\n                  markdown += `\\n`;\n                });\n                const blob = new Blob([markdown], { type: 'text/markdown' });\n                const url = URL.createObjectURL(blob);\n                const a = document.createElement('a');\n                a.href = url;\n                a.download = `research-${Date.now()}.md`;\n                a.click();\n                URL.revokeObjectURL(url);\n              } else {\n                // PDF export via IPC\n                await ipc.research.export({\n                  format: 'markdown', // PDF would require backend support\n                  sources: result.sources.map(s => s.url),\n                  includeNotes: true,\n                });\n              }\n            } catch (error) {\n              console.error('Export failed:', error);\n            }\n          }}\n        />\n\n        {result.citations.length > 0 && (\n          <div className=\"mt-5 rounded-xl border border-white/5 bg-[#1a1d2a] px-4 py-3\">\n            <h3 className=\"mb-2 text-[11px] font-semibold uppercase tracking-wide text-gray-400\">\n              Citations\n            </h3>\n            <ul className=\"space-y-2\">\n              {result.citations.map(citation => {\n                const source = result.sources[citation.sourceIndex];\n                const sourceKey = getSourceKey(citation.sourceIndex);\n                const isActive = activeSourceId === sourceKey;\n                if (!source) return null;\n                return (\n                  <li\n                    key={citation.index}\n                    className={`rounded-lg border px-3 py-2 text-xs transition-colors ${\n                      isActive\n                        ? 'border-blue-500/40 bg-blue-500/10 text-blue-100'\n                        : 'border-white/5 bg-white/[0.02] text-gray-300 hover:border-blue-400/40 hover:bg-blue-400/5'\n                    }`}\n                  >\n                    <button\n                      className=\"font-semibold text-indigo-300 hover:text-indigo-200\"\n                      onClick={() => {\n                        onActiveSourceChange(sourceKey);\n                        onOpenSource(source.url);\n                      }}\n                    >\n                      [{citation.index}] {source.title}\n                    </button>\n                    <div className=\"text-[11px] text-gray-500\">\n                      Confidence {(citation.confidence * 100).toFixed(0)}%  {source.domain}\n                    </div>\n                  </li>\n                );\n              })}\n            </ul>\n          </div>\n        )}\n      </section>\n\n      {verification && <VerificationSummary verification={verification} />}\n\n      <SourcesList\n        sources={result.sources}\n        activeSourceId={activeSourceId}\n        onActivate={onActiveSourceChange}\n        onOpenSource={onOpenSource}\n      />\n    </div>\n  );\n}\n\nconst importanceLabel = {\n  high: 'Critical evidence',\n  medium: 'Supporting evidence',\n  low: 'Context',\n} as const;\n\nfunction InsightsSidebar({\n  result,\n  loading,\n  onOpenSource,\n  activeSourceId,\n  onSelectSource,\n}: {\n  result: ResearchResult | null;\n  loading: boolean;\n  onOpenSource(url: string): void;\n  activeSourceId: string | null;\n  onSelectSource(sourceKey: string): void;\n}) {\n  if (loading) {\n    return (\n      <aside className=\"w-[310px] shrink-0 space-y-4 overflow-y-auto rounded-2xl border border-white/5 bg-[#0f1220] p-4 shadow-inner shadow-black/50\">\n        <div className=\"h-20 animate-pulse rounded-xl bg-white/5\" />\n        <div className=\"h-32 animate-pulse rounded-xl bg-white/5\" />\n        <div className=\"h-32 animate-pulse rounded-xl bg-white/5\" />\n      </aside>\n    );\n  }\n\n  if (!result) {\n    return (\n      <aside className=\"w-[310px] shrink-0 overflow-y-auto rounded-2xl border border-white/5 bg-[#0f1220] p-5 shadow-inner shadow-black/50\">\n        <div className=\"space-y-4 text-sm text-gray-400\">\n          <div className=\"rounded-xl border border-white/10 bg-white/[0.03] px-3 py-2 text-xs text-gray-300\">\n            <p className=\"flex items-center gap-2 text-gray-200\">\n              <Sparkles size={14} className=\"text-blue-300\" />\n              Try questions that need multiple independent sources.\n            </p>\n          </div>\n          <EmptyState\n            onRunExample={onSelectSource as unknown as (example: string) => void}\n            minimal\n          />\n        </div>\n      </aside>\n    );\n  }\n\n  const topEvidence = (result.evidence ?? []).slice(0, 3);\n  const contradictions = (result.contradictions ?? []).slice(0, 2);\n  const activeEvidenceKey = activeSourceId;\n\n  return (\n    <aside className=\"w-[310px] shrink-0 space-y-4 overflow-y-auto rounded-2xl border border-white/5 bg-[#0f1220] p-5 shadow-inner shadow-black/50\">\n      <div className=\"space-y-2 rounded-xl border border-white/10 bg-white/[0.04] px-4 py-3\">\n        <div className=\"flex items-center justify-between text-xs text-gray-400\">\n          <span>Confidence</span>\n          <span className=\"text-sm font-semibold text-blue-200\">\n            {(result.confidence * 100).toFixed(0)}%\n          </span>\n        </div>\n        <div className=\"h-1.5 w-full overflow-hidden rounded bg-white/10\">\n          <div\n            className=\"h-full rounded bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500\"\n            style={{ width: `${Math.min(100, Math.max(0, result.confidence * 100))}%` }}\n          />\n        </div>\n        <p className=\"text-[11px] text-gray-500\">\n          {result.sources.length} vetted sources  {result.citations.length} inline citations\n        </p>\n        <button\n          className=\"inline-flex items-center gap-2 rounded border border-white/10 bg-white/[0.03] px-2 py-1 text-[11px] text-gray-300 hover:border-blue-400/40 hover:text-blue-200\"\n          onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}\n        >\n          <RefreshCcw size={12} />\n          Adjust research settings\n        </button>\n      </div>\n\n      {topEvidence.length > 0 && (\n        <div className=\"space-y-3 rounded-xl border border-blue-500/20 bg-blue-500/[0.07] px-4 py-3\">\n          <div className=\"flex items-center justify-between gap-2 text-xs text-blue-100\">\n            <span className=\"font-semibold uppercase tracking-wide\">Key evidence</span>\n            <span>\n              {topEvidence.length} of {(result.evidence ?? []).length}\n            </span>\n          </div>\n          <div className=\"space-y-2 text-xs text-blue-100/90\">\n            {topEvidence.map(item => {\n              const source = result.sources[item.sourceIndex];\n              if (!source) return null;\n              const sourceKey = source.url ?? `source-${item.sourceIndex}`;\n              const isActive = activeEvidenceKey === sourceKey;\n              return (\n                <button\n                  key={item.id}\n                  onClick={() => {\n                    onSelectSource(sourceKey);\n                    onOpenSource(item.fragmentUrl || source.url);\n                  }}\n                  className={`w-full rounded-lg border px-3 py-2 text-left transition-colors ${\n                    isActive\n                      ? 'border-blue-300 bg-blue-400/20'\n                      : 'border-blue-400/30 hover:bg-blue-400/15'\n                  }`}\n                >\n                  <div className=\"flex items-center justify-between gap-2 text-[10px] uppercase tracking-wide text-blue-200/80\">\n                    <span>{importanceLabel[item.importance]}</span>\n                    <span>{source.domain}</span>\n                  </div>\n                  <p className=\"mt-1 line-clamp-3 text-[11px] text-blue-50/90\">{item.quote}</p>\n                </button>\n              );\n            })}\n          </div>\n        </div>\n      )}\n\n      {contradictions.length > 0 && (\n        <div className=\"space-y-2 rounded-xl border border-amber-500/20 bg-amber-500/[0.07] px-4 py-3\">\n          <div className=\"flex items-center justify-between text-xs text-amber-100\">\n            <span className=\"font-semibold uppercase tracking-wide\">Contradictions</span>\n            <span>{contradictions.length}</span>\n          </div>\n          <ul className=\"space-y-2 text-[11px] text-amber-50/90\">\n            {contradictions.map((item, index) => {\n              const severity = item.disagreement === 'major' ? 'Major' : 'Minor';\n              return (\n                <li\n                  key={`${item.claim}-${index}`}\n                  className=\"rounded-lg border border-amber-400/30 bg-amber-500/10 p-3\"\n                >\n                  <div className=\"flex items-center justify-between gap-2\">\n                    <span className=\"font-semibold text-amber-100\">{item.claim}</span>\n                    <span className=\"text-amber-200\">{severity}</span>\n                  </div>\n                  <p className=\"mt-1 text-amber-100/70\">\n                    {item.summary || 'Investigate differing positions.'}\n                  </p>\n                  <button\n                    onClick={() => {\n                      const firstSource = item.sources[0];\n                      if (typeof firstSource === 'number') {\n                        const source = result.sources[firstSource];\n                        if (source) {\n                          onSelectSource(source.url ?? `source-${firstSource}`);\n                          onOpenSource(source.url);\n                        }\n                      }\n                    }}\n                    className=\"mt-2 inline-flex items-center gap-1 text-[11px] text-amber-200 hover:text-amber-100\"\n                  >\n                    View sources\n                    <ChevronRight size={12} />\n                  </button>\n                </li>\n              );\n            })}\n          </ul>\n        </div>\n      )}\n\n      {result.biasProfile && (\n        <div className=\"space-y-2 rounded-xl border border-sky-500/20 bg-sky-500/[0.06] px-4 py-3 text-xs text-sky-100\">\n          <div className=\"flex items-center justify-between\">\n            <span className=\"font-semibold uppercase tracking-wide\">Bias snapshot</span>\n            <span>{result.biasProfile.authorityBias}% authority</span>\n          </div>\n          <div className=\"h-1.5 w-full overflow-hidden rounded bg-sky-500/20\">\n            <div\n              className=\"h-full bg-gradient-to-r from-sky-500 via-blue-500 to-purple-500\"\n              style={{ width: `${result.biasProfile.authorityBias}%` }}\n            />\n          </div>\n          <div className=\"space-y-1 pt-2\">\n            {result.biasProfile.domainMix.slice(0, 3).map(entry => (\n              <div key={entry.type} className=\"flex items-center justify-between text-[11px]\">\n                <span>{capitalize(entry.type)}</span>\n                <span>{entry.percentage}%</span>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {result.taskChains && result.taskChains.length > 0 && (\n        <div className=\"space-y-2 rounded-xl border border-purple-500/20 bg-purple-500/[0.07] px-4 py-3\">\n          <div className=\"flex items-center justify-between text-xs text-purple-100\">\n            <span className=\"font-semibold uppercase tracking-wide\">Next checks</span>\n            <span>{result.taskChains.length}</span>\n          </div>\n          <ol className=\"space-y-2 text-[11px] text-purple-50/80\">\n            {result.taskChains\n              .flatMap(chain => chain.steps)\n              .filter(step => step.status !== 'done')\n              .slice(0, 3)\n              .map(step => (\n                <li\n                  key={step.id}\n                  className=\"rounded-lg border border-purple-400/30 bg-purple-400/10 px-3 py-2\"\n                >\n                  <span className=\"font-semibold text-purple-100\">{step.title}</span>\n                  <p className=\"text-purple-100/70\">{step.description}</p>\n                </li>\n              ))}\n          </ol>\n        </div>\n      )}\n\n      {/* Tier 2: OmniAgent Input */}\n      <OmniAgentInput\n        currentUrl={\n          activeId && tabs.find(t => t.id === activeId)\n            ? tabs.find(t => t.id === activeId)?.url\n            : undefined\n        }\n        onResult={result => {\n          // Display result in a toast or add to research results\n          console.log('OmniAgent result:', result);\n        }}\n      />\n    </aside>\n  );\n}\n\nfunction ActiveContainerBadge({\n  containers,\n  activeContainerId,\n}: {\n  containers: ContainerInfo[];\n  activeContainerId: string;\n}) {\n  const activeContainer =\n    containers.find(container => container.id === activeContainerId) ??\n    containers.find(container => container.id === 'default');\n\n  if (!activeContainer) {\n    return null;\n  }\n\n  return (\n    <div className=\"flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1.5 text-xs text-gray-200 shadow-inner shadow-black/20\">\n      <span\n        className=\"h-2.5 w-2.5 rounded-full\"\n        style={{ backgroundColor: activeContainer.color ?? '#6366f1' }}\n      />\n      <span className=\"font-medium\">{activeContainer.name}</span>\n      <span className=\"text-[10px] uppercase tracking-wide text-gray-400\">\n        {capitalize(activeContainer.scope ?? 'session')}\n      </span>\n    </div>\n  );\n}\n\nfunction EmptyState({\n  onRunExample,\n  minimal = false,\n}: {\n  onRunExample: (example: string) => void;\n  minimal?: boolean;\n}) {\n  const [detectedLang, setDetectedLang] = useState<string>('en');\n  const [langConfidence, setLangConfidence] = useState<number>(0);\n\n  useEffect(() => {\n    // Auto-detect language from browser/system\n    const detectUserLanguage = async () => {\n      try {\n        const result = await detectLanguage(navigator.language || 'en');\n        setDetectedLang(result.language);\n        setLangConfidence(result.confidence);\n      } catch {\n        // Fallback to English\n        setDetectedLang('en');\n      }\n    };\n    void detectUserLanguage();\n  }, []);\n\n  // Multilingual examples based on detected language\n  const examples = useMemo(() => {\n    if (detectedLang === 'hi') {\n      return [\n        'Nifty vs BankNifty   ',\n        'iPhone vs Samsung   ',\n        '  AI   ',\n      ];\n    } else if (detectedLang === 'ta') {\n      return [\n        'Nifty vs BankNifty ',\n        'iPhone vs Samsung ',\n        ' AI  ',\n      ];\n    }\n    return [\n      'Compare Nifty vs BankNifty',\n      'Compare iPhone vs Samsung',\n      'Summarize AI regulations in India',\n    ];\n  }, [detectedLang]);\n\n  const welcomeText = useMemo(() => {\n    if (detectedLang === 'hi') {\n      return {\n        title: 'Research Mode    ',\n        subtitle: '//  : \"Nifty vs BankNifty   \"',\n        button: ' ',\n      };\n    } else if (detectedLang === 'ta') {\n      return {\n        title: 'Research Mode ',\n        subtitle: '// : \"Nifty vs BankNifty \"',\n        button: ' ',\n      };\n    }\n    return {\n      title: 'Welcome to Research Mode',\n      subtitle: 'Ask in Hindi/Tamil/English: \"Compare Nifty vs BankNifty\"',\n      button: 'Try Example',\n    };\n  }, [detectedLang]);\n\n  if (minimal) {\n    return (\n      <ul className=\"space-y-2 text-xs text-gray-400\">\n        {examples.slice(0, 2).map(example => (\n          <li key={example}>\n            <button\n              className=\"text-left text-gray-300 hover:text-blue-200\"\n              onClick={() => onRunExample(example)}\n            >\n              {example}\n            </button>\n          </li>\n        ))}\n      </ul>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-1 flex-col items-center justify-center gap-6 rounded-2xl bg-gradient-to-br from-purple-900/40 via-blue-900/40 to-purple-900/40 px-10 py-16 text-center\">\n      <motion.div\n        initial={{ scale: 0.9, opacity: 0 }}\n        animate={{ scale: 1, opacity: 1 }}\n        transition={{ duration: 0.3 }}\n        className=\"flex h-16 w-16 items-center justify-center rounded-full border-2 border-white/20 bg-white/10 text-blue-300 shadow-lg\"\n      >\n        <Sparkles size={32} />\n      </motion.div>\n      <motion.div\n        initial={{ y: 10, opacity: 0 }}\n        animate={{ y: 0, opacity: 1 }}\n        transition={{ delay: 0.1, duration: 0.3 }}\n        className=\"space-y-3\"\n      >\n        <h1 className=\"text-3xl font-bold text-white\">{welcomeText.title}</h1>\n        <p className=\"max-w-md text-base text-gray-300\">{welcomeText.subtitle}</p>\n      </motion.div>\n      <motion.div\n        initial={{ y: 10, opacity: 0 }}\n        animate={{ y: 0, opacity: 1 }}\n        transition={{ delay: 0.2, duration: 0.3 }}\n        className=\"flex w-full max-w-md flex-col gap-3\"\n      >\n        {examples.map((example, idx) => (\n          <button\n            key={example}\n            onClick={() => onRunExample(example)}\n            className=\"group relative overflow-hidden rounded-xl border border-white/20 bg-white/10 px-6 py-4 text-left text-gray-200 transition-all hover:border-blue-400/60 hover:bg-blue-500/20 hover:shadow-lg hover:shadow-blue-500/20\"\n          >\n            <div className=\"relative z-10 flex items-center gap-3\">\n              <div className=\"flex h-8 w-8 items-center justify-center rounded-full bg-blue-500/20 text-blue-300\">\n                {idx + 1}\n              </div>\n              <span className=\"font-medium\">{example}</span>\n            </div>\n            <motion.div\n              className=\"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10\"\n              initial={{ x: '-100%' }}\n              whileHover={{ x: 0 }}\n              transition={{ duration: 0.3 }}\n            />\n          </button>\n        ))}\n        <button\n          onClick={() => onRunExample(examples[0])}\n          className=\"mt-2 rounded-xl bg-gradient-to-r from-blue-600 to-purple-600 px-6 py-3 font-bold text-white shadow-lg transition-all hover:from-blue-700 hover:to-purple-700 hover:shadow-xl\"\n        >\n          {welcomeText.button}\n        </button>\n      </motion.div>\n      {langConfidence > 0.5 && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          transition={{ delay: 0.4 }}\n          className=\"text-xs text-gray-400\"\n        >\n          Detected: {detectedLang.toUpperCase()} ({(langConfidence * 100).toFixed(0)}% confidence)\n        </motion.div>\n      )}\n    </div>\n  );\n}\n\nfunction SourcesList({\n  sources,\n  activeSourceId,\n  onActivate,\n  onOpenSource,\n}: {\n  sources: ResearchSource[];\n  activeSourceId: string | null;\n  onActivate(sourceKey: string): void;\n  onOpenSource(url: string): void;\n}) {\n  if (!sources || sources.length === 0) return null;\n\n  const providerCounts = sources.reduce<Record<string, number>>((acc, source) => {\n    const provider =\n      typeof source.metadata?.provider === 'string' ? source.metadata.provider.toLowerCase() : '';\n    if (!provider) return acc;\n    acc[provider] = (acc[provider] ?? 0) + 1;\n    return acc;\n  }, {});\n\n  const providerSummary =\n    Object.entries(providerCounts)\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 3)\n      .map(([provider, count]) => `${formatProviderName(provider)} (${count})`)\n      .join('  ') || 'Ranked by relevance & consensus';\n\n  return (\n    <section className=\"rounded-2xl border border-white/10 bg-white/[0.03] p-4\">\n      <header className=\"mb-4 flex flex-wrap items-center justify-between gap-2\">\n        <div>\n          <h3 className=\"text-sm font-semibold text-white\">Sources ({sources.length})</h3>\n          <p className=\"text-xs text-gray-500\">{providerSummary}</p>\n        </div>\n      </header>\n      <div className=\"flex flex-col gap-3\">\n        {sources.map((source, idx) => {\n          const sourceKey = source.url ?? `source-${idx}`;\n          return (\n            <SourceCard\n              key={source.url || idx}\n              source={source}\n              index={idx}\n              isActive={activeSourceId === sourceKey}\n              onActivate={onActivate}\n              onOpen={onOpenSource}\n            />\n          );\n        })}\n      </div>\n    </section>\n  );\n}\n\nconst NEWS_DOMAIN_HINTS = [\n  'nytimes',\n  'cnn',\n  'bbc',\n  'guardian',\n  'reuters',\n  'bloomberg',\n  'apnews',\n  'wsj',\n  'cnbc',\n  'financialtimes',\n  'washingtonpost',\n];\n\nconst FORUM_DOMAIN_HINTS = [\n  'reddit',\n  'stack',\n  'stackoverflow',\n  'stackexchange',\n  'discord',\n  'forum',\n  'forums',\n  'quora',\n  'medium',\n];\n\nconst DOCUMENTATION_DOMAIN_HINTS = [\n  'docs',\n  'developer',\n  'dev.',\n  'api.',\n  'learn.',\n  'support.',\n  'help.',\n  'manual',\n  'reference',\n  'wikipedia',\n  'wiki',\n  'kubernetes',\n  'cloud.google',\n  'learn.microsoft',\n];\n\nfunction mapMultiSourceResultToSource(hit: MultiSourceSearchResult, idx: number): ResearchSource {\n  const domain = hit.domain || extractDomain(hit.url);\n  const provider = typeof hit.source === 'string' ? hit.source : 'web';\n  const sourceType = inferSourceType(domain, provider);\n  const baseScore = Number.isFinite(hit.score) ? hit.score : 0.62;\n  const extendedMeta = (hit.metadata || {}) as { timestamp?: number; dateLastCrawled?: string };\n  const parsedTimestamp =\n    typeof extendedMeta.timestamp === 'number'\n      ? extendedMeta.timestamp\n      : typeof extendedMeta.dateLastCrawled === 'string'\n        ? Date.parse(extendedMeta.dateLastCrawled)\n        : undefined;\n\n  return {\n    id: `multi-${idx}-${provider}`,\n    title: hit.title,\n    url: hit.url,\n    domain,\n    snippet: hit.snippet || '',\n    text: hit.snippet || hit.title,\n    type: sourceType,\n    sourceType,\n    relevanceScore: Math.round(Math.max(0.45, baseScore) * 100),\n    timestamp: Number.isFinite(parsedTimestamp) ? parsedTimestamp : Date.now(),\n    metadata: {\n      provider,\n      rawScore: hit.score,\n      ...hit.metadata,\n    },\n  };\n}\n\nfunction mapDeepScanSourceToResearchSource(source: DeepScanSource, idx: number): ResearchSource {\n  const domain = source.domain || extractDomain(source.url);\n  const sourceType = inferSourceType(domain);\n  return {\n    id: source.id || `deep-${idx}`,\n    title: source.title || source.url || `Deep scan source ${idx + 1}`,\n    url: source.url || '',\n    domain: domain || 'deep-scan',\n    snippet: source.snippet || '',\n    text: source.text || source.snippet || '',\n    type: sourceType,\n    sourceType,\n    relevanceScore: source.relevanceScore ?? 80 - idx * 2,\n    metadata: {\n      ...(source.metadata || {}),\n      provider: 'deep-scan',\n    },\n    image: source.image,\n    wordCount: source.wordCount,\n    lang: source.lang,\n    contentHash: source.contentHash,\n    fromCache: source.fromCache,\n    rendered: source.rendered,\n    fetchedAt: source.fetchedAt,\n  };\n}\n\nfunction inferSourceType(domain: string, provider?: string): ResearchSourceType {\n  const value = (domain || '').toLowerCase();\n  if (\n    value.endsWith('.edu') ||\n    value.includes('.ac.') ||\n    value.includes('arxiv') ||\n    value.includes('researchgate')\n  ) {\n    return 'academic';\n  }\n  if (value.endsWith('.gov') || value.includes('.gov.')) {\n    return 'documentation';\n  }\n  if (value && NEWS_DOMAIN_HINTS.some(hint => value.includes(hint))) {\n    return 'news';\n  }\n  if (value && FORUM_DOMAIN_HINTS.some(hint => value.includes(hint))) {\n    return 'forum';\n  }\n  if (value && DOCUMENTATION_DOMAIN_HINTS.some(hint => value.includes(hint))) {\n    return 'documentation';\n  }\n  if (!value && provider && provider.toLowerCase().includes('bing')) {\n    return 'news';\n  }\n  return 'other';\n}\n\nfunction dedupeResearchSources(sources: ResearchSource[]): ResearchSource[] {\n  const seen = new Set<string>();\n  return sources.filter(source => {\n    const key = source.url || `${source.domain}|${source.title}`;\n    if (!key) {\n      return true;\n    }\n    if (seen.has(key)) {\n      return false;\n    }\n    seen.add(key);\n    return true;\n  });\n}\n\nfunction normalizeSourceUrl(url?: string | null): string {\n  if (!url) return '';\n  return url.replace(/\\/+$/, '').toLowerCase();\n}\n\nfunction mergeScrapedSnapshots(\n  sources: ResearchSource[],\n  snapshots: ScrapedSourceResult[]\n): ResearchSource[] {\n  if (!snapshots || snapshots.length === 0) {\n    return sources;\n  }\n\n  const snapshotMap = new Map<string, ScrapedSourceResult>();\n  snapshots.forEach(snapshot => {\n    const candidates = [snapshot.finalUrl, snapshot.url].filter(Boolean) as string[];\n    candidates.forEach(candidate => {\n      snapshotMap.set(normalizeSourceUrl(candidate), snapshot);\n    });\n  });\n\n  return sources.map(source => {\n    const match =\n      snapshotMap.get(normalizeSourceUrl(source.url)) ||\n      snapshotMap.get(normalizeSourceUrl(source.metadata?.canonicalUrl as string));\n    if (!match) {\n      return source;\n    }\n    return {\n      ...source,\n      snippet: match.excerpt || source.snippet,\n      text: match.content || source.text || match.excerpt || source.snippet,\n      excerpt: match.excerpt || source.excerpt,\n      image: match.image || source.image,\n      contentHash: match.contentHash || source.contentHash,\n      wordCount: match.wordCount ?? source.wordCount,\n      lang: match.lang || source.lang,\n      fromCache: match.fromCache ?? source.fromCache,\n      rendered: match.rendered ?? source.rendered,\n      fetchedAt: match.fetchedAt || source.fetchedAt,\n      metadata: {\n        ...(source.metadata || {}),\n        ...(match.metadata || {}),\n      },\n    };\n  });\n}\n\nfunction extractDomain(url?: string): string {\n  if (!url) return '';\n  try {\n    return new URL(url).hostname.replace(/^www\\./, '');\n  } catch {\n    return '';\n  }\n}\n\nfunction formatProviderName(provider: string): string {\n  if (!provider) return 'web';\n  const normalized = provider.replace(/[-_]/g, ' ').trim();\n  if (!normalized) return 'web';\n  return normalized.charAt(0).toUpperCase() + normalized.slice(1);\n}\n\nfunction ResearchGraphSection({\n  showGraph,\n  onToggleGraph,\n  query,\n  queryKey,\n  graphData,\n  activeSourceId,\n  onSelectSource,\n  onOpenSource,\n}: {\n  showGraph: boolean;\n  onToggleGraph(): void;\n  query: string;\n  queryKey: string | null;\n  graphData: any;\n  activeSourceId: string | null;\n  onSelectSource(sourceKey: string): void;\n  onOpenSource(url: string): void;\n}) {\n  const hasGraphData =\n    graphData &&\n    Array.isArray(graphData.nodes) &&\n    graphData.nodes.some(\n      (node: any) => typeof node?.type === 'string' && node.type.startsWith('research-')\n    );\n\n  return (\n    <section className=\"rounded-2xl border border-white/10 bg-white/[0.03] px-4 py-4 shadow-inner shadow-black/20\">\n      <header className=\"mb-3 flex flex-wrap items-center justify-between gap-3\">\n        <div>\n          <h3 className=\"text-sm font-semibold text-white\">Knowledge graph</h3>\n          <p className=\"text-xs text-gray-400\">\n            Connections for {query.slice(0, 60)}\n            {query.length > 60 ? '' : ''} across sources and evidence.\n          </p>\n        </div>\n        <button\n          type=\"button\"\n          onClick={onToggleGraph}\n          className=\"rounded-lg border border-white/10 bg-white/10 px-3 py-1.5 text-xs text-gray-200 hover:border-blue-400/40 hover:text-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-400/40\"\n        >\n          {showGraph ? 'Hide graph' : 'Show graph'}\n        </button>\n      </header>\n      {showGraph ? (\n        <ResearchGraphView\n          query={query}\n          queryKey={queryKey}\n          graphData={graphData}\n          activeSourceId={activeSourceId}\n          onSelectSource={onSelectSource}\n          onOpenSource={onOpenSource}\n        />\n      ) : (\n        <div className=\"rounded-xl border border-dashed border-white/10 bg-white/[0.02] px-4 py-10 text-center text-xs text-gray-400\">\n          Graph hidden. Toggle Show graph to explore relationships again.\n        </div>\n      )}\n\n      {!hasGraphData && showGraph && (\n        <div className=\"mt-3 rounded-lg border border-white/10 bg-blue-500/5 px-3 py-2 text-[11px] text-blue-200\">\n          First research run captured. Subsequent questions will layer onto this graph for deeper\n          context.\n        </div>\n      )}\n    </section>\n  );\n}\n\ninterface VerificationSummaryProps {\n  verification: VerificationResult;\n}\n\nfunction VerificationSummary({ verification }: VerificationSummaryProps) {\n  if (!verification) return null;\n  return (\n    <section className=\"space-y-3 rounded border border-neutral-800 bg-neutral-900/40 p-4\">\n      <div className=\"flex flex-wrap items-center justify-between gap-2\">\n        <h3 className=\"text-sm font-semibold text-gray-200\">Verification summary</h3>\n        <span\n          className={`rounded border px-2 py-1 text-xs font-medium ${\n            verification.verified\n              ? 'border-emerald-500/40 bg-emerald-500/10 text-emerald-200'\n              : 'border-amber-500/40 bg-amber-500/10 text-amber-200'\n          }`}\n        >\n          {verification.verified ? 'Pass' : 'Review suggested'}\n        </span>\n      </div>\n\n      <div className=\"grid gap-3 text-xs text-gray-300 sm:grid-cols-4\">\n        <Metric\n          label=\"Claim density\"\n          value={`${verification.claimDensity.toFixed(1)} / 100 words`}\n        />\n        <Metric label=\"Citation coverage\" value={`${verification.citationCoverage.toFixed(0)}%`} />\n        <Metric\n          label=\"Hallucination risk\"\n          value={`${(verification.hallucinationRisk * 100).toFixed(0)}%`}\n        />\n        <Metric label=\"Ungrounded claims\" value={`${verification.ungroundedClaims.length}`} />\n      </div>\n\n      {verification.ungroundedClaims.length > 0 && (\n        <details className=\"rounded border border-amber-500/20 bg-amber-500/5 px-3 py-2 text-xs text-amber-200\">\n          <summary className=\"cursor-pointer font-semibold text-amber-300\">\n            Ungrounded claims ({verification.ungroundedClaims.length})\n          </summary>\n          <ul className=\"mt-2 space-y-1 text-[11px] text-amber-100\">\n            {verification.ungroundedClaims.map((claim, idx) => (\n              <li key={`${claim.position}-${idx}`}>\n                <span className=\"font-medium capitalize\">{claim.severity}</span>: {claim.text}\n              </li>\n            ))}\n          </ul>\n        </details>\n      )}\n\n      {verification.suggestions.length > 0 && (\n        <div className=\"space-y-1 text-xs text-gray-300\">\n          <h4 className=\"font-semibold text-gray-200\">Suggestions</h4>\n          <ul className=\"list-inside list-disc space-y-1 text-gray-400\">\n            {verification.suggestions.map((suggestion, idx) => (\n              <li key={`${suggestion}-${idx}`}>{suggestion}</li>\n            ))}\n          </ul>\n        </div>\n      )}\n    </section>\n  );\n}\n\nfunction Metric({ label, value }: { label: string; value: string }) {\n  return (\n    <div className=\"flex flex-col gap-1 rounded border border-neutral-800 bg-neutral-950/60 p-3\">\n      <span className=\"text-[11px] uppercase tracking-wide text-gray-500\">{label}</span>\n      <span className=\"text-sm font-semibold text-gray-200\">{value}</span>\n    </div>\n  );\n}\n\nfunction normaliseMockSnippet(snippet: string): string {\n  if (!snippet) return '';\n  const cleaned = snippet.replace(/\\s+/g, ' ').trim();\n  if (!cleaned) return '';\n  const sentence = cleaned.charAt(0).toUpperCase() + cleaned.slice(1);\n  return /[.!?]$/.test(sentence) ? sentence : `${sentence}.`;\n}\n\nfunction composeMockSummary(\n  segments: Array<{ text: string; sourceIndex: number; quote: string }>,\n  sources: ResearchSource[]\n) {\n  let summaryBuilder = '';\n  const inlineEvidence: ResearchInlineEvidence[] = [];\n  const citations: ResearchResult['citations'] = [];\n  let cursor = 0;\n\n  segments.forEach((segment, idx) => {\n    const isNewParagraph = idx > 0 && idx % 2 === 0;\n    if (idx > 0) {\n      const separator = isNewParagraph ? '\\n\\n' : ' ';\n      summaryBuilder += separator;\n      cursor += separator.length;\n    }\n\n    const from = cursor;\n    summaryBuilder += segment.text;\n    const to = cursor + segment.text.length;\n    const citationIndex = idx + 1;\n\n    inlineEvidence.push({\n      from,\n      to,\n      citationIndex,\n      sourceIndex: segment.sourceIndex,\n      quote: segment.quote,\n    });\n\n    const source = sources[segment.sourceIndex];\n    const confidence = source\n      ? Math.min(1, Math.max(0.2, (source.relevanceScore || 40) / 80))\n      : 0.5;\n    citations.push({\n      index: citationIndex,\n      sourceIndex: segment.sourceIndex,\n      quote: segment.quote.slice(0, 140),\n      confidence,\n    });\n\n    cursor = to;\n  });\n\n  const summary = summaryBuilder.trim();\n  const uniqueSources = Array.from(new Set(segments.map(segment => segment.sourceIndex)));\n  const avgRelevance =\n    uniqueSources.reduce((acc, idx) => acc + (sources[idx]?.relevanceScore ?? 50), 0) /\n    Math.max(1, uniqueSources.length);\n  const confidence = Math.max(\n    0.35,\n    Math.min(1, (avgRelevance / 60) * Math.min(1, uniqueSources.length / 3))\n  );\n\n  return { summary, inlineEvidence, citations, confidence };\n}\n\nfunction generateMockResult(query: string): ResearchResult {\n  const mockSources: ResearchSource[] = [\n    {\n      url: 'https://example.com/research',\n      title: `Overview of ${query}`,\n      text: `Mock content discussing ${query}.`,\n      snippet: `A concise overview of ${query} with supporting context.`,\n      domain: 'example.com',\n      relevanceScore: 68,\n      sourceType: 'documentation',\n      type: 'documentation',\n      timestamp: Date.now() - 2 * 24 * 60 * 60 * 1000,\n    },\n    {\n      url: 'https://knowledge.example.org/article',\n      title: `In-depth analysis of ${query}`,\n      text: `Extended mock analysis for ${query}.`,\n      snippet: `Detailed analysis exploring key aspects of ${query}.`,\n      domain: 'knowledge.example.org',\n      relevanceScore: 72,\n      sourceType: 'academic',\n      type: 'academic',\n      timestamp: Date.now() - 5 * 24 * 60 * 60 * 1000,\n    },\n  ];\n\n  const segments = mockSources.map((source, idx) => ({\n    text: normaliseMockSnippet(source.snippet || source.text),\n    sourceIndex: idx,\n    quote: source.snippet || source.text.slice(0, 140),\n  }));\n\n  const { summary, inlineEvidence, citations, confidence } = composeMockSummary(\n    segments,\n    mockSources\n  );\n\n  const mockVerification: VerificationResult = {\n    verified: true,\n    claimDensity: 8.5,\n    citationCoverage: 92,\n    ungroundedClaims: [],\n    hallucinationRisk: 0.1,\n    suggestions: ['Mock verification successful.'],\n  };\n\n  return {\n    query,\n    sources: mockSources,\n    summary,\n    citations,\n    confidence,\n    verification: mockVerification,\n    inlineEvidence,\n  };\n}\n\nfunction simpleHash(input: string) {\n  let hash = 0;\n  for (let i = 0; i < input.length; i += 1) {\n    hash = (hash << 5) - hash + input.charCodeAt(i);\n    hash |= 0;\n  }\n  return Math.abs(hash).toString(36);\n}\n\nfunction buildQueryKey(query: string) {\n  return `research-query:${simpleHash(query.slice(0, 256))}`;\n}\n\nfunction buildSourceKey(source: ResearchSource, index: number) {\n  if (source?.url) return source.url;\n  return `research-source:${index}:${simpleHash(source?.title || String(index))}`;\n}\n\nfunction buildEvidenceKey(sourceKey: string, id: number) {\n  return `${sourceKey}#evidence:${id}`;\n}\n\nfunction capitalize(str: string): string {\n  if (!str || str.length === 0) return str;\n  return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();\n}\n"],"file":"mode-research-BclgCwOH.js"}