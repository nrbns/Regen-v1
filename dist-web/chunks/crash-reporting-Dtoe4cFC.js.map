{"version":3,"file":"crash-reporting-Dtoe4cFC.js","sources":["../../src/core/crash-reporting.ts"],"sourcesContent":["/**\n * Crash Reporting - Tier 3 Pillar 3\n * Capture and report errors with context\n */\n\nimport { log } from '../utils/logger';\nimport { useAppStore } from '../state/appStore';\nimport { useTabsStore } from '../state/tabsStore';\nimport { authService } from '../services/auth';\n\nexport type CrashReport = {\n  id: string;\n  error: {\n    message: string;\n    stack?: string;\n    name: string;\n  };\n  context: {\n    route?: string;\n    mode?: string;\n    tabCount?: number;\n    timestamp: number;\n    userAgent: string;\n    url?: string;\n  };\n  user?: {\n    id: string;\n  };\n  environment: {\n    platform: string;\n    version?: string;\n  };\n};\n\nclass CrashReporter {\n  private reports: CrashReport[] = [];\n  private enabled = true;\n  private maxReports = 50;\n\n  /**\n   * Initialize crash reporting\n   */\n  initialize(): void {\n    // Check user consent\n    const consent = localStorage.getItem('regen_crash_reporting_consent');\n    this.enabled = consent === 'true';\n\n    // Global error handler\n    window.addEventListener('error', event => {\n      this.captureError(event.error || new Error(event.message), {\n        filename: event.filename,\n        lineno: event.lineno,\n        colno: event.colno,\n      });\n    });\n\n    // Unhandled promise rejection handler\n    window.addEventListener('unhandledrejection', event => {\n      this.captureError(\n        event.reason instanceof Error ? event.reason : new Error(String(event.reason)),\n        {}\n      );\n    });\n\n    log.info('[CrashReporter] Initialized');\n  }\n\n  /**\n   * Capture an error\n   */\n  captureError(error: Error, additionalContext?: Record<string, unknown>): void {\n    if (!this.enabled) {\n      return;\n    }\n\n    const report: CrashReport = {\n      id: `crash-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,\n      error: {\n        message: error.message,\n        stack: error.stack,\n        name: error.name,\n      },\n      context: {\n        route: window.location.pathname,\n        mode: useAppStore.getState().mode,\n        tabCount: useTabsStore.getState().tabs.length,\n        timestamp: Date.now(),\n        userAgent: navigator.userAgent,\n        url: window.location.href,\n        ...additionalContext,\n      },\n      user: authService.getCurrentUser() ? { id: authService.getCurrentUser()!.id } : undefined,\n      environment: {\n        platform: navigator.platform,\n        version: (window as any).__OMNIBROWSER_VERSION__ || 'unknown',\n      },\n    };\n\n    this.reports.push(report);\n\n    // Keep only recent reports\n    if (this.reports.length > this.maxReports) {\n      this.reports = this.reports.slice(-this.maxReports);\n    }\n\n    // Log locally\n    log.error('[CrashReporter] Error captured:', report);\n\n    // Send to backend (async, don't block)\n    this.sendReport(report).catch(err => {\n      log.error('[CrashReporter] Failed to send report:', err);\n    });\n  }\n\n  /**\n   * Send report to backend\n   */\n  private async sendReport(report: CrashReport): Promise<void> {\n    try {\n      // TODO: Call backend API\n      // POST /api/crash\n      // For now, just log\n      log.info('[CrashReporter] Would send report:', report.id);\n\n      // Store locally for manual review\n      const stored = localStorage.getItem('regen_crash_reports');\n      const reports = stored ? JSON.parse(stored) : [];\n      reports.push(report);\n      localStorage.setItem('regen_crash_reports', JSON.stringify(reports.slice(-10))); // Keep last 10\n    } catch (error) {\n      log.error('[CrashReporter] Failed to send report:', error);\n    }\n  }\n\n  /**\n   * Check if crash reporting is enabled\n   */\n  isEnabled(): boolean {\n    return this.enabled;\n  }\n\n  /**\n   * Enable/disable crash reporting\n   */\n  setEnabled(enabled: boolean): void {\n    this.enabled = enabled;\n    localStorage.setItem('regen_crash_reporting_consent', String(enabled));\n    log.info('[CrashReporter]', enabled ? 'Enabled' : 'Disabled');\n  }\n\n  /**\n   * Get stored reports\n   */\n  getStoredReports(): CrashReport[] {\n    try {\n      const stored = localStorage.getItem('regen_crash_reports');\n      return stored ? JSON.parse(stored) : [];\n    } catch {\n      return [];\n    }\n  }\n\n  /**\n   * Clear stored reports\n   */\n  clearStoredReports(): void {\n    localStorage.removeItem('regen_crash_reports');\n    this.reports = [];\n  }\n}\n\n// Singleton instance\nexport const crashReporter = new CrashReporter();\n"],"names":["CrashReporter","__publicField","consent","event","log","error","additionalContext","report","useAppStore","useTabsStore","authService","err","stored","reports","enabled","crashReporter"],"mappings":"srBAkCA,MAAMA,CAAc,CAApB,aAAA,CACEC,EAAA,KAAQ,UAAyB,EAAC,EAClCA,EAAA,KAAQ,UAAU,EAAA,EAClBA,EAAA,KAAQ,aAAa,EAAA,CAAA,CAKrB,YAAmB,CAEjB,MAAMC,EAAU,aAAa,QAAQ,+BAA+B,EACpE,KAAK,QAAUA,IAAY,OAG3B,OAAO,iBAAiB,QAASC,GAAS,CACxC,KAAK,aAAaA,EAAM,OAAS,IAAI,MAAMA,EAAM,OAAO,EAAG,CACzD,SAAUA,EAAM,SAChB,OAAQA,EAAM,OACd,MAAOA,EAAM,KAAA,CACd,CACH,CAAC,EAGD,OAAO,iBAAiB,qBAAsBA,GAAS,CACrD,KAAK,aACHA,EAAM,kBAAkB,MAAQA,EAAM,OAAS,IAAI,MAAM,OAAOA,EAAM,MAAM,CAAC,EAC7E,CAAA,CAAC,CAEL,CAAC,EAEDC,EAAI,KAAK,6BAA6B,CACxC,CAKA,aAAaC,EAAcC,EAAmD,CAC5E,GAAI,CAAC,KAAK,QACR,OAGF,MAAMC,EAAsB,CAC1B,GAAI,SAAS,KAAK,IAAA,CAAK,IAAI,KAAK,OAAA,EAAS,SAAS,EAAE,EAAE,MAAM,EAAG,CAAC,CAAC,GACjE,MAAO,CACL,QAASF,EAAM,QACf,MAAOA,EAAM,MACb,KAAMA,EAAM,IAAA,EAEd,QAAS,CACP,MAAO,OAAO,SAAS,SACvB,KAAMG,EAAY,SAAA,EAAW,KAC7B,SAAUC,EAAa,SAAA,EAAW,KAAK,OACvC,UAAW,KAAK,IAAA,EAChB,UAAW,UAAU,UACrB,IAAK,OAAO,SAAS,KACrB,GAAGH,CAAA,EAEL,KAAMI,EAAY,eAAA,EAAmB,CAAE,GAAIA,EAAY,eAAA,EAAkB,EAAA,EAAO,OAChF,YAAa,CACX,SAAU,UAAU,SACpB,QAAU,OAAe,yBAA2B,SAAA,CACtD,EAGF,KAAK,QAAQ,KAAKH,CAAM,EAGpB,KAAK,QAAQ,OAAS,KAAK,aAC7B,KAAK,QAAU,KAAK,QAAQ,MAAM,CAAC,KAAK,UAAU,GAIpDH,EAAI,MAAM,kCAAmCG,CAAM,EAGnD,KAAK,WAAWA,CAAM,EAAE,MAAMI,GAAO,CACnCP,EAAI,MAAM,yCAA0CO,CAAG,CACzD,CAAC,CACH,CAKA,MAAc,WAAWJ,EAAoC,CAC3D,GAAI,CAIFH,EAAI,KAAK,qCAAsCG,EAAO,EAAE,EAGxD,MAAMK,EAAS,aAAa,QAAQ,qBAAqB,EACnDC,EAAUD,EAAS,KAAK,MAAMA,CAAM,EAAI,CAAA,EAC9CC,EAAQ,KAAKN,CAAM,EACnB,aAAa,QAAQ,sBAAuB,KAAK,UAAUM,EAAQ,MAAM,GAAG,CAAC,CAAC,CAChF,OAASR,EAAO,CACdD,EAAI,MAAM,yCAA0CC,CAAK,CAC3D,CACF,CAKA,WAAqB,CACnB,OAAO,KAAK,OACd,CAKA,WAAWS,EAAwB,CACjC,KAAK,QAAUA,EACf,aAAa,QAAQ,gCAAiC,OAAOA,CAAO,CAAC,EACrEV,EAAI,KAAK,kBAAmBU,EAAU,UAAY,UAAU,CAC9D,CAKA,kBAAkC,CAChC,GAAI,CACF,MAAMF,EAAS,aAAa,QAAQ,qBAAqB,EACzD,OAAOA,EAAS,KAAK,MAAMA,CAAM,EAAI,CAAA,CACvC,MAAQ,CACN,MAAO,CAAA,CACT,CACF,CAKA,oBAA2B,CACzB,aAAa,WAAW,qBAAqB,EAC7C,KAAK,QAAU,CAAA,CACjB,CACF,CAGO,MAAMG,EAAgB,IAAIf"}