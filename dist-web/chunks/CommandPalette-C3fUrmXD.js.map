{"version":3,"file":"CommandPalette-C3fUrmXD.js","sources":["../../src/lib/commands/registry.ts","../../src/lib/commands/builtin.ts","../../src/lib/commands/history.ts","../../src/components/layout/CommandPalette.tsx"],"sourcesContent":["import type { CommandDescriptor, CommandSource } from './types';\r\n\r\ntype Listener = () => void;\r\n\r\nconst commandMap = new Map<string, CommandDescriptor>();\r\nconst sources = new Map<string, CommandSource>();\r\nconst listeners = new Set<Listener>();\r\n\r\nlet isHydrated = false;\r\n\r\nfunction emitChange() {\r\n  listeners.forEach((listener) => {\r\n    try {\r\n      listener();\r\n    } catch (error) {\r\n      console.error('[CommandRegistry] Listener error', error);\r\n    }\r\n  });\r\n}\r\n\r\nexport function registerCommand(command: CommandDescriptor): () => void {\r\n  if (commandMap.has(command.id)) {\r\n    console.warn(`[CommandRegistry] Command with id \"${command.id}\" already registered. Overwriting.`);\r\n  }\r\n  commandMap.set(command.id, command);\r\n  emitChange();\r\n  return () => {\r\n    if (commandMap.delete(command.id)) {\r\n      emitChange();\r\n    }\r\n  };\r\n}\r\n\r\nexport function registerCommandSource(source: CommandSource): () => void {\r\n  if (sources.has(source.id)) {\r\n    console.warn(`[CommandRegistry] Command source with id \"${source.id}\" already registered. Overwriting.`);\r\n  }\r\n  sources.set(source.id, source);\r\n  emitChange();\r\n  return () => {\r\n    if (sources.delete(source.id)) {\r\n      emitChange();\r\n    }\r\n  };\r\n}\r\n\r\nexport async function getAllCommands(): Promise<CommandDescriptor[]> {\r\n  const staticCommands = Array.from(commandMap.values());\r\n  const dynamicResults = await Promise.all(\r\n    Array.from(sources.values()).map(async (source) => {\r\n      try {\r\n        const results = await source.getCommands();\r\n        return results;\r\n      } catch (error) {\r\n        console.error(`[CommandRegistry] Failed to load commands from source \"${source.id}\":`, error);\r\n        return [];\r\n      }\r\n    }),\r\n  );\r\n\r\n  return [...staticCommands, ...dynamicResults.flat()];\r\n}\r\n\r\nexport function onCommandsChanged(listener: Listener): () => void {\r\n  listeners.add(listener);\r\n  return () => {\r\n    listeners.delete(listener);\r\n  };\r\n}\r\n\r\nexport function markHydrated() {\r\n  isHydrated = true;\r\n}\r\n\r\nexport function commandsHydrated(): boolean {\r\n  return isHydrated;\r\n}\r\n\r\nexport function notifyCommandsChanged() {\r\n  emitChange();\r\n}\r\n\r\n\r\n","import { registerCommand, registerCommandSource, markHydrated, commandsHydrated, notifyCommandsChanged } from './registry';\r\nimport type { CommandDescriptor } from './types';\r\nimport { ipc } from '../ipc-typed';\r\nimport { useAppStore } from '../../state/appStore';\r\nimport { useTabsStore } from '../../state/tabsStore';\r\n\r\nlet builtinsRegistered = false;\r\n\r\ntype AppState = ReturnType<typeof useAppStore.getState>;\r\ntype AppMode = AppState['mode'];\r\n\r\nconst staticCommands: CommandDescriptor[] = [\r\n  {\r\n    id: 'core:new-tab',\r\n    title: 'Open New Tab',\r\n    subtitle: 'Create a blank tab in the current container',\r\n    category: 'Navigation',\r\n    keywords: ['tab', 'new', 'create'],\r\n    shortcut: ['Ctrl/Cmd', 'T'],\r\n    run: async () => {\r\n      await ipc.tabs.create('about:blank');\r\n    },\r\n  },\r\n  {\r\n    id: 'core:privacy-dashboard',\r\n    title: 'Open Privacy Dashboard',\r\n    subtitle: 'Review shields, permissions, and session data',\r\n    category: 'Privacy',\r\n    keywords: ['privacy', 'dashboard', 'settings'],\r\n    run: () => {\r\n      window.location.hash = '#/privacy';\r\n    },\r\n  },\r\n  {\r\n    id: 'core:save-workspace',\r\n    title: 'Save Workspace Snapshot',\r\n    subtitle: 'Capture current tabs and layout into a workspace bundle',\r\n    category: 'Workspace',\r\n    keywords: ['workspace', 'session', 'save'],\r\n    run: async () => {\r\n      const name = prompt('Name of the workspace snapshot?');\r\n      if (!name) return;\r\n      await ipc.storage.saveWorkspace({\r\n        id: crypto.randomUUID(),\r\n        name,\r\n        partition: `persist:workspace:${Date.now()}`,\r\n      });\r\n    },\r\n  },\r\n  {\r\n    id: 'core:burn-active-tab',\r\n    title: 'Burn Active Tab',\r\n    subtitle: 'Permanently delete data for the current tab',\r\n    category: 'Privacy',\r\n    keywords: ['burn', 'tab', 'privacy'],\r\n    run: async () => {\r\n      const { activeId } = useTabsStore.getState();\r\n      if (!activeId) return;\r\n      const confirmed = confirm('Burn this tab? All associated storage will be destroyed.');\r\n      if (!confirmed) return;\r\n      await ipc.tabs.burn(activeId);\r\n    },\r\n  },\r\n  {\r\n    id: 'core:ask-agent',\r\n    title: 'Ask Omni Agent',\r\n    subtitle: 'Send a custom question to the AI agent',\r\n    category: 'AI',\r\n    keywords: ['agent', 'ai', 'question'],\r\n    run: async () => {\r\n      const promptText = prompt('What would you like the agent to do?');\r\n      if (!promptText) return;\r\n      await ipc.agent.createTask({\r\n        title: 'Command Palette Request',\r\n        role: 'researcher',\r\n        goal: promptText,\r\n        budget: { tokens: 4096, seconds: 120, requests: 20 },\r\n      });\r\n    },\r\n  },\r\n];\r\n\r\nfunction registerModeCommands() {\r\n  const modes: Array<{ id: string; title: string; mode: AppMode }> = [\r\n    { id: 'core:mode-browse', title: 'Switch to Browse Mode', mode: 'Browse' },\r\n    { id: 'core:mode-research', title: 'Switch to Research Mode', mode: 'Research' },\r\n    { id: 'core:mode-threats', title: 'Switch to Threat Mode', mode: 'Threats' },\r\n    { id: 'core:mode-trade', title: 'Switch to Trade Mode', mode: 'Trade' },\r\n    { id: 'core:mode-docs', title: 'Switch to Docs Mode', mode: 'Docs' },\r\n  ];\r\n\r\n  modes.forEach((entry) => {\r\n    registerCommand({\r\n      id: entry.id,\r\n      title: entry.title,\r\n      category: 'Modes',\r\n      keywords: ['mode', entry.mode.toLowerCase()],\r\n      run: () => {\r\n        useAppStore.getState().setMode(entry.mode);\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\nfunction registerStaticCommands() {\r\n  staticCommands.forEach((command) => registerCommand(command));\r\n}\r\n\r\nfunction registerActiveTabCommands() {\r\n  registerCommandSource({\r\n    id: 'dynamic:tabs',\r\n    getCommands: async () => {\r\n      const { tabs, activeId } = useTabsStore.getState();\r\n      return tabs.slice(0, 25).map((tab) => ({\r\n        id: `tab:focus:${tab.id}`,\r\n        title: tab.title || 'Untitled Tab',\r\n        subtitle: tab.url,\r\n        category: 'Tabs',\r\n        badge: tab.id === activeId ? 'Active' : undefined,\r\n        keywords: [tab.title, tab.url].filter(Boolean) as string[],\r\n        run: async () => {\r\n          await ipc.tabs.activate({ id: tab.id });\r\n        },\r\n      }));\r\n    },\r\n  });\r\n\r\n  useTabsStore.subscribe(() => {\r\n    notifyCommandsChanged();\r\n  });\r\n}\r\n\r\nexport function initializeBuiltinCommands() {\r\n  if (builtinsRegistered) {\r\n    return;\r\n  }\r\n  builtinsRegistered = true;\r\n\r\n  registerStaticCommands();\r\n  registerModeCommands();\r\n  registerActiveTabCommands();\r\n  markHydrated();\r\n}\r\n\r\nexport function builtinsInitialized(): boolean {\r\n  return builtinsRegistered && commandsHydrated();\r\n}\r\n\r\n\r\n","/**\r\n * Command History - Track recently used commands\r\n */\r\n\r\nconst STORAGE_KEY = 'command-history';\r\nconst MAX_HISTORY = 50;\r\n\r\nexport interface CommandHistoryEntry {\r\n  commandId: string;\r\n  timestamp: number;\r\n  query?: string; // Search query used\r\n}\r\n\r\nclass CommandHistory {\r\n  private history: CommandHistoryEntry[] = [];\r\n\r\n  constructor() {\r\n    this.load();\r\n  }\r\n\r\n  private load(): void {\r\n    try {\r\n      const stored = localStorage.getItem(STORAGE_KEY);\r\n      if (stored) {\r\n        this.history = JSON.parse(stored) as CommandHistoryEntry[];\r\n      }\r\n    } catch (error) {\r\n      console.warn('[CommandHistory] Failed to load history:', error);\r\n      this.history = [];\r\n    }\r\n  }\r\n\r\n  private save(): void {\r\n    try {\r\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(this.history));\r\n    } catch (error) {\r\n      console.warn('[CommandHistory] Failed to save history:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Record a command execution\r\n   */\r\n  record(commandId: string, query?: string): void {\r\n    // Remove existing entry if present\r\n    this.history = this.history.filter(entry => entry.commandId !== commandId);\r\n    \r\n    // Add to front\r\n    this.history.unshift({\r\n      commandId,\r\n      timestamp: Date.now(),\r\n      query,\r\n    });\r\n\r\n    // Limit history size\r\n    if (this.history.length > MAX_HISTORY) {\r\n      this.history = this.history.slice(0, MAX_HISTORY);\r\n    }\r\n\r\n    this.save();\r\n  }\r\n\r\n  /**\r\n   * Get recent commands\r\n   */\r\n  getRecent(limit: number = 10): CommandHistoryEntry[] {\r\n    return this.history.slice(0, limit);\r\n  }\r\n\r\n  /**\r\n   * Get command usage count\r\n   */\r\n  getUsageCount(commandId: string): number {\r\n    return this.history.filter(entry => entry.commandId === commandId).length;\r\n  }\r\n\r\n  /**\r\n   * Get most used commands\r\n   */\r\n  getMostUsed(limit: number = 10): Array<{ commandId: string; count: number }> {\r\n    const counts = new Map<string, number>();\r\n    for (const entry of this.history) {\r\n      counts.set(entry.commandId, (counts.get(entry.commandId) || 0) + 1);\r\n    }\r\n    \r\n    return Array.from(counts.entries())\r\n      .map(([commandId, count]) => ({ commandId, count }))\r\n      .sort((a, b) => b.count - a.count)\r\n      .slice(0, limit);\r\n  }\r\n\r\n  /**\r\n   * Clear history\r\n   */\r\n  clear(): void {\r\n    this.history = [];\r\n    this.save();\r\n  }\r\n}\r\n\r\nexport const commandHistory = new CommandHistory();\r\n\r\n","/**\r\n * CommandPalette - ⌘K command overlay\r\n */\r\n\r\nimport { useEffect, useMemo, useRef, useState } from 'react';\r\nimport type { ReactNode } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { Search, ArrowRight, Box, Clock, Sparkles, History } from 'lucide-react';\r\nimport type { CommandDescriptor } from '../../lib/commands/types';\r\nimport { getAllCommands, onCommandsChanged } from '../../lib/commands/registry';\r\nimport { initializeBuiltinCommands, builtinsInitialized } from '../../lib/commands/builtin';\r\nimport { commandHistory } from '../../lib/commands/history';\r\nimport { ipc } from '../../lib/ipc-typed';\r\nimport { useContainerStore } from '../../state/containerStore';\r\nimport { ipcEvents } from '../../lib/ipc-events';\r\nimport type { ContainerInfo } from '../../lib/ipc-events';\r\n\r\ninterface CommandPaletteProps {\r\n  onClose: () => void;\r\n}\r\n\r\ntype HistoryEntry = {\r\n  id: string;\r\n  url: string;\r\n  title: string;\r\n  timestamp?: number;\r\n  visitCount?: number;\r\n  lastVisitTime?: number;\r\n};\r\n\r\ntype TabSnapshot = {\r\n  id: string;\r\n  title?: string;\r\n  url?: string;\r\n  active?: boolean;\r\n  containerId?: string;\r\n  containerName?: string;\r\n  containerColor?: string;\r\n  mode?: 'normal' | 'ghost' | 'private';\r\n};\r\n\r\ntype PaletteItem = {\r\n  id: string;\r\n  title: string;\r\n  subtitle?: string;\r\n  category: string;\r\n  type: 'command' | 'history' | 'container' | 'tab' | 'action';\r\n  keywords?: string[];\r\n  shortcut?: string[];\r\n  badge?: string;\r\n  run: () => Promise<void> | void;\r\n  icon?: ReactNode;\r\n  meta?: Record<string, unknown>;\r\n};\r\n\r\nconst DEFAULT_SEARCH_ENGINE = 'https://duckduckgo.com/?q=';\r\n\r\nconst TYPE_PRIORITY: Record<PaletteItem['type'], number> = {\r\n  action: 0,\r\n  command: 1,\r\n  container: 2,\r\n  tab: 3,\r\n  history: 4,\r\n};\r\n\r\nconst PROTOCOL_REGEX = /^(https?:\\/\\/|chrome:\\/\\/|edge:\\/\\/|about:|file:\\/\\/)/i;\r\nconst DOMAIN_REGEX = /^[\\w.-]+\\.[a-z]{2,}(?:[\\/?#].*)?$/i;\r\n\r\nconst withAlpha = (hex?: string, alpha = '33'): string | undefined => {\r\n  if (!hex || !hex.startsWith('#')) return undefined;\r\n  if (hex.length === 4) {\r\n    const r = hex[1];\r\n    const g = hex[2];\r\n    const b = hex[3];\r\n    return `#${r}${r}${g}${g}${b}${b}${alpha}`;\r\n  }\r\n  if (hex.length === 7) {\r\n    return `${hex}${alpha}`;\r\n  }\r\n  return hex;\r\n};\r\n\r\nconst capitalize = (value?: string): string =>\r\n  value ? value.charAt(0).toUpperCase() + value.slice(1) : '';\r\n\r\nconst buildNavigationTarget = (input: string): { url: string; description: string; isDirect: boolean } => {\r\n  const trimmed = input.trim();\r\n  if (!trimmed) {\r\n    return { url: 'about:blank', description: 'Open a blank tab', isDirect: true };\r\n  }\r\n\r\n  if (PROTOCOL_REGEX.test(trimmed)) {\r\n    return { url: trimmed, description: trimmed, isDirect: true };\r\n  }\r\n\r\n  if (!/\\s/.test(trimmed) && DOMAIN_REGEX.test(trimmed)) {\r\n    const url = trimmed.startsWith('www.') ? `https://${trimmed}` : `https://${trimmed}`;\r\n    return { url, description: url, isDirect: true };\r\n  }\r\n\r\n  return {\r\n    url: `${DEFAULT_SEARCH_ENGINE}${encodeURIComponent(trimmed)}`,\r\n    description: `Search the web for “${trimmed}”`,\r\n    isDirect: false,\r\n  };\r\n};\r\n\r\n/**\r\n * Enhanced fuzzy search algorithm\r\n */\r\nfunction fuzzyScore(query: string, value?: string): number {\r\n  if (!value) return 0;\r\n  const normalizedQuery = query.toLowerCase().trim();\r\n  const normalizedValue = value.toLowerCase();\r\n\r\n  // Exact match gets highest score\r\n  if (normalizedValue === normalizedQuery) {\r\n    return 1000;\r\n  }\r\n\r\n  // Prefix match gets high score\r\n  if (normalizedValue.startsWith(normalizedQuery)) {\r\n    return 500;\r\n  }\r\n\r\n  // Word boundary match\r\n  const words = normalizedValue.split(/\\s+/);\r\n  const queryWords = normalizedQuery.split(/\\s+/);\r\n  let wordBoundaryScore = 0;\r\n  for (const qWord of queryWords) {\r\n    for (const word of words) {\r\n      if (word.startsWith(qWord)) {\r\n        wordBoundaryScore += 100;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  if (wordBoundaryScore > 0) {\r\n    return wordBoundaryScore;\r\n  }\r\n\r\n  // Character sequence match\r\n  let score = 0;\r\n  let queryIndex = 0;\r\n  let lastMatchIndex = -1;\r\n  let consecutiveMatches = 0;\r\n\r\n  for (let i = 0; i < normalizedValue.length && queryIndex < normalizedQuery.length; i++) {\r\n    if (normalizedValue[i] === normalizedQuery[queryIndex]) {\r\n      score += 5;\r\n      if (lastMatchIndex === i - 1) {\r\n        consecutiveMatches++;\r\n        score += 3 * consecutiveMatches; // Consecutive bonus (increasing)\r\n      } else {\r\n        consecutiveMatches = 1;\r\n      }\r\n      if (i === 0) {\r\n        score += 10; // Prefix bonus\r\n      }\r\n      lastMatchIndex = i;\r\n      queryIndex++;\r\n    }\r\n  }\r\n\r\n  if (queryIndex === normalizedQuery.length) {\r\n    score += 10; // Matched all characters\r\n  }\r\n\r\n  // Penalty for unmatched characters\r\n  const unmatchedRatio = (normalizedValue.length - queryIndex) / normalizedValue.length;\r\n  score = Math.max(0, score - (unmatchedRatio * 5));\r\n\r\n  return score;\r\n}\r\n\r\nfunction scorePaletteItem(query: string, item: PaletteItem, usageCount: number = 0): number {\r\n  const fields = [\r\n    item.title,\r\n    item.subtitle,\r\n    item.category,\r\n    item.badge,\r\n    ...(item.keywords ?? []),\r\n  ];\r\n  let best = 0;\r\n  for (const field of fields) {\r\n    const current = fuzzyScore(query, field);\r\n    if (current > best) {\r\n      best = current;\r\n    }\r\n  }\r\n  \r\n  // Boost score based on usage history\r\n  if (usageCount > 0) {\r\n    best += Math.min(usageCount * 2, 20); // Max 20 point boost\r\n  }\r\n  \r\n  return best;\r\n}\r\n\r\nexport function CommandPalette({ onClose }: CommandPaletteProps) {\r\n  const [query, setQuery] = useState('');\r\n  const [selectedIndex, setSelectedIndex] = useState(0);\r\n  const [commands, setCommands] = useState<CommandDescriptor[]>([]);\r\n  const [loading, setLoading] = useState(!builtinsInitialized());\r\n  const [recentHistory, setRecentHistory] = useState<HistoryEntry[]>([]);\r\n  const [historySearchResults, setHistorySearchResults] = useState<HistoryEntry[]>([]);\r\n  const [historyLoading, setHistoryLoading] = useState(false);\r\n  const [openTabs, setOpenTabs] = useState<TabSnapshot[]>([]);\r\n  const [showRecentCommands, setShowRecentCommands] = useState(false);\r\n  const { containers, activeContainerId, setContainers, setActiveContainer } = useContainerStore((state) => ({\r\n    containers: state.containers,\r\n    activeContainerId: state.activeContainerId,\r\n    setContainers: state.setContainers,\r\n    setActiveContainer: state.setActiveContainer,\r\n  }));\r\n  const containersRef = useRef<ContainerInfo[]>(containers);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n  useEffect(() => {\r\n    containersRef.current = containers;\r\n  }, [containers]);\r\n\r\n  useEffect(() => {\r\n    if (!builtinsInitialized()) {\r\n      initializeBuiltinCommands();\r\n    }\r\n    let mounted = true;\r\n\r\n    const loadCommands = async () => {\r\n      const list = await getAllCommands();\r\n      if (!mounted) return;\r\n      setCommands(list);\r\n      setLoading(false);\r\n      setSelectedIndex(0);\r\n    };\r\n\r\n    void loadCommands();\r\n    const unsubscribe = onCommandsChanged(() => {\r\n      void loadCommands();\r\n    });\r\n\r\n    return () => {\r\n      mounted = false;\r\n      unsubscribe();\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    const loadRecent = async () => {\r\n      try {\r\n        const list = await ipc.history.list();\r\n        if (mounted) {\r\n          setRecentHistory(Array.isArray(list) ? list.slice(0, 20) : []);\r\n        }\r\n      } catch (error) {\r\n        console.warn('[CommandPalette] Failed to load history list:', error);\r\n      }\r\n    };\r\n    void loadRecent();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    if (containers.length === 0) {\r\n      ipc.containers\r\n        .list()\r\n        .then((list) => {\r\n          if (!cancelled && Array.isArray(list)) {\r\n            setContainers(list as ContainerInfo[]);\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          console.warn('[CommandPalette] Failed to load containers:', error);\r\n        });\r\n    }\r\n\r\n    const unsubscribeList = ipcEvents.on<ContainerInfo[]>('containers:list', (payload) => {\r\n      if (Array.isArray(payload)) {\r\n        setContainers(payload as ContainerInfo[]);\r\n      }\r\n    });\r\n\r\n    const unsubscribeActive = ipcEvents.on<{ containerId: string; container?: ContainerInfo }>(\r\n      'containers:active',\r\n      (payload) => {\r\n        if (!payload) return;\r\n        const next = payload.container ?? containersRef.current.find((c) => c.id === payload.containerId);\r\n        if (next) {\r\n          setActiveContainer(next);\r\n        }\r\n      },\r\n    );\r\n\r\n    return () => {\r\n      cancelled = true;\r\n      unsubscribeList();\r\n      unsubscribeActive();\r\n    };\r\n  }, [containers.length, setContainers, setActiveContainer]);\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    const loadTabs = async () => {\r\n      try {\r\n        const list = await ipc.tabs.list();\r\n        if (!cancelled && Array.isArray(list)) {\r\n          setOpenTabs(list as TabSnapshot[]);\r\n        }\r\n      } catch (error) {\r\n        console.warn('[CommandPalette] Failed to load tabs:', error);\r\n      }\r\n    };\r\n    void loadTabs();\r\n\r\n    const unsubscribeTabs = ipcEvents.on<any[]>('tabs:updated', (payload) => {\r\n      if (Array.isArray(payload)) {\r\n        setOpenTabs(payload as TabSnapshot[]);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      cancelled = true;\r\n      unsubscribeTabs();\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const trimmed = query.trim();\r\n    if (trimmed.length < 2) {\r\n      setHistorySearchResults([]);\r\n      setHistoryLoading(false);\r\n      return;\r\n    }\r\n\r\n    let cancelled = false;\r\n    setHistoryLoading(true);\r\n\r\n    const runSearch = async () => {\r\n      try {\r\n        const results = await ipc.history.search(trimmed);\r\n        if (!cancelled) {\r\n          setHistorySearchResults(Array.isArray(results) ? results.slice(0, 20) : []);\r\n        }\r\n      } catch (error) {\r\n        if (!cancelled) {\r\n          console.warn('[CommandPalette] History search failed:', error);\r\n          setHistorySearchResults([]);\r\n        }\r\n      } finally {\r\n        if (!cancelled) {\r\n          setHistoryLoading(false);\r\n        }\r\n      }\r\n    };\r\n\r\n    void runSearch();\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [query]);\r\n\r\n  const filteredItems = useMemo(() => {\r\n    const trimmed = query.trim();\r\n    const normalized = trimmed.toLowerCase();\r\n    const historySource = normalized.length >= 2 ? historySearchResults : recentHistory;\r\n\r\n    // Get command usage counts for scoring\r\n    const usageCounts = new Map<string, number>();\r\n    for (const cmd of commands) {\r\n      usageCounts.set(cmd.id, commandHistory.getUsageCount(cmd.id));\r\n    }\r\n\r\n    const commandItems: PaletteItem[] = commands.map((cmd) => ({\r\n      id: cmd.id,\r\n      title: cmd.title,\r\n      subtitle: cmd.subtitle,\r\n      category: cmd.category,\r\n      type: 'command',\r\n      keywords: cmd.keywords,\r\n      shortcut: cmd.shortcut,\r\n      badge: cmd.badge,\r\n      run: async () => {\r\n        commandHistory.record(cmd.id, trimmed);\r\n        await cmd.run();\r\n      },\r\n      meta: { usageCount: usageCounts.get(cmd.id) || 0 },\r\n    }));\r\n\r\n    const containerItems: PaletteItem[] = containers.map((container) => ({\r\n      id: `container:${container.id}`,\r\n      title: `Switch to ${container.name}`,\r\n      subtitle: container.description || `${capitalize(container.scope ?? 'session')} container`,\r\n      category: 'Containers',\r\n      type: 'container',\r\n      badge: container.id === activeContainerId ? 'Active' : undefined,\r\n      keywords: [container.name, container.description ?? '', container.id, container.scope ?? ''],\r\n      meta: { color: container.color, container },\r\n      run: async () => {\r\n        try {\r\n          const result = await ipc.containers.setActive(container.id);\r\n          const info = (result || container) as ContainerInfo;\r\n          setActiveContainer(info);\r\n        } catch (error) {\r\n          console.warn('[CommandPalette] Failed to switch container:', error);\r\n        }\r\n      },\r\n    }));\r\n\r\n    const tabItems: PaletteItem[] = openTabs.map((tab) => ({\r\n      id: `tab:${tab.id}`,\r\n      title: tab.title || tab.url || 'Untitled tab',\r\n      subtitle: tab.url,\r\n      category: 'Open Tabs',\r\n      type: 'tab',\r\n      badge: tab.active ? 'Current Tab' : tab.containerName,\r\n      keywords: [tab.title ?? '', tab.url ?? '', tab.containerName ?? '', tab.mode ?? ''],\r\n      meta: { color: tab.containerColor, active: tab.active },\r\n      run: async () => {\r\n        await ipc.tabs.activate({ id: tab.id });\r\n      },\r\n    }));\r\n\r\n    const historyItems: PaletteItem[] = historySource.map((entry) => ({\r\n      id: `history:${entry.id}`,\r\n      title: entry.title || entry.url,\r\n      subtitle: entry.url,\r\n      category: 'History',\r\n      type: 'history',\r\n      badge: entry.visitCount ? `${entry.visitCount}×` : undefined,\r\n      keywords: [entry.url, entry.title],\r\n      run: async () => {\r\n        if (!entry.url) return;\r\n        await ipc.tabs.create({ url: entry.url });\r\n      },\r\n    }));\r\n\r\n    const openInContainerItems: PaletteItem[] =\r\n      trimmed.length > 0\r\n        ? containers.map((container) => {\r\n            const target = buildNavigationTarget(trimmed);\r\n            return {\r\n              id: `open:${container.id}:${trimmed}`,\r\n              title: target.isDirect\r\n                ? `Open ${target.url} in ${container.name}`\r\n                : `Search “${trimmed}” in ${container.name}`,\r\n              subtitle: target.description,\r\n              category: 'Open in Container',\r\n              type: 'action',\r\n              badge: 'New Tab',\r\n              keywords: [trimmed, container.name, container.id],\r\n              meta: { color: container.color },\r\n              run: async () => {\r\n                await ipc.tabs.create({ url: target.url, containerId: container.id });\r\n              },\r\n            } satisfies PaletteItem;\r\n          })\r\n        : [];\r\n\r\n    const combined = [\r\n      ...openInContainerItems,\r\n      ...commandItems,\r\n      ...containerItems,\r\n      ...tabItems,\r\n      ...historyItems,\r\n    ];\r\n\r\n    if (!normalized) {\r\n      return combined.slice(0, 30);\r\n    }\r\n\r\n    const scored = combined\r\n      .map((item) => ({\r\n        item,\r\n        score: scorePaletteItem(\r\n          normalized,\r\n          item,\r\n          (item.meta?.usageCount as number) || 0\r\n        ),\r\n      }))\r\n      .filter(({ score }) => score > 0)\r\n      .sort((a, b) => {\r\n        if (b.score !== a.score) {\r\n          return b.score - a.score;\r\n        }\r\n        const orderA = TYPE_PRIORITY[a.item.type] ?? 99;\r\n        const orderB = TYPE_PRIORITY[b.item.type] ?? 99;\r\n        if (orderA !== orderB) {\r\n          return orderA - orderB;\r\n        }\r\n        return a.item.title.localeCompare(b.item.title);\r\n      })\r\n      .slice(0, 30)\r\n      .map(({ item }) => item);\r\n    return scored;\r\n  }, [query, commands, containers, activeContainerId, openTabs, historySearchResults, recentHistory, setActiveContainer]);\r\n\r\n  // Recent commands when query is empty\r\n  const recentCommands = useMemo(() => {\r\n    if (!showRecentCommands) return [];\r\n    \r\n    const recent = commandHistory.getRecent(10);\r\n    const items: PaletteItem[] = [];\r\n    for (const entry of recent) {\r\n      const cmd = commands.find(c => c.id === entry.commandId);\r\n      if (!cmd) continue;\r\n      items.push({\r\n        id: `recent:${entry.commandId}`,\r\n        title: cmd.title,\r\n        subtitle: cmd.subtitle || `Used ${new Date(entry.timestamp).toLocaleDateString()}`,\r\n        category: 'Recent Commands',\r\n        type: 'command' as const,\r\n        keywords: cmd.keywords,\r\n        shortcut: cmd.shortcut,\r\n        badge: 'Recent',\r\n        run: async () => {\r\n          commandHistory.record(cmd.id);\r\n          await cmd.run();\r\n        },\r\n        icon: <History size={14} />,\r\n      });\r\n      if (items.length >= 5) break;\r\n    }\r\n    return items;\r\n  }, [showRecentCommands, commands]);\r\n\r\n  // Combine recent commands with filtered items\r\n  const displayItems = useMemo(() => {\r\n    if (showRecentCommands && recentCommands.length > 0 && query.trim().length === 0) {\r\n      return [...recentCommands, ...filteredItems.slice(0, 25)];\r\n    }\r\n    return filteredItems;\r\n  }, [showRecentCommands, recentCommands, filteredItems, query]);\r\n\r\n  const groupedItems = useMemo(() => {\r\n    const sections: Array<{ category: string; items: PaletteItem[]; startIndex: number }> = [];\r\n    let currentCategory = '';\r\n\r\n    displayItems.forEach((item, index) => {\r\n      if (item && item.category !== currentCategory) {\r\n        currentCategory = item.category;\r\n        sections.push({ category: currentCategory, items: [item], startIndex: index });\r\n      } else if (item) {\r\n        sections[sections.length - 1]?.items.push(item);\r\n      }\r\n    });\r\n\r\n    return sections;\r\n  }, [displayItems]);\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        onClose();\r\n      } else if (e.key === 'ArrowDown') {\r\n        e.preventDefault();\r\n        setSelectedIndex(prev => Math.min(prev + 1, Math.max(displayItems.length - 1, 0)));\r\n      } else if (e.key === 'ArrowUp') {\r\n        e.preventDefault();\r\n        setSelectedIndex(prev => Math.max(prev - 1, 0));\r\n      } else if (e.key === 'Enter') {\r\n        e.preventDefault();\r\n        if (displayItems[selectedIndex]) {\r\n          void displayItems[selectedIndex].run();\r\n          onClose();\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [selectedIndex, displayItems, onClose]);\r\n\r\n  useEffect(() => {\r\n    if (selectedIndex >= displayItems.length) {\r\n      setSelectedIndex(displayItems.length > 0 ? displayItems.length - 1 : 0);\r\n    }\r\n  }, [displayItems, selectedIndex]);\r\n\r\n  // Show recent commands when query is empty\r\n  useEffect(() => {\r\n    setShowRecentCommands(query.trim().length === 0);\r\n  }, [query]);\r\n\r\n  const renderIcon = (item: PaletteItem) => {\r\n    const color = typeof item.meta?.color === 'string' ? (item.meta.color as string) : undefined;\r\n    const classNameBase =\r\n      'inline-flex h-6 w-6 items-center justify-center rounded-lg border text-[11px]';\r\n    const className =\r\n      color != null\r\n        ? classNameBase\r\n        : `${classNameBase} border-gray-700 bg-gray-800/60 text-gray-300`;\r\n    const style =\r\n      color != null\r\n        ? {\r\n            borderColor: withAlpha(color, '66') ?? color,\r\n            backgroundColor: withAlpha(color, '22') ?? color,\r\n            color,\r\n          }\r\n        : undefined;\r\n\r\n    if (item.icon) {\r\n      return (\r\n        <span className={className} style={style}>\r\n          {item.icon}\r\n        </span>\r\n      );\r\n    }\r\n\r\n    switch (item.type) {\r\n      case 'history':\r\n        return (\r\n          <span className={className} style={style}>\r\n            <Clock size={14} />\r\n          </span>\r\n        );\r\n      case 'container':\r\n        return (\r\n          <span className={className} style={style}>\r\n            <Box size={14} />\r\n          </span>\r\n        );\r\n      case 'tab':\r\n        return (\r\n          <span className={className} style={style}>\r\n            <Box size={12} />\r\n          </span>\r\n        );\r\n      case 'action':\r\n        return (\r\n          <span className={className} style={style}>\r\n            <Sparkles size={14} />\r\n          </span>\r\n        );\r\n      default:\r\n        return (\r\n          <span className={className} style={style}>\r\n            <Sparkles size={14} />\r\n          </span>\r\n        );\r\n    }\r\n  };\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0 }}\r\n      animate={{ opacity: 1 }}\r\n      exit={{ opacity: 0 }}\r\n      className=\"fixed inset-0 z-50 flex items-start justify-center pt-[15vh]\"\r\n      onClick={onClose}\r\n    >\r\n      {/* Backdrop */}\r\n      <div className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\" />\r\n\r\n      {/* Palette */}\r\n      <motion.div\r\n        initial={{ scale: 0.95, opacity: 0, y: -20 }}\r\n        animate={{ scale: 1, opacity: 1, y: 0 }}\r\n        exit={{ scale: 0.95, opacity: 0, y: -20 }}\r\n        onClick={(e) => e.stopPropagation()}\r\n        className=\"relative w-full max-w-2xl mx-4 bg-gray-900/95 backdrop-blur-xl border border-gray-800/50 rounded-2xl shadow-2xl overflow-hidden\"\r\n      >\r\n        {/* Search Input */}\r\n        <div className=\"flex items-center gap-3 px-4 py-3 border-b border-gray-800/50\">\r\n          <Search size={20} className=\"text-gray-400\" />\r\n          <input\r\n            ref={inputRef}\r\n            type=\"text\"\r\n            value={query}\r\n            onChange={(e) => {\r\n              setQuery(e.target.value);\r\n              setSelectedIndex(0);\r\n            }}\r\n            autoFocus\r\n            placeholder=\"Type a command or search...\"\r\n            className=\"flex-1 bg-transparent text-gray-200 placeholder-gray-500 focus:outline-none\"\r\n          />\r\n          <kbd className=\"px-2 py-1 bg-gray-800 border border-gray-700 rounded text-xs text-gray-400\">\r\n            Esc\r\n          </kbd>\r\n        </div>\r\n\r\n        {/* Results */}\r\n        <div className=\"max-h-96 overflow-y-auto\">\r\n          {displayItems.length > 0 ? (\r\n            <div className=\"py-2\">\r\n              {groupedItems.map((section) => (\r\n                <div key={`section-${section.category}`}>\r\n                  <div className=\"px-4 pt-3 pb-1 text-[11px] uppercase tracking-wider text-gray-500\">\r\n                    {section.category}\r\n                  </div>\r\n                  <div className=\"flex flex-col\">\r\n                    {section.items.map((cmd, index) => {\r\n                      const globalIndex = section.startIndex + index;\r\n                      const isSelected = selectedIndex === globalIndex;\r\n                      const iconElement = renderIcon(cmd);\r\n                      return (\r\n                        <motion.button\r\n                          key={cmd.id}\r\n                          onClick={async () => {\r\n                            await cmd.run();\r\n                            onClose();\r\n                          }}\r\n                          onMouseEnter={() => setSelectedIndex(globalIndex)}\r\n                          className={`w-full flex items-center justify-between px-4 py-3 text-left transition-colors ${\r\n                            isSelected\r\n                              ? 'bg-blue-600/20 border-l-2 border-blue-500'\r\n                              : 'hover:bg-gray-800/40 border-l-2 border-transparent'\r\n                          }`}\r\n                        >\r\n                          <div className=\"flex items-center gap-3 min-w-0\">\r\n                            {iconElement}\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <div className=\"flex items-center gap-2\">\r\n                                <span className=\"text-sm font-medium text-gray-200 truncate\">{cmd.title}</span>\r\n                                {cmd.badge && (\r\n                                  <span className=\"rounded-full border border-gray-700 bg-gray-800/60 px-2 py-0.5 text-[10px] uppercase tracking-wide text-gray-400\">\r\n                                    {cmd.badge}\r\n                                  </span>\r\n                                )}\r\n                              </div>\r\n                              {cmd.subtitle && (\r\n                                <div className=\"text-xs text-gray-500 truncate\">\r\n                                  {cmd.subtitle}\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2 ml-4 shrink-0\">\r\n                            {cmd.shortcut && (\r\n                              <span className=\"flex items-center gap-1 text-[11px] text-gray-500\">\r\n                                {cmd.shortcut.map((part, idx) => (\r\n                                  <kbd\r\n                                    key={`${cmd.id}-sc-${idx}`}\r\n                                    className=\"rounded border border-gray-700 bg-gray-800/60 px-1.5 py-0.5 text-[10px] text-gray-400\"\r\n                                  >\r\n                                    {part}\r\n                                  </kbd>\r\n                                ))}\r\n                              </span>\r\n                            )}\r\n                            <ArrowRight size={16} className=\"text-gray-500\" />\r\n                          </div>\r\n                        </motion.button>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <div className=\"py-8 text-center text-gray-500 text-sm\">\r\n              {loading || historyLoading ? 'Searching…' : 'No commands found'}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"px-4 py-2 border-t border-gray-800/50 flex items-center justify-between text-xs text-gray-500\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <span>↑↓ Navigate</span>\r\n            <span>↵ Select</span>\r\n            <span>Esc Close</span>\r\n          </div>\r\n          <span>{displayItems.length} {displayItems.length === 1 ? 'result' : 'results'}</span>\r\n        </div>\r\n      </motion.div>\r\n    </motion.div>\r\n  );\r\n}\r\n\r\n"],"names":["commandMap","sources","listeners","isHydrated","emitChange","listener","error","registerCommand","command","registerCommandSource","source","getAllCommands","staticCommands","dynamicResults","onCommandsChanged","markHydrated","commandsHydrated","notifyCommandsChanged","builtinsRegistered","ipc","name","activeId","useTabsStore","promptText","registerModeCommands","entry","useAppStore","registerStaticCommands","registerActiveTabCommands","tabs","tab","initializeBuiltinCommands","builtinsInitialized","STORAGE_KEY","MAX_HISTORY","CommandHistory","__publicField","stored","commandId","query","limit","counts","count","a","b","commandHistory","DEFAULT_SEARCH_ENGINE","TYPE_PRIORITY","PROTOCOL_REGEX","DOMAIN_REGEX","withAlpha","hex","alpha","r","g","capitalize","value","buildNavigationTarget","input","trimmed","url","fuzzyScore","normalizedQuery","normalizedValue","words","queryWords","wordBoundaryScore","qWord","word","score","queryIndex","lastMatchIndex","consecutiveMatches","i","unmatchedRatio","scorePaletteItem","item","usageCount","fields","best","field","current","CommandPalette","onClose","setQuery","useState","selectedIndex","setSelectedIndex","commands","setCommands","loading","setLoading","recentHistory","setRecentHistory","historySearchResults","setHistorySearchResults","historyLoading","setHistoryLoading","openTabs","setOpenTabs","showRecentCommands","setShowRecentCommands","containers","activeContainerId","setContainers","setActiveContainer","useContainerStore","state","containersRef","useRef","inputRef","useEffect","mounted","loadCommands","list","unsubscribe","cancelled","unsubscribeList","ipcEvents","payload","unsubscribeActive","next","c","unsubscribeTabs","results","filteredItems","useMemo","normalized","historySource","usageCounts","cmd","commandItems","containerItems","container","info","tabItems","historyItems","combined","target","orderA","orderB","recentCommands","recent","items","jsx","History","displayItems","groupedItems","sections","currentCategory","index","handleKeyDown","e","prev","renderIcon","color","classNameBase","className","style","Clock","Box","Sparkles","jsxs","motion","Search","section","globalIndex","isSelected","iconElement","part","idx","ArrowRight"],"mappings":"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"}