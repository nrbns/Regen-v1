{"version":3,"mappings":"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","names":["API_BASE_URL","RealtimeMarketDataService","__publicField","symbol","callback","normalizedSymbol","callbacks","url","event","data","update","cb","error","delay","resolution","_from","_to","response","c","_","i","instance","getRealtimeMarketDataService","WS_URL","TradeSignalService","wsUrl","signal","getTradeSignalService","OrderConfirmModal","isOpen","order","onConfirm","onCancel","warnings","errors","canConfirm","jsx","AnimatePresence","jsxs","Fragment","motion","e","X","AlertTriangle","idx","warning","CheckCircle2","OrderBook","bids","asks","maxDepth","onPriceClick","displayBids","displayAsks","bidCumulative","bidsWithCumulative","bid","askCumulative","asksWithCumulative","ask","maxCumulative","b","a","TrendingUp","widthPercent","TrendingDown","TradesTape","trades","maxVisible","visibleTrades","setVisibleTrades","useState","containerRef","useRef","useEffect","recent","trade","isBuy","ArrowUp","ArrowDown","useRealtimeTrade","enabled","onTick","onCandle","tick","setTick","connected","setConnected","setError","orderbook","setOrderbook","wsRef","reconnectTimeoutRef","reconnectAttempts","connect","scheme","ws","tickData","candle","candleData","err","TradeStagehandIntegration","stagehand","execute","click","type","extract","useStagehand","side","quantity","price","markets","TradePanel","chartContainerRef","chartRef","seriesRef","currentMode","useAppStore","state","setMode","selected","setSelected","setPrice","change","setChange","isGreen","setIsGreen","qty","setQty","sl","setSl","tp","setTp","isPlacingOrder","setIsPlacingOrder","chartLoading","setChartLoading","showConfirmModal","setShowConfirmModal","pendingOrder","setPendingOrder","orderBookBids","setOrderBookBids","orderBookAsks","setOrderBookAsks","recentTrades","setRecentTrades","orderType","setOrderType","limitPrice","setLimitPrice","connectionError","setConnectionError","lastPrice","setLastPrice","_lastChange","setLastChange","_lastUpdate","setLastUpdate","handleWisprTrade","stopLoss","market","m","toast","candleHistory","setCandleHistory","wsConnected","wsOrderbook","delta","lastCandle","time","timeSeconds","updatedHistory","lastIdx","chartData","prev","existing","updated","realtimeService","previousPrice","high","low","unsubscribe","newPrice","tradeApi","__vitePreload","n","quote","chart","timeoutId","resizeHandler","initializeChart","container","width","height","createChart","ColorType","addCandles","candlestickSeries","API_BASE","symbolKey","candles","fallbackData","baseDate","open","close","generateOrderBook","basePrice","interval","newTrade","handleOrderClick","useCallback","orderPrice","estimatedCost","fees","marginRequired","handleConfirmOrder","result","handleKeyDown","Globe","Sparkles","IndianRupee","Bitcoin","DollarSign","Loader2","_side"],"ignoreList":[],"sources":["../../src/services/realtimeMarketData.ts","../../src/services/realtime/tradeSignalService.ts","../../src/components/trade/OrderConfirmModal.tsx","../../src/components/trade/OrderBook.tsx","../../src/components/trade/TradesTape.tsx","../../src/hooks/useRealtimeTrade.ts","../../src/modes/trade/stagehand-integration.tsx","../../src/modes/trade/index.tsx"],"sourcesContent":["/**\n * Real-Time Market Data Service\n *\n * Connects to server SSE endpoint for sub-second price updates\n * Supports: NSE/BSE (via Finnhub), Crypto (via Binance), US markets\n */\n\nconst API_BASE_URL =\n  typeof window !== 'undefined'\n    ? (window as any).__API_BASE_URL || import.meta.env.VITE_API_BASE_URL || 'http://127.0.0.1:4000'\n    : 'http://127.0.0.1:4000';\n\nexport interface PriceUpdate {\n  symbol: string;\n  price: number;\n  volume?: number;\n  timestamp: number;\n  change?: number;\n  changePercent?: number;\n}\n\nexport type PriceUpdateCallback = (update: PriceUpdate) => void;\n\nclass RealtimeMarketDataService {\n  private eventSource: EventSource | null = null;\n  private callbacks: Map<string, Set<PriceUpdateCallback>> = new Map();\n  private currentSymbol: string | null = null;\n  private reconnectAttempts = 0;\n  private maxReconnectAttempts = 5;\n  private reconnectDelay = 1000;\n\n  /**\n   * Subscribe to real-time price updates for a symbol\n   */\n  subscribe(symbol: string, callback: PriceUpdateCallback): () => void {\n    // Normalize symbol (remove exchange prefix if present)\n    const normalizedSymbol = symbol.includes(':') ? symbol.split(':')[1] : symbol;\n\n    // Add callback\n    if (!this.callbacks.has(normalizedSymbol)) {\n      this.callbacks.set(normalizedSymbol, new Set());\n    }\n    this.callbacks.get(normalizedSymbol)!.add(callback);\n\n    // If this is a new symbol, reconnect\n    if (this.currentSymbol !== normalizedSymbol) {\n      this.currentSymbol = normalizedSymbol;\n      this.connect(normalizedSymbol);\n    }\n\n    // Return unsubscribe function\n    return () => {\n      const callbacks = this.callbacks.get(normalizedSymbol);\n      if (callbacks) {\n        callbacks.delete(callback);\n        if (callbacks.size === 0) {\n          this.callbacks.delete(normalizedSymbol);\n          this.disconnect();\n        }\n      }\n    };\n  }\n\n  private connect(symbol: string) {\n    this.disconnect();\n\n    const url = `${API_BASE_URL}/stock/stream/${symbol}`;\n    console.log(`[RealtimeMarketData] Connecting to ${url}`);\n\n    try {\n      this.eventSource = new EventSource(url);\n      this.reconnectAttempts = 0;\n\n      this.eventSource.onopen = () => {\n        console.log(`[RealtimeMarketData] Connected for ${symbol}`);\n        this.reconnectAttempts = 0;\n      };\n\n      this.eventSource.onmessage = event => {\n        try {\n          // Handle SSE ping\n          if (event.data === ': ping' || event.data.trim() === '') {\n            return;\n          }\n\n          const data = JSON.parse(event.data);\n\n          // Handle subscription confirmation\n          if (data.status === 'subscribed') {\n            console.log(`[RealtimeMarketData] Subscribed to ${data.symbol}`);\n            return;\n          }\n\n          // Handle price updates\n          if (data.price !== undefined) {\n            const update: PriceUpdate = {\n              symbol: data.symbol || symbol,\n              price: Number(data.price),\n              volume: data.volume ? Number(data.volume) : undefined,\n              timestamp: data.timestamp || Date.now(),\n            };\n\n            // Calculate change if we have previous price\n            const callbacks = this.callbacks.get(symbol);\n            if (callbacks) {\n              callbacks.forEach(cb => cb(update));\n            }\n          }\n\n          // Handle stream closed/error\n          if (data.status === 'closed' || data.status === 'error') {\n            console.warn(`[RealtimeMarketData] Stream ${data.status} for ${symbol}`);\n            if (data.status === 'error') {\n              this.scheduleReconnect(symbol);\n            }\n          }\n        } catch (error) {\n          console.error('[RealtimeMarketData] Failed to parse SSE message:', error);\n        }\n      };\n\n      this.eventSource.onerror = error => {\n        console.error(`[RealtimeMarketData] SSE error for ${symbol}:`, error);\n        this.eventSource?.close();\n        this.scheduleReconnect(symbol);\n      };\n    } catch (error) {\n      console.error(`[RealtimeMarketData] Failed to create EventSource for ${symbol}:`, error);\n      this.scheduleReconnect(symbol);\n    }\n  }\n\n  private scheduleReconnect(symbol: string) {\n    if (this.reconnectAttempts >= this.maxReconnectAttempts) {\n      console.error(`[RealtimeMarketData] Max reconnect attempts reached for ${symbol}`);\n      return;\n    }\n\n    this.reconnectAttempts++;\n    const delay = this.reconnectDelay * Math.pow(2, this.reconnectAttempts - 1); // Exponential backoff\n\n    console.log(\n      `[RealtimeMarketData] Reconnecting to ${symbol} in ${delay}ms (attempt ${this.reconnectAttempts})`\n    );\n\n    setTimeout(() => {\n      if (this.currentSymbol === symbol && this.callbacks.has(symbol)) {\n        this.connect(symbol);\n      }\n    }, delay);\n  }\n\n  private disconnect() {\n    if (this.eventSource) {\n      this.eventSource.close();\n      this.eventSource = null;\n    }\n  }\n\n  /**\n   * Get historical candles for a symbol\n   */\n  async getHistoricalCandles(\n    symbol: string,\n    resolution: '1' | '5' | '15' | '30' | '60' | 'D' | 'W' | 'M' = 'D',\n    _from?: number,\n    _to?: number\n  ): Promise<\n    Array<{ time: number; open: number; high: number; low: number; close: number; volume: number }>\n  > {\n    try {\n      // Use Finnhub API via server\n      const normalizedSymbol = symbol.includes(':') ? symbol.split(':')[1] : symbol;\n      // const toTimestamp = to || Math.floor(Date.now() / 1000);\n      // const fromTimestamp = from || toTimestamp - (resolution === 'D' ? 86400 * 50 : 86400 * 7);\n\n      // Use Finnhub API via server proxy\n      const response = await fetch(\n        `${API_BASE_URL}/api/trade/candles/${normalizedSymbol}?interval=${resolution}&limit=50`\n      );\n\n      if (!response.ok) {\n        throw new Error(`Failed to fetch candles: ${response.statusText}`);\n      }\n\n      const data = await response.json();\n\n      // Convert to lightweight-charts format\n      if (data.candles && Array.isArray(data.candles)) {\n        return data.candles.map((c: any) => ({\n          time: (c.timestamp || c.time) * 1000,\n          open: c.open,\n          high: c.high,\n          low: c.low,\n          close: c.close,\n          volume: c.volume || 0,\n        }));\n      }\n\n      // Fallback: try Finnhub format\n      if (data.c && Array.isArray(data.c)) {\n        return data.c.map((_: any, i: number) => ({\n          time: (data.t[i] || Date.now() / 1000) * 1000,\n          open: data.o[i],\n          high: data.h[i],\n          low: data.l[i],\n          close: data.c[i],\n          volume: data.v[i] || 0,\n        }));\n      }\n\n      return [];\n    } catch (error) {\n      console.error('[RealtimeMarketData] Failed to fetch historical candles:', error);\n      return [];\n    }\n  }\n}\n\n// Singleton instance\nlet instance: RealtimeMarketDataService | null = null;\n\nexport function getRealtimeMarketDataService(): RealtimeMarketDataService {\n  if (!instance) {\n    instance = new RealtimeMarketDataService();\n  }\n  return instance;\n}\n","/**\n * Trade Signal Service - Telepathy Upgrade Phase 2\n * WebSocket push for instant trade signals (replaces 30s polling)\n * Push the moment scanner detects signals\n */\n\nconst WS_URL = import.meta.env.VITE_WS_URL || 'ws://127.0.0.1:18080';\n\nexport interface TradeSignal {\n  symbol: string;\n  action: 'BUY' | 'SELL' | 'HOLD';\n  confidence: number;\n  reason: string;\n  timestamp: number;\n}\n\nexport type TradeSignalCallback = (signal: TradeSignal) => void;\n\nclass TradeSignalService {\n  private ws: WebSocket | null = null;\n  private callbacks: Set<TradeSignalCallback> = new Set();\n  private reconnectAttempts = 0;\n  private maxReconnectAttempts = 10;\n  private reconnectDelay = 1000;\n  private reconnectTimeout: NodeJS.Timeout | null = null;\n  private subscribedSymbols = new Set<string>();\n  private isConnected = false;\n\n  /**\n   * Subscribe to trade signals for a symbol\n   */\n  subscribe(symbol: string, callback: TradeSignalCallback): () => void {\n    const normalizedSymbol = symbol.includes(':') ? symbol.split(':')[1] : symbol;\n\n    this.callbacks.add(callback);\n    this.subscribedSymbols.add(normalizedSymbol);\n\n    // Connect if not already connected\n    if (!this.isConnected) {\n      this.connect();\n    } else {\n      // Subscribe to this symbol immediately\n      this.subscribeToSymbol(normalizedSymbol);\n    }\n\n    // Return unsubscribe function\n    return () => {\n      this.callbacks.delete(callback);\n      this.subscribedSymbols.delete(normalizedSymbol);\n\n      // Unsubscribe from symbol if no more callbacks\n      if (this.callbacks.size === 0) {\n        this.disconnect();\n      }\n    };\n  }\n\n  /**\n   * Connect to WebSocket server\n   */\n  private connect(): void {\n    if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n      return;\n    }\n\n    const wsUrl = `${WS_URL}/trade_signals`;\n    console.log('[TradeSignalService] Connecting to', wsUrl);\n\n    try {\n      this.ws = new WebSocket(wsUrl);\n      this.ws.onopen = () => {\n        console.log('[TradeSignalService] Connected');\n        this.isConnected = true;\n        this.reconnectAttempts = 0;\n\n        // Subscribe to all pending symbols\n        this.subscribedSymbols.forEach(symbol => {\n          this.subscribeToSymbol(symbol);\n        });\n      };\n\n      this.ws.onmessage = event => {\n        try {\n          const data = JSON.parse(event.data);\n\n          if (data.type === 'trade_signal') {\n            const signal: TradeSignal = {\n              symbol: data.symbol,\n              action: data.action,\n              confidence: data.confidence || 0,\n              reason: data.reason || '',\n              timestamp: data.timestamp || Date.now(),\n            };\n\n            // Notify all callbacks\n            this.callbacks.forEach(cb => {\n              try {\n                cb(signal);\n              } catch (error) {\n                console.error('[TradeSignalService] Callback error', error);\n              }\n            });\n          } else if (data.type === 'error') {\n            console.error('[TradeSignalService] Server error', data.message);\n          }\n        } catch (error) {\n          console.error('[TradeSignalService] Failed to parse message', error);\n        }\n      };\n\n      this.ws.onerror = error => {\n        console.error('[TradeSignalService] WebSocket error', error);\n      };\n\n      this.ws.onclose = () => {\n        console.log('[TradeSignalService] WebSocket closed');\n        this.isConnected = false;\n        this.scheduleReconnect();\n      };\n    } catch (error) {\n      console.error('[TradeSignalService] Failed to create WebSocket', error);\n      this.scheduleReconnect();\n    }\n  }\n\n  /**\n   * Subscribe to a specific symbol\n   */\n  private subscribeToSymbol(symbol: string): void {\n    if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\n      return;\n    }\n\n    this.ws.send(\n      JSON.stringify({\n        type: 'subscribe',\n        symbol,\n      })\n    );\n    console.log('[TradeSignalService] Subscribed to', symbol);\n  }\n\n  /**\n   * Schedule reconnection\n   */\n  private scheduleReconnect(): void {\n    if (this.reconnectAttempts >= this.maxReconnectAttempts) {\n      console.error('[TradeSignalService] Max reconnect attempts reached');\n      return;\n    }\n\n    if (this.reconnectTimeout) {\n      clearTimeout(this.reconnectTimeout);\n    }\n\n    this.reconnectAttempts++;\n    const delay = this.reconnectDelay * Math.pow(2, this.reconnectAttempts - 1); // Exponential backoff\n\n    console.log(\n      `[TradeSignalService] Reconnecting in ${delay}ms (attempt ${this.reconnectAttempts})`\n    );\n\n    this.reconnectTimeout = setTimeout(() => {\n      if (this.callbacks.size > 0) {\n        this.connect();\n      }\n    }, delay);\n  }\n\n  /**\n   * Disconnect from WebSocket\n   */\n  private disconnect(): void {\n    if (this.reconnectTimeout) {\n      clearTimeout(this.reconnectTimeout);\n      this.reconnectTimeout = null;\n    }\n\n    if (this.ws) {\n      this.ws.close();\n      this.ws = null;\n    }\n    this.isConnected = false;\n  }\n}\n\n// Singleton instance\nlet instance: TradeSignalService | null = null;\n\nexport function getTradeSignalService(): TradeSignalService {\n  if (!instance) {\n    instance = new TradeSignalService();\n  }\n  return instance;\n}\n","import { motion, AnimatePresence } from 'framer-motion';\nimport { X, CheckCircle2, AlertTriangle } from 'lucide-react';\n\nexport interface OrderDetails {\n  side: 'buy' | 'sell';\n  symbol: string;\n  quantity: number;\n  price: number;\n  orderType: 'market' | 'limit';\n  stopLoss?: number;\n  takeProfit?: number;\n  estimatedCost: number;\n  fees: number;\n  marginRequired?: number;\n}\n\ninterface OrderConfirmModalProps {\n  isOpen: boolean;\n  order: OrderDetails | null;\n  onConfirm: () => void;\n  onCancel: () => void;\n  warnings?: string[];\n  errors?: string[];\n}\n\nexport default function OrderConfirmModal({\n  isOpen,\n  order,\n  onConfirm,\n  onCancel,\n  warnings = [],\n  errors = [],\n}: OrderConfirmModalProps) {\n  if (!order) return null;\n\n  const canConfirm = errors.length === 0;\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={onCancel}\n            className=\"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm\"\n          />\n\n          {/* Modal */}\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\n            className=\"fixed inset-0 z-50 flex items-center justify-center p-4\"\n            onClick={e => e.stopPropagation()}\n          >\n            <div className=\"w-full max-w-md rounded-2xl border border-gray-700 bg-gray-900 shadow-2xl\">\n              {/* Header */}\n              <div className=\"flex items-center justify-between border-b border-gray-700 p-6\">\n                <h3 className=\"text-xl font-bold text-white\">Confirm Order</h3>\n                <button\n                  onClick={onCancel}\n                  className=\"rounded-lg p-2 transition-colors hover:bg-gray-800\"\n                  aria-label=\"Close\"\n                >\n                  <X size={20} className=\"text-gray-400\" />\n                </button>\n              </div>\n\n              {/* Order Details */}\n              <div className=\"space-y-4 p-6\">\n                {/* Errors */}\n                {errors.length > 0 && (\n                  <div className=\"rounded-lg border border-red-700 bg-red-900/30 p-4\">\n                    <div className=\"mb-2 flex items-center gap-2\">\n                      <AlertTriangle size={16} className=\"text-red-400\" />\n                      <span className=\"text-sm font-semibold text-red-300\">Errors</span>\n                    </div>\n                    <ul className=\"space-y-1 text-xs text-red-200\">\n                      {errors.map((error, idx) => (\n                        <li key={idx}> {error}</li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n\n                {/* Warnings */}\n                {warnings.length > 0 && (\n                  <div className=\"rounded-lg border border-yellow-700 bg-yellow-900/30 p-4\">\n                    <div className=\"mb-2 flex items-center gap-2\">\n                      <AlertTriangle size={16} className=\"text-yellow-400\" />\n                      <span className=\"text-sm font-semibold text-yellow-300\">Warnings</span>\n                    </div>\n                    <ul className=\"space-y-1 text-xs text-yellow-200\">\n                      {warnings.map((warning, idx) => (\n                        <li key={idx}> {warning}</li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n\n                {/* Order Summary */}\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm text-gray-400\">Side</span>\n                    <span\n                      className={`text-sm font-bold ${\n                        order.side === 'buy' ? 'text-green-400' : 'text-red-400'\n                      }`}\n                    >\n                      {order.side.toUpperCase()}\n                    </span>\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm text-gray-400\">Symbol</span>\n                    <span className=\"text-sm font-semibold text-white\">{order.symbol}</span>\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm text-gray-400\">Quantity</span>\n                    <span className=\"text-sm font-semibold text-white\">{order.quantity}</span>\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm text-gray-400\">Order Type</span>\n                    <span className=\"text-sm font-semibold text-white\">\n                      {order.orderType.toUpperCase()}\n                    </span>\n                  </div>\n\n                  {order.orderType === 'limit' && (\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm text-gray-400\">Limit Price</span>\n                      <span className=\"text-sm font-semibold text-white\">\n                        {order.price.toLocaleString(undefined, { minimumFractionDigits: 2 })}\n                      </span>\n                    </div>\n                  )}\n\n                  {order.stopLoss && (\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm text-gray-400\">Stop Loss</span>\n                      <span className=\"text-sm font-semibold text-red-400\">\n                        {order.stopLoss.toLocaleString(undefined, { minimumFractionDigits: 2 })}\n                      </span>\n                    </div>\n                  )}\n\n                  {order.takeProfit && (\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm text-gray-400\">Take Profit</span>\n                      <span className=\"text-sm font-semibold text-green-400\">\n                        {order.takeProfit.toLocaleString(undefined, { minimumFractionDigits: 2 })}\n                      </span>\n                    </div>\n                  )}\n\n                  <div className=\"space-y-2 border-t border-gray-700 pt-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm text-gray-400\">Estimated Cost</span>\n                      <span className=\"text-sm font-semibold text-white\">\n                        {order.estimatedCost.toLocaleString(undefined, {\n                          minimumFractionDigits: 2,\n                        })}\n                      </span>\n                    </div>\n\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm text-gray-400\">Fees</span>\n                      <span className=\"text-sm text-gray-300\">\n                        {order.fees.toLocaleString(undefined, { minimumFractionDigits: 2 })}\n                      </span>\n                    </div>\n\n                    {order.marginRequired && (\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"text-sm text-gray-400\">Margin Required</span>\n                        <span className=\"text-sm font-semibold text-yellow-400\">\n                          {order.marginRequired.toLocaleString(undefined, {\n                            minimumFractionDigits: 2,\n                          })}\n                        </span>\n                      </div>\n                    )}\n\n                    <div className=\"flex items-center justify-between border-t border-gray-700 pt-2\">\n                      <span className=\"text-base font-semibold text-gray-300\">Total</span>\n                      <span className=\"text-lg font-bold text-white\">\n                        {(order.estimatedCost + order.fees).toLocaleString(undefined, {\n                          minimumFractionDigits: 2,\n                        })}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Actions */}\n              <div className=\"flex gap-3 border-t border-gray-700 p-6\">\n                <button\n                  onClick={onCancel}\n                  className=\"flex-1 rounded-lg bg-gray-800 px-4 py-3 font-semibold text-white transition-colors hover:bg-gray-700\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={onConfirm}\n                  disabled={!canConfirm}\n                  className={`flex flex-1 items-center justify-center gap-2 rounded-lg px-4 py-3 font-semibold transition-all ${\n                    order.side === 'buy'\n                      ? 'bg-green-600 text-white hover:bg-green-500'\n                      : 'bg-red-600 text-white hover:bg-red-500'\n                  } ${!canConfirm ? 'cursor-not-allowed opacity-50' : 'shadow-lg'}`}\n                >\n                  {canConfirm ? (\n                    <>\n                      <CheckCircle2 size={18} />\n                      Confirm {order.side.toUpperCase()}\n                    </>\n                  ) : (\n                    'Cannot Confirm'\n                  )}\n                </button>\n              </div>\n\n              {/* Keyboard hint */}\n              <div className=\"px-6 pb-4 text-center text-xs text-gray-500\">\n                Press <kbd className=\"rounded bg-gray-800 px-1.5 py-0.5\">Enter</kbd> to confirm,{' '}\n                <kbd className=\"rounded bg-gray-800 px-1.5 py-0.5\">Esc</kbd> to cancel\n              </div>\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n}\n","import { motion } from 'framer-motion';\r\nimport { TrendingUp, TrendingDown } from 'lucide-react';\r\n\r\nexport interface OrderBookEntry {\r\n  price: number;\r\n  quantity: number;\r\n  cumulative?: number;\r\n}\r\n\r\ninterface OrderBookProps {\r\n  bids: OrderBookEntry[];\r\n  asks: OrderBookEntry[];\r\n  maxDepth?: number;\r\n  onPriceClick?: (price: number, side: 'buy' | 'sell') => void;\r\n}\r\n\r\nexport default function OrderBook({ bids, asks, maxDepth = 10, onPriceClick }: OrderBookProps) {\r\n  const displayBids = bids.slice(0, maxDepth).reverse();\r\n  const displayAsks = asks.slice(0, maxDepth);\r\n\r\n  // Calculate cumulative volumes\r\n  let bidCumulative = 0;\r\n  const bidsWithCumulative = displayBids.map(bid => {\r\n    bidCumulative += bid.quantity;\r\n    return { ...bid, cumulative: bidCumulative };\r\n  });\r\n\r\n  let askCumulative = 0;\r\n  const asksWithCumulative = displayAsks.map(ask => {\r\n    askCumulative += ask.quantity;\r\n    return { ...ask, cumulative: askCumulative };\r\n  });\r\n\r\n  const maxCumulative = Math.max(\r\n    ...bidsWithCumulative.map(b => b.cumulative || 0),\r\n    ...asksWithCumulative.map(a => a.cumulative || 0)\r\n  );\r\n\r\n  return (\r\n    <div className=\"overflow-hidden rounded-lg border border-gray-700 bg-gray-900\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between border-b border-gray-700 bg-gray-800/50 p-3\">\r\n        <h3 className=\"text-sm font-semibold text-gray-300\">Order Book</h3>\r\n        <div className=\"flex items-center gap-2 text-xs text-gray-400\">\r\n          <span>Top {maxDepth}</span>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-2 divide-x divide-gray-700\">\r\n        {/* Asks (Sell Orders) */}\r\n        <div className=\"flex flex-col\">\r\n          <div className=\"flex items-center gap-2 border-b border-gray-700 bg-red-900/20 p-2\">\r\n            <TrendingUp size={14} className=\"text-red-400\" />\r\n            <span className=\"text-xs font-semibold text-red-400\">Asks (Sell)</span>\r\n          </div>\r\n          <div className=\"space-y-0.5 p-2\">\r\n            {displayAsks.length > 0 ? (\r\n              asksWithCumulative.map((ask, idx) => {\r\n                const widthPercent = ((ask.cumulative || 0) / maxCumulative) * 100;\r\n                return (\r\n                  <motion.button\r\n                    key={`ask-${idx}`}\r\n                    initial={{ opacity: 0, x: -10 }}\r\n                    animate={{ opacity: 1, x: 0 }}\r\n                    onClick={() => onPriceClick?.(ask.price, 'sell')}\r\n                    className=\"group relative flex w-full items-center justify-between rounded px-2 py-1 transition-colors hover:bg-red-900/20\"\r\n                  >\r\n                    <div\r\n                      className=\"absolute bottom-0 left-0 top-0 rounded bg-red-900/20\"\r\n                      style={{ width: `${widthPercent}%` }}\r\n                    />\r\n                    <div className=\"relative z-10 flex w-full items-center justify-between text-xs\">\r\n                      <span className=\"font-medium text-red-400\">{ask.price.toFixed(2)}</span>\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <span className=\"text-gray-400\">{ask.quantity.toLocaleString()}</span>\r\n                        <span className=\"text-[10px] text-gray-500\">\r\n                          {ask.cumulative?.toLocaleString()}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </motion.button>\r\n                );\r\n              })\r\n            ) : (\r\n              <div className=\"py-4 text-center text-xs text-gray-500\">No asks</div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Bids (Buy Orders) */}\r\n        <div className=\"flex flex-col\">\r\n          <div className=\"flex items-center gap-2 border-b border-gray-700 bg-green-900/20 p-2\">\r\n            <TrendingDown size={14} className=\"text-green-400\" />\r\n            <span className=\"text-xs font-semibold text-green-400\">Bids (Buy)</span>\r\n          </div>\r\n          <div className=\"space-y-0.5 p-2\">\r\n            {displayBids.length > 0 ? (\r\n              bidsWithCumulative.map((bid, idx) => {\r\n                const widthPercent = ((bid.cumulative || 0) / maxCumulative) * 100;\r\n                return (\r\n                  <motion.button\r\n                    key={`bid-${idx}`}\r\n                    initial={{ opacity: 0, x: 10 }}\r\n                    animate={{ opacity: 1, x: 0 }}\r\n                    onClick={() => onPriceClick?.(bid.price, 'buy')}\r\n                    className=\"group relative flex w-full items-center justify-between rounded px-2 py-1 transition-colors hover:bg-green-900/20\"\r\n                  >\r\n                    <div\r\n                      className=\"absolute bottom-0 right-0 top-0 rounded bg-green-900/20\"\r\n                      style={{ width: `${widthPercent}%` }}\r\n                    />\r\n                    <div className=\"relative z-10 flex w-full items-center justify-between text-xs\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <span className=\"text-[10px] text-gray-500\">\r\n                          {bid.cumulative?.toLocaleString()}\r\n                        </span>\r\n                        <span className=\"text-gray-400\">{bid.quantity.toLocaleString()}</span>\r\n                      </div>\r\n                      <span className=\"font-medium text-green-400\">{bid.price.toFixed(2)}</span>\r\n                    </div>\r\n                  </motion.button>\r\n                );\r\n              })\r\n            ) : (\r\n              <div className=\"py-4 text-center text-xs text-gray-500\">No bids</div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Spread */}\r\n      {displayAsks.length > 0 && displayBids.length > 0 && (\r\n        <div className=\"border-t border-gray-700 bg-gray-800/30 p-2\">\r\n          <div className=\"flex items-center justify-between text-xs\">\r\n            <span className=\"text-gray-400\">Spread</span>\r\n            <span className=\"font-semibold text-yellow-400\">\r\n              {(displayAsks[0].price - displayBids[0].price).toFixed(2)} (\r\n              {(\r\n                ((displayAsks[0].price - displayBids[0].price) / displayBids[0].price) *\r\n                100\r\n              ).toFixed(3)}\r\n              %)\r\n            </span>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import { useEffect, useRef, useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { ArrowUp, ArrowDown } from 'lucide-react';\r\n\r\nexport interface Trade {\r\n  id: string;\r\n  price: number;\r\n  quantity: number;\r\n  side: 'buy' | 'sell';\r\n  timestamp: number;\r\n}\r\n\r\ninterface TradesTapeProps {\r\n  trades: Trade[];\r\n  maxVisible?: number;\r\n  symbol?: string;\r\n}\r\n\r\nexport default function TradesTape({ trades, maxVisible = 20, symbol }: TradesTapeProps) {\r\n  const [visibleTrades, setVisibleTrades] = useState<Trade[]>([]);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    // Show most recent trades\r\n    const recent = trades.slice(-maxVisible).reverse();\r\n    setVisibleTrades(recent);\r\n  }, [trades, maxVisible]);\r\n\r\n  return (\r\n    <div className=\"overflow-hidden rounded-lg border border-gray-700 bg-gray-900\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between border-b border-gray-700 bg-gray-800/50 p-2\">\r\n        <h3 className=\"text-xs font-semibold text-gray-300\">Recent Trades</h3>\r\n        {symbol && <span className=\"text-xs text-gray-400\">{symbol}</span>}\r\n      </div>\r\n\r\n      {/* Trades List */}\r\n      <div\r\n        ref={containerRef}\r\n        className=\"scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-gray-900 h-48 overflow-y-auto\"\r\n      >\r\n        <div className=\"divide-y divide-gray-800\">\r\n          <AnimatePresence initial={false}>\r\n            {visibleTrades.length > 0 ? (\r\n              visibleTrades.map(trade => {\r\n                const isBuy = trade.side === 'buy';\r\n                return (\r\n                  <motion.div\r\n                    key={trade.id}\r\n                    initial={{ opacity: 0, y: -10 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    exit={{ opacity: 0, x: -20 }}\r\n                    className={`flex items-center justify-between px-3 py-2 text-xs transition-colors ${\r\n                      isBuy ? 'hover:bg-green-900/10' : 'hover:bg-red-900/10'\r\n                    }`}\r\n                  >\r\n                    <div className=\"flex items-center gap-2\">\r\n                      {isBuy ? (\r\n                        <ArrowUp size={12} className=\"text-green-400\" />\r\n                      ) : (\r\n                        <ArrowDown size={12} className=\"text-red-400\" />\r\n                      )}\r\n                      <span className={`font-medium ${isBuy ? 'text-green-400' : 'text-red-400'}`}>\r\n                        {trade.price.toFixed(2)}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3 text-gray-400\">\r\n                      <span>{trade.quantity.toLocaleString()}</span>\r\n                      <span className=\"text-[10px] text-gray-500\">\r\n                        {new Date(trade.timestamp).toLocaleTimeString()}\r\n                      </span>\r\n                    </div>\r\n                  </motion.div>\r\n                );\r\n              })\r\n            ) : (\r\n              <div className=\"py-8 text-center text-xs text-gray-500\">No recent trades</div>\r\n            )}\r\n          </AnimatePresence>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { useEffect, useRef, useState } from 'react';\r\n\r\nexport interface RealtimeTick {\r\n  price: number;\r\n  volume: number;\r\n  timestamp: number;\r\n  bid?: number;\r\n  ask?: number;\r\n}\r\n\r\nexport interface RealtimeCandle {\r\n  time: number;\r\n  open: number;\r\n  high: number;\r\n  low: number;\r\n  close: number;\r\n  volume: number;\r\n}\r\n\r\ninterface UseRealtimeTradeOptions {\r\n  symbol: string;\r\n  enabled?: boolean;\r\n  onTick?: (tick: RealtimeTick) => void;\r\n  onCandle?: (candle: RealtimeCandle) => void;\r\n}\r\n\r\nexport interface OrderBookUpdate {\r\n  bids: Array<{ price: number; size: number }>;\r\n  asks: Array<{ price: number; size: number }>;\r\n}\r\n\r\nexport function useRealtimeTrade({\r\n  symbol,\r\n  enabled = true,\r\n  onTick,\r\n  onCandle,\r\n}: UseRealtimeTradeOptions) {\r\n  const [tick, setTick] = useState<RealtimeTick | null>(null);\r\n  const [connected, setConnected] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [orderbook, setOrderbook] = useState<OrderBookUpdate | null>(null);\r\n  const wsRef = useRef<WebSocket | null>(null);\r\n  const reconnectTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const reconnectAttempts = useRef(0);\r\n\r\n  useEffect(() => {\r\n    if (!enabled || !symbol) {\r\n      if (wsRef.current) {\r\n        wsRef.current.close();\r\n        wsRef.current = null;\r\n      }\r\n      setConnected(false);\r\n      return;\r\n    }\r\n\r\n    const connect = () => {\r\n      try {\r\n        // Use mock server in development, or configured WS host\r\n        const wsUrl = import.meta.env.VITE_WS_HOST || 'localhost:4001';\r\n        const scheme = window.location.protocol === 'https:' ? 'wss' : 'ws';\r\n        // Check if it's a full URL or just host:port\r\n        // Mock server expects: ws://localhost:4001?symbol=...\r\n        const url = wsUrl.includes('://')\r\n          ? `${wsUrl}?symbol=${encodeURIComponent(symbol)}`\r\n          : `${scheme}://${wsUrl}?symbol=${encodeURIComponent(symbol)}`;\r\n\r\n        const ws = new WebSocket(url);\r\n        wsRef.current = ws;\r\n\r\n        ws.onopen = () => {\r\n          console.log('[useRealtimeTrade] WebSocket connected for', symbol);\r\n          setConnected(true);\r\n          setError(null);\r\n          reconnectAttempts.current = 0;\r\n        };\r\n\r\n        ws.onmessage = event => {\r\n          try {\r\n            const data = JSON.parse(event.data);\r\n\r\n            if (data.type === 'tick') {\r\n              const tickData: RealtimeTick = {\r\n                price: data.price,\r\n                volume: data.trade?.size || data.volume || 0,\r\n                timestamp: data.trade?.ts || data.timestamp || Date.now(),\r\n                bid: data.bid,\r\n                ask: data.ask,\r\n              };\r\n              setTick(tickData);\r\n              onTick?.(tickData);\r\n            } else if (data.type === 'candle') {\r\n              const candle = data.candle || data;\r\n              const candleData: RealtimeCandle = {\r\n                time: candle.time,\r\n                open: candle.open,\r\n                high: candle.high,\r\n                low: candle.low,\r\n                close: candle.close,\r\n                volume: candle.volume || 0,\r\n              };\r\n              onCandle?.(candleData);\r\n            } else if (data.type === 'orderbook') {\r\n              // Update orderbook\r\n              if (data.bids && data.asks) {\r\n                setOrderbook({\r\n                  bids: data.bids,\r\n                  asks: data.asks,\r\n                });\r\n              }\r\n            } else if (data.type === 'snapshot') {\r\n              // Handle initial snapshot with candles\r\n              if (data.candles && Array.isArray(data.candles)) {\r\n                data.candles.forEach((candle: any) => {\r\n                  const candleData: RealtimeCandle = {\r\n                    time: candle.time,\r\n                    open: candle.open,\r\n                    high: candle.high,\r\n                    low: candle.low,\r\n                    close: candle.close,\r\n                    volume: candle.volume || 0,\r\n                  };\r\n                  onCandle?.(candleData);\r\n                });\r\n              }\r\n              // Set initial orderbook from snapshot\r\n              if (data.orderbook) {\r\n                setOrderbook({\r\n                  bids: data.orderbook.bids || [],\r\n                  asks: data.orderbook.asks || [],\r\n                });\r\n              }\r\n              // Set initial price from snapshot\r\n              if (data.lastPrice) {\r\n                const tickData: RealtimeTick = {\r\n                  price: data.lastPrice,\r\n                  volume: 0,\r\n                  timestamp: Date.now(),\r\n                };\r\n                setTick(tickData);\r\n                onTick?.(tickData);\r\n              }\r\n            }\r\n          } catch (err) {\r\n            console.error('[useRealtimeTrade] Failed to parse message:', err);\r\n          }\r\n        };\r\n\r\n        ws.onerror = err => {\r\n          console.error('[useRealtimeTrade] WebSocket error:', err);\r\n          setError('Connection error');\r\n          setConnected(false);\r\n        };\r\n\r\n        ws.onclose = () => {\r\n          console.log('[useRealtimeTrade] WebSocket closed');\r\n          setConnected(false);\r\n          wsRef.current = null;\r\n\r\n          // Exponential backoff reconnection\r\n          if (enabled) {\r\n            const delay = Math.min(1000 * Math.pow(2, reconnectAttempts.current), 30000);\r\n            reconnectAttempts.current++;\r\n            reconnectTimeoutRef.current = setTimeout(() => {\r\n              connect();\r\n            }, delay);\r\n          }\r\n        };\r\n      } catch (err) {\r\n        console.error('[useRealtimeTrade] Failed to create WebSocket:', err);\r\n        setError('Failed to connect');\r\n        setConnected(false);\r\n      }\r\n    };\r\n\r\n    connect();\r\n\r\n    return () => {\r\n      if (reconnectTimeoutRef.current) {\r\n        clearTimeout(reconnectTimeoutRef.current);\r\n      }\r\n      if (wsRef.current) {\r\n        wsRef.current.close();\r\n        wsRef.current = null;\r\n      }\r\n      setConnected(false);\r\n    };\r\n  }, [symbol, enabled, onTick, onCandle]);\r\n\r\n  return { tick, connected, error, orderbook };\r\n}\r\n","/**\r\n * Stagehand Integration for Trade Mode\r\n * Adds developer-friendly scripting API\r\n */\r\n\r\nimport { useEffect } from 'react';\r\nimport { useStagehand } from '../../hooks/useStagehand';\r\n\r\nexport function TradeStagehandIntegration() {\r\n  const { stagehand, execute, click, type, extract } = useStagehand({\r\n    context: 'trade',\r\n  });\r\n\r\n  useEffect(() => {\r\n    // Expose Stagehand API to window for console access\r\n    if (typeof window !== 'undefined') {\r\n      (window as any).tradeStagehand = {\r\n        stagehand,\r\n        execute,\r\n        click,\r\n        type,\r\n        extract,\r\n        // Trade-specific helpers\r\n        placeOrder: async (side: 'buy' | 'sell', quantity: number, price?: number) => {\r\n          await click(`button[data-side=\"${side}\"]`);\r\n          await type('input[name=\"quantity\"]', quantity.toString());\r\n          if (price) {\r\n            await type('input[name=\"price\"]', price.toString());\r\n          }\r\n          await click('button[type=\"submit\"]');\r\n        },\r\n        getPrice: async () => {\r\n          const price = await extract('.price-display');\r\n          return parseFloat(price);\r\n        },\r\n        getOrderbook: async () => {\r\n          const bids = await extract('.orderbook-bids');\r\n          const asks = await extract('.orderbook-asks');\r\n          return { bids, asks };\r\n        },\r\n      };\r\n    }\r\n\r\n    return () => {\r\n      if (typeof window !== 'undefined') {\r\n        delete (window as any).tradeStagehand;\r\n      }\r\n    };\r\n  }, [stagehand, execute, click, type, extract]);\r\n\r\n  return null; // This is a side-effect component\r\n}\r\n\r\n","// God Tier Trade Mode - Real TradingView Candles + Realtime NSE/US/Crypto\r\nimport { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { createChart, ColorType, IChartApi, ISeriesApi } from 'lightweight-charts';\r\nimport { toast } from '../../utils/toast';\r\nimport { motion } from 'framer-motion';\r\nimport {\r\n  Globe,\r\n  TrendingUp,\r\n  IndianRupee,\r\n  Bitcoin,\r\n  DollarSign,\r\n  Sparkles,\r\n  Loader2,\r\n} from 'lucide-react';\r\nimport { useAppStore } from '../../state/appStore';\r\nimport { getRealtimeMarketDataService, type PriceUpdate } from '../../services/realtimeMarketData';\r\nimport {\r\n  getTradeSignalService,\r\n  type TradeSignal,\r\n} from '../../services/realtime/tradeSignalService';\r\nimport OrderConfirmModal, { type OrderDetails } from '../../components/trade/OrderConfirmModal';\r\nimport OrderBook, { type OrderBookEntry } from '../../components/trade/OrderBook';\r\nimport TradesTape, { type Trade } from '../../components/trade/TradesTape';\r\nimport { useRealtimeTrade } from '../../hooks/useRealtimeTrade';\r\n// TradeModeFallback and useResponsive not yet implemented - removed for now\r\nimport { TradeStagehandIntegration } from './stagehand-integration';\r\n\r\nconst markets = [\r\n  { name: 'NIFTY 50', symbol: 'NSE:NIFTY', currency: '', exchange: 'NSE' },\r\n  { name: 'BANKNIFTY', symbol: 'NSE:BANKNIFTY', currency: '', exchange: 'NSE' },\r\n  { name: 'RELIANCE', symbol: 'NSE:RELIANCE', currency: '', exchange: 'NSE' },\r\n  { name: 'TCS', symbol: 'NSE:TCS', currency: '', exchange: 'NSE' },\r\n  { name: 'S&P 500', symbol: 'SP:SPX', currency: '$', exchange: 'NYSE' },\r\n  { name: 'NASDAQ', symbol: 'NASDAQ:NDX', currency: '$', exchange: 'NASDAQ' },\r\n  { name: 'Bitcoin', symbol: 'BINANCE:BTCUSDT', currency: '$', exchange: 'Crypto' },\r\n  { name: 'Ethereum', symbol: 'BINANCE:ETHUSDT', currency: '$', exchange: 'Crypto' },\r\n  { name: 'Gold', symbol: 'FOREX:XAUUSD', currency: '$', exchange: 'Forex' },\r\n];\r\n\r\nexport default function TradePanel() {\r\n  const chartContainerRef = useRef<HTMLDivElement>(null);\r\n  const chartRef = useRef<IChartApi | null>(null);\r\n  const seriesRef = useRef<ISeriesApi<'Candlestick'> | null>(null);\r\n  const currentMode = useAppStore(state => state.mode);\r\n  const setMode = useAppStore(state => state.setMode);\r\n  const [selected, setSelected] = useState(markets[0]);\r\n  const [price, setPrice] = useState(25035.14);\r\n  const [change, setChange] = useState(325.1);\r\n  const [isGreen, setIsGreen] = useState(true);\r\n  const [qty, setQty] = useState(50);\r\n  const [sl, setSl] = useState(24700);\r\n  const [tp, setTp] = useState(24950);\r\n  const [isPlacingOrder, setIsPlacingOrder] = useState(false);\r\n  const [chartLoading, setChartLoading] = useState(true);\r\n  const [showConfirmModal, setShowConfirmModal] = useState(false);\r\n  const [pendingOrder, setPendingOrder] = useState<OrderDetails | null>(null);\r\n  const [orderBookBids, setOrderBookBids] = useState<OrderBookEntry[]>([]);\r\n  const [orderBookAsks, setOrderBookAsks] = useState<OrderBookEntry[]>([]);\r\n  const [recentTrades, setRecentTrades] = useState<Trade[]>([]);\r\n  const [orderType, setOrderType] = useState<'market' | 'limit'>('limit');\r\n  const [limitPrice, setLimitPrice] = useState(price);\r\n  const [connectionError, setConnectionError] = useState<Error | null>(null);\r\n  const [lastPrice, setLastPrice] = useState<number | null>(null);\r\n  const [_lastChange, setLastChange] = useState<number | null>(null);\r\n  const [_lastUpdate, setLastUpdate] = useState<Date | null>(null);\r\n  // Responsive hooks not yet implemented - using fallback values\r\n  const isMobile = false;\r\n  const isTablet = false;\r\n\r\n  // WISPR Trade Command Handler\r\n  useEffect(() => {\r\n    const handleWisprTrade = (event: CustomEvent) => {\r\n      const { symbol, quantity, orderType, stopLoss } = event.detail;\r\n      if (symbol) {\r\n        // Find matching market\r\n        const market = markets.find(\r\n          m => m.name.toLowerCase().includes(symbol.toLowerCase()) || m.symbol.includes(symbol)\r\n        );\r\n        if (market) {\r\n          setSelected(market);\r\n        }\r\n      }\r\n      if (quantity) setQty(quantity);\r\n      if (stopLoss) setSl(stopLoss);\r\n\r\n      // Execute order (TODO: Connect to actual broker API)\r\n      if (orderType && quantity) {\r\n        toast.success(\r\n          `${orderType === 'buy' ? 'Buy' : 'Sell'} order: ${quantity} ${symbol || selected.name}`\r\n        );\r\n      }\r\n    };\r\n\r\n    window.addEventListener('wispr:trade', handleWisprTrade as EventListener);\r\n    return () => window.removeEventListener('wispr:trade', handleWisprTrade as EventListener);\r\n  }, [selected]);\r\n\r\n  // Real-time WebSocket updates\r\n  const [candleHistory, setCandleHistory] = useState<any[]>([]);\r\n  const {\r\n    tick: _tick,\r\n    connected: wsConnected,\r\n    orderbook: wsOrderbook,\r\n  } = useRealtimeTrade({\r\n    symbol: selected.symbol.includes(':') ? selected.symbol.split(':')[1] : selected.symbol,\r\n    enabled: true,\r\n    onTick: tickData => {\r\n      const delta = tickData.price - price;\r\n      setPrice(tickData.price);\r\n      setChange(Math.abs(delta));\r\n      setIsGreen(delta >= 0);\r\n      setLimitPrice(tickData.price); // Update limit price to current price\r\n      // Track last known values for fallback\r\n      setLastPrice(tickData.price);\r\n      setLastChange(Math.abs(delta));\r\n      setLastUpdate(new Date());\r\n      setConnectionError(null);\r\n\r\n      // Update last candle with tick price\r\n      if (seriesRef.current && candleHistory.length > 0) {\r\n        const lastCandle = candleHistory[candleHistory.length - 1];\r\n        const time = Math.floor(Date.now() / 60000) * 60000;\r\n        const timeSeconds = Math.floor(time / 1000);\r\n\r\n        // Use updateData for real-time updates (type-safe approach)\r\n        try {\r\n          (seriesRef.current as any).updateData({\r\n            time: timeSeconds as any,\r\n            open: lastCandle.close,\r\n            high: Math.max(lastCandle.close, tickData.price),\r\n            low: Math.min(lastCandle.close, tickData.price),\r\n            close: tickData.price,\r\n          });\r\n        } catch {\r\n          // Fallback: update the last candle in history and reset data\r\n          const updatedHistory = [...candleHistory];\r\n          const lastIdx = updatedHistory.length - 1;\r\n          if (updatedHistory[lastIdx]) {\r\n            updatedHistory[lastIdx] = {\r\n              ...updatedHistory[lastIdx],\r\n              high: Math.max(updatedHistory[lastIdx].high, tickData.price),\r\n              low: Math.min(updatedHistory[lastIdx].low, tickData.price),\r\n              close: tickData.price,\r\n            };\r\n            setCandleHistory(updatedHistory);\r\n            const chartData = updatedHistory.map(c => ({\r\n              time: Math.floor(c.time / 1000) as any,\r\n              open: c.open,\r\n              high: c.high,\r\n              low: c.low,\r\n              close: c.close,\r\n            }));\r\n            seriesRef.current.setData(chartData);\r\n          }\r\n        }\r\n      }\r\n    },\r\n    onCandle: candle => {\r\n      // Add or update candle in history\r\n      setCandleHistory(prev => {\r\n        const existing = prev.findIndex(c => c.time === candle.time);\r\n        if (existing >= 0) {\r\n          const updated = [...prev];\r\n          updated[existing] = candle;\r\n          return updated;\r\n        }\r\n        return [...prev, candle].slice(-200); // Keep last 200 candles\r\n      });\r\n\r\n      // Update chart with new candle\r\n      if (seriesRef.current) {\r\n        const timeSeconds = Math.floor(candle.time / 1000);\r\n        const candleData = {\r\n          time: timeSeconds as any,\r\n          open: candle.open,\r\n          high: candle.high,\r\n          low: candle.low,\r\n          close: candle.close,\r\n        };\r\n\r\n        // Try updateData first (for real-time updates)\r\n        try {\r\n          (seriesRef.current as any).updateData?.(candleData);\r\n        } catch {\r\n          // Fallback: if updateData doesn't work, append to history and setData\r\n          const updatedHistory = [...candleHistory, candle].slice(-200);\r\n          setCandleHistory(updatedHistory);\r\n          const chartData = updatedHistory.map(c => ({\r\n            time: Math.floor(c.time / 1000) as any,\r\n            open: c.open,\r\n            high: c.high,\r\n            low: c.low,\r\n            close: c.close,\r\n          }));\r\n          seriesRef.current.setData(chartData);\r\n        }\r\n      }\r\n    },\r\n  });\r\n\r\n  // REAL-TIME PRICE UPDATES (Sub-second latency via SSE) - Fallback\r\n  useEffect(() => {\r\n    if (wsConnected) return; // Use WebSocket if connected\r\n\r\n    const realtimeService = getRealtimeMarketDataService();\r\n    let previousPrice = price;\r\n    let high = price;\r\n    let low = price;\r\n\r\n    // Subscribe to real-time price updates\r\n    const unsubscribe = realtimeService.subscribe(selected.symbol, (update: PriceUpdate) => {\r\n      const newPrice = update.price;\r\n      const delta = newPrice - previousPrice;\r\n      previousPrice = newPrice;\r\n\r\n      // Update high/low\r\n      if (newPrice > high) high = newPrice;\r\n      if (newPrice < low) low = newPrice;\r\n\r\n      setPrice(newPrice);\r\n      setChange(Math.abs(delta));\r\n      setIsGreen(delta >= 0);\r\n      setLimitPrice(newPrice);\r\n    });\r\n\r\n    // Fallback: Try HTTP API for initial price if SSE hasn't connected yet\r\n    const fetchInitialQuote = async () => {\r\n      try {\r\n        const { tradeApi } = await import('../../lib/api-client');\r\n        const quote = await tradeApi.getQuote(selected.symbol);\r\n        if (quote && quote.price) {\r\n          previousPrice = quote.price;\r\n          high = quote.price;\r\n          low = quote.price;\r\n          setPrice(quote.price);\r\n          setLimitPrice(quote.price);\r\n        }\r\n      } catch (error) {\r\n        console.debug('[Trade] Initial quote fetch failed, waiting for SSE:', error);\r\n      }\r\n    };\r\n\r\n    fetchInitialQuote();\r\n\r\n    return () => {\r\n      unsubscribe();\r\n    };\r\n  }, [selected.symbol, wsConnected, price]);\r\n\r\n  // Telepathy Upgrade Phase 2: Real-time trade signals via WebSocket (replaces 30s polling)\r\n  useEffect(() => {\r\n    const signalService = getTradeSignalService();\r\n\r\n    // Subscribe to real-time trade signals (instant push when detected)\r\n    const unsubscribe = signalService.subscribe(selected.symbol, (signal: TradeSignal) => {\r\n      if (signal.action === 'BUY' || signal.action === 'SELL') {\r\n        toast.success(\r\n          `Trade Signal: ${signal.action} ${selected.name} (${Math.round(signal.confidence * 100)}% confidence)`\r\n        );\r\n      }\r\n      console.log('[Trade] Received signal:', signal);\r\n    });\r\n\r\n    return () => {\r\n      unsubscribe();\r\n    };\r\n  }, [selected]);\r\n\r\n  // REAL TRADINGVIEW CANDLES  FULLY WORKING\r\n  useEffect(() => {\r\n    if (!chartContainerRef.current) return;\r\n\r\n    let chart: IChartApi | null = null;\r\n    let timeoutId: NodeJS.Timeout | null = null;\r\n    let resizeHandler: (() => void) | null = null;\r\n\r\n    const initializeChart = () => {\r\n      if (!chartContainerRef.current) return;\r\n\r\n      try {\r\n        const container = chartContainerRef.current;\r\n        const width = container.clientWidth || 800;\r\n        const height = container.clientHeight || 600;\r\n\r\n        chart = createChart(container, {\r\n          layout: {\r\n            background: { type: ColorType.Solid, color: '#000000' },\r\n            textColor: '#ffffff',\r\n          },\r\n          grid: {\r\n            vertLines: { color: '#1e1e1e' },\r\n            horzLines: { color: '#1e1e1e' },\r\n          },\r\n          width,\r\n          height,\r\n          timeScale: {\r\n            timeVisible: true,\r\n            secondsVisible: false,\r\n            borderColor: '#374151',\r\n          },\r\n          crosshair: {\r\n            mode: 1,\r\n          },\r\n          rightPriceScale: {\r\n            borderColor: '#374151',\r\n          },\r\n        });\r\n\r\n        // Check if addCandlestickSeries is available (with fallback)\r\n        const addCandles = (chart as any).addCandlestickSeries ?? chart.addCandlestickSeries;\r\n        if (typeof addCandles !== 'function') {\r\n          console.error(\r\n            '[TradePanel] addCandlestickSeries is not available on chart instance',\r\n            chart\r\n          );\r\n          chartRef.current = chart;\r\n          return;\r\n        }\r\n\r\n        const candlestickSeries = addCandles.call(chart, {\r\n          upColor: '#10b981',\r\n          downColor: '#ef4444',\r\n          borderVisible: false,\r\n          wickUpColor: '#10b981',\r\n          wickDownColor: '#ef4444',\r\n        });\r\n\r\n        // Load initial candle data from mock server or fallback\r\n        const loadRealCandles = async () => {\r\n          setChartLoading(true);\r\n          try {\r\n            // Try mock server first\r\n            const API_BASE = import.meta.env.VITE_API_BASE_URL || 'http://localhost:4001';\r\n            const symbolKey = selected.symbol.includes(':')\r\n              ? selected.symbol.split(':')[1]\r\n              : selected.symbol;\r\n\r\n            try {\r\n              const response = await fetch(`${API_BASE}/api/candles/${symbolKey}`);\r\n              if (response.ok) {\r\n                const data = await response.json();\r\n                if (data.candles && data.candles.length > 0) {\r\n                  const candleData = data.candles.map((c: any) => ({\r\n                    time: Math.floor(c.time / 1000) as any,\r\n                    open: c.open,\r\n                    high: c.high,\r\n                    low: c.low,\r\n                    close: c.close,\r\n                  }));\r\n                  candlestickSeries.setData(candleData);\r\n                  setCandleHistory(data.candles);\r\n                  setChartLoading(false);\r\n                  return;\r\n                }\r\n              }\r\n            } catch {\r\n              console.debug('[Trade] Mock server not available, using fallback');\r\n            }\r\n\r\n            // Fallback: Try real service\r\n            const realtimeService = getRealtimeMarketDataService();\r\n            const candles = await realtimeService.getHistoricalCandles(symbolKey, 'D');\r\n\r\n            if (candles.length > 0) {\r\n              const candleData = candles.map(c => ({\r\n                time: (c.time / 1000) as any,\r\n                open: c.open,\r\n                high: c.high,\r\n                low: c.low,\r\n                close: c.close,\r\n              }));\r\n              candlestickSeries.setData(candleData);\r\n              setChartLoading(false);\r\n            } else {\r\n              // Final fallback: Generate mock data\r\n              console.warn('[Trade] Using fallback candle data');\r\n              const fallbackData: Array<{\r\n                time: number;\r\n                open: number;\r\n                high: number;\r\n                low: number;\r\n                close: number;\r\n              }> = Array.from({ length: 50 }, (_, i) => {\r\n                const baseDate = new Date();\r\n                baseDate.setDate(baseDate.getDate() - (50 - i));\r\n                const time = Math.floor(baseDate.getTime() / 1000);\r\n                const open = 24800 + Math.random() * 300;\r\n                const close = open + (Math.random() - 0.5) * 400;\r\n                const high = Math.max(open, close) + Math.random() * 100;\r\n                const low = Math.min(open, close) - Math.random() * 100;\r\n                return { time, open, high, low, close };\r\n              });\r\n              candlestickSeries.setData(fallbackData);\r\n              setChartLoading(false);\r\n            }\r\n          } catch (error) {\r\n            console.error('[Trade] Failed to load candles:', error);\r\n            setChartLoading(false);\r\n          }\r\n        };\r\n\r\n        loadRealCandles();\r\n        seriesRef.current = candlestickSeries;\r\n        chartRef.current = chart;\r\n\r\n        // Auto-resize\r\n        resizeHandler = () => {\r\n          if (chartContainerRef.current && chart) {\r\n            chart.applyOptions({\r\n              width: chartContainerRef.current.clientWidth || 800,\r\n              height: chartContainerRef.current.clientHeight || 600,\r\n            });\r\n          }\r\n        };\r\n        window.addEventListener('resize', resizeHandler);\r\n      } catch (error) {\r\n        console.error('[TradePanel] Error initializing chart:', error);\r\n      }\r\n    };\r\n\r\n    // Ensure container has dimensions before initializing\r\n    const container = chartContainerRef.current;\r\n    if (container.clientWidth === 0 || container.clientHeight === 0) {\r\n      timeoutId = setTimeout(() => {\r\n        if (container.clientWidth > 0 && container.clientHeight > 0) {\r\n          initializeChart();\r\n        }\r\n      }, 100);\r\n    } else {\r\n      initializeChart();\r\n    }\r\n\r\n    return () => {\r\n      if (timeoutId) clearTimeout(timeoutId);\r\n      if (resizeHandler) {\r\n        window.removeEventListener('resize', resizeHandler);\r\n      }\r\n      if (chart) {\r\n        chart.remove();\r\n        chartRef.current = null;\r\n        seriesRef.current = null;\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Update chart when symbol changes\r\n  useEffect(() => {\r\n    if (seriesRef.current && chartRef.current) {\r\n      // Reload candles for new symbol\r\n      const loadCandles = async () => {\r\n        try {\r\n          const realtimeService = getRealtimeMarketDataService();\r\n          const symbol = selected.symbol.includes(':')\r\n            ? selected.symbol.split(':')[1]\r\n            : selected.symbol;\r\n          const candles = await realtimeService.getHistoricalCandles(symbol, 'D');\r\n\r\n          if (candles.length > 0 && seriesRef.current) {\r\n            const candleData = candles.map(c => ({\r\n              time: (c.time / 1000) as any,\r\n              open: c.open,\r\n              high: c.high,\r\n              low: c.low,\r\n              close: c.close,\r\n            }));\r\n            seriesRef.current.setData(candleData);\r\n          }\r\n        } catch (error) {\r\n          console.error('[Trade] Failed to reload candles for new symbol:', error);\r\n        }\r\n      };\r\n\r\n      loadCandles();\r\n    }\r\n  }, [selected]);\r\n\r\n  // Update orderbook from WebSocket\r\n  useEffect(() => {\r\n    if (wsOrderbook && wsConnected) {\r\n      setOrderBookBids(\r\n        wsOrderbook.bids\r\n          .map((b: any) => ({\r\n            price: b.price,\r\n            quantity: b.size || b.quantity,\r\n          }))\r\n          .sort((a, b) => b.price - a.price)\r\n      );\r\n      setOrderBookAsks(\r\n        wsOrderbook.asks\r\n          .map((a: any) => ({\r\n            price: a.price,\r\n            quantity: a.size || a.quantity,\r\n          }))\r\n          .sort((a, b) => a.price - b.price)\r\n      );\r\n    } else if (!wsConnected) {\r\n      // Fallback: Generate mock order book if WS not connected\r\n      const generateOrderBook = () => {\r\n        const basePrice = price;\r\n        const bids: OrderBookEntry[] = [];\r\n        const asks: OrderBookEntry[] = [];\r\n\r\n        for (let i = 0; i < 10; i++) {\r\n          bids.push({\r\n            price: basePrice - (i + 1) * (basePrice * 0.001),\r\n            quantity: Math.floor(Math.random() * 1000) + 100,\r\n          });\r\n          asks.push({\r\n            price: basePrice + (i + 1) * (basePrice * 0.001),\r\n            quantity: Math.floor(Math.random() * 1000) + 100,\r\n          });\r\n        }\r\n\r\n        setOrderBookBids(bids.sort((a, b) => b.price - a.price));\r\n        setOrderBookAsks(asks.sort((a, b) => a.price - b.price));\r\n      };\r\n\r\n      generateOrderBook();\r\n      const interval = setInterval(generateOrderBook, 2000);\r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [wsOrderbook, wsConnected, price]);\r\n\r\n  // Mock trades tape (replace with real WebSocket feed)\r\n  useEffect(() => {\r\n    const generateTrade = () => {\r\n      const newTrade: Trade = {\r\n        id: `trade-${Date.now()}`,\r\n        price: price + (Math.random() - 0.5) * (price * 0.002),\r\n        quantity: Math.floor(Math.random() * 500) + 10,\r\n        side: Math.random() > 0.5 ? 'buy' : 'sell',\r\n        timestamp: Date.now(),\r\n      };\r\n      setRecentTrades(prev => [...prev.slice(-19), newTrade]);\r\n    };\r\n\r\n    const interval = setInterval(generateTrade, 3000); // New trade every 3s\r\n    return () => clearInterval(interval);\r\n  }, [price]);\r\n\r\n  const handleOrderClick = useCallback(\r\n    (side: 'buy' | 'sell') => {\r\n      const orderPrice = orderType === 'market' ? price : limitPrice;\r\n      const estimatedCost = orderPrice * qty;\r\n      const fees = estimatedCost * 0.001; // 0.1% fee\r\n      const marginRequired = orderType === 'market' ? estimatedCost * 0.1 : undefined; // 10% margin for market orders\r\n\r\n      const order: OrderDetails = {\r\n        side,\r\n        symbol: selected.name,\r\n        quantity: qty,\r\n        price: orderPrice,\r\n        orderType: orderType as 'market' | 'limit',\r\n        stopLoss: sl > 0 ? sl : undefined,\r\n        takeProfit: tp > 0 ? tp : undefined,\r\n        estimatedCost,\r\n        fees,\r\n        marginRequired,\r\n      };\r\n\r\n      setPendingOrder(order);\r\n      setShowConfirmModal(true);\r\n    },\r\n    [qty, price, limitPrice, orderType, sl, tp, selected.name]\r\n  );\r\n\r\n  const handleConfirmOrder = useCallback(async () => {\r\n    if (!pendingOrder || isPlacingOrder) return;\r\n\r\n    setIsPlacingOrder(true);\r\n    try {\r\n      // Try mock server first, then fallback to tradeApi\r\n      const API_BASE = import.meta.env.VITE_API_BASE_URL || 'http://localhost:4001';\r\n      const symbolKey = selected.symbol.includes(':')\r\n        ? selected.symbol.split(':')[1]\r\n        : selected.symbol;\r\n\r\n      try {\r\n        const response = await fetch(`${API_BASE}/api/orders`, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            symbol: symbolKey,\r\n            side: pendingOrder.side,\r\n            qty: pendingOrder.quantity,\r\n            price: pendingOrder.orderType === 'limit' ? pendingOrder.price : undefined,\r\n            type: pendingOrder.orderType,\r\n          }),\r\n        });\r\n\r\n        if (response.ok) {\r\n          const result = await response.json();\r\n          toast.success(\r\n            `${pendingOrder.side.toUpperCase()} order placed: ${pendingOrder.quantity}  ${pendingOrder.symbol} @ ${selected.currency}${pendingOrder.price.toLocaleString(undefined, { minimumFractionDigits: 2 })}\\nOrder ID: ${result.orderId} | Filled: ${result.filled}`\r\n          );\r\n          setShowConfirmModal(false);\r\n          setPendingOrder(null);\r\n          setIsPlacingOrder(false);\r\n          return;\r\n        }\r\n      } catch {\r\n        console.debug('[Trade] Mock server not available, trying tradeApi');\r\n      }\r\n\r\n      // Fallback to tradeApi\r\n      const { tradeApi } = await import('../../lib/api-client');\r\n      const result = await tradeApi.placeOrder({\r\n        symbol: selected.symbol,\r\n        quantity: pendingOrder.quantity,\r\n        orderType: pendingOrder.side,\r\n        stopLoss: pendingOrder.stopLoss,\r\n        takeProfit: pendingOrder.takeProfit,\r\n      });\r\n      if (result.success) {\r\n        toast.success(\r\n          `${pendingOrder.side.toUpperCase()} order placed: ${pendingOrder.quantity}  ${pendingOrder.symbol} @ ${selected.currency}${pendingOrder.price.toLocaleString(undefined, { minimumFractionDigits: 2 })}\\nOrder ID: ${result.orderId}`\r\n        );\r\n        setShowConfirmModal(false);\r\n        setPendingOrder(null);\r\n      }\r\n    } catch (error) {\r\n      console.error('[Trade] Order placement failed:', error);\r\n      toast.error(`Failed to place ${pendingOrder.side} order. Please try again.`);\r\n    } finally {\r\n      setIsPlacingOrder(false);\r\n    }\r\n  }, [pendingOrder, isPlacingOrder, selected.symbol, selected.currency]);\r\n\r\n  // Keyboard shortcuts\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (showConfirmModal) {\r\n        if (e.key === 'Enter') {\r\n          e.preventDefault();\r\n          handleConfirmOrder();\r\n        } else if (e.key === 'Escape') {\r\n          e.preventDefault();\r\n          setShowConfirmModal(false);\r\n          setPendingOrder(null);\r\n        }\r\n      } else {\r\n        if (e.key === 'b' || e.key === 'B') {\r\n          e.preventDefault();\r\n          handleOrderClick('buy');\r\n        } else if (e.key === 's' || e.key === 'S') {\r\n          e.preventDefault();\r\n          handleOrderClick('sell');\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [showConfirmModal, handleOrderClick, handleConfirmOrder]);\r\n\r\n  // Track price changes for cached data\r\n  useEffect(() => {\r\n    if (price) {\r\n      setLastPrice(price);\r\n      setLastChange(change);\r\n      setLastUpdate(new Date());\r\n    }\r\n  }, [price, change]);\r\n\r\n  // Handle connection errors\r\n  useEffect(() => {\r\n    if (!wsConnected && lastPrice === null) {\r\n      // Only set error if we've never had a connection\r\n      setConnectionError(new Error('WebSocket connection not established'));\r\n    } else if (!wsConnected && lastPrice !== null) {\r\n      // Connection lost but we have cached data\r\n      setConnectionError(new Error('Connection lost - showing cached data'));\r\n    } else {\r\n      setConnectionError(null);\r\n    }\r\n  }, [wsConnected, lastPrice]);\r\n\r\n  return (\r\n    <div className=\"flex h-full flex-col overflow-hidden bg-black text-white\">\r\n      {/* Trade Fallback UI - Show when disconnected and no cached data */}\r\n      {!wsConnected && lastPrice === null && (\r\n        <div className=\"p-4\">\r\n          <div className=\"text-center p-8 text-gray-400\">\r\n            <p>Trade mode fallback - service unavailable</p>\r\n            <p className=\"text-sm mt-2\">{connectionError?.message || 'WebSocket disconnected'}</p>\r\n            <button\r\n              onClick={async () => {\r\n                setConnectionError(null);\r\n                // Trigger reconnection by re-enabling the hook\r\n                // The useRealtimeTrade hook should handle reconnection\r\n                console.log('[Trade] Retrying connection...');\r\n              }}\r\n              className=\"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\"\r\n            >\r\n              Retry Connection\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Show cached data warning when disconnected but have data */}\r\n      {!wsConnected && lastPrice !== null && (\r\n        <div className=\"border-b border-yellow-500/40 bg-yellow-500/10 px-4 py-2 text-sm text-yellow-100\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <span> Showing cached data - Connection lost</span>\r\n            <button\r\n              onClick={async () => {\r\n                setConnectionError(null);\r\n                console.log('[Trade] Retrying connection...');\r\n              }}\r\n              className=\"rounded bg-yellow-500/20 px-2 py-1 text-xs hover:bg-yellow-500/30\"\r\n            >\r\n              Retry\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Mode Switcher Header */}\r\n      <div className=\"sticky top-0 z-30 flex flex-shrink-0 items-center justify-between border-b border-purple-800 bg-black/80 px-4 py-2 backdrop-blur\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <TrendingUp className=\"h-5 w-5 text-emerald-400\" />\r\n          <h1 className=\"text-sm font-semibold text-white md:text-lg\">Trade Mode</h1>\r\n        </div>\r\n        <div className=\"flex items-center gap-1 rounded-lg border border-slate-700/50 bg-slate-800/60 p-1\">\r\n          <button\r\n            onClick={() => setMode('Browse')}\r\n            className={`flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium transition-all md:px-3 md:py-1.5 md:text-sm ${\r\n              currentMode === 'Browse'\r\n                ? 'bg-emerald-600 text-white shadow-lg shadow-emerald-500/30'\r\n                : 'text-gray-400 hover:bg-slate-700/50 hover:text-white'\r\n            }`}\r\n            title=\"Switch to Browse Mode\"\r\n          >\r\n            <Globe size={12} />\r\n            <span className=\"hidden sm:inline\">Browse</span>\r\n          </button>\r\n          <button\r\n            onClick={() => setMode('Research')}\r\n            className={`flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium transition-all md:px-3 md:py-1.5 md:text-sm ${\r\n              currentMode === 'Research'\r\n                ? 'bg-emerald-600 text-white shadow-lg shadow-emerald-500/30'\r\n                : 'text-gray-400 hover:bg-slate-700/50 hover:text-white'\r\n            }`}\r\n            title=\"Switch to Research Mode\"\r\n          >\r\n            <Sparkles size={12} />\r\n            <span className=\"hidden sm:inline\">Research</span>\r\n          </button>\r\n          <button\r\n            onClick={() => setMode('Trade')}\r\n            className={`flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium transition-all md:px-3 md:py-1.5 md:text-sm ${\r\n              currentMode === 'Trade'\r\n                ? 'bg-emerald-600 text-white shadow-lg shadow-emerald-500/30'\r\n                : 'text-gray-400 hover:bg-slate-700/50 hover:text-white'\r\n            }`}\r\n            title=\"Switch to Trade Mode\"\r\n          >\r\n            <TrendingUp size={12} />\r\n            <span className=\"hidden sm:inline\">Trade</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Market Selector */}\r\n      <div className=\"z-20 flex-shrink-0 bg-gradient-to-r from-purple-800 to-pink-800 p-3 md:p-4\">\r\n        <div className=\"scrollbar-hide flex gap-2 overflow-x-auto md:gap-3\">\r\n          {markets.map(m => (\r\n            <button\r\n              key={m.symbol}\r\n              onClick={() => setSelected(m)}\r\n              className={`flex flex-shrink-0 items-center gap-2 whitespace-nowrap rounded-full px-4 py-2 font-bold transition-all md:px-6 md:py-3 ${\r\n                selected.symbol === m.symbol\r\n                  ? 'scale-110 bg-white/30 shadow-2xl'\r\n                  : 'bg-white/10 hover:bg-white/20'\r\n              }`}\r\n            >\r\n              {m.exchange === 'NSE' && <IndianRupee className=\"h-3 w-3 md:h-4 md:w-4\" />}\r\n              {m.exchange === 'Crypto' && <Bitcoin className=\"h-3 w-3 md:h-4 md:w-4\" />}\r\n              {(m.exchange === 'NYSE' || m.exchange === 'NASDAQ' || m.exchange === 'Forex') && (\r\n                <DollarSign className=\"h-3 w-3 md:h-4 md:w-4\" />\r\n              )}\r\n              <span className=\"text-xs md:text-sm\">\r\n                {m.currency} {m.name}\r\n              </span>\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Live Price */}\r\n      <div className=\"z-10 flex-shrink-0 border-b border-gray-800 p-4 md:p-8\">\r\n        <div className=\"flex flex-col items-start justify-between gap-4 md:flex-row md:items-end\">\r\n          <div>\r\n            <h1 className=\"text-4xl font-black md:text-7xl\">{selected.name}</h1>\r\n            <div\r\n              className={`mt-2 text-3xl font-bold md:mt-4 md:text-6xl ${isGreen ? 'text-green-400' : 'text-red-400'}`}\r\n            >\r\n              {selected.currency}\r\n              {price.toLocaleString('en-IN', { minimumFractionDigits: 2 })}\r\n              <span className=\"ml-3 text-xl md:ml-6 md:text-4xl\">\r\n                {isGreen ? '' : ''} {change.toFixed(1)} (\r\n                {((change / (price - change)) * 100).toFixed(2)}%)\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div className=\"text-left text-sm text-gray-400 md:text-right md:text-base\">\r\n            <div>High: {selected.currency}25,120</div>\r\n            <div>Low: {selected.currency}24,720</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Content Grid - Responsive */}\r\n      <div className=\"grid flex-1 grid-cols-12 gap-4 overflow-hidden p-4\">\r\n        {/* Chart Area */}\r\n        <div className=\"col-span-12 flex flex-col lg:col-span-8\">\r\n          <div\r\n            ref={chartContainerRef}\r\n            className=\"relative h-[420px] w-full overflow-hidden rounded-lg border border-[#222] bg-[#030303]\"\r\n          >\r\n            {chartLoading && (\r\n              <div className=\"absolute inset-0 z-20 flex items-center justify-center bg-black/50\">\r\n                <div className=\"flex flex-col items-center gap-2\">\r\n                  <Loader2 className=\"h-8 w-8 animate-spin text-emerald-400\" />\r\n                  <span className=\"text-sm text-gray-400\">Loading chart data...</span>\r\n                </div>\r\n              </div>\r\n            )}\r\n            <div className=\"absolute left-4 top-4 z-10 rounded-lg border border-gray-700 bg-black/70 px-4 py-2 text-xs backdrop-blur md:text-sm\">\r\n              1D  EMA  RSI  Volume Profile\r\n              {wsConnected && <span className=\"ml-2 text-green-400\"> Live</span>}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Trades Tape below chart */}\r\n          <div className=\"mt-4\">\r\n            <TradesTape trades={recentTrades} symbol={selected.name} />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Right Sidebar */}\r\n        <div className=\"col-span-12 flex flex-col gap-4 lg:col-span-4\">\r\n          {/* Order Book */}\r\n          <OrderBook\r\n            bids={orderBookBids}\r\n            asks={orderBookAsks}\r\n            onPriceClick={(price, _side) => {\r\n              setLimitPrice(price);\r\n              setOrderType('limit');\r\n            }}\r\n          />\r\n\r\n          {/* Stats Cards */}\r\n          <div className=\"grid grid-cols-2 gap-2\">\r\n            <div className=\"rounded-lg border border-gray-700 bg-gray-900 p-3\">\r\n              <div className=\"mb-1 text-xs text-gray-400\">High</div>\r\n              <div className=\"text-sm font-semibold text-white\">{selected.currency}25,120</div>\r\n            </div>\r\n            <div className=\"rounded-lg border border-gray-700 bg-gray-900 p-3\">\r\n              <div className=\"mb-1 text-xs text-gray-400\">Low</div>\r\n              <div className=\"text-sm font-semibold text-white\">{selected.currency}24,720</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Order Panel */}\r\n      <motion.div\r\n        initial={{ y: 200 }}\r\n        animate={{ y: 0 }}\r\n        className=\"trade-controls fixed bottom-0 left-0 right-0 z-40 border-t-4 border-purple-600 bg-black/95 p-4 shadow-2xl backdrop-blur md:p-6\"\r\n      >\r\n        <div className=\"mx-auto max-w-6xl\">\r\n          <div className=\"grid grid-cols-2 gap-3 md:grid-cols-6 md:gap-4\">\r\n            <input\r\n              type=\"number\"\r\n              value={qty}\r\n              onChange={e => setQty(+e.target.value || 0)}\r\n              className=\"rounded-xl bg-gray-900 px-3 py-3 text-center text-xl font-bold text-white focus:outline-none focus:ring-2 focus:ring-purple-500 md:px-6 md:py-5 md:text-3xl\"\r\n              placeholder=\"Qty\"\r\n              aria-label=\"Quantity\"\r\n            />\r\n            <select\r\n              value={orderType}\r\n              onChange={e => setOrderType(e.target.value as 'market' | 'limit')}\r\n              className=\"rounded-xl bg-gray-900 px-3 py-3 text-center text-lg font-bold text-white focus:outline-none focus:ring-2 focus:ring-purple-500 md:px-6 md:py-5 md:text-2xl\"\r\n              aria-label=\"Order Type\"\r\n            >\r\n              <option value=\"market\">Market</option>\r\n              <option value=\"limit\">Limit</option>\r\n            </select>\r\n            {orderType === 'limit' && (\r\n              <input\r\n                type=\"number\"\r\n                value={limitPrice}\r\n                onChange={e => setLimitPrice(+e.target.value || price)}\r\n                className=\"rounded-xl bg-gray-900 px-3 py-3 text-center text-xl font-bold text-white focus:outline-none focus:ring-2 focus:ring-purple-500 md:px-6 md:py-5 md:text-3xl\"\r\n                placeholder=\"Price\"\r\n                aria-label=\"Limit Price\"\r\n              />\r\n            )}\r\n            <input\r\n              type=\"number\"\r\n              value={sl}\r\n              onChange={e => setSl(+e.target.value || 0)}\r\n              className=\"rounded-xl border-2 border-red-600 bg-red-900/50 px-3 py-3 text-center text-xl font-bold text-white focus:outline-none focus:ring-2 focus:ring-red-500 md:px-6 md:py-5 md:text-3xl\"\r\n              placeholder=\"SL\"\r\n              aria-label=\"Stop Loss\"\r\n            />\r\n            <input\r\n              type=\"number\"\r\n              value={tp}\r\n              onChange={e => setTp(+e.target.value || 0)}\r\n              className=\"rounded-xl border-2 border-green-600 bg-green-900/50 px-3 py-3 text-center text-xl font-bold text-white focus:outline-none focus:ring-2 focus:ring-green-500 md:px-6 md:py-5 md:text-3xl\"\r\n              placeholder=\"Target\"\r\n              aria-label=\"Take Profit\"\r\n            />\r\n            <button\r\n              onClick={() => handleOrderClick('buy')}\r\n              disabled={isPlacingOrder}\r\n              className={`flex items-center justify-center gap-2 rounded-2xl bg-green-600 font-black shadow-2xl transition-all hover:bg-green-500 active:scale-95 disabled:cursor-not-allowed disabled:opacity-50 ${\r\n                isMobile\r\n                  ? 'py-3 text-lg'\r\n                  : isTablet\r\n                    ? 'py-4 text-2xl'\r\n                    : 'py-4 text-xl md:py-6 md:text-4xl'\r\n              }`}\r\n              title=\"Buy (Press B)\"\r\n            >\r\n              {isPlacingOrder ? (\r\n                <>\r\n                  <Loader2 className=\"h-6 w-6 animate-spin\" />\r\n                  <span>PLACING...</span>\r\n                </>\r\n              ) : (\r\n                'BUY'\r\n              )}\r\n            </button>\r\n            <button\r\n              onClick={() => handleOrderClick('sell')}\r\n              disabled={isPlacingOrder}\r\n              className={`flex items-center justify-center gap-2 rounded-2xl bg-red-600 font-black shadow-2xl transition-all hover:bg-red-500 active:scale-95 disabled:cursor-not-allowed disabled:opacity-50 ${\r\n                isMobile\r\n                  ? 'py-3 text-lg'\r\n                  : isTablet\r\n                    ? 'py-4 text-2xl'\r\n                    : 'py-4 text-xl md:py-6 md:text-4xl'\r\n              }`}\r\n              title=\"Sell (Press S)\"\r\n            >\r\n              {isPlacingOrder ? (\r\n                <>\r\n                  <Loader2 className=\"h-6 w-6 animate-spin\" />\r\n                  <span>PLACING...</span>\r\n                </>\r\n              ) : (\r\n                'SELL'\r\n              )}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </motion.div>\r\n\r\n      {/* Order Confirmation Modal */}\r\n      <OrderConfirmModal\r\n        isOpen={showConfirmModal}\r\n        order={pendingOrder}\r\n        onConfirm={handleConfirmOrder}\r\n        onCancel={() => {\r\n          setShowConfirmModal(false);\r\n          setPendingOrder(null);\r\n        }}\r\n        warnings={\r\n          pendingOrder && pendingOrder.quantity * pendingOrder.price > 100000\r\n            ? ['Large order size - ensure sufficient margin']\r\n            : []\r\n        }\r\n        errors={\r\n          pendingOrder && pendingOrder.quantity <= 0 ? ['Quantity must be greater than 0'] : []\r\n        }\r\n      />\r\n      <TradeStagehandIntegration />\r\n    </div>\r\n  );\r\n}\r\n"],"file":"mode-trade-BU963YAc.js"}