const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/mode-research-BclgCwOH.js","chunks/vendor-react-gmX1Lmvt.js","chunks/vendor-react-dom-Bkb6jJ_S.js","chunks/vendor-Vl2WtvH-.js","chunks/vendor-utils-5Vdoy44w.js","chunks/core-memory-DmK-uh9X.js","chunks/mode-docs-FcsoolLb.js","chunks/vendor-pdf-ejcqEZLU.js","chunks/vendor-mammoth-BPQIafDs.js","chunks/vendor-framer-motion-DDE19Uim.js","chunks/vendor-zustand-BWsgwsXr.js","chunks/meiliIndexer-C-Al5lgE.js","chunks/mode-manager.ts-DwguZmJt.js"])))=>i.map(i=>d[i]);
import{c as B,p as re}from"./vendor-zustand-BWsgwsXr.js";import{M as ot}from"./mode-manager.ts-DwguZmJt.js";import{z as C,n as oe,r as it}from"./vendor-react-gmX1Lmvt.js";import{t as ct,s as me,p as qe,M as lt}from"./core-memory-DmK-uh9X.js";import{P as dt}from"./vendor-Vl2WtvH-.js";const ut="modulepreload",pt=function(e){return"/"+e},_e={},A=function(t,r,s){let n=Promise.resolve();if(r&&r.length>0){let l=function(d){return Promise.all(d.map(u=>Promise.resolve(u).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),i=c?.nonce||c?.getAttribute("nonce");n=l(r.map(d=>{if(d=pt(d),d in _e)return;_e[d]=!0;const u=d.endsWith(".css"),p=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${p}`))return;const g=document.createElement("link");if(g.rel=u?"stylesheet":ut,u||(g.as="script"),g.crossOrigin="",g.href=d,i&&g.setAttribute("nonce",i),document.head.appendChild(g),u)return new Promise((f,v)=>{g.addEventListener("load",f),g.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(c){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=c,window.dispatchEvent(i),!i.defaultPrevented)throw c}return n.then(c=>{for(const i of c||[])i.status==="rejected"&&o(i.reason);return t().catch(o)})},ie={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var ce={};const ye=e=>{if(typeof process<"u"&&ce&&ce[e]!==void 0)return ce[e];if(typeof import.meta<"u"&&ie&&ie[e]!==void 0)return ie[e]},ze=()=>{const e=ye("NODE_ENV");return e?e==="development":ye("MODE")==="development"},$=()=>typeof window>"u"?!1:!!window.__TAURI__,N=()=>{if(typeof window>"u"||$())return!1;const e=window.ipc;return e&&typeof e.invoke=="function"||window.electron?!0:typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.includes("Electron"):!1},je=()=>!(typeof window>"u"||N()||$()),Hr=Object.freeze(Object.defineProperty({__proto__:null,getEnvVar:ye,isDevEnv:ze,isElectronRuntime:N,isTauriRuntime:$,isWebMode:je},Symbol.toStringTag,{value:"Module"}));let U=!0,Z=null;const ee=new Set,ht=8e3;function Wr(){return U}function gt(){return U||Z===null?!0:Date.now()-Z>=ht}function Pe(){U||(U=!0,Z=null,ee.forEach(e=>{try{e(!0)}catch(t){console.warn("[BackendStatus] Listener failed while marking online:",t)}}))}function ft(e){U&&(U=!1),Z=Date.now(),ee.forEach(t=>{try{t(!1)}catch(r){console.warn("[BackendStatus] Listener failed while marking offline:",r)}})}function Jr(e){return ee.add(e),()=>ee.delete(e)}const mt=typeof window<"u"&&(window.__API_BASE_URL||void 0||void 0)||"http://127.0.0.1:4000";async function h(e,t={}){if(je())return Promise.reject(new Error("Backend not available in web mode"));const{method:r="GET",body:s,headers:n={},params:o}=t;let c=`${mt}${e}`;if(o){const l=new URLSearchParams(o);c+=`?${l.toString()}`}const i={method:r,headers:{"Content-Type":"application/json",...n}};if(s&&(r==="POST"||r==="PUT")&&(i.body=JSON.stringify(s)),!gt())throw new Error("Backend offline");try{const l=await fetch(c,i);if(!l.ok){const p=await l.text();throw new Error(`API request failed: ${l.statusText} - ${p}`)}const d=l.headers.get("content-type");if(d&&d.includes("application/json")){const p=await l.json();return Pe(),p}const u=await l.text();return Pe(),u}catch(l){throw typeof window<"u"&&!window.__ELECTRON__&&!window.__TAURI__||console.error(`[API Client] Request failed for ${e}:`,l),ft(),l}}const Ge={list:()=>h("/api/tabs"),create:e=>h("/api/tabs",{method:"POST",body:e}),close:e=>h(`/api/tabs/${e}`,{method:"DELETE"}),activate:e=>h(`/api/tabs/${e}/activate`,{method:"POST"}),navigate:e=>h(`/api/tabs/${e.id}/navigate`,{method:"POST",body:{url:e.url}}),goBack:e=>h(`/api/tabs/${e}/back`,{method:"POST"}),goForward:e=>h(`/api/tabs/${e}/forward`,{method:"POST"}),reload:(e,t)=>h(`/api/tabs/${e}/reload`,{method:"POST",body:t||{}}),stop:e=>h(`/api/tabs/${e}/stop`,{method:"POST"}),createWithProfile:e=>h("/api/tabs",{method:"POST",body:{url:e.url,profileId:e.accountId}}),overlayStart:()=>h("/api/tabs/overlay/start",{method:"POST"}),overlayGetPick:()=>h("/api/tabs/overlay/pick"),overlayClear:()=>h("/api/tabs/overlay/clear",{method:"POST"}),predictiveGroups:()=>h("/api/tabs/predictive-groups")},He={list:()=>h("/api/sessions"),create:e=>h("/api/sessions",{method:"POST",body:e}),getActive:()=>h("/api/sessions/active"),setActive:e=>h(`/api/sessions/${e}/activate`,{method:"POST"}),get:e=>h(`/api/sessions/${e}`),delete:e=>h(`/api/sessions/${e}`,{method:"DELETE"}),update:e=>h(`/api/sessions/${e.sessionId}`,{method:"PUT",body:e}),getPartition:e=>h(`/api/sessions/${e}/partition`)},We={start:e=>h("/api/agent/start",{method:"POST",body:{dsl:e}}),status:e=>h(`/api/agent/status/${e}`),runs:()=>h("/api/agent/runs"),executeSkill:e=>h("/api/agent/execute-skill",{method:"POST",body:e}),ask:e=>h("/api/agent/ask",{method:"POST",body:e}),query:e=>h("/api/agent/query",{method:"POST",body:e})},Je={getStatus:()=>h("/api/system/status"),ping:()=>h("/api/ping")},Ve={query:e=>h("/api/research/query",{method:"POST",body:{query:e}}),queryEnhanced:e=>h("/api/research/enhanced",{method:"POST",body:e}),run:e=>h("/api/research/run",{method:"POST",body:e}),getStatus:e=>h(`/api/research/status/${e}`)},yt={getQuote:e=>h(`/api/trade/quote/${e}`),getCandles:(e,t="1d",r=50)=>h(`/api/trade/candles/${e}?interval=${t}&limit=${r}`),placeOrder:e=>h("/api/trade/order",{method:"POST",body:e})},Ke={checkRestore:()=>h("/api/session/check-restore"),getSnapshot:()=>h("/api/session/snapshot"),dismissRestore:()=>h("/api/session/dismiss-restore",{method:"POST"}),saveTabs:()=>h("/api/session/save-tabs",{method:"POST"}),loadTabs:()=>h("/api/session/load-tabs"),addHistory:e=>h("/api/session/add-history",{method:"POST",body:e}),getHistory:e=>h("/api/session/history",{params:e.limit?{limit:e.limit.toString()}:void 0}),searchHistory:e=>h("/api/session/search-history",{method:"POST",body:e}),saveSetting:e=>h("/api/session/save-setting",{method:"POST",body:e}),getSetting:e=>h(`/api/session/get-setting/${e.key}`)},y={tabs:Ge,sessions:He,agent:We,system:Je,research:Ve,session:Ke},Vr=Object.freeze(Object.defineProperty({__proto__:null,agentApi:We,default:y,researchApi:Ve,sessionStateApi:Ke,sessionsApi:He,systemApi:Je,tabsApi:Ge,tradeApi:yt},Symbol.toStringTag,{value:"Module"})),ke="regen_session_v1",wt=2e3;let Y=null;function bt(e){try{const t=JSON.stringify({...e,savedAt:Date.now()});localStorage.setItem(ke,t)}catch(t){console.error("[Session] Failed to save session:",t)}}function vt(){try{const e=localStorage.getItem(ke);if(!e)return null;const t=JSON.parse(e);return!t.tabs||!Array.isArray(t.tabs)?null:t}catch(e){return console.error("[Session] Failed to load session:",e),null}}function Kr(){try{localStorage.removeItem(ke)}catch(e){console.error("[Session] Failed to clear session:",e)}}function le(e){Y&&clearTimeout(Y),Y=setTimeout(()=>{bt(e),Y=null},wt)}function Qr(){const e=vt();return e?{tabCount:e.tabs.length,savedAt:e.savedAt}:null}const b=[],V=new Map;let T={};const R=new Map,Qe=50,J=[],St=100,Ye="redix:event-log",Xe=1e3;let Ze=!1,Ee=!1;async function It(){if(!Ee){Ee=!0;try{if(typeof window<"u"&&window.localStorage){const e=localStorage.getItem(Ye);if(e){const t=JSON.parse(e);if(Array.isArray(t.events)){const r=t.events.slice(-Xe);if(b.length=0,b.push(...r),t.snapshots){R.clear();for(const[s,n]of Object.entries(t.snapshots))R.set(Number(s),n)}se(),console.log(`[Redix] Loaded ${b.length} events from storage`)}}Ze=!0}}catch(e){console.warn("[Redix] Failed to initialize persistence:",e)}}}function At(){if(Ze)try{if(typeof window<"u"&&window.localStorage){const e=b.slice(-Xe),t={};for(const[r,s]of R.entries())t[r]=s;localStorage.setItem(Ye,JSON.stringify({events:e,snapshots:t,lastUpdated:Date.now()}))}}catch(e){console.warn("[Redix] Failed to persist event log:",e)}}function q(e,t){if(typeof t!="function")throw new Error(`Reducer must be a function, got ${typeof t}`);V.set(e,t)}function kt(e){const t={id:`event_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),...e};if(b.push(t),t.reducer){const r=V.get(t.reducer);r&&(T=r(T,t))}return b.length%Qe===0&&R.set(b.length-1,{...T}),b.length%10===0&&At(),t}function j(){return{...T}}function we(e){if(e<0||e>=b.length)throw new Error(`Invalid event index: ${e}`);let t=-1,r={};for(const[s,n]of R.entries())s<=e&&s>t&&(t=s,r={...n});for(let s=t+1;s<=e;s++){const n=b[s];if(n.reducer){const o=V.get(n.reducer);o&&(r=o(r,n))}}return r}function xt(e){const t=b.findIndex(r=>r.timestamp>e);return t===-1?j():t===0?{}:we(t-1)}function se(){T={},R.clear();for(let e=0;e<b.length;e++){const t=b[e];if(t.reducer){const r=V.get(t.reducer);r&&(T=r(T,t))}(e+1)%Qe===0&&R.set(e,{...T})}return T}function Ce(){return[...b]}function Yr(e){return b.filter(t=>t.type===e)}function Tt(){if(b.length===0)return null;const e=b.pop();return J.push(e),J.length>St&&J.shift(),se()}function _t(){if(J.length===0)return null;const e=J.pop();if(b.push(e),e.reducer){const t=V.get(e.reducer);t&&(T=t(T,e))}return se()}function Xr(){return JSON.stringify({events:b,state:T,snapshotIndices:Array.from(R.keys())},null,2)}function Zr(e){try{const t=JSON.parse(e);b.length=0,b.push(...t.events),R.clear(),se()}catch(t){throw new Error(`Failed to import event log: ${t}`)}}const Pt=(e,t)=>{const r=e.tabs||{};switch(t.type){case"redix:tab:suspend":return{...e,tabs:{...r,[t.payload.tabId]:{...r[t.payload.tabId],suspended:!0,suspendedAt:t.timestamp}}};case"redix:tab:resume":return{...e,tabs:{...r,[t.payload.tabId]:{...r[t.payload.tabId],suspended:!1,resumedAt:t.timestamp}}};case"redix:tab:activate":return{...e,tabs:{...r,[t.payload.tabId]:{...r[t.payload.tabId],active:!0,lastActive:t.timestamp}},activeTabId:t.payload.tabId};case"redix:tab:memory":return{...e,tabs:{...r,[t.payload.tabId]:{...r[t.payload.tabId],memoryMB:t.payload.memoryMB,memoryUpdatedAt:t.timestamp}}};default:return e}},Et=(e,t)=>{const r=e.metrics||{};switch(t.type){case"redix:metrics:update":return{...e,metrics:{...r,cpu:t.payload.cpu,memory:t.payload.memory,battery:t.payload.battery,updatedAt:t.timestamp}};case"redix:metrics:threshold":return{...e,metrics:{...r,thresholds:{memory:t.payload.memoryThreshold,cpu:t.payload.cpuThreshold,battery:t.payload.batteryThreshold}}};default:return e}},Ct=(e,t)=>{switch(t.type){case"redix:policy:update":return{...e,policy:t.payload,policyUpdatedAt:t.timestamp};case"redix:policy:mode":return{...e,policyMode:t.payload.mode,policy:t.payload.policy,policyUpdatedAt:t.timestamp};default:return e}},Ot=(e,t)=>{switch(t.type){case"redix:ai:optimize":return{...e,aiOptimizations:{...e.aiOptimizations||{},[t.timestamp]:{suggestion:t.payload.suggestion,action:t.payload.action,confidence:t.payload.confidence,applied:t.payload.applied||!1}},lastAIOptimization:t.timestamp};default:return e}},Rt=(e,t)=>{const r=e.resources||{};switch(t.type){case"redix:resource:allocate":return{...e,resources:{...r,[t.payload.resourceId]:{...r[t.payload.resourceId],allocated:!0,allocatedAt:t.timestamp,priority:t.payload.priority||0}}};case"redix:resource:release":return{...e,resources:{...r,[t.payload.resourceId]:{...r[t.payload.resourceId],allocated:!1,releasedAt:t.timestamp}}};default:return e}};function Dt(){q("tab",Pt),q("performance",Et),q("policy",Ct),q("ai",Ot),q("resource",Rt)}var Mt=Object.defineProperty,Lt=(e,t,r)=>t in e?Mt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,L=(e,t,r)=>Lt(e,typeof t!="symbol"?t+"":t,r);const Oe=200,$t=100,Nt=5,be=50,Ft=2;class Ut{constructor(){L(this,"listeners",new Map),L(this,"globalListeners",new Set),L(this,"eventHistory",[]),L(this,"snapshots",[]),L(this,"initialized",!1),L(this,"initPromise",null),L(this,"dispatchCount",0)}ensureInitialized(){this.initialized||this.initPromise||(this.initPromise=It().catch(t=>{console.warn("[Redix] Persistence init failed:",t)}).finally(()=>{try{Dt()}catch(t){console.warn("[Redix] Default reducers failed to register:",t)}this.initialized=!0,this.initPromise=null}))}watch(t,r){if(typeof t=="function")return this.globalListeners.add(t),()=>this.globalListeners.delete(t);if(!r)throw new Error("Handler required when watching specific event type");return this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(r),()=>{const s=this.listeners.get(t);s&&(s.delete(r),s.size===0&&this.listeners.delete(t))}}dispatch(t){this.ensureInitialized();const r=j(),s=kt({type:t.type,payload:t.payload,reducer:t.reducer,metadata:{...t.metadata||{},source:t.source||t.metadata?.source}}),n=j(),o=Bt(r,n),c={...s,source:t.source,ts:s.timestamp,prevState:r,nextState:n,diff:o};return this.recordEvent(c),this.maybeCaptureSnapshot(c),this.notifyListeners(c),c}getHistory(t,r=10){let s=this.eventHistory;return t&&(s=s.filter(n=>n.type===t)),s.slice(-r).reverse()}getState(){return j()}timeTravel(t){try{if(t.eventId){const r=Ce().findIndex(s=>s.id===t.eventId);return r>=0?we(r):null}return typeof t.eventIndex=="number"?we(t.eventIndex):typeof t.timestamp=="number"?xt(t.timestamp):null}catch(r){return console.error("[Redix] timeTravel failed:",r),null}}undo(){const t=Tt();return t&&this.syncHistoryFromLog(),t}redo(){const t=_t();return t&&this.syncHistoryFromLog(),t}getSnapshots(t=10){return this.snapshots.slice(-t).reverse()}clear(){this.listeners.clear(),this.globalListeners.clear(),this.eventHistory=[],this.snapshots=[]}recordEvent(t){this.eventHistory.push(t),this.eventHistory.length>Oe&&this.eventHistory.shift()}maybeCaptureSnapshot(t){if(this.dispatchCount+=1,this.dispatchCount%Nt!==0)return;const r={id:`snapshot_${t.id}`,eventId:t.id,eventType:t.type,timestamp:t.timestamp,state:t.nextState?{...t.nextState}:j(),diff:t.diff||[]};this.snapshots.push(r),this.snapshots.length>$t&&this.snapshots.shift()}notifyListeners(t){const r=this.listeners.get(t.type);r&&r.forEach(s=>{try{s(t)}catch(n){console.error("[Redix] Listener error:",n)}}),this.globalListeners.forEach(s=>{try{s(t)}catch(n){console.error("[Redix] Global listener error:",n)}})}syncHistoryFromLog(){const t=Ce();this.eventHistory=t.slice(-Oe).map(r=>({...r,ts:r.timestamp}))}}function Bt(e,t){if(!e&&!t)return[];const r=[];return et(e||{},t||{},"",0,r),r.slice(0,be)}function et(e,t,r,s,n){if(s>Ft||n.length>=be)return;new Set([...Object.keys(e||{}),...Object.keys(t||{})]).forEach(c=>{if(n.length>=be)return;const i=r?`${r}.${c}`:c,l=e?.[c],d=t?.[c];if(!Object.prototype.hasOwnProperty.call(t||{},c)){n.push({path:i,before:l,after:void 0});return}if(!Object.prototype.hasOwnProperty.call(e||{},c)){n.push({path:i,before:void 0,after:d});return}if(Re(l)&&Re(d)){const u=JSON.stringify(l),p=JSON.stringify(d);u!==p&&et(l,d,i,s+1,n);return}if(Array.isArray(l)&&Array.isArray(d)){const u=JSON.stringify(l),p=JSON.stringify(d);u!==p&&n.push({path:i,before:l,after:d});return}l!==d&&n.push({path:i,before:l,after:d})})}function Re(e){return Object.prototype.toString.call(e)==="[object Object]"}const qt=new Ut,G=e=>qt.dispatch(e),xe={Browse:{id:"Browse",label:"Browse",enabled:!0,comingSoon:!1,description:"Standard browsing with lightweight enhancements."},Research:{id:"Research",label:"Research",enabled:!0,comingSoon:!1,description:"AI-powered research and summarization"},Trade:{id:"Trade",label:"Trade",enabled:!0,comingSoon:!1,description:"Trading mode with TradingView integration and real-time market data"},Games:{id:"Games",label:"Games",enabled:!1,comingSoon:!0,description:"Game mode with AI recommendations (Coming Soon)"},Docs:{id:"Docs",label:"Docs",enabled:!1,comingSoon:!0,description:"Document mode (Coming Soon)"},Images:{id:"Images",label:"Images",enabled:!1,comingSoon:!0,description:"Image mode (Coming Soon)"},Threats:{id:"Threats",label:"Threats",enabled:!1,comingSoon:!0,description:"Threat intelligence mode (Coming Soon)"},GraphMind:{id:"GraphMind",label:"GraphMind",enabled:!1,comingSoon:!0,description:"GraphMind mode (Coming Soon)"}};Object.values(xe).filter(e=>e.enabled);function zt(e){return xe[e]?.enabled??!1}const H={info:(e,t)=>C(e,{icon:"ℹ️",duration:t?.duration??4e3,style:{background:"#1e293b",color:"#e2e8f0",border:"1px solid #334155"}}),success:(e,t)=>C.success(e,{duration:t?.duration??4e3,style:{background:"#1e293b",color:"#10b981",border:"1px solid #334155"}}),error:(e,t)=>C.error(e,{duration:t?.duration??5e3,style:{background:"#1e293b",color:"#ef4444",border:"1px solid #334155"}}),warning:(e,t)=>C(e,{icon:"⚠️",duration:t?.duration??4e3,style:{background:"#1e293b",color:"#f59e0b",border:"1px solid #334155"}}),loading:e=>C.loading(e,{duration:1/0,style:{background:"#1e293b",color:"#e2e8f0",border:"1px solid #334155"}}),dismiss:e=>{e?C.dismiss(e):C.dismiss()},promise:(e,t)=>C.promise(e,t,{style:{background:"#1e293b",color:"#e2e8f0",border:"1px solid #334155"},success:{style:{color:"#10b981"}},error:{style:{color:"#ef4444"}}})};function jt(e,t){switch(e){case"info":H.info(t);break;case"success":H.success(t);break;case"error":H.error(t);break;case"warning":H.warning(t);break}}const tt=Object.assign(jt,H),es=Object.freeze(Object.defineProperty({__proto__:null,toast:tt,toastLib:C},Symbol.toStringTag,{value:"Module"})),W=B((e,t)=>({mode:"Research",setMode:async r=>{const s=t().mode;if(r===s)return;if(!zt(r)){const i=xe[r];tt.info(i?.description||`${r} mode is coming soon!`);return}e({mode:r}),A(async()=>{const{track:i}=await import("./mode-research-BclgCwOH.js").then(l=>l.h);return{track:i}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(({track:i})=>{i("mode_switched",{mode:r})});const{useTabsStore:n}=await A(async()=>{const{useTabsStore:i}=await Promise.resolve().then(()=>Ht);return{useTabsStore:i}},void 0),o=n.getState(),c=o.getTabsForMode(r);if(r!=="Research"&&r!=="Trade")if(c.length===0){const l={Browse:"https://www.google.com",Research:"https://www.google.com",Trade:"https://www.tradingview.com",Games:"https://www.friv.com",Docs:"about:blank",Images:"https://www.google.com/imghp",Threats:"about:blank",GraphMind:"about:blank"}[r]||"about:blank",d=await(await A(async()=>{const{ipc:u}=await Promise.resolve().then(()=>Le);return{ipc:u}},void 0)).ipc.tabs.create(l);d&&typeof d=="object"&&"id"in d?o.updateTab(d.id,{appMode:r}):typeof d=="string"&&o.updateTab(d,{appMode:r})}else c[0]?.id&&(o.setActive(c[0].id),await(await A(async()=>{const{ipc:i}=await Promise.resolve().then(()=>Le);return{ipc:i}},void 0)).ipc.tabs.activate({id:c[0].id}));ot.activate(r).catch(console.error)},graphDockOpen:!1,toggleGraphDock:()=>{const r=!t().graphDockOpen;e({graphDockOpen:r}),window.ui?.setRightDock?.(r?360:0)},ledgerDockOpen:!1,toggleLedgerDock:()=>{const r=!t().ledgerDockOpen;e({ledgerDockOpen:r}),window.ui?.setRightDock?.(r?360:0)},researchPaneOpen:!1,toggleResearchPane:()=>{const r=!t().researchPaneOpen;e({researchPaneOpen:r}),window.ui?.setRightDock?.(r?420:0)},setResearchPaneOpen:r=>{e({researchPaneOpen:r}),window.ui?.setRightDock?.(r?420:0)},memorySidebarOpen:!1,setMemorySidebarOpen:r=>{e({memorySidebarOpen:r}),typeof window<"u"&&window.dispatchEvent(new CustomEvent("memory-sidebar:toggle",{detail:{open:r}}))},regenSidebarOpen:!1,setRegenSidebarOpen:r=>{e({regenSidebarOpen:r}),typeof window<"u"&&window.dispatchEvent(new CustomEvent("regen-sidebar:toggle",{detail:{open:r}}))},toggleRegenSidebar:()=>{const r=!t().regenSidebarOpen;t().setRegenSidebarOpen(r)}})),ts=Object.freeze(Object.defineProperty({__proto__:null,useAppStore:W},Symbol.toStringTag,{value:"Module"})),ve=["#6366f1","#8b5cf6","#f472b6","#14b8a6","#0ea5e9","#f97316","#facc15"],Gt=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`tab-group-${Math.random().toString(36).slice(2,10)}`,De=12,de=15,P=B()(re((e,t)=>({tabs:[],activeId:null,recentlyClosed:[],tabGroups:[],add:r=>e(s=>{if(s.tabs.length>=de)return s;const n={tabs:[...s.tabs,{...r,createdAt:r.createdAt??Date.now()}],activeId:r.id},o=W.getState().mode;return le({tabs:n.tabs,activeTabId:n.activeId,mode:o,savedAt:Date.now()}),A(async()=>{const{track:c}=await import("./mode-research-BclgCwOH.js").then(i=>i.h);return{track:c}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(({track:c})=>{c("tab_created",{mode:o})}),A(async()=>{const{indexTab:c}=await import("./meiliIndexer-C-Al5lgE.js");return{indexTab:c}},__vite__mapDeps([11,0,1,2,3,4,5,6,7,8,9,10,12])).then(({indexTab:c})=>{c(r).catch(console.error)}),n}),setActive:r=>{const s=t();if(r!==s.activeId){if(console.log("[TABS] setActive",{tabId:r,currentActiveId:s.activeId,totalTabs:s.tabs.length,tabIds:s.tabs.map(n=>n.id)}),r!==null&&!s.tabs.find(o=>o.id===r)){!r.includes("local-")&&!r.includes("system-")&&console.warn("[TABS] setActive: Tab not found",r);return}e(n=>{const o={activeId:r,tabs:n.tabs.map(i=>i.id===r?{...i,active:!0,lastActiveAt:Date.now()}:{...i,active:!1})},c=W.getState().mode;return le({tabs:o.tabs,activeTabId:o.activeId,mode:c,savedAt:Date.now()}),A(async()=>{const{useAgentStreamStore:i}=await Promise.resolve().then(()=>Yt);return{useAgentStreamStore:i}},void 0).then(({useAgentStreamStore:i})=>{i.getState().setActiveTabId(r)}).catch(()=>{}),o})}},setAll:r=>e(()=>{const s=t().tabs,o=r.map((i,l)=>{const d=s.find(u=>u.id===i.id);return{...i,createdAt:i.createdAt??d?.createdAt??Date.now(),lastActiveAt:i.lastActiveAt??d?.lastActiveAt??Date.now()-(r.length-l),pinned:(typeof i.pinned=="boolean"?i.pinned:d?.pinned)??!1,groupId:d?.groupId}}).sort((i,l)=>i.pinned&&!l.pinned?-1:!i.pinned&&l.pinned?1:i.pinned&&l.pinned?(i.createdAt??0)-(l.createdAt??0):(i.lastActiveAt??0)-(l.lastActiveAt??0)),c=o.find(i=>i.active)??o[0]??null;return{tabs:o,activeId:c?c.id:null}}),remove:r=>e(s=>{if(s.tabs.find(p=>p.id===r)?.pinned)return s;const o=s.tabs.filter(p=>p.id!==r),c=s.activeId===r?o.find(p=>p.appMode===s.tabs.find(g=>g.id===r)?.appMode)??o[0]??null:s.tabs.find(p=>p.id===s.activeId)??null,i=o.length===0?[{id:`tab-${Date.now()}`,title:"New Tab",url:"about:blank",appMode:W.getState().mode,createdAt:Date.now(),lastActiveAt:Date.now()}]:o,l=o.length===0?i[0].id:c?c.id:null,d={tabs:i,activeId:l};typeof window<"u"&&window.dispatchEvent(new CustomEvent("tab-closed",{detail:{tabId:r}}));const u=W.getState().mode;return le({tabs:d.tabs,activeTabId:d.activeId,mode:u,savedAt:Date.now()}),A(async()=>{const{track:p}=await import("./mode-research-BclgCwOH.js").then(g=>g.h);return{track:p}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(({track:p})=>{p("tab_closed",{mode:u})}),d}),getTabsForMode:r=>t().tabs.filter(n=>!n.appMode||n.appMode===r),updateTab:(r,s)=>e(n=>{const o=n.tabs.map(i=>i.id===r?{...i,...s}:i),c=o.find(i=>i.id===r);return c&&A(async()=>{const{indexTab:i}=await import("./meiliIndexer-C-Al5lgE.js");return{indexTab:i}},__vite__mapDeps([11,0,1,2,3,4,5,6,7,8,9,10,12])).then(({indexTab:i})=>{i(c).catch(console.error)}),{tabs:o}}),rememberClosedTab:r=>e(s=>({recentlyClosed:[{closedId:r.id,title:r.title,url:r.url,appMode:r.appMode,mode:r.mode,containerId:r.containerId,containerName:r.containerName,containerColor:r.containerColor,groupId:r.groupId,closedAt:Date.now()},...s.recentlyClosed.filter(o=>o.closedId!==r.id)].slice(0,De)})),popRecentlyClosed:()=>{const r=t();if(r.recentlyClosed.length===0)return;const[s,...n]=r.recentlyClosed;return e({recentlyClosed:n}),s},removeRecentlyClosed:r=>e(s=>({recentlyClosed:s.recentlyClosed.filter(n=>n.closedId!==r)})),pushRecentlyClosed:r=>e(s=>({recentlyClosed:[r,...s.recentlyClosed.filter(n=>n.closedId!==r.closedId)].slice(0,De)})),clearRecentlyClosed:()=>e({recentlyClosed:[]}),pinTab:r=>{e(s=>{const n=s.tabs.find(l=>l.id===r);if(!n)return s;const o=s.tabs.filter(l=>l.id!==r),c=o.filter(l=>l.pinned).sort((l,d)=>(l.createdAt??0)-(d.createdAt??0)),i=o.filter(l=>!l.pinned);return{tabs:[...c,{...n,pinned:!0},...i]}});try{Ie.tabs.setPinned({id:r,pinned:!0})}catch{}},unpinTab:r=>{e(s=>{const n=s.tabs.find(l=>l.id===r);if(!n)return s;const o=s.tabs.filter(l=>l.id!==r),c=o.filter(l=>l.pinned).sort((l,d)=>(l.createdAt??0)-(d.createdAt??0)),i=o.filter(l=>!l.pinned);return{tabs:[...c,{...n,pinned:!1},...i]}});try{Ie.tabs.setPinned({id:r,pinned:!1})}catch{}},togglePinTab:r=>{const n=t().tabs.find(o=>o.id===r);n&&(n.pinned?t().unpinTab(r):t().pinTab(r))},createGroup:r=>{const s=t().tabGroups,n={id:Gt(),name:r?.name?.trim()||`Group ${s.length+1}`,color:r?.color||ve[s.length%ve.length],collapsed:!1,createdAt:Date.now()};return e(o=>({tabGroups:[...o.tabGroups,n]})),n},updateGroup:(r,s)=>e(n=>({tabGroups:n.tabGroups.map(o=>o.id===r?{...o,...s}:o)})),deleteGroup:r=>e(s=>({tabGroups:s.tabGroups.filter(n=>n.id!==r),tabs:s.tabs.map(n=>n.groupId===r?{...n,groupId:void 0}:n)})),toggleGroupCollapsed:r=>e(s=>({tabGroups:s.tabGroups.map(n=>n.id===r?{...n,collapsed:!n.collapsed}:n)})),setGroupColor:(r,s)=>e(n=>({tabGroups:n.tabGroups.map(o=>o.id===r?{...o,color:s}:o)})),assignTabToGroup:(r,s)=>e(n=>({tabs:n.tabs.map(o=>o.id===r?{...o,groupId:s||void 0}:o)})),navigateTab:(r,s)=>e(n=>{const o=n.tabs.find(u=>u.id===r);if(!o)return n;let c=o.history||[];c.length===0&&o.url&&(c=[{url:o.url,title:o.title,timestamp:o.createdAt||Date.now()}]);const i=o.historyIndex??c.length-1,l=i<c.length-1?c.slice(0,i+1):c,d={url:s,title:o.title,timestamp:Date.now()};return{tabs:n.tabs.map(u=>u.id===r?{...u,url:s,history:[...l,d],historyIndex:l.length}:u)}}),goBack:r=>e(s=>{const n=s.tabs.find(i=>i.id===r);if(!n||!n.history||n.historyIndex===void 0||n.historyIndex<=0)return s;const o=n.historyIndex-1,c=n.history[o];return{tabs:s.tabs.map(i=>i.id===r?{...i,url:c.url,title:c.title||i.title,historyIndex:o}:i)}}),goForward:r=>e(s=>{const n=s.tabs.find(i=>i.id===r);if(!n||!n.history||n.historyIndex===void 0||n.historyIndex>=n.history.length-1)return s;const o=n.historyIndex+1,c=n.history[o];return{tabs:s.tabs.map(i=>i.id===r?{...i,url:c.url,title:c.title||i.title,historyIndex:o}:i)}}),canGoBack:r=>{const s=t().tabs.find(o=>o.id===r);return!s||!s.history||s.history.length===0?!1:(s.historyIndex??s.history.length-1)>0},canGoForward:r=>{const s=t().tabs.find(n=>n.id===r);return s?.history!==void 0&&s.historyIndex!==void 0&&s.historyIndex<s.history.length-1},canAddTab:()=>t().tabs.length<de,getTabCount:()=>t().tabs.length,getMaxTabs:()=>de}),{name:"regen:tabs-state",version:1,partialize:e=>({tabs:e.tabs,activeId:e.activeId,recentlyClosed:e.recentlyClosed,tabGroups:e.tabGroups})})),Ht=Object.freeze(Object.defineProperty({__proto__:null,TAB_GROUP_COLORS:ve,useTabsStore:P},Symbol.toStringTag,{value:"Module"})),Me=B(e=>({containers:[],activeContainerId:"default",setContainers:t=>e(r=>{const s=t.reduce((o,c)=>(o.find(i=>i.id===c.id)||o.push(c),o),[]),n=s.some(o=>o.id===r.activeContainerId);return{containers:s,activeContainerId:n?r.activeContainerId:s[0]?.id||"default"}}),setActiveContainer:t=>e(r=>({activeContainerId:t.id,containers:[t,...r.containers.filter(s=>s.id!==t.id)]}))})),m=ze(),rt=Object.freeze({allowDownloads:!0,allowPrivateWindows:!0,allowGhostTabs:!0,allowScreenshots:!0,allowClipping:!0}),ue=()=>({id:"default",name:"Default",createdAt:Date.now(),proxy:void 0,kind:"default",color:"#3b82f6",system:!0,policy:{...rt},description:"Fallback profile (IPC unavailable)"}),Wt={"tabs:setMemoryCap":()=>({success:!0}),"telemetry:trackPerf":()=>({success:!1,stub:!0}),"system:getStatus":()=>({redisConnected:!1,redixAvailable:!1,workerState:"stopped",vpn:{connected:!1},tor:{running:!1,bootstrapped:!1},mode:"Research",uptime:0,memoryUsage:{heapUsed:0,heapTotal:0,external:0,rss:0}}),"session:checkRestore":()=>({available:!1}),"profiles:list":()=>[ue()],"profiles:get":()=>ue(),"profiles:getActive":()=>ue(),"profiles:getPolicy":()=>({...rt}),"profiles:updateProxy":()=>({success:!1}),"profiles:delete":()=>({success:!1}),"sessions:list":()=>[],"sessions:getActive":()=>null,"workspace-v2:list":()=>({workspaces:[]}),"trust:list":()=>({records:[]}),"trust:getStatus":()=>({status:"unknown",totalRecords:0,lastUpdatedAt:null}),"privacy:sentinel:audit":()=>({score:0,grade:"low",trackers:[],thirdPartyHosts:[],message:"Privacy Sentinel unavailable outside Electron runtime.",suggestions:["Launch the desktop build to enable Privacy Sentinel audits."],timestamp:Date.now(),ai:null}),"tor:status":()=>({running:!1,bootstrapped:!1,progress:0,circuitEstablished:!1,stub:!0,error:"Tor runtime not available in this environment."}),"tor:start":()=>({success:!1,stub:!0,warning:"Tor runtime not available in this environment."}),"tor:stop":()=>({success:!0,stub:!0}),"tor:newIdentity":()=>({success:!1,stub:!0}),"vpn:status":()=>({connected:!1,stub:!0}),"vpn:check":()=>({connected:!1,stub:!0}),"vpn:listProfiles":()=>[],"vpn:connect":()=>({connected:!1,stub:!0}),"vpn:disconnect":()=>({connected:!1,stub:!0}),"dns:status":()=>({enabled:!1,provider:"system",stub:!0}),"tabs:predictiveGroups":()=>({groups:[],prefetch:[],summary:void 0}),"tabs:create":e=>{const t=typeof e=="object"&&e?e:{},r=Jt(),s=r?.activeId,n=(typeof t.tabId=="string"&&t.tabId.trim().length>0?t.tabId:void 0)??`tab-${Date.now()}`,o=typeof t.url=="string"&&t.url.trim().length>0?t.url:"about:blank",c=typeof t.title=="string"&&t.title.trim().length>0?t.title:Se(o);return r?.add?.({id:n,title:c,url:o,mode:t.mode,appMode:t.appMode,containerId:t.containerId,createdAt:t.createdAt??Date.now(),lastActiveAt:t.lastActiveAt??Date.now(),profileId:t.profileId,sessionId:t.sessionId}),t.activate===!1&&s&&r?.setActive&&r.setActive(s),{id:n,title:c,url:o,success:!0}},"tabs:list":()=>{try{const e=P.getState?.();if(e)return[...e.tabs]}catch{}return[]},"tabs:getActive":()=>{try{const e=P.getState?.();if(e)return e.tabs.find(t=>t.id===e.activeId)??null}catch{}return null},"tabs:close":e=>{try{e?.id&&P.getState?.()?.remove?.(e.id)}catch{}return{success:!0}},"tabs:activate":e=>{try{e?.id&&P.getState?.()?.setActive?.(e.id)}catch{}return{success:!0}},"tabs:navigate":e=>{try{if(e?.id&&e?.url){const t=P.getState?.();t?.navigateTab?t.navigateTab(e.id,e.url):t?.updateTab?.(e.id,{url:e.url,title:Se(e.url)})}}catch{}return{success:!0}},"tabs:goBack":e=>{try{e?.id&&P.getState?.()?.goBack?.(e.id)}catch{}return{success:!0}},"tabs:goForward":e=>{try{e?.id&&P.getState?.()?.goForward?.(e.id)}catch{}return{success:!0}},"tabs:reload":()=>({success:!0}),"tabs:stop":()=>({success:!0}),"containers:list":()=>{try{const e=Me.getState?.();if(e)return[...e.containers]}catch{}return[]},"containers:getActive":()=>{try{const e=Me.getState?.();if(e)return e.containers.find(t=>t.id===e.activeContainerId)??null}catch{}return null},"identity:status":()=>({status:"locked",totalCredentials:0,lastUpdatedAt:null}),"identity:unlock":()=>({status:"locked",totalCredentials:0,lastUpdatedAt:null}),"identity:lock":()=>({status:"locked",totalCredentials:0,lastUpdatedAt:null}),"identity:list":()=>[],"identity:add":()=>({id:"demo",domain:"example.com",username:"demo",createdAt:Date.now(),updatedAt:Date.now()}),"identity:remove":()=>({success:!1}),"identity:reveal":()=>({id:"demo",secret:"demo"}),"consent:list":()=>[],"shields:getStatus":()=>({adsBlocked:0,trackersBlocked:0,httpsUpgrades:0,cookies3p:"allow",webrtcBlocked:!1,fingerprinting:!1}),"history:search":()=>[],"performance:battery:update":()=>({success:!0}),"session:lastSnapshotSummary":()=>null,"telemetry:getStatus":()=>({optIn:!1,enabled:!1}),"telemetry:getSummary":()=>({optIn:!1,enabled:!1,crashCount:0,lastCrashAt:null,uptimeSeconds:0,perfMetrics:[]}),"analytics:getStatus":()=>({optIn:!1,enabled:!1}),"cross-reality:handoff":()=>({success:!1,handoff:null}),"cross-reality:queue":()=>({handoffs:[]}),"cross-reality:handoffStatus":()=>({success:!0}),"research:queryEnhanced":e=>e?.query?y.research.queryEnhanced(e):{query:"",summary:"Enter a question to start research.",sources:[],citations:[],confidence:0,language:"en",languageLabel:"English",languageConfidence:0,verification:{verified:!1,claimDensity:0,citationCoverage:0,ungroundedClaims:[],hallucinationRisk:1,suggestions:["Add a research query to continue."]},contradictions:[]}},te=new Set;function Jt(){try{return typeof P.getState=="function"?P.getState():void 0}catch{return}}function Se(e){if(!e||e==="about:blank")return"New Tab";try{return new URL(e).hostname||e}catch{return e}}function pe(e,t){const r=Wt[e];if(r)return r(t)}function he(e,t){!m||te.has(e)||!(N()||$())||(te.add(e),console.warn(`[IPC] Channel ${e} unavailable (${t}); using renderer fallback.`))}async function Vt(e,t,r){const s=e.replace("ob://ipc/v1/",""),o={"tabs:list":()=>y.tabs.list(),"tabs:create":async i=>{if(typeof i=="string")return y.tabs.create({url:i});if(i&&typeof i=="object"){const l="url"in i?i:{url:"about:blank"};return y.tabs.create(l)}return y.tabs.create({url:"about:blank"})},"tabs:close":i=>y.tabs.close(i.id),"tabs:activate":i=>y.tabs.activate(i.id),"tabs:navigate":i=>y.tabs.navigate(i),"tabs:goBack":i=>y.tabs.goBack(i.id),"tabs:goForward":i=>y.tabs.goForward(i.id),"tabs:reload":i=>y.tabs.reload(i.id,i),"tabs:stop":i=>y.tabs.stop(i.id),"tabs:overlay/start":()=>y.tabs.overlayStart(),"tabs:overlay/pick":()=>y.tabs.overlayGetPick(),"tabs:overlay/clear":()=>y.tabs.overlayClear(),"sessions:list":()=>y.sessions.list(),"sessions:create":i=>y.sessions.create(i),"sessions:getActive":()=>y.sessions.getActive(),"session:checkRestore":()=>y.session.checkRestore(),"session:getSnapshot":()=>y.session.getSnapshot(),"session:dismissRestore":()=>y.session.dismissRestore(),"system:getStatus":()=>y.system.getStatus(),"agent:ask":i=>y.agent.ask(i),"telemetry:getStatus":()=>y.system.getStatus(),"research:queryEnhanced":i=>y.research.queryEnhanced(i),"search:hybrid":async i=>{const l=await fetch(`${y.API_BASE_URL||"http://localhost:3000"}/api/search/hybrid`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:i.query,lang:i.language||"auto",maxResults:i.maxResults||6})});if(!l.ok)throw new Error(`Search failed: ${l.status}`);return l.json()}}[s];if(!o){if(typeof window<"u"&&!window.__ELECTRON__&&!window.__TAURI__)return Promise.reject(new Error(`No HTTP endpoint mapping for channel: ${s}`));throw new Error(`No HTTP endpoint mapping for channel: ${s}`)}return await o(t)}let E=!1,x=[];if(typeof window<"u"){const e=()=>{if(window.ipc&&typeof window.ipc.invoke=="function"){E=!0;const n=[...x];x=[],n.forEach(o=>o()),m&&console.log("[IPC] Ready signal received and window.ipc is available")}else m&&(console.warn("[IPC] Ready event received but window.ipc is not available"),console.warn("[IPC] window.ipc:",window.ipc),console.warn("[IPC] window keys:",Object.keys(window).filter(n=>n.includes("ipc")||n.includes("api"))))};window.addEventListener("ipc:ready",e);let t=0;const r=50,s=setInterval(()=>{if(t++,window.ipc&&typeof window.ipc.invoke=="function")clearInterval(s),E||e();else if(t>=r){clearInterval(s);const n=N()||$();m&&n&&(console.warn("[IPC] window.ipc never appeared after polling"),console.warn("[IPC] Available window properties:",Object.keys(window).filter(o=>o.includes("ipc")||o.includes("api")||o.includes("electron"))))}},100);window.ipc&&typeof window.ipc.invoke=="function"&&setTimeout(()=>{E||e()},100)}async function O(e=1e4){if(!N()&&!$())return Promise.resolve(!1);if(E&&typeof window<"u"&&window.ipc&&typeof window.ipc.invoke=="function")return!0;if(typeof window<"u"&&window.ipc&&typeof window.ipc.invoke=="function"){if(!E){E=!0;const t=[...x];x=[],t.forEach(r=>r()),m&&console.log("[IPC] Bridge detected and marked as ready")}return!0}return new Promise(t=>{const r=Date.now();if(E&&window.ipc&&typeof window.ipc.invoke=="function"){t(!0);return}const s=setTimeout(()=>{x=x.filter(c=>c!==n),t(!1)},e),n=()=>{clearTimeout(s),t(!0)};x.push(n);const o=setInterval(()=>{const c=typeof window<"u"&&window.ipc&&typeof window.ipc.invoke=="function";if(E&&c)clearInterval(o),clearTimeout(s),x=x.filter(i=>i!==n),t(!0);else if(c&&!E){E=!0;const i=[...x];x=[],i.forEach(l=>l()),clearInterval(o),clearTimeout(s),m&&console.log("[IPC] Bridge detected during polling and marked as ready"),t(!0)}else if(Date.now()-r>e){clearInterval(o),clearTimeout(s),x=x.filter(l=>l!==n);const i=N()||$();m&&i&&console.warn(`[IPC] Timeout waiting for IPC bridge (${e}ms)`),t(!1)}},100)})}async function a(e,t,r){const s=`ob://ipc/v1/${e}`,o=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent:"",c=o.includes("Electron"),i=N(),l=typeof window<"u"&&(window.ipc&&typeof window.ipc.invoke=="function"||window.api&&typeof window.api.ping=="function"),d=o.includes("Chrome")&&!o.includes("Electron")||o.includes("Firefox")||o.includes("Safari")&&!o.includes("Chrome")||o.includes("Edg"),u=i||c||l||!d,p=await O(8e3);if(!u)try{return await Vt(s,t,r)}catch(f){const v=s.replace("ob://ipc/v1/",""),w=pe(v,t);if(w!==void 0)return he(v,"HTTP API unavailable, using fallback"),w;throw f}let g=window.ipc;if((!g||typeof g.invoke!="function")&&typeof window<"u"&&window.require)try{const{ipcRenderer:f}=window.require("electron");f&&typeof f.invoke=="function"&&(g={invoke:async(v,w)=>{const k=await f.invoke(v,w);if(k&&typeof k=="object"&&"ok"in k){if(!k.ok)throw new Error(k.error||"IPC call failed");return k.data}return k},on:()=>{},removeListener:()=>{}})}catch{}if(!p||!g||typeof g.invoke!="function"){const f=pe(e,t);if(f!==void 0)return he(e,!u&&!l?"non-Electron runtime":"IPC bridge not ready"),f;throw m&&(console.warn(`[IPC] Channel ${e} unavailable (IPC bridge not ready after 8s, no fallback available)`),console.warn(`[IPC] Debug: isElectron=${u}, hasWindowIpc=${l}, userAgentHasElectron=${c}, isReady=${p}`),console.warn("[IPC] window.ipc:",window.ipc),console.warn("[IPC] window.api:",window.api),console.warn("[IPC] typeof window:",typeof window)),new Error("IPC unavailable")}try{const f=await g.invoke(s,t);return f}catch(f){const v=f instanceof Error?f.message:String(f);if(v.includes("No handler registered")){const w=pe(e,t);if(w!==void 0)return he(e,"handler not registered"),w}throw m&&!te.has(e)&&(te.add(e),console.warn(`IPC call failed for ${e}:`,v)),f instanceof Error?f:new Error(v)}}const Ie={windowControl:{toggleFullscreen:e=>a("app:toggleFullscreen",{fullscreen:e}).catch(t=>(m&&console.warn("[IPC] Failed to toggle fullscreen:",t),{success:!1,fullscreen:!1})),setFullscreen:e=>a("app:setFullscreen",{fullscreen:e}).catch(t=>(m&&console.warn("[IPC] Failed to set fullscreen:",t),{success:!1,fullscreen:e})),getState:()=>a("app:getWindowState",{}).catch(()=>({fullscreen:!!document.fullscreenElement}))},tabs:{create:async e=>{try{await O(5e3);const t=typeof e=="string"?{url:e}:e||{},r=await a("tabs:create",{url:t.url||"about:blank",profileId:t.profileId,mode:t.mode,containerId:t.containerId,tabId:t.tabId,activate:t.activate,createdAt:t.createdAt,lastActiveAt:t.lastActiveAt,sessionId:t.sessionId,fromSessionRestore:t.fromSessionRestore});return m&&console.log("[IPC] Tab created:",r),r}catch(t){return m&&console.error("Failed to create tab:",t),{id:`temp-${Date.now()}`,success:!1}}},close:async e=>{try{const t=await a("tabs:close",e);return m&&console.log("[IPC] tabs.close response:",t),t}catch(t){throw m&&console.warn("Failed to close tab:",t),t}},activate:async e=>{try{const t=await a("tabs:activate",e);return m&&console.log("[IPC] tabs.activate response:",t),t}catch(t){throw m&&console.warn("Failed to activate tab:",t),t}},navigate:(e,t)=>a("tabs:navigate",{id:e,url:t}).catch(r=>console.warn("Failed to navigate:",r)),goBack:e=>a("tabs:goBack",{id:e}).catch(t=>console.warn("Failed to go back:",t)),goForward:e=>a("tabs:goForward",{id:e}).catch(t=>console.warn("Failed to go forward:",t)),setMemoryCap:async(e,t)=>{try{return await a("tabs:setMemoryCap",{tabId:e,capMB:t})}catch(r){throw m&&console.warn("Failed to set memory cap:",r),r}},devtools:e=>a("tabs:devtools",{id:e}),zoomIn:e=>a("tabs:zoomIn",{id:e}),zoomOut:e=>a("tabs:zoomOut",{id:e}),zoomReset:e=>a("tabs:zoomReset",{id:e}),screenshot:e=>a("tabs:screenshot",{id:e}),capturePreview:e=>a("tabs:capturePreview",e),pip:(e,t)=>a("tabs:pip",{id:e,enabled:t}),find:e=>a("tabs:find",{id:e}),reload:(e,t)=>a("tabs:reload",{id:e,...t??{}}).catch(r=>console.warn("Failed to reload:",r)),stop:e=>a("tabs:stop",{id:e}).catch(t=>console.warn("Failed to stop loading:",t)),list:async()=>{try{const e=await a("tabs:list",{});return Array.isArray(e)?e:[]}catch(e){return console.warn("Failed to list tabs:",e),[]}},predictiveGroups:async e=>{try{const t=await a("tabs:predictiveGroups",e??{});return{groups:Array.isArray(t?.groups)?t.groups:[],prefetch:Array.isArray(t?.prefetch)?t.prefetch:[],summary:t?.summary}}catch(t){return m&&console.warn("Failed to fetch predictive tab groups:",t),{groups:[],prefetch:[],summary:void 0}}},moveToWorkspace:e=>a("tabs:moveToWorkspace",e),hibernate:e=>a("tabs:hibernate",{id:e}),wake:e=>a("tabs:wake",{id:e}),burn:e=>a("tabs:burn",{id:e}),onUpdated:e=>{window.ipc?.on&&window.ipc.on("tabs:updated",(t,r)=>e(r))},setContainer:(e,t)=>a("tabs:setContainer",{id:e,containerId:t}),reorder:(e,t)=>a("tabs:reorder",{tabId:e,newIndex:t}),reopenClosed:e=>a("tabs:reopenClosed",{index:e}),setPinned:e=>a("tabs:setPinned",e),listClosed:()=>a("tabs:listClosed",{}),getContext:e=>a("tabs:getContext",{tabId:e})},workflow:{launch:e=>a("workflow:launch",{query:e}),list:()=>a("workflow:list",{})},tor:{async status(){try{return await O(3e3),await a("tor:status",{})}catch(e){return m&&console.warn("[IPC] tor.status falling back to stub",e),{running:!1,bootstrapped:!1,circuitEstablished:!1,progress:0,stub:!0,error:"Tor bridge unavailable"}}},async start(){try{return await O(3e3),await a("tor:start",{})}catch(e){return m&&console.warn("[IPC] tor.start falling back to stub",e),{stub:!0,warning:"Tor bridge unavailable (stub mode)"}}},async stop(){try{return await O(3e3),await a("tor:stop",{})}catch(e){return m&&console.warn("[IPC] tor.stop failed in stub mode",e),{stub:!0}}},async newIdentity(){try{return await O(3e3),await a("tor:newIdentity",{})}catch(e){return m&&console.warn("[IPC] tor.newIdentity failed in stub mode",e),{stub:!0}}},async getProxy(){try{return await O(3e3),await a("tor:getProxy",{})}catch(e){return m&&console.warn("[IPC] tor.getProxy falling back to stub",e),{proxy:null,stub:!0}}}},vpn:{async status(){try{await O(3e3);const e=new Promise((t,r)=>{setTimeout(()=>r(new Error("VPN status timeout")),4e3)});return await Promise.race([a("vpn:status",{}),e])}catch(e){return m&&!(e instanceof Error&&e.message.includes("timeout"))&&console.debug("[IPC] vpn.status falling back to stub",e),{connected:!1,type:"stub",name:"Not connected",stub:!0}}},async check(){try{return await O(3e3),await a("vpn:check",{})}catch(e){return m&&console.warn("[IPC] vpn.check falling back to stub",e),{connected:!1,type:"stub",name:"Not connected",stub:!0}}},listProfiles:()=>a("vpn:listProfiles",{}),connect:e=>a("vpn:connect",{id:e}),disconnect:()=>a("vpn:disconnect",{})},containers:{list:()=>a("containers:list",{}),getActive:()=>a("containers:getActive",{}),setActive:e=>a("containers:setActive",{containerId:e}),create:e=>a("containers:create",e),getPermissions:e=>a("containers:getPermissions",{containerId:e}),setPermission:(e,t,r)=>a("containers:setPermission",{containerId:e,permission:t,enabled:r}),getSitePermissions:e=>a("containers:getSitePermissions",{containerId:e}),allowSitePermission:(e,t,r)=>a("containers:allowSitePermission",{containerId:e,permission:t,origin:r}),revokeSitePermission:(e,t,r)=>a("containers:revokeSitePermission",{containerId:e,permission:t,origin:r})},ui:{setChromeOffsets:async e=>{try{return await a("ui:setChromeOffsets",e)}catch(t){return m&&console.warn("[IPC] Failed to set chrome offsets:",t),{success:!1}}}},proxy:{set:e=>a("proxy:set",e),status:()=>a("proxy:status",{}),getForTab:e=>a("proxy:getForTab",{tabId:e})},profiles:{create:(e,t)=>typeof e=="string"?a("profiles:create",{name:e,proxy:t}):a("profiles:create",e),list:()=>a("profiles:list",{}),get:e=>a("profiles:get",{id:e}),delete:e=>a("profiles:delete",{id:e}),updateProxy:(e,t)=>a("profiles:updateProxy",{profileId:e,proxy:t}),setActive:e=>a("profiles:setActive",{profileId:e}),getActive:()=>a("profiles:getActive",{}),getPolicy:e=>a("profiles:getPolicy",e?{profileId:e}:{})},games:{createSandbox:e=>a("games:sandbox:create",e),destroySandbox:e=>a("games:sandbox:destroy",e),reportMetrics:e=>a("games:sandbox:metrics",e)},telemetry:{setOptIn:e=>a("telemetry:setOptIn",{optIn:e}).catch(()=>({success:!0})),getStatus:()=>a("telemetry:getStatus",{}).catch(()=>({optIn:!1,enabled:!1})),getSummary:()=>a("telemetry:getSummary",{}).catch(()=>({optIn:!1,enabled:!1,crashCount:0,lastCrashAt:null,uptimeSeconds:0,perfMetrics:[]})),trackPerf:(e,t,r)=>a("telemetry:trackPerf",{metric:e,value:t,unit:r}),trackFeature:(e,t)=>a("telemetry:trackFeature",{feature:e,action:t})},analytics:{setOptIn:e=>a("analytics:setOptIn",{optIn:e}).catch(()=>({success:!0})),getStatus:()=>a("analytics:getStatus",{}).catch(()=>({optIn:!1,enabled:!1})),track:(e,t)=>a("analytics:track",{type:e,payload:t}).catch(()=>({success:!1}))},settings:{get:()=>a("settings:get",{}),set:(e,t)=>a("settings:set",{path:e,value:t}),reset:()=>a("settings:reset",{}),getCategory:e=>a("settings:getCategory",{category:e}),setCategory:(e,t)=>a("settings:setCategory",{category:e,values:t}),exportAll:()=>a("settings:exportAll",{}),importAll:()=>a("settings:importAll",{}),exportFile:()=>a("settings:exportAll",{}),importFile:()=>a("settings:importAll",{})},diagnostics:{openLogs:()=>a("diagnostics:openLogs",{}),copyDiagnostics:()=>a("diagnostics:copy",{})},agent:{createTask:e=>a("agent:createTask",e),generatePlan:(e,t)=>a("agent:generatePlan",{taskId:e,observations:t}),executeTask:(e,t)=>a("agent:executeTask",{taskId:e,confirmSteps:t}),cancelTask:e=>a("agent:cancelTask",{taskId:e}),getStatus:e=>a("agent:getStatus",{taskId:e}),ask:(e,t)=>a("agent:ask",{query:e,context:t}),askWithScrape:e=>a("agent:askWithScrape",e),deepResearch:e=>a("agent:deepResearch",e),stream:{start:(e,t)=>a("agent:stream:start",{query:e,...t}),stop:e=>a("agent:stream:stop",{streamId:e})},generatePlanFromGoal:e=>a("agent:generatePlanFromGoal",e),executePlan:e=>a("agent:executePlan",e),guardrails:{config:e=>a("agent:guardrails:config",e),check:(e,t)=>a("agent:guardrails:check",{type:e,data:t})}},cursor:{setApiKey:e=>a("cursor:setApiKey",e),checkApiKey:()=>a("cursor:checkApiKey",{}),query:e=>a("cursor:query",e),clearHistory:()=>a("cursor:clearHistory",{})},omnix:{browser:{getPage:()=>a("omnix:browser:getPage",{}),getActiveTab:()=>a("omnix:browser:getActiveTab",{}),captureSnapshot:e=>a("omnix:browser:captureSnapshot",e)},scrape:{fetch:e=>a("omnix:scrape:fetch",e),enqueue:e=>a("omnix:scrape:enqueue",e)},ai:{ask:e=>a("omnix:ai:ask",e),summarize:e=>a("omnix:ai:summarize",e)},trade:{getChart:e=>a("omnix:trade:getChart",e)},file:{save:e=>a("omnix:file:save",e),read:e=>a("omnix:file:read",e)},security:{scanPage:e=>a("omnix:security:scanPage",e)}},session:{saveTabs:()=>a("session:saveTabs",{}),loadTabs:()=>a("session:loadTabs",{}),addHistory:e=>a("session:addHistory",e),getHistory:e=>a("session:getHistory",e),searchHistory:e=>a("session:searchHistory",e),saveSetting:e=>a("session:saveSetting",e),getSetting:e=>a("session:getSetting",e),checkRestore:()=>a("session:checkRestore",{}),getSnapshot:()=>a("session:getSnapshot",{}),dismissRestore:()=>a("session:dismissRestore",{})},researchStream:{start:async(e,t)=>{const r={question:e,...t?{mode:t}:{}};return await a("research:start",r)}},cloudVector:{config:e=>a("cloud-vector:config",e),sync:e=>a("cloud-vector:sync",{documentIds:e}),search:(e,t)=>a("cloud-vector:search",{query:e,topK:t}),available:()=>a("cloud-vector:available",{})},hybridSearch:{search:(e,t,r)=>a("search:hybrid",{query:e,maxResults:t,language:r}),config:e=>a("search:config",e)},liveSearch:{start:(e,t)=>a("search:live:start",{query:e,...t})},graph:{tabs:()=>a("graph:tabs",{}),workflow:e=>a("graph:workflowWeaver",e??{})},efficiency:{applyMode:e=>a("efficiency:applyMode",{mode:e}),clearOverride:()=>a("efficiency:clearOverride",{}),hibernateInactiveTabs:()=>a("efficiency:hibernate",{}),ecoImpact:e=>a("efficiency:ecoImpact",e??{})},browser:{launch:(e,t)=>a("launch_browser",{url:e,headless:t}),regenLaunch:(e,t)=>a("regen_launch",{url:e,mode:t}),regenSession:e=>a("regen_session",{urls:e}),captureScreenshot:e=>a("capture_browser_screenshot",{url:e})},grammar:{correct:e=>a("correct_text",{text:e})},vision:{captureScreen:()=>a("capture_screen",{}),analyze:(e,t)=>a("ollama_vision",{prompt:e,screenshot:t})},trust:{list:()=>a("trust:list",{}),get:e=>a("trust:get",{domain:e}),submit:e=>a("trust:submit",e)},downloads:{list:()=>a("downloads:list",{}),openFile:e=>a("downloads:openFile",{path:e}),showInFolder:e=>a("downloads:showInFolder",{path:e}),requestConsent:(e,t,r)=>a("downloads:requestConsent",{url:e,filename:t,size:r}),pause:e=>a("downloads:pause",{id:e}),resume:e=>a("downloads:resume",{id:e}),cancel:e=>a("downloads:cancel",{id:e}),retry:e=>a("downloads:retry",{id:e}),getQueue:()=>a("downloads:getQueue",{})},watchers:{list:()=>a("watchers:list",{}),add:e=>a("watchers:add",e),remove:e=>a("watchers:remove",{id:e}),trigger:e=>a("watchers:trigger",{id:e}),updateInterval:(e,t)=>a("watchers:updateInterval",{id:e,intervalMinutes:t})},history:{list:()=>a("history:list",{}),clear:()=>a("history:clear",{}),search:async e=>{try{return await a("history:search",{query:e})}catch(t){return m&&console.warn("History search failed:",t),[]}},deleteUrl:e=>a("history:deleteUrl",{url:e})},storage:{saveWorkspace:e=>a("storage:saveWorkspace",e),listWorkspaces:()=>a("storage:listWorkspaces",{})},shields:{get:e=>a("shields:get",{url:e}),set:(e,t)=>a("shields:set",{hostname:e,config:t}),updateDefault:e=>a("shields:updateDefault",e),list:()=>a("shields:list",{}),getStatus:()=>a("shields:getStatus",{})},network:{get:()=>a("network:get",{}),disableQUIC:()=>a("network:disableQUIC",{}),enableQUIC:()=>a("network:enableQUIC",{}),disableIPv6:()=>a("network:disableIPv6",{}),enableIPv6:()=>a("network:enableIPv6",{})},ollama:{check:()=>a("ollama:check",{}),listModels:()=>a("ollama:listModels",{})},citation:{extract:(e,t)=>a("citation:extract",{text:e,url:t}),get:()=>a("citation:get",{}),export:e=>a("citation:export",{format:e}),clear:()=>a("citation:clear",{})},knowledge:{cluster:(e,t)=>a("knowledge:cluster",{sources:e,threshold:t??.7}),parsePDF:e=>a("knowledge:parsePDF",{filePath:e}),clusterCompare:(e,t)=>a("knowledge:clusterCompare",{cluster1Id:e,cluster2Id:t}),clustersList:()=>a("knowledge:clustersList",{})},cognitive:{recordPattern:e=>a("cognitive:recordPattern",e),getSuggestions:e=>a("cognitive:getSuggestions",e||{}),getPersona:()=>a("cognitive:getPersona",{}),getGraph:()=>a("cognitive:getGraph",{}),clear:()=>a("cognitive:clear",{})},workspaceV2:{save:e=>a("workspace-v2:save",e),load:e=>a("workspace-v2:load",{workspaceId:e}),list:()=>a("workspace-v2:list",{}),delete:e=>a("workspace-v2:delete",{workspaceId:e}),updateNotes:(e,t,r)=>a("workspace-v2:updateNotes",{workspaceId:e,tabId:t,note:r}),getNotes:e=>a("workspace-v2:getNotes",{workspaceId:e})},sessionBundle:{export:(e,t)=>a("session-bundle:export",{runId:e,...t}),import:e=>a("session-bundle:import",{filePath:e}),replay:(e,t)=>a("session-bundle:replay",{bundleId:e,...t}),list:()=>a("session-bundle:list",{})},sessionState:{summary:()=>a("session:lastSnapshotSummary",{}),restore:()=>a("session:restoreLast",{})},historyGraph:{recordNavigation:(e,t,r)=>a("history-graph:recordNavigation",{fromUrl:e,toUrl:t,title:r}),recordCitation:(e,t)=>a("history-graph:recordCitation",{sourceUrl:e,targetUrl:t}),recordExport:(e,t,r)=>a("history-graph:recordExport",{sourceUrl:e,exportType:t,filename:r}),recordNote:(e,t)=>a("history-graph:recordNote",{url:e,noteText:t}),get:e=>a("history-graph:get",e||{}),export:e=>a("history-graph:export",{format:e}),clear:()=>a("history-graph:clear",{})},omniscript:{parse:e=>a("omniscript:parse",{command:e}),execute:e=>a("omniscript:execute",{commands:e})},omniBrain:{addDocument:e=>a("omni-brain:addDocument",e),search:(e,t)=>a("omni-brain:search",{query:e,limit:t||10}),getDocument:e=>a("omni-brain:getDocument",{id:e}),listDocuments:()=>a("omni-brain:listDocuments",{}),deleteDocument:e=>a("omni-brain:deleteDocument",{id:e}),clear:()=>a("omni-brain:clear",{})},spiritual:{focusMode:{enable:e=>a("spiritual:focusMode:enable",e||{}),disable:()=>a("spiritual:focusMode:disable",{}),status:()=>a("spiritual:focusMode:status",{})},mood:{recordTyping:()=>a("spiritual:mood:recordTyping",{}),get:()=>a("spiritual:mood:get",{}),reset:()=>a("spiritual:mood:reset",{})},balance:{start:e=>a("spiritual:balance:start",e||{}),stop:()=>a("spiritual:balance:stop",{})}},pluginMarketplace:{list:()=>a("plugin-marketplace:list",{}),install:(e,t)=>a("plugin-marketplace:install",{pluginId:e,verifySignature:t??!0}),uninstall:e=>a("plugin-marketplace:uninstall",{pluginId:e}),installed:()=>a("plugin-marketplace:installed",{}),isInstalled:e=>a("plugin-marketplace:isInstalled",{pluginId:e})},extensionNexus:{list:()=>a("plugins:nexus:list",{}),publish:e=>a("plugins:nexus:publish",e),trust:(e,t)=>a("plugins:nexus:trust",{pluginId:e,trusted:t})},performance:{battery:{update:e=>a("performance:battery:update",e)},getMetrics:()=>a("performance:getMetrics",{}),gpu:{enableRaster:()=>a("performance:gpu:enableRaster",{}),disableRaster:()=>a("performance:gpu:disableRaster",{}),enableHardwareDecode:()=>a("performance:gpu:enableHardwareDecode",{}),disableHardwareDecode:()=>a("performance:gpu:disableHardwareDecode",{}),getConfig:()=>a("performance:gpu:getConfig",{})},snapshot:{create:e=>a("performance:snapshot:create",e),restore:e=>a("performance:snapshot:restore",{snapshotId:e}),latest:()=>a("performance:snapshot:latest",{}),list:()=>a("performance:snapshot:list",{})}},workers:{scraping:{run:e=>a("workers:scraping:run",e)}},videoCall:{getConfig:()=>a("videoCall:getConfig",{}),updateConfig:e=>a("videoCall:updateConfig",e),getNetworkQuality:()=>a("videoCall:getNetworkQuality",{}),updateNetworkQuality:e=>a("videoCall:updateNetworkQuality",e)},sessions:{create:e=>a("sessions:create",e),list:()=>a("sessions:list",{}),getActive:()=>a("sessions:getActive",{}),setActive:e=>a("sessions:setActive",e),get:e=>a("sessions:get",e),delete:e=>a("sessions:delete",e),update:e=>a("sessions:update",e),getPartition:e=>a("sessions:getPartition",e)},private:{createWindow:e=>a("private:createWindow",e||{}),createGhostTab:e=>a("private:createGhostTab",e||{}),closeAll:()=>a("private:closeAll",{}),panicWipe:e=>a("private:panicWipe",e||{})},crossReality:{handoff:(e,t)=>a("cross-reality:handoff",{tabId:e,target:t}),queue:()=>a("cross-reality:queue",{}),sendHandoffStatus:e=>a("cross-reality:handoffStatus",e).catch(t=>(m&&console.warn("[IPC] Failed to send handoff status:",t),{success:!1}))},identity:{status:()=>a("identity:status",{}),unlock:e=>a("identity:unlock",{passphrase:e}),lock:()=>a("identity:lock",{}),list:()=>a("identity:list",{}),add:e=>a("identity:add",e),remove:e=>a("identity:remove",{id:e}),reveal:e=>a("identity:reveal",{id:e})},consent:{createRequest:e=>a("consent:createRequest",e),approve:e=>a("consent:approve",{consentId:e}),revoke:e=>a("consent:revoke",{consentId:e}),check:e=>a("consent:check",e),get:e=>a("consent:get",{consentId:e}),list:e=>a("consent:list",e??{}),export:()=>a("consent:export",{}),vault:{export:()=>a("consent:vault:export",{})}},research:{queryEnhanced:e=>a("research:queryEnhanced",e),extractContent:e=>a("research:extractContent",e?{tabId:e}:{}),saveNotes:(e,t,r)=>a("research:saveNotes",{url:e,notes:t,highlights:r}),getNotes:e=>a("research:getNotes",{url:e}),export:e=>a("research:export",e),saveSnapshot:e=>a("research:saveSnapshot",{tabId:e}),uploadFile:e=>new Promise((t,r)=>{const s=new FileReader;s.onload=async()=>{const n=s.result,o=await a("research:uploadFile",{filename:e.name,content:n.split(",")[1],mimeType:e.type,size:e.size});t(o.fileId)},s.onerror=r,s.readAsDataURL(e)}),listDocuments:()=>a("research:listDocuments",{}),getDocumentChunks:e=>a("research:getDocumentChunks",{documentId:e}),capturePage:e=>a("research:capturePage",e?{tabId:e}:{}),captureSelection:(e,t)=>a("research:captureSelection",{tabId:t,text:e})},reader:{summarize:e=>a("reader:summarize",e),export:e=>a("reader:export",e)},trade:{execute:e=>a("execute_trade_command",{query:e}),tradingviewAuthorize:(e,t)=>a("tradingview_authorize",{login:e,password:t}),tradingviewQuotes:(e,t)=>a("tradingview_quotes",{accountId:e,symbols:t}),tradingviewPlaceOrder:e=>a("tradingview_place_order",e),tradingviewGetPositions:e=>a("tradingview_get_positions",{accountId:e}),tradingviewGetAccountState:e=>a("tradingview_get_account_state",{accountId:e}),placeOrder:e=>a("trade:placeOrder",e),cancelOrder:e=>a("trade:cancelOrder",{orderId:e}),getOrders:e=>a("trade:getOrders",e?{status:e}:{}),getPositions:()=>a("trade:getPositions",{}),closePosition:(e,t)=>a("trade:closePosition",{symbol:e,quantity:t}),getBalance:()=>a("trade:getBalance",{}),connectBroker:e=>a("trade:connectBroker",e),getQuote:e=>a("trade:getQuote",{symbol:e}),getCandles:e=>a("trade:getCandles",e)},dns:{status:()=>a("dns:status",{}),enableDoH:(e="cloudflare")=>a("dns:enableDoH",{provider:e}),disableDoH:()=>a("dns:disableDoH",{})},privacy:{sentinel:{audit:e=>a("privacy:sentinel:audit",e?{tabId:e}:{})},getStats:()=>a("privacy:getStats",{}),getTrackers:e=>a("privacy:getTrackers",{limit:e||50}),exportReport:e=>a("privacy:exportReport",{format:e||"json"})},redix:{ask:(e,t)=>a("redix:ask",{prompt:e,...t}),status:()=>a("redix:status",{}),stream:(e,t,r)=>{let s=null;if(r&&typeof window<"u"&&window.ipc){s=(n,o)=>{try{r(o),(o.done||o.error)&&(s&&window.ipc?.removeListener&&window.ipc.removeListener("redix:chunk",s),s=null)}catch(c){console.error("[Redix] Error in stream handler:",c),s&&window.ipc?.removeListener&&window.ipc.removeListener("redix:chunk",s),s=null}};try{window.ipc.on?.("redix:chunk",s)}catch(n){console.error("[Redix] Failed to register stream handler:",n)}}return a("redix:stream",{prompt:e,stream:!0,...t}).catch(n=>{throw s&&typeof window<"u"&&window.ipc?.removeListener&&window.ipc.removeListener("redix:chunk",s),n})}},system:{getStatus:()=>a("system:getStatus",{})},gpu:{getStatus:()=>a("gpu:getStatus",{}),setEnabled:e=>a("gpu:setEnabled",e)},features:{list:()=>a("features:list",{}),get:e=>a("features:get",e),set:e=>a("features:set",e)},regen:{query:e=>a("regen:query",e),getDom:e=>a("regen:getDom",e),clickElement:e=>a("regen:clickElement",e),scroll:e=>a("regen:scroll",e),openTab:e=>a("regen:openTab",e),typeIntoElement:e=>a("regen:typeIntoElement",e),goBack:e=>a("regen:goBack",e),goForward:e=>a("regen:goForward",e),switchTab:e=>a("regen:switchTab",e),closeTab:e=>a("regen:closeTab",e),readPage:e=>a("regen:readPage",e),tradeConfirm:e=>a("regen:trade:confirm",e)}},Le=Object.freeze(Object.defineProperty({__proto__:null,deriveTitleFromUrl:Se,ipc:Ie,ipcCall:a},Symbol.toStringTag,{value:"Module"})),$e=()=>({general:{defaultMode:"Browse",startupBehavior:"newTab",telemetryOptIn:!1,showKeyboardHints:!0,allowBetaUpdates:!1},privacy:{localOnlyMode:!1,doNotTrack:!0,clearOnExit:!1,blockThirdPartyCookies:!0,safeBrowsing:!0,trackerProtection:!0,adBlockEnabled:!0,malwareProtection:!0,autoUpdateFilters:!0},appearance:{theme:"dark",compactUI:!1,showTabNumbers:!0,accent:"purple",chromeNewTabPage:!0},account:{displayName:"Explorer",email:"you@regen.app",workspace:"Personal",avatarUrl:void 0,avatarColor:"#8b5cf6",lastSyncedAt:Date.now()},videoDownloadConsent:!1,searchEngine:"duckduckgo",language:"auto"}),Kt=["general","privacy","appearance","account","videoDownloadConsent","searchEngine"],Qt=B()(re((e,t)=>({...$e(),setConsent:r=>e({videoDownloadConsent:r}),setSearchEngine:r=>e({searchEngine:r}),setLanguage:r=>e({language:r}),updateGeneral:r=>e(s=>({general:{...s.general,...r}})),updatePrivacy:r=>e(s=>({privacy:{...s.privacy,...r}})),updateAppearance:r=>e(s=>({appearance:{...s.appearance,...r}})),updateAccount:r=>e(s=>({account:{...s.account,...r}})),resetSettings:()=>{const r=$e();e(()=>r)}}),{name:"regen:settings-v1",version:1,partialize:e=>{const t={};for(const r of Kt)t[r]=e[r];return t},merge:(e,t)=>({...t,...e})})),rs=Object.freeze(Object.defineProperty({__proto__:null,useSettingsStore:Qt},Symbol.toStringTag,{value:"Module"})),I=B()(re(e=>({runId:null,status:"idle",transcript:"",events:[],error:null,lastGoal:null,activeTabId:null,setRun:(t,r,s=null)=>{console.log("[AGENT_STREAM] setRun",{runId:t,goal:r,tabId:s}),e({runId:t,status:"live",error:null,transcript:"",events:[],lastGoal:r,activeTabId:s})},setStatus:t=>e({status:t}),setError:t=>e({error:t,status:t?"error":"idle"}),appendEvent:t=>{const r=I.getState();if(t.tabId&&r.activeTabId&&t.tabId!==r.activeTabId){console.log("[AGENT_STREAM] Ignoring event for inactive tab",{eventTabId:t.tabId,activeTabId:r.activeTabId,eventType:t.type});return}console.log("[AGENT_STREAM] appendEvent",{eventId:t.id,type:t.type,tabId:t.tabId,activeTabId:r.activeTabId}),e(s=>({events:[...s.events,t]}))},appendTranscript:t=>{const r=I.getState();console.log("[AGENT_STREAM] appendTranscript",{deltaLength:t.length,activeTabId:r.activeTabId}),e(s=>({transcript:s.transcript?`${s.transcript}${t}`:t}))},setActiveTabId:t=>{console.log("[AGENT_STREAM] setActiveTabId",{tabId:t}),e({activeTabId:t})},reset:()=>{console.log("[AGENT_STREAM] reset"),e({runId:null,status:"idle",transcript:"",events:[],error:null,lastGoal:null,activeTabId:null})}}),{name:"regen-agent-stream-storage",partialize:e=>({runId:e.runId,status:e.status,transcript:e.transcript,events:e.events.slice(-50),lastGoal:e.lastGoal,activeTabId:e.activeTabId})})),Yt=Object.freeze(Object.defineProperty({__proto__:null,useAgentStreamStore:I},Symbol.toStringTag,{value:"Module"})),Xt={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var Zt={};function er(){return null}function tr(e){const t={openai:["VITE_OPENAI_API_KEY","OPENAI_API_KEY"],anthropic:["VITE_ANTHROPIC_API_KEY","ANTHROPIC_API_KEY"],mistral:["VITE_MISTRAL_API_KEY","MISTRAL_API_KEY"],ollama:[]};for(const r of t[e]||[]){const s=Xt[r]||(typeof process<"u"?Zt[r]:null);if(s)return s}return null}function rr(e){const t={openai:"https://api.openai.com/v1",anthropic:"https://api.anthropic.com/v1",mistral:"https://api.mistral.ai/v1",ollama:"http://localhost:11434"};return t[e]||t.openai}function ae(e){const t={openai:"gpt-4o-mini",anthropic:"claude-3-5-sonnet-20241022",mistral:"mistral-large-latest",ollama:"llama3"};return t[e]||t.openai}async function sr(e,t,r,s){const n=t.model||ae("openai"),o=Date.now(),c=[];t.systemPrompt&&c.push({role:"system",content:t.systemPrompt}),c.push({role:"user",content:e});const i={model:n,messages:c,max_tokens:t.maxTokens||1e3,temperature:t.temperature??.7};t.topP!==void 0&&(i.top_p=t.topP),t.stopSequences&&(i.stop=t.stopSequences),t.stream&&(i.stream=!0);const u=await fetch("http://localhost:3000/api/proxy/openai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!u.ok){const f=await u.json().catch(()=>({error:{message:u.statusText}}));throw{code:`openai_${u.status}`,message:f.error?.message||`OpenAI API error: ${u.statusText}`,provider:"openai",retryable:u.status>=500||u.status===429}}const p=await u.json(),g=Date.now()-o;return{text:p.choices[0]?.message?.content||"",raw:p,provider:"openai",model:p.model||n,usage:p.usage,latency:g}}async function ar(e,t,r){const s=t.model||ae("anthropic"),n=Date.now(),c={model:s,messages:[{role:"user",content:e}],max_tokens:t.maxTokens||1e3,temperature:t.temperature??.7};t.systemPrompt&&(c.system=t.systemPrompt),t.topP!==void 0&&(c.top_p=t.topP),t.stopSequences&&(c.stop_sequences=t.stopSequences);const d=await fetch("http://localhost:3000/api/proxy/anthropic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!d.ok){const g=await d.json().catch(()=>({error:{message:d.statusText}}));throw{code:`anthropic_${d.status}`,message:g.error?.message||`Anthropic API error: ${d.statusText}`,provider:"anthropic",retryable:d.status>=500||d.status===429}}const u=await d.json(),p=Date.now()-n;return{text:u.content[0]?.text||"",raw:u,provider:"anthropic",model:u.model||s,usage:u.usage,latency:p}}async function nr(e,t,r,s){const n=t.model||ae("mistral"),o=Date.now(),c=[];t.systemPrompt&&c.push({role:"system",content:t.systemPrompt}),c.push({role:"user",content:e});const i={model:n,messages:c,max_tokens:t.maxTokens||1e3,temperature:t.temperature??.7};t.topP!==void 0&&(i.top_p=t.topP),t.stopSequences&&(i.stop=t.stopSequences);const l=await fetch(`${s}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(i)});if(!l.ok){const p=await l.json().catch(()=>({error:{message:l.statusText}}));throw{code:`mistral_${l.status}`,message:p.error?.message||`Mistral API error: ${l.statusText}`,provider:"mistral",retryable:l.status>=500||l.status===429}}const d=await l.json(),u=Date.now()-o;return{text:d.choices[0]?.message?.content||"",raw:d,provider:"mistral",model:d.model||n,usage:d.usage,latency:u}}async function or(e,t,r){const s=t.model||ae("ollama"),n=Date.now(),o=[];t.systemPrompt&&o.push({role:"system",content:t.systemPrompt}),o.push({role:"user",content:e});const c={model:s,messages:o,options:{num_predict:t.maxTokens||1e3,temperature:t.temperature??.7}};t.topP!==void 0&&(c.options.top_p=t.topP),t.stopSequences&&(c.options.stop=t.stopSequences);const i=await fetch(`${r}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!i.ok)throw{code:`ollama_${i.status}`,message:`Ollama API error: ${i.statusText}`,provider:"ollama",retryable:!1};const l=await i.json(),d=Date.now()-n;return{text:l.message?.content||"",raw:l,provider:"ollama",model:l.model||s,latency:d}}async function st(e,t={}){const r=t.provider?[t.provider]:["openai","anthropic","mistral","ollama"];let s=null;for(const n of r)try{const o=n!=="ollama"?tr(n):null;if(n!=="ollama"&&!o)continue;const c=rr(n);let i;switch(n){case"openai":i=await sr(e,t,o,c);break;case"anthropic":i=await ar(e,t,o);break;case"mistral":i=await nr(e,t,o,c);break;case"ollama":i=await or(e,t,c);break;default:throw new Error(`Unsupported provider: ${n}`)}return i.latency&&console.debug(`[LLM] ${n} response in ${i.latency}ms`,{model:i.model,tokens:i.usage?.totalTokens}),i}catch(o){if(s=o,console.warn(`[LLM] ${n} failed:`,o.message),o.retryable&&r.length>1)continue;if(n===r[r.length-1])throw o}if(!s){const n=er();throw{code:"no_provider",message:n?`No API key found for ${n}. Please set environment variables.`:"No LLM provider configured. Set OPENAI_API_KEY, ANTHROPIC_API_KEY, MISTRAL_API_KEY, or OLLAMA_BASE_URL.",provider:"openai",retryable:!1}}throw s}const ss=Object.freeze(Object.defineProperty({__proto__:null,sendPrompt:st},Symbol.toStringTag,{value:"Module"}));var ir=Object.defineProperty,cr=(e,t,r)=>t in e?ir(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,X=(e,t,r)=>cr(e,typeof t!="symbol"?t+"":t,r);class lr{constructor(){X(this,"apiBase",typeof window<"u"?window.__OB_API_BASE__:""),X(this,"requestQueue",new dt({concurrency:2})),X(this,"providerChain",["openai","anthropic","ollama"]),X(this,"STATE_KEY","regen:ai_engine_state")}async runTask(t,r){if(!t.prompt?.trim())throw new Error("Prompt is required for AI tasks");return this.saveState(t),await this.requestQueue.add(async()=>{const s=await this.callBackendTask(t,r);if(s)return this.saveState(t,s),s;const n=await this.runLocalLLMWithFallback(t,r);return this.saveState(t,n),n})}async callBackendTask(t,r){if(!this.apiBase||typeof fetch>"u")return null;const s=this.apiBase.replace(/\/$/,""),n=t.stream?6e4:3e4,o=new AbortController,c=setTimeout(()=>o.abort(),n),i=t.signal?(()=>{const l=new AbortController;return t.signal.addEventListener("abort",()=>l.abort()),o.signal.addEventListener("abort",()=>l.abort()),l.signal})():o.signal;try{const l=await fetch(`${s}/api/ai/task`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({kind:t.kind,prompt:t.prompt,context:t.context,mode:t.mode,metadata:t.metadata,temperature:t.llm?.temperature??.2,max_tokens:t.llm?.maxTokens??800}),signal:i});if(!l.ok){const u=await l.text();return console.warn("[AIEngine] Backend task failed",l.status,u),null}if(l.headers.get("content-type")?.includes("text/event-stream")){const u=l.body?.getReader();if(!u)return null;const p=new TextDecoder("utf-8");let g="";const f=[];for(;;){if(i.aborted){r?.({type:"error",data:"Request timeout - please try again"});break}const{value:v,done:w}=await u.read();if(w)break;g+=p.decode(v,{stream:!0});const k=g.split(`

`);g=k.pop()||"";for(const M of k)if(M.startsWith("event: error"))try{const _=M.replace("event: error","").replace("data:","").trim(),D=JSON.parse(_),nt=D.message||"AI service error occurred";r?.({type:"error",data:nt}),console.error("[AIEngine] Task error",D)}catch{const _=M.replace("event: error","").replace("data:","").trim();r?.({type:"error",data:_||"AI service error occurred"})}else if(M.startsWith("event: done"))try{const _=M.replace("event: done","").replace("data:","").trim(),D=JSON.parse(_);return D.text||(D.text=f.join("")),this.trackTelemetry(D,t),r?.({type:"done",data:D}),D}catch(_){return console.warn("[AIEngine] Failed to parse done payload",_),r?.({type:"done",data:f.join("")}),{text:f.join(""),provider:"openai",model:"unknown"}}else if(M.startsWith("data:")){const _=M.replace("data:","").trim();f.push(_),r?.({type:"token",data:_})}}clearTimeout(c)}const d=await l.json();return clearTimeout(c),this.trackTelemetry(d,t),r?.({type:"done",data:d}),d}catch(l){return clearTimeout(c),l instanceof Error&&l.name==="AbortError"?(console.warn("[AIEngine] Request timeout after",n,"ms"),r?.({type:"error",data:"Request timeout - please try again"})):console.warn("[AIEngine] Backend request error",l),null}}async runLocalLLMWithFallback(t,r){let s=null;for(const o of this.providerChain)try{const c=await st(t.prompt,{...t.llm,provider:o,stream:!!r||t.llm?.stream,systemPrompt:t.llm?.systemPrompt??this.resolveSystemPrompt(t)}),i={text:c.text,provider:c.provider,model:c.model,usage:c.usage,latency:c.latency};return this.saveState(t,i),this.trackTelemetry(i,t),r?.({type:"done",data:i}),i}catch(c){if(s=c,console.warn(`[AIEngine] Provider ${o} failed:`,c.message),o!==this.providerChain[this.providerChain.length-1])continue}const n=s?.message||"All AI providers failed";throw r?.({type:"error",data:n}),new Error(n)}async runLocalLLM(t,r){return this.runLocalLLMWithFallback(t,r)}saveState(t,r){if(!(typeof window>"u"||!window.localStorage))try{const s={request:{kind:t.kind,prompt:t.prompt.substring(0,200),mode:t.mode,timestamp:Date.now()},result:r?{provider:r.provider,model:r.model,textLength:r.text?.length||0}:void 0},n=JSON.parse(localStorage.getItem(this.STATE_KEY)||"[]");n.push(s);const o=n.slice(-10);localStorage.setItem(this.STATE_KEY,JSON.stringify(o))}catch(s){console.warn("[AIEngine] Failed to save state:",s)}}getLastState(){if(typeof window>"u"||!window.localStorage)return null;try{const t=JSON.parse(localStorage.getItem(this.STATE_KEY)||"[]"),r=t[t.length-1];return r?{request:{kind:r.request.kind||"agent",prompt:r.request.prompt||"",mode:r.request.mode},result:r.result?{text:"",provider:r.result.provider,model:r.result.model}:void 0}:null}catch(t){return console.warn("[AIEngine] Failed to load state:",t),null}}resolveSystemPrompt(t){switch(t.kind){case"search":return"You are ReGen’s research copilot. Cite sources as [n].";case"agent":return"You are an execution agent. Be concise.";default:return}}trackTelemetry(t,r){try{ct("ai_task_success",{kind:r.kind,provider:t.provider,model:t.model,latencyMs:t.latency??null,promptLength:r.prompt.length}).catch(()=>{})}catch(s){console.warn("[AIEngine] Failed to track telemetry",s)}}}const dr=new lr,Te="regen:agent-loops",ur=10,pr=5e3;function hr(e){try{const t=ne(),r=I.getState().runId;if(!r)return;const s={runId:r,goal:I.getState().lastGoal||e.goal||"",status:I.getState().status,transcript:I.getState().transcript,events:I.getState().events,error:I.getState().error,lastSaved:Date.now(),...e},n=t.filter(c=>c.runId!==r);n.unshift(s);const o=n.slice(0,ur);localStorage.setItem(Te,JSON.stringify(o))}catch(t){console.warn("[LoopResume] Failed to save loop state:",t)}}function ne(){try{const e=localStorage.getItem(Te);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return console.warn("[LoopResume] Failed to load loop states:",e),[]}}function gr(e){return ne().find(r=>r.runId===e)||null}function as(e){try{const t=gr(e);if(!t)return console.warn("[LoopResume] No saved state found for runId:",e),!1;const r=I.getState();return r.setRun(t.runId,t.goal),r.setStatus(t.status),r.setError(t.error),t.transcript&&(r.reset(),r.setRun(t.runId,t.goal),t.transcript.split(`
`).forEach(s=>{s.trim()&&r.appendTranscript(s+`
`)})),t.events.forEach(s=>{r.appendEvent(s)}),console.log("[LoopResume] Resumed loop:",e,"with",t.events.length,"events"),!0}catch(t){return console.error("[LoopResume] Failed to resume loop:",t),!1}}function ns(e){try{const r=ne().filter(s=>s.runId!==e);localStorage.setItem(Te,JSON.stringify(r))}catch(t){console.warn("[LoopResume] Failed to delete loop state:",t)}}let F=null;function os(e){F&&clearInterval(F),F=setInterval(()=>{const t=I.getState();t.runId&&t.status==="live"&&hr({metadata:e})},pr)}function is(){F&&(clearInterval(F),F=null)}function cs(){const e=ne(),t=Date.now(),r=3e4;return e.filter(s=>{const n=t-s.lastSaved;return s.status==="live"||s.status==="connecting"||n<r&&s.status!=="complete"})}async function ls(e,t){try{const r=e.data.workflowId,s=e.data.workflowUrl,n=!!e.data.loop,o=e.data.loopInterval?Number(e.data.loopInterval):void 0,c=e.data.maxIterations?Number(e.data.maxIterations):void 0;if(!r)return{success:!1,error:"No workflow ID provided"};const{callN8nWorkflow:i,runN8nWorkflowLoop:l}=await A(async()=>{const{callN8nWorkflow:p,runN8nWorkflowLoop:g}=await import("./n8nService-z-F9tmHu.js");return{callN8nWorkflow:p,runN8nWorkflowLoop:g}},[]),d={workflowId:r,data:e.data,language:t,sourceMode:e.sourceMode,metadata:e.metadata},u=s?{baseUrl:s}:void 0;if(n){const p=await l(d,{workflowId:r,interval:o||1e3,maxIterations:c||10},u),g=p[p.length-1];return oe.success(`Workflow loop completed: ${r} (${p.length} iterations)`,{duration:3e3}),{success:g?.success||!1,targetId:r,data:{iterations:p.length,results:p,lastResult:g}}}else{const p=await i(d,u);return p.success?oe.success(`Workflow triggered: ${r}`,{duration:3e3}):oe.error(`Workflow failed: ${p.error}`,{duration:5e3}),{success:p.success,targetId:r,data:p.data,error:p.error}}}catch(r){return{success:!1,error:r.message||"n8n handoff failed"}}}const fr=20,Ne=B()(re((e,t)=>({entries:[],addEntry:r=>{const s={...r,id:r.runId??`agent-mem-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,createdAt:r.createdAt??Date.now()};e(n=>{const o=n.entries.filter(i=>!(i.runId&&i.runId===s.runId));return{entries:[s,...o].slice(0,200)}})},getRecentForAgent:(r,s=fr)=>{const n=t().entries;return r?n.filter(o=>o.agentId===r).slice(0,s):n.slice(0,s)},clearAgent:r=>{e(s=>({entries:r?s.entries.filter(n=>n.agentId!==r):[]}))},clearAll:()=>e({entries:[]})}),{name:"regen:agent-memory",version:1}));var mr=Object.defineProperty,yr=(e,t,r)=>t in e?mr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,S=(e,t,r)=>yr(e,typeof t!="symbol"?t+"":t,r);class wr{constructor(){S(this,"ws",null),S(this,"eventSource",null),S(this,"reconnectAttempts",0),S(this,"config",null),S(this,"listeners",new Map),S(this,"isConnected",!1),S(this,"currentRunId",null),S(this,"seenMessageIds",new Set),S(this,"maxSeenSize",1e3),S(this,"heartbeatInterval",null),S(this,"heartbeatIntervalMs",2e4),S(this,"baseBackoff",1e3),S(this,"maxBackoff",3e4),S(this,"reconnectTimer",null)}async connect(t){this.config=t,this.reconnectAttempts=0;try{if(t.transport==="websocket"){const r=t.url||(typeof window<"u"&&window.__API_BASE_URL?window.__API_BASE_URL.replace("http://","ws://").replace("https://","wss://")+"/agent/stream":"ws://127.0.0.1:4000/agent/stream");await this.connectWebSocket(r)}else t.transport==="sse"?await this.connectSSE(t.url||"http://127.0.0.1:18080/sse"):(this.isConnected=!0,this.setupTauriEventListeners())}catch(r){console.error("[StreamingOrchestrator] Connection failed:",r),this.handleReconnect()}}async connectWebSocket(t){return new Promise((r,s)=>{try{const n=new URL(t),o=`client-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,c=`session-${Date.now()}`;n.searchParams.set("clientId",o),n.searchParams.set("sessionId",c);const i=new WebSocket(n.toString());i.onopen=()=>{console.log("[StreamingOrchestrator] WebSocket connected"),this.ws=i,this.isConnected=!0,this.reconnectAttempts=0,this.startHeartbeat(),r()},i.onmessage=l=>{try{const d=JSON.parse(l.data),u=d.id||`${d.runId}-${d.timestamp}-${d.type}`;if(this.seenMessageIds.has(u)){console.log("[StreamingOrchestrator] Duplicate message ignored",{messageId:u});return}if(this.seenMessageIds.add(u),this.seenMessageIds.size>this.maxSeenSize){const p=this.seenMessageIds.values().next().value;p!==void 0&&this.seenMessageIds.delete(p)}this.handleMessage(d)}catch(d){console.error("[StreamingOrchestrator] Failed to parse message:",d)}},i.onerror=l=>{console.error("[StreamingOrchestrator] WebSocket error:",l),s(l)},i.onclose=()=>{console.log("[StreamingOrchestrator] WebSocket closed"),this.stopHeartbeat(),this.ws=null,this.isConnected=!1,this.handleReconnect()}}catch(n){s(n)}})}async connectSSE(t){return new Promise((r,s)=>{try{const n=new EventSource(t);n.onopen=()=>{console.log("[StreamingOrchestrator] SSE connected"),this.eventSource=n,this.isConnected=!0,this.reconnectAttempts=0,r()},n.onmessage=o=>{try{const c=JSON.parse(o.data);this.handleMessage(c)}catch(c){console.error("[StreamingOrchestrator] Failed to parse SSE message:",c)}},n.onerror=o=>{console.error("[StreamingOrchestrator] SSE error:",o),n.readyState===EventSource.CLOSED&&(this.eventSource=null,this.isConnected=!1,this.handleReconnect())}}catch(n){s(n)}})}setupTauriEventListeners(){if(typeof window>"u"||!window.__TAURI__){console.warn("[StreamingOrchestrator] Tauri not available");return}window.__TAURI__.event.listen("agent-start",t=>{this.handleMessage({type:"start",runId:t.payload.runId||this.currentRunId||"",tabId:t.payload.tabId,sessionId:t.payload.sessionId,timestamp:Date.now()})}),window.__TAURI__.event.listen("agent-token",t=>{this.handleMessage({type:"step",runId:t.payload.runId||this.currentRunId||"",content:t.payload.content,timestamp:Date.now()})}),window.__TAURI__.event.listen("agent-action",t=>{this.handleMessage({type:"action",runId:t.payload.runId||this.currentRunId||"",action:t.payload.action,timestamp:Date.now()})}),window.__TAURI__.event.listen("agent-done",t=>{this.handleMessage({type:"done",runId:t.payload.runId||this.currentRunId||"",timestamp:Date.now()})}),window.__TAURI__.event.listen("agent-error",t=>{this.handleMessage({type:"error",runId:t.payload.runId||this.currentRunId||"",content:t.payload.error,timestamp:Date.now()})})}handleMessage(t){const r=I.getState();if(t.tabId&&r.activeTabId&&t.tabId!==r.activeTabId){console.log("[StreamingOrchestrator] Ignoring message for inactive tab",{messageTabId:t.tabId,activeTabId:r.activeTabId});return}const s={id:`${t.runId}-${Date.now()}`,type:t.type==="start"?"start":t.type==="done"?"done":"step",step:t.step,status:t.status,content:t.content,timestamp:t.timestamp,tabId:t.tabId,sessionId:t.sessionId};r.appendEvent(s),t.content&&r.appendTranscript(t.content),(this.listeners.get(t.type)||new Set).forEach(o=>o(t))}async startAgent(t,r){const s=`run-${Date.now()}-${Math.random().toString(36).slice(2,10)}`;this.currentRunId=s;const n=I.getState();if(n.setRun(s,t,r?.tabId),this.config?.transport==="websocket"&&this.ws&&this.ws.readyState===WebSocket.OPEN)this.ws.send(JSON.stringify({type:"start_agent",query:t,tabId:r?.tabId,sessionId:r?.sessionId,url:r?.url,context:r?.context,runId:s}));else if(this.config?.transport==="event"&&typeof window<"u"&&window.__TAURI__)window.__TAURI__.invoke("start_agent_stream",{query:t,tabId:r?.tabId,sessionId:r?.sessionId,url:r?.url,context:r?.context,runId:s}).catch(o=>{console.error("[StreamingOrchestrator] Failed to start agent:",o),n.setError(o.message||"Failed to start agent")});else try{const o=await fetch("http://127.0.0.1:4000/api/agent/stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t,tabId:r?.tabId,sessionId:r?.sessionId,url:r?.url,context:r?.context,runId:s})});if(!o.ok)throw new Error(`HTTP ${o.status}`);const c=o.body?.getReader(),i=new TextDecoder;c&&(async()=>{for(;;){const{done:l,value:d}=await c.read();if(l)break;const p=i.decode(d).split(`
`);for(const g of p)if(g.startsWith("data: "))try{const f=JSON.parse(g.slice(6));this.handleMessage(f)}catch(f){console.error("[StreamingOrchestrator] Failed to parse SSE line:",f)}}})()}catch(o){console.error("[StreamingOrchestrator] Failed to start agent:",o),n.setError(o.message||"Failed to start agent")}return s}stopAgent(t){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"stop_agent",runId:t})),I.getState().setStatus("idle")}startHeartbeat(){this.stopHeartbeat(),this.heartbeatInterval=setInterval(()=>{this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"ping",timestamp:Date.now()}))},this.heartbeatIntervalMs)}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}handleReconnect(){if(!this.config?.reconnect)return;const t=this.config.maxReconnectAttempts||10;if(this.reconnectAttempts>=t){console.error("[StreamingOrchestrator] Max reconnect attempts reached");return}this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectAttempts++;const r=Math.min(this.maxBackoff,this.baseBackoff*Math.pow(2,this.reconnectAttempts-1));console.log(`[StreamingOrchestrator] Reconnecting in ${r}ms (attempt ${this.reconnectAttempts}/${t})`),this.reconnectTimer=setTimeout(()=>{this.reconnectTimer=null,this.config&&this.connect(this.config).catch(s=>{console.error("[StreamingOrchestrator] Reconnect failed:",s)})},r)}on(t,r){return this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(r),()=>{this.listeners.get(t)?.delete(r)}}disconnect(){this.stopHeartbeat(),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws&&(this.ws.close(),this.ws=null),this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.isConnected=!1,this.listeners.clear(),this.seenMessageIds.clear(),this.reconnectAttempts=0}get connected(){return this.isConnected}}const K=new wr;function br(e,t={}){const{maxChunkSize:r=1e3,overlap:s=100,minChunkSize:n=100,preserveSentences:o=!0}=t;if(e.length<=r)return[{id:"chunk-0",text:e,index:0,startOffset:0,endOffset:e.length,wordCount:e.split(/\s+/).length}];const c=[];let i=0,l=0;for(;l<e.length;){let d=Math.min(l+r,e.length);if(o&&d<e.length){const g=vr(e,d);g>l+n&&(d=g)}const u=e.slice(l,d),p=u.split(/\s+/).length;c.push({id:`chunk-${i}`,text:u,index:i,startOffset:l,endOffset:d,wordCount:p}),l=d-s,l<0&&(l=0),i++}return c}function vr(e,t){const r=/[.!?]\s+/g;let s=-1,n;for(r.lastIndex=0;(n=r.exec(e))!==null;){if(n.index>t)return n.index+n[0].length;s=n.index+n[0].length}return s>t?s:t}async function Sr(e,t={}){let r;if(typeof window<"u"&&window.__TAURI__)try{r=(await window.__TAURI__.invoke("extract_page_text",{url:e}))?.text||""}catch(o){console.error("[Chunker] Failed to extract page:",o),r=""}else try{r=(await(await fetch(`http://127.0.0.1:4000/api/extract?url=${encodeURIComponent(e)}`)).json()).text||""}catch(o){console.error("[Chunker] Failed to extract page:",o),r=""}if(!r||r.trim().length===0)return{chunks:[],metadata:{url:e,totalWords:0}};const s=br(r,t),n=r.split(/\s+/).length;return{chunks:s,metadata:{url:e,totalWords:n}}}async function Ir(e,t=3){const r=e.slice(0,t),s=[],n=r.map(async c=>{try{return c.text.split(/[.!?]+\s+/).filter(l=>l.trim().length>0).slice(0,2).join(". ")+"."}catch{return c.text.slice(0,200)+"..."}}),o=await Promise.all(n);return s.push(...o),s.join(`

`)}var Ar=Object.defineProperty,kr=(e,t,r)=>t in e?Ar(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,z=(e,t,r)=>kr(e,typeof t!="symbol"?t+"":t,r);class xr{constructor(t=1e3,r=100){z(this,"cache",new Map),z(this,"queue",[]),z(this,"maxCacheSize"),z(this,"maxQueueSize"),z(this,"db",null),this.maxCacheSize=t,this.maxQueueSize=r,this.initDB()}async initDB(){return new Promise((t,r)=>{const s=indexedDB.open("regen-cache",1);s.onerror=()=>{console.warn("[LocalCache] IndexedDB not available, using memory cache"),t()},s.onsuccess=()=>{this.db=s.result,this.loadFromDB(),t()},s.onupgradeneeded=n=>{const o=n.target.result;if(o.objectStoreNames.contains("cache")||o.createObjectStore("cache",{keyPath:"key"}),!o.objectStoreNames.contains("queue")){const c=o.createObjectStore("queue",{keyPath:"id"});c.createIndex("priority","priority",{unique:!1}),c.createIndex("createdAt","createdAt",{unique:!1})}}})}async loadFromDB(){if(this.db)try{const s=this.db.transaction("cache","readonly").objectStore("cache").getAll();s.onsuccess=()=>{const i=s.result;for(const l of i)l.expiresAt&&l.expiresAt<Date.now()||this.cache.set(l.key,l)};const c=this.db.transaction("queue","readonly").objectStore("queue").getAll();c.onsuccess=()=>{const i=c.result;this.queue=i.sort((l,d)=>d.priority-l.priority)}}catch(t){console.error("[LocalCache] Failed to load from DB:",t)}}async get(t){const r=this.cache.get(t);if(r)return r.expiresAt&&r.expiresAt<Date.now()?(this.cache.delete(t),await this.deleteFromDB(t),null):r.value;if(this.db)try{const o=this.db.transaction("cache","readonly").objectStore("cache").get(t);return new Promise(c=>{o.onsuccess=()=>{const i=o.result;if(i){if(i.expiresAt&&i.expiresAt<Date.now()){this.deleteFromDB(t),c(null);return}this.cache.set(t,i),c(i.value)}else c(null)},o.onerror=()=>c(null)})}catch(s){return console.error("[LocalCache] Failed to get from DB:",s),null}return null}async set(t,r,s){const n={key:t,value:r,timestamp:Date.now(),expiresAt:s?.ttl?Date.now()+s.ttl*1e3:void 0,tags:s?.tags};if(this.cache.set(t,n),this.cache.size>this.maxCacheSize){const o=Array.from(this.cache.entries()).sort((c,i)=>c[1].timestamp-i[1].timestamp)[0][0];this.cache.delete(o),await this.deleteFromDB(o)}if(this.db)try{this.db.transaction("cache","readwrite").objectStore("cache").put(n)}catch(o){console.error("[LocalCache] Failed to save to DB:",o)}}async delete(t){this.cache.delete(t),await this.deleteFromDB(t)}async deleteFromDB(t){if(this.db)try{this.db.transaction("cache","readwrite").objectStore("cache").delete(t)}catch(r){console.error("[LocalCache] Failed to delete from DB:",r)}}async clearByTags(t){const r=[];for(const[s,n]of this.cache.entries())n.tags&&n.tags.some(o=>t.includes(o))&&r.push(s);for(const s of r)await this.delete(s)}async enqueue(t,r,s){const n={id:`queue-${Date.now()}-${Math.random().toString(36).slice(2,10)}`,type:t,data:r,priority:s?.priority??0,createdAt:Date.now(),attempts:0,maxAttempts:s?.maxAttempts??3};if(this.queue.push(n),this.queue.sort((o,c)=>c.priority-o.priority),this.queue.length>this.maxQueueSize&&(this.queue=this.queue.slice(0,this.maxQueueSize)),this.db)try{this.db.transaction("queue","readwrite").objectStore("queue").put(n)}catch(o){console.error("[LocalCache] Failed to save queue item to DB:",o)}return n.id}async dequeue(){if(this.queue.length===0)return null;const t=this.queue.shift();if(this.db)try{this.db.transaction("queue","readwrite").objectStore("queue").delete(t.id)}catch(r){console.error("[LocalCache] Failed to delete queue item from DB:",r)}return t}peek(){return this.queue[0]||null}get queueLength(){return this.queue.length}async clearQueue(){if(this.queue=[],this.db)try{this.db.transaction("queue","readwrite").objectStore("queue").clear()}catch(t){console.error("[LocalCache] Failed to clear queue from DB:",t)}}getStats(){let t=0;for(const r of this.cache.values())t+=JSON.stringify(r).length;return{cacheSize:this.cache.size,queueSize:this.queue.length,memoryUsage:t}}}const at=new xr;var Tr=Object.defineProperty,_r=(e,t,r)=>t in e?Tr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ae=(e,t,r)=>_r(e,typeof t!="symbol"?t+"":t,r);class Q{constructor(t,r){Ae(this,"mode"),Ae(this,"context"),this.mode=t,this.context=r}}class Pr extends Q{constructor(t){super("trade",t)}getCapabilities(){return["Real-time market data analysis","Trade signal generation","Portfolio optimization","Risk assessment","Order execution"]}async execute(t){const r=await K.startAgent(t,{tabId:this.context.tabId,sessionId:this.context.sessionId,url:this.context.url,context:JSON.stringify({mode:"trade",capabilities:this.getCapabilities()})}),s=[];if((t.toLowerCase().includes("buy")||t.toLowerCase().includes("sell"))&&s.push({type:"navigate",args:{url:"https://www.tradingview.com/chart/"},requiresConsent:!0,risk:"high"}),t.toLowerCase().includes("price")||t.toLowerCase().includes("market")){const n=`trade:market:${Date.now()}`;await at.get(n)||s.push({type:"extract",args:{selector:".market-data",url:this.context.url},requiresConsent:!1,risk:"low"})}return{success:!0,runId:r,actions:s}}}class Fe extends Q{constructor(t){super("research",t)}getCapabilities(){return["Multi-source search","Content extraction","Progressive summarization","Citation tracking","Fact verification","Cross-reference analysis"]}async execute(t){const r=await K.startAgent(t,{tabId:this.context.tabId,sessionId:this.context.sessionId,url:this.context.url,context:JSON.stringify({mode:"research",capabilities:this.getCapabilities()})}),s=[];if(this.context.url)try{const{chunks:n,metadata:o}=await Sr(this.context.url),c=await Ir(n,3);await at.set(`research:${this.context.url}`,{chunks:n,metadata:o,partialSummary:c},{ttl:3600,tags:["research","extraction"]}),s.push({type:"summarize",args:{text:c,url:this.context.url},requiresConsent:!1,risk:"low"})}catch(n){console.error("[ResearchAgent] Extraction failed:",n)}return s.push({type:"extract",args:{query:t,sources:["web","local","cache"]},requiresConsent:!1,risk:"low"}),{success:!0,runId:r,actions:s}}}class Er extends Q{constructor(t){super("dev",t)}getCapabilities(){return["Code extraction","Auto-debugging","Error analysis","Performance profiling","Code review","Documentation generation"]}async execute(t){const r=await K.startAgent(t,{tabId:this.context.tabId,sessionId:this.context.sessionId,url:this.context.url,context:JSON.stringify({mode:"dev",capabilities:this.getCapabilities()})}),s=[];return this.context.url&&(this.context.url.includes("github.com")||this.context.url.includes("gitlab.com"))&&s.push({type:"extract",args:{selector:"pre, code, .code-block",url:this.context.url},requiresConsent:!1,risk:"low"}),(t.toLowerCase().includes("error")||t.toLowerCase().includes("debug"))&&s.push({type:"extract",args:{selector:".error, .console, .log",url:this.context.url},requiresConsent:!1,risk:"low"}),{success:!0,runId:r,actions:s}}}class Cr extends Q{constructor(t){super("document",t)}getCapabilities(){return["PDF parsing","Document summarization","Key insight extraction","Table extraction","Action item identification","Document comparison"]}async execute(t){const r=await K.startAgent(t,{tabId:this.context.tabId,sessionId:this.context.sessionId,url:this.context.url,context:JSON.stringify({mode:"document",capabilities:this.getCapabilities()})}),s=[];return this.context.url&&(this.context.url.endsWith(".pdf")||this.context.url.endsWith(".doc")||this.context.url.endsWith(".docx"))&&s.push({type:"extract",args:{url:this.context.url,type:"document"},requiresConsent:!1,risk:"low"}),s.push({type:"summarize",args:{query:t,documentUrl:this.context.url},requiresConsent:!1,risk:"low"}),{success:!0,runId:r,actions:s}}}class Or extends Q{constructor(t){super("workflow",t)}getCapabilities(){return["Multi-step automation","Workflow orchestration","Conditional logic","Error recovery","Progress tracking","Workflow templates"]}async execute(t){const r=await K.startAgent(t,{tabId:this.context.tabId,sessionId:this.context.sessionId,url:this.context.url,context:JSON.stringify({mode:"workflow",capabilities:this.getCapabilities()})}),s=this.parseWorkflow(t),n=[];for(const o of s.steps)n.push({type:o.type,args:o.args,requiresConsent:o.requiresConsent||!1,risk:o.risk||"low"});return{success:!0,runId:r,actions:n}}parseWorkflow(t){const r=[];if(t.includes("open")&&t.includes("extract")){const s=t.match(/https?:\/\/[^\s]+/);s&&(r.push({type:"navigate",args:{url:s[0]},requiresConsent:!1,risk:"low"}),r.push({type:"extract",args:{url:s[0]},requiresConsent:!1,risk:"low"}),r.push({type:"summarize",args:{url:s[0]},requiresConsent:!1,risk:"low"}))}return{steps:r}}}class Rr{constructor(){Ae(this,"agents",new Map)}getAgent(t,r){if(!this.agents.has(t)){let s;switch(t){case"trade":s=new Pr(r);break;case"research":s=new Fe(r);break;case"dev":s=new Er(r);break;case"document":s=new Cr(r);break;case"workflow":s=new Or(r);break;default:s=new Fe(r)}this.agents.set(t,s)}return this.agents.get(t)}async execute(t,r,s){return await this.getAgent(t,s).execute(r)}getCapabilities(t,r){return this.getAgent(t,r).getCapabilities()}async executeBatch(t){return await Promise.all(t.map(s=>this.execute(s.mode,s.query,s.context)))}}const ds=new Rr,Ue="0123456789abcdefghijklmnopqrstuvwxyz";function Dr(e=16){let t="";for(let r=0;r<e;r++){const s=Math.floor(Math.random()*Ue.length);t+=Ue[s]}return t}async function Be(e){try{const t=await dr.runTask({kind:"agent",prompt:e});if(t.text?.trim())return t.text}catch(t){console.warn("[AgentTools] aiEngine redixAsk fallback triggered:",t)}try{return(await G({type:"redix:agent:query",payload:{prompt:e},source:"agent-runtime"}))?.payload?.text||""}catch(t){return console.warn("[AgentTools] legacy redixAsk failed:",t),""}}async function ge(e,t){const r=new URL(e);if(!["http:","https:"].includes(r.protocol))throw new Error("Only http/https allowed");const s=new AbortController,n=setTimeout(()=>s.abort(),12e3);try{return await fetch(r.toString(),{...t,signal:s.signal,headers:{"User-Agent":"RedixAgent/1.0",...t?.headers||{}}})}finally{clearTimeout(n)}}const Mr={"memory.search":{id:"memory.search",description:"Search personal SuperMemory for relevant context.",requiredCapabilities:["memory:read"],async run(e,t){const r=String(e.query||e.prompt||"");return r?(await me(r,{limit:Number(e.limit)||8})).map(n=>({id:n.event.id,similarity:n.similarity,title:n.event.metadata?.title,url:n.event.metadata?.url,tags:n.event.metadata?.tags,snippet:n.chunkText})):[]}},"memory.saveNote":{id:"memory.saveNote",description:"Save a note to SuperMemory",requiredCapabilities:["memory:write"],async run(e,t){const r=String(e.title||e.prompt||e.text||"");if(!r)throw new Error("Note text required");return{eventId:await qe({type:"note",value:r,metadata:{url:e.url?String(e.url):void 0,notePreview:String(e.text||r).slice(0,280),tags:Array.isArray(e.tags)?e.tags.map(String):void 0}}).then(n=>n.eventId)}}},"redix.ask":{id:"redix.ask",description:"Ask the Redix core workflow for an answer.",requiredCapabilities:["redix:ask"],async run(e,t){const r=String(e.prompt||e.query||"");return r?await(t?.redixAsk?t.redixAsk(r):Be(r)):""}},"web.fetch":{id:"web.fetch",description:"Make a safe HTTP GET request for public data.",requiredCapabilities:["web:fetch"],async run(e,t){const r=String(e.url),s=await(t.safeFetch||ge)(r),n=await s.text(),o=[];return s.headers.forEach((c,i)=>{o.push([i,c])}),{status:s.status,headers:Object.fromEntries(o),text:n}}},"trade.fetchQuote":{id:"trade.fetchQuote",description:"Fetch real-time stock quote data for a symbol (e.g., AAPL, TSLA).",requiredCapabilities:["web:fetch"],async run(e,t){const r=String(e.symbol||"").toUpperCase();if(!r)throw new Error("Stock symbol required");try{const{fetchTradeQuote:s}=await A(async()=>{const{fetchTradeQuote:o}=await import("./dataService-HUHZrGu9.js");return{fetchTradeQuote:o}},[]),n=await s(r);return{symbol:n.symbol,price:n.price,change:n.change,changePercent:n.changePercent,volume:n.volume,sentiment:n.sentiment,updatedAt:n.updatedAt}}catch(s){throw console.warn("[AgentTools] trade.fetchQuote failed:",s),new Error(`Failed to fetch quote for ${r}: ${s instanceof Error?s.message:String(s)}`)}}},"image.search":{id:"image.search",description:"Search for images based on a query. Returns image URLs and metadata.",requiredCapabilities:["web:fetch"],async run(e,t){const r=String(e.query||e.prompt||"");if(!r)throw new Error("Image search query required");try{const{MockImageEngine:s}=await A(async()=>{const{MockImageEngine:c}=await import("./mode-images-CDaqFwhb.js");return{MockImageEngine:c}},[]),o=new s().generate(r);return{query:r,images:o.map((c,i)=>({url:c,index:i,thumbnail:c})),count:o.length}}catch(s){return console.warn("[AgentTools] image.search failed:",s),{query:r,images:[],count:0,error:s instanceof Error?s.message:String(s)}}}},"threat.scan":{id:"threat.scan",description:"Scan a URL for security threats, vulnerabilities, and malware indicators.",requiredCapabilities:["web:fetch"],async run(e,t){const r=String(e.url||"");if(!r)throw new Error("URL required for threat scan");try{const s=await window.api?.threats?.scanUrl?.(r);if(s)return s;try{const n=await(t.safeFetch||ge)(r,{method:"HEAD"});return{url:r,riskLevel:n.status>=400?"high":"medium",threats:[{type:"HTTP Status Check",severity:n.status>=400?"high":"low",description:`HTTP status: ${n.status}`,recommendation:n.status>=400?"URL returned an error status":"URL is accessible"}],scannedAt:Date.now()}}catch{return{url:r,riskLevel:"high",threats:[{type:"Connection Error",severity:"high",description:"Failed to connect to URL",recommendation:"URL may be unreachable or blocked"}],scannedAt:Date.now()}}}catch(s){throw console.warn("[AgentTools] threat.scan failed:",s),new Error(`Threat scan failed: ${s instanceof Error?s.message:String(s)}`)}}},"graph.query":{id:"graph.query",description:"Query the knowledge graph for nodes, edges, and relationships.",requiredCapabilities:["memory:read"],async run(e,t){const r=String(e.query||e.prompt||"");if(!r)throw new Error("Graph query required");try{const s=await me(r,{limit:10}),n=await window.api?.graph?.all?.(),o=s.map(i=>({key:i.event.id,title:i.event.metadata?.title||i.event.value?.slice(0,50),type:i.event.type,similarity:i.similarity})),c=[];for(let i=0;i<o.length-1;i++)o[i].similarity&&o[i+1].similarity&&o[i].similarity>.7&&c.push({src:o[i].key,dst:o[i+1].key,rel:"related"});return{query:r,nodes:n?.nodes||o,edges:n?.edges||c,nodeCount:(n?.nodes||o).length,edgeCount:(n?.edges||c).length}}catch(s){return console.warn("[AgentTools] graph.query failed:",s),{query:r,nodes:[],edges:[],nodeCount:0,edgeCount:0,error:s instanceof Error?s.message:String(s)}}}},"doc.summarize":{id:"doc.summarize",description:"Summarize a document or text content. Extracts key points and main ideas.",requiredCapabilities:["redix:ask"],async run(e,t){const r=String(e.text||e.content||""),s=e.url?String(e.url):void 0;if(!r&&!s)throw new Error("Text content or URL required");try{let n=r;s&&!r&&(n=await(await(t.safeFetch||ge)(s)).text());const o=`Summarize the following document. Provide:
1. Key points (3-5 bullet points)
2. Main ideas
3. Important details

Document:
${n.slice(0,4e3)}`,c=await(t.redixAsk?t.redixAsk(o):Be(o));return{summary:c,keyPoints:c.split(`
`).filter(i=>i.trim().startsWith("-")||i.trim().startsWith("•")),wordCount:n.split(/\s+/).length,url:s}}catch(n){throw console.warn("[AgentTools] doc.summarize failed:",n),new Error(`Document summarization failed: ${n instanceof Error?n.message:String(n)}`)}}},"n8n.workflow":{id:"n8n.workflow",description:"Call an n8n workflow via webhook. Supports single calls and loops.",requiredCapabilities:["web:fetch"],async run(e,t){const r=String(e.workflowId||"");if(!r)throw new Error("Workflow ID is required");try{const{callN8nWorkflow:s,runN8nWorkflowLoop:n}=await A(async()=>{const{callN8nWorkflow:d,runN8nWorkflowLoop:u}=await import("./n8nService-z-F9tmHu.js");return{callN8nWorkflow:d,runN8nWorkflowLoop:u}},[]),o={workflowId:r,data:e.data||{},language:e.language?String(e.language):void 0,sourceMode:e.sourceMode?String(e.sourceMode):void 0,metadata:e.metadata||{}},c=!!e.loop,i=e.loopInterval?Number(e.loopInterval):void 0,l=e.maxIterations?Number(e.maxIterations):void 0;if(c){const d=await n(o,{workflowId:r,interval:i,maxIterations:l||10,condition:e.loopCondition?u=>u.success:void 0});return{workflowId:r,loop:!0,iterations:d.length,results:d.map(u=>({success:u.success,data:u.data,error:u.error})),lastResult:d[d.length-1]}}else{const d=await s(o);return{workflowId:r,success:d.success,data:d.data,executionId:d.executionId,error:d.error}}}catch(s){throw console.warn("[AgentTools] n8n.workflow failed:",s),new Error(`n8n workflow call failed: ${s instanceof Error?s.message:String(s)}`)}}},"n8n.list":{id:"n8n.list",description:"List available n8n workflows (requires API key).",requiredCapabilities:["web:fetch"],async run(e,t){try{const{listN8nWorkflows:r}=await A(async()=>{const{listN8nWorkflows:n}=await import("./n8nService-z-F9tmHu.js");return{listN8nWorkflows:n}},[]),s=await r();return{workflows:s.map(n=>({id:n.id,name:n.name,description:n.description})),count:s.length}}catch(r){return console.warn("[AgentTools] n8n.list failed:",r),{workflows:[],count:0,error:r instanceof Error?r.message:String(r)}}}}};var Lr=Object.defineProperty,$r=(e,t,r)=>t in e?Lr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,fe=(e,t,r)=>$r(e,typeof t!="symbol"?t+"":t,r);class Nr{constructor(){fe(this,"agents",new Map),fe(this,"runs",new Map),fe(this,"listeners",new Set),this.registerDefaultAgents()}registerAgent(t){if(this.agents.has(t.id))throw new Error(`Agent with id ${t.id} already registered`);this.agents.set(t.id,t)}getAgents(){return Array.from(this.agents.values())}getAgent(t){return this.agents.get(t)}onRunUpdate(t){return this.listeners.add(t),()=>this.listeners.delete(t)}async execute(t){const r=t.agentId?this.agents.get(t.agentId):this.selectAgentForPrompt(t.prompt);if(!r)return{success:!1,error:"No agent available for this request."};const s=Dr(),n={id:s,agentId:r.id,prompt:t.prompt,status:"pending"};this.updateRun(n);const o=Ne.getState().getRecentForAgent(r.id,5),c={tools:this.buildToolset(r),dispatchEvent:(i,l)=>G({type:i,payload:l,source:`agent:${r.id}`}),capabilities:r.capabilities,signal:t.signal,recentRuns:o};try{n.status="running",n.startedAt=Date.now(),this.updateRun(n),G({type:"redix:agent:started",payload:{runId:s,agentId:r.id,prompt:t.prompt},source:"agent-runtime"});const i=await r.entryPoint(t,c);return n.status=i.success?"succeeded":"failed",n.finishedAt=Date.now(),n.result=i,this.updateRun(n),await this.persistAgentMemory({agentId:r.id,runId:s,prompt:t.prompt,success:!0,output:i.output,durationMs:(n.finishedAt??0)-(n.startedAt??0)}),G({type:"redix:agent:finished",payload:{runId:s,agentId:r.id,success:i.success},source:"agent-runtime"}),i}catch(i){n.status="failed",n.finishedAt=Date.now();const l=i instanceof Error?i.message:String(i);return n.result={success:!1,error:l},this.updateRun(n),await this.persistAgentMemory({agentId:r.id,runId:s,prompt:t.prompt,success:!1,error:l,durationMs:(n.finishedAt??0)-(n.startedAt??0)}),G({type:"redix:agent:error",payload:{runId:s,agentId:r.id,error:n.result.error},source:"agent-runtime"}),n.result}}updateRun(t){this.runs.set(t.id,t),this.listeners.forEach(r=>{try{r(t)}catch(s){console.warn("[AgentRuntime] listener failed:",s)}})}selectAgentForPrompt(t){const r=t.toLowerCase();for(const s of this.agents.values())if(s.trigger?.keywords?.some(n=>r.includes(n)))return s;return this.agents.get("research.agent")||this.agents.values().next().value}buildToolset(t){const r={};for(const s of t.tools){const n=Mr[s];if(!n)continue;const o=n.requiredCapabilities.filter(c=>!t.capabilities.includes(c));if(o.length>0){console.warn(`[AgentRuntime] Agent ${t.id} missing capabilities for tool ${s}: ${o.join(",")}`);continue}r[s]=async(c,i={})=>{const l=this.createToolContext({signal:i.signal,memorySearch:i.memorySearch,saveMemory:i.saveMemory,redixAsk:i.redixAsk,safeFetch:i.safeFetch});return n.run(c,l)}}return r}registerDefaultAgents(){this.registerAgent({id:"research.agent",name:"Research Agent",description:"Multi-step researcher that combines SuperMemory with Redix answers.",version:"1.0.0",capabilities:["memory:read","memory:write","redix:ask","web:fetch"],tools:["memory.search","memory.saveNote","redix.ask","web.fetch"],trigger:{keywords:["research","compare","investigate"],intent:["research","comparison"]},maxSteps:4,async entryPoint(t,r){const s=[],n=r.tools["memory.search"],o=n?await n({query:t.prompt}):[];s.push({toolId:"memory.search",input:{query:t.prompt},output:o,startedAt:Date.now(),finishedAt:Date.now()});const c=r.tools["redix.ask"],i=c?await c({prompt:Fr(t.prompt,o)}):"";if(typeof i=="string"&&i.trim().length>0){const l=r.tools["memory.saveNote"];await l?.({title:`Research: ${t.prompt}`,text:i,tags:["research","agent"]})}return{success:!0,output:typeof i=="string"?i:"",steps:s}}}),this.registerAgent({id:"trade.agent",name:"Trade Agent",description:"Provides market context, price action, and risk notes for Trade mode queries.",version:"1.0.0",capabilities:["memory:read","web:fetch","redix:ask"],tools:["memory.search","redix.ask","web.fetch","trade.fetchQuote"],trigger:{keywords:["trade","stock","ticker","invest","price","market","AAPL","TSLA","NVDA","MSFT","GOOGL"],intent:["comparison","fact"]},maxSteps:5,async entryPoint(t,r){const s=[],n=t.prompt||"",o=/\b([A-Z]{1,5})\b/g,i=(n.match(o)||[]).filter(g=>g.length>=1&&g.length<=5);let l="";if(i.length>0)try{const g=r.tools["trade.fetchQuote"];if(g){const v=(await Promise.allSettled(i.slice(0,3).map(w=>g({symbol:w})))).filter(w=>w.status==="fulfilled").map(w=>w.value);v.length>0&&(l=v.map(w=>{const k=w.change>=0?"+":"";return`${w.symbol}: $${w.price.toFixed(2)} (${k}${w.change.toFixed(2)}, ${k}${w.changePercent.toFixed(2)}%) - ${w.sentiment} sentiment`}).join(`
`),s.push({toolId:"trade.fetchQuote",input:{symbols:i.slice(0,3)},output:v,startedAt:Date.now(),finishedAt:Date.now()}))}}catch(g){console.warn("[TradeAgent] Failed to fetch trade data:",g)}const d=`You are the Trade Mode assistant. Provide price action, key levels, and risk notes for trading queries.

${l?`Current Market Data:
${l}

`:""}User Query: ${n}

Provide a concise analysis with:
1. Current price action and trend
2. Key support/resistance levels (if applicable)
3. Risk considerations
4. Market sentiment`,u=r.tools["redix.ask"];if(!u)return{success:!1,error:"Trade agent missing redix.ask tool"};const p=await u({prompt:d});return s.push({toolId:"redix.ask",input:{prompt:d},output:p,startedAt:Date.now(),finishedAt:Date.now()}),{success:!0,output:typeof p=="string"?p:JSON.stringify(p),steps:s}}}),this.registerAgent({id:"graphmind.agent",name:"GraphMind Agent",description:"Queries and visualizes the personal knowledge graph from SuperMemory.",version:"1.0.0",capabilities:["memory:read","redix:ask"],tools:["memory.search","redix.ask","graph.query"],trigger:{keywords:["graph","knowledge","connect","relationship","visualize"],intent:["research"]},maxSteps:3,async entryPoint(t,r){const s=[],n=r.tools["memory.search"],o=n?await n({query:t.prompt}):[];s.push({toolId:"memory.search",input:{query:t.prompt},output:o,startedAt:Date.now(),finishedAt:Date.now()});const c=r.tools["redix.ask"],i=o.length>0?`Found ${o.length} related memories. Use these to build connections in the knowledge graph.

User query: ${t.prompt}`:t.prompt,l=c?await c({prompt:`You are the GraphMind assistant. Help users explore their knowledge graph by identifying connections, relationships, and patterns in their SuperMemory.

${i}`}):"GraphMind agent requires Redix connection.";return{success:!0,output:typeof l=="string"?l:JSON.stringify(l),steps:s}}}),this.registerAgent({id:"docs.agent",name:"Docs Agent",description:"Summarizes documents, extracts key information, and helps with documentation queries.",version:"1.0.0",capabilities:["memory:read","memory:write","redix:ask"],tools:["memory.search","memory.saveNote","redix.ask","doc.summarize"],trigger:{keywords:["document","doc","summarize","extract","key points"],intent:["research","fact"]},maxSteps:3,async entryPoint(t,r){const s=[],n=r.tools["redix.ask"];if(!n)return{success:!1,error:"Docs agent missing redix.ask tool"};const o=`You are the Docs Mode assistant. Summarize documents, extract key information, and help with documentation queries.

User query: ${t.prompt}

Provide a structured summary with:
1. Key points
2. Important details
3. Action items (if any)`,c=await n({prompt:o});return s.push({toolId:"redix.ask",input:{prompt:o},output:c,startedAt:Date.now(),finishedAt:Date.now()}),{success:!0,output:typeof c=="string"?c:JSON.stringify(c),steps:s}}}),this.registerAgent({id:"images.agent",name:"Images Agent",description:"Helps with visual search, image analysis, and inspiration boards.",version:"1.0.0",capabilities:["web:fetch","redix:ask"],tools:["web.fetch","redix.ask","image.search"],trigger:{keywords:["image","picture","visual","photo","find images"],intent:["research"]},maxSteps:3,async entryPoint(t,r){const s=[],n=r.tools["redix.ask"];if(!n)return{success:!1,error:"Images agent missing redix.ask tool"};const o=`You are the Images Mode assistant. Help users find and analyze images, create inspiration boards, and work with visual content.

User query: ${t.prompt}`,c=await n({prompt:o});return s.push({toolId:"redix.ask",input:{prompt:o},output:c,startedAt:Date.now(),finishedAt:Date.now()}),{success:!0,output:typeof c=="string"?c:JSON.stringify(c),steps:s}}}),this.registerAgent({id:"threats.agent",name:"Threats Agent",description:"Analyzes security threats, provides threat intelligence, and helps with network isolation.",version:"1.0.0",capabilities:["web:fetch","redix:ask"],tools:["web.fetch","redix.ask","threat.scan"],trigger:{keywords:["threat","security","vulnerability","malware","phishing","scan"],intent:["research","fact"]},maxSteps:4,async entryPoint(t,r){const s=[],n=r.tools["redix.ask"];if(!n)return{success:!1,error:"Threats agent missing redix.ask tool"};const o=`You are the Threats Mode assistant. Analyze security threats, provide threat intelligence, and help with security analysis.

User query: ${t.prompt}

Provide:
1. Threat assessment
2. Risk level
3. Recommended actions
4. Security best practices`,c=await n({prompt:o});return s.push({toolId:"redix.ask",input:{prompt:o},output:c,startedAt:Date.now(),finishedAt:Date.now()}),{success:!0,output:typeof c=="string"?c:JSON.stringify(c),steps:s}}})}async persistAgentMemory(t){try{Ne.getState().addEntry({agentId:t.agentId,runId:t.runId,prompt:t.prompt,response:t.output,error:t.error,success:t.success,tokens:void 0})}catch(r){console.warn("[AgentRuntime] Failed to update agent memory store:",r)}if(!(typeof window>"u"))try{await lt.saveEvent({type:"agent",value:t.output||t.error||t.prompt,metadata:{action:t.prompt,runId:t.runId,skill:t.agentId,result:t.output,error:t.error,duration:t.durationMs,success:t.success}})}catch(r){console.warn("[AgentRuntime] Failed to persist run in SuperMemory:",r)}}createToolContext(t){return{signal:t?.signal,memorySearch:t?.memorySearch||(async r=>(await me(r,{limit:12})).map(n=>n.event)),saveMemory:t?.saveMemory||(async r=>(await qe(r)).eventId),redixAsk:t?.redixAsk||(async()=>""),safeFetch:t?.safeFetch||fetch}}}function Fr(e,t){return!t||t.length===0?e:`Context:
${t.slice(0,5).map(s=>`- ${s.title||s.snippet||s.id}`).join(`
`)}

User Prompt: ${e}`}const Ur=new Nr;function us(e){return it.useCallback(t=>Ur.execute({...t,agentId:e}),[e])}export{hr as A,is as B,we as C,Yr as D,Ce as E,j as F,Tt as G,_t as H,Xr as I,Zr as J,Qr as K,vt as L,Kr as M,Hr as N,Vr as O,es as P,ts as Q,qt as R,Ht as S,ve as T,Le as U,rs as V,ss as W,A as _,P as a,W as b,Me as c,G as d,dr as e,je as f,us as g,N as h,Ie as i,ze as j,ye as k,$ as l,I as m,Se as n,cs as o,as as p,ns as q,Ve as r,ls as s,tt as t,Qt as u,Jr as v,Wr as w,ds as x,Ne as y,os as z};
//# sourceMappingURL=core-ai-yFIunLTZ.js.map
