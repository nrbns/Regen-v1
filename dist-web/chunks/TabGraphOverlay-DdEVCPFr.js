import{r as b,j as e,au as T,O as I,X as M,c4 as O}from"./vendor-react-gmX1Lmvt.js";import{e as C}from"./AppShell-CJtR0Pw4.js";import{c as W}from"./vendor-zustand-BWsgwsXr.js";import{i as z}from"./core-ai-yFIunLTZ.js";import{m as N}from"./vendor-framer-motion-DDE19Uim.js";import{f as S}from"./vendor-utils-5Vdoy44w.js";import"./vendor-react-dom-Bkb6jJ_S.js";import"./vendor-Vl2WtvH-.js";import"../assets/index-D9cF9G1U.js";import"./mode-research-BclgCwOH.js";import"./core-memory-DmK-uh9X.js";import"./mode-docs-FcsoolLb.js";import"./vendor-pdf-ejcqEZLU.js";import"./vendor-mammoth-BPQIafDs.js";import"@tauri-apps/api/core";import"./mode-manager.ts-DwguZmJt.js";import"./History-kg0LrAO3.js";import"./Downloads-CU-ngJEB.js";import"./OmniDesk-C5fSodZ1.js";import"./WorkspacesPanel-3geKynW_.js";import"./bookmarksStore-CAScveEF.js";import"./workspacesStore-BSqEl-CQ.js";import"./tradeStore-CHfkU4NA.js";import"./dataService-HUHZrGu9.js";import"./registry-CG5fPtjR.js";import"./trustDashboardStore-BRaGSCcb.js";const F=W((l,r)=>({plan:null,loading:!1,error:null,lastFetchedAt:null,async fetch(n){const{loading:x,lastFetchedAt:p}=r();if(!x&&!(!n?.force&&p&&Date.now()-p<1e4)){l({loading:!0,error:null});try{const a=await z.graph.workflow({maxSteps:n?.maxSteps??5});if(!a||typeof a!="object")throw new Error("Workflow weaver unavailable.");l({plan:a,loading:!1,lastFetchedAt:Date.now()})}catch(a){l({error:a instanceof Error?a.message:String(a),loading:!1})}}},setPlan(n){l({plan:n})}})),A={domain:"#60a5fa",container:"#34d399",mode:"#a855f7",timeline:"#f97316"},c={width:680,height:520},w=28,R=(l,r)=>{if(r===0)return{x:c.width/2,y:c.height/2};const n=2*Math.PI*l/r,x=Math.min(c.width,c.height)/2-70,p=c.width/2+x*Math.cos(n),a=c.height/2+x*Math.sin(n);return{x:p,y:a}};function ce(){const{visible:l,data:r,loading:n,error:x,close:p,refresh:a,focusedTabId:g,setFocusedTab:E}=C(t=>({visible:t.visible,data:t.data,loading:t.loading,error:t.error,close:t.close,refresh:t.refresh,focusedTabId:t.focusedTabId,setFocusedTab:t.setFocusedTab})),{plan:u,loading:v,error:k,fetch:h}=F(t=>({plan:t.plan,loading:t.loading,error:t.error,fetch:t.fetch})),[o,j]=b.useState(null);b.useEffect(()=>{if(!l)return;!r&&!n&&a();const t=setInterval(()=>{a()},15e3);return()=>clearInterval(t)},[l,r,n,a]),b.useEffect(()=>{if(!l)return;h({maxSteps:5,force:!0});const t=setInterval(()=>{h({maxSteps:5})},2e4);return()=>clearInterval(t)},[l,h]);const f=b.useMemo(()=>{if(!r)return null;const t=r.nodes.map((s,m)=>({node:s,...R(m,r.nodes.length)})),i=new Map(t.map(s=>[s.node.id,s])),d=r.edges.map(s=>{const m=i.get(s.source),y=i.get(s.target);return!m||!y?null:{edge:s,source:m,target:y}}).filter(s=>!!s);return{positions:t,edges:d}},[r]);b.useEffect(()=>{if(!f||!g)return;const t=f.positions.find(i=>i.node.id===g);t&&j(t.node)},[f,g]);const D=()=>{j(null),E(null),p()};return l?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:e.jsxs(N.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.15},className:"relative w-[820px] max-w-[92vw] rounded-3xl border border-slate-700/70 bg-slate-950/95 shadow-2xl shadow-black/50",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 border-b border-slate-800/60 px-6 py-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-emerald-300",children:[e.jsx(T,{size:16}),"Dynamic Tab Graph"]}),e.jsx("div",{className:"text-lg font-semibold text-gray-100",children:"Browse DNA Overlay"}),e.jsxs("div",{className:"text-xs text-gray-400",children:[r?.summary.totalTabs??0," tabs Â· ",r?.summary.domains??0," domains Â· ",r?.summary.containers??0," ","containers",r?.updatedAt&&e.jsxs("span",{className:"ml-2 text-gray-500",children:["Updated"," ",S(new Date(r.updatedAt),{addSuffix:!0})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{a(),h({maxSteps:5,force:!0})},disabled:n,className:"rounded-xl border border-slate-700/60 bg-slate-900/70 px-3 py-2 text-xs font-medium text-gray-200 hover:bg-slate-900/90 transition-colors disabled:cursor-wait disabled:opacity-50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{size:14,className:n?"animate-spin":""}),"Refresh"]})}),e.jsx("button",{type:"button",onClick:D,className:"rounded-full border border-slate-700/60 bg-slate-900/70 p-2 text-gray-300 hover:bg-slate-900/90 transition-colors","aria-label":"Close tab graph overlay",children:e.jsx(M,{size:16})})]})]}),e.jsxs("div",{className:"px-6 pb-6",children:[x&&e.jsx("div",{className:"mb-3 rounded-lg border border-rose-500/40 bg-rose-500/10 px-4 py-2 text-xs text-rose-100",children:x}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-[auto_220px]",children:[e.jsx("div",{className:"relative flex items-center justify-center rounded-2xl border border-slate-800/60 bg-slate-900/60 p-4",children:e.jsxs("svg",{width:c.width,height:c.height,className:"text-gray-500",children:[f?.edges.map(({edge:t,source:i,target:d})=>{const s=t.reasons[0]??"domain",m=A[s]??"#94a3b8",y=1+Math.min(t.weight,4);return e.jsx("line",{x1:i.x,y1:i.y,x2:d.x,y2:d.y,stroke:m,strokeOpacity:.4,strokeWidth:y},t.id)}),f?.positions.map(({node:t,x:i,y:d})=>{const s=g===t.id;return e.jsxs("g",{transform:`translate(${i}, ${d})`,children:[s&&e.jsx(N.circle,{r:w+14,className:"fill-transparent stroke-purple-400/70",strokeWidth:1.5,animate:{scale:[1,1.08,1]},transition:{duration:1.5,repeat:1/0}}),e.jsx(N.circle,{r:w,className:`stroke-2 ${s?"stroke-purple-400":t.active?"stroke-emerald-400":"stroke-slate-700/70"}`,fill:s?"#a855f73d":t.active?"#10b98133":"#1f293733",whileHover:{scale:1.05},onMouseEnter:()=>j(t),onMouseLeave:()=>j(null)}),e.jsx("text",{textAnchor:"middle",dominantBaseline:"middle",className:"pointer-events-none select-none text-[10px] font-medium fill-gray-200",children:t.mode==="ghost"?"ðŸ‘»":t.mode==="private"?"ðŸ›¡ï¸":"ðŸ—‚ï¸"}),e.jsx("text",{y:w+14,textAnchor:"middle",className:"pointer-events-none select-none text-[10px] fill-gray-300",children:t.title.slice(0,24)})]},t.id)})]})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"rounded-xl border border-slate-800/60 bg-slate-900/60 p-3 text-xs text-gray-300",children:[e.jsx("div",{className:"mb-2 font-semibold text-sm text-gray-100",children:"Legend"}),e.jsx("div",{className:"flex flex-col gap-2",children:Object.entries(A).map(([t,i])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex h-2.5 w-8 rounded-full",style:{background:i,opacity:.5}}),e.jsxs("span",{className:"capitalize text-gray-300",children:[t," affinity"]})]},t))})]}),e.jsxs("div",{className:"flex-1 overflow-hidden rounded-xl border border-slate-800/60 bg-slate-900/60 p-3 text-xs text-gray-300",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-100",children:"Tab Details"}),o&&e.jsx("a",{href:o.url,className:"text-[11px] text-blue-300 hover:text-blue-200",target:"_blank",rel:"noreferrer",children:"Open"})]}),o?e.jsxs("div",{className:"space-y-1 text-[11px] leading-snug text-gray-300",children:[e.jsx("div",{className:"font-medium text-gray-100",children:o.title}),e.jsx("div",{className:"text-gray-400 break-all",children:o.url}),e.jsxs("div",{children:["Domain: ",e.jsx("span",{className:"text-gray-200",children:o.domain})]}),o.containerName&&e.jsxs("div",{children:["Container: ",e.jsx("span",{className:"text-gray-200",children:o.containerName})]}),o.mode&&e.jsxs("div",{children:["Mode: ",e.jsx("span",{className:"text-gray-200",children:o.mode})]}),typeof o.lastActiveAt=="number"&&e.jsxs("div",{children:["Last active"," ",S(new Date(o.lastActiveAt),{addSuffix:!0})]})]}):e.jsx("div",{className:"text-[11px] text-gray-500",children:"Hover a node to inspect metadata."})]}),e.jsxs("div",{className:"overflow-hidden rounded-xl border border-purple-500/30 bg-purple-500/5 p-3 text-xs text-gray-200",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-purple-200",children:[e.jsx(O,{size:14})," Neural Workflow Weaver"]}),e.jsx("button",{type:"button",onClick:()=>void h({maxSteps:5,force:!0}),className:"rounded-lg border border-purple-400/40 bg-purple-500/10 px-2 py-1 text-[11px] text-purple-100 hover:bg-purple-500/20 transition-colors",disabled:v,children:v?"Generatingâ€¦":"Regenerate"})]}),k&&e.jsx("div",{className:"mb-2 rounded border border-rose-500/40 bg-rose-500/10 px-2 py-1 text-[11px] text-rose-100",children:k}),v&&!u&&e.jsx("div",{className:"text-[11px] text-purple-200/70",children:"Analyzing your open tabsâ€¦"}),!v&&u&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-[11px] text-purple-100/80",children:u.summary}),e.jsx("div",{className:"space-y-2",children:u.steps.length===0?e.jsx("div",{className:"text-[11px] text-purple-200/70",children:"Open a few research tabs to generate a workflow."}):u.steps.map((t,i)=>e.jsxs("div",{className:"rounded-lg border border-purple-400/30 bg-purple-500/10 p-2 text-[11px] text-purple-100/90",children:[e.jsxs("div",{className:"flex items-center justify-between text-[10px] uppercase tracking-wide text-purple-200/80",children:[e.jsxs("span",{children:["Step ",i+1]}),typeof t.confidence=="number"&&e.jsxs("span",{children:[Math.round(t.confidence*100),"% confidence"]})]}),e.jsx("div",{className:"mt-1 text-[12px] font-semibold text-purple-50",children:t.title}),e.jsx("div",{className:"mt-1 text-[11px] text-purple-100/80",children:t.description}),t.recommendedActions?.length>0&&e.jsx("ul",{className:"mt-2 list-disc space-y-0.5 pl-4 text-[11px] text-purple-100/70",children:t.recommendedActions.map((d,s)=>e.jsx("li",{children:d},`${t.id}-action-${s}`))})]},t.id))})]})]})]})]})]})]})}):null}export{ce as TabGraphOverlay};
//# sourceMappingURL=TabGraphOverlay-DdEVCPFr.js.map
