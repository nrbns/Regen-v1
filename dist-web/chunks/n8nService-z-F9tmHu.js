function u(){const e="http://localhost:5678",r=`${e}/webhook`;return{baseUrl:e,webhookUrl:r,apiKey:void 0}}async function d(e,r){const n={...u(),...r};if(!e.workflowId)return{success:!1,workflowId:e.workflowId||"unknown",error:"Workflow ID is required"};try{const c=`${n.webhookUrl||`${n.baseUrl}/webhook`}/${e.workflowId}`,a={...e.data,language:e.language,sourceMode:e.sourceMode,metadata:e.metadata,timestamp:Date.now()},i={"Content-Type":"application/json"};n.apiKey&&(i["X-N8N-API-KEY"]=n.apiKey);const s=await fetch(c,{method:"POST",headers:i,body:JSON.stringify(a)});if(!s.ok){const w=await s.text().catch(()=>"Unknown error");throw new Error(`n8n workflow returned ${s.status}: ${w}`)}const o=await s.json().catch(()=>({}));return{success:!0,workflowId:e.workflowId,data:o,executionId:o.executionId||o.id}}catch(t){return console.error("[N8nService] Workflow call failed:",t),{success:!1,workflowId:e.workflowId,error:t instanceof Error?t.message:String(t)}}}async function f(e,r,n){const t=[],c=r.interval||1e3,a=r.maxIterations||10;let i=0,s=!0;for(;s&&i<a;){i++;try{const o=await d(e,n);t.push(o),r.onIteration&&r.onIteration(o,i),r.condition?s=r.condition(o):s=o.success,s&&i<a&&await new Promise(w=>setTimeout(w,c))}catch(o){const w={success:!1,workflowId:e.workflowId,error:o instanceof Error?o.message:String(o)};t.push(w),r.onError&&r.onError(o instanceof Error?o:new Error(String(o))),(!r.condition||!r.condition(w))&&(s=!1)}}return r.onComplete&&r.onComplete(t),t}async function l(e){const r={...u(),...e};if(!r.apiKey)return console.warn("[N8nService] API key not configured, cannot list workflows"),[];try{const n=`${r.baseUrl}/api/v1/workflows`,t=await fetch(n,{headers:{"X-N8N-API-KEY":r.apiKey}});if(!t.ok)throw new Error(`n8n API returned ${t.status}`);const c=await t.json();return Array.isArray(c)?c.map(a=>({id:a.id||a.name,name:a.name||"Unnamed Workflow",description:a.description})):[]}catch(n){return console.error("[N8nService] Failed to list workflows:",n),[]}}export{d as callN8nWorkflow,l as listN8nWorkflows,f as runN8nWorkflowLoop};
//# sourceMappingURL=n8nService-z-F9tmHu.js.map
