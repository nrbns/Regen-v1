const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/core-ai-yFIunLTZ.js","chunks/vendor-zustand-BWsgwsXr.js","chunks/vendor-react-gmX1Lmvt.js","chunks/vendor-react-dom-Bkb6jJ_S.js","chunks/vendor-Vl2WtvH-.js","chunks/mode-manager.ts-DwguZmJt.js","chunks/core-memory-DmK-uh9X.js"])))=>i.map(i=>d[i]);
import{b as ve,t as K,_ as je}from"./core-ai-yFIunLTZ.js";import{j as e,X as Me,t as Ne,u as Pe,m as ue,w as Fe,r as l,A as _e,x as Oe,G as Ie,S as ze,y as Be,H as qe,J as Ue,g as oe}from"./vendor-react-gmX1Lmvt.js";import{W as We,L as He}from"./vendor-charts-CEM9Czug.js";import{A as ke,m as W}from"./vendor-framer-motion-DDE19Uim.js";import{u as Qe}from"./mode-research-BclgCwOH.js";import"./vendor-zustand-BWsgwsXr.js";import"./vendor-Vl2WtvH-.js";import"./mode-manager.ts-DwguZmJt.js";import"./core-memory-DmK-uh9X.js";import"./vendor-react-dom-Bkb6jJ_S.js";import"./vendor-utils-5Vdoy44w.js";import"./mode-docs-FcsoolLb.js";import"./vendor-pdf-ejcqEZLU.js";import"./vendor-mammoth-BPQIafDs.js";var Ye=Object.defineProperty,Ge=(u,t,a)=>t in u?Ye(u,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):u[t]=a,U=(u,t,a)=>Ge(u,typeof t!="symbol"?t+"":t,a);const Se=typeof window<"u"&&(window.__API_BASE_URL||void 0)||"http://127.0.0.1:4000";class Je{constructor(){U(this,"eventSource",null),U(this,"callbacks",new Map),U(this,"currentSymbol",null),U(this,"reconnectAttempts",0),U(this,"maxReconnectAttempts",5),U(this,"reconnectDelay",1e3)}subscribe(t,a){const i=t.includes(":")?t.split(":")[1]:t;return this.callbacks.has(i)||this.callbacks.set(i,new Set),this.callbacks.get(i).add(a),this.currentSymbol!==i&&(this.currentSymbol=i,this.connect(i)),()=>{const d=this.callbacks.get(i);d&&(d.delete(a),d.size===0&&(this.callbacks.delete(i),this.disconnect()))}}connect(t){this.disconnect();const a=`${Se}/stock/stream/${t}`;console.log(`[RealtimeMarketData] Connecting to ${a}`);try{this.eventSource=new EventSource(a),this.reconnectAttempts=0,this.eventSource.onopen=()=>{console.log(`[RealtimeMarketData] Connected for ${t}`),this.reconnectAttempts=0},this.eventSource.onmessage=i=>{try{if(i.data===": ping"||i.data.trim()==="")return;const d=JSON.parse(i.data);if(d.status==="subscribed"){console.log(`[RealtimeMarketData] Subscribed to ${d.symbol}`);return}if(d.price!==void 0){const r={symbol:d.symbol||t,price:Number(d.price),volume:d.volume?Number(d.volume):void 0,timestamp:d.timestamp||Date.now()},h=this.callbacks.get(t);h&&h.forEach(n=>n(r))}(d.status==="closed"||d.status==="error")&&(console.warn(`[RealtimeMarketData] Stream ${d.status} for ${t}`),d.status==="error"&&this.scheduleReconnect(t))}catch(d){console.error("[RealtimeMarketData] Failed to parse SSE message:",d)}},this.eventSource.onerror=i=>{console.error(`[RealtimeMarketData] SSE error for ${t}:`,i),this.eventSource?.close(),this.scheduleReconnect(t)}}catch(i){console.error(`[RealtimeMarketData] Failed to create EventSource for ${t}:`,i),this.scheduleReconnect(t)}}scheduleReconnect(t){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error(`[RealtimeMarketData] Max reconnect attempts reached for ${t}`);return}this.reconnectAttempts++;const a=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`[RealtimeMarketData] Reconnecting to ${t} in ${a}ms (attempt ${this.reconnectAttempts})`),setTimeout(()=>{this.currentSymbol===t&&this.callbacks.has(t)&&this.connect(t)},a)}disconnect(){this.eventSource&&(this.eventSource.close(),this.eventSource=null)}async getHistoricalCandles(t,a="D",i,d){try{const r=t.includes(":")?t.split(":")[1]:t,h=await fetch(`${Se}/api/trade/candles/${r}?interval=${a}&limit=50`);if(!h.ok)throw new Error(`Failed to fetch candles: ${h.statusText}`);const n=await h.json();return n.candles&&Array.isArray(n.candles)?n.candles.map(v=>({time:(v.timestamp||v.time)*1e3,open:v.open,high:v.high,low:v.low,close:v.close,volume:v.volume||0})):n.c&&Array.isArray(n.c)?n.c.map((v,N)=>({time:(n.t[N]||Date.now()/1e3)*1e3,open:n.o[N],high:n.h[N],low:n.l[N],close:n.c[N],volume:n.v[N]||0})):[]}catch(r){return console.error("[RealtimeMarketData] Failed to fetch historical candles:",r),[]}}}let le=null;function ce(){return le||(le=new Je),le}var Ve=Object.defineProperty,Ke=(u,t,a)=>t in u?Ve(u,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):u[t]=a,L=(u,t,a)=>Ke(u,typeof t!="symbol"?t+"":t,a);const Xe="ws://127.0.0.1:18080";class Ze{constructor(){L(this,"ws",null),L(this,"callbacks",new Set),L(this,"reconnectAttempts",0),L(this,"maxReconnectAttempts",10),L(this,"reconnectDelay",1e3),L(this,"reconnectTimeout",null),L(this,"subscribedSymbols",new Set),L(this,"isConnected",!1)}subscribe(t,a){const i=t.includes(":")?t.split(":")[1]:t;return this.callbacks.add(a),this.subscribedSymbols.add(i),this.isConnected?this.subscribeToSymbol(i):this.connect(),()=>{this.callbacks.delete(a),this.subscribedSymbols.delete(i),this.callbacks.size===0&&this.disconnect()}}connect(){if(this.ws&&this.ws.readyState===WebSocket.OPEN)return;const t=`${Xe}/trade_signals`;console.log("[TradeSignalService] Connecting to",t);try{this.ws=new WebSocket(t),this.ws.onopen=()=>{console.log("[TradeSignalService] Connected"),this.isConnected=!0,this.reconnectAttempts=0,this.subscribedSymbols.forEach(a=>{this.subscribeToSymbol(a)})},this.ws.onmessage=a=>{try{const i=JSON.parse(a.data);if(i.type==="trade_signal"){const d={symbol:i.symbol,action:i.action,confidence:i.confidence||0,reason:i.reason||"",timestamp:i.timestamp||Date.now()};this.callbacks.forEach(r=>{try{r(d)}catch(h){console.error("[TradeSignalService] Callback error",h)}})}else i.type==="error"&&console.error("[TradeSignalService] Server error",i.message)}catch(i){console.error("[TradeSignalService] Failed to parse message",i)}},this.ws.onerror=a=>{console.error("[TradeSignalService] WebSocket error",a)},this.ws.onclose=()=>{console.log("[TradeSignalService] WebSocket closed"),this.isConnected=!1,this.scheduleReconnect()}}catch(a){console.error("[TradeSignalService] Failed to create WebSocket",a),this.scheduleReconnect()}}subscribeToSymbol(t){!this.ws||this.ws.readyState!==WebSocket.OPEN||(this.ws.send(JSON.stringify({type:"subscribe",symbol:t})),console.log("[TradeSignalService] Subscribed to",t))}scheduleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("[TradeSignalService] Max reconnect attempts reached");return}this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.reconnectAttempts++;const t=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`[TradeSignalService] Reconnecting in ${t}ms (attempt ${this.reconnectAttempts})`),this.reconnectTimeout=setTimeout(()=>{this.callbacks.size>0&&this.connect()},t)}disconnect(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.ws&&(this.ws.close(),this.ws=null),this.isConnected=!1}}let de=null;function et(){return de||(de=new Ze),de}function tt({isOpen:u,order:t,onConfirm:a,onCancel:i,warnings:d=[],errors:r=[]}){if(!t)return null;const h=r.length===0;return e.jsx(ke,{children:u&&e.jsxs(e.Fragment,{children:[e.jsx(W.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:i,className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm"}),e.jsx(W.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:n=>n.stopPropagation(),children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border border-gray-700 bg-gray-900 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-700 p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Confirm Order"}),e.jsx("button",{onClick:i,className:"rounded-lg p-2 transition-colors hover:bg-gray-800","aria-label":"Close",children:e.jsx(Me,{size:20,className:"text-gray-400"})})]}),e.jsxs("div",{className:"space-y-4 p-6",children:[r.length>0&&e.jsxs("div",{className:"rounded-lg border border-red-700 bg-red-900/30 p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(Ne,{size:16,className:"text-red-400"}),e.jsx("span",{className:"text-sm font-semibold text-red-300",children:"Errors"})]}),e.jsx("ul",{className:"space-y-1 text-xs text-red-200",children:r.map((n,v)=>e.jsxs("li",{children:["• ",n]},v))})]}),d.length>0&&e.jsxs("div",{className:"rounded-lg border border-yellow-700 bg-yellow-900/30 p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(Ne,{size:16,className:"text-yellow-400"}),e.jsx("span",{className:"text-sm font-semibold text-yellow-300",children:"Warnings"})]}),e.jsx("ul",{className:"space-y-1 text-xs text-yellow-200",children:d.map((n,v)=>e.jsxs("li",{children:["• ",n]},v))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Side"}),e.jsx("span",{className:`text-sm font-bold ${t.side==="buy"?"text-green-400":"text-red-400"}`,children:t.side.toUpperCase()})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Symbol"}),e.jsx("span",{className:"text-sm font-semibold text-white",children:t.symbol})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Quantity"}),e.jsx("span",{className:"text-sm font-semibold text-white",children:t.quantity})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Order Type"}),e.jsx("span",{className:"text-sm font-semibold text-white",children:t.orderType.toUpperCase()})]}),t.orderType==="limit"&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Limit Price"}),e.jsx("span",{className:"text-sm font-semibold text-white",children:t.price.toLocaleString(void 0,{minimumFractionDigits:2})})]}),t.stopLoss&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Stop Loss"}),e.jsx("span",{className:"text-sm font-semibold text-red-400",children:t.stopLoss.toLocaleString(void 0,{minimumFractionDigits:2})})]}),t.takeProfit&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Take Profit"}),e.jsx("span",{className:"text-sm font-semibold text-green-400",children:t.takeProfit.toLocaleString(void 0,{minimumFractionDigits:2})})]}),e.jsxs("div",{className:"space-y-2 border-t border-gray-700 pt-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Estimated Cost"}),e.jsx("span",{className:"text-sm font-semibold text-white",children:t.estimatedCost.toLocaleString(void 0,{minimumFractionDigits:2})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Fees"}),e.jsx("span",{className:"text-sm text-gray-300",children:t.fees.toLocaleString(void 0,{minimumFractionDigits:2})})]}),t.marginRequired&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Margin Required"}),e.jsx("span",{className:"text-sm font-semibold text-yellow-400",children:t.marginRequired.toLocaleString(void 0,{minimumFractionDigits:2})})]}),e.jsxs("div",{className:"flex items-center justify-between border-t border-gray-700 pt-2",children:[e.jsx("span",{className:"text-base font-semibold text-gray-300",children:"Total"}),e.jsx("span",{className:"text-lg font-bold text-white",children:(t.estimatedCost+t.fees).toLocaleString(void 0,{minimumFractionDigits:2})})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 border-t border-gray-700 p-6",children:[e.jsx("button",{onClick:i,className:"flex-1 rounded-lg bg-gray-800 px-4 py-3 font-semibold text-white transition-colors hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:a,disabled:!h,className:`flex flex-1 items-center justify-center gap-2 rounded-lg px-4 py-3 font-semibold transition-all ${t.side==="buy"?"bg-green-600 text-white hover:bg-green-500":"bg-red-600 text-white hover:bg-red-500"} ${h?"shadow-lg":"cursor-not-allowed opacity-50"}`,children:h?e.jsxs(e.Fragment,{children:[e.jsx(Pe,{size:18}),"Confirm ",t.side.toUpperCase()]}):"Cannot Confirm"})]}),e.jsxs("div",{className:"px-6 pb-4 text-center text-xs text-gray-500",children:["Press ",e.jsx("kbd",{className:"rounded bg-gray-800 px-1.5 py-0.5",children:"Enter"})," to confirm,"," ",e.jsx("kbd",{className:"rounded bg-gray-800 px-1.5 py-0.5",children:"Esc"})," to cancel"]})]})})]})})}function st({bids:u,asks:t,maxDepth:a=10,onPriceClick:i}){const d=u.slice(0,a).reverse(),r=t.slice(0,a);let h=0;const n=d.map(f=>(h+=f.quantity,{...f,cumulative:h}));let v=0;const N=r.map(f=>(v+=f.quantity,{...f,cumulative:v})),M=Math.max(...n.map(f=>f.cumulative||0),...N.map(f=>f.cumulative||0));return e.jsxs("div",{className:"overflow-hidden rounded-lg border border-gray-700 bg-gray-900",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-700 bg-gray-800/50 p-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-300",children:"Order Book"}),e.jsx("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:e.jsxs("span",{children:["Top ",a]})})]}),e.jsxs("div",{className:"grid grid-cols-2 divide-x divide-gray-700",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b border-gray-700 bg-red-900/20 p-2",children:[e.jsx(ue,{size:14,className:"text-red-400"}),e.jsx("span",{className:"text-xs font-semibold text-red-400",children:"Asks (Sell)"})]}),e.jsx("div",{className:"space-y-0.5 p-2",children:r.length>0?N.map((f,S)=>{const C=(f.cumulative||0)/M*100;return e.jsxs(W.button,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},onClick:()=>i?.(f.price,"sell"),className:"group relative flex w-full items-center justify-between rounded px-2 py-1 transition-colors hover:bg-red-900/20",children:[e.jsx("div",{className:"absolute bottom-0 left-0 top-0 rounded bg-red-900/20",style:{width:`${C}%`}}),e.jsxs("div",{className:"relative z-10 flex w-full items-center justify-between text-xs",children:[e.jsx("span",{className:"font-medium text-red-400",children:f.price.toFixed(2)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-gray-400",children:f.quantity.toLocaleString()}),e.jsx("span",{className:"text-[10px] text-gray-500",children:f.cumulative?.toLocaleString()})]})]})]},`ask-${S}`)}):e.jsx("div",{className:"py-4 text-center text-xs text-gray-500",children:"No asks"})})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b border-gray-700 bg-green-900/20 p-2",children:[e.jsx(Fe,{size:14,className:"text-green-400"}),e.jsx("span",{className:"text-xs font-semibold text-green-400",children:"Bids (Buy)"})]}),e.jsx("div",{className:"space-y-0.5 p-2",children:d.length>0?n.map((f,S)=>{const C=(f.cumulative||0)/M*100;return e.jsxs(W.button,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},onClick:()=>i?.(f.price,"buy"),className:"group relative flex w-full items-center justify-between rounded px-2 py-1 transition-colors hover:bg-green-900/20",children:[e.jsx("div",{className:"absolute bottom-0 right-0 top-0 rounded bg-green-900/20",style:{width:`${C}%`}}),e.jsxs("div",{className:"relative z-10 flex w-full items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-[10px] text-gray-500",children:f.cumulative?.toLocaleString()}),e.jsx("span",{className:"text-gray-400",children:f.quantity.toLocaleString()})]}),e.jsx("span",{className:"font-medium text-green-400",children:f.price.toFixed(2)})]})]},`bid-${S}`)}):e.jsx("div",{className:"py-4 text-center text-xs text-gray-500",children:"No bids"})})]})]}),r.length>0&&d.length>0&&e.jsx("div",{className:"border-t border-gray-700 bg-gray-800/30 p-2",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-400",children:"Spread"}),e.jsxs("span",{className:"font-semibold text-yellow-400",children:[(r[0].price-d[0].price).toFixed(2)," (",((r[0].price-d[0].price)/d[0].price*100).toFixed(3),"%)"]})]})})]})}function rt({trades:u,maxVisible:t=20,symbol:a}){const[i,d]=l.useState([]),r=l.useRef(null);return l.useEffect(()=>{const h=u.slice(-t).reverse();d(h)},[u,t]),e.jsxs("div",{className:"overflow-hidden rounded-lg border border-gray-700 bg-gray-900",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-700 bg-gray-800/50 p-2",children:[e.jsx("h3",{className:"text-xs font-semibold text-gray-300",children:"Recent Trades"}),a&&e.jsx("span",{className:"text-xs text-gray-400",children:a})]}),e.jsx("div",{ref:r,className:"scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-gray-900 h-48 overflow-y-auto",children:e.jsx("div",{className:"divide-y divide-gray-800",children:e.jsx(ke,{initial:!1,children:i.length>0?i.map(h=>{const n=h.side==="buy";return e.jsxs(W.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},className:`flex items-center justify-between px-3 py-2 text-xs transition-colors ${n?"hover:bg-green-900/10":"hover:bg-red-900/10"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n?e.jsx(_e,{size:12,className:"text-green-400"}):e.jsx(Oe,{size:12,className:"text-red-400"}),e.jsx("span",{className:`font-medium ${n?"text-green-400":"text-red-400"}`,children:h.price.toFixed(2)})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-400",children:[e.jsx("span",{children:h.quantity.toLocaleString()}),e.jsx("span",{className:"text-[10px] text-gray-500",children:new Date(h.timestamp).toLocaleTimeString()})]})]},h.id)}):e.jsx("div",{className:"py-8 text-center text-xs text-gray-500",children:"No recent trades"})})})})]})}function at({symbol:u,enabled:t=!0,onTick:a,onCandle:i}){const[d,r]=l.useState(null),[h,n]=l.useState(!1),[v,N]=l.useState(null),[M,f]=l.useState(null),S=l.useRef(null),C=l.useRef(null),_=l.useRef(0);return l.useEffect(()=>{if(!t||!u){S.current&&(S.current.close(),S.current=null),n(!1);return}const P=()=>{try{const A="localhost:4001",O=window.location.protocol==="https:"?"wss":"ws",te=A.includes("://")?`${A}?symbol=${encodeURIComponent(u)}`:`${O}://${A}?symbol=${encodeURIComponent(u)}`,T=new WebSocket(te);S.current=T,T.onopen=()=>{console.log("[useRealtimeTrade] WebSocket connected for",u),n(!0),N(null),_.current=0},T.onmessage=D=>{try{const p=JSON.parse(D.data);if(p.type==="tick"){const b={price:p.price,volume:p.trade?.size||p.volume||0,timestamp:p.trade?.ts||p.timestamp||Date.now(),bid:p.bid,ask:p.ask};r(b),a?.(b)}else if(p.type==="candle"){const b=p.candle||p,F={time:b.time,open:b.open,high:b.high,low:b.low,close:b.close,volume:b.volume||0};i?.(F)}else if(p.type==="orderbook")p.bids&&p.asks&&f({bids:p.bids,asks:p.asks});else if(p.type==="snapshot"&&(p.candles&&Array.isArray(p.candles)&&p.candles.forEach(b=>{const F={time:b.time,open:b.open,high:b.high,low:b.low,close:b.close,volume:b.volume||0};i?.(F)}),p.orderbook&&f({bids:p.orderbook.bids||[],asks:p.orderbook.asks||[]}),p.lastPrice)){const b={price:p.lastPrice,volume:0,timestamp:Date.now()};r(b),a?.(b)}}catch(p){console.error("[useRealtimeTrade] Failed to parse message:",p)}},T.onerror=D=>{console.error("[useRealtimeTrade] WebSocket error:",D),N("Connection error"),n(!1)},T.onclose=()=>{if(console.log("[useRealtimeTrade] WebSocket closed"),n(!1),S.current=null,t){const D=Math.min(1e3*Math.pow(2,_.current),3e4);_.current++,C.current=setTimeout(()=>{P()},D)}}}catch(A){console.error("[useRealtimeTrade] Failed to create WebSocket:",A),N("Failed to connect"),n(!1)}};return P(),()=>{C.current&&clearTimeout(C.current),S.current&&(S.current.close(),S.current=null),n(!1)}},[u,t,a,i]),{tick:d,connected:h,error:v,orderbook:M}}function nt(){const{stagehand:u,execute:t,click:a,type:i,extract:d}=Qe({context:"trade"});return l.useEffect(()=>(typeof window<"u"&&(window.tradeStagehand={stagehand:u,execute:t,click:a,type:i,extract:d,placeOrder:async(r,h,n)=>{await a(`button[data-side="${r}"]`),await i('input[name="quantity"]',h.toString()),n&&await i('input[name="price"]',n.toString()),await a('button[type="submit"]')},getPrice:async()=>{const r=await d(".price-display");return parseFloat(r)},getOrderbook:async()=>{const r=await d(".orderbook-bids"),h=await d(".orderbook-asks");return{bids:r,asks:h}}}),()=>{typeof window<"u"&&delete window.tradeStagehand}),[u,t,a,i,d]),null}const me=[{name:"NIFTY 50",symbol:"NSE:NIFTY",currency:"₹",exchange:"NSE"},{name:"BANKNIFTY",symbol:"NSE:BANKNIFTY",currency:"₹",exchange:"NSE"},{name:"RELIANCE",symbol:"NSE:RELIANCE",currency:"₹",exchange:"NSE"},{name:"TCS",symbol:"NSE:TCS",currency:"₹",exchange:"NSE"},{name:"S&P 500",symbol:"SP:SPX",currency:"$",exchange:"NYSE"},{name:"NASDAQ",symbol:"NASDAQ:NDX",currency:"$",exchange:"NASDAQ"},{name:"Bitcoin",symbol:"BINANCE:BTCUSDT",currency:"$",exchange:"Crypto"},{name:"Ethereum",symbol:"BINANCE:ETHUSDT",currency:"$",exchange:"Crypto"},{name:"Gold",symbol:"FOREX:XAUUSD",currency:"$",exchange:"Forex"}];function St(){const u=l.useRef(null),t=l.useRef(null),a=l.useRef(null),i=ve(s=>s.mode),d=ve(s=>s.setMode),[r,h]=l.useState(me[0]),[n,v]=l.useState(25035.14),[N,M]=l.useState(325.1),[f,S]=l.useState(!0),[C,_]=l.useState(50),[P,A]=l.useState(24700),[O,te]=l.useState(24950),[T,D]=l.useState(!1),[p,b]=l.useState(!0),[F,H]=l.useState(!1),[g,Q]=l.useState(null),[Ce,xe]=l.useState([]),[Te,he]=l.useState([]),[Ee,$e]=l.useState([]),[I,pe]=l.useState("limit"),[se,Y]=l.useState(n),[De,z]=l.useState(null),[G,fe]=l.useState(null),[it,ge]=l.useState(null),[ot,be]=l.useState(null);l.useEffect(()=>{const s=o=>{const{symbol:m,quantity:x,orderType:y,stopLoss:c}=o.detail;if(m){const j=me.find(w=>w.name.toLowerCase().includes(m.toLowerCase())||w.symbol.includes(m));j&&h(j)}x&&_(x),c&&A(c),y&&x&&K.success(`${y==="buy"?"Buy":"Sell"} order: ${x} ${m||r.name}`)};return window.addEventListener("wispr:trade",s),()=>window.removeEventListener("wispr:trade",s)},[r]);const[J,X]=l.useState([]),{connected:E,orderbook:Z}=at({symbol:r.symbol.includes(":")?r.symbol.split(":")[1]:r.symbol,enabled:!0,onTick:s=>{const o=s.price-n;if(v(s.price),M(Math.abs(o)),S(o>=0),Y(s.price),fe(s.price),ge(Math.abs(o)),be(new Date),z(null),a.current&&J.length>0){const m=J[J.length-1],x=Math.floor(Date.now()/6e4)*6e4,y=Math.floor(x/1e3);try{a.current.updateData({time:y,open:m.close,high:Math.max(m.close,s.price),low:Math.min(m.close,s.price),close:s.price})}catch{const c=[...J],j=c.length-1;if(c[j]){c[j]={...c[j],high:Math.max(c[j].high,s.price),low:Math.min(c[j].low,s.price),close:s.price},X(c);const w=c.map(k=>({time:Math.floor(k.time/1e3),open:k.open,high:k.high,low:k.low,close:k.close}));a.current.setData(w)}}}},onCandle:s=>{if(X(o=>{const m=o.findIndex(x=>x.time===s.time);if(m>=0){const x=[...o];return x[m]=s,x}return[...o,s].slice(-200)}),a.current){const m={time:Math.floor(s.time/1e3),open:s.open,high:s.high,low:s.low,close:s.close};try{a.current.updateData?.(m)}catch{const x=[...J,s].slice(-200);X(x);const y=x.map(c=>({time:Math.floor(c.time/1e3),open:c.open,high:c.high,low:c.low,close:c.close}));a.current.setData(y)}}}});l.useEffect(()=>{if(E)return;const s=ce();let o=n,m=n,x=n;const y=s.subscribe(r.symbol,j=>{const w=j.price,k=w-o;o=w,w>m&&(m=w),w<x&&(x=w),v(w),M(Math.abs(k)),S(k>=0),Y(w)});return(async()=>{try{const{tradeApi:j}=await je(async()=>{const{tradeApi:k}=await import("./core-ai-yFIunLTZ.js").then(B=>B.O);return{tradeApi:k}},__vite__mapDeps([0,1,2,3,4,5,6])),w=await j.getQuote(r.symbol);w&&w.price&&(o=w.price,m=w.price,x=w.price,v(w.price),Y(w.price))}catch(j){console.debug("[Trade] Initial quote fetch failed, waiting for SSE:",j)}})(),()=>{y()}},[r.symbol,E,n]),l.useEffect(()=>{const o=et().subscribe(r.symbol,m=>{(m.action==="BUY"||m.action==="SELL")&&K.success(`Trade Signal: ${m.action} ${r.name} (${Math.round(m.confidence*100)}% confidence)`),console.log("[Trade] Received signal:",m)});return()=>{o()}},[r]),l.useEffect(()=>{if(!u.current)return;let s=null,o=null,m=null;const x=()=>{if(u.current)try{const c=u.current,j=c.clientWidth||800,w=c.clientHeight||600;s=We(c,{layout:{background:{type:He.Solid,color:"#000000"},textColor:"#ffffff"},grid:{vertLines:{color:"#1e1e1e"},horzLines:{color:"#1e1e1e"}},width:j,height:w,timeScale:{timeVisible:!0,secondsVisible:!1,borderColor:"#374151"},crosshair:{mode:1},rightPriceScale:{borderColor:"#374151"}});const k=s.addCandlestickSeries??s.addCandlestickSeries;if(typeof k!="function"){console.error("[TradePanel] addCandlestickSeries is not available on chart instance",s),t.current=s;return}const B=k.call(s,{upColor:"#10b981",downColor:"#ef4444",borderVisible:!1,wickUpColor:"#10b981",wickDownColor:"#ef4444"});(async()=>{b(!0);try{const ae="http://localhost:4001",ye=r.symbol.includes(":")?r.symbol.split(":")[1]:r.symbol;try{const q=await fetch(`${ae}/api/candles/${ye}`);if(q.ok){const $=await q.json();if($.candles&&$.candles.length>0){const ne=$.candles.map(R=>({time:Math.floor(R.time/1e3),open:R.open,high:R.high,low:R.low,close:R.close}));B.setData(ne),X($.candles),b(!1);return}}}catch{console.debug("[Trade] Mock server not available, using fallback")}const we=await ce().getHistoricalCandles(ye,"D");if(we.length>0){const q=we.map($=>({time:$.time/1e3,open:$.open,high:$.high,low:$.low,close:$.close}));B.setData(q),b(!1)}else{console.warn("[Trade] Using fallback candle data");const q=Array.from({length:50},($,ne)=>{const R=new Date;R.setDate(R.getDate()-(50-ne));const Re=Math.floor(R.getTime()/1e3),ee=24800+Math.random()*300,ie=ee+(Math.random()-.5)*400,Ae=Math.max(ee,ie)+Math.random()*100,Le=Math.min(ee,ie)-Math.random()*100;return{time:Re,open:ee,high:Ae,low:Le,close:ie}});B.setData(q),b(!1)}}catch(ae){console.error("[Trade] Failed to load candles:",ae),b(!1)}})(),a.current=B,t.current=s,m=()=>{u.current&&s&&s.applyOptions({width:u.current.clientWidth||800,height:u.current.clientHeight||600})},window.addEventListener("resize",m)}catch(c){console.error("[TradePanel] Error initializing chart:",c)}},y=u.current;return y.clientWidth===0||y.clientHeight===0?o=setTimeout(()=>{y.clientWidth>0&&y.clientHeight>0&&x()},100):x(),()=>{o&&clearTimeout(o),m&&window.removeEventListener("resize",m),s&&(s.remove(),t.current=null,a.current=null)}},[]),l.useEffect(()=>{a.current&&t.current&&(async()=>{try{const o=ce(),m=r.symbol.includes(":")?r.symbol.split(":")[1]:r.symbol,x=await o.getHistoricalCandles(m,"D");if(x.length>0&&a.current){const y=x.map(c=>({time:c.time/1e3,open:c.open,high:c.high,low:c.low,close:c.close}));a.current.setData(y)}}catch(o){console.error("[Trade] Failed to reload candles for new symbol:",o)}})()},[r]),l.useEffect(()=>{if(Z&&E)xe(Z.bids.map(s=>({price:s.price,quantity:s.size||s.quantity})).sort((s,o)=>o.price-s.price)),he(Z.asks.map(s=>({price:s.price,quantity:s.size||s.quantity})).sort((s,o)=>s.price-o.price));else if(!E){const s=()=>{const m=n,x=[],y=[];for(let c=0;c<10;c++)x.push({price:m-(c+1)*(m*.001),quantity:Math.floor(Math.random()*1e3)+100}),y.push({price:m+(c+1)*(m*.001),quantity:Math.floor(Math.random()*1e3)+100});xe(x.sort((c,j)=>j.price-c.price)),he(y.sort((c,j)=>c.price-j.price))};s();const o=setInterval(s,2e3);return()=>clearInterval(o)}},[Z,E,n]),l.useEffect(()=>{const o=setInterval(()=>{const m={id:`trade-${Date.now()}`,price:n+(Math.random()-.5)*(n*.002),quantity:Math.floor(Math.random()*500)+10,side:Math.random()>.5?"buy":"sell",timestamp:Date.now()};$e(x=>[...x.slice(-19),m])},3e3);return()=>clearInterval(o)},[n]);const V=l.useCallback(s=>{const o=I==="market"?n:se,m=o*C,x=m*.001,y=I==="market"?m*.1:void 0,c={side:s,symbol:r.name,quantity:C,price:o,orderType:I,stopLoss:P>0?P:void 0,takeProfit:O>0?O:void 0,estimatedCost:m,fees:x,marginRequired:y};Q(c),H(!0)},[C,n,se,I,P,O,r.name]),re=l.useCallback(async()=>{if(!(!g||T)){D(!0);try{const s="http://localhost:4001",o=r.symbol.includes(":")?r.symbol.split(":")[1]:r.symbol;try{const y=await fetch(`${s}/api/orders`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({symbol:o,side:g.side,qty:g.quantity,price:g.orderType==="limit"?g.price:void 0,type:g.orderType})});if(y.ok){const c=await y.json();K.success(`${g.side.toUpperCase()} order placed: ${g.quantity} × ${g.symbol} @ ${r.currency}${g.price.toLocaleString(void 0,{minimumFractionDigits:2})}
Order ID: ${c.orderId} | Filled: ${c.filled}`),H(!1),Q(null),D(!1);return}}catch{console.debug("[Trade] Mock server not available, trying tradeApi")}const{tradeApi:m}=await je(async()=>{const{tradeApi:y}=await import("./core-ai-yFIunLTZ.js").then(c=>c.O);return{tradeApi:y}},__vite__mapDeps([0,1,2,3,4,5,6])),x=await m.placeOrder({symbol:r.symbol,quantity:g.quantity,orderType:g.side,stopLoss:g.stopLoss,takeProfit:g.takeProfit});x.success&&(K.success(`${g.side.toUpperCase()} order placed: ${g.quantity} × ${g.symbol} @ ${r.currency}${g.price.toLocaleString(void 0,{minimumFractionDigits:2})}
Order ID: ${x.orderId}`),H(!1),Q(null))}catch(s){console.error("[Trade] Order placement failed:",s),K.error(`Failed to place ${g.side} order. Please try again.`)}finally{D(!1)}}},[g,T,r.symbol,r.currency]);return l.useEffect(()=>{const s=o=>{F?o.key==="Enter"?(o.preventDefault(),re()):o.key==="Escape"&&(o.preventDefault(),H(!1),Q(null)):o.key==="b"||o.key==="B"?(o.preventDefault(),V("buy")):(o.key==="s"||o.key==="S")&&(o.preventDefault(),V("sell"))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[F,V,re]),l.useEffect(()=>{n&&(fe(n),ge(N),be(new Date))},[n,N]),l.useEffect(()=>{z(!E&&G===null?new Error("WebSocket connection not established"):!E&&G!==null?new Error("Connection lost - showing cached data"):null)},[E,G]),e.jsxs("div",{className:"flex h-full flex-col overflow-hidden bg-black text-white",children:[!E&&G===null&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"text-center p-8 text-gray-400",children:[e.jsx("p",{children:"Trade mode fallback - service unavailable"}),e.jsx("p",{className:"text-sm mt-2",children:De?.message||"WebSocket disconnected"}),e.jsx("button",{onClick:async()=>{z(null),console.log("[Trade] Retrying connection...")},className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Retry Connection"})]})}),!E&&G!==null&&e.jsx("div",{className:"border-b border-yellow-500/40 bg-yellow-500/10 px-4 py-2 text-sm text-yellow-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"⚠️ Showing cached data - Connection lost"}),e.jsx("button",{onClick:async()=>{z(null),console.log("[Trade] Retrying connection...")},className:"rounded bg-yellow-500/20 px-2 py-1 text-xs hover:bg-yellow-500/30",children:"Retry"})]})}),e.jsxs("div",{className:"sticky top-0 z-30 flex flex-shrink-0 items-center justify-between border-b border-purple-800 bg-black/80 px-4 py-2 backdrop-blur",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 text-emerald-400"}),e.jsx("h1",{className:"text-sm font-semibold text-white md:text-lg",children:"Trade Mode"})]}),e.jsxs("div",{className:"flex items-center gap-1 rounded-lg border border-slate-700/50 bg-slate-800/60 p-1",children:[e.jsxs("button",{onClick:()=>d("Browse"),className:`flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium transition-all md:px-3 md:py-1.5 md:text-sm ${i==="Browse"?"bg-emerald-600 text-white shadow-lg shadow-emerald-500/30":"text-gray-400 hover:bg-slate-700/50 hover:text-white"}`,title:"Switch to Browse Mode",children:[e.jsx(Ie,{size:12}),e.jsx("span",{className:"hidden sm:inline",children:"Browse"})]}),e.jsxs("button",{onClick:()=>d("Research"),className:`flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium transition-all md:px-3 md:py-1.5 md:text-sm ${i==="Research"?"bg-emerald-600 text-white shadow-lg shadow-emerald-500/30":"text-gray-400 hover:bg-slate-700/50 hover:text-white"}`,title:"Switch to Research Mode",children:[e.jsx(ze,{size:12}),e.jsx("span",{className:"hidden sm:inline",children:"Research"})]}),e.jsxs("button",{onClick:()=>d("Trade"),className:`flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium transition-all md:px-3 md:py-1.5 md:text-sm ${i==="Trade"?"bg-emerald-600 text-white shadow-lg shadow-emerald-500/30":"text-gray-400 hover:bg-slate-700/50 hover:text-white"}`,title:"Switch to Trade Mode",children:[e.jsx(ue,{size:12}),e.jsx("span",{className:"hidden sm:inline",children:"Trade"})]})]})]}),e.jsx("div",{className:"z-20 flex-shrink-0 bg-gradient-to-r from-purple-800 to-pink-800 p-3 md:p-4",children:e.jsx("div",{className:"scrollbar-hide flex gap-2 overflow-x-auto md:gap-3",children:me.map(s=>e.jsxs("button",{onClick:()=>h(s),className:`flex flex-shrink-0 items-center gap-2 whitespace-nowrap rounded-full px-4 py-2 font-bold transition-all md:px-6 md:py-3 ${r.symbol===s.symbol?"scale-110 bg-white/30 shadow-2xl":"bg-white/10 hover:bg-white/20"}`,children:[s.exchange==="NSE"&&e.jsx(Be,{className:"h-3 w-3 md:h-4 md:w-4"}),s.exchange==="Crypto"&&e.jsx(qe,{className:"h-3 w-3 md:h-4 md:w-4"}),(s.exchange==="NYSE"||s.exchange==="NASDAQ"||s.exchange==="Forex")&&e.jsx(Ue,{className:"h-3 w-3 md:h-4 md:w-4"}),e.jsxs("span",{className:"text-xs md:text-sm",children:[s.currency," ",s.name]})]},s.symbol))})}),e.jsx("div",{className:"z-10 flex-shrink-0 border-b border-gray-800 p-4 md:p-8",children:e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 md:flex-row md:items-end",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black md:text-7xl",children:r.name}),e.jsxs("div",{className:`mt-2 text-3xl font-bold md:mt-4 md:text-6xl ${f?"text-green-400":"text-red-400"}`,children:[r.currency,n.toLocaleString("en-IN",{minimumFractionDigits:2}),e.jsxs("span",{className:"ml-3 text-xl md:ml-6 md:text-4xl",children:[f?"↑":"↓"," ",N.toFixed(1)," (",(N/(n-N)*100).toFixed(2),"%)"]})]})]}),e.jsxs("div",{className:"text-left text-sm text-gray-400 md:text-right md:text-base",children:[e.jsxs("div",{children:["High: ",r.currency,"25,120"]}),e.jsxs("div",{children:["Low: ",r.currency,"24,720"]})]})]})}),e.jsxs("div",{className:"grid flex-1 grid-cols-12 gap-4 overflow-hidden p-4",children:[e.jsxs("div",{className:"col-span-12 flex flex-col lg:col-span-8",children:[e.jsxs("div",{ref:u,className:"relative h-[420px] w-full overflow-hidden rounded-lg border border-[#222] bg-[#030303]",children:[p&&e.jsx("div",{className:"absolute inset-0 z-20 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(oe,{className:"h-8 w-8 animate-spin text-emerald-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Loading chart data..."})]})}),e.jsxs("div",{className:"absolute left-4 top-4 z-10 rounded-lg border border-gray-700 bg-black/70 px-4 py-2 text-xs backdrop-blur md:text-sm",children:["1D • EMA • RSI • Volume Profile",E&&e.jsx("span",{className:"ml-2 text-green-400",children:"● Live"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(rt,{trades:Ee,symbol:r.name})})]}),e.jsxs("div",{className:"col-span-12 flex flex-col gap-4 lg:col-span-4",children:[e.jsx(st,{bids:Ce,asks:Te,onPriceClick:(s,o)=>{Y(s),pe("limit")}}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-lg border border-gray-700 bg-gray-900 p-3",children:[e.jsx("div",{className:"mb-1 text-xs text-gray-400",children:"High"}),e.jsxs("div",{className:"text-sm font-semibold text-white",children:[r.currency,"25,120"]})]}),e.jsxs("div",{className:"rounded-lg border border-gray-700 bg-gray-900 p-3",children:[e.jsx("div",{className:"mb-1 text-xs text-gray-400",children:"Low"}),e.jsxs("div",{className:"text-sm font-semibold text-white",children:[r.currency,"24,720"]})]})]})]})]}),e.jsx(W.div,{initial:{y:200},animate:{y:0},className:"trade-controls fixed bottom-0 left-0 right-0 z-40 border-t-4 border-purple-600 bg-black/95 p-4 shadow-2xl backdrop-blur md:p-6",children:e.jsx("div",{className:"mx-auto max-w-6xl",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-6 md:gap-4",children:[e.jsx("input",{type:"number",value:C,onChange:s=>_(+s.target.value||0),className:"rounded-xl bg-gray-900 px-3 py-3 text-center text-xl font-bold text-white focus:outline-none focus:ring-2 focus:ring-purple-500 md:px-6 md:py-5 md:text-3xl",placeholder:"Qty","aria-label":"Quantity"}),e.jsxs("select",{value:I,onChange:s=>pe(s.target.value),className:"rounded-xl bg-gray-900 px-3 py-3 text-center text-lg font-bold text-white focus:outline-none focus:ring-2 focus:ring-purple-500 md:px-6 md:py-5 md:text-2xl","aria-label":"Order Type",children:[e.jsx("option",{value:"market",children:"Market"}),e.jsx("option",{value:"limit",children:"Limit"})]}),I==="limit"&&e.jsx("input",{type:"number",value:se,onChange:s=>Y(+s.target.value||n),className:"rounded-xl bg-gray-900 px-3 py-3 text-center text-xl font-bold text-white focus:outline-none focus:ring-2 focus:ring-purple-500 md:px-6 md:py-5 md:text-3xl",placeholder:"Price","aria-label":"Limit Price"}),e.jsx("input",{type:"number",value:P,onChange:s=>A(+s.target.value||0),className:"rounded-xl border-2 border-red-600 bg-red-900/50 px-3 py-3 text-center text-xl font-bold text-white focus:outline-none focus:ring-2 focus:ring-red-500 md:px-6 md:py-5 md:text-3xl",placeholder:"SL","aria-label":"Stop Loss"}),e.jsx("input",{type:"number",value:O,onChange:s=>te(+s.target.value||0),className:"rounded-xl border-2 border-green-600 bg-green-900/50 px-3 py-3 text-center text-xl font-bold text-white focus:outline-none focus:ring-2 focus:ring-green-500 md:px-6 md:py-5 md:text-3xl",placeholder:"Target","aria-label":"Take Profit"}),e.jsx("button",{onClick:()=>V("buy"),disabled:T,className:"flex items-center justify-center gap-2 rounded-2xl bg-green-600 font-black shadow-2xl transition-all hover:bg-green-500 active:scale-95 disabled:cursor-not-allowed disabled:opacity-50 py-4 text-xl md:py-6 md:text-4xl",title:"Buy (Press B)",children:T?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:"PLACING..."})]}):"BUY"}),e.jsx("button",{onClick:()=>V("sell"),disabled:T,className:"flex items-center justify-center gap-2 rounded-2xl bg-red-600 font-black shadow-2xl transition-all hover:bg-red-500 active:scale-95 disabled:cursor-not-allowed disabled:opacity-50 py-4 text-xl md:py-6 md:text-4xl",title:"Sell (Press S)",children:T?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:"PLACING..."})]}):"SELL"})]})})}),e.jsx(tt,{isOpen:F,order:g,onConfirm:re,onCancel:()=>{H(!1),Q(null)},warnings:g&&g.quantity*g.price>1e5?["Large order size - ensure sufficient margin"]:[],errors:g&&g.quantity<=0?["Quantity must be greater than 0"]:[]}),e.jsx(nt,{})]})}export{St as default};
//# sourceMappingURL=mode-trade-BU963YAc.js.map
