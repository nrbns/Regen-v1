{"version":3,"mappings":"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","names":["TabHoverCardComponent","React","tabId","children","ref","isHovered","setIsHovered","useState","preview","setPreview","tab","useTabsStore","s","t","useEffect","jsxs","e","jsx","AnimatePresence","motion","TabHoverCard","PRESET_CONTAINERS","Briefcase","User","EyeOff","ContainerQuickSelector","onSelect","compact","showLabel","containers","activeContainerId","setActiveContainer","useContainerStore","open","setOpen","presetContainers","setPresetContainers","isWebMode","mockPresets","preset","index","existing","ipc","missing","c","updated","presets","found","handleSelect","useCallback","container","active","activeContainer","activePreset","activePresetDef","p","Icon","ChevronDown","Fragment","PresetIcon","isActive","usePeekPreviewStore","create","set","get","current","TabContextMenu","url","containerId","containerName","containerColor","mode","sleeping","onClose","position","setPosition","menuRef","useRef","policy","useProfileStore","state","ghostDisabled","privateDisabled","setContainers","tabGroups","assignTabToGroup","createGroup","openPeek","isSleeping","handleClickOutside","storedPos","list","error","resolveTab","handleAssignGroup","groupId","handleCreateGroup","name","group","handleOpenAsGhost","handleBurnTab","handleStartTimer","minutes","ms","handleDuplicate","targetContainerId","activate","handleMoveToContainer","targetId","result","handlePeek","handleWake","isGhost","isPrivate","menuItems","Eye","Copy","Ghost","Flame","Clock","Sun","item","moveTargets","openTargets","MoonStar","idx","Boxes","Layers","Check","FolderPlus","PredictiveClusterChip","clusters","summary","onApply","setIndex","confidence","PlayCircle","prev","PredictivePrefetchHint","entry","onOpen","hostLabel","Navigation","TabGroupsOverlay","tabs","updateGroup","deleteGroup","toggleGroupCollapsed","setGroupColor","editingGroupId","setEditingGroupId","editingName","setEditingName","draggedTabId","setDraggedTabId","tabsByGroup","useMemo","grouped","handleRenameGroup","handleSaveRename","handleCancelRename","handleDeleteGroup","handleCycleColor","currentIndex","TAB_GROUP_COLORS","nextColor","handleDropTab","ungroupedTabs","Portal","Folder","X","groupTabs","isCollapsed","ChevronRight","Palette","Edit3","Trash2","newGroup","Plus","DropdownMenu","DropdownMenuPrimitive.Root","DropdownMenuTrigger","DropdownMenuPrimitive.Trigger","DropdownMenuSubTrigger","React.forwardRef","className","inset","props","DropdownMenuPrimitive.SubTrigger","cn","DropdownMenuSubContent","DropdownMenuPrimitive.SubContent","DropdownMenuContent","sideOffset","DropdownMenuPrimitive.Portal","DropdownMenuPrimitive.Content","DropdownMenuItem","DropdownMenuPrimitive.Item","DropdownMenuCheckboxItem","checked","DropdownMenuPrimitive.CheckboxItem","DropdownMenuPrimitive.ItemIndicator","DropdownMenuRadioItem","DropdownMenuPrimitive.RadioItem","Circle","DropdownMenuLabel","DropdownMenuPrimitive.Label","DropdownMenuSeparator","DropdownMenuPrimitive.Separator","RESURRECTION_KEY","RESURRECTION_DELAY_MS","MAX_RESURRECTABLE_TABS","saveTabForResurrection","crashReason","loadResurrectableTabs","resurrectable","filtered","raw","parsed","resurrectTab","__vitePreload","n","tabsStore","newId","deleteResurrectableTab","checkForResurrectableTabs","all","now","RESURRECTION_WINDOW_MS","scheduleAutoResurrection","delayMs","toResurrect","err","TAB_GRAPH_DRAG_MIME","IS_DEV","isDevEnv","IS_ELECTRON","isElectronRuntime","NEW_GROUP_DROP_ID","stopEventPropagation","event","safeGet","obj","key","defaultValue","value","safeGetString","safeGetNumber","mapTabsForStore","validTabs","itemId","itemError","TabStrip","useAppError","setAllTabs","setActiveTab","activeId","storeTabs","safeTabs","updateTab","rememberClosedTab","recentlyClosed","togglePinTab","currentMode","useAppStore","setTabs","predictedClusters","setPredictedClusters","prefetchEntries","setPrefetchEntries","predictionSummary","setPredictionSummary","holographicPreviewTabId","setHolographicPreviewTabId","hologramSupported","setHologramSupported","handoffStatus","setHandoffStatus","groupsOverlayOpen","setGroupsOverlayOpen","contextMenu","setContextMenu","hasInitialized","setHasInitialized","isRestoringRef","isCreatingTabRef","previousTabIdsRef","currentActiveIdRef","activationInFlightRef","tabsRef","fetchPredictiveSuggestionsRef","groupDragTarget","setGroupDragTarget","groupMap","map","nextName","trimmed","handleCycleGroupColor","color","handleGroupDrop","draggedTabIdRef","dragOverIndexRef","handleGroupDragOver","handleGroupDragLeave","handleDropToNewGroup","filteredTabs","renderGroupHeader","refreshTabsFromMain","tabList","mappedTabs","storeTab","st","appMode","pinned","ids","activeTab","firstTab","activateTab","currentTabs","ipcEvents","closeTab","tabBeingClosed","wasActive","remaining","nextIndex","tabToClose","tabIndex","remainingTabs","closingLastTab","snapshotTabs","previousActiveId","nextTabIndex","nextTab","resolve","addTab","renderTabNode","groupRingStyle","prefetchForTab","validFilteredTabs","Sparkles","Pin","PinOff","tabElements","elements","renderedGroupIds","stripRef","predictiveRequestRef","lastPredictionSignatureRef","runPredictiveSuggestions","options","signature","requestPromise","response","supported","isMounted","applyTabs","mapped","unsubscribe","ipcReady","waitForIPC","checkIPC","interval","loadTabs","isInitialLoad","tabIds","currentActive","recheckTabs","handleRestoring","restoring","unsubscribeRestoring","handleRestoreTab","tabState","unsubscribeRestoreTab","initTimer","handleTabUpdate","newTabIds","currentTabIds","activeTabIdFromIPC","peekState","updatedPeek","firstTabId","pollInterval","baseTabs","newTab","i","handleReopenClosedTab","reopenClosedTab","handleApplyCluster","clusterId","cluster","matching","etld","label","useTabGraphStore","handlePrefetchOpen","el","activeIdRef","target","handleKeyNavigation","handleModifiedShortcuts","currentActiveId","rect","mouseX","dropIndex","tabRect","relativeX","newIndex","newTabs","movedTab","RotateCcw","hostname","TabStripWrapper"],"ignoreList":[],"sources":["../../src/components/TopNav/TabHoverCard.tsx","../../src/components/containers/ContainerQuickSelector.tsx","../../src/state/peekStore.ts","../../src/components/layout/TabContextMenu.tsx","../../src/components/layout/PredictiveClusterChip.tsx","../../src/components/tabs/TabGroupsOverlay.tsx","../../src/components/ui/dropdown-menu.tsx","../../src/core/tabs/resurrection.ts","../../src/components/layout/TabStrip.tsx"],"sourcesContent":["/**\r\n * TabHoverCard - Preview tab content on hover\r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { useTabsStore } from '../../state/tabsStore';\r\n\r\ninterface TabHoverCardProps {\r\n  tabId: string;\r\n  children: React.ReactElement;\r\n}\r\n\r\nconst TabHoverCardComponent = React.forwardRef<HTMLDivElement, TabHoverCardProps>(\r\n  ({ tabId, children }, ref) => {\r\n    const [isHovered, setIsHovered] = useState(false);\r\n    const [preview, setPreview] = useState<{ title: string; url: string; thumbnail?: string } | null>(null);\r\n    const tabs = useTabsStore(s => s.tabs);\r\n    const tab = tabs.find(t => t.id === tabId);\r\n\r\n    useEffect(() => {\r\n      if (isHovered && tab) {\r\n        // Load preview data\r\n        setPreview({\r\n          title: tab.title || 'New Tab',\r\n          url: tab.url || 'about:blank',\r\n        });\r\n      }\r\n    }, [isHovered, tab]);\r\n\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        onMouseEnter={() => setIsHovered(true)}\r\n        onMouseLeave={() => setIsHovered(false)}\r\n        className=\"relative\"\r\n        style={{ pointerEvents: 'auto' }}\r\n        onClick={(e) => {\r\n          // Don't interfere with child clicks\r\n          if (e.target === e.currentTarget) {\r\n            e.stopPropagation();\r\n          }\r\n        }}\r\n      >\r\n        {children}\r\n        <AnimatePresence>\r\n          {isHovered && preview && (\r\n            <motion.div\r\n              initial={{ opacity: 0, scale: 0.95, y: 10 }}\r\n              animate={{ opacity: 1, scale: 1, y: 0 }}\r\n              exit={{ opacity: 0, scale: 0.95, y: 10 }}\r\n              className=\"absolute bottom-full left-0 mb-2 bg-gray-800 border border-gray-700 rounded-lg shadow-2xl z-[40] w-80 p-4\"\r\n              onMouseEnter={() => setIsHovered(true)}\r\n              onMouseLeave={() => setIsHovered(false)}\r\n              onClick={(e) => e.stopPropagation()}\r\n              onMouseDown={(e) => e.stopPropagation()}\r\n              style={{ pointerEvents: 'auto' }}\r\n            >\r\n              {preview.thumbnail && (\r\n                <img\r\n                  src={preview.thumbnail}\r\n                  alt={preview.title}\r\n                  className=\"w-full h-32 object-cover rounded mb-2\"\r\n                />\r\n              )}\r\n              <div className=\"text-sm font-medium text-gray-200 mb-1 truncate\">\r\n                {preview.title}\r\n              </div>\r\n              <div className=\"text-xs text-gray-400 truncate\">\r\n                {preview.url}\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n      </div>\r\n    );\r\n  }\r\n);\r\n\r\nTabHoverCardComponent.displayName = 'TabHoverCard';\r\n\r\nexport const TabHoverCard = TabHoverCardComponent;\r\n\r\n","/**\n * ContainerQuickSelector - Quick access to Work/Personal/Anonymous containers\n */\n\nimport { useCallback, useEffect, useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Briefcase, User, EyeOff, ChevronDown } from 'lucide-react';\nimport { ipc } from '../../lib/ipc-typed';\nimport { useContainerStore } from '../../state/containerStore';\nimport type { ContainerInfo } from '../../lib/ipc-events';\nimport { isWebMode } from '../../lib/env';\n\ninterface ContainerQuickSelectorProps {\n  onSelect?: (containerId: string) => void;\n  compact?: boolean;\n  showLabel?: boolean;\n}\n\nconst PRESET_CONTAINERS = [\n  {\n    name: 'Work',\n    color: '#3b82f6',\n    icon: Briefcase,\n    description: 'Work-related browsing',\n  },\n  {\n    name: 'Personal',\n    color: '#10b981',\n    icon: User,\n    description: 'Personal browsing',\n  },\n  {\n    name: 'Anonymous',\n    color: '#8b5cf6',\n    icon: EyeOff,\n    description: 'Private browsing',\n  },\n] as const;\n\nexport function ContainerQuickSelector({\n  onSelect,\n  compact = false,\n  showLabel = true,\n}: ContainerQuickSelectorProps) {\n  const { containers, activeContainerId, setActiveContainer } = useContainerStore();\n  const [open, setOpen] = useState(false);\n  const [presetContainers, setPresetContainers] = useState<ContainerInfo[]>([]);\n\n  // Ensure preset containers exist\n  useEffect(() => {\n    const ensurePresets = async () => {\n      // Skip container operations in web mode\n      if (isWebMode()) {\n        // In web mode, use mock preset containers\n        const mockPresets: ContainerInfo[] = PRESET_CONTAINERS.map((preset, index) => ({\n          id: `preset-${index}`,\n          name: preset.name,\n          color: preset.color,\n          scope: 'global' as const,\n        }));\n        setPresetContainers(mockPresets);\n        return;\n      }\n\n      try {\n        const existing = await ipc.containers.list().catch(() => []);\n        // const presetNames = PRESET_CONTAINERS.map(p => p.name.toLowerCase()); // Unused for now\n\n        const missing = PRESET_CONTAINERS.filter(\n          preset => !existing.some(c => c.name.toLowerCase() === preset.name.toLowerCase())\n        );\n\n        if (missing.length > 0) {\n          // Create missing preset containers\n          for (const preset of missing) {\n            try {\n              await ipc.containers.create({\n                name: preset.name,\n                color: preset.color,\n              });\n            } catch {\n              // Suppress errors - containers are optional\n            }\n          }\n        }\n\n        // Reload containers\n        const updated = await ipc.containers.list().catch(() => []);\n        const presets: ContainerInfo[] = [];\n        for (const preset of PRESET_CONTAINERS) {\n          const found = updated.find(c => c.name.toLowerCase() === preset.name.toLowerCase());\n          if (found && found.scope) {\n            presets.push(found as ContainerInfo);\n          }\n        }\n\n        setPresetContainers(presets);\n      } catch {\n        // Suppress errors - use mock containers as fallback\n        const mockPresets: ContainerInfo[] = PRESET_CONTAINERS.map((preset, index) => ({\n          id: `preset-${index}`,\n          name: preset.name,\n          color: preset.color,\n          scope: 'global' as const,\n        }));\n        setPresetContainers(mockPresets);\n      }\n    };\n\n    void ensurePresets();\n  }, []);\n\n  // Update preset containers when containers change\n  useEffect(() => {\n    const presets = PRESET_CONTAINERS.map(preset =>\n      containers.find(c => c.name.toLowerCase() === preset.name.toLowerCase())\n    ).filter((c): c is ContainerInfo => c !== undefined);\n    setPresetContainers(presets);\n  }, [containers]);\n\n  const handleSelect = useCallback(\n    async (container: ContainerInfo) => {\n      // In web mode, just update local state\n      if (isWebMode()) {\n        setActiveContainer(container);\n        onSelect?.(container.id);\n        setOpen(false);\n        return;\n      }\n\n      try {\n        const active = await ipc.containers.setActive(container.id);\n        if (active) {\n          setActiveContainer(active as ContainerInfo);\n        } else {\n          setActiveContainer(container);\n        }\n        onSelect?.(container.id);\n        setOpen(false);\n      } catch {\n        // Suppress errors - just update local state\n        setActiveContainer(container);\n        onSelect?.(container.id);\n        setOpen(false);\n      }\n    },\n    [onSelect, setActiveContainer]\n  );\n\n  const activeContainer = containers.find(c => c.id === activeContainerId);\n  const activePreset = presetContainers.find(c => c.id === activeContainerId);\n  const activePresetDef = activePreset\n    ? PRESET_CONTAINERS.find(p => p.name.toLowerCase() === activePreset.name.toLowerCase())\n    : null;\n\n  const Icon = activePresetDef?.icon || Briefcase;\n\n  if (compact) {\n    return (\n      <div className=\"relative\">\n        <motion.button\n          onClick={() => setOpen(!open)}\n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n          className=\"flex items-center gap-1.5 rounded-lg border border-white/10 bg-white/5 px-2 py-1 transition-colors hover:bg-white/10\"\n          title={activeContainer?.name || 'Select container'}\n        >\n          {activePresetDef && <Icon size={14} className=\"text-muted\" />}\n          {!activePresetDef && activeContainer?.color && (\n            <div\n              className=\"h-3 w-3 rounded-full\"\n              style={{ backgroundColor: activeContainer.color }}\n            />\n          )}\n          {showLabel && activeContainer && (\n            <span className=\"text-muted text-xs\">{activeContainer.name}</span>\n          )}\n          <ChevronDown size={12} className=\"text-muted\" />\n        </motion.button>\n\n        <AnimatePresence>\n          {open && (\n            <>\n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                className=\"fixed inset-0 z-30\"\n                onClick={() => setOpen(false)}\n              />\n              <motion.div\n                initial={{ opacity: 0, y: -8, scale: 0.95 }}\n                animate={{ opacity: 1, y: 0, scale: 1 }}\n                exit={{ opacity: 0, y: -8, scale: 0.95 }}\n                className=\"bg-surface-elevated/95 absolute right-0 top-full z-40 mt-2 w-56 overflow-hidden rounded-xl border border-white/10 shadow-2xl backdrop-blur-xl\"\n              >\n                <div className=\"p-2\">\n                  {presetContainers.map(container => {\n                    const preset = PRESET_CONTAINERS.find(\n                      p => p.name.toLowerCase() === container.name.toLowerCase()\n                    );\n                    const PresetIcon = preset?.icon || Briefcase;\n                    const isActive = container.id === activeContainerId;\n\n                    return (\n                      <motion.button\n                        key={container.id}\n                        onClick={() => handleSelect(container)}\n                        whileHover={{ scale: 1.02 }}\n                        whileTap={{ scale: 0.98 }}\n                        className={`flex w-full items-center gap-3 rounded-lg px-3 py-2 transition-colors ${\n                          isActive\n                            ? 'bg-primary/20 border-primary/40 text-primary border'\n                            : 'text-muted hover:text-primary hover:bg-white/10'\n                        }`}\n                      >\n                        <PresetIcon size={16} />\n                        <div className=\"flex-1 text-left\">\n                          <div className=\"text-sm font-medium\">{container.name}</div>\n                          {preset && (\n                            <div className=\"text-muted/70 text-xs\">{preset.description}</div>\n                          )}\n                        </div>\n                        {isActive && <div className=\"bg-primary h-2 w-2 rounded-full\" />}\n                      </motion.button>\n                    );\n                  })}\n                </div>\n              </motion.div>\n            </>\n          )}\n        </AnimatePresence>\n      </div>\n    );\n  }\n\n  // Full selector with all containers\n  return (\n    <div className=\"flex items-center gap-2\">\n      {presetContainers.map(container => {\n        const preset = PRESET_CONTAINERS.find(\n          p => p.name.toLowerCase() === container.name.toLowerCase()\n        );\n        const PresetIcon = preset?.icon || Briefcase;\n        const isActive = container.id === activeContainerId;\n\n        return (\n          <motion.button\n            key={container.id}\n            onClick={() => handleSelect(container)}\n            whileHover={{ scale: 1.05 }}\n            whileTap={{ scale: 0.95 }}\n            className={`flex items-center gap-2 rounded-lg border px-3 py-1.5 transition-all ${\n              isActive\n                ? 'bg-primary/20 border-primary/40 text-primary shadow-primary/20 shadow-lg'\n                : 'text-muted hover:text-primary border-white/10 bg-white/5 hover:bg-white/10'\n            }`}\n            title={preset?.description || container.name}\n          >\n            <PresetIcon size={16} />\n            {showLabel && <span className=\"text-sm font-medium\">{container.name}</span>}\n          </motion.button>\n        );\n      })}\n    </div>\n  );\n}\n","import { create } from 'zustand';\r\nimport type { Tab } from './tabsStore';\r\n\r\ntype PeekState = {\r\n  visible: boolean;\r\n  tab: Tab | null;\r\n  open: (tab: Tab) => void;\r\n  close: () => void;\r\n  sync: (tab: Tab) => void;\r\n};\r\n\r\nexport const usePeekPreviewStore = create<PeekState>((set, get) => ({\r\n  visible: false,\r\n  tab: null,\r\n  open: (tab) => set({ visible: true, tab }),\r\n  close: () => set({ visible: false, tab: null }),\r\n  sync: (tab) => {\r\n    const current = get().tab;\r\n    if (current?.id === tab.id) {\r\n      set({ tab: { ...current, ...tab } });\r\n    }\r\n  },\r\n}));\r\n\r\n","/**\r\n * TabContextMenu - Right-click menu for tab actions (Ghost, Burn, etc.)\r\n */\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport {\r\n  Ghost,\r\n  Flame,\r\n  Clock,\r\n  Copy,\r\n  Boxes,\r\n  Eye,\r\n  Sun,\r\n  MoonStar,\r\n  Layers,\r\n  FolderPlus,\r\n  Check,\r\n} from 'lucide-react';\r\nimport { ipc } from '../../lib/ipc-typed';\r\nimport { useProfileStore } from '../../state/profileStore';\r\nimport { useContainerStore } from '../../state/containerStore';\r\nimport { ContainerInfo } from '../../lib/ipc-events';\r\nimport { useTabsStore } from '../../state/tabsStore';\r\nimport { usePeekPreviewStore } from '../../state/peekStore';\r\n\r\ninterface TabContextMenuProps {\r\n  tabId: string;\r\n  url: string;\r\n  containerId?: string;\r\n  containerName?: string;\r\n  containerColor?: string;\r\n  mode?: 'normal' | 'ghost' | 'private';\r\n  sleeping?: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nexport function TabContextMenu({\r\n  tabId,\r\n  url,\r\n  containerId,\r\n  containerName,\r\n  containerColor,\r\n  mode,\r\n  sleeping,\r\n  onClose,\r\n}: TabContextMenuProps) {\r\n  const [position, setPosition] = useState({ x: 0, y: 0 });\r\n  const menuRef = useRef<HTMLDivElement>(null);\r\n  const policy = useProfileStore(state => state.policies[state.activeProfileId]);\r\n  const ghostDisabled = policy ? !policy.allowGhostTabs : false;\r\n  const privateDisabled = policy ? !policy.allowPrivateWindows : false;\r\n  const { containers, setContainers } = useContainerStore(state => ({\r\n    containers: state.containers,\r\n    setContainers: state.setContainers,\r\n  }));\r\n  const tab = useTabsStore(state => state.tabs.find(t => t.id === tabId));\r\n  const tabGroups = useTabsStore(state => state.tabGroups);\r\n  const assignTabToGroup = useTabsStore(state => state.assignTabToGroup);\r\n  const createGroup = useTabsStore(state => state.createGroup);\r\n  const openPeek = usePeekPreviewStore(state => state.open);\r\n  const isSleeping = sleeping ?? tab?.sleeping ?? false;\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (e: MouseEvent) => {\r\n      if (menuRef.current && !menuRef.current.contains(e.target as Node)) {\r\n        onClose();\r\n      }\r\n    };\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => document.removeEventListener('mousedown', handleClickOutside);\r\n  }, [onClose]);\r\n\r\n  useEffect(() => {\r\n    const storedPos = (window as any).__lastContextMenuPos || { x: 0, y: 0 };\r\n    setPosition({ x: storedPos.x, y: storedPos.y });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (containers.length === 0) {\r\n      ipc.containers\r\n        .list()\r\n        .then(list => {\r\n          if (Array.isArray(list)) {\r\n            setContainers(list as ContainerInfo[]);\r\n          }\r\n        })\r\n        .catch(error => {\r\n          console.error('Failed to load containers for context menu:', error);\r\n        });\r\n    }\r\n  }, [containers.length, setContainers]);\r\n\r\n  const resolveTab = () => ({\r\n    id: tab?.id ?? tabId,\r\n    title: tab?.title ?? tab?.url ?? url ?? 'New Tab',\r\n    url: tab?.url ?? url ?? 'about:blank',\r\n    containerId: tab?.containerId ?? containerId,\r\n    containerName: tab?.containerName ?? containerName,\r\n    containerColor: tab?.containerColor ?? containerColor,\r\n    mode: tab?.mode ?? mode,\r\n    createdAt: tab?.createdAt,\r\n    lastActiveAt: tab?.lastActiveAt,\r\n    sessionId: tab?.sessionId,\r\n    profileId: tab?.profileId,\r\n    sleeping: tab?.sleeping ?? sleeping ?? false,\r\n  });\r\n\r\n  const handleAssignGroup = (groupId: string | null) => {\r\n    assignTabToGroup(tabId, groupId);\r\n    onClose();\r\n  };\r\n\r\n  const handleCreateGroup = () => {\r\n    const name = window.prompt('New group name', `Group ${tabGroups.length + 1}`)?.trim();\r\n    const group = createGroup({ name: name || undefined });\r\n    assignTabToGroup(tabId, group.id);\r\n    onClose();\r\n  };\r\n\r\n  const handleOpenAsGhost = async () => {\r\n    if (ghostDisabled) return;\r\n    try {\r\n      await ipc.private.createGhostTab({ url });\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Failed to open as ghost:', error);\r\n    }\r\n  };\r\n\r\n  const handleBurnTab = async () => {\r\n    try {\r\n      if (confirm('Burn this tab? All data will be permanently deleted.')) {\r\n        await ipc.tabs.burn(tabId);\r\n        onClose();\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to burn tab:', error);\r\n    }\r\n  };\r\n\r\n  const handleStartTimer = async () => {\r\n    if (privateDisabled) return;\r\n    const minutes = prompt('Auto-close after (minutes):', '10');\r\n    if (minutes) {\r\n      try {\r\n        const ms = parseInt(minutes) * 60 * 1000;\r\n        await ipc.private.createWindow({ url, autoCloseAfter: ms });\r\n        onClose();\r\n      } catch (error) {\r\n        console.error('Failed to start timer:', error);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleDuplicate = async (targetContainerId?: string, activate = true) => {\r\n    try {\r\n      await ipc.tabs.create({\r\n        url: url || 'about:blank',\r\n        containerId: targetContainerId ?? containerId,\r\n        activate,\r\n      });\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Failed to duplicate tab:', error);\r\n    }\r\n  };\r\n\r\n  const handleMoveToContainer = async (targetId: string) => {\r\n    if (!targetId || targetId === containerId) {\r\n      onClose();\r\n      return;\r\n    }\r\n    try {\r\n      const result = await ipc.tabs.setContainer(tabId, targetId);\r\n      if (!result?.success) {\r\n        console.warn('Failed to switch container:', result?.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to switch tab container:', error);\r\n    } finally {\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  const handlePeek = () => {\r\n    openPeek(resolveTab());\r\n    onClose();\r\n  };\r\n\r\n  const handleWake = async () => {\r\n    try {\r\n      await ipc.tabs.wake(tabId);\r\n      onClose();\r\n    } catch (error) {\r\n      console.error('Failed to wake tab:', error);\r\n    }\r\n  };\r\n\r\n  const isGhost = mode === 'ghost';\r\n  const isPrivate = mode === 'private';\r\n\r\n  const menuItems = [\r\n    { icon: Eye, label: 'Peek preview', action: handlePeek },\r\n    {\r\n      icon: Copy,\r\n      label: 'Duplicate Tab',\r\n      action: () => handleDuplicate(containerId, true),\r\n      disabled: isGhost || isPrivate,\r\n    },\r\n    {\r\n      icon: Ghost,\r\n      label: 'Open as Ghost',\r\n      action: handleOpenAsGhost,\r\n      hide: isGhost,\r\n      disabled: ghostDisabled,\r\n      disabledReason: 'Disabled by profile policy',\r\n    },\r\n    { icon: Flame, label: 'Burn Tab', action: handleBurnTab, danger: true },\r\n    {\r\n      icon: Clock,\r\n      label: 'Start 10-min Timer',\r\n      action: handleStartTimer,\r\n      disabled: privateDisabled,\r\n      disabledReason: 'Disabled by profile policy',\r\n    },\r\n    {\r\n      icon: Sun,\r\n      label: 'Wake tab',\r\n      action: handleWake,\r\n      hide: !isSleeping,\r\n    },\r\n  ].filter(item => !item.hide);\r\n\r\n  const moveTargets =\r\n    !isGhost && !isPrivate ? containers.filter((c: ContainerInfo) => c.id !== containerId) : [];\r\n\r\n  const openTargets = containers.filter((c: ContainerInfo) => c.id !== containerId);\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      <motion.div\r\n        ref={menuRef}\r\n        initial={{ opacity: 0, scale: 0.95 }}\r\n        animate={{ opacity: 1, scale: 1 }}\r\n        exit={{ opacity: 0, scale: 0.95 }}\r\n        transition={{ duration: 0.15 }}\r\n        className=\"fixed z-50 bg-surface-elevated text-foreground border border-subtle rounded-lg shadow-elevated py-1 min-w-[200px]\"\r\n        style={{\r\n          left: `${position.x}px`,\r\n          top: `${position.y}px`,\r\n        }}\r\n      >\r\n        {isSleeping && (\r\n          <div className=\"px-3 py-2 text-xs text-amber-500 bg-amber-500/10 border-b border-subtle flex items-center gap-2\">\r\n            <MoonStar size={14} />\r\n            <span>Tab is hibernating</span>\r\n          </div>\r\n        )}\r\n\r\n        {(containerId || containerName) && (\r\n          <div className=\"px-3 py-2 text-xs text-muted border-b border-subtle flex items-center gap-2\">\r\n            <div\r\n              className=\"w-2.5 h-2.5 rounded-full border border-gray-500/30\"\r\n              style={{ backgroundColor: containerColor || '#6366f1' }}\r\n            />\r\n            <span>\r\n              {containerName || (containerId === 'default' ? 'Default container' : containerId)}\r\n            </span>\r\n          </div>\r\n        )}\r\n\r\n        {menuItems.map((item, idx) => {\r\n          const Icon = item.icon;\r\n          return (\r\n            <motion.button\r\n              key={idx}\r\n              whileHover={item.disabled ? undefined : { scale: 1.01 }}\r\n              onClick={item.action}\r\n              className={`w-full flex items-center gap-2 px-3 py-2 text-sm transition-colors ${\r\n                item.danger\r\n                  ? 'text-red-500 hover:bg-red-500/10'\r\n                  : item.disabled\r\n                    ? 'text-muted cursor-not-allowed'\r\n                    : 'text-foreground hover:bg-[color:var(--surface-muted)]/45'\r\n              }`}\r\n              disabled={item.disabled}\r\n              title={\r\n                item.disabled ? item.disabledReason || 'Disabled by profile policy' : undefined\r\n              }\r\n            >\r\n              <Icon size={16} />\r\n              <span>{item.label}</span>\r\n            </motion.button>\r\n          );\r\n        })}\r\n\r\n        {openTargets.length > 0 && (\r\n          <div className=\"mt-1 border-t border-subtle pt-1.5\">\r\n            <div className=\"px-3 py-1 text-[11px] uppercase tracking-wide text-muted flex items-center gap-2\">\r\n              <Boxes size={12} />\r\n              Open copy in container\r\n            </div>\r\n            <div className=\"flex flex-col\">\r\n              {openTargets.map(container => (\r\n                <motion.button\r\n                  key={`open-${container.id}`}\r\n                  whileHover={{ scale: 1.01 }}\r\n                  onClick={() => handleDuplicate(container.id, true)}\r\n                  className=\"w-full flex items-center gap-2 px-3 py-1.5 text-sm text-foreground hover:bg-[color:var(--surface-muted)]/45 transition-colors\"\r\n                >\r\n                  <span\r\n                    className=\"w-2.5 h-2.5 rounded-full border border-gray-500/30\"\r\n                    style={{ backgroundColor: container.color || '#6366f1' }}\r\n                  />\r\n                  <span className=\"truncate\">{container.name}</span>\r\n                </motion.button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {moveTargets.length > 0 && (\r\n          <div className=\"mt-1 border-t border-subtle pt-1.5\">\r\n            <div className=\"px-3 py-1 text-[11px] uppercase tracking-wide text-muted flex items-center gap-2\">\r\n              <Boxes size={12} />\r\n              Move to container\r\n            </div>\r\n            <div className=\"flex flex-col\">\r\n              {moveTargets.map(container => (\r\n                <motion.button\r\n                  key={container.id}\r\n                  whileHover={{ scale: 1.01 }}\r\n                  onClick={() => handleMoveToContainer(container.id)}\r\n                  className=\"w-full flex items-center gap-2 px-3 py-1.5 text-sm text-foreground hover:bg-[color:var(--surface-muted)]/45 transition-colors\"\r\n                >\r\n                  <span\r\n                    className=\"w-2.5 h-2.5 rounded-full border border-gray-500/30\"\r\n                    style={{ backgroundColor: container.color || '#6366f1' }}\r\n                  />\r\n                  <span className=\"truncate\">{container.name}</span>\r\n                </motion.button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n        {tabGroups.length > 0 && (\r\n          <div className=\"mt-1 border-t border-subtle pt-1.5\">\r\n            <div className=\"px-3 py-1 text-[11px] uppercase tracking-wide text-muted flex items-center gap-2\">\r\n              <Layers size={12} />\r\n              Tab group\r\n            </div>\r\n            <div className=\"flex flex-col\">\r\n              {tabGroups.map(group => (\r\n                <motion.button\r\n                  key={group.id}\r\n                  whileHover={{ scale: 1.01 }}\r\n                  onClick={() => handleAssignGroup(group.id)}\r\n                  className=\"w-full flex items-center gap-2 px-3 py-1.5 text-sm text-foreground hover:bg-[color:var(--surface-muted)]/45 transition-colors\"\r\n                >\r\n                  <span\r\n                    className=\"w-2.5 h-2.5 rounded-full border border-gray-500/30\"\r\n                    style={{ backgroundColor: group.color }}\r\n                  />\r\n                  <span className=\"truncate flex-1\">{group.name}</span>\r\n                  {tab?.groupId === group.id && <Check size={12} className=\"text-emerald-400\" />}\r\n                </motion.button>\r\n              ))}\r\n              {tab?.groupId && (\r\n                <motion.button\r\n                  whileHover={{ scale: 1.01 }}\r\n                  onClick={() => handleAssignGroup(null)}\r\n                  className=\"w-full flex items-center gap-2 px-3 py-1.5 text-sm text-foreground hover:bg-[color:var(--surface-muted)]/45 transition-colors\"\r\n                >\r\n                  Remove from group\r\n                </motion.button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n        <motion.button\r\n          whileHover={{ scale: 1.01 }}\r\n          onClick={handleCreateGroup}\r\n          className=\"w-full flex items-center gap-2 px-3 py-1.5 text-sm text-foreground hover:bg-[color:var(--surface-muted)]/45 transition-colors border-t border-subtle mt-1\"\r\n        >\r\n          <FolderPlus size={14} />\r\n          New group\r\n        </motion.button>\r\n      </motion.div>\r\n    </AnimatePresence>\r\n  );\r\n}\r\n","import { useState, useEffect } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { PlayCircle, Navigation } from 'lucide-react';\r\n\r\ntype Cluster = { id: string; label: string; tabIds: string[]; confidence?: number };\r\n\r\ntype PrefetchEntry = { tabId: string; url: string; reason: string; confidence?: number };\r\n\r\ninterface PredictiveClusterChipProps {\r\n  clusters: Cluster[];\r\n  summary?: string | null;\r\n  onApply: (clusterId: string) => void;\r\n}\r\n\r\nexport function PredictiveClusterChip({ clusters, summary, onApply }: PredictiveClusterChipProps) {\r\n  const [index, setIndex] = useState(0);\r\n\r\n  useEffect(() => {\r\n    if (!clusters.length) {\r\n      setIndex(0);\r\n    } else if (index >= clusters.length) {\r\n      setIndex(0);\r\n    }\r\n  }, [clusters, index]);\r\n\r\n  if (!clusters.length) return null;\r\n\r\n  const current = clusters[index];\r\n  const confidence = typeof current.confidence === 'number' ? Math.round(current.confidence * 100) : null;\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, x: -10 }}\r\n      animate={{ opacity: 1, x: 0 }}\r\n      exit={{ opacity: 0, x: -10 }}\r\n      className=\"no-drag flex items-center gap-2 mr-3\"\r\n    >\r\n      <button\r\n        type=\"button\"\r\n        onClick={() => onApply(current.id)}\r\n        className=\"flex items-center gap-1.5 rounded-full border border-blue-500/40 bg-blue-500/15 px-3 py-1.5 text-xs text-blue-100 transition-colors hover:bg-blue-500/25\"\r\n        title={summary ?? 'Redix suggests regrouping these tabs into a focused workspace.'}\r\n      >\r\n        <PlayCircle size={12} />\r\n        <span className=\"font-semibold\">Regroup {current.label}</span>\r\n        {confidence !== null && <span className=\"text-[11px] text-blue-200/80\">{confidence}%</span>}\r\n      </button>\r\n      {clusters.length > 1 && (\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => setIndex((prev) => (prev + 1) % clusters.length)}\r\n          className=\"rounded-full border border-slate-700/60 p-1.5 text-[10px] text-slate-300 transition-colors hover:text-slate-100\"\r\n          aria-label=\"Next suggested cluster\"\r\n        >\r\n          \r\n        </button>\r\n      )}\r\n    </motion.div>\r\n  );\r\n}\r\n\r\ninterface PredictivePrefetchHintProps {\r\n  entry: PrefetchEntry | null;\r\n  onOpen: (entry: PrefetchEntry) => void;\r\n}\r\n\r\nexport function PredictivePrefetchHint({ entry, onOpen }: PredictivePrefetchHintProps) {\r\n  if (!entry) return null;\r\n\r\n  let hostLabel = entry.url;\r\n  try {\r\n    hostLabel = new URL(entry.url).hostname.replace(/^www\\./, '');\r\n  } catch {\r\n    // keep original url\r\n  }\r\n\r\n  const confidence = typeof entry.confidence === 'number' ? Math.round(entry.confidence * 100) : null;\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, x: -10 }}\r\n      animate={{ opacity: 1, x: 0 }}\r\n      exit={{ opacity: 0, x: -10 }}\r\n      className=\"no-drag flex items-center gap-2 mr-3\"\r\n    >\r\n      <button\r\n        type=\"button\"\r\n        onClick={() => onOpen(entry)}\r\n        className=\"flex items-center gap-1.5 rounded-full border border-emerald-500/40 bg-emerald-500/15 px-3 py-1.5 text-xs text-emerald-100 transition-colors hover:bg-emerald-500/25\"\r\n        title={entry.reason}\r\n      >\r\n        <Navigation size={12} />\r\n        <span className=\"font-semibold\">Scout {hostLabel}</span>\r\n        {confidence !== null && <span className=\"text-[11px] text-emerald-200/80\">{confidence}%</span>}\r\n      </button>\r\n    </motion.div>\r\n  );\r\n}\r\n","/**\r\n * Tab Groups Overlay - Chrome-like interface for managing tab groups\r\n */\r\n\r\nimport React, { useState, useCallback, useMemo } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport {\r\n  X,\r\n  FolderPlus,\r\n  Edit3,\r\n  Trash2,\r\n  Palette,\r\n  ChevronDown,\r\n  ChevronRight,\r\n  Plus,\r\n  Folder,\r\n} from 'lucide-react';\r\nimport { useTabsStore, TAB_GROUP_COLORS, type TabGroup } from '../../state/tabsStore';\r\nimport { Portal } from '../common/Portal';\r\n\r\ninterface TabGroupsOverlayProps {\r\n  open: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nexport function TabGroupsOverlay({ open, onClose }: TabGroupsOverlayProps) {\r\n  const {\r\n    tabs,\r\n    tabGroups,\r\n    createGroup,\r\n    updateGroup,\r\n    deleteGroup,\r\n    assignTabToGroup,\r\n    toggleGroupCollapsed,\r\n    setGroupColor,\r\n  } = useTabsStore();\r\n\r\n  const [editingGroupId, setEditingGroupId] = useState<string | null>(null);\r\n  const [editingName, setEditingName] = useState('');\r\n  const [draggedTabId, setDraggedTabId] = useState<string | null>(null);\r\n\r\n  // Group tabs by groupId\r\n  const tabsByGroup = useMemo(() => {\r\n    const grouped = new Map<string | undefined, typeof tabs>();\r\n    tabs.forEach(tab => {\r\n      const groupId = tab.groupId || 'ungrouped';\r\n      if (!grouped.has(groupId)) {\r\n        grouped.set(groupId, []);\r\n      }\r\n      grouped.get(groupId)!.push(tab);\r\n    });\r\n    return grouped;\r\n  }, [tabs]);\r\n\r\n  const handleCreateGroup = useCallback(() => {\r\n    const group = createGroup({ name: `Group ${tabGroups.length + 1}` });\r\n    setEditingGroupId(group.id);\r\n    setEditingName(group.name);\r\n  }, [createGroup, tabGroups.length]);\r\n\r\n  const handleRenameGroup = useCallback(\r\n    (group: TabGroup) => {\r\n      setEditingGroupId(group.id);\r\n      setEditingName(group.name);\r\n    },\r\n    []\r\n  );\r\n\r\n  const handleSaveRename = useCallback(\r\n    (groupId: string) => {\r\n      if (editingName.trim()) {\r\n        updateGroup(groupId, { name: editingName.trim() });\r\n      }\r\n      setEditingGroupId(null);\r\n      setEditingName('');\r\n    },\r\n    [editingName, updateGroup]\r\n  );\r\n\r\n  const handleCancelRename = useCallback(() => {\r\n    setEditingGroupId(null);\r\n    setEditingName('');\r\n  }, []);\r\n\r\n  const handleDeleteGroup = useCallback(\r\n    (groupId: string) => {\r\n      if (window.confirm('Delete this group? Tabs will be ungrouped but not closed.')) {\r\n        deleteGroup(groupId);\r\n      }\r\n    },\r\n    [deleteGroup]\r\n  );\r\n\r\n  const handleCycleColor = useCallback(\r\n    (group: TabGroup) => {\r\n      const currentIndex = TAB_GROUP_COLORS.findIndex(c => c === group.color);\r\n      const nextColor = TAB_GROUP_COLORS[(currentIndex + 1) % TAB_GROUP_COLORS.length];\r\n      setGroupColor(group.id, nextColor);\r\n    },\r\n    [setGroupColor]\r\n  );\r\n\r\n  const handleDropTab = useCallback(\r\n    (groupId: string | null) => {\r\n      if (draggedTabId) {\r\n        assignTabToGroup(draggedTabId, groupId || null);\r\n        setDraggedTabId(null);\r\n      }\r\n    },\r\n    [draggedTabId, assignTabToGroup]\r\n  );\r\n\r\n  const ungroupedTabs = tabsByGroup.get('ungrouped') || [];\r\n\r\n  if (!open) return null;\r\n\r\n  return (\r\n    <Portal>\r\n      <AnimatePresence>\r\n        <motion.div\r\n          initial={{ opacity: 0 }}\r\n          animate={{ opacity: 1 }}\r\n          exit={{ opacity: 0 }}\r\n          className=\"fixed inset-0 z-[10000] bg-black/60 backdrop-blur-sm\"\r\n          onClick={onClose}\r\n        >\r\n          <motion.div\r\n            initial={{ scale: 0.95, opacity: 0, y: 20 }}\r\n            animate={{ scale: 1, opacity: 1, y: 0 }}\r\n            exit={{ scale: 0.95, opacity: 0, y: 20 }}\r\n            transition={{ type: 'spring', damping: 25, stiffness: 300 }}\r\n            className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-4xl max-h-[80vh] bg-gray-900 rounded-2xl shadow-2xl border border-gray-700 overflow-hidden\"\r\n            onClick={e => e.stopPropagation()}\r\n          >\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between px-6 py-4 border-b border-gray-700 bg-gray-800/50\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <Folder className=\"w-5 h-5 text-purple-400\" />\r\n                <h2 className=\"text-xl font-semibold text-white\">Tab Groups</h2>\r\n                <span className=\"text-sm text-gray-400\">\r\n                  {tabGroups.length} group{tabGroups.length !== 1 ? 's' : ''}\r\n                </span>\r\n              </div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <button\r\n                  onClick={handleCreateGroup}\r\n                  className=\"flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors\"\r\n                >\r\n                  <FolderPlus size={16} />\r\n                  New Group\r\n                </button>\r\n                <button\r\n                  onClick={onClose}\r\n                  className=\"p-2 hover:bg-gray-700 rounded-lg transition-colors text-gray-400 hover:text-white\"\r\n                >\r\n                  <X size={20} />\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Content */}\r\n            <div className=\"overflow-y-auto max-h-[calc(80vh-80px)] p-6\">\r\n              {tabGroups.length === 0 && ungroupedTabs.length === 0 ? (\r\n                <div className=\"flex flex-col items-center justify-center py-16 text-center\">\r\n                  <Folder className=\"w-16 h-16 text-gray-600 mb-4\" />\r\n                  <h3 className=\"text-lg font-semibold text-gray-300 mb-2\">No tabs or groups</h3>\r\n                  <p className=\"text-sm text-gray-500 mb-6\">\r\n                    Create a group to organize your tabs\r\n                  </p>\r\n                  <button\r\n                    onClick={handleCreateGroup}\r\n                    className=\"px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors\"\r\n                  >\r\n                    Create Your First Group\r\n                  </button>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-4\">\r\n                  {/* Groups */}\r\n                  {tabGroups.map(group => {\r\n                    const groupTabs = tabsByGroup.get(group.id) || [];\r\n                    const isCollapsed = group.collapsed;\r\n\r\n                    return (\r\n                      <motion.div\r\n                        key={group.id}\r\n                        layout\r\n                        className=\"bg-gray-800/50 rounded-xl border border-gray-700 overflow-hidden\"\r\n                        onDragOver={e => {\r\n                          if (draggedTabId) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                          }\r\n                        }}\r\n                        onDrop={e => {\r\n                          e.preventDefault();\r\n                          e.stopPropagation();\r\n                          handleDropTab(group.id);\r\n                        }}\r\n                      >\r\n                        {/* Group Header */}\r\n                        <div\r\n                          className=\"flex items-center gap-3 px-4 py-3 bg-gray-800/70 border-b border-gray-700\"\r\n                          style={{\r\n                            borderLeft: `4px solid ${group.color}`,\r\n                          }}\r\n                        >\r\n                          <button\r\n                            onClick={() => toggleGroupCollapsed(group.id)}\r\n                            className=\"p-1 hover:bg-gray-700 rounded transition-colors text-gray-400 hover:text-white\"\r\n                          >\r\n                            {isCollapsed ? (\r\n                              <ChevronRight size={16} />\r\n                            ) : (\r\n                              <ChevronDown size={16} />\r\n                            )}\r\n                          </button>\r\n\r\n                          <div\r\n                            className=\"w-4 h-4 rounded-full border border-white/20 flex-shrink-0\"\r\n                            style={{ backgroundColor: group.color }}\r\n                          />\r\n\r\n                          {editingGroupId === group.id ? (\r\n                            <input\r\n                              type=\"text\"\r\n                              value={editingName}\r\n                              onChange={e => setEditingName(e.target.value)}\r\n                              onBlur={() => handleSaveRename(group.id)}\r\n                              onKeyDown={e => {\r\n                                if (e.key === 'Enter') {\r\n                                  handleSaveRename(group.id);\r\n                                } else if (e.key === 'Escape') {\r\n                                  handleCancelRename();\r\n                                }\r\n                              }}\r\n                              className=\"flex-1 bg-gray-700 text-white px-2 py-1 rounded text-sm focus:outline-none focus:ring-2 focus:ring-purple-500\"\r\n                              autoFocus\r\n                            />\r\n                          ) : (\r\n                            <button\r\n                              onClick={() => handleRenameGroup(group)}\r\n                              className=\"flex-1 text-left text-sm font-semibold text-white hover:text-purple-400 transition-colors\"\r\n                            >\r\n                              {group.name}\r\n                            </button>\r\n                          )}\r\n\r\n                          <span className=\"text-xs text-gray-400\">\r\n                            {groupTabs.length} tab{groupTabs.length !== 1 ? 's' : ''}\r\n                          </span>\r\n\r\n                          <div className=\"flex items-center gap-1\">\r\n                            <button\r\n                              onClick={() => handleCycleColor(group)}\r\n                              className=\"p-1.5 hover:bg-gray-700 rounded transition-colors text-gray-400 hover:text-white\"\r\n                              title=\"Change color\"\r\n                            >\r\n                              <Palette size={14} />\r\n                            </button>\r\n                            <button\r\n                              onClick={() => handleRenameGroup(group)}\r\n                              className=\"p-1.5 hover:bg-gray-700 rounded transition-colors text-gray-400 hover:text-white\"\r\n                              title=\"Rename\"\r\n                            >\r\n                              <Edit3 size={14} />\r\n                            </button>\r\n                            <button\r\n                              onClick={() => handleDeleteGroup(group.id)}\r\n                              className=\"p-1.5 hover:bg-red-500/20 rounded transition-colors text-gray-400 hover:text-red-400\"\r\n                              title=\"Delete group\"\r\n                            >\r\n                              <Trash2 size={14} />\r\n                            </button>\r\n                          </div>\r\n                        </div>\r\n\r\n                        {/* Group Tabs */}\r\n                        {!isCollapsed && (\r\n                          <AnimatePresence>\r\n                            <div className=\"p-3 space-y-2\">\r\n                              {groupTabs.length === 0 ? (\r\n                                <div className=\"text-center py-8 text-gray-500 text-sm\">\r\n                                  <p>No tabs in this group</p>\r\n                                  <p className=\"text-xs mt-1\">Drag tabs here to add them</p>\r\n                                </div>\r\n                              ) : (\r\n                                groupTabs.map(tab => (\r\n                                  <motion.div\r\n                                    key={tab.id}\r\n                                    layout\r\n                                    draggable\r\n                                    onDragStart={() => setDraggedTabId(tab.id)}\r\n                                    onDragEnd={() => setDraggedTabId(null)}\r\n                                    className=\"flex items-center gap-3 px-3 py-2 bg-gray-700/50 hover:bg-gray-700 rounded-lg transition-colors cursor-move\"\r\n                                  >\r\n                                    <div className=\"w-2 h-2 rounded-full flex-shrink-0\" style={{ backgroundColor: group.color }} />\r\n                                    <div className=\"flex-1 min-w-0\">\r\n                                      <p className=\"text-sm text-white truncate\">{tab.title || 'Untitled'}</p>\r\n                                      <p className=\"text-xs text-gray-400 truncate\">{tab.url || 'about:blank'}</p>\r\n                                    </div>\r\n                                    <button\r\n                                      onClick={() => assignTabToGroup(tab.id, null)}\r\n                                      className=\"p-1 hover:bg-gray-600 rounded transition-colors text-gray-400 hover:text-white\"\r\n                                      title=\"Remove from group\"\r\n                                    >\r\n                                      <X size={14} />\r\n                                    </button>\r\n                                  </motion.div>\r\n                                ))\r\n                              )}\r\n                            </div>\r\n                          </AnimatePresence>\r\n                        )}\r\n                      </motion.div>\r\n                    );\r\n                  })}\r\n\r\n                  {/* Ungrouped Tabs */}\r\n                  {ungroupedTabs.length > 0 && (\r\n                    <motion.div\r\n                      layout\r\n                      className=\"bg-gray-800/50 rounded-xl border border-gray-700 overflow-hidden\"\r\n                      onDragOver={e => {\r\n                        if (draggedTabId) {\r\n                          e.preventDefault();\r\n                          e.stopPropagation();\r\n                        }\r\n                      }}\r\n                      onDrop={e => {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        handleDropTab(null);\r\n                      }}\r\n                    >\r\n                      <div className=\"flex items-center gap-3 px-4 py-3 bg-gray-800/70 border-b border-gray-700\">\r\n                        <Folder className=\"w-4 h-4 text-gray-400\" />\r\n                        <h3 className=\"text-sm font-semibold text-gray-300\">\r\n                          Ungrouped Tabs\r\n                        </h3>\r\n                        <span className=\"text-xs text-gray-500\">\r\n                          {ungroupedTabs.length} tab{ungroupedTabs.length !== 1 ? 's' : ''}\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"p-3 space-y-2\">\r\n                        {ungroupedTabs.map(tab => (\r\n                          <motion.div\r\n                            key={tab.id}\r\n                            layout\r\n                            draggable\r\n                            onDragStart={() => setDraggedTabId(tab.id)}\r\n                            onDragEnd={() => setDraggedTabId(null)}\r\n                            className=\"flex items-center gap-3 px-3 py-2 bg-gray-700/50 hover:bg-gray-700 rounded-lg transition-colors cursor-move\"\r\n                          >\r\n                            <div className=\"flex-1 min-w-0\">\r\n                              <p className=\"text-sm text-white truncate\">{tab.title || 'Untitled'}</p>\r\n                              <p className=\"text-xs text-gray-400 truncate\">{tab.url || 'about:blank'}</p>\r\n                            </div>\r\n                            <button\r\n                              onClick={() => {\r\n                                if (tabGroups.length > 0) {\r\n                                  assignTabToGroup(tab.id, tabGroups[0].id);\r\n                                } else {\r\n                                  const newGroup = createGroup({});\r\n                                  assignTabToGroup(tab.id, newGroup.id);\r\n                                }\r\n                              }}\r\n                              className=\"p-1 hover:bg-gray-600 rounded transition-colors text-gray-400 hover:text-purple-400\"\r\n                              title=\"Add to group\"\r\n                            >\r\n                              <Plus size={14} />\r\n                            </button>\r\n                          </motion.div>\r\n                        ))}\r\n                      </div>\r\n                    </motion.div>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </motion.div>\r\n        </motion.div>\r\n      </AnimatePresence>\r\n    </Portal>\r\n  );\r\n}\r\n\r\n","import * as React from 'react';\nimport * as DropdownMenuPrimitive from '@radix-ui/react-dropdown-menu';\nimport { Check, ChevronRight, Circle } from 'lucide-react';\nimport { cn } from '../../lib/utils';\n\nconst DropdownMenu = DropdownMenuPrimitive.Root;\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger;\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group;\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal;\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub;\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup;\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean;\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      'flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-slate-800/60 data-[state=open]:bg-slate-800/60',\n      inset && 'pl-8',\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </DropdownMenuPrimitive.SubTrigger>\n));\nDropdownMenuSubTrigger.displayName = DropdownMenuPrimitive.SubTrigger.displayName;\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      'z-50 min-w-[8rem] overflow-hidden rounded-md border border-slate-800/70 bg-slate-950/90 p-1 text-sm shadow-lg backdrop-blur-xl',\n      className\n    )}\n    {...props}\n  />\n));\nDropdownMenuSubContent.displayName = DropdownMenuPrimitive.SubContent.displayName;\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 8, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        'z-50 min-w-[10rem] overflow-hidden rounded-xl border border-white/8 bg-slate-950/95 p-1 text-sm shadow-xl backdrop-blur-xl',\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n));\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName;\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean;\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      'relative flex cursor-default select-none items-center rounded-md px-2 py-1.5 text-sm outline-none transition-colors focus:bg-slate-800/60 focus:text-slate-50 data-[disabled]:pointer-events-none data-[disabled]:opacity-50',\n      inset && 'pl-8',\n      className\n    )}\n    {...props}\n  />\n));\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName;\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      'relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-slate-800/60 focus:text-slate-50 data-[disabled]:pointer-events-none data-[disabled]:opacity-50',\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n));\nDropdownMenuCheckboxItem.displayName = DropdownMenuPrimitive.CheckboxItem.displayName;\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      'relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-slate-800/60 focus:text-slate-50 data-[disabled]:pointer-events-none data-[disabled]:opacity-50',\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n));\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName;\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean;\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      'px-2 py-1.5 text-xs font-semibold uppercase tracking-[0.2em] text-slate-400',\n      inset && 'pl-8',\n      className\n    )}\n    {...props}\n  />\n));\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName;\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn('-mx-1 my-1 h-px bg-slate-800/60', className)}\n    {...props}\n  />\n));\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName;\n\nconst DropdownMenuShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span className={cn('ml-auto text-xs tracking-widest text-slate-500', className)} {...props} />\n  );\n};\nDropdownMenuShortcut.displayName = 'DropdownMenuShortcut';\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n  DropdownMenuRadioItem,\n};\n","/**\n * Tab Resurrection System\n * Auto-saves tabs before crash and restores them on restart\n */\n\nimport { useTabsStore, type Tab } from '../../state/tabsStore';\n\nexport interface ResurrectableTab {\n  id: string;\n  title: string;\n  url?: string;\n  appMode?: Tab['appMode'];\n  mode?: Tab['mode'];\n  containerId?: string;\n  containerName?: string;\n  containerColor?: string;\n  groupId?: string;\n  history?: Tab['history'];\n  historyIndex?: number;\n  savedAt: number;\n  crashReason?: string;\n}\n\nconst RESURRECTION_KEY = 'regen:tabs:resurrection';\nexport const RESURRECTION_DELAY_MS = 300000; // Auto-resurrect after 5 minutes (300000ms)\nconst MAX_RESURRECTABLE_TABS = 20;\n\n/**\n * Save tab for resurrection\n */\nexport function saveTabForResurrection(tab: Tab, crashReason?: string): void {\n  try {\n    const existing = loadResurrectableTabs();\n    const resurrectable: ResurrectableTab = {\n      id: tab.id,\n      title: tab.title,\n      url: tab.url,\n      appMode: tab.appMode,\n      mode: tab.mode,\n      containerId: tab.containerId,\n      containerName: tab.containerName,\n      containerColor: tab.containerColor,\n      groupId: tab.groupId,\n      history: tab.history,\n      historyIndex: tab.historyIndex,\n      savedAt: Date.now(),\n      crashReason,\n    };\n\n    // Remove if already exists and add to front\n    const filtered = existing.filter(t => t.id !== tab.id);\n    const updated = [resurrectable, ...filtered].slice(0, MAX_RESURRECTABLE_TABS);\n\n    localStorage.setItem(RESURRECTION_KEY, JSON.stringify(updated));\n  } catch (error) {\n    console.warn('[TabResurrection] Failed to save tab:', error);\n  }\n}\n\n/**\n * Load all resurrectable tabs\n */\nexport function loadResurrectableTabs(): ResurrectableTab[] {\n  try {\n    const raw = localStorage.getItem(RESURRECTION_KEY);\n    if (!raw) return [];\n    const parsed = JSON.parse(raw);\n    return Array.isArray(parsed) ? parsed : [];\n  } catch (error) {\n    console.warn('[TabResurrection] Failed to load resurrectable tabs:', error);\n    return [];\n  }\n}\n\n/**\n * Resurrect a tab\n */\nexport async function resurrectTab(resurrectable: ResurrectableTab): Promise<boolean> {\n  try {\n    const { ipc } = await import('../../lib/ipc-typed');\n    const tabsStore = useTabsStore.getState();\n\n    // Create the tab\n    const result = await ipc.tabs.create({\n      url: resurrectable.url || 'about:blank',\n      containerId: resurrectable.containerId || undefined,\n    });\n\n    const newId =\n      typeof result === 'object' && result && 'id' in result ? String(result.id) : String(result);\n\n    // Update tab with saved data\n    setTimeout(() => {\n      tabsStore.updateTab(newId, {\n        appMode: resurrectable.appMode,\n        containerId: resurrectable.containerId,\n        containerName: resurrectable.containerName,\n        containerColor: resurrectable.containerColor,\n        mode: resurrectable.mode,\n        title: resurrectable.title,\n        url: resurrectable.url,\n        history: resurrectable.history,\n        historyIndex: resurrectable.historyIndex,\n      });\n      tabsStore.setActive(newId);\n    }, 75);\n\n    // Remove from resurrection list\n    deleteResurrectableTab(resurrectable.id);\n\n    return true;\n  } catch (error) {\n    console.error('[TabResurrection] Failed to resurrect tab:', error);\n    return false;\n  }\n}\n\n/**\n * Delete a resurrectable tab\n */\nexport function deleteResurrectableTab(tabId: string): void {\n  try {\n    const all = loadResurrectableTabs();\n    const filtered = all.filter(t => t.id !== tabId);\n    localStorage.setItem(RESURRECTION_KEY, JSON.stringify(filtered));\n  } catch (error) {\n    console.warn('[TabResurrection] Failed to delete resurrectable tab:', error);\n  }\n}\n\n/**\n * Auto-save all tabs periodically for resurrection\n */\nlet saveInterval: NodeJS.Timeout | null = null;\n\nexport function startAutoSaveTabs(): void {\n  if (saveInterval) {\n    clearInterval(saveInterval);\n  }\n\n  saveInterval = setInterval(() => {\n    const tabs = useTabsStore.getState().tabs;\n    tabs.forEach(tab => {\n      // Only save active tabs that have been open for a while\n      if (tab.url && tab.url !== 'about:blank' && !tab.url.startsWith('chrome://')) {\n        saveTabForResurrection(tab);\n      }\n    });\n  }, 30000); // Save every 30 seconds\n}\n\nexport function stopAutoSaveTabs(): void {\n  if (saveInterval) {\n    clearInterval(saveInterval);\n    saveInterval = null;\n  }\n}\n\n/**\n * Check for tabs to resurrect on app start\n */\nexport function checkForResurrectableTabs(): ResurrectableTab[] {\n  const all = loadResurrectableTabs();\n  const now = Date.now();\n  const RESURRECTION_WINDOW_MS = 300000; // 5 minutes\n\n  // Filter tabs that were saved recently (likely crashed)\n  return all.filter(tab => {\n    const timeSinceSave = now - tab.savedAt;\n    return timeSinceSave < RESURRECTION_WINDOW_MS;\n  });\n}\n\n/**\n * Auto-resurrect tabs after delay\n */\nexport function scheduleAutoResurrection(delayMs: number = RESURRECTION_DELAY_MS): void {\n  setTimeout(() => {\n    const toResurrect = checkForResurrectableTabs();\n    if (toResurrect.length > 0) {\n      console.log(`[TabResurrection] Auto-resurrecting ${toResurrect.length} tabs`);\n      toResurrect.forEach(tab => {\n        resurrectTab(tab).catch(err => {\n          console.error('[TabResurrection] Failed to auto-resurrect:', err);\n        });\n      });\n    }\n  }, delayMs);\n}\n","/**\r\n * TabStrip - Floating tab bar with Arc-like design\r\n * Fully functional tab management with real-time updates\r\n */\r\n\r\n// @ts-nocheck\r\n\r\nimport { useState, useEffect, useRef, useCallback, useMemo } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport {\r\n  X,\r\n  Plus,\r\n  Eye,\r\n  Sparkles,\r\n  RotateCcw,\r\n  Pin,\r\n  PinOff,\r\n  ChevronDown,\r\n  ChevronRight,\r\n  Palette,\r\n  Edit3,\r\n  FolderPlus,\r\n} from 'lucide-react';\r\nimport { ipc } from '../../lib/ipc-typed';\r\nimport {\r\n  useTabsStore,\r\n  type ClosedTab,\r\n  type TabGroup,\r\n  TAB_GROUP_COLORS,\r\n} from '../../state/tabsStore';\r\nimport { useContainerStore } from '../../state/containerStore';\r\nimport { useAppStore } from '../../state/appStore';\r\nimport { ipcEvents } from '../../lib/ipc-events';\r\nimport { TabHoverCard } from '../TopNav/TabHoverCard';\r\nimport { ContainerQuickSelector } from '../containers/ContainerQuickSelector';\r\nimport { TabContextMenu } from './TabContextMenu';\r\nimport { usePeekPreviewStore } from '../../state/peekStore';\r\nimport { Portal } from '../common/Portal';\r\nimport { useTabGraphStore } from '../../state/tabGraphStore';\r\nimport { PredictiveClusterChip, PredictivePrefetchHint } from './PredictiveClusterChip';\r\nimport { TabGroupsOverlay } from '../tabs/TabGroupsOverlay';\r\n// HolographicPreviewOverlay removed - unused component\r\nimport { isDevEnv, isElectronRuntime } from '../../lib/env';\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuTrigger,\r\n  DropdownMenuContent,\r\n  DropdownMenuLabel,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuItem,\r\n} from '../ui/dropdown-menu';\r\nimport { reopenClosedTab } from '../../lib/tabLifecycle';\r\nimport {\r\n  saveTabForResurrection,\r\n  scheduleAutoResurrection,\r\n  RESURRECTION_DELAY_MS,\r\n} from '../../core/tabs/resurrection';\r\nimport { useAppError } from '../../hooks/useAppError';\r\n\r\nconst TAB_GRAPH_DRAG_MIME = 'application/x-regen-tab-id';\r\nconst IS_DEV = isDevEnv();\r\nconst IS_ELECTRON = isElectronRuntime();\r\nconst NEW_GROUP_DROP_ID = '__new-tab-group__';\r\n\r\nconst stopEventPropagation = (event: { stopPropagation?: () => void; nativeEvent?: Event }) => {\r\n  event?.stopPropagation?.();\r\n  const native = event?.nativeEvent as { stopImmediatePropagation?: () => void } | undefined;\r\n  native?.stopImmediatePropagation?.();\r\n};\r\n\r\ninterface Tab {\r\n  id: string;\r\n  title: string;\r\n  url: string;\r\n  favicon?: string;\r\n  active: boolean;\r\n  mode?: 'normal' | 'ghost' | 'private';\r\n  containerId?: string;\r\n  containerName?: string;\r\n  containerColor?: string;\r\n  createdAt?: number;\r\n  lastActiveAt?: number;\r\n  sessionId?: string;\r\n  profileId?: string;\r\n  sleeping?: boolean;\r\n  pinned?: boolean;\r\n  groupId?: string;\r\n}\r\n\r\n// Helper functions for safe property access\r\nconst safeGet = (obj: any, key: string, defaultValue: any = undefined): any => {\r\n  try {\r\n    if (obj == null || typeof obj !== 'object') return defaultValue;\r\n    if (!(key in obj)) return defaultValue;\r\n    const value = obj[key];\r\n    return value !== null && value !== undefined ? value : defaultValue;\r\n  } catch {\r\n    return defaultValue;\r\n  }\r\n};\r\n\r\nconst safeGetString = (obj: any, key: string, defaultValue: string = ''): string => {\r\n  try {\r\n    const value = safeGet(obj, key);\r\n    return typeof value === 'string' ? value : defaultValue;\r\n  } catch {\r\n    return defaultValue;\r\n  }\r\n};\r\n\r\nconst safeGetNumber = (obj: any, key: string): number | undefined => {\r\n  try {\r\n    const value = safeGet(obj, key);\r\n    return typeof value === 'number' ? value : undefined;\r\n  } catch {\r\n    return undefined;\r\n  }\r\n};\r\n\r\nconst mapTabsForStore = (list: Tab[]): Tab[] => {\r\n  try {\r\n    if (!Array.isArray(list)) {\r\n      return [];\r\n    }\r\n    const validTabs: Tab[] = [];\r\n    for (const item of list) {\r\n      try {\r\n        // Skip null/undefined\r\n        if (item == null) {\r\n          continue;\r\n        }\r\n        // Skip non-objects\r\n        if (typeof item !== 'object') {\r\n          continue;\r\n        }\r\n        // Ensure id exists and is a string\r\n        const itemId = safeGetString(item, 'id');\r\n        if (!itemId || itemId.length === 0) {\r\n          continue;\r\n        }\r\n        // Safely extract all properties with defaults\r\n        const tab: Tab = {\r\n          id: itemId,\r\n          title: safeGetString(item, 'title', 'Untitled'),\r\n          active: Boolean(safeGet(item, 'active', false)),\r\n          url: safeGetString(item, 'url', 'about:blank'),\r\n          mode: (safeGet(item, 'mode') === 'ghost' || safeGet(item, 'mode') === 'private' ? safeGet(item, 'mode') : 'normal'),\r\n          containerId: safeGetString(item, 'containerId'),\r\n          containerColor: safeGetString(item, 'containerColor'),\r\n          containerName: safeGetString(item, 'containerName'),\r\n          createdAt: safeGetNumber(item, 'createdAt'),\r\n          lastActiveAt: safeGetNumber(item, 'lastActiveAt'),\r\n          sessionId: safeGetString(item, 'sessionId'),\r\n          profileId: safeGetString(item, 'profileId'),\r\n          sleeping: Boolean(safeGet(item, 'sleeping', false)),\r\n          pinned: Boolean(safeGet(item, 'pinned', false)),\r\n          groupId: safeGetString(item, 'groupId'),\r\n        };\r\n        validTabs.push(tab);\r\n      } catch (itemError) {\r\n        if (IS_DEV) {\r\n          console.warn('[TabStrip] Failed to map tab item:', item, itemError);\r\n        }\r\n        // Skip invalid items instead of creating error tabs\r\n        continue;\r\n      }\r\n    }\r\n    return validTabs;\r\n  } catch (error) {\r\n    if (IS_DEV) {\r\n      console.error('[TabStrip] mapTabsForStore error:', error, list);\r\n    }\r\n    return [];\r\n  }\r\n};\r\n\r\nexport function TabStrip() {\r\n  const { handleError: _handleError } = useAppError();\r\n  const setAllTabs = useTabsStore(state => state.setAll);\r\n  const setActiveTab = useTabsStore(state => state.setActive);\r\n  const activeId = useTabsStore(state => state.activeId);\r\n  const storeTabs = useTabsStore(state => state.tabs);\r\n\r\n  // Defensive: Ensure tabs is always an array\r\n  const safeTabs = Array.isArray(storeTabs) ? storeTabs : [];\r\n  const updateTab = useTabsStore(state => state.updateTab);\r\n  const rememberClosedTab = useTabsStore(state => state.rememberClosedTab);\r\n  const openPeek = usePeekPreviewStore(state => state.open); // Must be defined before renderTabNode\r\n  const recentlyClosed = useTabsStore(state => state.recentlyClosed);\r\n  const togglePinTab = useTabsStore(state => state.togglePinTab);\r\n  const tabGroups = useTabsStore(state => state.tabGroups);\r\n  const createGroup = useTabsStore(state => state.createGroup);\r\n  const deleteGroup = useTabsStore(state => state.deleteGroup);\r\n  const toggleGroupCollapsed = useTabsStore(state => state.toggleGroupCollapsed);\r\n  const setGroupColor = useTabsStore(state => state.setGroupColor);\r\n  const assignTabToGroup = useTabsStore(state => state.assignTabToGroup);\r\n  const updateGroup = useTabsStore(state => state.updateGroup);\r\n  const { activeContainerId } = useContainerStore();\r\n  const { mode: currentMode } = useAppStore();\r\n  const [tabs, setTabs] = useState<Tab[]>([]);\r\n  const [predictedClusters, setPredictedClusters] = useState<\r\n    Array<{ id: string; label: string; tabIds: string[]; confidence?: number }>\r\n  >([]);\r\n  const [prefetchEntries, setPrefetchEntries] = useState<\r\n    Array<{ tabId: string; url: string; reason: string; confidence?: number }>\r\n  >([]);\r\n  const [predictionSummary, setPredictionSummary] = useState<string | null>(null);\r\n  const [holographicPreviewTabId, setHolographicPreviewTabId] = useState<string | null>(null);\r\n  const [hologramSupported, setHologramSupported] = useState<boolean | null>(null);\r\n  const [handoffStatus, setHandoffStatus] = useState<{\r\n    platform: string;\r\n    lastSentAt: number | null;\r\n  }>({ platform: 'desktop', lastSentAt: null });\r\n  const [groupsOverlayOpen, setGroupsOverlayOpen] = useState(false);\r\n  const [contextMenu, setContextMenu] = useState<{\r\n    tabId: string;\r\n    url: string;\r\n    containerId?: string;\r\n    containerName?: string;\r\n    containerColor?: string;\r\n    mode?: 'normal' | 'ghost' | 'private';\r\n    sleeping?: boolean;\r\n    x: number;\r\n    y: number;\r\n  } | null>(null);\r\n  const [hasInitialized, setHasInitialized] = useState(false);\r\n  const isRestoringRef = useRef(false);\r\n  const isCreatingTabRef = useRef(false); // Prevent infinite tab creation loops\r\n  const previousTabIdsRef = useRef<string>(''); // Track tab IDs to prevent unnecessary updates\r\n  const currentActiveIdRef = useRef<string | null>(null); // Track active ID without causing re-renders\r\n  const activationInFlightRef = useRef<string | null>(null); // Track activations to avoid duplicate work\r\n  const tabsRef = useRef<Tab[]>(tabs); // Must be defined before refreshTabsFromMain and activateTab\r\n  const fetchPredictiveSuggestionsRef = useRef<(options?: { force?: boolean }) => Promise<void> | void>(); // Must be defined before refreshTabsFromMain\r\n  const [groupDragTarget, setGroupDragTarget] = useState<string | null>(null);\r\n  const groupMap = useMemo(() => {\r\n    const map = new Map<string, TabGroup>();\r\n    tabGroups.forEach(group => {\r\n      map.set(group.id, group);\r\n    });\r\n    return map;\r\n  }, [tabGroups]);\r\n\r\n  const handleRenameGroup = useCallback(\r\n    (group: TabGroup) => {\r\n      const nextName = window.prompt('Rename group', group.name);\r\n      if (!nextName) return;\r\n      const trimmed = nextName.trim();\r\n      if (!trimmed || trimmed === group.name) return;\r\n      updateGroup(group.id, { name: trimmed });\r\n    },\r\n    [updateGroup]\r\n  );\r\n\r\n  const handleCycleGroupColor = useCallback(\r\n    (group: TabGroup) => {\r\n      const currentIndex = TAB_GROUP_COLORS.findIndex(color => color === group.color);\r\n      const nextColor = TAB_GROUP_COLORS[(currentIndex + 1) % TAB_GROUP_COLORS.length];\r\n      setGroupColor(group.id, nextColor);\r\n    },\r\n    [setGroupColor]\r\n  );\r\n\r\n  const _handleDeleteGroup = useCallback(\r\n    (group: TabGroup) => {\r\n      if (window.confirm(`Remove group \"${group.name}\"? Tabs will remain open.`)) {\r\n        deleteGroup(group.id);\r\n      }\r\n    },\r\n    [deleteGroup]\r\n  );\r\n\r\n  const handleGroupDrop = useCallback(\r\n    (groupId: string) => {\r\n      if (!draggedTabIdRef.current) return;\r\n      assignTabToGroup(draggedTabIdRef.current, groupId);\r\n      draggedTabIdRef.current = null;\r\n      dragOverIndexRef.current = null;\r\n      setGroupDragTarget(null);\r\n    },\r\n    [assignTabToGroup]\r\n  );\r\n\r\n  const handleGroupDragOver = useCallback((e: React.DragEvent, groupId: string) => {\r\n    if (!draggedTabIdRef.current) return;\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setGroupDragTarget(groupId);\r\n  }, []);\r\n\r\n  const handleGroupDragLeave = useCallback((groupId: string) => {\r\n    setGroupDragTarget(current => (current === groupId ? null : current));\r\n  }, []);\r\n\r\n  const _handleCreateGroupShortcut = useCallback(\r\n    (name?: string) => {\r\n      const group = createGroup({ name });\r\n      return group;\r\n    },\r\n    [createGroup]\r\n  );\r\n\r\n  const handleDropToNewGroup = useCallback(() => {\r\n    if (!draggedTabIdRef.current) return;\r\n    const group = createGroup({});\r\n    assignTabToGroup(draggedTabIdRef.current, group.id);\r\n    draggedTabIdRef.current = null;\r\n    dragOverIndexRef.current = null;\r\n    setGroupDragTarget(null);\r\n  }, [assignTabToGroup, createGroup]);\r\n\r\n  // Define filteredTabs BEFORE render functions that use it\r\n  const filteredTabs = useMemo(() => {\r\n    try {\r\n      // Defensive: Use safeTabs and filter invalid entries\r\n      if (!Array.isArray(safeTabs)) {\r\n        return [];\r\n      }\r\n      const validTabs = safeTabs.filter(tab => {\r\n        try {\r\n          return tab != null && typeof tab === 'object' && typeof tab.id === 'string' && tab.id.length > 0;\r\n        } catch {\r\n          return false;\r\n        }\r\n      });\r\n      if (validTabs.length === 0) {\r\n        return [];\r\n      }\r\n      return validTabs.filter(tab => {\r\n        try {\r\n          return !tab.appMode || tab.appMode === currentMode;\r\n        } catch {\r\n          return true; // Include tab if we can't check appMode\r\n        }\r\n      });\r\n    } catch (error) {\r\n      if (IS_DEV) {\r\n        console.error('[TabStrip] filteredTabs error:', error);\r\n      }\r\n      return [];\r\n    }\r\n  }, [safeTabs, currentMode]);\r\n\r\n  const renderGroupHeader = useCallback((group: TabGroup) => {\r\n    const groupTabs = filteredTabs.filter(t => t.groupId === group.id);\r\n    return (\r\n      <div\r\n        key={`group-${group.id}`}\r\n        className={`flex items-center gap-2 px-3 py-2 rounded-lg border text-xs font-semibold ${\r\n          groupDragTarget === group.id\r\n            ? 'border-blue-500/70 bg-blue-500/10 text-blue-200'\r\n            : 'border-gray-700/60 bg-gray-800/80 text-gray-200'\r\n        }`}\r\n        style={{\r\n          borderLeft: `3px solid ${group.color}`,\r\n        }}\r\n        onDragOver={e => handleGroupDragOver(e, group.id)}\r\n        onDragLeave={() => handleGroupDragLeave(group.id)}\r\n        onDrop={e => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          handleGroupDrop(group.id);\r\n        }}\r\n      >\r\n        <button\r\n          type=\"button\"\r\n          onClick={e => {\r\n            stopEventPropagation(e);\r\n            toggleGroupCollapsed(group.id);\r\n          }}\r\n          onMouseDown={e => {\r\n            stopEventPropagation(e);\r\n          }}\r\n          className=\"p-1 rounded hover:bg-gray-700/60 transition-colors text-gray-300 hover:text-white\"\r\n          style={{ zIndex: 10011, isolation: 'isolate' }}\r\n          title={group.collapsed ? 'Expand group' : 'Collapse group'}\r\n        >\r\n          {group.collapsed ? <ChevronRight size={14} /> : <ChevronDown size={14} />}\r\n        </button>\r\n        <div\r\n          className=\"w-3 h-3 rounded-full border border-white/30 flex-shrink-0\"\r\n          style={{ backgroundColor: group.color }}\r\n          title={`Group color: ${group.color}`}\r\n        />\r\n        <button\r\n          type=\"button\"\r\n          onClick={e => {\r\n            stopEventPropagation(e);\r\n            handleRenameGroup(group);\r\n          }}\r\n          onMouseDown={e => {\r\n            stopEventPropagation(e);\r\n          }}\r\n          className=\"text-[11px] font-semibold text-gray-100 hover:text-white truncate min-w-[60px]\"\r\n          style={{ zIndex: 10011, isolation: 'isolate' }}\r\n          title=\"Rename group\"\r\n        >\r\n          {group.name}\r\n        </button>\r\n        <span className=\"text-[10px] text-gray-400 ml-1\">\r\n          ({groupTabs.length})\r\n        </span>\r\n        <div className=\"flex items-center gap-0.5 ml-auto\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={e => {\r\n              stopEventPropagation(e);\r\n              handleCycleGroupColor(group);\r\n            }}\r\n            onMouseDown={e => {\r\n              stopEventPropagation(e);\r\n            }}\r\n            className=\"p-1 rounded hover:bg-gray-700/60 text-gray-400 hover:text-white transition-colors opacity-0 group-hover:opacity-100\"\r\n            style={{ zIndex: 10011, isolation: 'isolate' }}\r\n            title=\"Change color\"\r\n          >\r\n            <Palette size={12} />\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={e => {\r\n              stopEventPropagation(e);\r\n              handleRenameGroup(group);\r\n            }}\r\n            onMouseDown={e => {\r\n              stopEventPropagation(e);\r\n            }}\r\n            className=\"p-1 rounded hover:bg-gray-700/60 text-gray-400 hover:text-white transition-colors opacity-0 group-hover:opacity-100\"\r\n            style={{ zIndex: 10011, isolation: 'isolate' }}\r\n            title=\"Rename group\"\r\n          >\r\n            <Edit3 size={12} />\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }, [filteredTabs, groupDragTarget, handleGroupDragOver, handleGroupDragLeave, handleGroupDrop, toggleGroupCollapsed, handleRenameGroup, handleCycleGroupColor, setGroupsOverlayOpen]);\r\n\r\n  // Define refreshTabsFromMain and activateTab BEFORE renderTabNode that uses them\r\n  const refreshTabsFromMain = useCallback(async () => {\r\n    if (!IS_ELECTRON) {\r\n      return;\r\n    }\r\n    try {\r\n      const tabList = await ipc.tabs.list();\r\n      if (!Array.isArray(tabList)) {\r\n        if (IS_DEV) {\r\n          console.warn('[TabStrip] refreshTabsFromMain: Invalid tab list', tabList);\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (IS_DEV) {\r\n        console.log('[TabStrip] refreshTabsFromMain: Got', tabList.length, 'tabs');\r\n      }\r\n\r\n      const mappedTabs = tabList.map((t: any) => {\r\n        // Get store metadata if available\r\n        const storeTab = storeTabs.find(st => st.id === t.id);\r\n        const appMode = storeTab?.appMode || currentMode;\r\n        const pinned = storeTab?.pinned ?? Boolean(t.pinned);\r\n        const groupId = storeTab?.groupId ?? t.groupId;\r\n\r\n        return {\r\n          id: t.id,\r\n          title: t.title || 'New Tab',\r\n          url: t.url || 'about:blank',\r\n          active: t.active || false,\r\n          mode: t.mode || 'normal',\r\n          appMode: appMode,\r\n          containerId: t.containerId,\r\n          containerName: t.containerName,\r\n          containerColor: t.containerColor,\r\n          createdAt: t.createdAt,\r\n          lastActiveAt: t.lastActiveAt,\r\n          sessionId: t.sessionId,\r\n          profileId: t.profileId,\r\n          sleeping: Boolean(t.sleeping),\r\n          pinned: pinned,\r\n          groupId,\r\n        };\r\n      });\r\n\r\n      const ids = mappedTabs\r\n        .map(t => t.id)\r\n        .sort()\r\n        .join(',');\r\n      previousTabIdsRef.current = ids;\r\n\r\n      // Force update - always set state even if IDs are the same\r\n      setTabs(mappedTabs);\r\n      tabsRef.current = mappedTabs;\r\n      setAllTabs(mapTabsForStore(mappedTabs));\r\n\r\n      const activeTab = mappedTabs.find(t => t.active);\r\n      if (activeTab) {\r\n        setActiveTab(activeTab.id);\r\n        currentActiveIdRef.current = activeTab.id;\r\n      } else if (mappedTabs.length > 0) {\r\n        // Tabs exist but none active - activate first one\r\n        const firstTab = mappedTabs[0];\r\n        if (firstTab) {\r\n          setActiveTab(firstTab.id);\r\n          currentActiveIdRef.current = firstTab.id;\r\n          // Also activate in main process\r\n          try {\r\n            await ipc.tabs.activate({ id: firstTab.id });\r\n          } catch {\r\n            // Silent fail\r\n          }\r\n        }\r\n      } else {\r\n        setActiveTab(null);\r\n        currentActiveIdRef.current = null;\r\n      }\r\n\r\n      fetchPredictiveSuggestionsRef.current?.();\r\n    } catch (error) {\r\n      if (IS_DEV) {\r\n        console.error('[TabStrip] Failed to refresh tabs from main process:', error);\r\n      }\r\n    }\r\n  }, [setActiveTab, setAllTabs, storeTabs, currentMode, setTabs]);\r\n\r\n  const activateTab = useCallback(\r\n    async (tabId: string) => {\r\n      if (!IS_ELECTRON) {\r\n        const currentTabs = tabsRef.current.length > 0 ? tabsRef.current : tabs;\r\n        const tabToActivate = currentTabs.find(t => t.id === tabId);\r\n        if (!tabToActivate) {\r\n          return;\r\n        }\r\n        const updated = currentTabs.map(t => ({\r\n          ...t,\r\n          active: t.id === tabId,\r\n        }));\r\n        setTabs(updated);\r\n        tabsRef.current = updated;\r\n        previousTabIdsRef.current = updated\r\n          .map(t => t.id)\r\n          .sort()\r\n          .join(',');\r\n        setAllTabs(mapTabsForStore(updated));\r\n        setActiveTab(tabId);\r\n        currentActiveIdRef.current = tabId;\r\n        ipcEvents.emit('tabs:updated', mapTabsForStore(updated));\r\n        return;\r\n      }\r\n\r\n      // Fast path: Skip if already active (check both ref and store for accuracy)\r\n      if (activationInFlightRef.current === tabId) {\r\n        return;\r\n      }\r\n      if (currentActiveIdRef.current === tabId && activeId === tabId) {\r\n        return;\r\n      }\r\n\r\n      // Get current tabs from ref (most up-to-date, avoids re-render)\r\n      const currentTabs = tabsRef.current.length > 0 ? tabsRef.current : tabs;\r\n      const tabToActivate = currentTabs.find(t => t.id === tabId);\r\n      if (!tabToActivate) {\r\n        if (IS_DEV) {\r\n          console.warn('[TabStrip] Tab not found for activation:', tabId);\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Set flag immediately to prevent duplicate activations\r\n      activationInFlightRef.current = tabId;\r\n\r\n      // OPTIMIZED: Only update active state, not entire tabs array\r\n      // IPC event will update tabs array, so we just need to update activeId\r\n      setActiveTab(tabId);\r\n      currentActiveIdRef.current = tabId;\r\n\r\n      // Fire IPC call without waiting (non-blocking for better UX)\r\n      // IPC event handler will update tabs array when it receives confirmation\r\n      ipc.tabs\r\n        .activate({ id: tabId })\r\n        .then(result => {\r\n          if (!result || !result.success) {\r\n            // Only revert if activation failed\r\n            if (IS_DEV) {\r\n              console.warn('[TabStrip] Tab activation failed:', tabId, result?.error);\r\n            }\r\n            // Refresh from main process to get correct state\r\n            refreshTabsFromMain().catch(() => {});\r\n          }\r\n          activationInFlightRef.current = null;\r\n        })\r\n        .catch(error => {\r\n          if (IS_DEV) {\r\n            console.error('[TabStrip] Tab activation error:', error);\r\n          }\r\n          // Refresh from main process to get correct state\r\n          refreshTabsFromMain().catch(() => {});\r\n          activationInFlightRef.current = null;\r\n        });\r\n    },\r\n    [activeId, setActiveTab, setAllTabs, refreshTabsFromMain, tabs, setTabs]\r\n  );\r\n\r\n  const closeTab = async (tabId: string) => {\r\n    if (!IS_ELECTRON) {\r\n      const currentTabs = tabsRef.current.length > 0 ? tabsRef.current : tabs;\r\n      const idx = currentTabs.findIndex(t => t.id === tabId);\r\n      if (idx === -1) {\r\n        return;\r\n      }\r\n      const tabBeingClosed = currentTabs[idx];\r\n      if (tabBeingClosed) {\r\n        rememberClosedTab(tabBeingClosed);\r\n        // Save for resurrection (auto-reopen after 5 minutes)\r\n        saveTabForResurrection(tabBeingClosed);\r\n        // Schedule auto-resurrection after 5 minutes\r\n        scheduleAutoResurrection(RESURRECTION_DELAY_MS);\r\n      }\r\n      const wasActive = currentTabs[idx]?.active;\r\n      const remaining = currentTabs.filter(t => t.id !== tabId);\r\n      let updated = remaining;\r\n\r\n      if (remaining.length === 0) {\r\n        const fallbackTab: Tab = {\r\n          id: `local-${Date.now()}`,\r\n          title: 'New Tab',\r\n          url: 'about:blank',\r\n          active: true,\r\n          mode: 'normal',\r\n        };\r\n        updated = [fallbackTab];\r\n      } else if (wasActive) {\r\n        // After removing tab at idx, prefer the tab at the same position\r\n        // If that doesn't exist (we closed the last tab), use the previous one\r\n        let nextIndex = idx;\r\n        if (nextIndex >= remaining.length) {\r\n          nextIndex = remaining.length - 1;\r\n        }\r\n        updated = remaining.map((t, index) => ({\r\n          ...t,\r\n          active: index === nextIndex,\r\n        }));\r\n      }\r\n\r\n      const activeTab = updated.find(t => t.active) ?? updated[0];\r\n\r\n      setTabs(updated);\r\n      tabsRef.current = updated;\r\n      previousTabIdsRef.current = updated\r\n        .map(t => t.id)\r\n        .sort()\r\n        .join(',');\r\n      setAllTabs(mapTabsForStore(updated));\r\n      setActiveTab(activeTab ? activeTab.id : null);\r\n      currentActiveIdRef.current = activeTab ? activeTab.id : null;\r\n      ipcEvents.emit('tabs:updated', mapTabsForStore(updated));\r\n      return;\r\n    }\r\n\r\n    // Prevent closing if already creating a tab\r\n    if (isCreatingTabRef.current) {\r\n      return;\r\n    }\r\n\r\n    // Get current tabs\r\n    const currentTabs = tabsRef.current.length > 0 ? tabsRef.current : tabs;\r\n    const tabToClose = currentTabs.find(t => t.id === tabId);\r\n    if (!tabToClose) {\r\n      return;\r\n    }\r\n    rememberClosedTab(tabToClose);\r\n    // Save for resurrection (auto-reopen after 5 minutes)\r\n    saveTabForResurrection(tabToClose);\r\n    // Schedule auto-resurrection after 5 minutes\r\n    scheduleAutoResurrection(RESURRECTION_DELAY_MS);\r\n\r\n    const wasActive = tabToClose.active;\r\n    const tabIndex = currentTabs.findIndex(t => t.id === tabId);\r\n    const remainingTabs = currentTabs.filter(t => t.id !== tabId);\r\n    const closingLastTab = remainingTabs.length === 0;\r\n    const snapshotTabs = currentTabs.map(t => ({ ...t }));\r\n    const previousActiveId = currentActiveIdRef.current;\r\n\r\n    // Update UI immediately (optimistic update)\r\n    setTabs(remainingTabs);\r\n    tabsRef.current = remainingTabs;\r\n    previousTabIdsRef.current = remainingTabs\r\n      .map(t => t.id)\r\n      .sort()\r\n      .join(',');\r\n    setAllTabs(mapTabsForStore(remainingTabs));\r\n\r\n    // If closing active tab, activate the next one\r\n    if (wasActive && remainingTabs.length > 0) {\r\n      // After removing tab at tabIndex, prefer the tab at the same position\r\n      // If that doesn't exist (we closed the last tab), use the previous one\r\n      let nextTabIndex = tabIndex;\r\n      if (nextTabIndex >= remainingTabs.length) {\r\n        nextTabIndex = remainingTabs.length - 1;\r\n      }\r\n      const nextTab = remainingTabs[nextTabIndex];\r\n      if (nextTab) {\r\n        setActiveTab(nextTab.id);\r\n        currentActiveIdRef.current = nextTab.id;\r\n      }\r\n    } else if (remainingTabs.length === 0) {\r\n      setActiveTab(null);\r\n      currentActiveIdRef.current = null;\r\n    }\r\n\r\n    if (IS_DEV) {\r\n      console.log(\r\n        '[TabStrip] Closing tab (optimistic):',\r\n        tabId,\r\n        'previous active:',\r\n        previousActiveId\r\n      );\r\n    }\r\n\r\n    try {\r\n      const result = await Promise.race([\r\n        ipc.tabs.close({ id: tabId }),\r\n        new Promise<{ success: boolean; error?: string }>(resolve =>\r\n          setTimeout(() => resolve({ success: false, error: 'Timeout' }), 2000)\r\n        ),\r\n      ]);\r\n\r\n      if (IS_DEV) {\r\n        console.log('[TabStrip] tabs.close result:', result);\r\n      }\r\n\r\n      if (!result || !result.success) {\r\n        if (IS_DEV) {\r\n          console.warn(\r\n            '[TabStrip] Tab close failed or timed out, reverting:',\r\n            tabId,\r\n            result?.error\r\n          );\r\n        }\r\n\r\n        setTabs(snapshotTabs);\r\n        tabsRef.current = snapshotTabs;\r\n        previousTabIdsRef.current = snapshotTabs\r\n          .map(t => t.id)\r\n          .sort()\r\n          .join(',');\r\n        setAllTabs(mapTabsForStore(snapshotTabs));\r\n\r\n        if (previousActiveId) {\r\n          setActiveTab(previousActiveId);\r\n          currentActiveIdRef.current = previousActiveId;\r\n        }\r\n\r\n        await refreshTabsFromMain();\r\n      } else if (closingLastTab) {\r\n        // Ensure there is always at least one tab per mode\r\n        setTimeout(() => {\r\n          void addTab();\r\n        }, 50);\r\n      }\r\n    } catch (error) {\r\n      if (IS_DEV) {\r\n        console.error('[TabStrip] Tab close error:', error);\r\n      }\r\n\r\n      // Revert on error\r\n      setTabs(snapshotTabs);\r\n      tabsRef.current = snapshotTabs;\r\n      previousTabIdsRef.current = snapshotTabs\r\n        .map(t => t.id)\r\n        .sort()\r\n        .join(',');\r\n      setAllTabs(mapTabsForStore(snapshotTabs));\r\n\r\n      if (previousActiveId) {\r\n        setActiveTab(previousActiveId);\r\n        currentActiveIdRef.current = previousActiveId;\r\n      }\r\n\r\n      await refreshTabsFromMain();\r\n    }\r\n  };\r\n\r\n  const renderTabNode = useCallback((tab: Tab) => {\r\n    const group = tab.groupId ? groupMap.get(tab.groupId) : null;\r\n    const groupRingStyle = group\r\n      ? {\r\n          boxShadow: `inset 0 0 0 1px ${group.color}40`,\r\n        }\r\n      : undefined;\r\n    const prefetchForTab = prefetchEntries.find(entry => entry.tabId === tab.id);\r\n    return (\r\n      <TabHoverCard key={tab.id} tabId={tab.id}>\r\n        <motion.div\r\n          id={`tab-${tab.id}`}\r\n          data-tab={tab.id}\r\n          role=\"tab\"\r\n          aria-selected={tab.active}\r\n          aria-controls={`tabpanel-${tab.id}`}\r\n          aria-label={`Tab: ${tab.title || 'Untitled'}${tab.mode === 'ghost' ? ' (Ghost tab)' : tab.mode === 'private' ? ' (Private tab)' : ''}${tab.sleeping ? ' (Hibernating)' : ''}${group ? ` (Group: ${group.name})` : ''}`}\r\n          tabIndex={tab.active ? 0 : -1}\r\n          layout={false}\r\n          initial={false}\r\n          animate={false}\r\n          exit={false}\r\n          className={`\r\n            relative flex items-center gap-2 ${tab.pinned ? 'px-2 py-1.5' : 'px-4 py-2'} rounded-lg\r\n            ${tab.pinned ? 'min-w-[40px] max-w-[40px]' : 'min-w-[100px] max-w-[220px]'} cursor-pointer group\r\n            transition-all duration-200\r\n            focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\r\n            ${\r\n              tab.active\r\n                ? 'bg-purple-600/20 border border-purple-500/40 shadow-lg shadow-purple-500/20'\r\n                : 'bg-gray-800/30 hover:bg-gray-800/50 border border-transparent'\r\n            }\r\n            ${tab.mode === 'ghost' ? 'ring-1 ring-purple-500/40' : ''}\r\n            ${tab.mode === 'private' ? 'ring-1 ring-emerald-500/40' : ''}\r\n            ${tab.sleeping ? 'ring-1 ring-amber-400/40' : ''}\r\n            ${tab.pinned ? 'border-l-2 border-l-blue-500' : ''}\r\n          `}\r\n          style={{ \r\n            pointerEvents: 'auto', \r\n            zIndex: 1, \r\n            userSelect: 'none', \r\n            ...groupRingStyle,\r\n            ...(group ? { borderLeft: `2px solid ${group.color}` } : {})\r\n          }}\r\n          draggable\r\n          onDragStart={event => {\r\n            try {\r\n              const isGraphDrag = event.ctrlKey || event.metaKey;\r\n              if (isGraphDrag) {\r\n                event.dataTransfer?.setData(TAB_GRAPH_DRAG_MIME, tab.id);\r\n                if (tab.title) {\r\n                  event.dataTransfer?.setData('text/plain', tab.title);\r\n                }\r\n                if (event.dataTransfer) {\r\n                  event.dataTransfer.effectAllowed = 'copy';\r\n                }\r\n              } else {\r\n                draggedTabIdRef.current = tab.id;\r\n                if (event.dataTransfer) {\r\n                  event.dataTransfer.effectAllowed = 'move';\r\n                }\r\n              }\r\n            } catch (error) {\r\n              if (IS_DEV) {\r\n                console.warn('[TabStrip] Drag start failed', error);\r\n              }\r\n            }\r\n          }}\r\n          onDragEnd={() => {\r\n            if (draggedTabIdRef.current === null) {\r\n              window.dispatchEvent(new CustomEvent('tabgraph:dragend'));\r\n            }\r\n            draggedTabIdRef.current = null;\r\n            dragOverIndexRef.current = null;\r\n            setGroupDragTarget(null);\r\n          }}\r\n          onClick={e => {\r\n            e.preventDefault();\r\n            stopEventPropagation(e);\r\n            void activateTab(tab.id);\r\n          }}\r\n          onKeyDown={e => {\r\n            if (e.key === 'Enter' || e.key === ' ') {\r\n              e.preventDefault();\r\n              e.stopPropagation();\r\n              activateTab(tab.id);\r\n              return;\r\n            }\r\n\r\n            if (['ArrowLeft', 'ArrowRight', 'Home', 'End'].includes(e.key)) {\r\n              e.preventDefault();\r\n              e.stopPropagation();\r\n\r\n              // Defensive: Use filteredTabs for keyboard navigation (with null check)\r\n              if (!filteredTabs || !Array.isArray(filteredTabs)) {\r\n                return;\r\n              }\r\n              const validTabs = filteredTabs.filter(t => t && t.id);\r\n              const currentIndex = validTabs.findIndex(t => t.id === tab.id);\r\n              if (currentIndex === -1) {\r\n                return;\r\n              }\r\n\r\n              let nextIndex = currentIndex;\r\n              switch (e.key) {\r\n                case 'Home':\r\n                  nextIndex = 0;\r\n                  break;\r\n                case 'End':\r\n                  nextIndex = validTabs.length - 1;\r\n                  break;\r\n                case 'ArrowLeft':\r\n                  nextIndex = (currentIndex - 1 + validTabs.length) % validTabs.length;\r\n                  break;\r\n                case 'ArrowRight':\r\n                  nextIndex = (currentIndex + 1) % validTabs.length;\r\n                  break;\r\n              }\r\n\r\n              const nextTab = validTabs[nextIndex];\r\n              if (nextTab && nextTab.id) {\r\n                void activateTab(nextTab.id);\r\n              }\r\n            }\r\n          }}\r\n          onAuxClick={(e: React.MouseEvent) => {\r\n            if (e.button === 1) {\r\n              e.preventDefault();\r\n              stopEventPropagation(e);\r\n              closeTab(tab.id);\r\n            }\r\n          }}\r\n          onContextMenu={e => {\r\n            e.preventDefault();\r\n            (window as any).__lastContextMenuPos = { x: e.clientX, y: e.clientY };\r\n            setContextMenu({\r\n              tabId: tab.id,\r\n              url: tab.url,\r\n              containerId: tab.containerId,\r\n              containerName: tab.containerName,\r\n              containerColor: tab.containerColor,\r\n              mode: tab.mode,\r\n              sleeping: tab.sleeping,\r\n              x: e.clientX,\r\n              y: e.clientY,\r\n            });\r\n          }}\r\n          onMouseEnter={() => {\r\n            // Defensive: Check if tab is last in filteredTabs (with null check)\r\n            if (!filteredTabs || !Array.isArray(filteredTabs)) {\r\n              return;\r\n            }\r\n            const validFilteredTabs = filteredTabs.filter(t => t && t.id);\r\n            if (\r\n              validFilteredTabs.length > 0 &&\r\n              tab === validFilteredTabs[validFilteredTabs.length - 1]\r\n            ) {\r\n              setHolographicPreviewTabId(tab.id);\r\n            }\r\n          }}\r\n          onMouseLeave={() => {\r\n            if (holographicPreviewTabId === tab.id) {\r\n              setHolographicPreviewTabId(null);\r\n            }\r\n          }}\r\n        >\r\n          {prefetchForTab && (\r\n            <span\r\n              className=\"absolute top-1 right-2 text-emerald-300 text-[11px] font-semibold\"\r\n              title={`Suggested follow-up: ${prefetchForTab.reason}`}\r\n            >\r\n              \r\n            </span>\r\n          )}\r\n          {hologramSupported !== false && holographicPreviewTabId === tab.id && (\r\n            <motion.div\r\n              initial={{ opacity: 0, y: 6 }}\r\n              animate={{ opacity: 1, y: 0 }}\r\n              exit={{ opacity: 0, y: 6 }}\r\n              className=\"absolute -bottom-9 left-1/2 flex -translate-x-1/2 items-center gap-2\"\r\n            >\r\n              <motion.button\r\n                type=\"button\"\r\n                className=\"flex items-center gap-1 rounded-full border border-cyan-400/40 bg-cyan-500/15 px-3 py-1 text-[10px] text-cyan-100 shadow-lg backdrop-blur transition-colors hover:bg-cyan-500/25\"\r\n                onClick={e => {\r\n                  e.preventDefault();\r\n                  e.stopPropagation();\r\n                  setHandoffStatus({ platform: 'xr', lastSentAt: Date.now() });\r\n                  window.dispatchEvent(\r\n                    new CustomEvent('tab:holographic-preview', {\r\n                      detail: { tabId: tab.id },\r\n                    })\r\n                  );\r\n                  void ipc.crossReality.handoff(tab.id, 'xr');\r\n                }}\r\n              >\r\n                <Sparkles size={12} /> XR Hologram\r\n              </motion.button>\r\n              <motion.button\r\n                type=\"button\"\r\n                className=\"flex items-center gap-1 rounded-full border border-amber-400/40 bg-amber-500/15 px-2.5 py-1 text-[10px] text-amber-100 shadow-lg backdrop-blur transition-colors hover:bg-amber-500/25\"\r\n                onClick={e => {\r\n                  e.preventDefault();\r\n                  e.stopPropagation();\r\n                  setHandoffStatus({ platform: 'mobile', lastSentAt: Date.now() });\r\n                  void ipc.crossReality.handoff(tab.id, 'mobile');\r\n                }}\r\n              >\r\n                <span role=\"img\" aria-label=\"mobile\">\r\n                  \r\n                </span>{' '}\r\n                Send\r\n              </motion.button>\r\n            </motion.div>\r\n          )}\r\n          {/* Favicon */}\r\n          <div className=\"flex-shrink-0 w-4 h-4 bg-gray-600 rounded-full flex items-center justify-center\">\r\n            {tab.favicon ? (\r\n              <img src={tab.favicon} alt=\"\" className=\"w-full h-full rounded-full\" />\r\n            ) : (\r\n              <div className=\"w-2 h-2 bg-gray-400 rounded-full\" />\r\n            )}\r\n          </div>\r\n\r\n          {tab.mode && tab.mode !== 'normal' && (\r\n            <span\r\n              className={`px-1.5 py-0.5 rounded-md text-[10px] font-medium border ${\r\n                tab.mode === 'ghost'\r\n                  ? 'bg-purple-500/20 text-purple-200 border-purple-400/40'\r\n                  : 'bg-emerald-500/20 text-emerald-200 border-emerald-400/40'\r\n              }`}\r\n            >\r\n              {tab.mode === 'ghost' ? 'Ghost' : 'Private'}\r\n            </span>\r\n          )}\r\n\r\n          {tab.containerId && tab.containerId !== 'default' && (\r\n            <div\r\n              className=\"w-2.5 h-2.5 rounded-full border border-gray-700/60\"\r\n              style={{ backgroundColor: tab.containerColor || '#6366f1' }}\r\n              title={`${tab.containerName || 'Custom'} container`}\r\n            />\r\n          )}\r\n\r\n          {group && (\r\n            <span\r\n              className=\"w-2 h-2 rounded-full border border-white/20\"\r\n              style={{ backgroundColor: group.color }}\r\n              title={`Group: ${group.name}`}\r\n            />\r\n          )}\r\n\r\n          {tab.sleeping && (\r\n            <span className=\"flex items-center\" title=\"Tab is hibernating\">\r\n              <motion.span\r\n                className=\"w-2 h-2 rounded-full bg-amber-400 shadow-[0_0_10px_rgba(251,191,36,0.55)]\"\r\n                animate={{ scale: [1, 1.25, 1], opacity: [0.7, 1, 0.7] }}\r\n                transition={{ repeat: Infinity, duration: 1.8, ease: 'easeInOut' }}\r\n              />\r\n            </span>\r\n          )}\r\n\r\n          {!tab.pinned && (\r\n            <span\r\n              className={`flex-1 text-sm truncate ${tab.active ? 'text-gray-100' : 'text-gray-400'}`}\r\n            >\r\n              {tab.title}\r\n            </span>\r\n          )}\r\n\r\n          <motion.button\r\n            type=\"button\"\r\n            onClick={e => {\r\n              e.preventDefault();\r\n              stopEventPropagation(e);\r\n              togglePinTab(tab.id);\r\n            }}\r\n            onMouseDown={e => {\r\n              stopEventPropagation(e);\r\n            }}\r\n            aria-label={tab.pinned ? `Unpin tab: ${tab.title}` : `Pin tab: ${tab.title}`}\r\n            className={`${tab.pinned ? 'opacity-100' : 'opacity-0 group-hover:opacity-100'} p-0.5 rounded hover:bg-gray-700/50 transition-opacity text-gray-400 hover:text-blue-400 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 no-drag ml-1`}\r\n            style={{ pointerEvents: 'auto', zIndex: 10011, isolation: 'isolate' }}\r\n            whileHover={{ scale: 1.05 }}\r\n            whileTap={{ scale: 0.96 }}\r\n            title={tab.pinned ? 'Unpin tab' : 'Pin tab'}\r\n          >\r\n            {tab.pinned ? <Pin size={14} className=\"text-blue-400\" /> : <PinOff size={14} />}\r\n          </motion.button>\r\n\r\n          {!tab.pinned && (\r\n            <motion.button\r\n              type=\"button\"\r\n              onClick={e => {\r\n                e.preventDefault();\r\n                stopEventPropagation(e);\r\n                openPeek(tab);\r\n              }}\r\n              onMouseDown={e => {\r\n                stopEventPropagation(e);\r\n              }}\r\n              aria-label={`Peek preview: ${tab.title}`}\r\n              className=\"opacity-0 group-hover:opacity-100 p-0.5 rounded hover:bg-gray-700/50 transition-opacity text-gray-400 hover:text-gray-100 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 no-drag ml-1\"\r\n              style={{ pointerEvents: 'auto', zIndex: 10011, isolation: 'isolate' }}\r\n              whileHover={{ scale: 1.05 }}\r\n              whileTap={{ scale: 0.96 }}\r\n              title=\"Peek preview\"\r\n            >\r\n              <Eye size={14} />\r\n            </motion.button>\r\n          )}\r\n\r\n          {!tab.pinned && (\r\n            <motion.button\r\n              type=\"button\"\r\n              onClick={e => {\r\n                e.preventDefault();\r\n                stopEventPropagation(e);\r\n                closeTab(tab.id);\r\n              }}\r\n              onAuxClick={e => {\r\n                if (e.button === 1) {\r\n                  e.preventDefault();\r\n                  stopEventPropagation(e);\r\n                  closeTab(tab.id);\r\n                }\r\n              }}\r\n              onMouseDown={e => {\r\n                stopEventPropagation(e);\r\n              }}\r\n              onKeyDown={e => {\r\n                if (e.key === 'Enter' || e.key === ' ') {\r\n                  e.preventDefault();\r\n                  e.stopPropagation();\r\n                  closeTab(tab.id);\r\n                }\r\n              }}\r\n              aria-label={`Close tab: ${tab.title}`}\r\n              className=\"opacity-0 group-hover:opacity-100 p-0.5 rounded hover:bg-gray-700/50 transition-opacity ml-1 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 no-drag\"\r\n              style={{ pointerEvents: 'auto', zIndex: 2 }}\r\n              whileHover={{ scale: 1.1 }}\r\n              whileTap={{ scale: 0.9 }}\r\n              title=\"Close tab (Middle click)\"\r\n            >\r\n              <X size={14} className=\"text-gray-400\" />\r\n            </motion.button>\r\n          )}\r\n        </motion.div>\r\n      </TabHoverCard>\r\n    );\r\n  }, [groupMap, prefetchEntries, filteredTabs, holographicPreviewTabId, hologramSupported, activateTab, closeTab, togglePinTab, openPeek]);\r\n\r\n  const tabElements = useMemo(() => {\r\n    // Defensive: Ensure functions are available\r\n    if (!renderGroupHeader || !renderTabNode) {\r\n      return [];\r\n    }\r\n\r\n    const elements: React.ReactNode[] = [];\r\n    const renderedGroupIds = new Set<string>();\r\n    \r\n    // Group tabs by groupId\r\n    const tabsByGroup = new Map<string | undefined, typeof filteredTabs>();\r\n    filteredTabs.forEach(tab => {\r\n      const groupId = tab.groupId || 'ungrouped';\r\n      if (!tabsByGroup.has(groupId)) {\r\n        tabsByGroup.set(groupId, []);\r\n      }\r\n      tabsByGroup.get(groupId)!.push(tab);\r\n    });\r\n\r\n    // Render groups and their tabs\r\n    tabGroups.forEach(group => {\r\n      const groupTabs = tabsByGroup.get(group.id) || [];\r\n      if (groupTabs.length > 0 && !renderedGroupIds.has(group.id)) {\r\n        renderedGroupIds.add(group.id);\r\n        try {\r\n          elements.push(renderGroupHeader(group));\r\n          if (!group.collapsed) {\r\n            groupTabs.forEach(tab => {\r\n              try {\r\n                elements.push(renderTabNode(tab));\r\n              } catch (err) {\r\n                console.error('[TabStrip] Error rendering tab:', err, tab);\r\n              }\r\n            });\r\n          }\r\n        } catch (err) {\r\n          console.error('[TabStrip] Error rendering group:', err, group);\r\n        }\r\n      }\r\n    });\r\n\r\n    // Render ungrouped tabs\r\n    const ungroupedTabs = tabsByGroup.get('ungrouped') || [];\r\n    ungroupedTabs.forEach(tab => {\r\n      try {\r\n        elements.push(renderTabNode(tab));\r\n      } catch (err) {\r\n        console.error('[TabStrip] Error rendering ungrouped tab:', err, tab);\r\n      }\r\n    });\r\n\r\n    return elements;\r\n  }, [filteredTabs, tabGroups, groupMap, renderGroupHeader, renderTabNode]);\r\n  const stripRef = useRef<HTMLDivElement>(null);\r\n  const predictiveRequestRef = useRef<Promise<void> | null>(null);\r\n  const lastPredictionSignatureRef = useRef<string>('');\r\n  const draggedTabIdRef = useRef<string | null>(null);\r\n  const dragOverIndexRef = useRef<number | null>(null);\r\n\r\n  // Keep ref in sync with activeId (doesn't cause re-renders)\r\n  useEffect(() => {\r\n    currentActiveIdRef.current = activeId;\r\n  }, [activeId]);\r\n\r\n  const runPredictiveSuggestions = useCallback(\r\n    async (options?: { force?: boolean }) => {\r\n      if (!IS_ELECTRON) {\r\n        // Predictive suggestions require IPC/Electron  clear any stale hints\r\n        if (options?.force) {\r\n          setPredictedClusters([]);\r\n          setPrefetchEntries([]);\r\n          setPredictionSummary(null);\r\n        }\r\n        return;\r\n      }\r\n      if (predictiveRequestRef.current && !options?.force) {\r\n        return predictiveRequestRef.current;\r\n      }\r\n\r\n      const signature = tabsRef.current\r\n        .map(tab => `${tab.id}:${tab.lastActiveAt ?? 0}`)\r\n        .sort()\r\n        .join('|');\r\n\r\n      if (\r\n        !options?.force &&\r\n        signature &&\r\n        signature === lastPredictionSignatureRef.current &&\r\n        predictedClusters.length > 0\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      const requestPromise = (async () => {\r\n        try {\r\n          const response = await ipc.tabs.predictiveGroups(options?.force ? { force: true } : {});\r\n          lastPredictionSignatureRef.current = signature;\r\n          if (!response) {\r\n            setPredictedClusters([]);\r\n            setPrefetchEntries([]);\r\n            setPredictionSummary(null);\r\n            return;\r\n          }\r\n\r\n          setPredictedClusters(Array.isArray(response.groups) ? response.groups : []);\r\n          setPrefetchEntries(Array.isArray(response.prefetch) ? response.prefetch : []);\r\n          setPredictionSummary(response.summary?.explanation ?? null);\r\n        } catch (error) {\r\n          if (IS_DEV) {\r\n            console.warn('[TabStrip] Predictive suggestions failed', error);\r\n          }\r\n          if (options?.force) {\r\n            setPredictedClusters([]);\r\n            setPrefetchEntries([]);\r\n            setPredictionSummary(null);\r\n          }\r\n        } finally {\r\n          if (predictiveRequestRef.current === requestPromise) {\r\n            predictiveRequestRef.current = null;\r\n          }\r\n        }\r\n      })();\r\n\r\n      predictiveRequestRef.current = requestPromise;\r\n      return requestPromise;\r\n    },\r\n    [predictedClusters.length]\r\n  );\r\n\r\n  useEffect(() => {\r\n    fetchPredictiveSuggestionsRef.current = runPredictiveSuggestions;\r\n  }, [runPredictiveSuggestions]);\r\n\r\n  useEffect(() => {\r\n    if (!hasInitialized) return;\r\n    fetchPredictiveSuggestionsRef.current?.({ force: true });\r\n  }, [hasInitialized]);\r\n\r\n\r\n  useEffect(() => {\r\n    const checkHologramSupport = () => {\r\n      const supported = typeof navigator !== 'undefined' && 'xr' in navigator;\r\n      setHologramSupported(supported);\r\n      if (supported) {\r\n        setHandoffStatus(prev => ({ ...prev, platform: 'xr-ready' }));\r\n      }\r\n    };\r\n    checkHologramSupport();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!handoffStatus.lastSentAt) return;\r\n    void ipc.crossReality.sendHandoffStatus(handoffStatus);\r\n  }, [handoffStatus]);\r\n\r\n  // Wait for IPC to be ready before making calls\r\n  useEffect(() => {\r\n    if (!IS_ELECTRON) {\r\n      let isMounted = true;\r\n\r\n      const applyTabs = (list: Tab[]) => {\r\n        if (!isMounted) return;\r\n        const mapped = list.length\r\n          ? list\r\n          : [\r\n              {\r\n                id: 'local-initial',\r\n                title: 'Welcome',\r\n                url: 'about:blank',\r\n                active: true,\r\n                mode: 'normal',\r\n              },\r\n            ];\r\n        setTabs(mapped);\r\n        tabsRef.current = mapped;\r\n        previousTabIdsRef.current = mapped\r\n          .map(t => t.id)\r\n          .sort()\r\n          .join(',');\r\n        setAllTabs(mapTabsForStore(mapped));\r\n        const activeTab = mapped.find(t => t.active) ?? mapped[0];\r\n        setActiveTab(activeTab ? activeTab.id : null);\r\n        currentActiveIdRef.current = activeTab ? activeTab.id : null;\r\n        setHasInitialized(true);\r\n      };\r\n\r\n      applyTabs(tabsRef.current.length > 0 ? tabsRef.current : tabs);\r\n\r\n      const unsubscribe = ipcEvents.on('tabs:updated', (tabList: any[]) => {\r\n        if (!isMounted) return;\r\n        if (!Array.isArray(tabList) || tabList.length === 0) {\r\n          applyTabs([]);\r\n          return;\r\n        }\r\n        const mappedTabs: Tab[] = tabList.map(t => {\r\n          // Get store metadata if available\r\n          const storeTab = storeTabs.find(st => st.id === t.id);\r\n          const appMode = storeTab?.appMode || currentMode;\r\n          const pinned = storeTab?.pinned ?? Boolean((t as any).pinned);\r\n          const groupId = storeTab?.groupId ?? (t as any).groupId;\r\n\r\n          return {\r\n            id: t.id,\r\n            title: t.title || 'New Tab',\r\n            url: t.url || 'about:blank',\r\n            active: Boolean(t.active),\r\n            appMode: appMode,\r\n            mode: (t as any).mode || 'normal',\r\n            containerId: t.containerId,\r\n            containerName: t.containerName,\r\n            containerColor: t.containerColor,\r\n            createdAt: t.createdAt,\r\n            lastActiveAt: t.lastActiveAt,\r\n            sessionId: t.sessionId,\r\n            profileId: t.profileId,\r\n            sleeping: (t as any).sleeping,\r\n            pinned,\r\n            groupId,\r\n          };\r\n        });\r\n        applyTabs(mappedTabs);\r\n      });\r\n\r\n      return () => {\r\n        isMounted = false;\r\n        unsubscribe();\r\n      };\r\n    }\r\n\r\n    let isMounted = true;\r\n    let ipcReady = false;\r\n\r\n    const waitForIPC = () => {\r\n      return new Promise<void>(resolve => {\r\n        if (window.ipc && typeof (window.ipc as any).invoke === 'function') {\r\n          ipcReady = true;\r\n          resolve();\r\n          return;\r\n        }\r\n\r\n        const checkIPC = () => {\r\n          if (window.ipc && typeof (window.ipc as any).invoke === 'function') {\r\n            ipcReady = true;\r\n            resolve();\r\n          }\r\n        };\r\n\r\n        // Listen for IPC ready signal\r\n        window.addEventListener('ipc:ready', checkIPC, { once: true });\r\n\r\n        // Also check periodically (fallback)\r\n        const interval = setInterval(() => {\r\n          if (window.ipc && typeof (window.ipc as any).invoke === 'function') {\r\n            clearInterval(interval);\r\n            ipcReady = true;\r\n            resolve();\r\n          }\r\n        }, 100);\r\n\r\n        // Timeout after 5 seconds\r\n        setTimeout(() => {\r\n          clearInterval(interval);\r\n          if (!ipcReady) {\r\n            console.warn('IPC not ready after 5 seconds, proceeding anyway');\r\n            resolve();\r\n          }\r\n        }, 5000);\r\n      });\r\n    };\r\n\r\n    const loadTabs = async (isInitialLoad = false) => {\r\n      if (!isMounted) return;\r\n\r\n      // CRITICAL: Don't load tabs if we're creating one (prevents loops)\r\n      if (isCreatingTabRef.current && !isInitialLoad) {\r\n        return;\r\n      }\r\n\r\n      // Wait for IPC to be ready\r\n      if (!ipcReady) {\r\n        await waitForIPC();\r\n      }\r\n\r\n      if (!isMounted) return;\r\n\r\n      try {\r\n        const tabList = await ipc.tabs.list();\r\n        if (!isMounted) return;\r\n\r\n        if (Array.isArray(tabList) && tabList.length > 0) {\r\n          const mappedTabs = tabList.map((t: any) => {\r\n            // Get appMode from store if available, otherwise use current mode\r\n            const storeTab = storeTabs.find(st => st.id === t.id);\r\n            const appMode = storeTab?.appMode || currentMode;\r\n\r\n            return {\r\n              id: t.id,\r\n              title: t.title || 'New Tab',\r\n              url: t.url || 'about:blank',\r\n              active: t.active || false,\r\n              mode: t.mode || 'normal',\r\n              appMode: appMode,\r\n              containerId: t.containerId,\r\n              containerName: t.containerName,\r\n              containerColor: t.containerColor,\r\n              createdAt: t.createdAt,\r\n              lastActiveAt: t.lastActiveAt,\r\n              sessionId: t.sessionId,\r\n              profileId: t.profileId,\r\n            };\r\n          });\r\n\r\n          // Update ref to track tab IDs and only update state if changed\r\n          const tabIds = mappedTabs\r\n            .map(t => t.id)\r\n            .sort()\r\n            .join(',');\r\n          if (previousTabIdsRef.current !== tabIds) {\r\n            previousTabIdsRef.current = tabIds;\r\n            setTabs(mappedTabs);\r\n            setAllTabs(mapTabsForStore(mappedTabs));\r\n          }\r\n\r\n          // Set active tab in store (only if changed - use ref to avoid dependency)\r\n          const activeTab = mappedTabs.find(t => t.active);\r\n          const currentActive = currentActiveIdRef.current;\r\n          if (activeTab && activeTab.id !== currentActive) {\r\n            setActiveTab(activeTab.id);\r\n          } else if (\r\n            mappedTabs.length > 0 &&\r\n            !activeTab &&\r\n            mappedTabs[0] &&\r\n            mappedTabs[0].id !== currentActive\r\n          ) {\r\n            // No active tab, activate first one\r\n            await ipc.tabs.activate({ id: mappedTabs[0].id });\r\n            setActiveTab(mappedTabs[0].id);\r\n          }\r\n\r\n          if (isInitialLoad) {\r\n            setHasInitialized(true);\r\n          }\r\n        } else {\r\n          // Only create initial tab on first mount, not every time tabs are empty\r\n          // AND only if we're not restoring from session\r\n          // AND only if we're not already creating a tab\r\n          // AND only if we haven't already initialized (prevent HMR duplicates)\r\n          if (\r\n            isInitialLoad &&\r\n            !hasInitialized &&\r\n            !isRestoringRef.current &&\r\n            !isCreatingTabRef.current\r\n          ) {\r\n            // Always wait a bit to allow session restoration to complete\r\n            // This prevents creating duplicate tabs during HMR or session restore\r\n            setTimeout(async () => {\r\n              // Double-check conditions after delay\r\n              if (\r\n                !isMounted ||\r\n                hasInitialized ||\r\n                isRestoringRef.current ||\r\n                isCreatingTabRef.current\r\n              ) {\r\n                return;\r\n              }\r\n\r\n              // Check again if tabs exist after waiting (they might have been restored)\r\n              try {\r\n                const recheckTabs = await ipc.tabs.list();\r\n                if (Array.isArray(recheckTabs) && recheckTabs.length > 0) {\r\n                  // Tabs exist (restored from session or created elsewhere), don't create new one\r\n                  setHasInitialized(true);\r\n                  return;\r\n                }\r\n              } catch {\r\n                // Ignore errors, proceed to create tab\r\n              }\r\n\r\n              // Still no tabs after waiting, create one\r\n              isCreatingTabRef.current = true;\r\n              setHasInitialized(true);\r\n\r\n              try {\r\n                // Ensure IPC is ready\r\n                if (!window.ipc || typeof (window.ipc as any).invoke !== 'function') {\r\n                  await new Promise(resolve => setTimeout(resolve, 200));\r\n                }\r\n\r\n                const result = await ipc.tabs.create('about:blank');\r\n                if (result && result.id) {\r\n                  if (IS_DEV) {\r\n                    console.log('[TabStrip] Initial tab created after wait:', result.id);\r\n                  }\r\n                }\r\n              } catch (error) {\r\n                if (IS_DEV) {\r\n                  console.error('[TabStrip] Failed to create initial tab:', error);\r\n                }\r\n              } finally {\r\n                setTimeout(() => {\r\n                  isCreatingTabRef.current = false;\r\n                }, 1000);\r\n              }\r\n            }, 300); // Wait 300ms to allow session restoration\r\n          } else {\r\n            // No tabs and we've already initialized - just clear state\r\n            if (isMounted) {\r\n              setTabs([]);\r\n              setAllTabs([]);\r\n              setActiveTab(null);\r\n              if (!hasInitialized) {\r\n                setHasInitialized(true);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } catch {\r\n        // Silently handle errors - don't auto-create tab on error\r\n        if (isInitialLoad && isMounted && !hasInitialized) {\r\n          setHasInitialized(true);\r\n        }\r\n      }\r\n    };\r\n\r\n    // Listen for session restoration state (only once)\r\n    const handleRestoring = (restoring: boolean) => {\r\n      if (isMounted) {\r\n        isRestoringRef.current = restoring;\r\n      }\r\n    };\r\n\r\n    const unsubscribeRestoring = ipcEvents.on<boolean>('session:restoring', handleRestoring);\r\n\r\n    // Listen for restore tab messages (only once)\r\n    const handleRestoreTab = async (tabState: any) => {\r\n      if (!isMounted || isCreatingTabRef.current) return;\r\n\r\n      isCreatingTabRef.current = true;\r\n      try {\r\n        await ipc.tabs.create({\r\n          url: tabState.url || 'about:blank',\r\n          containerId: tabState.containerId,\r\n          mode: tabState.mode,\r\n          profileId: tabState.profileId,\r\n          tabId: tabState.id,\r\n          activate: Boolean(tabState.activate),\r\n          createdAt: tabState.createdAt,\r\n          lastActiveAt: tabState.lastActiveAt,\r\n          sessionId: tabState.sessionId,\r\n          fromSessionRestore: true,\r\n        });\r\n      } catch (error) {\r\n        if (IS_DEV) {\r\n          console.error('Failed to restore tab from session:', error);\r\n        }\r\n      } finally {\r\n        // Reset flag after a delay\r\n        setTimeout(() => {\r\n          isCreatingTabRef.current = false;\r\n        }, 500);\r\n      }\r\n    };\r\n\r\n    const unsubscribeRestoreTab = ipcEvents.on<any>('session:restore-tab', handleRestoreTab);\r\n\r\n    // Initial load only - don't auto-create tabs on subsequent updates\r\n    // Add a small delay to ensure session restoration has a chance to complete first\r\n    const initTimer = setTimeout(() => {\r\n      loadTabs(true);\r\n    }, 100);\r\n\r\n    // Listen for tab updates via IPC events (more reliable)\r\n    // IPC events are the source of truth - always sync with them\r\n    // OPTIMIZED: Only update if data actually changed to reduce re-renders\r\n    const handleTabUpdate = (tabList: any[]) => {\r\n      // Don't process updates if component is unmounted or invalid data\r\n      if (!isMounted) {\r\n        return;\r\n      }\r\n\r\n      if (!Array.isArray(tabList)) {\r\n        if (IS_DEV) {\r\n          console.warn('[TabStrip] handleTabUpdate: Invalid data', { tabList });\r\n        }\r\n        return;\r\n      }\r\n\r\n      const mappedTabs = tabList.map((t: any) => {\r\n        // Get appMode from store if available, otherwise use current mode\r\n        const storeTab = storeTabs.find(st => st.id === t.id);\r\n        const appMode = storeTab?.appMode || currentMode;\r\n\r\n        return {\r\n          id: t.id,\r\n          title: t.title || 'New Tab',\r\n          url: t.url || 'about:blank',\r\n          active: t.active || false,\r\n          containerId: t.containerId,\r\n          containerName: t.containerName,\r\n          containerColor: t.containerColor,\r\n          mode: t.mode,\r\n          appMode: appMode,\r\n          createdAt: t.createdAt,\r\n          lastActiveAt: t.lastActiveAt,\r\n          sessionId: t.sessionId,\r\n          profileId: t.profileId,\r\n          sleeping: Boolean(t.sleeping),\r\n        };\r\n      });\r\n\r\n      // OPTIMIZED: Check if tabs actually changed before updating\r\n      const newTabIds = mappedTabs\r\n        .map(t => t.id)\r\n        .sort()\r\n        .join(',');\r\n      const currentTabIds = previousTabIdsRef.current;\r\n      const activeTabFromIPC = mappedTabs.find(t => t.active);\r\n      const activeTabIdFromIPC = activeTabFromIPC?.id || null;\r\n\r\n      // Skip update if nothing changed (prevents unnecessary re-renders)\r\n      if (newTabIds === currentTabIds && activeTabIdFromIPC === currentActiveIdRef.current) {\r\n        // Still update refs in case of subtle changes\r\n        tabsRef.current = mappedTabs;\r\n        return;\r\n      }\r\n\r\n      // Update peek preview if visible\r\n      const peekState = usePeekPreviewStore.getState();\r\n      if (peekState.visible && peekState.tab) {\r\n        const updatedPeek = mappedTabs.find(t => t.id === peekState.tab?.id);\r\n        if (updatedPeek) {\r\n          usePeekPreviewStore.getState().sync(updatedPeek);\r\n        }\r\n      }\r\n\r\n      // Update tabs array (only if changed)\r\n      setTabs(mappedTabs);\r\n      tabsRef.current = mappedTabs;\r\n      setAllTabs(mapTabsForStore(mappedTabs));\r\n      previousTabIdsRef.current = newTabIds;\r\n\r\n      // Update active tab only if changed\r\n      if (activeTabIdFromIPC && activeTabIdFromIPC !== currentActiveIdRef.current) {\r\n        setActiveTab(activeTabIdFromIPC);\r\n        currentActiveIdRef.current = activeTabIdFromIPC;\r\n      } else if (mappedTabs.length > 0 && !activeTabIdFromIPC) {\r\n        // No active tab in IPC, but tabs exist - activate first one\r\n        const firstTabId = mappedTabs[0].id;\r\n        if (firstTabId !== currentActiveIdRef.current) {\r\n          setActiveTab(firstTabId);\r\n          currentActiveIdRef.current = firstTabId;\r\n          // Also tell main process to activate it\r\n          if (IS_ELECTRON) {\r\n            ipc.tabs.activate({ id: firstTabId }).catch(() => {});\r\n          }\r\n        }\r\n      } else if (mappedTabs.length === 0 && currentActiveIdRef.current !== null) {\r\n        // No tabs at all\r\n        setActiveTab(null);\r\n        currentActiveIdRef.current = null;\r\n      }\r\n    };\r\n\r\n    // Subscribe to IPC events via the event bus (only once)\r\n    const unsubscribe = ipcEvents.on('tabs:updated', handleTabUpdate);\r\n\r\n    // Fallback polling if events don't work - reduced frequency to improve performance\r\n    // Only poll to sync state, don't auto-create tabs\r\n    // Note: We can poll even when creating tabs - loadTabs won't create duplicate tabs\r\n    const pollInterval = setInterval(() => {\r\n      if (isMounted && ipcReady && hasInitialized) {\r\n        // Only skip if actively creating to avoid race conditions during creation\r\n        if (!isCreatingTabRef.current && !activationInFlightRef.current) {\r\n          loadTabs(false).catch(() => {}); // Silent error handling\r\n        }\r\n      }\r\n    }, 5000); // Poll every 5 seconds (reduced from 2s to improve performance)\r\n\r\n    return () => {\r\n      isMounted = false;\r\n      unsubscribe();\r\n      unsubscribeRestoring();\r\n      unsubscribeRestoreTab();\r\n      clearInterval(pollInterval);\r\n      clearTimeout(initTimer);\r\n    };\r\n  }, []); // Empty deps - only run on mount, IPC events handle all updates\r\n\r\n  const addTab = async () => {\r\n    if (!IS_ELECTRON) {\r\n      const baseTabs = (tabsRef.current.length > 0 ? tabsRef.current : tabs).map(t => ({\r\n        ...t,\r\n        active: false,\r\n      }));\r\n      const newTab: Tab = {\r\n        id: `local-${Date.now()}`,\r\n        title: 'New Tab',\r\n        url: 'about:blank',\r\n        active: true,\r\n        mode: 'normal',\r\n      };\r\n      const updated = [...baseTabs, newTab];\r\n      setTabs(updated);\r\n      tabsRef.current = updated;\r\n      previousTabIdsRef.current = updated\r\n        .map(t => t.id)\r\n        .sort()\r\n        .join(',');\r\n      setAllTabs(mapTabsForStore(updated));\r\n      setActiveTab(newTab.id);\r\n      currentActiveIdRef.current = newTab.id;\r\n      ipcEvents.emit('tabs:updated', mapTabsForStore(updated));\r\n      return;\r\n    }\r\n\r\n    // Prevent multiple simultaneous tab creations (debounce)\r\n    if (isCreatingTabRef.current) {\r\n      if (IS_DEV) {\r\n        console.log('[TabStrip] Tab creation already in progress, skipping');\r\n      }\r\n      return;\r\n    }\r\n\r\n    isCreatingTabRef.current = true;\r\n    try {\r\n      // Ensure IPC is ready - retry a few times\r\n      let ipcReady = false;\r\n      for (let i = 0; i < 3; i++) {\r\n        if (window.ipc && typeof (window.ipc as any).invoke === 'function') {\r\n          ipcReady = true;\r\n          break;\r\n        }\r\n        await new Promise(resolve => setTimeout(resolve, 200));\r\n      }\r\n\r\n      if (!ipcReady) {\r\n        if (IS_DEV) {\r\n          console.warn(\r\n            '[TabStrip] IPC not ready after retries, but attempting tab creation anyway'\r\n          );\r\n        }\r\n        // Don't abort - try to create anyway, might work\r\n      }\r\n\r\n      const result = await ipc.tabs.create({\r\n        url: 'about:blank',\r\n        containerId: activeContainerId || undefined,\r\n      });\r\n      if (result && result.id) {\r\n        // Tag the new tab with current app mode\r\n        const tabId = typeof result === 'object' && 'id' in result ? result.id : result;\r\n        updateTab(tabId, { appMode: currentMode });\r\n\r\n        // Tab created successfully - IPC event will update the UI\r\n        if (IS_DEV) {\r\n          console.log('[TabStrip] Tab created via addTab:', tabId);\r\n        }\r\n        // Force a refresh to ensure UI updates even if IPC event is delayed\r\n        setTimeout(async () => {\r\n          try {\r\n            await refreshTabsFromMain();\r\n          } catch {\r\n            // Silent fail - IPC event should handle it\r\n          }\r\n        }, 100);\r\n      } else {\r\n        if (IS_DEV) {\r\n          console.warn('[TabStrip] Tab creation returned no ID:', result);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      if (IS_DEV) {\r\n        console.error('Failed to create tab:', error);\r\n      }\r\n    } finally {\r\n      // Reset flag quickly - IPC events will handle the update\r\n      // Don't wait too long or we'll block legitimate updates\r\n      setTimeout(() => {\r\n        isCreatingTabRef.current = false;\r\n      }, 200); // Increased slightly to prevent rapid-fire clicks\r\n    }\r\n  };\r\n\r\n  const handleReopenClosedTab = useCallback(async (entry?: ClosedTab) => {\r\n    await reopenClosedTab(entry);\r\n  }, []);\r\n\r\n  const handleApplyCluster = useCallback(\r\n    (clusterId: string) => {\r\n      const cluster = predictedClusters.find(c => c.id === clusterId);\r\n      if (!cluster) return;\r\n      if (!cluster.tabIds.length) return;\r\n\r\n      const currentTabs = tabsRef.current;\r\n      const matching = currentTabs.filter(tab => cluster.tabIds.includes(tab.id));\r\n      if (matching.length <= 1) return;\r\n\r\n      let etld = 'workspace';\r\n      try {\r\n        if (matching[0]?.url) {\r\n          etld = new URL(matching[0].url).hostname.replace(/^www\\./, '') || 'workspace';\r\n        }\r\n      } catch {\r\n        etld = 'workspace';\r\n      }\r\n\r\n      const label = matching.length >= 3 ? `${etld} cluster` : cluster.label;\r\n\r\n      void ipc.tabs\r\n        .create({\r\n          url: 'about:blank',\r\n          containerId: etld,\r\n          activate: true,\r\n        })\r\n        .then(async (result: any) => {\r\n          if (!result?.id) return;\r\n          for (const tab of matching) {\r\n            try {\r\n              await ipc.tabs.moveToWorkspace({ tabId: tab.id, workspaceId: result.id, label });\r\n            } catch (error) {\r\n              if (IS_DEV) {\r\n                console.warn('[TabStrip] Failed to regroup tab', error);\r\n              }\r\n            }\r\n          }\r\n          setTimeout(() => {\r\n            void useTabGraphStore.getState().refresh();\r\n          }, 300);\r\n          fetchPredictiveSuggestionsRef.current?.({ force: true });\r\n        });\r\n    },\r\n    [predictedClusters]\r\n  );\r\n\r\n  const handlePrefetchOpen = useCallback(\r\n    (entry: { tabId: string; url: string; reason: string; confidence?: number }) => {\r\n      if (!entry?.url) return;\r\n      void ipc.tabs.create({ url: entry.url, activate: true }).then(() => {\r\n        fetchPredictiveSuggestionsRef.current?.({ force: true });\r\n      });\r\n    },\r\n    []\r\n  );\r\n\r\n  // Ensure active tab stays visible (only when activeId changes)\r\n  useEffect(() => {\r\n    if (!activeId || !stripRef.current) return;\r\n    // Use requestAnimationFrame to ensure DOM is updated\r\n    requestAnimationFrame(() => {\r\n      try {\r\n        const el = stripRef.current?.querySelector(\r\n          `[data-tab=\"${CSS.escape(activeId)}\"]`\r\n        ) as HTMLElement;\r\n        if (el) {\r\n          el.scrollIntoView({ block: 'nearest', inline: 'nearest', behavior: 'smooth' });\r\n        }\r\n      } catch {}\r\n    });\r\n  }, [activeId]); // Only depend on activeId, not tabs array\r\n\r\n  // Keyboard navigation (Left/Right/Home/End)\r\n  // Use refs to access current tabs/activeId without causing re-renders\r\n  const activeIdRef = useRef(activeId);\r\n\r\n  useEffect(() => {\r\n    tabsRef.current = tabs;\r\n    activeIdRef.current = activeId;\r\n  }, [tabs, activeId]);\r\n\r\n  useEffect(() => {\r\n    if (!stripRef.current || !activeId) {\r\n      return;\r\n    }\r\n    // Use requestAnimationFrame to ensure DOM is updated\r\n    requestAnimationFrame(() => {\r\n      const target = stripRef.current?.querySelector<HTMLElement>(\r\n        `[data-tab=\"${CSS.escape(activeId)}\"]`\r\n      );\r\n      if (target) {\r\n        target.scrollIntoView({ block: 'nearest', inline: 'nearest', behavior: 'auto' });\r\n      }\r\n    });\r\n  }, [activeId, tabs.length]);\r\n\r\n  useEffect(() => {\r\n    if (!stripRef.current || !activeId) return;\r\n    const target = stripRef.current.querySelector<HTMLElement>(\r\n      `[data-tab=\"${CSS.escape(activeId)}\"]`\r\n    );\r\n    if (target && document.activeElement !== target) {\r\n      target.focus({ preventScroll: true });\r\n    }\r\n  }, [activeId, tabs.length]);\r\n\r\n  const handleKeyNavigation = useCallback(\r\n    (event: React.KeyboardEvent<HTMLDivElement>) => {\r\n      if (!['ArrowLeft', 'ArrowRight', 'Home', 'End'].includes(event.key)) {\r\n        return;\r\n      }\r\n\r\n      // Use refs to get current state without causing re-renders\r\n      const currentTabs = tabsRef.current.length > 0 ? tabsRef.current : tabs;\r\n      const currentActive = activeIdRef.current || activeId;\r\n      const currentIndex = currentTabs.findIndex(t => t.id === currentActive);\r\n\r\n      if (currentIndex === -1 || currentTabs.length === 0) {\r\n        return;\r\n      }\r\n\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n\r\n      let nextIndex = currentIndex;\r\n      switch (event.key) {\r\n        case 'Home':\r\n          nextIndex = 0;\r\n          break;\r\n        case 'End':\r\n          nextIndex = currentTabs.length - 1;\r\n          break;\r\n        case 'ArrowLeft':\r\n          nextIndex = (currentIndex - 1 + currentTabs.length) % currentTabs.length;\r\n          break;\r\n        case 'ArrowRight':\r\n          nextIndex = (currentIndex + 1) % currentTabs.length;\r\n          break;\r\n      }\r\n\r\n      const nextTab = currentTabs[nextIndex];\r\n      if (nextTab) {\r\n        void activateTab(nextTab.id);\r\n      }\r\n    },\r\n    [tabs, activeId, activateTab]\r\n  );\r\n\r\n  useEffect(() => {\r\n    const handleModifiedShortcuts = (event: KeyboardEvent) => {\r\n      const isMac = navigator.platform.toUpperCase().includes('MAC');\r\n      const modifier = isMac ? event.metaKey : event.ctrlKey;\r\n\r\n      if (!modifier || event.key !== 'Tab') {\r\n        return;\r\n      }\r\n\r\n      const currentTabs = tabsRef.current;\r\n      const currentActiveId = activeIdRef.current;\r\n      if (!currentTabs.length || !currentActiveId) {\r\n        return;\r\n      }\r\n\r\n      event.preventDefault();\r\n      const currentIndex = currentTabs.findIndex(tab => tab.id === currentActiveId);\r\n      if (currentIndex === -1) {\r\n        return;\r\n      }\r\n\r\n      const nextIndex = event.shiftKey\r\n        ? (currentIndex - 1 + currentTabs.length) % currentTabs.length\r\n        : (currentIndex + 1) % currentTabs.length;\r\n\r\n      const nextTab = currentTabs[nextIndex];\r\n      if (nextTab) {\r\n        void activateTab(nextTab.id);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleModifiedShortcuts);\r\n    return () => window.removeEventListener('keydown', handleModifiedShortcuts);\r\n  }, [activateTab]);\r\n\r\n  // Early return if critical data isn't ready\r\n  if (!Array.isArray(safeTabs)) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div\r\n        ref={stripRef}\r\n        role=\"tablist\"\r\n        aria-label=\"Browser tabs\"\r\n        className=\"no-drag flex items-center gap-2 px-3 py-2 bg-[#1A1D28] border-b border-gray-700/30 overflow-x-auto scrollbar-hide relative\"\r\n        style={{ pointerEvents: 'auto', position: 'relative', zIndex: 9999 }}\r\n        onKeyDown={handleKeyNavigation}\r\n        data-onboarding=\"tabstrip\"\r\n        onDragOver={e => {\r\n          // Allow drop for tab reordering (not graph drag)\r\n          if (draggedTabIdRef.current && !e.dataTransfer.types.includes(TAB_GRAPH_DRAG_MIME)) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            e.dataTransfer.dropEffect = 'move';\r\n\r\n            // Calculate drop index based on mouse position\r\n            const rect = stripRef.current?.getBoundingClientRect();\r\n            if (!rect) return;\r\n\r\n            const mouseX = e.clientX - rect.left;\r\n            const tabElements = stripRef.current?.querySelectorAll('[data-tab]');\r\n            if (!tabElements || tabElements.length === 0) return;\r\n\r\n            let dropIndex = tabs.length;\r\n            for (let i = 0; i < tabElements.length; i++) {\r\n              const tabEl = tabElements[i] as HTMLElement;\r\n              const tabRect = tabEl.getBoundingClientRect();\r\n              const relativeX = tabRect.left - rect.left + tabRect.width / 2;\r\n\r\n              if (mouseX < relativeX) {\r\n                dropIndex = i;\r\n                break;\r\n              }\r\n            }\r\n\r\n            dragOverIndexRef.current = dropIndex;\r\n          }\r\n        }}\r\n        onDrop={async e => {\r\n          // Handle tab reordering (not graph drag)\r\n          if (draggedTabIdRef.current && !e.dataTransfer.types.includes(TAB_GRAPH_DRAG_MIME)) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            const tabId = draggedTabIdRef.current;\r\n            const newIndex = dragOverIndexRef.current ?? tabs.length - 1;\r\n\r\n            // Find current index\r\n            const currentIndex = tabs.findIndex(t => t.id === tabId);\r\n            if (currentIndex === -1 || currentIndex === newIndex) {\r\n              draggedTabIdRef.current = null;\r\n              dragOverIndexRef.current = null;\r\n              return;\r\n            }\r\n\r\n            // Optimistically update UI\r\n            const newTabs = [...tabs];\r\n            const [movedTab] = newTabs.splice(currentIndex, 1);\r\n            newTabs.splice(newIndex, 0, movedTab);\r\n            setTabs(newTabs);\r\n            tabsRef.current = newTabs;\r\n            setAllTabs(mapTabsForStore(newTabs));\r\n\r\n            // Call IPC to reorder\r\n            try {\r\n              const result = await ipc.tabs.reorder(tabId, newIndex);\r\n              if (!result.success) {\r\n                // Revert on failure\r\n                setTabs(tabs);\r\n                tabsRef.current = tabs;\r\n                setAllTabs(mapTabsForStore(tabs));\r\n                if (IS_DEV) {\r\n                  console.warn('[TabStrip] Reorder failed:', result.error);\r\n                }\r\n              }\r\n            } catch (error) {\r\n              // Revert on error\r\n              setTabs(tabs);\r\n              tabsRef.current = tabs;\r\n              setAllTabs(mapTabsForStore(tabs));\r\n              if (IS_DEV) {\r\n                console.error('[TabStrip] Reorder error:', error);\r\n              }\r\n            }\r\n\r\n            draggedTabIdRef.current = null;\r\n            dragOverIndexRef.current = null;\r\n          }\r\n        }}\r\n        onDragLeave={e => {\r\n          // Clear drag state when leaving tabstrip\r\n          if (!stripRef.current?.contains(e.relatedTarget as Node)) {\r\n            dragOverIndexRef.current = null;\r\n          }\r\n        }}\r\n      >\r\n        <PredictivePrefetchHint entry={prefetchEntries[0] ?? null} onOpen={handlePrefetchOpen} />\r\n        <PredictiveClusterChip\r\n          clusters={predictedClusters}\r\n          onApply={handleApplyCluster}\r\n          summary={predictionSummary}\r\n        />\r\n        <div className=\"flex items-center gap-2 min-w-0 flex-1\" style={{ pointerEvents: 'auto' }}>\r\n          <AnimatePresence mode=\"popLayout\">\r\n            {tabElements.length > 0 ? tabElements : null}\r\n          </AnimatePresence>\r\n\r\n          {/* Container Selector & New Tab Button */}\r\n          <div className=\"flex items-center gap-2 flex-shrink-0\">\r\n            <motion.button\r\n              type=\"button\"\r\n              onClick={e => {\r\n                stopEventPropagation(e);\r\n                setGroupsOverlayOpen(true);\r\n              }}\r\n              onMouseDown={e => {\r\n                stopEventPropagation(e);\r\n              }}\r\n              onDragOver={e => {\r\n                if (!draggedTabIdRef.current) return;\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                setGroupDragTarget(NEW_GROUP_DROP_ID);\r\n              }}\r\n              onDragLeave={() => {\r\n                if (groupDragTarget === NEW_GROUP_DROP_ID) {\r\n                  setGroupDragTarget(null);\r\n                }\r\n              }}\r\n              onDrop={e => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                handleDropToNewGroup();\r\n              }}\r\n              className={`hidden lg:flex items-center gap-2 px-3 py-1.5 rounded-lg border text-sm transition-colors ${\r\n                groupDragTarget === NEW_GROUP_DROP_ID\r\n                  ? 'border-blue-500/70 text-blue-200 bg-blue-500/10'\r\n                  : 'border-gray-700/40 text-gray-300 hover:bg-gray-800/50'\r\n              }`}\r\n            >\r\n              <FolderPlus size={14} />\r\n              Group\r\n            </motion.button>\r\n            <div className=\"hidden lg:block\">\r\n              <ContainerQuickSelector compact showLabel={false} />\r\n            </div>\r\n            <DropdownMenu>\r\n              <DropdownMenuTrigger asChild>\r\n                <motion.button\r\n                  type=\"button\"\r\n                  whileHover={{ scale: 1.05 }}\r\n                  whileTap={{ scale: 0.95 }}\r\n                  disabled={recentlyClosed.length === 0}\r\n                  className={`\r\n                    p-2 rounded-lg border transition\r\n                    ${recentlyClosed.length === 0 ? 'border-transparent text-gray-600 cursor-not-allowed' : 'border-gray-700/40 hover:bg-gray-800/50 text-gray-300 hover:text-gray-100'}\r\n                  `}\r\n                  title={\r\n                    recentlyClosed.length === 0\r\n                      ? 'No recently closed tabs'\r\n                      : 'Reopen closed tab (Ctrl+Shift+T / T)'\r\n                  }\r\n                >\r\n                  <RotateCcw size={16} />\r\n                </motion.button>\r\n              </DropdownMenuTrigger>\r\n              <DropdownMenuContent align=\"end\" className=\"w-72\">\r\n                <DropdownMenuLabel>Recently closed</DropdownMenuLabel>\r\n                <DropdownMenuSeparator />\r\n                {recentlyClosed.length === 0 ? (\r\n                  <div className=\"px-3 py-2 text-xs text-slate-500\">No tabs to reopen</div>\r\n                ) : (\r\n                  recentlyClosed.map(entry => {\r\n                    let hostname = 'about:blank';\r\n                    if (entry.url) {\r\n                      try {\r\n                        hostname = new URL(entry.url).hostname;\r\n                      } catch {\r\n                        hostname = entry.url;\r\n                      }\r\n                    }\r\n                    return (\r\n                      <DropdownMenuItem\r\n                        key={entry.closedId}\r\n                        className=\"flex flex-col items-start gap-1 py-2\"\r\n                        onClick={() => handleReopenClosedTab(entry)}\r\n                      >\r\n                        <span className=\"text-sm text-slate-100\">\r\n                          {entry.title || entry.url || 'Untitled tab'}\r\n                        </span>\r\n                        <span className=\"text-[11px] text-slate-500\">\r\n                          {hostname}  {new Date(entry.closedAt).toLocaleTimeString()}\r\n                        </span>\r\n                      </DropdownMenuItem>\r\n                    );\r\n                  })\r\n                )}\r\n                <DropdownMenuSeparator />\r\n                <DropdownMenuItem\r\n                  disabled={recentlyClosed.length === 0}\r\n                  onClick={() => handleReopenClosedTab()}\r\n                  className=\"gap-2\"\r\n                >\r\n                  <RotateCcw size={14} />\r\n                  Reopen last tab\r\n                </DropdownMenuItem>\r\n              </DropdownMenuContent>\r\n            </DropdownMenu>\r\n            <motion.button\r\n              onClick={e => {\r\n                stopEventPropagation(e);\r\n                addTab();\r\n              }}\r\n              onMouseDown={e => {\r\n                stopEventPropagation(e);\r\n              }}\r\n              onKeyDown={e => {\r\n                if (e.key === 'Enter' || e.key === ' ') {\r\n                  e.preventDefault();\r\n                  stopEventPropagation(e);\r\n                  addTab();\r\n                }\r\n              }}\r\n              aria-label=\"New tab\"\r\n              className=\"p-2 rounded-lg hover:bg-gray-800/50 border border-transparent hover:border-gray-700/30 text-gray-400 hover:text-gray-200 transition-all focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\"\r\n              style={{ zIndex: 10011, isolation: 'isolate' }}\r\n              whileHover={{ scale: 1.05 }}\r\n              whileTap={{ scale: 0.95 }}\r\n              title=\"New Tab (Ctrl+T / T)\"\r\n            >\r\n              <Plus size={18} />\r\n            </motion.button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Context Menu */}\r\n        {contextMenu && (\r\n          <Portal>\r\n            <TabContextMenu\r\n              tabId={contextMenu.tabId}\r\n              url={contextMenu.url}\r\n              containerId={\r\n                contextMenu.containerId ?? tabs.find(t => t.id === contextMenu.tabId)?.containerId\r\n              }\r\n              containerName={\r\n                contextMenu.containerName ??\r\n                tabs.find(t => t.id === contextMenu.tabId)?.containerName\r\n              }\r\n              containerColor={\r\n                contextMenu.containerColor ??\r\n                tabs.find(t => t.id === contextMenu.tabId)?.containerColor\r\n              }\r\n              mode={contextMenu.mode ?? tabs.find(t => t.id === contextMenu.tabId)?.mode}\r\n              sleeping={\r\n                contextMenu.sleeping ?? tabs.find(t => t.id === contextMenu.tabId)?.sleeping\r\n              }\r\n              onClose={() => setContextMenu(null)}\r\n            />\r\n          </Portal>\r\n        )}\r\n      </div>\r\n\r\n      {/* Tab Groups Overlay */}\r\n      <TabGroupsOverlay open={groupsOverlayOpen} onClose={() => setGroupsOverlayOpen(false)} />\r\n\r\n      {/* HolographicPreviewOverlay removed - unused component */}\r\n    </>\r\n  );\r\n}\r\n\r\n// Export with conditional rendering wrapper\r\nexport default function TabStripWrapper() {\r\n  const { mode: currentMode } = useAppStore();\r\n\r\n  // Hide tab bar in Research/Trade modes (looks like bug - duplicate Welcome tab)\r\n  if (currentMode === 'Research' || currentMode === 'Trade') {\r\n    return null;\r\n  }\r\n\r\n  return <TabStrip />;\r\n}\r\n"],"file":"TabStrip-DwWt0XPA.js"}