{"version":3,"mappings":";kwDAsDO,MAAMA,GAAmBC,GAAsB,CAACC,EAAKC,KAAS,CACnE,QAAS,GACT,QAAS,GACT,MAAO,KACP,KAAM,KACN,aAAc,KACd,MAAM,MAAO,CACNA,EAAA,EAAM,SACTD,EAAI,CAAE,QAAS,GAAM,EAEvB,MAAMC,EAAA,EAAM,SACd,EACA,OAAQ,CACND,EAAI,CAAE,QAAS,GAAO,aAAc,KAAM,CAC5C,EACA,MAAM,QAAS,CACTC,EAAA,EAAM,QACRD,EAAI,CAAE,QAAS,GAAO,aAAc,KAAM,GAE1CA,EAAI,CAAE,QAAS,GAAM,EACrB,MAAMC,EAAA,EAAM,UAEhB,EACA,MAAM,SAAU,CACdD,EAAI,CAAE,QAAS,GAAM,MAAO,KAAM,EAClC,GAAI,CACF,MAAME,EAAU,MAAMC,EAAI,MAAM,OAChC,GAAI,CAACD,GAAW,OAAOA,GAAY,SACjC,MAAM,IAAI,MAAM,wBAAwB,EAE1CF,EAAI,CAAE,KAAME,EAAyB,QAAS,GAAO,MAAO,KAAM,CACpE,OAASE,EAAO,CACdJ,EAAI,CAAE,QAAS,GAAO,MAAOI,aAAiB,MAAQA,EAAM,QAAU,OAAOA,CAAK,EAAG,CACvF,CACF,EACA,cAAcC,EAAO,CACnBL,EAAI,CAAE,aAAcK,EAAO,CAC7B,EACA,MAAM,SAASA,EAAO,CACpBL,EAAI,CAAE,QAAS,GAAM,aAAcK,EAAO,EAC1C,MAAMJ,EAAA,EAAM,SACd,CACF,EAAE,ECzFF,SAAwBK,IAAa,CACnC,KAAM,CAACC,EAAOC,CAAQ,EAAIC,WAAS,EAAE,EAC/BC,EAAWC,EAAaC,GAASA,EAAM,QAAQ,EAC/CC,EAAOF,EAAaC,GAASA,EAAM,IAAI,EACvCE,EAAgBJ,EAAWG,EAAK,QAAUE,EAAE,KAAOL,CAAQ,EAAI,KAE/DM,EAAe,MAAOC,GAAwB,CAClD,GAAI,CAACA,EAAY,OAAQ,OAMzB,GAFE,gBAAgB,KAAKA,CAAW,GAAK,+BAA+B,KAAKA,CAAW,EAE3E,CACT,MAAMC,EAAgBD,EAAY,WAAW,MAAM,EAAIA,EAAc,WAAWA,CAAW,GACvFH,EACF,MAAMX,EAAI,KAAK,SAASW,EAAc,GAAII,CAAa,EAEvD,MAAMf,EAAI,KAAK,OAAOe,CAAa,CAEvC,KAAO,CAEL,MAAMC,EAAY,mCAAmC,mBAAmBF,CAAW,CAAC,GAChFH,EACF,MAAMX,EAAI,KAAK,SAASW,EAAc,GAAIK,CAAS,EAEnD,MAAMhB,EAAI,KAAK,OAAOgB,CAAS,CAEnC,CACAX,EAAS,EAAE,CACb,EAEA,aACG,OAAI,UAAU,+HACb,SAAAY,OAAC,OAAI,UAAU,qCACb,UAAAC,MAACC,EAAO,GAAP,CACC,QAAS,CAAE,QAAS,EAAG,MAAO,IAC9B,QAAS,CAAE,QAAS,EAAG,MAAO,GAC9B,UAAU,kHACX,mBAGDD,MAACC,EAAO,EAAP,CACC,QAAS,CAAE,QAAS,EAAG,EAAG,IAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,GAC1B,WAAY,CAAE,MAAO,IACrB,UAAU,kDACX,oCAGDF,OAACE,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,EAAG,IAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,GAC1B,WAAY,CAAE,MAAO,IACrB,UAAU,6BAEV,UAAAD,MAAC,SACC,KAAK,OACL,MAAOd,EACP,SAAUgB,GAAKf,EAASe,EAAE,OAAO,KAAK,EACtC,UAAWA,GAAK,CACVA,EAAE,MAAQ,SACZP,EAAaT,CAAK,CAEtB,EACA,YAAY,+BACZ,UAAU,2LACV,UAAS,KAEXc,MAACC,EAAO,OAAP,CACC,WAAY,CAAE,MAAO,KACrB,SAAU,CAAE,MAAO,IACnB,QAAS,IAAMN,EAAaT,CAAK,EACjC,UAAU,0FACV,MAAM,YAEN,SAAAc,MAACG,GAAA,CAAS,UAAU,oDAAoD,GAC1E,GACF,EACF,EACF,CAEJ,kKC9EO,MAAMC,GAAqBC,GAC/BC,GAAyB,CACxB,sBAAsBA,CAAQ,CAChC,EACA,GACA,CAAE,QAAS,GAAM,SAAU,GAC7B,EAKaC,GAAiBC,GAC3BF,GAAyB,CACxBA,EAAA,CACF,EACA,GACF,EAMO,MAAMG,EAAc,CAApB,cACLC,GAAA,KAAQ,cAAc,GAA+B,EACrDA,GAAA,KAAQ,gBAAgB,GAA4B,EACpDA,GAAA,KAAQ,sBAAsB,GAA2C,EAKzE,eAAeC,EAAYC,EAA2BC,EAIlD,GAAI,CAEFA,EAAQ,SACVD,EAAO,aAAa,UAAWC,EAAQ,QAAQ,KAAK,GAAG,CAAC,EAItDA,EAAQ,OACVD,EAAO,aAAa,QAASC,EAAQ,KAAK,EAIxCA,EAAQ,MACVD,EAAO,aAAa,UAAW,MAAM,EAIvCA,EAAO,aAAa,gBAAiB,KAAK,EAC1CA,EAAO,MAAM,kBAAoB,OACjCA,EAAO,MAAM,QAAU,qBAEvB,KAAK,QAAQ,IAAID,EAAIC,CAAM,EAG3B,MAAME,EAAW,IAAI,eAAe,IAAM,CACxCV,GAAmB,IAAM,CACvB,KAAK,mBAAmBO,EAAIC,CAAM,CACpC,CAAC,CACH,CAAC,EACDE,EAAS,QAAQF,CAAM,EACvB,KAAK,UAAU,IAAID,EAAIG,CAAQ,EAG/B,MAAMC,EAAWC,GAAwB,CACnCA,EAAM,SAAWJ,EAAO,eAC1B,KAAK,oBAAoBD,EAAIK,CAAK,CAEtC,EACA,OAAO,iBAAiB,UAAWD,CAAO,EAC1C,KAAK,gBAAgB,IAAIJ,EAAII,CAAO,CACtC,CAKQ,mBAAmBJ,EAAYC,EAA2B,CAEhE,sBAAsB,IAAM,CAC1B,MAAMK,EAAOL,EAAO,wBAEpB,OAAO,cAAc,IAAI,YAAY,gBAAiB,CACpD,OAAQ,CAAE,GAAAD,EAAI,KAAAM,CAAA,CAAK,CACpB,CAAC,CACJ,CAAC,CACH,CAKQ,oBAAoBN,EAAYK,EAAqB,CAE3D,MAAME,EAAiB,CAAC,GAAG,GACvBA,EAAe,SAAS,GAAG,GAAKA,EAAe,SAASF,EAAM,MAAM,IACtE,OAAO,cAAc,IAAI,YAAY,iBAAkB,CACrD,OAAQ,CAAE,GAAAL,EAAI,KAAMK,EAAM,KAAM,OAAQA,EAAM,OAAO,CACtD,CAAC,CAEN,CAKA,iBAAiBL,EAAY,CAE3B,GADe,KAAK,QAAQ,IAAIA,CAAE,EACtB,CACV,MAAMG,EAAW,KAAK,UAAU,IAAIH,CAAE,EAClCG,IACFA,EAAS,aACT,KAAK,UAAU,OAAOH,CAAE,GAG1B,MAAMI,EAAU,KAAK,gBAAgB,IAAIJ,CAAE,EACvCI,IACF,OAAO,oBAAoB,UAAWA,CAAO,EAC7C,KAAK,gBAAgB,OAAOJ,CAAE,GAGhC,KAAK,QAAQ,OAAOA,CAAE,CACxB,CACF,CAKA,UAAUA,EAA2C,CACnD,OAAO,KAAK,QAAQ,IAAIA,CAAE,CAC5B,CAKA,YAAYA,EAAYQ,EAAcC,EAAuB,IAAK,CAChE,MAAMR,EAAS,KAAK,QAAQ,IAAID,CAAE,EAC9BC,GAAQ,eACVA,EAAO,cAAc,YAAYO,EAASC,CAAY,CAE1D,CACF,CAKA,IAAIC,GAA8C,KAE3C,SAASC,IAAkC,CAChD,OAAKD,KACHA,GAAwB,IAAIZ,IAEvBY,EACT,CAKO,MAAME,EAAsB,CAA5B,cACLb,GAAA,KAAQ,cAAiC,EAAC,EAC1CA,GAAA,KAAQ,cAAc,IACtBA,GAAA,KAAQ,UAAyB,MAKjC,YAAYJ,EAAsB,CAChC,KAAK,YAAY,KAAKA,CAAQ,EAC9B,KAAK,gBACP,CAKQ,gBAAiB,CACnB,KAAK,aAAe,KAAK,UAAY,OAIzC,KAAK,QAAU,sBAAsB,IAAM,CACzC,KAAK,QAAU,KACf,KAAK,kBACP,CAAC,EACH,CAKQ,kBAAmB,CACzB,GAAI,KAAK,YAAY,SAAW,EAAG,CACjC,KAAK,YAAc,GACnB,MACF,CAEA,KAAK,YAAc,GACL,KAAK,YAAY,OAAO,EAAG,EAAE,EAErC,QAAQA,GAAY,CACxB,GAAI,CACFA,EAAA,CACF,OAASvB,EAAO,CACd,QAAQ,MAAM,wCAAyCA,CAAK,CAC9D,CACF,CAAC,EAGG,KAAK,YAAY,OAAS,EAC5B,KAAK,iBAEL,KAAK,YAAc,EAEvB,CAKA,QAAS,CACH,KAAK,UAAY,OACnB,qBAAqB,KAAK,OAAO,EACjC,KAAK,QAAU,MAEjB,KAAK,YAAc,GACnB,KAAK,YAAc,EACrB,CACF,CAKA,IAAIyC,GAAiD,KAE9C,SAASC,IAAyC,CACvD,OAAKD,KACHA,GAAmB,IAAID,IAElBC,EACT,CAKO,MAAME,EAAmB,CAAzB,cACLhB,GAAA,KAAQ,cAAqC,GAAI,EAKjD,MAAMiB,EAA2B,CAC/B,MAAMC,EAAY,YAAY,MAC9B,MAAO,IAAM,CACX,MAAMC,EAAW,YAAY,MAAQD,EAC/BE,EAAQ,KAAK,QAAQ,IAAIH,CAAK,GAAK,GACzCG,EAAM,KAAKD,CAAQ,EACfC,EAAM,OAAS,KACjBA,EAAM,QAER,KAAK,QAAQ,IAAIH,EAAOG,CAAK,CAC/B,CACF,CAKA,WAAWH,EAAuB,CAChC,MAAMG,EAAQ,KAAK,QAAQ,IAAIH,CAAK,GAAK,GACzC,OAAIG,EAAM,SAAW,EAAU,EACxBA,EAAM,OAAO,CAACC,EAAGC,IAAMD,EAAIC,EAAG,CAAC,EAAIF,EAAM,MAClD,CAKA,YAA6D,CAC3D,MAAMG,EAAyD,GAC/D,YAAK,QAAQ,QAAQ,CAACH,EAAOH,IAAU,CACrCM,EAAON,CAAK,EAAI,CACd,IAAK,KAAK,WAAWA,CAAK,EAC1B,MAAOG,EAAM,OAEjB,CAAC,EACMG,CACT,CACF,CAKA,IAAIC,GAA6C,KAE1C,SAASC,IAA4C,CAC1D,OAAKD,KACHA,GAAkB,IAAIR,IAEjBQ,EACT,CChSO,SAASE,GAAiBvB,EAAmC,GAAI,CACtE,KAAM,CACJ,SAAAwB,EACA,KAAAC,EAAO,GACP,QAAAC,EACA,SAAAC,EACA,UAAAC,CAAA,EACE5B,EAEE6B,EAAYC,SAAiC,IAAI,EACjDC,EAAWC,UAAQ,IAAMpB,GAAA,EAAmB,EAAE,EAC9CqB,EAAUD,UAAQ,IAAMV,GAAA,EAAyB,EAAE,EAKzDY,YAAU,IAAM,CACd,GAAIV,GAAYK,EAAU,QAAS,CACjC,MAAMM,EAAgB1B,GAAA,EACtB,OAAA0B,EAAc,eAAeX,EAAUK,EAAU,QAAS,CACxD,KAAAJ,EACA,QAASC,GAAW,CAAC,gBAAiB,mBAAmB,EACzD,MAAO,kCACR,EAEM,IAAM,CACXS,EAAc,iBAAiBX,CAAQ,CACzC,CACF,CACF,EAAG,CAACA,EAAUC,EAAMC,CAAO,CAAC,EAK5BQ,YAAU,IAAM,CACd,GAAI,CAACP,EAAU,OAEf,MAAMzB,EAAWC,GAAuB,CACtC,GAAIA,EAAM,OAAO,KAAOqB,EAAU,CAChC,MAAMpB,EAAOD,EAAM,OAAO,KAC1BwB,EAASvB,CAAI,CACf,CACF,EAEA,cAAO,iBAAiB,gBAAiBF,CAAwB,EAC1D,IAAM,CACX,OAAO,oBAAoB,gBAAiBA,CAAwB,CACtE,CACF,EAAG,CAACsB,EAAUG,CAAQ,CAAC,EAKvBO,YAAU,IAAM,CACd,GAAI,CAACN,EAAW,OAEhB,MAAM1B,EAAWC,GAAuB,CAClCA,EAAM,OAAO,KAAOqB,GACtBI,EAAUzB,EAAM,OAAO,IAAI,CAE/B,EAEA,cAAO,iBAAiB,iBAAkBD,CAAwB,EAC3D,IAAM,CACX,OAAO,oBAAoB,iBAAkBA,CAAwB,CACvE,CACF,EAAG,CAACsB,EAAUI,CAAS,CAAC,EAKxB,MAAMQ,EAAcC,cAAa5C,GAAyB,CACxD,MAAM6C,EAAYL,EAAQ,MAAM,aAAa,EAC7CF,EAAS,YAAY,IAAM,CACzBtC,EAAA,EACA6C,EAAA,CACF,CAAC,CACH,EAAG,CAACP,EAAUE,CAAO,CAAC,EAKhBM,EAAeF,cAAY,IAAM,CACrC3C,GAAe,IAAM,CACnB,GAAImC,EAAU,QAAS,CACrB,MAAMzB,EAAOyB,EAAU,QAAQ,wBAC/BF,IAAWvB,CAAI,CACjB,CACF,CAAC,CACH,EAAG,CAACuB,CAAQ,CAAC,EAKbO,mBAAU,KACR,OAAO,iBAAiB,SAAUK,CAAY,EACvC,IAAM,CACX,OAAO,oBAAoB,SAAUA,CAAY,CACnD,GACC,CAACA,CAAY,CAAC,EAEV,CACL,UAAAV,EACA,YAAAO,EACA,WAAY,IAAMH,EAAQ,YAAW,CAEzC,CCpGA,MAAMO,GAAqB,CAAC,QAAS,SAAU,YAAa,UAAW,SAAU,UAAU,EAE3F,SAASC,GAAcC,EAA8B,CACnD,OAAKA,EACEF,GAAmB,KAAKG,GAAUD,EAAI,WAAWC,CAAM,CAAC,EAD9C,EAEnB,CAEO,SAASC,GAAkB,CAAE,IAAAC,EAAK,cAAAC,GAAyC,CAChF,MAAMC,EAAejB,SAA8B,IAAI,EAEjDD,EAAYC,SAAiC,IAAI,EACjDkB,EAAaC,GAAA,EACbC,EAAUC,GAAA,EACVC,EAAWC,GAAiB3E,GAASA,EAAM,UAAY,MAAM,EAC7D,CAAC4E,EAASC,CAAU,EAAIhF,WAAS,EAAK,EACtC,CAACiF,EAAeC,CAAgB,EAAIlF,WAAwB,IAAI,EAChE,CAACmF,EAAiBC,CAAkB,EAAIpF,WAAS,EAAK,EAGtBgD,GAAiB,CACrD,SAAUsB,GAAK,GACf,KAAM,CAACA,GAAK,OACZ,QAASe,GAAoB,MAAM,GAAG,EACtC,SAAWC,GAAU,CAEnBtE,GAAmB,IAAM,CAEzB,CAAC,CACH,EACD,EAID,MAAMuE,EAAY9B,UAAQ,IAAM,CAC9B,IAAIU,EAAMG,GAAK,IAGf,GAAI,CAACH,GAAOA,IAAQ,eAAiBD,GAAcC,CAAG,EACpD,OAAO,KAIT,GAAI,CAACA,EAAI,WAAW,SAAS,GAAK,CAACA,EAAI,WAAW,UAAU,EAAG,CAG7D,MAAMzD,EAAY8E,GAChBrB,EACA,OACAU,IAAa,OAASA,EAAW,OACjC,IAEF,OAAInE,GAIG,iCAAiC,mBAAmByD,CAAG,CAAC,EACjE,CAEA,OAAOA,CACT,EAAG,CAACG,GAAK,IAAKO,CAAQ,CAAC,EAQvBlB,YAAU,IAAM,CACd,GAAI,GAACc,GAAc,CAACc,GAAaZ,GAQjC,MAAO,IAAM,CAGXK,EAAW,EAAK,EAChBE,EAAiB,IAAI,EACrBE,EAAmB,EAAK,CAC1B,CACF,EAAG,CAACX,EAAYE,EAASY,CAAS,CAAC,EAGnC5B,YAAU,IAAM,CACd,GAAIc,GAAc,CAACc,GAAa,CAACjC,EAAU,QACzC,OAGF,MAAM9B,EAAS8B,EAAU,QACzB,IAAImC,EAAY,GAChB,MAAMC,EAAqB,IAC3B,IAAIC,EAAkD,KAEtD,MAAMC,EAAa,IAAM,CACvB,GAAKH,IACDE,IACF,aAAaA,CAAS,EACtBA,EAAY,MAEdX,EAAW,EAAK,EAChBE,EAAiB,IAAI,EACjB,EAAC5B,EAAU,SAKf,GAAI,CACUA,EAAU,QAAQ,iBACpB,MACV8B,EAAmB,EAAK,CAC1B,MAAgB,CAQdA,EAAmB,EAAK,CAC1B,CACF,EAEMS,EAAejE,GAA8B,CACjD,GAAI,CAAC6D,EAAW,OACZE,IACF,aAAaA,CAAS,EACtBA,EAAY,MAEdX,EAAW,EAAK,EAKhB,MAAMc,EAAelE,aAAiB,YAAaA,EAAM,SAAW,GAC9DmE,GAAcnE,EAAM,OAIpBoE,GACHF,IACEA,EAAa,cAAc,SAAS,iBAAiB,GACpDA,EAAa,cAAc,SAAS,iBAAiB,GACrDA,EAAa,cAAc,SAAS,oBAAoB,GACxDA,EAAa,cAAc,SAAS,QAAQ,GAC3CA,EAAa,cAAc,SAAS,OAAO,GAC1CA,EAAa,cAAc,SAAS,SAAS,IAClDC,KAAgBvE,GACfA,EAAO,gBAAkB,MACzBA,EAAO,kBAAoB,KAG/B,GAAI+D,GAAa,CAACS,GAAgB,CAChC,MAAMC,EAAWV,EAAU,cAE3B,GAAIU,EAAS,SAAS,gBAAgB,GAAKA,EAAS,SAAS,mBAAmB,EAE9E,GAAI,CACF,MAAMC,EAAS,IAAI,IAAIX,CAAS,EAC1BzF,EAAQoG,EAAO,aAAa,IAAI,GAAG,GAAKA,EAAO,aAAa,IAAI,OAAO,GAAK,GAClF,GAAIpG,EAAO,CAET,MAAMqG,EAAU,iCAAiC,mBAAmBrG,CAAK,CAAC,GAC1E,QAAQ,IAAI,gEAAiEqG,CAAO,EACpF,WAAW,IAAM,CACX7C,EAAU,UACZA,EAAU,QAAQ,IAAM6C,EACxBnB,EAAW,EAAI,EACfE,EAAiB,IAAI,EAEzB,EAAG,GAAG,EACN,MACF,CACF,MAAQ,CAER,CAEJ,CAEIc,IACFZ,EAAmB,EAAI,EACvBF,EAAiB,oDAAoD,IAGrEA,EAAiB,oEAAoE,EACrFE,EAAmB,EAAK,EAE5B,EAGA,OAAAO,EAAY,WAAW,IAAM,CACtBF,IACLT,EAAW,EAAK,EAChBE,EACE,kFAEFS,EAAY,KACd,EAAGD,CAAkB,EAErBlE,EAAO,iBAAiB,OAAQoE,CAAU,EAC1CpE,EAAO,iBAAiB,QAASqE,CAA4B,EAGtD,IAAM,CACXJ,EAAY,GACRE,IACF,aAAaA,CAAS,EACtBA,EAAY,MAEVnE,GAAU8B,EAAU,UACtB9B,EAAO,oBAAoB,OAAQoE,CAAU,EAC7CpE,EAAO,oBAAoB,QAASqE,CAAW,GAGjDb,EAAW,EAAK,EAChBE,EAAiB,IAAI,EACrBE,EAAmB,EAAK,CAC1B,CAoGF,EAAG,CAACX,EAAYE,EAASY,CAAS,CAAC,EAEnC5B,YAAU,IAAM,CAEd,GAAIc,GAAc,CAACnB,EAAU,SAAW,CAACiC,EACvC,OAGF,MAAM/D,EAAS8B,EAAU,QACzB,IAAImC,EAAY,GAChB,MAAMC,EAAqB,IAC3B,IAAIC,EAAkD,KAEtD,MAAMC,EAAa,IAAM,CACvB,GAAKH,IACDE,IACF,aAAaA,CAAS,EACtBA,EAAY,MAEdX,EAAW,EAAK,EAChBE,EAAiB,IAAI,EACjB,EAAC5B,EAAU,SAKf,GAAI,CACUA,EAAU,QAAQ,iBACpB,MACV8B,EAAmB,EAAK,CAC1B,MAAgB,CAQdA,EAAmB,EAAK,CAC1B,CACF,EAEMS,EAAejE,GAA8B,CACjD,GAAI,CAAC6D,EAAW,OACZE,IACF,aAAaA,CAAS,EACtBA,EAAY,MAEdX,EAAW,EAAK,EAKhB,MAAMc,GAAelE,aAAiB,YAAaA,EAAM,SAAW,GAC9DmE,GAAcnE,EAAM,OAIpBoE,EACHF,KACEA,GAAa,cAAc,SAAS,iBAAiB,GACpDA,GAAa,cAAc,SAAS,iBAAiB,GACrDA,GAAa,cAAc,SAAS,oBAAoB,GACxDA,GAAa,cAAc,SAAS,QAAQ,GAC3CA,GAAa,cAAc,SAAS,OAAO,GAC1CA,GAAa,cAAc,SAAS,SAAS,IAClDC,KAAgBvE,GACfA,EAAO,gBAAkB,MACzBA,EAAO,kBAAoB,KAG/B,GAAI+D,GAAa,CAACS,EAAgB,CAChC,MAAMC,EAAWV,EAAU,cAE3B,GAAIU,EAAS,SAAS,gBAAgB,GAAKA,EAAS,SAAS,mBAAmB,EAE9E,GAAI,CACF,MAAMC,EAAS,IAAI,IAAIX,CAAS,EAC1BzF,EAAQoG,EAAO,aAAa,IAAI,GAAG,GAAKA,EAAO,aAAa,IAAI,OAAO,GAAK,GAClF,GAAIpG,EAAO,CAET,MAAMqG,GAAU,iCAAiC,mBAAmBrG,CAAK,CAAC,GAC1E,QAAQ,IAAI,gEAAiEqG,EAAO,EACpF,WAAW,IAAM,CACX7C,EAAU,UACZA,EAAU,QAAQ,IAAM6C,GACxBnB,EAAW,EAAI,EACfE,EAAiB,IAAI,EAEzB,EAAG,GAAG,EACN,MACF,CACF,MAAQ,CAER,CAEJ,CAEIc,GACFZ,EAAmB,EAAI,EACvBF,EAAiB,oDAAoD,IAGrEA,EAAiB,oEAAoE,EACrFE,EAAmB,EAAK,EAE5B,EAGAO,EAAY,WAAW,IAAM,CACtBF,IACLT,EAAW,EAAK,EAChBE,EACE,kFAEFS,EAAY,KACd,EAAGD,CAAkB,EAErBlE,EAAO,iBAAiB,OAAQoE,CAAU,EAC1CpE,EAAO,iBAAiB,QAASqE,CAA4B,EAG7D,MAAMO,GAAmBtF,GAAmB,CACtCA,EAAE,QAAQ,QAAUwD,GAAK,KAC3BmB,EAAY,GACRE,IACF,aAAaA,CAAS,EACtBA,EAAY,MAEVnE,GAAU8B,EAAU,UACtB9B,EAAO,oBAAoB,OAAQoE,CAAU,EAC7CpE,EAAO,oBAAoB,QAASqE,CAAW,EAE/CrE,EAAO,IAAM,eAGnB,GAEA,cAAO,iBAAiB,aAAc4E,CAAc,EAG7C,IAAM,CACXX,EAAY,GACZ,OAAO,oBAAoB,aAAcW,CAAc,EACnDT,IACF,aAAaA,CAAS,EACtBA,EAAY,MAEVnE,GAAU8B,EAAU,UACtB9B,EAAO,oBAAoB,OAAQoE,CAAU,EAC7CpE,EAAO,oBAAoB,QAASqE,CAAW,EAE/CrE,EAAO,IAAM,eAGfwD,EAAW,EAAK,EAChBE,EAAiB,IAAI,EACrBE,EAAmB,EAAK,CAC1B,CACF,EAAG,CAACX,EAAYE,EAASY,EAAWjB,GAAK,EAAE,CAAC,EAE5C,MAAM+B,EAAiBvC,cAAY,IAAM,CACvC,GAAKyB,EACL,GAAI,CACF,OAAO,KAAKA,EAAW,SAAU,qBAAqB,CACxD,OAAS5F,EAAO,CACd,QAAQ,KAAK,qDAAsDA,CAAK,CAC1E,CACF,EAAG,CAAC4F,CAAS,CAAC,EAEd5B,YAAU,IAAM,CACd,GAAI,CAAC4B,EAAW,CACdP,EAAW,EAAK,EAChBE,EAAiB,IAAI,EACrBE,EAAmB,EAAK,EACxB,MACF,CAIA,GAAI,CAAAX,EAGG,CACL,MAAMjD,EAAS8B,EAAU,QACzB,GAAI,CAAC9B,EAAQ,OACTA,EAAO,MAAQ+D,IACjBP,EAAW,EAAI,EACfxD,EAAO,IAAM+D,GAEfH,EAAmB,EAAK,CAC1B,CACF,EAAG,CAACX,EAAYE,EAASY,CAAS,CAAC,EAEnC,MAAMe,EAAUhC,GAAK,GAAK,YAAYA,EAAI,EAAE,GAAK,iBAC3CiC,EAAejC,GAAK,GAAK,OAAOA,EAAI,EAAE,GAAK,OAC3CkC,EAAa,CAAClC,GAAO,CAACA,EAAI,OAI1BmC,EAAcC,EAAYvG,GAASA,EAAM,MAAQ,QAAQ,EACzDwG,EAAeF,IAAgB,UAAY,CAACA,EAElD,OAAKlB,EAwBH5E,OAACE,EAAO,IAAP,CACC,IAAK2D,EACL,UAAW,0BAA0BD,EAAgB,sBAAwB,EAAE,GAE/E,GAAI+B,EACJ,KAAK,WACL,kBAAiBC,EACjB,cAAaC,EACb,QAAS,CAAE,QAAS,IACpB,QAAS,CAAE,QAAS,GACpB,WAAY,CAAE,SAAU,IAAM,KAAM,WACpC,MAAO,CACL,SAAU,WACV,IAAK,EACL,KAAM,EACN,MAAO,EACP,OAAQ,EACR,MAAO,OACP,OAAQ,OACR,OAAQA,EAAa,EAAI,GAK1B,WAAC/B,GAAcc,EACd3E,MAAC,UACC,IAAKgG,GAAM,CACT,GAAIA,IACFtD,EAAU,QAAUsD,EAEhBtC,GAAK,IAAI,CACX,MAAMV,EAAgB1B,GAAA,EACtBlB,GAAmB,IAAM,CACvB4C,EAAc,eAAeU,EAAI,GAAIsC,EAAI,CACvC,KAAM,CAACtC,EAAI,OACX,QAASe,GAAoB,MAAM,GAAG,EACtC,MAAO,mIACR,CACH,CAAC,CACH,CAEJ,EACA,UAAU,yBACV,MAAO,CACL,SAAU,WACV,IAAK,EACL,KAAM,EACN,MAAO,EACP,OAAQ,EACR,MAAO,OACP,OAAQ,OACR,OAAQ,OAER,kBAAmBf,GAAK,OAAS,OAAS,SAC1C,QAAS,sBAEX,IAAKiB,GAAaA,IAAc,cAAgBA,EAAY,iBAC5D,QAASF,GACT,MAAM,mIACN,eAAe,cACf,QAASf,GAAK,OAAS,QAAU,OACjC,cAAeA,GAAK,OAAS,OAAS,MACtC,MAAOA,GAAK,OAAS,cACrB,aACEA,GAAK,MACD,eAAeA,EAAI,KAAK,GACxBiB,EACE,wBAAwB,IAAI,IAAIA,CAAS,EAAE,QAAQ,GACnD,cAER,YAAU,MACV,QAASzE,GAAK,CAEZ,QAAQ,KAAK,0CAA2CA,CAAC,EAEzD,MAAMU,EAASV,EAAE,cACbU,GAAU,CAACA,EAAO,eAAiB,CAACA,EAAO,kBAC7C4D,EAAmB,EAAI,EACvBF,EAAiB,oDAAoD,EAEzE,IAEA,KAEJtE,MAACiG,IACE,SAAA9B,GACCnE,MAACC,EAAO,IAAP,CACC,UAAU,8GACV,QAAS,CAAE,QAAS,GACpB,QAAS,CAAE,QAAS,GACpB,KAAM,CAAE,QAAS,GACjB,KAAK,SACL,YAAU,SACV,aAAW,uBAEX,SAAAF,OAACE,EAAO,IAAP,CACC,QAAS,CAAE,MAAO,IAAM,QAAS,GACjC,QAAS,CAAE,MAAO,EAAG,QAAS,GAC9B,KAAM,CAAE,MAAO,IAAM,QAAS,GAC9B,WAAY,CAAE,SAAU,IACxB,UAAU,qJAEV,UAAAD,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,OAAQ,KACnB,WAAY,CAAE,SAAU,EAAG,OAAQ,IAAU,KAAM,UAEnD,eAACiG,GAAA,CAAQ,UAAU,2BAA2B,cAAY,OAAO,IAEnEnG,OAAC,OAAI,UAAU,8BACb,UAAAA,OAAC,OAAI,UAAU,mBAAmB,qBAAS,IAAI,IAAI4E,CAAS,EAAE,SAAS,KAAC,QACvE,OAAI,UAAU,mCAAmC,kCAAsB,QACvE,OAAI,UAAU,SACb,SAAA3E,MAAC,OAAI,UAAU,0DACb,SAAAA,MAACC,EAAO,IAAP,CACC,UAAU,uEACV,QAAS,CAAE,EAAG,QAAS,MAAO,OAC9B,QAAS,CACP,EAAG,CAAC,QAAS,MAAM,GAErB,WAAY,CACV,SAAU,IACV,OAAQ,IACR,KAAM,YACR,EACF,CACF,EACF,GACF,IACF,GAGN,EAEAD,MAACiG,IACE,SAAA5B,GACCrE,MAACC,EAAO,IAAP,CACC,UAAU,8GACV,QAAS,CAAE,QAAS,GACpB,QAAS,CAAE,QAAS,GACpB,KAAM,CAAE,QAAS,GACjB,KAAK,QACL,YAAU,YAEV,SAAAF,OAACE,EAAO,IAAP,CACC,QAAS,CAAE,MAAO,IAAM,QAAS,GACjC,QAAS,CAAE,MAAO,EAAG,QAAS,GAC9B,KAAM,CAAE,MAAO,GAAK,QAAS,GAC7B,WAAY,CAAE,SAAU,KACxB,UAAU,mJAEV,gBAAC,OAAI,UAAU,cAAe,SAAAoE,EAAc,EAC5CrE,MAAC,OAAI,UAAU,yCACb,SAAAA,MAAC,UACC,KAAK,SACL,QAAS,IAAM,CACb,GAAI2E,GAAad,EAAY,CAE3B,MAAMsC,EAAY7G,EAAa,WAAW,SACtC6G,GACFrH,EAAI,KAAK,OAAO,CAAE,GAAIqH,EAAW,EAAE,MAAM,QAAQ,KAAK,EAExD7B,EAAiB,IAAI,EACrBF,EAAW,EAAI,CACjB,MAAWO,GAAa,CAACd,GAAcnB,EAAU,UAC/C4B,EAAiB,IAAI,EACrBF,EAAW,EAAI,EACf1B,EAAU,QAAQ,IAAMiC,EAE5B,EACA,UAAU,8IACX,mBAGH,IACF,GAGN,QAECsB,GAAA,CACE,UAACpC,GAAcU,GACdvE,MAACC,EAAO,IAAP,CACC,UAAU,8EACV,QAAS,CAAE,QAAS,GACpB,QAAS,CAAE,QAAS,GACpB,KAAM,CAAE,QAAS,GAEjB,SAAAF,OAACE,EAAO,IAAP,CACC,QAAS,CAAE,MAAO,IAAM,QAAS,GACjC,QAAS,CAAE,MAAO,EAAG,QAAS,GAC9B,KAAM,CAAE,MAAO,IAAM,QAAS,GAC9B,WAAY,CAAE,SAAU,KACxB,UAAU,oJAEV,UAAAF,OAAC,OAAI,UAAU,wCACZ,UAAA4E,EAAY,IAAI,IAAIA,CAAS,EAAE,SAAW,YAAY,uBACzD,QACC,KAAE,UAAU,sBAAsB,qKAGnC,EACA3E,MAAC,OAAI,UAAU,yCACb,SAAAD,OAAC,UACC,KAAK,SACL,QAAS0F,EACT,UAAU,wMAEV,UAAAzF,MAACoG,GAAA,CAAa,KAAM,GAAI,EAAE,qBAG9B,IACF,GAGN,IAnNKzB,CAAA,EAzBL3E,MAACC,EAAO,IAAP,CACC,GAAIyF,EACJ,KAAK,WACL,kBAAiBC,EACjB,cAAaC,EACb,UAAU,yCACV,QAAS,CAAE,QAAS,GACpB,QAAS,CAAE,QAAS,GACpB,WAAY,CAAE,SAAU,IACxB,MAAO,CACL,SAAU,WACV,MAAO,EACP,OAAQA,EAAa,EAAI,EACzB,cAAe,QAGhB,SAAAG,QAAgB9G,GAAA,EAAW,QAAMoH,GAAA,CAAS,QAAQ,QAAQ,UAAS,GAAC,GA+N7E,CCxwBO,SAASC,GAA4BC,EAA8B,CACxE,MAAMC,EAAO,wEACb,OAAID,EAEK,yCAEFC,CACT,CAeO,SAASC,GAAyB7F,EAA2B2F,EAA4B,CACzF3F,IAGD2F,GACF3F,EAAO,aAAa,UAAW0F,GAA4B,EAAI,CAAC,EAChE1F,EAAO,aAAa,iBAAkB,aAAa,IAEnDA,EAAO,aAAa,UAAW0F,GAA4B,EAAK,CAAC,EACjE1F,EAAO,aAAa,iBAAkB,4BAA4B,GAMtE,CCzBA,MAAMyC,GAAqB,CAAC,QAAS,SAAU,YAAa,UAAW,SAAU,UAAU,EAE3F,SAASC,GAAcC,EAA8B,CACnD,OAAKA,EACEF,GAAmB,KAAKG,GAAUD,EAAI,WAAWC,CAAM,CAAC,EAD9C,EAEnB,CAKA,SAASkD,GAAgBhD,EAAUO,EAAiC,CAClE,IAAIV,EAAMG,EAAI,IAGd,GAAI,CAACH,GAAOA,IAAQ,eAAiBD,GAAcC,CAAG,EACpD,OAAO,KAIT,GAAI,CAACA,EAAI,WAAW,SAAS,GAAK,CAACA,EAAI,WAAW,UAAU,EAAG,CAG7D,MAAMzD,EAAY8E,GAChBrB,EACA,OACAU,IAAa,OAASA,EAAW,OACjC,IAEF,OAAInE,GAIG,iCAAiC,mBAAmByD,CAAG,CAAC,EACjE,CAEA,OAAOA,CACT,CAEO,SAASoD,GAAiB,CAAE,KAAAnH,EAAM,YAAAoH,GAAsC,CAC7E,MAAM3C,EAAWC,GAAiB3E,GAASA,EAAM,UAAY,MAAM,EAC7DsH,EAAkB3C,GAAiB3E,GAASA,EAAM,OAAO,EACzDgH,EAAcM,EAAgB,mBAAqBA,EAAgB,eACnEhD,EAAaC,GAAA,EAGbgD,EAAanE,SAAuC,IAAI,GAAK,EAG7DK,EAAgBL,SAAOrB,IAAkB,EAC7BqB,SAAOlB,GAAA,CAAiB,EAG1C,MAAMsF,EAAcpE,SAAoB,IAAI,GAAK,EAG3CqE,EAAerE,SAAsC,IAAI,GAAK,EAC9DsE,EAAmBtE,SAA6C,IAAI,GAAK,EACzEuE,EAAwBvE,SAAgC,IAAI,GAAK,EAGjEwE,EAAgBnI,GAAmBgH,GAAiC,CACpEA,GACFc,EAAW,QAAQ,IAAI9H,EAAOgH,CAAE,EAE3BnC,GACHzD,GAAmB,IAAM,CACvB4C,EAAc,QAAQ,eAAehE,EAAOgH,EAAI,CAC9C,KAAM,GACN,QAASO,EACL,CAAC,gBAAiB,cAAe,cAAc,EAC/C9B,GAAoB,MAAM,GAAG,EACjC,MAAO,mIACR,CACH,CAAC,IAGHqC,EAAW,QAAQ,OAAO9H,CAAK,EAE1B6E,GACHb,EAAc,QAAQ,iBAAiBhE,CAAK,EAGlD,EAGA+D,mBAAU,IAAM,CACVc,GAEJrE,EAAK,QAAQkE,GAAO,CAClB,MAAM9C,EAASkG,EAAW,QAAQ,IAAIpD,EAAI,EAAE,EAC5C,GAAI,CAAC9C,EAAQ,OAEb,MAAMwG,EAAYV,GAAgBhD,EAAKO,CAAQ,EACzCoD,EAAazG,EAAO,IAG1B,GAAIwG,GAAaA,IAAcC,GAAcD,IAAc,cAAe,CAExE,MAAME,EAAW5D,EAAI,KAAOkD,GACxBU,GAAYD,IAAe,iBAC7B,QAAQ,IAAI,6DAA8D,CACxE,MAAO3D,EAAI,GACX,OAAQ2D,EACR,OAAQD,EACR,SAAAE,CAAA,CACD,EACD1G,EAAO,IAAMwG,EAEjB,CACF,CAAC,CACH,EAAG,CAAC5H,EAAMyE,EAAU2C,EAAa/C,CAAU,CAAC,EAG5Cd,YAAU,IAAM,CACd,GAAIc,EAAY,OAmDhB,MAAM0D,EAAW,YAjDU,IAAM,CAC/B/H,EAAK,QAAQkE,GAAO,CAClB,MAAM9C,EAASkG,EAAW,QAAQ,IAAIpD,EAAI,EAAE,EAC5C,GAAK9C,EAIL,GAAI,CAOE,EALeA,EAAO,gBAAkB,OAKzBA,EAAO,KAAO,CAACA,EAAO,IAAI,WAAW,QAAQ,EAE9D,WAAW,IAAM,CACf,GAAI,CAEE,CAACA,EAAO,eAAiBA,EAAO,MAClC,QAAQ,KACN,+DACA8C,EAAI,GACJA,EAAI,KAENqD,EAAY,QAAQ,IAAIrD,EAAI,EAAE,EAG9B,OAAO,cACL,IAAI,YAAY,iBAAkB,CAChC,OAAQ,CAAE,MAAOA,EAAI,GAAI,IAAKA,EAAI,IAAI,CACvC,GAGP,MAAQ,CAER,CACF,EAAG,GAAI,EAGPqD,EAAY,QAAQ,OAAOrD,EAAI,EAAE,CAErC,MAAQ,CAER,CACF,CAAC,CACH,EAGiD,GAAI,EAGrD,MAAO,IAAM,CACX,cAAc6D,CAAQ,EAEjB1D,GACHiD,EAAW,QAAQ,QAAQ,CAACU,EAASxI,IAAU,CAC7CgE,EAAc,QAAQ,iBAAiBhE,CAAK,CAC9C,CAAC,EAGH8H,EAAW,QAAQ,QAAQ,CAAClG,EAAQ5B,IAAU,CAEvC4B,EAAe,WACjBA,EAAe,WAChB,OAAQA,EAAe,UAIzB,MAAME,EAAWkG,EAAa,QAAQ,IAAIhI,CAAK,EAC3C8B,IACFA,EAAS,aACTkG,EAAa,QAAQ,OAAOhI,CAAK,GAInC,MAAMyI,EAAeR,EAAiB,QAAQ,IAAIjI,CAAK,EACvD,GAAIyI,GAAgB7G,EAAO,gBAAiB,CAC1C,GAAI,CACFA,EAAO,gBAAgB,oBAAoB,QAAS6G,EAAc,EAAI,CACxE,MAAQ,CAER,CACAR,EAAiB,QAAQ,OAAOjI,CAAK,CACvC,CAGA,MAAM0I,EAAaR,EAAsB,QAAQ,IAAIlI,CAAK,EAC1D,GAAI0I,GAAc9G,EAAO,cAAe,CACtC,GAAI,CACFA,EAAO,cAAc,oBAAoB,WAAY8G,CAAU,EAC/D9G,EAAO,cAAc,oBAAoB,aAAc8G,CAAU,CACnE,MAAQ,CAER,CACAR,EAAsB,QAAQ,OAAOlI,CAAK,CAC5C,CACF,CAAC,CACH,CACF,EAAG,CAACQ,EAAMqE,CAAU,CAAC,QAKlB,OAAI,UAAU,yBACZ,SAAArE,EAAK,IAAIkE,GAAO,CACf,MAAM0D,EAAYV,GAAgBhD,EAAKO,CAAQ,EACzCqD,EAAW5D,EAAI,KAAOkD,EACTG,EAAY,QAAQ,IAAIrD,EAAI,EAAE,EAKjD,MAAMiE,EAAmBP,GAAa,cAChCxG,EAASkG,EAAW,QAAQ,IAAIpD,EAAI,EAAE,EAM5C,OAJE9C,GAAUA,EAAO,MAAQ+G,GAAoBA,IAAqB,eAI9CL,IACpB,QAAQ,IAAI,yCAA0C,CACpD,MAAO5D,EAAI,GACX,OAAQ9C,EAAO,IACf,OAAQ+G,EACR,SAAAL,CAAA,CACD,EAED,sBAAsB,IAAM,CAC1B,MAAMM,EAAgBd,EAAW,QAAQ,IAAIpD,EAAI,EAAE,EAC/CkE,GAAiBlE,EAAI,KAAOkD,IAC9BgB,EAAc,IAAMD,EAExB,CAAC,GAID3H,MAAC,UAEC,IAAKgG,GAAM,CACTmB,EAAazD,EAAI,EAAE,EAAEsC,CAAE,EAEnBA,GAAMO,GACRE,GAAyBT,EAAIO,CAAW,EAGtCP,GAAM,CAACnC,IACTmC,EAAG,MAAM,kBAAoBsB,EAAW,OAAS,SACjDtB,EAAG,MAAM,QAAU,qBACnBA,EAAG,aAAa,gBAAiBsB,EAAW,OAAS,KAAK,EAE9D,EACA,IAAKK,EACL,MAAOjE,EAAI,OAAS,cACpB,QAAS6C,EAAc,yCAA2C9B,GAClE,MAAM,mIACN,eAAgB8B,EAAc,cAAgB,6BAC9C,QAASe,EAAW,QAAU,OAC9B,UAAU,0CACV,MAAO,CAGL,QAASA,EAAW,QAAU,OAC9B,cAAeA,EAAW,OAAS,OACnC,OAAQA,EAAW,EAAI,EACvB,WAAYA,EAAW,UAAY,SAEnC,kBAAmBA,EAAW,OAAS,SACvC,QAAS,sBAEX,aACE5D,EAAI,MACA,eAAeA,EAAI,KAAK,GACxB0D,EACE,wBAAwB,IAAI,IAAIA,CAAS,EAAE,QAAQ,GACnD,cAER,YAAU,MACV,OAAQ,IAAM,CACZ,MAAMxG,EAASkG,EAAW,QAAQ,IAAIpD,EAAI,EAAE,EAC5C,GAAK9C,EAGL,IAAI,CACF,MAAMiH,EAAMjH,EAAO,cACbkH,EAAMlH,EAAO,gBACnB,IAAImH,EAA4B,KAC5BC,EAA8B,KAGlC,GAAI,CACFD,EAAaF,GAAK,SAAS,MAAQ,KACnCG,EAAeF,GAAK,OAAS,IAC/B,MAAQ,CAGNC,EAAanH,EAAO,KAAO,IAC7B,CAWA,GATA,QAAQ,IAAI,mCAAoC,CAC9C,MAAO8C,EAAI,GACX,WAAAqE,EACA,aAAAC,EACA,UAAWpH,EAAO,IAClB,SAAA0G,CAAA,CACD,EAGGS,GAAcA,IAAerE,EAAI,KAAO,CAACqE,EAAW,WAAW,QAAQ,EAAG,CAC5E,QAAQ,IAAI,+CAAgD,CAC1D,MAAOrE,EAAI,GACX,OAAQA,EAAI,IACZ,OAAQqE,CAAA,CACT,EAGD,MAAME,EAA2C,CAAE,IAAKF,CAAA,EACpDC,EACFC,EAAQ,MAAQD,EAGhBC,EAAQ,MAAQC,GAAmBH,CAAU,EAG/CzI,EAAa,WAAW,UAAUoE,EAAI,GAAIuE,CAAO,CACnD,SAAWD,GAAgBA,IAAiBtE,EAAI,MAE9C,QAAQ,IAAI,iDAAkD,CAC5D,MAAOA,EAAI,GACX,SAAUA,EAAI,MACd,SAAUsE,CAAA,CACX,EACD1I,EAAa,WAAW,UAAUoE,EAAI,GAAI,CAAE,MAAOsE,EAAc,UACxD,CAACA,GAAgBD,GAAcA,IAAerE,EAAI,IAAK,CAEhE,MAAMyE,EAAeD,GAAmBH,CAAU,EAClD,QAAQ,IACN,sEACA,CACE,MAAOrE,EAAI,GACX,IAAKqE,EACL,aAAAI,CAAA,CACF,EAEF7I,EACG,WACA,UAAUoE,EAAI,GAAI,CAAE,IAAKqE,EAAY,MAAOI,EAAc,CAC/D,CAIA,GAAIN,GAAOC,EAAK,CACd,QAAQ,IAAI,oDAAqDpE,EAAI,EAAE,EAGvE,MAAM0E,EAAgBP,EAAI,KAC1BA,EAAI,KAAO,CAACtE,EAAoB8E,EAAiBC,IAAuB,CAOtE,GANA,QAAQ,IAAI,6CAA8C,CACxD,IAAA/E,EACA,OAAA8E,EACA,MAAO3E,EAAI,GACZ,EAEGH,EAAK,CACP,MAAMgF,EAAS,OAAOhF,GAAQ,SAAWA,EAAMA,EAAI,WAEnD,OAAO,YACL,CAAE,KAAM,kBAAmB,IAAKgF,EAAQ,YAAa7E,EAAI,IACzD,IAEJ,CAGA,OAAO,IACT,EAGA,MAAM+D,EAAgBvH,GAAkB,CAEtC,MAAMsI,EADStI,EAAE,OACK,UAAU,GAAG,EAEnC,GAAI,GAACsI,GAAU,CAACA,EAAO,MAGvB,IAAIA,EAAO,SAAW,UAAYA,EAAO,SAAW,OAAQ,CAC1DtI,EAAE,iBACFA,EAAE,kBAEF,QAAQ,IAAI,uDAAwD,CAClE,KAAMsI,EAAO,KACb,MAAO9E,EAAI,GACZ,EAED,OAAO,YACL,CAAE,KAAM,kBAAmB,IAAK8E,EAAO,KAAM,YAAa9E,EAAI,IAC9D,KAEF,MACF,CAIA,GACE8E,EAAO,MACPA,EAAO,OAAS9E,EAAI,KACpB,CAAC8E,EAAO,KAAK,WAAW,QAAQ,EAChC,CAEA,MAAMC,EAAaD,EAAO,KAE1B,QAAQ,IAAI,oDAAqD,CAC/D,MAAO9E,EAAI,GACX,WAAA+E,EACA,WAAY/E,EAAI,IACjB,EAKD,MAAMyE,GAAeD,GAAmBO,CAAU,EAClDnJ,EACG,WACA,UAAUoE,EAAI,GAAI,CAAE,IAAK+E,EAAY,MAAON,GAAc,CAI/D,EACF,EAGAlB,EAAiB,QAAQ,IAAIvD,EAAI,GAAI+D,CAAY,EACjDK,EAAI,iBAAiB,QAASL,EAAc,EAAI,EAIhD,MAAMiB,EAAmB,IAAM,CAC7B,GAAI,CACF,MAAMC,EAASd,EAAI,SAAS,KACtBe,EAAWd,GAAK,OAAS,KAE/B,GAAIa,GAAUA,IAAWjF,EAAI,KAAO,CAACiF,EAAO,WAAW,QAAQ,EAAG,CAChE,QAAQ,IACN,iEACA,CACE,MAAOjF,EAAI,GACX,OAAAiF,EACA,SAAAC,CAAA,CACF,EAGF,MAAMX,EAA2C,CAAE,IAAKU,CAAA,EACpDC,IACFX,EAAQ,MAAQW,GAGlBtJ,EAAa,WAAW,UAAUoE,EAAI,GAAIuE,CAAO,CACnD,MAAWW,GAAYA,IAAalF,EAAI,QAEtC,QAAQ,IAAI,mCAAoC,CAC9C,MAAOA,EAAI,GACX,SAAAkF,CAAA,CACD,EACDtJ,EAAa,WAAW,UAAUoE,EAAI,GAAI,CAAE,MAAOkF,EAAU,EAEjE,MAAQ,CAEN,QAAQ,IACN,8EACAlF,EAAI,GAER,CACF,EAGMmF,EAAkBH,EAClBI,GAAoBJ,EAG1BxB,EAAsB,QAAQ,IAAIxD,EAAI,GAAImF,CAAe,EAEzDhB,EAAI,iBAAiB,WAAYgB,CAAe,EAChDhB,EAAI,iBAAiB,aAAciB,EAAiB,EAGpD,MAAMC,GAAU,IAAM,CACpB,GAAI,CACFlB,EAAI,oBAAoB,WAAYgB,CAAe,EACnDhB,EAAI,oBAAoB,aAAciB,EAAiB,EACvD5B,EAAsB,QAAQ,OAAOxD,EAAI,EAAE,CAC7C,MAAQ,CAER,CACF,EAMA,GAHC9C,EAAe,SAAWmI,GAGvBjB,EAAK,CACP,MAAMkB,EAAgB,IAAI,iBAAiB,IAAM,CAC/C,GAAI,CACF,MAAMJ,EAAWd,EAAI,MACjBc,GAAYA,IAAalF,EAAI,QAC/B,QAAQ,IAAI,wDAAyD,CACnE,MAAOA,EAAI,GACX,SAAAkF,CAAA,CACD,EACDtJ,EAAa,WAAW,UAAUoE,EAAI,GAAI,CAAE,MAAOkF,EAAU,EAEjE,MAAQ,CAER,CACF,CAAC,EAGKK,EAAenB,EAAI,cAAc,OAAO,EAC1CmB,IACFD,EAAc,QAAQC,EAAc,CAClC,UAAW,GACX,QAAS,GACT,cAAe,GAChB,EAGDjC,EAAa,QAAQ,IAAItD,EAAI,GAAIsF,CAAa,EAElD,CAEA,QAAQ,IAAI,oDAAqDtF,EAAI,EAAE,CACzE,MACE,QAAQ,KACN,uFACAA,EAAI,GAIV,MAAQ,CAEN,QAAQ,KACN,2EACAA,EAAI,GAGR,CAGA,GAAI,CAEE,CAAC9C,EAAO,eAAiBwG,GAAa,CAACA,EAAU,WAAW,QAAQ,IACtE,QAAQ,KAAK,sDAAuD1D,EAAI,EAAE,EAC1EqD,EAAY,QAAQ,IAAIrD,EAAI,EAAE,EAC9B,OAAO,cACL,IAAI,YAAY,iBAAkB,CAChC,OAAQ,CAAE,MAAOA,EAAI,GAAI,IAAKA,EAAI,IAAI,CACvC,GAGP,MAAQ,CAER,EACF,EACA,QAASxD,GAAK,CACZ,QAAQ,KAAK,kCAAmC,CAC9C,MAAOwD,EAAI,GACX,IAAK0D,EACL,MAAOlH,CAAA,CACR,EAGGkH,GAAa,CAACA,EAAU,WAAW,QAAQ,IAC7CL,EAAY,QAAQ,IAAIrD,EAAI,EAAE,EAC9B,OAAO,cACL,IAAI,YAAY,iBAAkB,CAChC,OAAQ,CAAE,MAAOA,EAAI,GAAI,IAAKA,EAAI,IAAI,CACvC,GAGP,GAnVKA,EAAI,GAsVf,CAAC,EACH,CAEJ,CC5lBO,SAASwF,GAAoBC,EAAqD,CACvF,MAAO,CACL,CACE,GAAI,gBACJ,MAAO,uBACP,YAAa,wCACb,KAAMC,GACN,OAAQ,IAAMD,EAAS,aAAa,EACpC,SAAU,CAAC,WAAY,OAAQ,MAAO,OAAQ,OAAQ,MAAO,OAAO,EACpE,SAAU,YAEZ,CACE,GAAI,cACJ,MAAO,mBACP,YAAa,gCACb,KAAMhJ,GACN,OAAQ,IAAM,CACZgJ,EAAS,aAAa,EAEtB,WAAW,IAAM,CACf,OAAO,cAAc,IAAI,YAAY,cAAe,CAClD,OAAQ,CAAE,KAAM,UAAU,CAC3B,CAAC,CACJ,EAAG,GAAG,CACR,EACA,SAAU,CAAC,UAAW,WAAY,OAAQ,SAAS,EACnD,SAAU,YAEZ,CACE,GAAI,cACJ,MAAO,cACP,YAAa,kCACb,KAAME,GACN,OAAQ,IAAM,CACZF,EAAS,aAAa,EACtB,WAAW,IAAM,CACf,OAAO,cAAc,IAAI,YAAY,cAAe,CAClD,OAAQ,CAAE,KAAM,UAAU,CAC3B,CAAC,CACJ,EAAG,GAAG,CACR,EACA,SAAU,CAAC,UAAW,QAAS,QAAS,MAAO,SAAS,EACxD,SAAU,YAEZ,CACE,GAAI,gBACJ,MAAO,qBACP,YAAa,yCACb,KAAMG,GACN,OAAQ,IAAM,CACZH,EAAS,aAAa,EACtB,WAAW,IAAM,CACf,OAAO,cAAc,IAAI,YAAY,cAAe,CAClD,OAAQ,CAAE,KAAM,YAAY,CAC7B,CAAC,CACJ,EAAG,GAAG,CACR,EACA,SAAU,CAAC,YAAa,WAAY,UAAW,QAAS,SAAS,EACjE,SAAU,YAEZ,CACE,GAAI,sBACJ,MAAO,uBACP,YAAa,uCACb,KAAMI,GACN,OAAQ,IAAM,CACZJ,EAAS,aAAa,EACtB,WAAW,IAAM,CACf,OAAO,cAAc,IAAI,YAAY,cAAe,CAClD,OAAQ,CAAE,KAAM,YAAY,CAC7B,CAAC,CACJ,EAAG,GAAG,CACR,EACA,SAAU,CAAC,QAAS,YAAa,QAAS,cAAe,MAAM,EAC/D,SAAU,WACZ,CAEJ,CCxEO,SAASK,IAAe,CAC7B,KAAM,CAACtK,EAAOC,CAAQ,EAAIC,WAAS,EAAE,EAC/B,CAACqK,EAASC,CAAU,EAAItK,WAAyB,EAAE,EACnD,CAACuK,EAAMC,CAAO,EAAIxK,WAAS,EAAK,EAChC,CAAC+E,EAASC,CAAU,EAAIhF,WAAS,EAAK,EACtC,CAACyK,EAAeC,CAAgB,EAAI1K,WAAS,CAAC,EAC9C2K,EAAWpH,SAAyB,IAAI,EACxC,CAAE,KAAAnD,EAAM,UAAAwK,CAAA,EAAc1K,EAAA,EACtB6J,EAAWc,GAAA,EAGXC,EAAcrH,UAAQ,IAAMqG,GAAoBC,CAAQ,EAAG,CAACA,CAAQ,CAAC,EAG3E,eAAegB,EAAcvK,EAAqB,CAChD,GAAIA,EAAY,OAAS,EAAG,CAC1B8J,EAAW,EAAE,EACb,MACF,CAEAtF,EAAW,EAAI,EACf,GAAI,CACF,MAAMgG,EAA6B,GAG7BC,EAAazK,EAAY,cACNsK,EAAY,OAAOI,GAExC,GAAGA,EAAI,KAAK,IAAIA,EAAI,WAAW,IAAIA,EAAI,SAAS,KAAK,GAAG,CAAC,GAAG,cAC5C,SAASD,CAAU,CACtC,EAEgB,QAAQC,GAAO,CAC9BF,EAAW,KAAK,CACd,GAAIE,EAAI,GACR,MAAOA,EAAI,MACX,QAASA,EAAI,YACb,OAAQ,WACR,QAASA,CAAA,CACV,CACH,CAAC,EAGD,GAAI,CACF,MAAMC,EAAO,MAAMC,GAAY,CAC7B,CAAE,SAAU,OAAQ,EAAG5K,EAAa,MAAO,GAC3C,CAAE,SAAU,QAAS,EAAGA,EAAa,MAAO,GAC5C,CAAE,SAAU,WAAY,EAAGA,EAAa,MAAO,GAC/C,CAAE,SAAU,SAAU,EAAGA,EAAa,MAAO,EAAE,CAChD,EAEG2K,EAAK,SAAW,MAAM,QAAQA,EAAK,OAAO,GAC5CA,EAAK,QAAQ,QAAStI,GAAgB,CAChCA,EAAO,MAAQ,MAAM,QAAQA,EAAO,IAAI,GAC1CA,EAAO,KAAK,QAASwI,GAAa,CAChCL,EAAW,KAAK,CACd,GAAGK,EACH,OAAQxI,EAAO,SAChB,CACH,CAAC,CAEL,CAAC,CAEL,MAAQ,CAEN,QAAQ,MAAM,0CAA0C,CAC1D,CAEAyH,EAAWU,CAAU,EACrBN,EAAiB,CAAC,CACpB,OAAS/K,EAAO,CACd,QAAQ,MAAM,+BAAgCA,CAAK,EACnD2K,EAAW,EAAE,CACf,SACEtF,EAAW,EAAK,CAClB,CACF,CAGArB,YAAU,IAAM,CACd,GAAI,CAAC4G,EAAM,OAEX,MAAM5E,EAAY,WAAW,IAAM,CACjCoF,EAAcjL,CAAK,CACrB,EAAG,GAAG,EAEN,MAAO,IAAM,aAAa6F,CAAS,CACrC,EAAG,CAAC7F,EAAOyK,CAAI,CAAC,EAGhB5G,YAAU,IAAM,CACd,MAAM2H,EAAiBxK,GAAqB,EAErCA,EAAE,SAAWA,EAAE,UAAYA,EAAE,MAAQ,MACxCA,EAAE,iBACF0J,EAAQ,EAAI,EACZ,WAAW,IAAMG,EAAS,SAAS,QAAS,GAAG,GAI7C7J,EAAE,MAAQ,UAAYyJ,IACxBC,EAAQ,EAAK,EACbzK,EAAS,EAAE,EACXuK,EAAW,EAAE,GAIXC,GAAQF,EAAQ,OAAS,IACvBvJ,EAAE,MAAQ,aACZA,EAAE,iBACF4J,EAAiBa,GAAQ,KAAK,IAAIA,EAAO,EAAGlB,EAAQ,OAAS,CAAC,CAAC,GACtDvJ,EAAE,MAAQ,WACnBA,EAAE,iBACF4J,KAAyB,KAAK,IAAIa,EAAO,EAAG,CAAC,CAAC,GACrCzK,EAAE,MAAQ,SAAW2J,GAAiB,GAAKA,EAAgBJ,EAAQ,SAC5EvJ,EAAE,iBACF0K,EAAkBnB,EAAQI,CAAa,CAAC,GAG9C,EAEA,cAAO,iBAAiB,UAAWa,CAAa,EACzC,IAAM,OAAO,oBAAoB,UAAWA,CAAa,CAClE,EAAG,CAACf,EAAMF,EAASI,CAAa,CAAC,EAGjC9G,YAAU,IAAM,CACV4G,GACF,WAAW,IAAMI,EAAS,SAAS,QAAS,GAAG,CAEnD,EAAG,CAACJ,CAAI,CAAC,EAET,MAAMiB,EAAqB3I,GAAyB,CAElD,GAAIA,EAAO,SAAW,YAAeA,EAAe,QAAS,CAC9CA,EAAe,QACxB,SACJ2H,EAAQ,EAAK,EACbzK,EAAS,EAAE,EACXuK,EAAW,EAAE,EACb,MACF,CAEA,GAAIzH,EAAO,SAAW,QAAUA,EAAO,IAAK,CAE1C,MAAM4I,EAAcrL,EAAK,QAAUE,EAAE,MAAQuC,EAAO,GAAG,EACnD4I,EACFb,EAAUa,EAAY,EAAE,EAGxBvL,EAAa,WAAW,IAAI,CAC1B,GAAI,OAAO,KAAK,KAAK,GACrB,MAAO2C,EAAO,OAAS,UACvB,IAAKA,EAAO,IACb,CAEL,MAAWA,EAAO,SAAW,SAAWA,EAAO,SAAW,WAGxD,QAAQ,IAAI,sBAAuBA,CAAM,EAChCA,EAAO,SAAW,UAG3B,QAAQ,IAAI,cAAeA,CAAM,EAGnC2H,EAAQ,EAAK,EACbzK,EAAS,EAAE,EACXuK,EAAW,EAAE,CACf,EAEMoB,EAAiB7I,GAAyB,CAE9C,GAAIA,EAAO,SAAW,YAAeA,EAAe,QAAS,CAC3D,MAAM8I,EAAQ9I,EAAe,QAAQ,KACrC,OAAOjC,MAAC+K,EAAA,CAAK,KAAM,GAAI,UAAU,gBAAgB,CACnD,CAEA,OAAQ9I,EAAO,QACb,IAAK,OACH,OAAOjC,MAACgL,GAAA,CAAM,KAAM,GAAI,UAAU,gBAAgB,EACpD,IAAK,QACH,OAAOhL,MAACoJ,GAAA,CAAS,KAAM,GAAI,UAAU,iBAAiB,EACxD,IAAK,WACH,OAAOpJ,MAACiL,GAAA,CAAS,KAAM,GAAI,UAAU,kBAAkB,EACzD,IAAK,SACH,OAAOjL,MAACkL,GAAA,CAAU,KAAM,GAAI,UAAU,kBAAkB,EAC1D,IAAK,WACH,OAAOlL,MAACoJ,GAAA,CAAS,KAAM,GAAI,UAAU,gBAAgB,EACvD,QACE,OAAOpJ,MAACmL,GAAA,CAAO,KAAM,GAAI,UAAU,gBAAgB,EAEzD,EAEMC,EAAkBnJ,GACfA,EAAO,OAASA,EAAO,SAAWA,EAAO,QAAU,WAG5D,OACEjC,MAACiG,IACE,SAAA0D,GACC3J,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,GACpB,QAAS,CAAE,QAAS,GACpB,KAAM,CAAE,QAAS,GACjB,UAAU,6FACV,QAAS,IAAM,CACb2J,EAAQ,EAAK,EACbzK,EAAS,EAAE,EACXuK,EAAW,EAAE,CACf,EAEA,SAAA3J,OAACE,EAAO,IAAP,CACC,QAAS,CAAE,MAAO,IAAM,QAAS,GACjC,QAAS,CAAE,MAAO,EAAG,QAAS,GAC9B,KAAM,CAAE,MAAO,IAAM,QAAS,GAC9B,UAAU,+FACV,QAASC,GAAKA,EAAE,kBAGhB,UAAAH,OAAC,OAAI,UAAU,6DACb,UAAAC,MAACmL,GAAA,CAAO,KAAM,GAAI,UAAU,kBAAkB,EAC9CnL,MAAC,SACC,IAAK+J,EACL,GAAG,sBACH,KAAK,sBACL,KAAK,OACL,YAAY,4DACZ,UAAU,+EACV,MAAO7K,EACP,SAAUgB,GAAKf,EAASe,EAAE,OAAO,KAAK,EACtC,UAAWA,GAAK,CACVA,EAAE,MAAQ,WACZ0J,EAAQ,EAAK,EACbzK,EAAS,EAAE,EACXuK,EAAW,EAAE,EAEjB,IAEDxK,GACCc,MAAC,UACC,QAAS,IAAM,CACbb,EAAS,EAAE,EACXuK,EAAW,EAAE,EACbK,EAAS,SAAS,OACpB,EACA,UAAU,iCAEV,SAAA/J,MAACqL,GAAA,CAAE,KAAM,GAAI,GACf,EAEJ,EAGArL,MAAC,OAAI,UAAU,2BACZ,SAAAmE,QACE,OAAI,UAAU,yCACb,SAAAnE,MAAC,OAAI,UAAU,iEAAiE,EAClF,EACEyJ,EAAQ,SAAW,GAAKvK,EAAM,QAAU,EAC1Ca,OAAC,OAAI,UAAU,kCAAkC,mCACxBb,EAAM,KAC/B,EACEuK,EAAQ,SAAW,EACrB1J,OAAC,OAAI,UAAU,kCACb,UAAAC,MAAC,KAAE,UAAU,OAAO,6BAAiB,EACrCA,MAAC,KAAE,UAAU,wBAAwB,2DAErC,GACF,EAEAyJ,EAAQ,IAAI,CAACxH,EAAQqJ,IACnBvL,OAACE,EAAO,IAAP,CAEC,QAAS,CAAE,QAAS,EAAG,EAAG,IAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,GAC1B,WAAY,CAAE,MAAOqL,EAAQ,KAC7B,UAAW,sEACTA,IAAUzB,EACN,gDACA,wBACN,GACA,QAAS,IAAMe,EAAkB3I,CAAM,EACvC,aAAc,IAAM6H,EAAiBwB,CAAK,EAEzC,UAAAR,EAAc7I,CAAM,EACrBlC,OAAC,OAAI,UAAU,iBACb,UAAAA,OAAC,OAAI,UAAU,+BACb,UAAAC,MAAC,QAAK,UAAU,gDACb,SAAAiC,EAAO,OACV,EACCA,EAAO,WACNlC,OAAC,QAAK,UAAU,wBACd,UAAAC,MAACuL,GAAA,CAAM,KAAM,GAAI,UAAU,cAAc,EACxC,IAAI,KAAKtJ,EAAO,SAAS,EAAE,oBAAmB,EACjD,GAEJ,QACC,OAAI,UAAU,kCACZ,SAAAmJ,EAAenJ,CAAM,EACxB,EACCA,EAAO,SAAWA,EAAO,UAAYmJ,EAAenJ,CAAM,GACzDlC,OAAC,OAAI,UAAU,sCACZ,UAAAkC,EAAO,QAAQ,MAAM,EAAG,GAAG,EAC3BA,EAAO,QAAQ,OAAS,IAAM,MAAQ,IACzC,EAEDA,EAAO,KACNjC,MAAC,OAAI,UAAU,sCAAuC,WAAO,IAAI,GAErE,IArCK,GAAGiC,EAAO,MAAM,IAAIA,EAAO,EAAE,GAuCrC,EAEL,EAGCwH,EAAQ,OAAS,GAChB1J,OAAC,OAAI,UAAU,6FACb,UAAAC,MAAC,QAAK,kDAAsC,SAC3C,QACE,UAAAyJ,EAAQ,OAAO,UAAQA,EAAQ,SAAW,EAAI,IAAM,IACvD,GACF,IAEJ,GAGN,CAEJ,CCrVA,eAAsB+B,GAAoBxM,EAAeuE,EAA4B,CAGnF,GAFA,QAAQ,IAAI,kDAAmD,CAAE,MAAAvE,EAAO,IAAAuE,EAAK,EAEzES,KACF,GAAI,CAGF,MAAMyH,GAAO,wBAAyB,CAAE,IAAAlI,EAAK,EAC7C,QAAQ,IAAI,kDAAkD,CAChE,OAASxE,EAAO,CACd,QAAQ,KACN,kFACAA,CAAA,EAIF,GAAI,CACF,MAAM0M,GAAO,gBAAiB,CAAE,IAAAlI,EAAK,EACrC,QAAQ,IAAI,oDAAoD,CAClE,OAASmI,EAAU,CACjB,QAAQ,MAAM,6DAA8DA,CAAQ,EAEpF,OAAO,KAAKnI,EAAK,QAAQ,CAC3B,CACF,MAGA,OAAO,KAAKA,EAAK,QAAQ,CAE7B,CAKO,SAASoI,IAAyC,CACvD,MAAM5K,EAAWC,GAAuD,CACtEwK,GAAoBxK,EAAM,OAAO,MAAOA,EAAM,OAAO,GAAG,CAC1D,EAEA,cAAO,iBAAiB,iBAAkBD,CAAwB,EAE3D,IAAM,CACX,OAAO,oBAAoB,iBAAkBA,CAAwB,CACvE,CACF,CC7CO,SAAS6K,GACdC,EACA9K,EACM,CACN,MAAM+K,EAAanJ,SAAO5B,CAAO,EAGjCgC,YAAU,IAAM,CACd+I,EAAW,QAAU/K,CACvB,EAAG,CAACA,CAAO,CAAC,EAEZgC,YAAU,IAAM,CACd,MAAMgJ,EAAgB,OAAOF,GAAc,WAAaA,EAAYC,EAAW,QAC/E,OAAKC,EAEeC,GAAM,MAAMH,EAAmB7K,GAAU,CAEzD+K,EAAc/K,CAAK,CAIvB,CAAC,EARmB,MAWtB,EAAG,CAAC6K,CAAS,CAAC,CAChB,CChBO,SAASI,GAAoB,CAClC,MAAOC,EACP,OAAAC,EACA,SAAAC,EACA,QAAAC,EACA,SAAAC,CACF,EAA6B,CAC3B,KAAM,CAACC,CAAS,EAAInN,WAAmD,EAAE,EACnE,CAAC+E,EAASC,CAAU,EAAIhF,WAAS,EAAK,EAE5C2D,YAAU,IAAM,EAEQ,SAAY,CAQlC,GACA,CACF,EAAG,EAAE,EAEL,MAAMyJ,EAAe,IAAM,CACzBF,EAAA,EACAD,EAAA,CACF,EAEMI,EAAwB,MAAOC,GAAwB,CAC3DtI,EAAW,EAAI,EACf,GAAI,CAIFiI,EAAA,CACF,OAAStN,EAAO,CACd,QAAQ,MAAM,8BAA+BA,CAAK,CACpD,SACEqF,EAAW,EAAK,CAClB,CACF,EAEA,aACG6B,GAAA,CACC,SAAAjG,MAAC,OACC,UAAU,wFACV,QAASE,GAAK,CAERA,EAAE,SAAWA,EAAE,eACjBmM,EAAA,CAEJ,EAEA,SAAArM,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,MAAO,IAC9B,QAAS,CAAE,QAAS,EAAG,MAAO,GAC9B,KAAM,CAAE,QAAS,EAAG,MAAO,IAC3B,UAAU,2GAEV,SAAAF,OAAC,OAAI,UAAU,yBACb,UAAAC,MAAC,OAAI,UAAU,iCACb,SAAAA,MAAC2M,IAAc,KAAM,GAAI,UAAU,eAAe,EACpD,EACA5M,OAAC,OAAI,UAAU,SACb,UAAAC,MAAC,MAAG,UAAU,wCAAwC,uBAAW,EACjED,OAAC,KAAE,UAAU,6BAA6B,kEAEvCoM,GACCpM,OAAC,QAAK,UAAU,qBAAqB,qBAC1BoM,EACRC,IAAa,QAAa,gBAAgBA,CAAQ,KACrD,GAEJ,EAEArM,OAAC,OAAI,UAAU,sBACb,UAAAA,OAAC,UACC,QAASG,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACFsM,EAAA,CACF,EACA,YAAatM,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,SAAUiE,EACV,UAAU,gOACV,MAAO,CAAE,OAAQ,MAAO,UAAW,WAEnC,UAAAnE,MAAC4M,GAAA,CAAU,KAAM,GAAI,EAAE,gBAIxBL,EAAU,OAAS,GAClBxM,OAAC,OAAI,UAAU,OACb,UAAAC,MAAC,KAAE,UAAU,6BAA6B,qCAAyB,EACnEA,MAAC,OAAI,UAAU,qCACZ,SAAAuM,EAAU,MAAM,EAAG,CAAC,EAAE,IAAIM,GACzB7M,MAAC,UAEC,QAASE,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACFuM,EAAsBI,EAAS,EAAE,CACnC,EACA,YAAa3M,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,SAAUiE,EACV,UAAU,0LACV,MAAO,CAAE,OAAQ,MAAO,UAAW,WAEnC,SAAApE,OAAC,QAAK,UAAU,0BACd,UAAAC,MAAC8M,GAAA,CAAU,KAAM,GAAI,EACpB,IAAI,KAAKD,EAAS,SAAS,EAAE,gBAAe,EAC/C,GAjBKA,EAAS,GAmBjB,EACH,GACF,EAGF7M,MAAC,UACC,QAASE,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACFmM,EAAA,CACF,EACA,YAAanM,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAU,kIACV,MAAO,CAAE,OAAQ,MAAO,UAAW,WACpC,kBAED,EACF,GACF,EACAF,MAAC,UACC,QAASE,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACFmM,EAAA,CACF,EACA,YAAanM,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAU,qEACV,MAAO,CAAE,OAAQ,MAAO,UAAW,WAEnC,SAAAF,MAACqL,GAAA,CAAE,KAAM,GAAI,GACf,EACF,GACF,GAEJ,CAEJ,CAKO,SAAS0B,IAAmB,CACjC,KAAM,CAACC,EAAYC,CAAa,EAAI7N,WAI1B,IAAI,EAEd2D,mBAAU,IAAM,CACd,MAAMmK,EAAe3C,GAAgE,CACnF0C,EAAc1C,CAAI,CACpB,EAGA,OADoB4C,GAAU,GAAG,sBAAuBD,CAAW,CAErE,EAAG,EAAE,EAkBE,CACL,WAAAF,EACA,cAAAC,EACA,aAnBmB,SAAY,CAC/B,GAAKD,EACL,GAAI,EACU,MAAMlO,EAAI,KAAK,QACA,KAAMY,GAAWA,EAAE,KAAOsN,EAAW,KAAK,EAEnE,MAAMlO,EAAI,KAAK,OAAOkO,EAAW,KAAK,EAGtC,MAAMlO,EAAI,KAAK,OAAO,aAAa,CAEvC,OAASC,EAAO,CACd,QAAQ,MAAM,gCAAiCA,CAAK,CACtD,CACF,CAKE,CAEJ,CCxKA,SAASqO,GAAWC,EAA4B,CAC9C,OAAI,OAAOA,GAAM,SACR,eAAeA,CAAC,IAElB,eAAeA,CAAC,GACzB,CAMO,SAASC,IAAoB,CAClC,MAAO,CACL,QAAS,OAAO,OAAOF,GAAY,CACjC,GAAI,iBACJ,GAAI,iBACJ,GAAI,iBACJ,GAAI,iBACJ,GAAI,iBACJ,MAAO,kBACR,EACD,SAAU,CACR,GAAI,sBACJ,GAAI,sBACJ,KAAM,wBACN,GAAI,sBACJ,GAAI,sBACJ,MAAO,uBACP,MAAO,uBACP,MAAO,uBACP,MAAO,wBAET,MAAO,CACL,QAAS,2BACT,aAAc,2BACd,cAAe,2BACf,QAAS,uBACT,aAAc,uBACd,cAAe,wBACf,OAAQ,wBACR,aAAc,+BACd,KAAM,sBACN,UAAW,oBACX,OAAQ,iBAEV,OAAQ,CACN,GAAI,6BACJ,GAAI,2BACJ,GAAI,0BACJ,KAAM,UAER,OAAQ,CACN,GAAI,mBACJ,GAAI,mBACJ,GAAI,mBACN,CAEJ,CChGA,MAAMG,GAAe,0BACfC,GAAoB,gBAEpBC,GAAgB,CACpB,KAAM,MACN,SAAU,eACV,YAAa,aACb,QAAS,YACX,EAEaC,GAAWC,GAAM,WAC5B,CAAC,CAAE,QAAAC,EAAU,cAAe,MAAAC,EAAO,OAAAC,EAAQ,QAAAC,EAAU,GAAM,UAAAC,EAAW,MAAAC,EAAO,GAAGC,CAAA,EAASC,IAAQ,CAC/F,MAAMC,EAAeX,GAAcG,CAAO,EACpCS,EAAmC,CACvC,MAAOR,EAAS,OAAOA,GAAU,SAAW,GAAGA,CAAK,KAAOA,EAAS,OACpE,OAAQC,EAAU,OAAOA,GAAW,SAAW,GAAGA,CAAM,KAAOA,EAAU,OACzE,GAAGG,CAAA,EAGCK,EAAc,CAClB,QAAS,CAAE,QAAS,IACpB,QAAS,CAAE,QAAS,CAAC,GAAK,EAAG,EAAG,GAChC,WAAY,CAAE,SAAU,IAAK,OAAQ,IAAU,KAAM,YAAqB,EAG5E,OACEtO,MAACC,EAAO,IAAP,CACC,IAAAkO,EACA,UAAWI,GAAGhB,GAAca,EAAcL,GAAWP,GAAmBQ,CAAS,EACjF,MAAOK,EACN,GAAGC,EACJ,YAAU,OACV,aAAW,kBACV,GAAIJ,CAAA,EAGX,CACF,EAEAR,GAAS,YAAc,WA6ChB,SAASc,GAAa,CAC3B,MAAAC,EAAQ,EACR,UAAAT,EACA,GAAGE,CACL,EAAkF,CAChF,OACElO,MAAC,OAAI,UAAWuO,GAAG,YAAaP,CAAS,EAAI,GAAGE,EAC7C,eAAM,KAAK,CAAE,OAAQO,CAAA,CAAO,EAAE,IAAI,CAACC,EAAGC,IACrC5O,OAAC,OAAY,UAAU,yCACrB,UAAAC,MAAC0N,IAAS,QAAQ,WAAW,MAAO,GAAI,OAAQ,GAAI,EACpD3N,OAAC,OAAI,UAAU,mBACb,UAAAC,MAAC0N,IAAS,QAAQ,OAAO,MAAM,MAAM,OAAQ,GAAI,QAChDA,GAAA,CAAS,QAAQ,OAAO,MAAM,MAAM,OAAQ,GAAI,GACnD,IALQiB,CAMV,CACD,EACH,CAEJ,CCnGA,MAAMC,GAA2C,CAC/C,QACE,uKACF,UACE,kLACF,MACE,uHACF,OAAQ,yEACV,EAEMC,GAA2C,CAC/C,GAAI,2BACJ,GAAI,0BACJ,GAAI,6BACN,EAEaC,GAASC,aACpB,CACE,CACE,KAAAC,EAAO,UACP,KAAAC,EAAO,KACP,QAAA9K,EAAU,GACV,KAAA+K,EACA,aAAAC,EACA,UAAAC,EACA,SAAAC,EACA,UAAArB,EACA,SAAAsB,EACA,GAAGpB,CAAA,EAELC,IACG,CACH,MAAMoB,EAAaF,GAAYlL,EAE/B,OACEnE,MAACC,EAAO,OAAP,CACE,GAAGiO,EACJ,IAAAC,EACA,UAAWI,GACT,mNACAK,GAAaI,CAAI,EACjBH,GAAaI,CAAI,EACjBG,GAAa,SACbG,GAAc,gCACdvB,CAAA,EAEF,SAAUuB,EACV,WAAaA,EAAgC,OAAnB,CAAE,MAAO,OACnC,SAAWA,EAA+B,OAAlB,CAAE,MAAO,KAEhC,WACCxP,OAAAyP,WAAA,CACE,UAAAxP,MAACkG,GAAA,CAAQ,UAAU,eAAe,KAAM+I,IAAS,KAAO,GAAKA,IAAS,KAAO,GAAK,GAAI,EACtFjP,MAAC,QAAK,mBAAO,GACf,EAEAD,OAAAyP,WAAA,CACG,UAAAN,GAAQlP,MAAC,QAAK,UAAU,gBAAiB,SAAAkP,EAAK,EAC9CI,GAAYtP,MAAC,QAAK,UAAU,WAAY,SAAAsP,EAAS,EACjDH,GAAgBnP,MAAC,QAAK,UAAU,gBAAiB,SAAAmP,CAAA,CAAa,GACjE,GAIR,CACF,EAEAL,GAAO,YAAc,SAUd,MAAMW,GAAaV,aACxB,CAAC,CAAE,KAAAG,EAAM,KAAAD,EAAO,KAAM,GAAGf,CAAA,EAASC,IAAQ,CACxC,MAAMuB,EAAWT,IAAS,KAAO,GAAKA,IAAS,KAAO,GAAK,GAE3D,OACEjP,MAAC8O,GAAA,CACC,IAAAX,EACC,GAAGD,EACJ,KAAAe,EACA,UAAWV,GACT,mBACAU,IAAS,MAAQ,UACjBA,IAAS,MAAQ,YACjBA,IAAS,MAAQ,YACjBf,EAAM,WAGR,SAAAlO,MAAC,QACC,MAAO,CAAE,MAAO0P,EAAU,OAAQA,CAAA,EAClC,UAAU,mCAET,SAAAR,CAAA,EACH,EAGN,CACF,EAEAO,GAAW,YAAc,aAUlB,MAAME,GAAMZ,aACjB,CAAC,CAAE,SAAAa,EAAW,eAAgB,MAAAC,EAAQ,GAAM,UAAA7B,EAAW,GAAGE,CAAA,EAASC,IAAQ,CACzE,MAAM2B,EAAkB,CACtB,eAAgBD,EAAQ,yBAA2B,GACnD,cAAeA,EAAQ,wBAA0B,GACjD,YAAaA,EAAQ,sBAAwB,GAC7C,WAAYA,EAAQ,qBAAuB,IAG7C,OACE7P,MAAC8O,GAAA,CACC,IAAAX,EACC,GAAGD,EACJ,KAAK,KACL,UAAWK,GAAG,8BAA+BuB,EAAgBF,CAAQ,EAAG5B,CAAS,GAGvF,CACF,EAEA2B,GAAI,YAAc,MCjJX,MAAMI,GAAQhB,aACnB,CAAC,CAAE,UAAAf,EAAW,YAAAgC,EAAa,aAAAb,EAAc,SAAAE,EAAU,GAAGnB,CAAA,EAASC,IAE3DpO,OAAC,SACC,UAAWwO,GACT,iRACAc,GAAY,gCACZrB,CAAA,EAGD,UAAAgC,GAAehQ,MAAC,QAAK,UAAU,2BAA4B,SAAAgQ,EAAY,EACxEhQ,MAAC,SACE,GAAGkO,EACJ,IAAAC,EACA,SAAAkB,EACA,UAAU,oHAEXF,GAAgBnP,MAAC,QAAK,UAAU,2BAA4B,SAAAmP,CAAA,CAAa,IAIlF,EAEAY,GAAM,YAAc,QAMb,MAAME,GAAWlB,aACtB,CAAC,CAAE,UAAAf,EAAW,MAAArM,EAAO,SAAA0N,EAAU,GAAGnB,CAAA,EAASC,IACzCpO,OAAC,OAAI,UAAU,cACZ,UAAA4B,GACC3B,MAAC,KAAE,UAAU,8DAA+D,SAAA2B,EAAM,EAEpF3B,MAAC,YACE,GAAGkO,EACJ,IAAAC,EACA,SAAAkB,EACA,UAAWd,GACT,4RACAc,GAAY,gCACZrB,CAAA,CACF,EACF,EACF,CAEJ,EAEAiC,GAAS,YAAc,WChCvB,MAAMC,GAKD,CACH,CAAE,MAAO,OAAQ,MAAO,OAAQ,KAAM9G,GAAU,YAAa,8BAC7D,CAAE,MAAO,WAAY,MAAO,WAAY,KAAM+G,GAAU,YAAa,4BACrE,CACE,MAAO,OACP,MAAO,OACP,KAAMC,GACN,YAAa,uCAEjB,EAEO,SAASC,GAAmB,CACjC,KAAA1G,EACA,QAAA0C,EACA,UAAAiE,EACA,YAAAC,EACA,WAAAC,EACA,aAAAC,CACF,EAA4B,CAC1B,MAAMC,EAASpD,GAAA,EACT,CAACqD,EAAMC,CAAO,EAAIxR,WACrBmR,IAAgB,QAAUA,IAAgB,YAAcA,IAAgB,OACrEA,EACA,QAEA,CAACM,EAAOC,CAAQ,EAAI1R,WAASqR,GAAgB,EAAE,EAC/C,CAAClN,EAAKwN,CAAM,EAAI3R,WAASoR,GAAc,EAAE,EACzC,CAACQ,EAASC,CAAU,EAAI7R,WAAS,EAAE,EACnC,CAAC8R,EAAMC,CAAO,EAAI/R,WAAmB,EAAE,EACvC,CAACgS,EAAUC,CAAW,EAAIjS,WAAS,EAAE,EACrC,CAACkS,EAAUC,CAAW,EAAInS,WAAoC,QAAQ,EACtE,CAACoS,EAASC,CAAU,EAAIrS,WAAS,EAAE,EACnC,CAAC+E,EAASC,CAAU,EAAIhF,WAAS,EAAK,EAEtCsS,EAAexO,cAAY,IAAM,CACrC,MAAMyO,EAAUP,EAAS,OACrBO,GAAW,CAACT,EAAK,SAASS,CAAO,IACnCR,EAAQ,CAAC,GAAGD,EAAMS,EAAQ,WAAW,GAAG,EAAIA,EAAU,IAAIA,CAAO,EAAE,CAAC,EACpEN,EAAY,EAAE,EAElB,EAAG,CAACD,EAAUF,CAAI,CAAC,EAEbU,EAAkB1O,cACrB2O,GAAwB,CACvBV,EAAQD,EAAK,OAAOxR,GAAKA,IAAMmS,CAAW,CAAC,CAC7C,EACA,CAACX,CAAI,GAGDY,EAAwB5O,cAC3BhD,GAA6C,EACxCA,EAAE,MAAQ,SAAWA,EAAE,MAAQ,OACjCA,EAAE,iBACFwR,EAAA,EAEJ,EACA,CAACA,CAAY,GAGTK,GAAe7O,cACnB,MAAOhD,GAAuB,CAC5BA,EAAE,iBACFkE,EAAW,EAAI,EAEf,GAAI,CACF,IAAI4N,EAAU,GAEd,GAAIrB,IAAS,OAAQ,CACnB,GAAI,CAACK,EAAQ,OAAQ,CACnBiB,GAAU,QAAS,0BAA0B,EAC7C7N,EAAW,EAAK,EAChB,MACF,CACA4N,EAAU,MAAME,GAAU3O,GAAO,OAAO,SAAS,KAAM,CACrD,MAAOsN,GAAS,gBAChB,YAAaG,EACb,WAAYA,EAAQ,OACpB,KAAME,EAAK,OAAS,EAAIA,EAAO,OAC/B,IAAK3N,GAAO,OACb,CACH,SAAWoN,IAAS,WAAY,CAC9B,GAAI,CAACpN,EAAI,OAAQ,CACf0O,GAAU,QAAS,+BAA+B,EAClD7N,EAAW,EAAK,EAChB,MACF,CACA,MAAM+N,EAAwB,CAC5B,MAAOtB,GAAS,qBAEdK,EAAK,OAAS,IAChBiB,EAAiB,KAAOjB,GAE1Bc,EAAU,MAAMI,GAAc7O,EAAK4O,CAAgB,CACrD,SAAWxB,IAAS,OAAQ,CAC1B,GAAI,CAACE,EAAM,OAAQ,CACjBoB,GAAU,QAAS,wBAAwB,EAC3C7N,EAAW,EAAK,EAChB,MACF,CAEA,MAAMiO,EAAoB,CACxB,IAAK9O,GAAO,OACZ,MAAOyN,GAAW,OAClB,SAAAM,EACA,QAASE,EAAU,IAAI,KAAKA,CAAO,EAAE,UAAY,QAE/CN,EAAK,OAAS,IAChBmB,EAAa,KAAOnB,GAEtBc,EAAU,MAAMM,GAAUzB,EAAOwB,CAAY,CAC/C,CAEIL,GACFC,GACE,UACA,GAAG/B,GAAa,KAAKxQ,GAAKA,EAAE,QAAUiR,CAAI,GAAG,KAAK,yBAGpDG,EAAS,EAAE,EACXC,EAAO,EAAE,EACTE,EAAW,EAAE,EACbE,EAAQ,EAAE,EACVE,EAAY,EAAE,EACdE,EAAY,QAAQ,EACpBE,EAAW,EAAE,EACbnB,IAAA,EACAjE,EAAA,GAEA4F,GAAU,QAAS,yBAAyB,CAEhD,OAASlT,EAAO,CACd,QAAQ,MAAM,gDAAiDA,CAAK,EACpEkT,GAAU,QAAS,yBAAyB,CAC9C,SACE7N,EAAW,EAAK,CAClB,CACF,EACA,CAACuM,EAAME,EAAOtN,EAAKyN,EAASE,EAAMI,EAAUE,EAASlB,EAAWjE,CAAO,GAGnEkG,GAAcrP,cAAY,IAAM,CAC/BiB,GACHkI,EAAA,CAEJ,EAAG,CAAClI,EAASkI,CAAO,CAAC,EAErB,GAAI,CAAC1C,EAAM,OAAO,KAElB,MAAM6I,EAAmBtC,GAAa,KAAKxQ,GAAKA,EAAE,QAAUiR,CAAI,EAEhE,OACE3Q,MAACiG,GAAA,CACE,SAAA0D,GACC5J,OAAAyP,WAAA,CAEE,UAAAxP,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,GACpB,QAAS,CAAE,QAAS,GACpB,KAAM,CAAE,QAAS,GACjB,QAASsS,GACT,UAAU,kDACV,cAAY,SAIdvS,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,MAAO,IAAM,EAAG,IACvC,QAAS,CAAE,QAAS,EAAG,MAAO,EAAG,EAAG,GACpC,KAAM,CAAE,QAAS,EAAG,MAAO,IAAM,EAAG,IACpC,WAAY,CAAE,KAAM,SAAU,QAAS,GAAI,UAAW,KACtD,UAAU,0DACV,KAAK,SACL,aAAW,OACX,kBAAgB,sBAEhB,SAAAF,OAAC,OACC,UAAU,kJACV,QAASG,GAAKA,EAAE,kBAGhB,UAAAH,OAAC,OACC,UAAU,4EACV,MAAO,CAAE,QAAS2Q,EAAO,QAAQ,CAAC,GAElC,UAAA3Q,OAAC,OAAI,UAAU,0BACZ,UAAAyS,GACCxS,MAACwS,EAAiB,KAAjB,CACC,KAAM,GACN,UAAU,kDAGdxS,MAAC,MACC,GAAG,sBACH,UAAU,2CACV,MAAO,CAAE,SAAU0Q,EAAO,SAAS,IACpC,0BAED,EACF,EACA1Q,MAAC,UACC,QAASE,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACFqS,GAAA,CACF,EACA,YAAarS,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,SAAUiE,EACV,UAAU,yNACV,MAAO,CAAE,OAAQ,MAAO,UAAW,WACnC,aAAW,eAEX,SAAAnE,MAACqL,GAAA,CAAE,KAAM,GAAI,GACf,IAIFrL,MAAC,OACC,UAAU,0CACV,MAAO,CAAE,QAAS0Q,EAAO,QAAQ,CAAC,EAAG,WAAYA,EAAO,QAAQ,CAAC,GAEjE,eAAC,OAAI,UAAU,aACZ,SAAAR,GAAa,IAAIuC,GAAc,CAC9B,MAAM1H,EAAO0H,EAAW,KACxB,OACE1S,OAAC,UAEC,QAASG,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACF0Q,EAAQ6B,EAAW,KAAK,CAC1B,EACA,YAAavS,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAW;AAAA;AAAA,4BAGPyQ,IAAS8B,EAAW,MAChB,6EACA,0HACN;AAAA;AAAA,0BAGF,MAAO,CAAE,OAAQ,MAAO,UAAW,WACnC,eAAc9B,IAAS8B,EAAW,MAElC,UAAAzS,MAAC+K,EAAA,CAAK,KAAM,GAAI,EAChB/K,MAAC,OAAI,UAAU,sBAAuB,WAAW,MAAM,IAvBlDyS,EAAW,MA0BtB,CAAC,EACH,IAIFzS,MAAC,QACC,SAAUE,GAAK,CACbA,EAAE,iBACFA,EAAE,kBACG6R,GAAa7R,CAAC,CACrB,EACA,UAAU,yBACV,MAAO,CAAE,QAASwQ,EAAO,QAAQ,CAAC,GAClC,YAAaxQ,GAAK,CAEhB,MAAMmI,EAASnI,EAAE,OAEfmI,EAAO,QAAQ,uBAAuB,GACtCA,EAAO,QAAQ,OAAO,GACtBA,EAAO,QAAQ,UAAU,GACzBA,EAAO,QAAQ,QAAQ,CAI3B,EACA,QAASnI,GAAK,CAEZ,MAAMmI,EAASnI,EAAE,OAEfmI,EAAO,QAAQ,uBAAuB,GACtCA,EAAO,QAAQ,OAAO,GACtBA,EAAO,QAAQ,UAAU,GACzBA,EAAO,QAAQ,QAAQ,CAI3B,EAEA,SAAAtI,OAAC,OAAI,UAAU,YAEb,UAAAA,OAAC,OACC,UAAAA,OAAC,SACC,QAAQ,eACR,UAAU,8DACV,MAAO,CAAE,SAAU2Q,EAAO,SAAS,IACpC,mBACQC,IAAS,QAAU3Q,MAAC,QAAK,UAAU,eAAe,aAAC,KAE5DA,MAAC+P,GAAA,CACC,GAAG,eACH,MAAOc,EACP,SAAU3Q,GAAK4Q,EAAS5Q,EAAE,OAAO,KAAK,EACtC,YAAayQ,IAAS,OAAS,gBAAkB,oBACjD,SAAUA,IAAS,OACnB,SAAUxM,CAAA,EACZ,EACF,GAGEwM,IAAS,YAAcA,IAAS,gBAC/B,OACC,UAAA5Q,OAAC,SACC,QAAQ,aACR,UAAU,8DACV,MAAO,CAAE,SAAU2Q,EAAO,SAAS,IACpC,iBACMC,IAAS,YAAc3Q,MAAC,QAAK,UAAU,eAAe,aAAC,KAE9DD,OAAC,OAAI,UAAU,0BACb,UAAAC,MAAC0S,GAAA,CAAK,KAAM,GAAI,UAAU,yCAAyC,EACnE1S,MAAC+P,GAAA,CACC,GAAG,aACH,KAAK,MACL,MAAOxM,EACP,SAAUrD,GAAK6Q,EAAO7Q,EAAE,OAAO,KAAK,EACpC,YAAY,sBACZ,SAAUyQ,IAAS,WACnB,SAAUxM,CAAA,EACZ,EACF,GACF,GAIAwM,IAAS,QAAUA,IAAS,gBAC3B,OACC,UAAA5Q,OAAC,SACC,QAAQ,iBACR,UAAU,8DACV,MAAO,CAAE,SAAU2Q,EAAO,SAAS,IAElC,UAAAC,IAAS,OAAS,UAAY,QAAS,IACvCA,IAAS,QAAU3Q,MAAC,QAAK,UAAU,eAAe,aAAC,KAEtDA,MAACiQ,GAAA,CACC,GAAG,iBACH,MAAOe,EACP,SAAU9Q,GAAK+Q,EAAW/Q,EAAE,OAAO,KAAK,EACxC,YAAayQ,IAAS,OAAS,qBAAuB,oBACtD,KAAMA,IAAS,OAAS,EAAI,EAC5B,SAAUA,IAAS,OACnB,SAAUxM,CAAA,EACZ,EACF,EAIDwM,IAAS,QACR5Q,OAAC,OAAI,UAAU,yBACb,UAAAA,OAAC,OACC,UAAAC,MAAC,SACC,QAAQ,kBACR,UAAU,8DACV,MAAO,CAAE,SAAU0Q,EAAO,SAAS,IACpC,sBAGD3Q,OAAC,UACC,GAAG,kBACH,MAAOuR,EACP,SAAUpR,GAAKqR,EAAYrR,EAAE,OAAO,KAAkC,EACtE,UAAU,+LACV,MAAO,CAAE,SAAUwQ,EAAO,SAAS,IACnC,SAAUvM,EAEV,UAAAnE,MAAC,UAAO,MAAM,MAAM,eAAG,EACvBA,MAAC,UAAO,MAAM,SAAS,kBAAM,EAC7BA,MAAC,UAAO,MAAM,OAAO,gBAAI,IAC3B,EACF,SACC,OACC,UAAAA,MAAC,SACC,QAAQ,kBACR,UAAU,8DACV,MAAO,CAAE,SAAU0Q,EAAO,SAAS,IACpC,sBAGD1Q,MAAC+P,GAAA,CACC,GAAG,kBACH,KAAK,OACL,MAAOyB,EACP,SAAUtR,GAAKuR,EAAWvR,EAAE,OAAO,KAAK,EACxC,SAAUiE,CAAA,EACZ,EACF,GACF,SAID,OACC,UAAAnE,MAAC,SACC,QAAQ,cACR,UAAU,8DACV,MAAO,CAAE,SAAU0Q,EAAO,SAAS,IACpC,kBAGD3Q,OAAC,OAAI,UAAU,+BACb,UAAAC,MAAC2S,GAAA,CAAI,KAAM,GAAI,UAAU,yCAAyC,EAClE3S,MAAC+P,GAAA,CACC,GAAG,cACH,MAAOqB,EACP,SAAUlR,GAAKmR,EAAYnR,EAAE,OAAO,KAAK,EACzC,UAAW4R,EACX,YAAY,kCACZ,SAAU3N,CAAA,GAEZnE,MAAC8O,GAAA,CACC,KAAK,SACL,KAAK,YACL,KAAK,KACL,KAAM9O,MAAC4S,GAAA,CAAK,KAAM,GAAI,EACtB,QAAS1S,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACFwR,EAAA,CACF,EACA,YAAaxR,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,SAAUiE,GAAW,CAACiN,EAAS,OAC/B,MAAO,CAAE,OAAQ,MAAO,UAAW,WACpC,gBAED,EACF,EACCF,EAAK,OAAS,GACblR,MAAC,OAAI,UAAU,uBACZ,SAAAkR,EAAK,IAAI2B,GACR9S,OAAC,QAEC,UAAU,iIACV,MAAO,CAAE,SAAU2Q,EAAO,SAAS,IAElC,UAAAmC,EACD7S,MAAC,UACC,KAAK,SACL,QAASE,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACF0R,EAAgBiB,CAAG,CACrB,EACA,YAAa3S,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAU,uCACV,MAAO,CAAE,OAAQ,MAAO,UAAW,WACnC,aAAY,cAAc2S,CAAG,GAE7B,SAAA7S,MAACqL,GAAA,CAAE,KAAM,GAAI,GACf,GArBKwH,CAAA,CAuBR,EACH,GAEJ,GACF,IAIF9S,OAAC,OACC,UAAU,8EACV,MAAO,CAAE,QAAS2Q,EAAO,QAAQ,CAAC,GAElC,UAAA1Q,MAAC8O,GAAA,CACC,KAAK,SACL,KAAK,YACL,QAAS5O,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACFqS,GAAA,CACF,EACA,YAAarS,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,SAAUiE,EACV,MAAO,CAAE,OAAQ,MAAO,UAAW,WACpC,oBAGDpE,OAAC+O,GAAA,CACC,KAAK,SACL,KAAK,UACL,QAAS5O,GAAK,CAEZA,EAAE,iBACFA,EAAE,kBACDA,EAAU,0BACb,EACA,YAAaA,GAAK,CAEhBA,EAAE,iBACJ,EACA,SAAUiE,GAAW,CAAC0M,EAAM,OAC5B,QAAA1M,EACA,MAAO,CAAE,OAAQ,MAAO,UAAW,UAAW,cAAe,QAC9D,oBACSqO,GAAkB,QAC5B,GACF,GACF,EACF,EACF,EAEJ,CAEJ,CCjiBO,SAASM,GAAqBC,EAA+B,CAClE,MAAMC,EAAa,CACjB,QAAS,MACT,WAAY,IAAI,OAAO,cACvB,MAAOD,EAAO,OACd,SAAUA,EAAO,IAAI/R,IAAU,CAC7B,GAAIA,EAAM,GACV,KAAMA,EAAM,KACZ,MAAOA,EAAM,MACb,SAAUA,EAAM,SAChB,UAAWA,EAAM,GACjB,MAAOA,EAAM,OACb,GAGJ,OAAO,KAAK,UAAUgS,EAAY,KAAM,CAAC,CAC3C,CAKO,SAASC,GAAoBF,EAA+B,CACjE,GAAIA,EAAO,SAAW,EACpB,MAAO;AAAA,EAGT,MAAMG,EAAU,CAAC,OAAQ,QAAS,QAAS,MAAO,YAAa,OAAQ,OAAQ,OAAQ,QAAQ,EACzFC,EAAOJ,EAAO,IAAI/R,GAAS,CAC/B,MAAMoS,EAAO,IAAI,KAAKpS,EAAM,EAAE,EACxBkQ,EAAO,MAAM,QAAQlQ,EAAM,UAAU,IAAI,EAAIA,EAAM,SAAS,KAAK,KAAK,IAAI,EAAI,GAC9EqS,EAASrS,EAAM,UAAU,OAAS,MAAQ,KAEhD,MAAO,CACLA,EAAM,KACNsS,GAAU,OAAOtS,EAAM,OAAS,EAAE,CAAC,EACnCsS,GAAUtS,EAAM,UAAU,OAAS,EAAE,EACrCsS,GAAUtS,EAAM,UAAU,KAAO,EAAE,EACnCA,EAAM,GAAG,WACToS,EAAK,qBACLA,EAAK,qBACLE,GAAUpC,CAAI,EACdmC,CAAA,CAEJ,CAAC,EAGD,MADgB,CAACH,EAAQ,KAAK,GAAG,EAAG,GAAGC,EAAK,IAAII,GAAOA,EAAI,KAAK,GAAG,CAAC,CAAC,EACtD,KAAK;AAAA,CAAI,CAC1B,CAKA,SAASD,GAAUE,EAAuB,CACxC,OAAKA,EAGDA,EAAM,SAAS,GAAG,GAAKA,EAAM,SAAS,GAAG,GAAKA,EAAM,SAAS;AAAA,CAAI,EAC5D,IAAIA,EAAM,QAAQ,KAAM,IAAI,CAAC,IAG/BA,EAPY,EAQrB,CAKO,SAASC,GACdzC,EACA0C,EACAC,EAAmB,aACb,CACN,MAAMC,EAAO,IAAI,KAAK,CAAC5C,CAAO,EAAG,CAAE,KAAM2C,EAAU,EAC7CpQ,EAAM,IAAI,gBAAgBqQ,CAAI,EAC9BC,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,KAAOtQ,EACZsQ,EAAK,SAAWH,EAChBG,EAAK,MAAM,QAAU,OAErB,SAAS,KAAK,YAAYA,CAAI,EAC9BA,EAAK,QACL,SAAS,KAAK,YAAYA,CAAI,EAG9B,WAAW,IAAM,CACf,IAAI,gBAAgBtQ,CAAG,CACzB,EAAG,GAAG,CACR,CAgBO,SAASuQ,GAAef,EAAuBlS,EAA8B,CAElF,IAAIkT,EAAiB,CAAC,GAAGhB,CAAM,EAE3BlS,EAAQ,YACNA,EAAQ,UAAU,QACpBkT,EAAiBA,EAAe,OAAO7T,GAAKA,EAAE,IAAMW,EAAQ,UAAW,KAAM,GAE3EA,EAAQ,UAAU,MACpBkT,EAAiBA,EAAe,OAAO7T,GAAKA,EAAE,IAAMW,EAAQ,UAAW,GAAI,IAI3EA,EAAQ,cAAgBA,EAAQ,aAAa,OAAS,IACxDkT,EAAiBA,EAAe,OAAO7T,GAAKW,EAAQ,aAAc,SAASX,EAAE,IAAI,CAAC,GAGhFW,EAAQ,cAAgBA,EAAQ,aAAa,OAAS,IACxDkT,EAAiBA,EAAe,OAAO7T,GAAK,CAC1C,MAAM8T,EAAY,MAAM,QAAQ9T,EAAE,UAAU,IAAI,EAAIA,EAAE,SAAS,KAAO,GACtE,OAAOW,EAAQ,aAAc,QAAYmT,EAAU,SAASnB,CAAG,CAAC,CAClE,CAAC,GAIH,MAAMoB,EAAY,IAAI,OAAO,cAAc,QAAQ,QAAS,GAAG,EAAE,MAAM,EAAG,EAAE,EACtEC,EAAYrT,EAAQ,SAAW,OAAS,OAAS,MACjD6S,EAAW,kBAAkBO,CAAS,IAAIC,CAAS,GAGzD,IAAIlD,EACA2C,EAEA9S,EAAQ,SAAW,QACrBmQ,EAAU8B,GAAqBiB,CAAc,EAC7CJ,EAAW,qBAEX3C,EAAUiC,GAAoBc,CAAc,EAC5CJ,EAAW,YAIbF,GAAazC,EAAS0C,EAAUC,CAAQ,CAC1C,CC5HO,SAASQ,GAAqB,CACnC,KAAAxK,EACA,QAAA0C,EACA,OAAA0G,EACA,cAAAqB,CACF,EAA8B,CAC5B,MAAM1D,EAASpD,GAAA,EACT,CAAC+G,EAAQC,CAAS,EAAIlV,WAAyB,MAAM,EACrD,CAACmV,EAAWC,CAAY,EAAIpV,WAA2C,EAAE,EACzE,CAACqV,EAAeC,CAAgB,EAAItV,WAAmB,EAAE,EACzD,CAACuV,EAAcC,CAAe,EAAIxV,WAAmB,EAAE,EACvD,CAAC+E,EAASC,CAAU,EAAIhF,WAAS,EAAK,EAEtCyV,EAAmC,CACvC,SACA,QACA,cACA,WACA,OACA,OACA,YACA,aACA,SAGIC,EAAmB5R,cAAayN,GAAiB,CACrD+D,EAAiB/J,GACfA,EAAK,SAASgG,CAAI,EAAIhG,EAAK,OAAOjL,GAAKA,IAAMiR,CAAI,EAAI,CAAC,GAAGhG,EAAMgG,CAAI,EAEvE,EAAG,EAAE,EAECoE,EAAkB7R,cAAa2P,GAAgB,CACnD+B,EAAgBjK,GAASA,EAAK,SAASkI,CAAG,EAAIlI,EAAK,OAAOjL,GAAKA,IAAMmT,CAAG,EAAI,CAAC,GAAGlI,EAAMkI,CAAG,CAAE,CAC7F,EAAG,EAAE,EAECmC,EAAe9R,cAAY,IAAM,CACrCkB,EAAW,EAAI,EAEf,GAAI,CACF,MAAMvD,EAAyB,CAC7B,OAAAwT,EACA,UACEE,EAAU,OAASA,EAAU,IACzB,CACE,MAAOA,EAAU,MAAQ,IAAI,KAAKA,EAAU,KAAK,EAAE,UAAY,OAC/D,IAAKA,EAAU,IAAM,IAAI,KAAKA,EAAU,GAAG,EAAE,UAAY,QAE3D,OACN,aAAcE,EAAc,OAAS,EAAIA,EAAgB,OACzD,aAAcE,EAAa,OAAS,EAAIA,EAAe,QAGzDb,GAAef,EAAQlS,CAAO,EAE9B,MAAMoU,EAAQlC,EAAO,OACrBd,GACE,UACA,YAAYgD,CAAK,IAAIA,IAAU,EAAI,SAAW,UAAU,OAAOZ,EAAO,aAAa,IAErFhI,EAAA,CACF,OAAStN,EAAO,CACd,QAAQ,MAAM,wCAAyCA,CAAK,EAC5DkT,GAAU,QAAS,2BAA2B,CAChD,SACE7N,EAAW,EAAK,CAClB,CACF,EAAG,CAACiQ,EAAQE,EAAWE,EAAeE,EAAc5B,EAAQ1G,CAAO,CAAC,EAE9DkG,EAAcrP,cAAY,IAAM,CAC/BiB,GACHkI,EAAA,CAEJ,EAAG,CAAClI,EAASkI,CAAO,CAAC,EAErB,GAAI,CAAC1C,EAAM,OAAO,KAElB,MAAMuL,EAAgBnC,EAAO,OAE7B,OACE/S,MAACiG,GAAA,CACE,SAAA0D,GACC5J,OAAAyP,WAAA,CAEE,UAAAxP,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,GACpB,QAAS,CAAE,QAAS,GACpB,KAAM,CAAE,QAAS,GACjB,QAASC,GAAK,CAERA,EAAE,SAAWA,EAAE,eACjBqS,EAAA,CAEJ,EACA,YAAarS,GAAK,CAEhB,MAAMmI,EAASnI,EAAE,OAEfmI,EAAO,QAAQ,QAAQ,GACvBA,EAAO,QAAQ,iBAAiB,GAChCA,EAAO,QAAQ,iBAAiB,CAIpC,EACA,UAAU,kDACV,cAAY,SAIdrI,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,MAAO,IAAM,EAAG,IACvC,QAAS,CAAE,QAAS,EAAG,MAAO,EAAG,EAAG,GACpC,KAAM,CAAE,QAAS,EAAG,MAAO,IAAM,EAAG,IACpC,WAAY,CAAE,KAAM,SAAU,QAAS,GAAI,UAAW,KACtD,UAAU,0DACV,KAAK,SACL,aAAW,OACX,kBAAgB,wBAEhB,SAAAF,OAAC,OACC,UAAU,mJACV,QAASG,GAAKA,EAAE,kBAGhB,UAAAH,OAAC,OACC,UAAU,4EACV,MAAO,CAAE,QAAS2Q,EAAO,QAAQ,CAAC,GAElC,UAAA3Q,OAAC,OAAI,UAAU,0BACb,UAAAC,MAACmV,GAAA,CAAS,KAAM,GAAI,UAAU,kCAAkC,EAChEnV,MAAC,MACC,GAAG,wBACH,UAAU,2CACV,MAAO,CAAE,SAAU0Q,EAAO,SAAS,IACpC,4BAED,EACF,EACA1Q,MAAC,UACC,QAASE,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACFqS,EAAA,CACF,EACA,YAAarS,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,SAAUiE,EACV,UAAU,yNACV,MAAO,CAAE,OAAQ,MAAO,UAAW,WACnC,aAAW,eAEX,SAAAnE,MAACqL,GAAA,CAAE,KAAM,GAAI,GACf,IAIFrL,MAAC,OAAI,UAAU,yBAAyB,MAAO,CAAE,QAAS0Q,EAAO,QAAQ,CAAC,GACxE,SAAA3Q,OAAC,OAAI,UAAU,YAEb,UAAAA,OAAC,OACC,UAAAC,MAAC,SACC,UAAU,4DACV,MAAO,CAAE,SAAU0Q,EAAO,SAAS,IACpC,2BAGD3Q,OAAC,OAAI,UAAU,aACb,UAAAA,OAAC,UACC,QAASG,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACFoU,EAAU,MAAM,CAClB,EACA,YAAapU,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAW;AAAA;AAAA,4BAGPmU,IAAW,OACP,6EACA,0HACN;AAAA;AAAA,0BAGF,MAAO,CAAE,OAAQ,MAAO,UAAW,WACnC,eAAcA,IAAW,OAEzB,UAAArU,MAACoV,GAAA,CAAS,KAAM,GAAI,EACpBrV,OAAC,OAAI,UAAU,YACb,UAAAC,MAAC,OAAI,UAAU,cAAc,gBAAI,EACjCA,MAAC,OAAI,UAAU,qBAAqB,kCAAsB,GAC5D,KAEFD,OAAC,UACC,QAASG,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACFoU,EAAU,KAAK,CACjB,EACA,YAAapU,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAW;AAAA;AAAA,4BAGPmU,IAAW,MACP,6EACA,0HACN;AAAA;AAAA,0BAGF,MAAO,CAAE,OAAQ,MAAO,UAAW,WACnC,eAAcA,IAAW,MAEzB,UAAArU,MAACqV,GAAA,CAAgB,KAAM,GAAI,EAC3BtV,OAAC,OAAI,UAAU,YACb,UAAAC,MAAC,OAAI,UAAU,cAAc,eAAG,EAChCA,MAAC,OAAI,UAAU,qBAAqB,8BAAkB,GACxD,IACF,EACF,GACF,SAGC,OACC,UAAAD,OAAC,SACC,UAAU,4DACV,MAAO,CAAE,SAAU2Q,EAAO,SAAS,IAEnC,UAAA1Q,MAACsV,GAAA,CAAS,KAAM,GAAI,UAAU,cAAc,EAAE,2BAGhDvV,OAAC,OAAI,UAAU,yBACb,UAAAA,OAAC,OACC,UAAAC,MAAC,SACC,QAAQ,oBACR,UAAU,gDACV,MAAO,CAAE,SAAU0Q,EAAO,SAAS,IACpC,wBAGD1Q,MAAC+P,GAAA,CACC,GAAG,oBACH,KAAK,OACL,MAAOwE,EAAU,OAAS,GAC1B,SAAUrU,GAAKsU,EAAa7J,IAAS,CAAE,GAAGA,EAAM,MAAOzK,EAAE,OAAO,OAAQ,EACxE,SAAUiE,CAAA,EACZ,EACF,SACC,OACC,UAAAnE,MAAC,SACC,QAAQ,kBACR,UAAU,gDACV,MAAO,CAAE,SAAU0Q,EAAO,SAAS,IACpC,sBAGD1Q,MAAC+P,GAAA,CACC,GAAG,kBACH,KAAK,OACL,MAAOwE,EAAU,KAAO,GACxB,SAAUrU,GAAKsU,EAAa7J,IAAS,CAAE,GAAGA,EAAM,IAAKzK,EAAE,OAAO,OAAQ,EACtE,SAAUiE,CAAA,EACZ,EACF,GACF,GACF,SAGC,OACC,UAAApE,OAAC,SACC,UAAU,4DACV,MAAO,CAAE,SAAU2Q,EAAO,SAAS,IAEnC,UAAA1Q,MAACuV,GAAA,CAAO,KAAM,GAAI,UAAU,cAAc,EAAE,+BAG9CxV,OAAC,OAAI,UAAU,uBACZ,UAAA8U,EAAc,IAAIlE,GACjB3Q,MAAC,UAEC,QAASE,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACF4U,EAAiBnE,CAAI,CACvB,EACA,YAAazQ,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAW;AAAA;AAAA,8BAGPuU,EAAc,SAAS9D,CAAI,EACvB,2CACA,2FACN;AAAA;AAAA,4BAGF,MAAO,CACL,SAAUD,EAAO,SAAS,GAC1B,OAAQ,MACR,UAAW,WAEb,eAAc+D,EAAc,SAAS9D,CAAI,EAExC,SAAAA,EAAK,QAAQ,IAAK,GAAG,GA1BjBA,CAAA,CA4BR,EACA8D,EAAc,OAAS,GACtBzU,MAAC,UACC,QAASE,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACFwU,EAAiB,EAAE,CACrB,EACA,YAAaxU,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAU,+IACV,MAAO,CACL,SAAUwQ,EAAO,SAAS,GAC1B,OAAQ,MACR,UAAW,WAEd,kBAED,EAEJ,GACF,EAGC0D,EAAc,OAAS,GACtBrU,OAAC,OACC,UAAAA,OAAC,SACC,UAAU,4DACV,MAAO,CAAE,SAAU2Q,EAAO,SAAS,IAEnC,UAAA1Q,MAACwV,GAAA,CAAQ,KAAM,GAAI,UAAU,cAAc,EAAE,+BAG/CzV,OAAC,OAAI,UAAU,uBACZ,UAAAqU,EAAc,MAAM,EAAG,EAAE,EAAE,IAAIvB,GAC9B9S,OAAC,UAEC,QAASG,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACF6U,EAAgBlC,CAAG,CACrB,EACA,YAAa3S,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAW;AAAA;AAAA,gCAGPyU,EAAa,SAAS9B,CAAG,EACrB,2CACA,2FACN;AAAA;AAAA,8BAGF,MAAO,CACL,SAAUnC,EAAO,SAAS,GAC1B,OAAQ,MACR,UAAW,WAEb,eAAciE,EAAa,SAAS9B,CAAG,EACxC,cACGA,CAAA,GA1BGA,CAAA,CA4BR,EACA8B,EAAa,OAAS,GACrB3U,MAAC,UACC,QAASE,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACF0U,EAAgB,EAAE,CACpB,EACA,YAAa1U,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAU,+IACV,MAAO,CACL,SAAUwQ,EAAO,SAAS,GAC1B,OAAQ,MACR,UAAW,WAEd,kBAED,EAEJ,GACF,EAIF3Q,OAAC,OACC,UAAU,gFACV,MAAO,CAAE,QAAS2Q,EAAO,QAAQ,CAAC,GAElC,UAAA1Q,MAAC,OAAI,UAAU,sDAAsD,0BAErE,EACAD,OAAC,OAAI,UAAU,6CACb,UAAAA,OAAC,OAAI,qBAASsU,EAAO,aAAY,EAAE,SAClC,OAAI,uBAAWa,CAAA,EAAc,EAC7BX,EAAU,OACTxU,OAAC,OAAI,mBAAO,IAAI,KAAKwU,EAAU,KAAK,EAAE,oBAAmB,EAAE,EAE5DA,EAAU,KACTxU,OAAC,OAAI,iBAAK,IAAI,KAAKwU,EAAU,GAAG,EAAE,oBAAmB,EAAE,EAExDE,EAAc,OAAS,GACtB1U,OAAC,OAAI,oBAAQ0U,EAAc,OAAO,aAAS,EAE5CE,EAAa,OAAS,GAAK5U,OAAC,OAAI,mBAAO4U,EAAa,OAAO,aAAS,GACvE,IACF,EACF,EACF,EAGA5U,OAAC,OACC,UAAU,8EACV,MAAO,CAAE,QAAS2Q,EAAO,QAAQ,CAAC,GAElC,UAAA1Q,MAAC8O,GAAA,CACC,KAAK,SACL,KAAK,YACL,QAAS5O,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACFqS,EAAA,CACF,EACA,YAAarS,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,SAAUiE,EACV,MAAO,CAAE,OAAQ,MAAO,UAAW,WACpC,oBAGDpE,OAAC+O,GAAA,CACC,KAAK,SACL,KAAK,UACL,KAAM9O,MAACmV,GAAA,CAAS,KAAM,GAAI,EAC1B,QAASjV,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACF8U,EAAA,CACF,EACA,YAAa9U,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,SAAUiE,EACV,QAAAA,EACA,MAAO,CAAE,OAAQ,MAAO,UAAW,WACpC,oBACSkQ,EAAO,aAAY,GAC7B,GACF,GACF,EACF,EACF,EAEJ,CAEJ,CCxcA,SAASoB,GAAW,CAAE,OAAAC,EAAQ,QAAAC,EAAS,MAAAC,EAAO,OAAAC,EAAQ,OAAAC,EAAQ,SAAAC,GAA6B,CACzF,MAAMrF,EAASpD,GAAA,EACT0I,EAAWN,EAAO,UAAU,QAAU,GACtCO,EAAYP,EAAO,KACtB,MAAM,GAAG,EACT,OAASQ,EAAE,OAAO,CAAC,EAAE,cAAgBA,EAAE,MAAM,CAAC,CAAC,EAC/C,KAAK,GAAG,EACLC,EAAcT,EAAO,KAAK,OAAO,CAAC,EAAE,cACpCU,EAAU,IAAI,KAAKV,EAAO,EAAE,EAAE,mBAAmB,GAAI,CACzD,KAAM,UACN,OAAQ,UACT,EACKW,EAAU,IAAI,KAAKX,EAAO,EAAE,EAAE,mBAAmB,GAAI,CAAE,MAAO,QAAS,IAAK,UAAW,EAEvFY,EAAapT,cAAY,IAAM,CACnC,MAAMqT,EAAOb,EAAO,UAAU,OAASA,EAAO,OAAS,GACvD,UAAU,UACP,UAAUa,CAAI,EACd,KAAK,IAAM,CACVtE,GAAU,UAAW,qBAAqB,EAC1C4D,EAAOH,CAAM,CACf,CAAC,EACA,MAAM,IAAM,CACXzD,GAAU,QAAS,gBAAgB,CACrC,CAAC,CACL,EAAG,CAACyD,EAAQG,CAAM,CAAC,EAEbW,EAAatT,cAAY,IAAM,CAC/BwS,EAAO,UAAU,KACnB,OAAO,KAAKA,EAAO,SAAS,IAAK,QAAQ,EAE3CI,EAAOJ,CAAM,CACf,EAAG,CAACA,EAAQI,CAAM,CAAC,EAEnB,OACE9V,MAACC,EAAO,GAAP,CACC,QAAS,CAAE,QAAS,EAAG,EAAG,GAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,GAC1B,KAAM,CAAE,QAAS,EAAG,EAAG,IACvB,WAAY,CAAE,SAAU,KACxB,UAAU,iBAEV,SAAAD,MAAC,OACC,UAAW,iDACTgW,EACI,8EACA,qGACN,mBACA,MAAO,CAAE,QAAStF,EAAO,QAAQ,CAAC,GAElC,SAAA3Q,OAAC,OAAI,UAAU,yBAEb,UAAAA,OAAC,OACC,UAAU,2CACV,MAAO,CAAE,MAAO2Q,EAAO,QAAQ,EAAE,GAEjC,UAAA1Q,MAAC,OACC,UAAW,uEACTgW,EACI,mEACA,uDACN,IACA,MAAO,CACL,MAAOtF,EAAO,QAAQ,CAAC,EACvB,OAAQA,EAAO,QAAQ,CAAC,GAE1B,aAAY,SAASuF,CAAS,GAE7B,SAAAE,CAAA,GAEF,CAACR,GACA3V,MAAC,OACC,UAAU,wCACV,MAAO,CAAE,SAAU0Q,EAAO,SAAS,IAElC,SAAA2F,CAAA,EACH,IAKJtW,OAAC,OAAI,UAAU,iBACb,UAAAA,OAAC,OAAI,UAAU,8CACb,UAAAA,OAAC,OAAI,UAAU,yCACb,UAAAC,MAAC,QACC,UAAU,uEACV,MAAO,CAAE,SAAU0Q,EAAO,SAAS,IAElC,SAAAuF,CAAA,GAEFD,GACChW,MAACyW,GAAA,CACC,KAAM,GACN,UAAU,gDACV,aAAW,UACb,EAEJ,EACAzW,MAAC,OACC,UAAU,iDACV,MAAO,CAAE,SAAU0Q,EAAO,SAAS,IAElC,SAAA0F,CAAA,EACH,EACF,EAEApW,MAAC,MACC,UAAU,6DACV,MAAO,CAAE,SAAU0Q,EAAO,SAAS,IAElC,SAAAgF,EAAO,UAAU,OAASA,EAAO,QAGnC,CAACC,GAAWD,EAAO,UAAU,KAC5B1V,MAAC,OACC,UAAU,iDACV,MAAO,CAAE,SAAU0Q,EAAO,SAAS,IAElC,WAAO,SAAS,MAIpB,CAACiF,GAAWD,EAAO,OAASA,EAAO,QAAUA,EAAO,UAAU,OAC7D1V,MAAC,KACC,UAAU,yDACV,MAAO,CAAE,SAAU0Q,EAAO,SAAS,IAElC,SAAAgF,EAAO,QAKXA,EAAO,UAAU,MAAQA,EAAO,SAAS,KAAK,OAAS,GACtD1V,MAAC,OAAI,UAAU,8BACZ,SAAA0V,EAAO,SAAS,KAAK,IAAK7C,GACzB9S,OAAC,QAEC,UAAU,+HACV,MAAO,CAAE,SAAU2Q,EAAO,SAAS,IAEnC,UAAA1Q,MAACwV,GAAA,CAAQ,KAAM,GAAI,EAClB3C,EAAI,WAAW,GAAG,EAAIA,EAAM,IAAIA,CAAG,KAL/BA,CAAA,CAOR,EACH,GAEJ,EAGA9S,OAAC,OACC,UAAU,yGACV,KAAK,QACL,aAAW,iBAEX,UAAAC,MAAC,UACC,QAAS,IAAM4V,EAAMF,EAAO,GAAI,CAACM,CAAQ,EACzC,UAAW,sCACTA,EACI,mEACA,gGACN,6FACA,aAAYA,EAAW,eAAiB,aACxC,MAAOA,EAAW,QAAU,MAE3B,SAAAA,QAAYS,GAAA,CAAI,KAAM,GAAI,EAAKzW,MAAC0W,GAAA,CAAO,KAAM,GAAI,IAEnDhB,EAAO,UAAU,KAChB1V,MAAC,UACC,QAASwW,EACT,UAAU,8NACV,aAAW,kBACX,MAAM,OAEN,SAAAxW,MAACoG,GAAA,CAAa,KAAM,GAAI,IAG5BpG,MAAC,UACC,QAASsW,EACT,UAAU,8NACV,aAAW,oBACX,MAAM,OAEN,SAAAtW,MAAC2W,GAAA,CAAK,KAAM,GAAI,IAEjBZ,GACC/V,MAAC,UACC,QAAS,IAAM+V,EAASL,EAAO,EAAE,EACjC,UAAU,4KACV,aAAW,gBACX,MAAM,SAEN,SAAA1V,MAACqL,GAAA,CAAE,KAAM,GAAI,GACf,GAEJ,EACF,GACF,EAGN,CAEO,SAASuL,GAAoB,CAAE,KAAAjN,EAAM,QAAA0C,EAAS,eAAAwK,GAA4C,CAC/F,MAAMnG,EAASpD,GAAA,EACT,CAAC1N,EAAakX,CAAc,EAAI1X,WAAS,EAAE,EAC3C,CAAC2X,EAAMC,CAAO,EAAI5X,WAAmB,KAAK,EAC1C,CAAC6X,EAAaC,CAAc,EAAI9X,WAAsB,UAAU,EAChE,CAAC+X,EAAUC,CAAW,EAAIhY,WAAmB,QAAQ,EACrD,CAAC2T,EAAQsE,CAAS,EAAIjY,WAAwB,EAAE,EAChD,CAAC+E,EAASC,CAAU,EAAIhF,WAAS,EAAK,EACtC,CAACkY,EAAiBC,CAAkB,EAAInY,WAAgC,EAAE,EAC1E,CAACuV,EAAcC,CAAe,EAAIxV,WAAmB,EAAE,EACvD,CAACoY,EAASC,CAAU,EAAIrY,WAAmB,EAAE,EAG7C,CAACsY,EAAeC,CAAe,EAAIvY,WAAwB,IAAI,EAC/D,CAACwY,EAAkBC,CAAmB,EAAIzY,WAAS,EAAK,EACxD,CAAC0Y,EAAkBC,CAAmB,EAAI3Y,WAAS,EAAK,EACxD4Y,GAAiBrV,SAAyB,IAAI,EAC9CsV,GAAUtV,SAAyB,IAAI,EACvCuV,EAAiBC,GAAYvY,EAAa,GAAG,EAGnDmD,YAAU,IAAM,CACd,GAAI,CAAC4G,EAAM,OAEX,MAAMe,EAAiBxK,GAAqB,CAE1C,GAAIA,EAAE,MAAQ,KAAO,EAAEA,EAAE,kBAAkB,kBAAmB,CAC5DA,EAAE,iBACF8X,GAAe,SAAS,QACxB,MACF,CAGA,IAAK9X,EAAE,MAAQ,KAAOA,EAAE,MAAQ,OAASA,EAAE,SAAWA,EAAE,SAAU,CAChEA,EAAE,iBACF2X,EAAoB,EAAI,EACxB,MACF,CAGA,GAAI3X,EAAE,MAAQ,KAAO,EAAEA,EAAE,kBAAkB,kBAAmB,CAC5DA,EAAE,iBACFyX,EAAgBhN,GAAQ,CACtB,MAAMyN,EAAOzN,IAAS,KAAO,EAAI,KAAK,IAAIA,EAAO,EAAGoI,EAAO,OAAS,CAAC,EAErE,OAAIkF,GAAQ,SACGA,GAAQ,QAAQ,SAASG,CAAI,GACpC,eAAe,CAAE,SAAU,SAAU,MAAO,UAAW,EAExDA,CACT,CAAC,EACD,MACF,CAEA,GAAIlY,EAAE,MAAQ,KAAO,EAAEA,EAAE,kBAAkB,kBAAmB,CAC5DA,EAAE,iBACFyX,EAAgBhN,GAAQ,CACtB,MAAMyN,EAAOzN,IAAS,KAAOoI,EAAO,OAAS,EAAI,KAAK,IAAIpI,EAAO,EAAG,CAAC,EACrE,OAAIsN,GAAQ,SACGA,GAAQ,QAAQ,SAASG,CAAI,GACpC,eAAe,CAAE,SAAU,SAAU,MAAO,UAAW,EAExDA,CACT,CAAC,EACD,MACF,CAGA,GAAIlY,EAAE,MAAQ,UAAY,EAAEA,EAAE,kBAAkB,kBAAmB,CACjEmM,EAAA,EACA,MACF,CACF,EAEA,cAAO,iBAAiB,UAAW3B,CAAa,EACzC,IAAM,OAAO,oBAAoB,UAAWA,CAAa,CAClE,EAAG,CAACf,EAAMoJ,EAAO,OAAQ8D,EAAgBxK,CAAO,CAAC,EAGjD,MAAMgM,EAAanV,cAAY,SAAY,CACzCkB,EAAW,EAAI,EACf,GAAI,CACF,MAAMkU,EAAS,MAAMC,GAAoB,UAAU,CACjD,MAAO,IACR,EACDlB,EAAUiB,CAAM,CAClB,OAASvZ,EAAO,CACd,QAAQ,MAAM,+CAAgDA,CAAK,EACnEkT,GAAU,QAAS,yBAAyB,CAC9C,SACE7N,EAAW,EAAK,CAClB,CACF,EAAG,EAAE,EAELrB,YAAU,IAAM,CACT4G,GACA0O,EAAA,CACP,EAAG,CAAC1O,EAAM0O,CAAU,CAAC,EAGrB,MAAMG,EAAsBtV,cAAY,IAAM,CACvCmV,EAAA,CACP,EAAG,CAACA,CAAU,CAAC,EAGftV,YAAU,IAAM,CACd,GAAI,CAAC4G,EAAM,QAEM,SAAY,CAC3B,GAAI,CACF,MAAMuH,EAAO,MAAMuH,GAAc,aACjChB,EAAWvG,CAAI,CACjB,OAASnS,EAAO,CACd,QAAQ,MAAM,6CAA8CA,CAAK,CACnE,CACF,GAEK,CACP,EAAG,CAAC4K,CAAI,CAAC,EAGT5G,YAAU,IAAM,CACd,GAAI,CAACmV,GAAkBA,EAAe,OAAS,EAAG,CAChDX,EAAmB,EAAE,EACrB,MACF,EAE8B,SAAY,CACxC,GAAI,CACF,MAAM9N,EAAU,MAAMiP,GAAuBR,EAAgB,CAC3D,MAAO,GACP,cAAe,GAChB,EACDX,EAAmB9N,CAAO,CAC5B,OAAS1K,EAAO,CACd,QAAQ,MAAM,gDAAiDA,CAAK,EACpEwY,EAAmB,EAAE,CACvB,CACF,GAEK,CACP,EAAG,CAACW,CAAc,CAAC,EAGnB,MAAMnE,EAAiBlR,UAAQ,IAAM,CACnC,IAAI8V,EAAW5F,EAmBf,GAhBIgE,IAAS,WACX4B,EAAWA,EAAS,OAAOzY,GACzBA,EAAE,UAAU,MAAM,KAAMR,GAAcA,EAAE,SAAS,UAAU,GAAKA,EAAE,SAAS,WAAW,CAAC,GAEhFqX,IAAS,UAClB4B,EAAWA,EAAS,OAAOzY,GACzBA,EAAE,UAAU,MAAM,KAAMR,GAAcA,EAAE,SAAS,OAAO,GAAKA,EAAE,SAAS,QAAQ,CAAC,IAKjFiV,EAAa,OAAS,IACxBgE,EAAWA,EAAS,OAAOzY,GAAKyU,EAAa,KAAK9B,GAAO3S,EAAE,UAAU,MAAM,SAAS2S,CAAG,CAAC,CAAC,GAIvFqF,EACF,GAAIZ,EAAgB,OAAS,EAAG,CAC9B,MAAMsB,EAAc,IAAI,IAAItB,EAAgB,IAAIuB,GAAKA,EAAE,MAAM,EAAE,CAAC,EAChEF,EAAWA,EAAS,OAAOzY,GAAK0Y,EAAY,IAAI1Y,EAAE,EAAE,CAAC,CACvD,KAAO,CACL,MAAMmK,EAAa6N,EAAe,cAClCS,EAAWA,EAAS,OAClBzY,GACEA,EAAE,MAAM,cAAc,SAASmK,CAAU,GACzCnK,EAAE,UAAU,OAAO,cAAc,SAASmK,CAAU,GACpDnK,EAAE,UAAU,MAAM,KAAMR,GAAcA,EAAE,cAAc,SAAS2K,CAAU,CAAC,EAEhF,CAIF,OAAAsO,EAAW,CAAC,GAAGA,CAAQ,EAAE,KAAK,CAAC5W,EAAGC,IAAM,CACtC,GAAImV,IAAa,SAAU,OAAOnV,EAAE,GAAKD,EAAE,GAC3C,GAAIoV,IAAa,SAAU,OAAOpV,EAAE,GAAKC,EAAE,GAC3C,GAAImV,IAAa,aAAeG,EAAgB,OAAS,EAAG,CAC1D,MAAMwB,EAASxB,EAAgB,KAAKuB,IAAKA,GAAE,MAAM,KAAO9W,EAAE,EAAE,EACtDgX,GAASzB,EAAgB,KAAKuB,IAAKA,GAAE,MAAM,KAAO7W,EAAE,EAAE,EAC5D,GAAI8W,GAAUC,GAAQ,OAAOA,GAAO,WAAaD,EAAO,WACxD,GAAIA,EAAQ,MAAO,GACnB,GAAIC,GAAQ,MAAO,EACrB,CACA,OAAO/W,EAAE,GAAKD,EAAE,EAClB,CAAC,EAEM4W,CACT,EAAG,CAAC5F,EAAQgE,EAAMpC,EAAcuD,EAAgBZ,EAAiBH,CAAQ,CAAC,EAEpE6B,GAAkB,MAAOrY,EAAY0S,IAAoB,CAC7D,GAAI,CACF,MAAMoF,GAAc,oBAAoB9X,EAAI,CAAE,OAAA0S,EAAQ,EACtDgE,KACE1M,EAAK,OAAUzK,EAAE,KAAOS,EAAK,CAAE,GAAGT,EAAG,SAAU,CAAE,GAAGA,EAAE,SAAU,OAAAmT,CAAA,CAAO,EAAMnT,CAAE,GAEjF+R,GAAU,UAAWoB,EAAS,gBAAkB,iBAAiB,CACnE,OAAStU,EAAO,CACd,QAAQ,MAAM,8CAA+CA,CAAK,EAClEkT,GAAU,QAAS,yBAAyB,CAC9C,CACF,EAEMqE,GAAapT,cAAa+V,GAAyB,CAEzD,EAAG,EAAE,EAECzC,GAAatT,cAAY,MAAOwS,GAAwB,CAC5D,GAAIA,EAAO,UAAU,IACnB,GAAI,CACF,MAAM5W,EAAI,KAAK,OAAO,CAAE,IAAK4W,EAAO,SAAS,IAAK,EAClDzD,GAAU,UAAW,mBAAmB,CAC1C,OAASlT,EAAO,CACd,QAAQ,MAAM,4CAA6CA,CAAK,EAChEkT,GAAU,QAAS,2BAA2B,CAChD,CAEJ,EAAG,EAAE,EAECiH,GAAe,MAAOvY,GAAe,CACzC,GAAI,CACF,MAAM8X,GAAc,YAAY9X,CAAE,EAClC0W,KAAkB1M,EAAK,UAAYzK,EAAE,KAAOS,CAAE,CAAC,EAC/CsR,GAAU,UAAW,gBAAgB,CACvC,OAASlT,EAAO,CACd,QAAQ,MAAM,gDAAiDA,CAAK,EACpEkT,GAAU,QAAS,yBAAyB,CAC9C,CACF,EAEM8C,GAAmBlC,GAAgB,CACvC+B,EAAgBjK,GAASA,EAAK,SAASkI,CAAG,EAAIlI,EAAK,OAAOjL,GAAKA,IAAMmT,CAAG,EAAI,CAAC,GAAGlI,EAAMkI,CAAG,CAAE,CAC7F,EAkBA,OAAKlJ,EAGH3J,MAACiG,GAAA,CACE,SAAA0D,GACC5J,OAAAyP,WAAA,CAEE,UAAAxP,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,GACpB,QAAS,CAAE,QAAS,GACpB,KAAM,CAAE,QAAS,GACjB,QAASoM,EACT,UAAU,kDACV,cAAY,SAIdtM,OAACE,EAAO,IAAP,CACC,QAAS,CAAE,EAAG,QACd,QAAS,CAAE,EAAG,GACd,KAAM,CAAE,EAAG,QACX,WAAY,CAAE,KAAM,SAAU,QAAS,GAAI,UAAW,KACtD,UAAU,+NACV,KAAK,SACL,aAAW,OACX,aAAW,wBACX,QAASC,GAAKA,EAAE,kBAGhB,UAAAH,OAAC,OACC,UAAU,4EACV,MAAO,CAAE,QAAS2Q,EAAO,QAAQ,CAAC,GAElC,UAAA3Q,OAAC,OAAI,UAAU,0BACb,UAAAC,MAACoJ,GAAA,CAAS,KAAM,GAAI,UAAU,kCAAkC,EAChEpJ,MAAC,MACC,UAAU,2CACV,MAAO,CAAE,SAAU0Q,EAAO,SAAS,IACpC,wBAED,EACF,EACA1Q,MAAC,UACC,QAASqM,EACT,UAAU,qMACV,aAAW,cAEX,SAAArM,MAACqL,GAAA,CAAE,KAAM,GAAI,GACf,UAID,OAAI,MAAO,CAAE,QAASqF,EAAO,QAAQ,CAAC,EAAG,cAAeA,EAAO,QAAQ,CAAC,GACvE,SAAA3Q,OAAC,OAAI,UAAU,WACb,UAAAC,MAACmL,GAAA,CACC,KAAM,GACN,UAAU,0FAEZnL,MAAC,SACC,IAAKgY,GACL,KAAK,OACL,YAAY,wCACZ,MAAOpY,EACP,SAAUM,GAAK4W,EAAe5W,EAAE,OAAO,KAAK,EAC5C,UAAU,kRACV,MAAO,CAAE,SAAUwQ,EAAO,SAAS,IACnC,aAAW,mBACb,EACF,EACF,EAGA3Q,OAAC,OACC,UAAU,4EACV,MAAO,CACL,QAAS2Q,EAAO,QAAQ,CAAC,EACzB,WAAYA,EAAO,QAAQ,CAAC,EAC5B,cAAeA,EAAO,QAAQ,CAAC,GAG/B,WAAC,MAAO,WAAY,OAAO,EAAiB,IAAIyI,GAChDnZ,MAAC,UAEC,QAAS,IAAMgX,EAAQmC,CAAC,EACxB,UAAW,kEACTpC,IAASoC,EACL,2CACA,2FACN,6FACA,MAAO,CAAE,SAAUzI,EAAO,SAAS,IACnC,eAAcqG,IAASoC,EAEtB,SAAAA,EAAE,OAAO,CAAC,EAAE,cAAgBA,EAAE,MAAM,CAAC,GAVjCA,CAAA,CAYR,EAEDpZ,OAAC,OAAI,UAAU,kCACb,UAAAC,MAAC,UACC,QAAS,IAAMkX,EAAeD,IAAgB,UAAY,WAAa,SAAS,EAChF,UAAU,qMACV,aAAY,aAAaA,IAAgB,UAAY,WAAa,SAAS,QAC3E,MAAOA,IAAgB,UAAY,gBAAkB,eAEpD,SAAAA,IAAgB,UAAYjX,MAACoZ,GAAA,CAAK,KAAM,GAAI,EAAKpZ,MAACqZ,GAAA,CAAW,KAAM,GAAI,IAE1EtZ,OAAC,OACC,UAAU,mCACV,MAAO,CAAE,SAAU2Q,EAAO,SAAS,IAElC,UAAAqD,EAAe,OAAO,IAAEA,EAAe,SAAW,EAAI,OAAS,UAClE,EACF,KAIFhU,OAAC,OACC,UAAU,4EACV,MAAO,CACL,QAAS2Q,EAAO,QAAQ,CAAC,EACzB,WAAYA,EAAO,QAAQ,CAAC,EAC5B,cAAeA,EAAO,QAAQ,CAAC,GAGjC,UAAA3Q,OAAC,OAAI,UAAU,0BACb,UAAAC,MAACuV,GAAA,CAAO,KAAM,GAAI,UAAU,2BAA2B,EACvDvV,MAAC,QACC,UAAU,mCACV,MAAO,CAAE,SAAU0Q,EAAO,SAAS,IACpC,mBAGD3Q,OAAC,UACC,MAAOoX,EACP,SAAUjX,GAAKkX,EAAYlX,EAAE,OAAO,KAAiB,EACrD,UAAU,mMACV,MAAO,CAAE,SAAUwQ,EAAO,SAAS,IACnC,aAAW,YAEX,UAAA1Q,MAAC,UAAO,MAAM,SAAS,kBAAM,EAC7BA,MAAC,UAAO,MAAM,SAAS,kBAAM,EAC7BA,MAAC,UAAO,MAAM,YAAY,qBAAS,IACrC,EACF,EAGCwX,EAAQ,MAAM,EAAG,CAAC,EAAE,IAAI3E,GACvB9S,OAAC,UAEC,QAAS,IAAMgV,GAAgBlC,CAAG,EAClC,UAAW,gEACT8B,EAAa,SAAS9B,CAAG,EACrB,2CACA,2FACN,6FACA,MAAO,CAAE,SAAUnC,EAAO,SAAS,IACnC,eAAciE,EAAa,SAAS9B,CAAG,EACxC,cACGA,CAAA,GAVGA,CAAA,CAYR,EACA8B,EAAa,OAAS,GACrB3U,MAAC,UACC,QAAS,IAAM4U,EAAgB,EAAE,EACjC,UAAU,6IACV,MAAO,CAAE,SAAUlE,EAAO,SAAS,IACpC,kBAED,IAKJ1Q,MAAC,OAAI,UAAU,yBAAyB,YAAWmE,EAChD,SAAAA,EACCnE,MAAC,OAAI,MAAO,CAAE,QAAS0Q,EAAO,QAAQ,CAAC,GACrC,SAAA1Q,MAACwO,GAAA,CAAa,MAAO,EAAG,EAC1B,EACEuF,EAAe,SAAW,EAC5BhU,OAAC,OACC,UAAU,8MACV,MAAO,CAAE,QAAS2Q,EAAO,QAAQ,CAAC,EAAG,UAAW,SAEhD,UAAA1Q,MAACoJ,GAAA,CAAS,KAAM,GAAI,UAAU,uBAAuB,EACrDpJ,MAAC,KAAE,UAAU,8BAA8B,oCAAwB,EACnEA,MAAC,KAAE,UAAU,2CAA2C,yHAGxD,EACAD,OAAC,UACC,KAAK,SACL,QAAS,IACP,OAAO,cACL,IAAI,YAAY,sBAAuB,CACrC,OAAQ,CAAE,MAAO,0CAA0C,CAC5D,GAGL,UAAU,mIACX,6CAECC,MAACsZ,GAAA,CAAa,KAAM,GAAI,IAC1B,IAGFtZ,MAAC,MACC,IAAKiY,GACL,UAAU,sBACV,MAAO,CAAE,QAASvH,EAAO,QAAQ,CAAC,GAClC,KAAK,OAEL,eAACzK,GAAA,CAAgB,KAAK,YACnB,SAAA8N,EAAe,IAAI/S,GAClBhB,MAACyV,GAAA,CAEC,OAAQzU,EACR,QAASiW,IAAgB,UACzB,MAAO+B,GACP,OAAQ1C,GACR,OAAQE,GACR,SAAU0C,EAAA,EANLlY,EAAM,GAQd,EACH,IAGN,EAGAjB,OAAC,OACC,UAAU,kEACV,MAAO,CAAE,QAAS2Q,EAAO,QAAQ,CAAC,GAElC,UAAA1Q,MAAC8O,GAAA,CACC,KAAK,UACL,KAAK,KACL,KAAM9O,MAAC4S,GAAA,CAAK,KAAM,GAAI,EACtB,QAAS,IAAMiF,EAAoB,EAAI,EACvC,UAAS,GACT,UAAU,SACX,2BAGD7X,MAAC8O,GAAA,CAAO,KAAK,YAAY,KAAK,KAAK,QAAS,IAAMiJ,EAAoB,EAAI,EAAG,kBAE7E,IACF,IAIF/X,MAACqQ,GAAA,CACC,KAAMuH,EACN,QAAS,IAAMC,EAAoB,EAAK,EACxC,UAAWW,CAAA,GAIbxY,MAACmU,GAAA,CACC,KAAM2D,EACN,QAAS,IAAMC,EAAoB,EAAK,EACxC,OAAAhF,EACA,cAAeyE,CAAA,EACjB,EACF,EAEJ,EAxQgB,IA0QpB,CC1uBA,MAAM+B,GAAkB,IAClBC,GAAwB,MAAc,GAAK,IAEpCC,GAAwB/a,GAA2BC,IAAQ,CACtE,YAAa,GACb,UAAW,OACX,aAAc+a,GACZ/a,EAAIY,GAAS,CACX,IAAIoa,EAAkD,CACpD,GAAGpa,EAAM,YACT,CAACma,EAAO,KAAK,EAAG,CACd,GAAIna,EAAM,YAAYma,EAAO,KAAK,GAAK,GACvC,GAAGA,EACH,aAAc,GAChB,EAIF,MAAME,EAAoB,OAAO,QAAQD,CAAW,EACpD,GAAIC,EAAkB,OAASL,GAAiB,CAK9C,MAAMM,EAHSD,EAAkB,KAC/B,CAAC7X,EAAGC,KAAOD,EAAE,CAAC,EAAE,aAAe,IAAMC,EAAE,CAAC,EAAE,aAAe,IAErC,MAAM,CAACuX,EAAe,EAC5CI,EAAc,OAAO,YAAYE,CAAM,CACzC,CAEA,MAAO,CACL,YAAAF,EACA,UAAW,CACT,MAAOD,EAAO,MACd,KAAM,YACN,UAAW,KAAK,MAChB,OAAQA,EAAO,OACjB,CAEJ,CAAC,EACH,YAAa1a,GACXL,EAAIY,GAAS,CACX,MAAMua,EAAUva,EAAM,YAAYP,CAAK,EACvC,OAAK8a,EAGE,CACL,YAAa,CACX,GAAGva,EAAM,YACT,CAACP,CAAK,EAAG,CACP,GAAG8a,EACH,aAAc,GAChB,CACF,EATOva,CAWX,CAAC,EACH,QAAS,CAACP,EAAO6B,IACflC,EAAIY,GAAS,CACX,GAAI,CAACA,EAAM,YAAYP,CAAK,EAC1B,OAAOO,EAET,MAAM6Y,EAAO,CAAE,GAAG7Y,EAAM,aACxB,cAAO6Y,EAAKpZ,CAAK,EACV,CACL,YAAaoZ,EACb,UAAWvX,GAAS,OAChBtB,EAAM,UACN,CACE,MAAAP,EACA,KAAM,WACN,UAAW,KAAK,KAAI,CACtB,CAER,CAAC,EACH,QAAS,IACPL,EAAIY,GAAS,CACX,MAAMwa,EAAM,KAAK,MACXJ,EAAkD,GAGxD,cAAO,QAAQpa,EAAM,WAAW,EAAE,QAAQ,CAAC,CAACP,EAAO0a,CAAM,IAAM,CACjDK,GAAOL,EAAO,aAAe,GAC/BF,KACRG,EAAY3a,CAAK,EAAI0a,EAEzB,CAAC,EAEM,CAAE,YAAAC,CAAA,CACX,CAAC,CACL,EAAE,mKC7FF,MAAMK,GAAqC,CACzC,SAAU,IACV,WAAY,KACZ,oBAAqB,IACrB,uBAAwB,IAC1B,EAEA,MAAMC,EAAW,CAAjB,cACEvZ,GAAA,KAAQ,UAA6B,CAAE,GAAGsZ,EAAA,CAAgB,EAC1DtZ,GAAA,KAAQ,UAA0B,EAAC,EACnCA,GAAA,KAAQ,WAAwC,GAAI,EACpDA,GAAA,KAAQ,eAAsD,MAC9DA,GAAA,KAAQ,iBAAwD,MAEhE,MAAMG,EAAsC,CAC1C,KAAK,QAAU,CAAE,GAAGmZ,GAAiB,GAAInZ,GAAW,EAAC,EACrD,KAAK,YACL,KAAK,YACD,KAAK,cAAc,cAAc,KAAK,YAAY,EAClD,KAAK,gBAAgB,cAAc,KAAK,cAAc,EAC1D,KAAK,aAAe,YAAY,IAAM,KAAK,YAAa,GAAM,EAC9D,KAAK,eAAiB,YAAY,IAAM,KAAK,YAAa,KAAK,QAAQ,mBAAmB,CAC5F,CAEA,MAAO,CACD,KAAK,cAAc,cAAc,KAAK,YAAY,EAClD,KAAK,gBAAgB,cAAc,KAAK,cAAc,EAC1D,KAAK,aAAe,KACpB,KAAK,eAAiB,IACxB,CAEA,OAAOqZ,EAAqC,CAC1C,KAAK,MAAM,CAAE,GAAG,KAAK,QAAS,GAAGA,EAAS,CAC5C,CAEA,MAAc,WAAY,CACxB,GAAKpb,GAAK,MAAM,cAChB,GAAI,CACF,MAAMqb,EAAU,MAAMrb,EAAI,KAAK,gBACzBib,EAAM,KAAK,MACjB,OAAO,QAAQI,GAAW,EAAE,EAAE,QAAQ,CAAC,CAACnb,EAAOuL,CAAI,IAAqB,CAClE,OAAOA,GAAM,UAAa,WAC9B,KAAK,QAAQ,KAAK,CAAE,MAAAvL,EAAO,SAAUuL,EAAK,SAAU,UAAWwP,EAAK,EAChE,KAAK,QAAQ,OAAS,KACxB,KAAK,QAAQ,OAAO,EAAG,KAAK,QAAQ,OAAS,GAAI,EAErD,CAAC,EACDK,GAAS,CACP,KAAM,sBACN,QAAS,CACP,UAAW,OAAO,KAAKD,GAAW,EAAE,EAAE,OACtC,UAAWJ,CAAA,CACb,CACD,CACH,OAAShb,EAAO,CACd,QAAQ,KAAK,oCAAqCA,CAAK,CACzD,CACF,CAEA,MAAc,WAAY,CAIxB,GAAI,EAFc,CAAC+E,GAAA,GAAuB,CAACE,GAAA,GAE1B,CAAClF,GAAK,MAAM,MAI7B,GAAI,CACF,MAAMU,EAAO,MAAMV,EAAI,KAAK,OACtBib,EAAM,KAAK,MACXM,MAAiB,IACvB,KAAK,QAAQ,QAAQC,GAAU,EACzB,CAACD,EAAW,IAAIC,EAAO,KAAK,GAAKA,EAAO,UAAYP,EAAM,MAC5DM,EAAW,IAAIC,EAAO,MAAOA,EAAO,QAAQ,CAEhD,CAAC,EAED,MAAMC,EAAa/a,EAAK,OAAOkE,GAAOA,EAAI,MAAM,EAC1C8W,EAAiBhb,EAAK,OAAOkE,GAAO,CAACA,EAAI,MAAM,EAE/C+W,EAAc,KAAK,QAAQ,WAC3BC,EAAmB,KAAK,IAC5BD,EAAc,GACd,KAAK,IACH,KAAK,QAAQ,uBACbF,EAAW,QAAU,KAAK,QAAQ,SAAW,GAC/C,EAGII,EAAeJ,EAAW,OAC5B,KAAK,IAAI,KAAK,QAAQ,SAAUG,EAAmBH,EAAW,MAAM,EACpE,EACEK,EAAmBJ,EAAe,OACpC,KAAK,IAAI,KAAMC,EAAcC,GAAoBF,EAAe,MAAM,EACtE,KAAK,QAAQ,SAEXK,EAA+B,GAErC,UAAWnX,KAAO6W,EAChBM,EAAQ,KAAK,KAAK,OAAOnX,EAAI,GAAI,KAAK,MAAMiX,CAAY,CAAC,CAAC,EAG5D,UAAWjX,KAAO8W,EAAgB,CAChC,MAAMM,EAAWT,EAAW,IAAI3W,EAAI,EAAE,GAAK,EACrCqX,EAAY,KAAK,IAAI,IAAK,KAAK,IAAIH,EAAkBE,EAAW,GAAG,CAAC,EAC1ED,EAAQ,KAAK,KAAK,OAAOnX,EAAI,GAAI,KAAK,MAAMqX,CAAS,CAAC,CAAC,CACzD,CAEA,MAAM,QAAQ,WAAWF,CAAO,EAEhCT,GAAS,CACP,KAAM,2BACN,QAAS,CACP,UAAWL,EACX,WAAYQ,EAAW,OACvB,eAAgBC,EAAe,OAC/B,KAAM,MAAM,KAAK,KAAK,KAAK,QAAQ,EACrC,CACD,CACH,OAASzb,EAAO,CACd,QAAQ,KAAK,mCAAoCA,CAAK,CACxD,CACF,CAEA,MAAc,OAAOC,EAAegc,EAAe,CACjD,MAAMC,EAAW,KAAK,KAAK,IAAIjc,CAAK,EACpC,GAAIic,GAAY,KAAK,IAAIA,EAAS,MAAQD,CAAK,EAAI,GACjD,OAAOC,EAET,GAAI,CACF,MAAMnc,EAAI,KAAK,aAAaE,EAAOgc,CAAK,EACxC,MAAMtB,EAAyB,CAAE,MAAA1a,EAAO,MAAAgc,EAAO,YAAa,KAAK,KAAI,EACrE,YAAK,KAAK,IAAIhc,EAAO0a,CAAM,EACpBA,CACT,OAAS3a,EAAO,CACd,eAAQ,KAAK,iCAAkC,CAAE,MAAAC,EAAO,MAAAgc,CAAA,EAASjc,CAAK,EAC/Dkc,CACT,CACF,CACF,CAEO,MAAMC,GAAa,IAAIjB,GAEvB,SAASkB,IAA6B,CAC3CD,GAAW,QACX,OAAO,iBAAiB,mBAAoB,IAAM,CAC5C,SAAS,kBAAoB,WAC/BA,GAAW,OAEf,CAAC,CACH,CAEO,SAASE,GAAoBva,EAA2C,CAC7Eqa,GAAW,OAAOra,CAAO,CAC3B,CC9JA,MAAMwa,GAAiC,CACrC,sBAAuB,GACvB,oBAAqB,GACrB,kBAAmB,GACnB,gBAAiB,GACjB,aAAc,GACd,iBAAkB,GAClB,gBAAiB,GACjB,mBAAoB,EACtB,EAEA,IAAIC,GAAgC,CAAE,GAAGD,EAAA,EACrCE,OAAiC,IACjCC,OAA6B,IAKjC,eAAsBC,IAAsC,CAC1D,GAAI,CACF,GAAI,OAAO,OAAW,KAAe,OAAO,aAAc,CACxD,MAAMC,EAAS,aAAa,QAAQ,cAAc,EAC9CA,IACFJ,GAAgB,CAAE,GAAGD,GAAgB,GAAG,KAAK,MAAMK,CAAM,GAE7D,CACF,OAAS3c,EAAO,CACd,QAAQ,KAAK,iCAAkCA,CAAK,CACtD,CACA,OAAOuc,EACT,CAKO,SAASK,GAAWC,EAAuC,CAChEN,GAAgB,CAAE,GAAGA,GAAe,GAAGM,CAAA,EACvC,GAAI,CACE,OAAO,OAAW,KAAe,OAAO,eAC1C,aAAa,QAAQ,eAAgB,KAAK,UAAUN,EAAa,CAAC,EAClElB,GAAS,CACP,KAAM,sBACN,QAASkB,EAAA,CACV,EAEL,OAASvc,EAAO,CACd,QAAQ,MAAM,iCAAkCA,CAAK,CACvD,CACF,CAKO,SAAS8c,IAA4B,CAC1C,MAAO,CAAE,GAAGP,EAAA,CACd,CAKA,eAAsBQ,GAAW9c,EAA8B,CAC7D,GAAI,CAAAuc,GAAc,IAAIvc,CAAK,EAE3B,GAAI,CAEFuc,GAAc,IAAIvc,CAAK,EAGvBob,GAAS,CACP,KAAM,oBACN,QAAS,CAAE,MAAApb,CAAA,CAAM,CAClB,EAGD,GAAI,CACE,OAAOF,EAAQ,KAAeA,GAAK,MAAM,MAC3C,MAAMA,EAAI,KAAK,KAAKE,CAAK,CAE7B,MAAQ,CAER,CACF,OAASD,EAAO,CACd,QAAQ,MAAM,iCAAkCA,CAAK,EACrDwc,GAAc,OAAOvc,CAAK,CAC5B,CACF,CAKA,eAAsB+c,GAAQ/c,EAA8B,CAC1D,GAAKuc,GAAc,IAAIvc,CAAK,EAE5B,GAAI,CACFuc,GAAc,OAAOvc,CAAK,EAE1Bob,GAAS,CACP,KAAM,iBACN,QAAS,CAAE,MAAApb,CAAA,CAAM,CAClB,EAGD,GAAI,CACE,OAAOF,EAAQ,KAAeA,GAAK,MAAM,MAC3C,MAAMA,EAAI,KAAK,KAAKE,CAAK,CAE7B,MAAQ,CAER,CACF,OAASD,EAAO,CACd,QAAQ,MAAM,8BAA+BA,CAAK,CACpD,CACF,CAKO,SAASid,GAAahd,EAAeid,EAAsB,CAC5DA,GACFT,GAAU,IAAIxc,CAAK,EACnBob,GAAS,CACP,KAAM,kBACN,QAAS,CAAE,MAAApb,CAAA,CAAM,CAClB,IAEDwc,GAAU,OAAOxc,CAAK,EACtBob,GAAS,CACP,KAAM,kBACN,QAAS,CAAE,MAAApb,CAAA,CAAM,CAClB,EAEL,CAKO,SAASkd,GAAeld,EAAwB,CACrD,OAAOuc,GAAc,IAAIvc,CAAK,CAChC,CAKO,SAASmd,GAAWnd,EAAwB,CACjD,OAAOwc,GAAU,IAAIxc,CAAK,CAC5B,CAKA,eAAsBod,GAAoBjC,EAIxB,CAChB,MAAMyB,EAASC,GAAA,EAGf,GAAID,EAAO,sBACT,GAAI,CASF,GAPkB,CAAC9X,GAAA,GAAuB,CAACE,GAAA,GAOvC,OAAOlF,EAAQ,KAAe,CAACA,GAAK,MAAM,KAC5C,OAGF,MAAMU,EAAO,MAAMV,EAAI,KAAK,OAC5B,GAAI,CAAC,MAAM,QAAQU,CAAI,GAAKA,EAAK,SAAW,EAC1C,OAIF,MAAMH,EADYG,EAAK,KAAME,GAAWA,EAAE,MAAM,GACpB,GAE5B,UAAWgE,KAAOlE,EAAM,CAEtB,GADIkE,EAAI,KAAOrE,GACXqE,EAAI,KAAK,WAAW,QAAQ,GAAKA,EAAI,KAAK,WAAW,SAAS,EAAG,SAGrE,MAAM2Y,EAAa3Y,EAAI,cAAgBA,EAAI,WAAa,GAC5B,KAAK,MAAQ2Y,IAAe,IAAO,IAEtCT,EAAO,qBAC9B,MAAME,GAAWpY,EAAI,EAAE,CAE3B,CACF,OAAS3E,EAAO,CACd,QAAQ,KAAK,mCAAoCA,CAAK,CACxD,CAIEob,GAAS,aAAeA,EAAQ,YAAcyB,EAAO,iBACvDxB,GAAS,CACP,KAAM,wBACN,QAAS,CAAE,OAAQ,SAAU,MAAOD,EAAQ,YAAY,CACzD,EAICA,GAAS,UAAYA,EAAQ,SAAWyB,EAAO,cACjDxB,GAAS,CACP,KAAM,wBACN,QAAS,CAAE,OAAQ,MAAO,MAAOD,EAAQ,SAAS,CACnD,EAICA,GAAS,cAAgBA,EAAQ,aAAeyB,EAAO,mBACzDxB,GAAS,CACP,KAAM,wBACN,QAAS,CAAE,OAAQ,UAAW,MAAOD,EAAQ,aAAa,CAC3D,EAGGyB,EAAO,iBACTD,GAAW,CAAE,gBAAiB,GAAO,EAG3C,CAKA,eAAsBW,IAAqC,CACzD,MAAMb,GAAA,EACNN,GAAA,EAGAnP,GAAM,MAAMhL,GAAS,CACfA,EAAM,OAAS,yBACjBob,GAAA,CAEJ,CAAC,EAGD,YAAY,IAAM,CAChBA,GAAA,CACF,EAAG,GAAK,CACV,qQCrPMG,GAAyB,EACzBC,GAAsB,GAAK,IAC3BC,GAAwB,IAE9B,IAAIC,GAAc,GACdC,GAAuD,KACvDC,GAA2B,GAC/B,MAAMC,OAAmB,IAGzB,SAASC,IAAyB,CAEhC,MAAMC,EAAgB,IAAI,IAAIzd,EAAa,WAAW,KAAK,IAAII,GAAKA,EAAE,EAAE,CAAC,EACzEkd,GAAaA,GAAW,OAAOlZ,GAAOqZ,EAAc,IAAIrZ,EAAI,EAAE,CAAC,EAG/DmZ,GAAa,QAAQ7d,GAAS,CACvB+d,EAAc,IAAI/d,CAAK,GAC1B6d,GAAa,OAAO7d,CAAK,CAE7B,CAAC,EAGD,MAAMge,EAAkBvD,GAAsB,WAC9C,OAAO,KAAKuD,EAAgB,WAAW,EAAE,QAAQhe,GAAS,CACnD+d,EAAc,IAAI/d,CAAK,GAC1Bge,EAAgB,QAAQhe,EAAO,CAAE,OAAQ,GAAM,CAEnD,CAAC,CACH,CAEO,SAASie,IAAkC,CAChD,GAAIP,IAAe,OAAO,OAAW,KAAe,CAAC5Y,KACnD,OAEF4Y,GAAc,GAEd,IAAIQ,EAAwBX,GAAyB,GAAK,IAG1Dd,GAAA,EACG,KAAKG,GAAU,CACVA,GAAQ,sBACVsB,EAAwB,KAAK,IAAI,EAAGtB,EAAO,mBAAmB,EAAI,GAAK,IAE3E,CAAC,EACA,MAAM,IAAM,CACX,MAAMA,EAASC,KAAA,EACXD,GAAQ,sBACVsB,EAAwB,KAAK,IAAI,EAAGtB,EAAO,mBAAmB,EAAI,GAAK,IAE3E,CAAC,EAEH,MAAMuB,EAAqBte,GAAiB,CACtC,MAAM,QAAQA,CAAO,IACvB+d,GAAa/d,EACbie,GAAA,EACAM,GAAA,EAEJ,EAEMC,EAAkBlQ,GAAU,GAAG,eAAgBgQ,CAAiB,EAGhEG,EAAoBhe,EAAa,aAC5BC,EAAM,SACf,CAACF,EAAUke,IAAa,CACtB,GAAI,CAACle,GAAYA,IAAake,EAAU,OACzBje,EAAa,WAAW,KAAK,KAAKoE,GAAOA,EAAI,KAAOrE,CAAQ,GAC/D,SACVme,GAAmBne,EAAU,CAAE,SAAU,GAAO,EAEhDoa,GAAsB,WAAW,QAAQpa,EAAU,CAAE,OAAQ,GAAM,CAEvE,GAGIoe,EAAuBne,EAAa,aAC/BC,EAAM,KACf,IAAM,CACJ6d,GAAA,CACF,GAGFT,GAAgB,YAAY,IAAM,CAChCG,GAAA,EACAY,GAAoBR,CAAqB,EAAE,MAAM,IAAM,CAAC,CAAC,CAC3D,EAAGV,EAAmB,EAGtBkB,GAAoBR,CAAqB,EAAE,MAAM,IAAM,CAAC,CAAC,EAGzD,OAAO,iBACL,eACA,IAAM,CACJG,EAAA,EACAC,EAAA,EACAG,EAAA,EACId,IACF,cAAcA,EAAa,CAE/B,EACA,CAAE,KAAM,GAAK,CAEjB,CAEA,eAAee,GAAoBC,EAAoC,CACrE,GAAI,CAAC7e,GAAK,MAAM,KAAM,OAEtB,IAAIU,EAAOod,GACX,GAAI,CAACpd,EAAK,OAAQ,CAChB,MAAMoe,EAAO,MAAM9e,EAAI,KAAK,OAAO,MAAM,IAAM,EAAE,EAC7C,MAAM,QAAQ8e,CAAI,IACpBpe,EAAOoe,EACPhB,GAAapd,EAEjB,CAEA,GAAI,CAACA,EAAK,OAAQ,OAElB,MAAMua,EAAM,KAAK,MACjB,UAAWrW,KAAOlE,EACZqe,GAAkBna,EAAKqW,EAAK4D,CAAW,GACzC,MAAMG,GAAuBpa,EAAK,YAAY,CAGpD,CAEA,SAASma,GAAkBna,EAAiBqW,EAAa4D,EAA8B,CAKrF,GAJI,CAACja,GAAO,CAACA,EAAI,IACbA,EAAI,QACJA,EAAI,UACJA,EAAI,QAEN,CAACA,EAAI,KACLA,EAAI,IAAI,WAAW,QAAQ,GAC3BA,EAAI,IAAI,WAAW,SAAS,GAC5BA,EAAI,IAAI,WAAW,OAAO,EAE1B,MAAO,GAET,MAAM2Y,EAAa3Y,EAAI,cAAgBA,EAAI,WAAa,EACxD,OAAK2Y,EACEtC,EAAMsC,GAAcsB,EADH,EAE1B,CAEA,eAAeG,GAAuBpa,EAAiByI,EAAyC,CAC9F,GAAI,GAACrN,GAAK,MAAM,WAAa+d,GAAa,IAAInZ,EAAI,EAAE,GACpD,CAAAmZ,GAAa,IAAInZ,EAAI,EAAE,EACvB,GAAI,CACF,IAAImJ,EAA0B,KAC9B,GAAI/N,EAAI,KAAK,eACX,GAAI,CACF,MAAMif,EAAU,MAAMjf,EAAI,KAAK,eAAe,CAC5C,GAAI4E,EAAI,GACR,SAAU+Y,GACV,QAAS,IACV,EACGsB,GAAS,SAAWA,EAAQ,UAC9BlR,EAAWkR,EAAQ,QAEvB,MAAQ,CAER,CAGF,MAAMjf,EAAI,KAAK,UAAU,CAAE,GAAI4E,EAAI,GAAI,EAEvC+V,GAAsB,WAAW,aAAa,CAC5C,MAAO/V,EAAI,GACX,MAAOA,EAAI,MACX,IAAKA,EAAI,IACT,SAAAmJ,EACA,YAAa,KAAK,MAClB,aAAcnJ,EAAI,aAClB,OAAAyI,CAAA,CACD,EAEDiO,GAAS,CACP,KAAM,sBACN,QAAS,CAAE,MAAO1W,EAAI,GAAI,OAAAyI,CAAA,CAAO,CAClC,CACH,OAASpN,EAAO,CACd,QAAQ,KAAK,gCAAiC2E,GAAK,GAAI3E,CAAK,CAC9D,SACE8d,GAAa,OAAOnZ,EAAI,EAAE,CAC5B,EACF,CAEA,SAAS0Z,IAAmC,CAC1C,MAAM7d,EAAQka,GAAsB,WAC9BuE,EAAS,IAAI,IAAIpB,GAAW,IAAIlZ,GAAO,CAACA,EAAI,GAAIA,CAAG,CAAC,CAAC,EACrDqZ,EAAgB,IAAI,IAAIzd,EAAa,WAAW,KAAK,IAAII,GAAKA,EAAE,EAAE,CAAC,EAGzEH,EAAM,UAEN,OAAO,KAAKA,EAAM,WAAW,EAAE,QAAQP,GAAS,CAE9C,GAAI,CAAC+d,EAAc,IAAI/d,CAAK,EAAG,CAC7BO,EAAM,QAAQP,EAAO,CAAE,OAAQ,GAAM,EACrC,MACF,CAEA,MAAMif,EAAOD,EAAO,IAAIhf,CAAK,GAEzB,CAACif,GAAQ,CAACA,EAAK,WACjB1e,EAAM,QAAQP,EAAO,CAAE,OAAQ,GAAM,CAEzC,CAAC,CACH,CAEA,eAAsBwe,GACpBxe,EACA6B,EACe,CACf,GAAI,CAAC/B,GAAK,MAAM,KAAM,CACpB2a,GAAsB,WAAW,QAAQza,EAAO,CAAE,OAAQ,GAAM,EAChE,MACF,CACA,GAAI,CACF,MAAMF,EAAI,KAAK,KAAK,CAAE,GAAIE,EAAO,EACjCya,GAAsB,WAAW,QAAQza,CAAK,EAC9Cob,GAAS,CACP,KAAM,oBACN,QAAS,CAAE,MAAApb,CAAA,CAAM,CAClB,EACG6B,GAAS,UACX,MAAM/B,EAAI,KAAK,SAAS,CAAE,GAAIE,CAAA,CAAO,EAAE,MAAM,IAAM,CAAC,CAAC,CAEzD,OAASD,EAAO,CACd,QAAQ,KAAK,+BAAgCC,EAAOD,CAAK,CAC3D,CACF,CAEO,SAASmf,GAAwBlf,EAAqB,CAC3Dya,GAAsB,WAAW,YAAYza,CAAK,CACpD,CAEA,eAAsBmf,GAAmBnf,EAA8B,CACrE,MAAM0E,EAAMkZ,GAAW,KAAKld,GAAKA,EAAE,KAAOV,CAAK,EAC1C0E,GACL,MAAMoa,GAAuBpa,EAAK,QAAQ,CAC5C,yMCnQO,SAAS0a,IAAsB,CACpC,MAAMzE,EAAcF,GAAsBla,GAASA,EAAM,WAAW,EAC9D8e,EAAiBxb,UACrB,IAAM,OAAO,OAAO8W,CAAW,EAAE,OAAO2E,GAAS,CAACA,EAAM,YAAY,EACpE,CAAC3E,CAAW,GAGd,GAAI,CAAC0E,EAAe,OAClB,OAAO,KAGT,MAAMT,EAAO,CAAC,GAAGS,CAAc,EAC5B,KAAK,CAACtc,EAAGC,KAAOA,EAAE,aAAe,IAAMD,EAAE,aAAe,EAAE,EAC1D,MAAM,EAAG,CAAC,EAEb,OACEhC,OAAC,OAAI,UAAU,oDACZ,UAAA6d,EAAK,IAAIU,GACRve,OAAC,WAEC,UAAU,8IAEV,UAAAA,OAAC,OAAI,UAAU,6EACZ,UAAAue,EAAM,SACLte,MAAC,OACC,IAAKse,EAAM,SACX,IAAKA,EAAM,OAASA,EAAM,KAAO,eACjC,UAAU,iCAGX,OAAI,UAAU,6DACb,SAAAte,MAACue,GAAA,CAAK,KAAM,GAAI,EAClB,EAEFve,MAAC,QAAK,UAAU,uEAAuE,GACzF,EAEAD,OAAC,OAAI,UAAU,SACb,UAAAA,OAAC,OAAI,UAAU,6EACb,UAAAC,MAACwe,GAAA,CAAY,KAAM,GAAI,EACvBxe,MAAC,QAAK,qBAAS,GACjB,EACAA,MAAC,KAAE,UAAU,gDACV,WAAM,OAASse,EAAM,KAAO,eAC/B,EACAve,OAAC,KAAE,UAAU,yBACV,UAAAue,EAAM,SAAW,SACd,2BACA,8BAA+B,IAAI,KACpCG,GAAoBH,EAAM,aAAe,KAAK,MAAO,CAAE,UAAW,GAAM,GAC7E,EACAve,OAAC,OAAI,UAAU,+BACb,UAAAA,OAAC,UACC,KAAK,SACL,QAAS,IAAMyd,GAAmBc,EAAM,MAAO,CAAE,SAAU,GAAM,EACjE,UAAU,yKAEV,UAAAte,MAAC8M,GAAA,CAAU,KAAM,GAAI,EAAE,YAGzB9M,MAAC,UACC,KAAK,SACL,QAAS,IAAMke,GAAwBI,EAAM,KAAK,EAClD,UAAU,yHACX,0BAED,EACF,GACF,IAjDKA,EAAM,MAmDd,EACAD,EAAe,OAAST,EAAK,QAC5B7d,OAAC,OAAI,UAAU,iGAAiG,cAC5Gse,EAAe,OAAST,EAAK,OAAO,uBACxC,GAEJ,CAEJ,CC7DA,MAAMc,GAAgC,CACpC,UAAW,OAAO,UAAc,KAAe,eAAgB,UAC/D,MAAO,KACP,SAAU,KACV,aAAc,KACd,gBAAiB,KACjB,YAAa,KAAK,KACpB,EAEA,SAASC,GAAoB5H,EAAiB6H,EAA4C,CACxF,GAAI7H,IAAS,OACX,OAAOA,EAET,MAAM8H,EAAQ,OAAOD,EAAQ,OAAU,SAAWA,EAAQ,MAAQ,KAClE,OAAIC,IAAU,MAAQ,CAACD,EAAQ,UAAYC,GAAS,IAC3C,YAELA,IAAU,MAAQD,EAAQ,UAAYC,GAAS,IAC1C,cAEF,UACT,CAEO,MAAMC,GAAgBpgB,GAAA,EAC3BqgB,GACEpgB,IAAQ,CACN,QAAS+f,GACT,aAAc,WACd,cAAe,WACf,WAAYM,GACVrgB,EAAIY,GAAS,CACX,MAAM0f,EAAc,CAClB,GAAG1f,EAAM,QACT,GAAGyf,EACH,UACE,OAAOA,EAAO,WAAc,UAAYA,EAAO,UAAYzf,EAAM,QAAQ,UAC3E,YAAayf,GAAU,gBAAiBA,EAASA,EAAO,YAAe,KAAK,KAAI,EAE5EE,EAAgBP,GAAoBpf,EAAM,aAAc0f,CAAW,EACzE,MAAO,CACL,QAASA,EACT,cAAAC,CAAA,CAEJ,CAAC,EACH,QAASnI,GACPpY,EAAIY,GAAS,CACX,MAAM2f,EAAgBP,GAAoB5H,EAAMxX,EAAM,OAAO,EAC7D,MAAO,CACL,aAAcwX,EACd,cAAAmI,CAAA,CAEJ,CAAC,IAEL,CACE,KAAM,oBACN,WAAY3f,IAAU,CACpB,aAAcA,EAAM,eAEtB,mBAAoB,IAAMA,GAAS,CAC7BA,IACFA,EAAM,cAAgBof,GACpBpf,EAAM,aACNA,EAAM,SAAWmf,EAAA,EAGvB,EACF,CAEJ,ECrFMS,GAGF,CACF,YAAa,CACX,SAAU,IACV,WAAY,KACZ,uBAAwB,MAE1B,SAAU,CACR,SAAU,IACV,WAAY,KACZ,uBAAwB,MAE1B,UAAW,CACT,SAAU,IACV,WAAY,KACZ,uBAAwB,KAE5B,EAEA,IAAIzC,GAAc,GACd0C,GAAmC,KAEhC,SAASC,IAAuB,CACjC3C,KACJA,GAAc,GAEd4C,GAAmBR,GAAc,WAAW,aAAa,EAEzDM,GAAcN,GAAc,aACjBvf,EAAM,cACf,CAACwX,EAAMpM,IAAS,CACVoM,IAASpM,GACX2U,GAAmBvI,CAAI,CAE3B,GAGF,OAAO,iBACL,eACA,IAAM,CACJqI,KAAA,CACF,EACA,CAAE,KAAM,GAAK,EAEjB,CAEO,SAASG,GAAaxI,EAAuB,CAClD+H,GAAc,WAAW,QAAQ/H,CAAI,CACvC,CAEA,SAASuI,GAAmBvI,EAA0B,CACpD,MAAMyI,EAASL,GAAapI,CAAI,GAAKoI,GAAa,SAClD/D,GAAoBoE,CAAM,EAC1BpF,GAAS,CACP,KAAM,mBACN,QAAS,CACP,cAAerD,EACf,aAAc+H,GAAc,WAAW,aACzC,CACD,CACH,uICzDMW,GAKD,CACH,CACE,GAAI,cACJ,MAAO,cACP,YAAa,oDACb,QAAS,iCAEX,CACE,GAAI,WACJ,MAAO,WACP,YAAa,wCACb,QAAS,qCAEX,CACE,GAAI,YACJ,MAAO,aACP,YAAa,gDACb,QAAS,oCAEX,CACE,GAAI,OACJ,MAAO,OACP,YAAa,6DACb,QAAS,kBAEb,EAEO,SAASC,GAAkB,CAAE,SAAAC,EAAU,UAAAC,EAAW,QAAAvT,EAAS,SAAAwT,GAAmB,CACnF,aACG5Z,GAAA,CACC,SAAAjG,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,GACpB,QAAS,CAAE,QAAS,GACpB,KAAM,CAAE,QAAS,GACjB,UAAU,2FAEV,SAAAF,OAACE,EAAO,IAAP,CACC,QAAS,CAAE,EAAG,GAAI,QAAS,GAC3B,QAAS,CAAE,EAAG,EAAG,QAAS,GAC1B,KAAM,CAAE,EAAG,GAAI,QAAS,GACxB,UAAU,oHAEV,UAAAF,OAAC,UAAO,UAAU,+CAChB,UAAAA,OAAC,OACC,UAAAC,MAAC,KAAE,UAAU,oDAAoD,uBAAW,EAC5EA,MAAC,MAAG,UAAU,oCAAoC,yCAA6B,EAC/EA,MAAC,KAAE,UAAU,yBACV,SAAA2f,IAAa,OACV,6CAA6CC,CAAS,IACtD,gBAAgBD,CAAQ,8BAC9B,GACF,EACA3f,MAAC,UACC,KAAK,SACL,QAASqM,EACT,UAAU,sIACX,kBAED,EACF,QACC,OAAI,UAAU,4BACZ,SAAAoT,GAAW,IAAIK,GAAQ,CACtB,MAAMC,EAAaJ,IAAaG,EAAK,GAC/BE,EAAcF,EAAK,KAAO,QAAUF,IAAcE,EAAK,GAC7D,OACE/f,OAAC,UAEC,KAAK,SACL,QAAS,IAAM,CACbwf,GAAaO,EAAK,EAAE,EACpBD,EAASC,EAAK,EAAE,CAClB,EACA,UAAW,4FACTC,EACI,+EACA,kDACN,GAEA,UAAAhgB,OAAC,OAAI,UAAU,2CACb,UAAAA,OAAC,OACC,UAAAC,MAAC,KAAE,UAAU,mCAAoC,SAAA8f,EAAK,MAAM,EAC5D9f,MAAC,KAAE,UAAU,yBAA0B,WAAK,QAAQ,GACtD,EACC+f,GACC/f,MAAC,QAAK,UAAU,gFAAgF,kBAEhG,GAEJ,EACAA,MAAC,KAAE,UAAU,yBAA0B,WAAK,YAAY,EACvD8f,EAAK,KAAO,QAAUE,GACrBjgB,OAAC,KAAE,UAAU,2BAA2B,uCACX6f,CAAA,EAC7B,IA3BGE,EAAK,GA+BhB,CAAC,EACH,IACF,GAEJ,CAEJ,CCjHA,SAASG,GAAcpB,EAA8B,CACnD,OAAI,OAAOA,GAAU,SAAiB,IAC/B,GAAG,KAAK,MAAMA,EAAQ,GAAG,CAAC,GACnC,CAEO,SAASqB,IAAmB,CACjC,MAAMtB,EAAUE,GAAcvf,GAASA,EAAM,OAAO,EAC9C4gB,EAAerB,GAAcvf,GAASA,EAAM,YAAY,EACxD2f,EAAgBJ,GAAcvf,GAASA,EAAM,aAAa,EAC1D,CAAC6gB,EAAcC,CAAe,EAAIjhB,WAAS,EAAK,EAEhD8P,EAAOrM,UAAQ,IACf+b,EAAQ,SACH5e,MAACsgB,GAAA,CAAgB,KAAM,GAAI,UAAU,mBAAmB,EAE1DtgB,MAACugB,GAAA,CAAQ,KAAM,GAAI,UAAU,iBAAiB,EACpD,CAAC3B,EAAQ,QAAQ,CAAC,EAEf4B,EAAaP,GAAcrB,EAAQ,KAAK,EAGxC6B,EAFaN,IAAiB,OAEL,UAAUjB,CAAa,GAAKA,EAE3D,OACEnf,OAAAyP,WAAA,CACE,UAAAzP,OAAC,OAAI,UAAU,+DACb,UAAAA,OAAC,UACC,KAAK,SACL,QAAS,IAAMsgB,EAAgB,EAAI,EACnC,UAAU,6LAEV,UAAAtgB,OAAC,OAAI,UAAU,0BACZ,UAAAmP,EACDnP,OAAC,OAAI,UAAU,8BACb,UAAAC,MAAC,QAAK,UAAU,qDAAqD,mBAAO,EAC5EA,MAAC,QAAK,UAAU,mCAAoC,SAAAwgB,CAAA,CAAW,GACjE,GACF,EACAzgB,OAAC,OAAI,UAAU,yCACb,UAAAC,MAAC,QAAK,UAAU,qDAAqD,gBAAI,EACzEA,MAAC,QAAK,UAAU,mCAAoC,SAAAygB,CAAA,CAAU,GAChE,EACAzgB,MAAC,OAAI,UAAU,sDACb,eAAC0gB,GAAA,CAAI,KAAM,GAAI,EACjB,KAED,CAAC9B,EAAQ,iBACP,QAAK,UAAU,yBAAyB,yCAA6B,GAE1E,EACCwB,GACCpgB,MAAC0f,GAAA,CACC,SAAUS,EACV,UAAWjB,EACX,QAAS,IAAMmB,EAAgB,EAAK,EACpC,SAAWtJ,GAAoB,CAC7BwI,GAAaxI,CAAI,EACjBsJ,EAAgB,EAAK,CACvB,GACF,EAEJ,CAEJ,CCtCO,MAAMM,GAAiBjiB,GAAoBC,IAAQ,CACxD,QAAS,GACT,OAAQ,OACR,WAAY,OACZ,aAAckO,GACZlO,EAAIY,GAAS,CACX,MAAMqhB,EAAU,CAAC,GAAGrhB,EAAM,QAASsN,CAAQ,EAAE,MAAM,IAAY,EAC/D,MAAO,CACL,OAAQA,EACR,QAAA+T,CAAA,CAEJ,CAAC,EACH,YAAaC,GACXliB,EAAI,KAAO,CACT,WAAYkiB,CAAA,EACZ,CACN,EAAE,EC3CIC,GAAiBC,GACjBA,GAAS,IAAa,eACtBA,GAAS,GAAY,iBAClB,mBAGF,SAASC,IAAgB,CAC9B,MAAMC,EAASN,GAAephB,GAASA,EAAM,MAAM,EAC7CqhB,EAAUD,GAAephB,GAASA,EAAM,OAAO,EAC/C2hB,EAAaP,GAAephB,GAASA,EAAM,UAAU,EACrD,CAAC4hB,EAAUC,CAAW,EAAIhiB,WAAS,EAAI,EAEvCiiB,EAAUxe,UAAQ,IACjBoe,EACE,CAAC,GAAGA,EAAO,IAAI,EAAE,KAAK,CAAClf,EAAGC,IAAMA,EAAE,SAAWD,EAAE,QAAQ,EAAE,MAAM,EAAG,CAAC,EADtD,GAEnB,CAACkf,CAAM,CAAC,EAELK,EAAkBze,UAAQ,IAAM,CACpC,GAAI,CAAC+d,EAAQ,OAAQ,MAAO,GAC5B,MAAMW,EAAM,KAAK,IAAI,GAAGX,EAAQ,IAAI/T,GAAYA,EAAS,SAAW,CAAC,EAAG,CAAC,EACzE,OAAO+T,EAAQ,MAAM,GAAG,EAAE,IAAI,CAAC/T,EAAUvB,EAAOkW,KAAS,CACvD,EAAIlW,EAAQ,KAAK,IAAI,EAAGkW,EAAI,OAAS,CAAC,EAAK,IAC3C,EAAG,GAAM,KAAK,IAAI3U,EAAS,SAAW,EAAG0U,CAAG,EAAIA,EAAO,IACvD,CACJ,EAAG,CAACX,CAAO,CAAC,EAEZ,GAAI,CAACK,EAAQ,OAAO,KAEpB,MAAMQ,EAAQR,EAAO,QACfJ,EAAWK,GAAc,KAAK,IAAIO,EAAQ,IAAK,IAAI,EACnDV,EAAQ,KAAK,IAAIU,EAAQZ,EAAU,CAAC,EACpCa,EAAU,KAAK,MAAMX,EAAQ,GAAG,EAChCY,EAAWb,GAAcC,CAAK,EAEpC,OACEhhB,OAAC,OAAI,UAAU,0FACb,UAAAA,OAAC,UAAO,UAAU,yCAChB,UAAAA,OAAC,OAAI,UAAU,qCACb,UAAAC,MAAC4hB,GAAA,CAAS,KAAM,GAAI,UAAU,kBAAkB,EAChD5hB,MAAC,MAAG,UAAU,mDAAmD,0BAAc,GACjF,EACAA,MAAC,UACC,KAAK,SACL,QAAS,IAAMohB,EAAYzW,GAAQ,CAACA,CAAI,EACxC,UAAU,6DAET,WAAW,OAAS,QACvB,EACF,EACA5K,OAAC,OAAI,UAAU,oCACb,UAAAA,OAAC,OAAI,UAAU,uBACb,UAAAC,MAAC,OAAI,UAAU,yBAAyB,uBAAW,EACnDD,OAAC,OAAI,UAAU,mCACZ,UAAA0hB,EAAM,QAAQ,CAAC,EAAE,MAAI,IACtB1hB,OAAC,QAAK,UAAU,yBAAyB,eACpC8gB,EAAS,QAAQ,CAAC,EAAE,MACtBI,EAAO,OAAS,MAAMA,EAAO,OAAO,QAAQ,CAAC,CAAC,YAAc,IAC/D,GACF,EACAjhB,MAAC,OAAI,UAAU,qDACb,SAAAA,MAAC,OACC,UAAW,uBAAuB+gB,GAAS,IAAO,aAAeA,GAAS,GAAM,eAAiB,gBAAgB,GACjH,MAAO,CAAE,MAAO,GAAGW,CAAO,IAAI,GAElC,EACA3hB,OAAC,KAAE,UAAW,8BAA8B4hB,CAAQ,GAAK,UAAAD,EAAQ,oBAAgB,GACnF,EACA3hB,OAAC,OAAI,UAAU,mHACb,UAAAC,MAAC,QAAK,UAAU,iBAAiB,mCAAuB,EACxDA,MAAC,OACC,MAAM,MACN,OAAO,KACP,QAAQ,aACR,oBAAoB,OACpB,UAAU,kBAEV,SAAAA,MAAC,YACC,KAAK,OACL,OAAO,eACP,YAAY,IACZ,OAAQshB,EAAgB,IAAIO,GAAS,GAAGA,EAAM,CAAC,IAAIA,EAAM,CAAC,EAAE,EAAE,KAAK,GAAG,GACxE,EACF,EACF,GACF,EACCV,GACCphB,OAAC,OAAI,UAAU,iCACb,UAAAA,OAAC,OAAI,UAAU,oDACb,UAAAA,OAAC,OAAI,UAAU,iFACb,UAAAC,MAACkL,GAAA,CAAU,KAAM,GAAI,EAAE,YAEzB,QACC,OAAI,UAAU,YACZ,SAAAmW,EAAQ,IAAI3d,GACX3D,OAAC,OAEC,UAAU,4FAEV,UAAAA,OAAC,OAAI,UAAU,UACb,UAAAC,MAAC,KAAE,UAAU,oCACV,WAAI,OAAS0D,EAAI,KAAO,eAC3B,QACC,KAAE,UAAU,yBAA0B,SAAAA,EAAI,SAAW,SAAS,GACjE,EACA3D,OAAC,QAAK,UAAU,oCACb,UAAA2D,EAAI,SAAS,QAAQ,CAAC,EAAE,OAC3B,IAXKA,EAAI,MAaZ,EACH,GACF,EACA3D,OAAC,OAAI,UAAU,oDACb,UAAAA,OAAC,OAAI,UAAU,iFACb,UAAAC,MAAC2M,GAAA,CAAc,KAAM,GAAI,EAAE,UAE7B,EACC+U,GAAW,GACV1hB,MAAC,OAAI,UAAU,mFAAmF,mEAElG,EACE0hB,GAAW,SACZ,OAAI,UAAU,yFAAyF,oEAExG,QAEC,OAAI,UAAU,+FAA+F,yEAE9G,GAEJ,GACF,GAEJ,CAEJ,CCzHA,MAAMI,GAA2E,CAC/E,CAAE,GAAI,YAAa,MAAO,YAAa,KAAM9hB,MAACiL,GAAA,CAAS,KAAM,GAAI,GACjE,CAAE,GAAI,UAAW,MAAO,UAAW,KAAMjL,MAACG,GAAA,CAAS,KAAM,GAAI,GAC7D,CAAE,GAAI,YAAa,MAAO,YAAa,KAAMH,MAACmL,GAAA,CAAO,KAAM,GAAI,GAC/D,CAAE,GAAI,SAAU,MAAO,SAAU,KAAMnL,MAACmL,GAAA,CAAO,KAAM,GAAI,GACzD,CAAE,GAAI,OAAQ,MAAO,OAAQ,KAAMnL,MAAC2W,GAAA,CAAK,KAAM,GAAI,EACrD,EAEO,SAASoL,GAAY,CAAE,QAAAC,EAAU,GAAM,SAAAC,GAA8B,CAC1E,KAAM,CAACC,EAAcC,CAAe,EAAI/iB,WAAiB,EAAE,EACrD,CAACwQ,EAAUwS,CAAW,EAAIhjB,WAA0C,IAAI,EACxE,CAACijB,EAAcC,CAAe,EAAIljB,WAAS,EAAK,EAChD,CAACmjB,EAAaC,CAAc,EAAIpjB,WAAS,EAAK,EAC9CwE,EAAejB,SAAuB,IAAI,EAEhDI,YAAU,IAAM,CACd,GAAI,CAACif,EAAS,OAEd,MAAMS,EAAkB,IAAM,CAC5B,MAAMC,EAAY,OAAO,eACnBnM,EAAOmM,GAAW,WAAW,QAAU,GAE7C,GAAInM,EAAK,OAAS,GAAKA,EAAK,OAAS,IAAK,CAExC,MAAMoM,EAAQD,GAAW,WAAW,CAAC,EACrC,GAAIC,EAAO,CACT,MAAM1hB,EAAO0hB,EAAM,wBACnBP,EAAY,CACV,EAAGnhB,EAAK,KAAOA,EAAK,MAAQ,EAC5B,EAAGA,EAAK,IAAM,GACf,EACDkhB,EAAgB5L,CAAI,EACpBiM,EAAe,EAAI,CACrB,CACF,MACEA,EAAe,EAAK,EACpBL,EAAgB,EAAE,EAClBC,EAAY,IAAI,CAEpB,EAEMQ,EAAsB1iB,GAAkB,CACxC0D,EAAa,SAAW,CAACA,EAAa,QAAQ,SAAS1D,EAAE,MAAc,IACzEsiB,EAAe,EAAK,EACpBL,EAAgB,EAAE,EAClBC,EAAY,IAAI,EAEpB,EAEA,gBAAS,iBAAiB,kBAAmBK,CAAe,EAC5D,SAAS,iBAAiB,YAAaG,CAAkB,EAElD,IAAM,CACX,SAAS,oBAAoB,kBAAmBH,CAAe,EAC/D,SAAS,oBAAoB,YAAaG,CAAkB,CAC9D,CACF,EAAG,CAACZ,CAAO,CAAC,EAEZ,MAAMa,EAAe,MAAOC,GAAyB,CACnD,GAAKZ,EAEL,CAAAI,EAAgB,EAAI,EAEpB,GAAI,CACF,OAAQQ,EAAA,CACN,IAAK,OACH,MAAM,UAAU,UAAU,UAAUZ,CAAY,EAChDD,IAAWa,EAAUZ,CAAY,EACjC,MAEF,IAAK,YACL,IAAK,UACL,IAAK,YACL,IAAK,SAEH,GAAI,CACF,MAAMpjB,EAAI,MAAM,OACd,GAAGgkB,CAAQ,KAAKZ,CAAY,GAC5B,CAAE,UAAW,aAAa,KAAK,KAAK,IACpCa,GAAS,CAEHA,EAAM,OAAS,SAAWA,EAAM,MAElC,QAAQ,IAAI,0BAA2BA,EAAM,IAAI,CAErD,GAEFd,IAAWa,EAAUZ,CAAY,CACnC,OAASnjB,EAAO,CACd,QAAQ,MAAM,kCAAmCA,CAAK,CACxD,CACA,MAEN,OAASA,EAAO,CACd,QAAQ,MAAM,+BAAgCA,CAAK,CACrD,SACEujB,EAAgB,EAAK,EACrBE,EAAe,EAAK,EACpBL,EAAgB,EAAE,EAClBC,EAAY,IAAI,EAEhB,OAAO,gBAAgB,iBACzB,EACF,EAEA,MAAI,CAACJ,GAAW,CAACO,GAAe,CAAC3S,EAAiB,KAGhD5P,MAACiG,GAAA,CACE,SAAAsc,GAAe3S,GACd7P,OAACE,EAAO,IAAP,CACC,IAAK2D,EACL,QAAS,CAAE,QAAS,EAAG,MAAO,GAAK,EAAG,IACtC,QAAS,CAAE,QAAS,EAAG,MAAO,EAAG,EAAG,GACpC,KAAM,CAAE,QAAS,EAAG,MAAO,GAAK,EAAG,IACnC,WAAY,CAAE,SAAU,IACxB,UAAU,qCACV,MAAO,CACL,KAAM,GAAGgM,EAAS,CAAC,KACnB,IAAK,GAAGA,EAAS,CAAC,KAClB,UAAW,0BAGb,UAAA5P,MAAC,OAAI,UAAU,8GACZ,WACCD,OAAC,OAAI,UAAU,0DACb,UAAAC,MAACkG,GAAA,CAAQ,KAAM,GAAI,UAAU,6BAA6B,EAC1DlG,MAAC,QAAK,yBAAa,GACrB,EAEAD,OAAAyP,WAAA,CACG,UAAAsS,GAAQ,IAAIkB,GACXjjB,OAACE,EAAO,OAAP,CAEC,QAAS,IAAM4iB,EAAaG,EAAO,EAAE,EACrC,WAAY,CAAE,MAAO,MACrB,SAAU,CAAE,MAAO,KACnB,UAAU,uLACV,MAAOA,EAAO,MAEb,UAAAA,EAAO,KACRhjB,MAAC,QAAM,SAAAgjB,EAAO,MAAM,IARfA,EAAO,GAUf,EACDhjB,MAAC,UACC,QAAS,IAAM,CACbwiB,EAAe,EAAK,EACpBL,EAAgB,EAAE,EAClBC,EAAY,IAAI,EAChB,OAAO,gBAAgB,iBACzB,EACA,UAAU,0FACV,MAAM,QAEN,SAAApiB,MAACqL,GAAA,CAAE,KAAM,GAAI,GACf,EACF,EAEJ,EAEArL,MAAC,OAAI,UAAU,gJAAgJ,KAGrK,CAEJ,CC1IO,SAASijB,GAAkB1M,EAAkC,CAClE,MAAM2M,EAAY3M,EAAK,cAAc,OAC/B4M,EAAe5M,EAAK,OAGpB6M,EAAgB,CAEpB,2GAEA,sIAEA,sGAEA,yCACA,0DAGF,UAAWC,KAAWD,EAAe,CACnC,MAAME,EAAQJ,EAAU,MAAMG,CAAO,EACrC,GAAIC,EAAO,CACT,MAAMC,EACJL,EAAU,SAAS,MAAM,GAAKA,EAAU,SAAS,OAAO,GAAKA,EAAU,SAAS,MAAM,EAGxF,IAAIM,EAASF,EAAM,CAAC,GAAKA,EAAM,CAAC,EAC5BJ,EAAU,SAAS,QAAQ,GAAKA,EAAU,SAAS,OAAO,EAC5DM,EAAS,QACAN,EAAU,SAAS,QAAQ,GAAKA,EAAU,SAAS,KAAK,EACjEM,EAAS,MACAN,EAAU,SAAS,UAAU,GAAKA,EAAU,SAAS,MAAM,EACpEM,EAAS,OACAN,EAAU,SAAS,UAAU,IACtCM,EAAS,YAIX,IAAIC,EAAW,EACXH,EAAM,CAAC,GAAK,CAAC,MAAM,SAASA,EAAM,CAAC,EAAG,EAAE,CAAC,EAC3CG,EAAW,SAASH,EAAM,CAAC,EAAG,EAAE,EACvBA,EAAM,CAAC,GAAK,CAAC,MAAM,SAASA,EAAM,CAAC,EAAG,EAAE,CAAC,IAClDG,EAAW,SAASH,EAAM,CAAC,EAAG,EAAE,GAIlC,MAAMI,EAAUR,EAAU,MAAM,yCAAyC,EACnES,EAAWD,EAAU,SAASA,EAAQ,CAAC,EAAG,EAAE,EAAI,OAEtD,MAAO,CACL,KAAM,QACN,UAAWH,EAAS,OAAS,MAC7B,OAAQC,EAAO,cACf,SAAAC,EACA,SAAAE,EACA,aAAAR,CAAA,CAEJ,CACF,CAGA,GACED,EAAU,SAAS,MAAM,GACzBA,EAAU,SAAS,SAAS,GAC5BA,EAAU,SAAS,OAAO,GAC1BA,EAAU,SAAS,OAAO,GAC1BA,EAAU,SAAS,aAAa,GAChCA,EAAU,SAAS,QAAQ,EAC3B,CACA,IAAIU,EAAO,QACX,OAAIV,EAAU,SAAS,OAAO,GAAKA,EAAU,SAAS,QAAQ,KAAGU,EAAO,WACpEV,EAAU,SAAS,SAAS,GAAKA,EAAU,SAAS,WAAW,KAAGU,EAAO,cACzEV,EAAU,SAAS,SAAS,GAAKA,EAAU,SAAS,SAAS,KAAGU,EAAO,YACvEV,EAAU,SAAS,QAAQ,GAAKA,EAAU,SAAS,SAAS,KAAGU,EAAO,YACtEV,EAAU,SAAS,UAAU,GAAKA,EAAU,SAAS,WAAW,KAAGU,EAAO,aAEvE,CACL,KAAM,UACN,MAAOA,EACP,aAAAT,CAAA,CAEJ,CAGA,GACED,EAAU,SAAS,OAAO,GAC1BA,EAAU,SAAS,OAAO,GAC1BA,EAAU,SAAS,MAAM,GACzBA,EAAU,SAAS,QAAQ,GAC1BA,EAAU,SAAS,MAAM,IAAMA,EAAU,SAAS,OAAO,GAAKA,EAAU,SAAS,OAAO,GACzF,CACA,IAAIW,EAAO,QACPC,EAAK,SACL1Q,EAAO,WAGX,OAAI8P,EAAU,SAAS,OAAO,GAAKA,EAAU,SAAS,QAAQ,KACxDA,EAAU,SAAS,IAAI,GAAKA,EAAU,SAAS,MAAM,EAAGY,EAAK,SAC5DD,EAAO,WAEVX,EAAU,SAAS,QAAQ,GAAKA,EAAU,SAAS,OAAO,KACxDA,EAAU,SAAS,IAAI,GAAKA,EAAU,SAAS,MAAM,EAAGW,EAAO,QAC9DC,EAAK,UAERZ,EAAU,SAAS,QAAQ,GAAKA,EAAU,SAAS,SAAS,KAAGY,EAAK,YACpEZ,EAAU,SAAS,SAAS,GAAKA,EAAU,SAAS,WAAW,KAAGY,EAAK,cACvEZ,EAAU,SAAS,SAAS,GAAKA,EAAU,SAAS,SAAS,KAAGY,EAAK,WAElE,CACL,KAAM,QACN,MAAO,GAAGD,CAAI,OAAOC,CAAE,OAAO1Q,CAAI,GAClC,IAAK,SAASyQ,CAAI,IAAIC,CAAE,IAAI1Q,CAAI,GAChC,aAAA+P,CAAA,CAEJ,CAGA,GACED,EAAU,SAAS,QAAQ,GAC3BA,EAAU,SAAS,QAAQ,GAC3BA,EAAU,SAAS,WAAW,GAC9BA,EAAU,SAAS,OAAO,GACzBA,EAAU,SAAS,MAAM,IAAMA,EAAU,SAAS,QAAQ,GAAKA,EAAU,SAAS,QAAQ,GAC3F,CACA,IAAIW,EAAO,QACPC,EAAK,SACL1Q,EAAO,WACP2Q,EAGJ,OAAIb,EAAU,SAAS,OAAO,GAAKA,EAAU,SAAS,QAAQ,KAAGY,EAAK,WAClEZ,EAAU,SAAS,SAAS,GAAKA,EAAU,SAAS,WAAW,KAAGY,EAAK,cACvEZ,EAAU,SAAS,QAAQ,GAAKA,EAAU,SAAS,SAAS,KAAGY,EAAK,YACpEZ,EAAU,SAAS,QAAQ,GAAKA,EAAU,SAAS,OAAO,KAAGW,EAAO,UAItEX,EAAU,SAAS,MAAM,GACzBA,EAAU,SAAS,QAAQ,GAC3BA,EAAU,SAAS,OAAO,GAC1BA,EAAU,SAAS,WAAW,KAE9Ba,EAAa,eAGR,CACL,KAAM,SACN,MAAO,GAAGF,CAAI,OAAOC,CAAE,OAAO1Q,CAAI,GAAG2Q,EAAa,WAAWA,CAAU,GAAK,EAAE,GAC9E,IAAK,UAAUF,CAAI,IAAIC,CAAE,IAAI1Q,CAAI,GAAG2Q,EAAa,IAAIA,CAAU,GAAK,EAAE,GACtE,aAAAZ,CAAA,CAEJ,CAGA,GAAID,EAAU,SAAS,UAAU,GAAKA,EAAU,SAAS,cAAc,EAErE,MAAO,CACL,KAAM,WACN,MAHoBA,EAAU,MAAM,6BAA6B,IAG1C,CAAC,GAAKC,EAAa,QAAQ,0BAA2B,EAAE,EAC/E,aAAAA,CAAA,EAKJ,GACED,EAAU,SAAS,QAAQ,GAC3BA,EAAU,SAAS,SAAS,GAC5BA,EAAU,SAAS,MAAM,GACzBA,EAAU,SAAS,SAAS,GAC5BA,EAAU,SAAS,QAAQ,EAG3B,MAAO,CACL,KAAM,SACN,MAHkBA,EAAU,MAAM,kDAAkD,IAG/D,CAAC,GAAKC,EAC3B,aAAAA,CAAA,EAKJ,GACED,EAAU,SAAS,WAAW,GAC9BA,EAAU,SAAS,SAAS,GAC5BA,EAAU,SAAS,WAAW,GAC9BA,EAAU,SAAS,SAAS,EAE5B,MAAO,CACL,KAAM,YACN,MAAOC,EACP,aAAAA,CAAA,EAKJ,GACED,EAAU,SAAS,SAAS,GAC5BA,EAAU,SAAS,kBAAkB,GACrCA,EAAU,SAAS,gBAAgB,EAEnC,MAAO,CACL,KAAM,UACN,MAAOC,EACP,aAAAA,CAAA,EAKJ,GACED,EAAU,SAAS,MAAM,GACzBA,EAAU,SAAS,SAAS,GAC5BA,EAAU,SAAS,QAAQ,GAC3BA,EAAU,SAAS,WAAW,GAC9BA,EAAU,SAAS,WAAW,EAE9B,MAAO,CACL,KAAM,YACN,MAAOC,EACP,aAAAA,CAAA,EAKJ,GACED,EAAU,SAAS,iBAAiB,GACpCA,EAAU,SAAS,cAAc,GACjCA,EAAU,SAAS,uBAAuB,GAC1CA,EAAU,SAAS,sBAAsB,EAEzC,MAAO,CACL,KAAM,eACN,MAAOC,EACP,aAAAA,CAAA,EAKJ,GACED,EAAU,SAAS,YAAY,GAC/BA,EAAU,SAAS,YAAY,GAC/BA,EAAU,SAAS,eAAe,GAClCA,EAAU,SAAS,eAAe,GAClCA,EAAU,SAAS,cAAc,GACjCA,EAAU,SAAS,eAAe,GAClCA,EAAU,SAAS,UAAU,GAC7BA,EAAU,SAAS,cAAc,GACjCA,EAAU,SAAS,aAAa,GAChCA,EAAU,SAAS,WAAW,GAC9BA,EAAU,SAAS,UAAU,EAE7B,MAAO,CACL,KAAM,aACN,MAAOC,EACP,aAAAA,CAAA,EAKJ,GAAID,EAAU,SAAS,MAAM,GAAKA,EAAU,MAAM,WAAW,EAAG,CAC9D,MAAMc,EAAYd,EAAU,MAAM,qBAAqB,EACjDe,EAAaf,EAAU,MAAM,eAAe,EAClD,MAAO,CACL,KAAM,YACN,KAAMc,EAAY,SAASA,EAAU,CAAC,EAAG,EAAE,EAAI,EAC/C,MAAOC,IAAa,CAAC,EACrB,aAAAd,CAAA,CAEJ,CAGA,OAAID,EAAU,SAAS,MAAM,GAAKA,EAAU,SAAS,OAAO,GAAKA,EAAU,SAAS,OAAO,EAElF,CACL,KAAM,WACN,IAHeA,EAAU,MAAM,gCAAgC,IAG/C,CAAC,GAAKC,EACtB,aAAAA,CAAA,EAKG,CACL,KAAM,SACN,MAAOA,EACP,aAAAA,CAAA,CAEJ,CAKA,eAAsBe,GAAoBC,EAA4C,CACpF,MAAMte,EAAcC,EAAY,WAAW,KAE3C,GAAI,CAEF,KAAM,CAAE,kBAAAhC,CAAA,EAAsB,MAAAsgB,EAAA,kCAAAtgB,GAAA,KAAM,QAAO,uBAAe,wCAAAA,CAAA,qCAC1D,GAAIA,IACF,GAAI,CACF,KAAM,CAAE,IAAAhF,GAAQ,MAAAslB,EAAA,oBAAAC,CAAA,OAAM,QAAO,uBAAqB,OAAAhX,KAAA,cAAAgX,CAAA,qCAC5CC,EAAWze,EAAY,cACvB5D,EAAS,MAAOnD,EAAY,OAAO,gBAAiB,CACxD,MAAOqlB,EAAQ,aACf,KAAMG,CAAA,CACP,EACD,GAAIriB,EAAQ,CACVsiB,EAAM,QAAQtiB,CAAM,EACpB,MACF,CACF,OAASlD,EAAO,CACd,QAAQ,KAAK,kDAAmDA,CAAK,CACvE,CAIF,OAAQolB,EAAQ,MACd,IAAK,QACH,MAAMK,GAAoBL,CAAO,EACjC,MAEF,IAAK,WACH,MAAMM,GAAuBN,CAAO,EACpC,MAEF,IAAK,SACH,MAAMO,GAAqBP,CAAO,EAClC,MAEF,IAAK,YACH,MAAMQ,GAAwBR,CAAO,EACrC,MAEF,IAAK,UACH,MAAMS,GAAsBT,CAAO,EACnC,MAEF,IAAK,YACH,MAAMU,GAAuBV,CAAO,EACpC,MAEF,IAAK,eACH,MAAMW,GAA0BX,CAAO,EACvC,MAEF,IAAK,aACH,MAAMY,GAAyBZ,CAAO,EACtC,MAEF,IAAK,YACH,MAAMa,GAAuBb,CAAO,EACpC,MAEF,IAAK,WACH,MAAMc,GAAuBd,CAAO,EACpC,MAEF,IAAK,UACH,MAAMe,GAAsBf,CAAO,EACnC,MAEF,IAAK,QACH,MAAMgB,GAAoBhB,CAAO,EACjC,MAEF,IAAK,SACH,MAAMiB,GAAqBjB,CAAO,EAClC,MAEF,QAEE,MAAMO,GAAqBP,CAAO,EAExC,OAASplB,EAAO,CACd,QAAQ,MAAM,oCAAqCA,CAAK,EACxDwlB,EAAM,MAAM,sBAAsBJ,EAAQ,YAAY,EAAE,CAC1D,CACF,CAEA,eAAeK,GAAoBL,EAA6B,CAE1Dre,EAAY,WAAW,OAAS,UAClCA,EAAY,WAAW,QAAQ,OAAO,EACtC,MAAM,IAAI,QAAQuf,GAAW,WAAWA,EAAS,GAAG,CAAC,GAGvD,KAAM,CAAE,OAAA7B,EAAQ,SAAAC,EAAU,UAAA6B,EAAW,SAAA3B,EAAU,WAAA4B,GAAepB,EAC9D,GAAI,CAACX,GAAU,CAACC,EAAU,CACxBc,EAAM,MAAM,8CAA8C,EAC1D,MACF,CAGA,MAAMiB,EACJF,IAAc,OAASA,IAAc,OAASA,EAAY,MAG5D,GAAI,CACF,MAAM1jB,EAAY,KAAK,MACvB2iB,EAAM,KAAK,WAAWiB,CAAc,WAAW/B,CAAQ,IAAID,CAAM,KAAK,EAEtE,KAAM,CAAE,SAAAiC,CAAA,EAAa,MAAArB,EAAA,yBAAAqB,GAAA,KAAM,QAAO,uBAAsB,OAAApY,KAAA,mBAAAoY,CAAA,qCAClDxjB,EAAS,MAAMwjB,EAAS,WAAW,CACvC,OAAQjC,EAAO,cACf,SAAAC,EACA,UAAW+B,EACX,SAAA7B,EACA,WAAA4B,CAAA,CACD,EAEKG,EAAU,KAAK,MAAQ9jB,EAE7B,GAAIK,EAAO,QAAS,CAClB,MAAMd,EAAU,GAAGqkB,IAAmB,MAAQ,MAAQ,MAAM,kBAAkB/B,CAAQ,MAAMD,CAAM;AAAA,YAAevhB,EAAO,OAAO;AAAA,QAAWyjB,CAAO,KAAK/B,EAAW;AAAA,OAAUA,CAAQ,GAAK,EAAE,GAAG4B,EAAa,WAAWA,CAAU,GAAK,EAAE,GAkBtO,GAjBAhB,EAAM,QAAQpjB,CAAO,EAGrB,OAAO,cACL,IAAI,YAAY,cAAe,CAC7B,OAAQ,CACN,OAAAqiB,EACA,SAAAC,EACA,UAAW+B,EACX,SAAA7B,EACA,QAAS1hB,EAAO,QAChB,QAAS,GACX,CACD,GAIC,oBAAqB,OAAQ,CAC/B,MAAM0jB,EAAOzhB,GAAiB,WAAW,UAAY,KAC/C0hB,EAAY,IAAI,yBACpBD,IAAS,KACL,GAAGH,IAAmB,MAAQ,OAAS,QAAQ,SAASvjB,EAAO,OAAO,OACtE,GAAGujB,IAAmB,MAAQ,MAAQ,MAAM,UAAUvjB,EAAO,OAAO,wBAE1E2jB,EAAU,KAAOD,IAAS,KAAO,QAAU,QAC3C,gBAAgB,MAAMC,CAAS,CACjC,CACF,KACE,OAAM,IAAI,MAAM,wBAAwB,CAE5C,OAAS7mB,EAAY,CACnB,QAAQ,MAAM,8BAA+BA,CAAK,EAClD,MAAM8mB,EAAW9mB,EAAM,SAAW,iDAClCwlB,EAAM,MAAM,iBAAiBsB,CAAQ,EAAE,EAGvC,OAAO,cACL,IAAI,YAAY,cAAe,CAC7B,OAAQ,CAAE,OAAArC,EAAQ,SAAAC,EAAU,UAAA6B,EAAW,SAAA3B,EAAU,QAAS,GAAO,MAAOkC,CAAA,CAAS,CAClF,EAEL,CACF,CAEA,eAAepB,GAAuBN,EAA6B,CAQjE,GANoBre,EAAY,WAAW,OACvB,aAClBA,EAAY,WAAW,QAAQ,UAAU,EACzC,MAAM,IAAI,QAAQuf,GAAW,WAAWA,EAAS,GAAG,CAAC,GAGnD,CAAClB,EAAQ,MAAO,CAClBI,EAAM,MAAM,4BAA4B,EACxC,MACF,CAGA,OAAO,cACL,IAAI,YAAY,iBAAkB,CAChC,OAAQ,CAAE,MAAOJ,EAAQ,MAAM,CAChC,GAGHI,EAAM,KAAK,gBAAgBJ,EAAQ,KAAK,EAAE,CAC5C,CAEA,eAAeO,GAAqBP,EAA6B,CAC/D,GAAI,CAACA,EAAQ,MAAO,OAGpB,KAAM,CAAE,4BAAAvf,CAAA,EAAgC,MAAAwf,EAAA,4CAAAxf,CAAA,OAAM,QAAO,wBAAkB,OAAAyI,KAAA,sCAAAzI,CAAA,6DACjE,CAAE,iBAAAV,GAAqB,MAAAkgB,EAAA,iCAAA0B,CAAA,OAAM,QAAO,uBAA2B,OAAAzY,KAAA,2BAAAyY,CAAA,qCAC/DC,EAAW7hB,EAAiB,WAC5BD,EAAW8hB,EAAS,UAAY,OAChCC,EAAeD,EAAS,cAAgB,SAE9C,IAAIE,EAA6D,UAC7DD,IAAiB,cAAgBA,IAAiB,QAAUA,IAAiB,WAC/EC,EAAiBD,GAGnB,MAAMrhB,EAAYC,EAChBuf,EAAQ,MACR8B,EACAhiB,IAAa,OAASA,EAAW,QAEnC,MAAMnF,EAAI,KAAK,OAAO6F,CAAS,EAC/B4f,EAAM,QAAQ,cAAcJ,EAAQ,KAAK,EAAE,CAC7C,CAEA,eAAeQ,GAAwBuB,EAA8B,CAEnE,KAAM,CAAE,aAAA5mB,CAAA,EAAiB,MAAA8kB,EAAA,6BAAA9kB,CAAA,OAAM,QAAO,uBAAuB,OAAA+N,KAAA,uBAAA/N,CAAA,qCACvD6mB,EAAY7mB,EAAa,WAEzB6G,EADOggB,EAAU,KACA,QAAUzmB,EAAE,KAAOymB,EAAU,QAAQ,EAE5D,GAAI,CAAChgB,GAAW,KAAOA,EAAU,MAAQ,cAAe,CACtDoe,EAAM,MAAM,sBAAsB,EAClC,MACF,CAGA,MAAMtiB,EAAS,MAAMmkB,GAAS,QAAQ,CACpC,KAAM,UACN,OAAQ,2CAA2CjgB,EAAU,GAAG,GAChE,QAAS,CAAE,IAAKA,EAAU,IAAI,CAC/B,EAGDoe,EAAM,QAAQtiB,EAAO,KAAK,UAAU,EAAG,GAAG,EAAI,MAAO,CAAE,SAAU,IAAO,CAC1E,CAEA,eAAe2iB,GAAsBsB,EAA8B,CAEjE,MAAMhE,EAAe,OAAO,gBAAgB,WAE5C,GAAI,CAACA,EAAc,CACjBqC,EAAM,MAAM,kDAAkD,EAC9D,MACF,CAEA,MAAMtiB,EAAS,MAAMmkB,GAAS,QAAQ,CACpC,KAAM,OACN,OAAQ;;AAAA,EAA4ClE,CAAY,GACjE,EAEDqC,EAAM,QAAQtiB,EAAO,KAAK,UAAU,EAAG,GAAG,EAAI,MAAO,CAAE,SAAU,IAAO,CAC1E,CAEA,eAAe4iB,GAAuBqB,EAA8B,CAClE,KAAM,CAAE,aAAAG,EAAc,eAAAC,GAAmB,MAAAlC,EAAA,6BAAAiC,EAAA,eAAAC,CAAA,OAAM,QAAO,0BAAc,sBAAAD,EAAA,eAAAC,CAAA,OAGpE,GADc,SAAS,iBAAiB,MAAM,EACpC,SAAW,EAAG,CACtB/B,EAAM,MAAM,6BAA6B,EACzC,MACF,CAEA,MAAMgC,EAAUD,EAAA,EAChB,GAAI,OAAO,KAAKC,CAAO,EAAE,SAAW,EAAG,CACrChC,EAAM,KAAK,gFAAgF,EAC3F,MACF,CAEA,MAAMiC,EAAcH,EAAaE,CAAO,EAEpCC,EAAc,EAChBjC,EAAM,QACJ,UAAUiC,CAAW,cAAcA,IAAgB,EAAI,GAAK,GAAG,uBAGjEjC,EAAM,KAAK,mEAAmE,CAElF,CAEA,eAAeO,GAA0BoB,EAA8B,CACrE,KAAM,CAAE,gBAAAO,CAAA,EAAoB,MAAArC,EAAA,gCAAAqC,CAAA,OAAM,QAAO,0BAAc,yBAAAA,CAAA,OAGjDC,EAAQ,SAAS,iBAAiB,MAAM,EAC9C,GAAIA,EAAM,SAAW,EAAG,CACtBnC,EAAM,KAAK,6EAA6E,EACxF,MACF,CAGA,MAAMoC,EAAOD,EAAM,CAAC,EACdE,EAAW,IAAI,SAASD,CAAI,EAC5BJ,EAAkC,GAIxC,SAAW,CAACM,EAAKC,CAAK,IAAKF,EAAS,UAClC,GAAI,OAAOE,GAAU,UAAYA,EAAM,OAAQ,CAC7C,MAAMC,EAAWF,EAAI,cACjBE,EAAS,SAAS,MAAM,GAAK,CAACR,EAAQ,KACxCA,EAAQ,KAAOO,EACNC,EAAS,SAAS,OAAO,GAAK,CAACR,EAAQ,MAChDA,EAAQ,MAAQO,GACNC,EAAS,SAAS,OAAO,GAAKA,EAAS,SAAS,QAAQ,IAAM,CAACR,EAAQ,MACjFA,EAAQ,MAAQO,EACPC,EAAS,SAAS,SAAS,GAAK,CAACR,EAAQ,QAClDA,EAAQ,QAAUO,EACTC,EAAS,SAAS,MAAM,GAAK,CAACR,EAAQ,KAC/CA,EAAQ,KAAOO,EAEfC,EAAS,SAAS,SAAS,GAC3BA,EAAS,SAAS,KAAK,GACvBA,EAAS,SAAS,QAAQ,EAE1BR,EAAQ,QAAUO,EACTC,EAAS,SAAS,SAAS,GAAKA,EAAS,SAAS,QAAQ,EACnER,EAAQ,QAAUO,EACTC,EAAS,SAAS,KAAK,IAChCR,EAAQ,IAAMO,EAElB,CAGE,OAAO,KAAKP,CAAO,EAAE,OAAS,GAChCE,EAAgBF,CAAO,EACvBhC,EAAM,QACJ,sBAAsB,OAAO,KAAKgC,CAAO,EAAE,MAAM,SAAS,OAAO,KAAKA,CAAO,EAAE,SAAW,EAAI,GAAK,GAAG,KAGxGhC,EAAM,KAAK,2DAA2D,CAE1E,CAEA,eAAsBW,GAAsBf,EAA6B,CACvE,GAAI,CACF,MAAMP,EAAOO,EAAQ,OAAS,QAG9B,GAAI,OAAO,OAAW,KAAgB,OAAe,UAAW,CAC9D,KAAM,CAAE,OAAA1Y,CAAA,EAAW,MAAA2Y,EAAA,uBAAA3Y,GAAA,KAAM,QAAO,sBAAsB,gBAAAA,CAAA,OACtD,MAAMA,EAAO,cAAe,CAAE,KAAAmY,EAAM,EACpCW,EAAM,QAAQ,eAAeX,CAAI,aAAa,CAChD,KAEE,IAAI,CACF,MAAMoD,EAAW,MAAM,MAAM,qCAAqCpD,CAAI,EAAE,EACxE,GAAIoD,EAAS,GAAI,CACf,MAAMzc,EAAO,MAAMyc,EAAS,OAC5B,OAAO,cAAc,IAAI,YAAY,iBAAkB,CAAE,OAAQzc,CAAA,CAAM,CAAC,CAC1E,CACF,OAASxL,EAAO,CACd,QAAQ,KAAK,uCAAwCA,CAAK,CAC5D,CAEJ,OAASA,EAAO,CACd,QAAQ,MAAM,kCAAmCA,CAAK,EACtDwlB,EAAM,MAAM,mDAAmD,CACjE,CACF,CAEA,eAAsBY,GAAoBhB,EAA6B,CACrE,GAAI,CAEF,MAAM8C,EAAQ9C,EAAQ,OAAO,MAAM,MAAM,GAAK,GACxCN,EAAOoD,EAAM,CAAC,GAAK,QACnBC,EAAUD,EAAM,CAAC,GAAG,MAAM,MAAM,GAAK,GACrCnD,EAAKoD,EAAQ,CAAC,GAAK,SACnB9T,EAAO8T,EAAQ,CAAC,GAAK,WAE3B,GAAI,OAAO,OAAW,KAAgB,OAAe,UAAW,CAC9D,KAAM,CAAE,OAAAzb,CAAA,EAAW,MAAA2Y,EAAA,uBAAA3Y,GAAA,KAAM,QAAO,sBAAsB,gBAAAA,CAAA,OACtD,MAAMA,EAAO,aAAc,CAAE,KAAAoY,EAAM,GAAAC,EAAI,KAAA1Q,EAAM,EAC7CmR,EAAM,QAAQ,sBAAsBV,CAAI,OAAOC,CAAE,KAAK,CACxD,MACES,EAAM,KAAK,kBAAkBV,CAAI,MAAMC,CAAE,OAAO1Q,CAAI,EAAE,CAE1D,OAASrU,EAAO,CACd,QAAQ,MAAM,gCAAiCA,CAAK,EACpDwlB,EAAM,MAAM,yCAAyC,CACvD,CACF,CAEA,eAAsBa,GAAqBjB,EAA6B,CACtE,GAAI,CAEF,MAAM8C,EAAQ9C,EAAQ,OAAO,MAAM,MAAM,GAAK,GACxCN,EAAOoD,EAAM,CAAC,GAAK,QACnBC,EAAUD,EAAM,CAAC,GAAG,MAAM,MAAM,GAAK,GACrCnD,EAAKoD,EAAQ,CAAC,GAAK,SACnBC,EAAYD,EAAQ,CAAC,GAAG,MAAM,UAAU,GAAK,GAC7CE,EAAaD,EAAU,CAAC,GAAK,WAC7BpD,EAAaoD,EAAU,CAAC,GAAK,OAEnC,GAAI,OAAO,OAAW,KAAgB,OAAe,UAAW,CAC9D,KAAM,CAAE,OAAA1b,CAAA,EAAW,MAAA2Y,EAAA,uBAAA3Y,GAAA,KAAM,QAAO,sBAAsB,gBAAAA,CAAA,OACtD,MAAMA,EAAO,cAAe,CAAE,KAAAoY,EAAM,GAAAC,EAAI,WAAAsD,EAAY,WAAArD,EAAY,EAChEQ,EAAM,QAAQ,mBAAmBV,CAAI,MAAMC,CAAE,GAAGC,EAAa,gBAAkB,EAAE,KAAK,CACxF,MACEQ,EAAM,KACJ,mBAAmBV,CAAI,MAAMC,CAAE,OAAOsD,CAAU,GAAGrD,EAAa,WAAWA,CAAU,GAAK,EAAE,GAGlG,OAAShlB,EAAO,CACd,QAAQ,MAAM,iCAAkCA,CAAK,EACrDwlB,EAAM,MAAM,0CAA0C,CACxD,CACF,CAEA,eAAeQ,GAAyBmB,EAA8B,CACpE,KAAM,CAAE,kBAAAmB,CAAA,EAAsB,MAAAjD,EAAA,kCAAAiD,CAAA,OAAM,QAAO,kCAAsB,2BAAAA,CAAA,wCAG3DnoB,EAAQgnB,EAAS,OACnB,QAAQ,2DAA4D,EAAE,EACvE,OAEH3B,EAAM,KAAK,yBAAyB,EACpC,MAAM+C,EAAW,MAAMD,EAAkBnoB,GAAS,MAAS,EAE3D,GAAIooB,EAAU,CAEZ,MAAMC,EAAQ,SAAS,cAAc,KAAK,EAC1CA,EAAM,UACJ,uFACFA,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yDAMmCD,CAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAS7D,SAAS,KAAK,YAAYC,CAAK,EAG/BA,EAAM,iBAAiB,QAASrnB,GAAK,CAC/BA,EAAE,SAAWqnB,GACfA,EAAM,QAEV,CAAC,EAGD,MAAMC,EAAgBtnB,GAAqB,CACrCA,EAAE,MAAQ,WACZqnB,EAAM,SACN,SAAS,oBAAoB,UAAWC,CAAY,EAExD,EACA,SAAS,iBAAiB,UAAWA,CAAY,CACnD,MACEjD,EAAM,MAAM,8BAA8B,CAE9C,CAEA,eAAeS,GAAuBb,EAA6B,CACjE,MAAMsD,EAAYtD,EAAQ,MAAQ,EAC5BjlB,EAAQilB,EAAQ,OAAS,GAE/B,GAAI,CAACjlB,EAAO,CACVqlB,EAAM,MAAM,0BAA0B,EACtC,MACF,CAGA,KAAM,CAAE,4BAAA3f,CAAA,EAAgC,MAAAwf,EAAA,4CAAAxf,CAAA,OAAM,QAAO,wBAAkB,OAAAyI,KAAA,sCAAAzI,CAAA,6DACjE,CAAE,iBAAAV,GAAqB,MAAAkgB,EAAA,iCAAA0B,CAAA,OAAM,QAAO,uBAA2B,OAAAzY,KAAA,2BAAAyY,CAAA,qCAE/DE,EADW9hB,EAAiB,WACJ,cAAgB,SAE9C,IAAI+hB,EAA6D,UAC7DD,IAAiB,cAAgBA,IAAiB,QAAUA,IAAiB,WAC/EC,EAAiBD,GAInB,QAASrX,EAAI,EAAGA,EAAI8Y,EAAW9Y,IAAK,CAClC,MAAM/O,EAAc,GAAGV,CAAK,IAAIyP,EAAI,EAAI,QAAQA,EAAI,CAAC,GAAK,EAAE,GACtDhK,EAAYC,EAA4BhF,EAAaqmB,CAAc,EACzE,MAAMnnB,EAAI,KAAK,OAAO6F,CAAS,EAC/B,MAAM,IAAI,QAAQ0gB,GAAW,WAAWA,EAAS,GAAG,CAAC,CACvD,CAEAd,EAAM,QAAQ,UAAUkD,CAAS,gBAAgBvoB,CAAK,EAAE,CAC1D,CAEA,eAAe+lB,GAAuBd,EAA6B,CACjE,GAAI,CAACA,EAAQ,IAAK,OAElB,KAAM,CAAE,4BAAAvf,CAAA,EAAgC,MAAAwf,EAAA,4CAAAxf,CAAA,OAAM,QAAO,wBAAkB,OAAAyI,KAAA,sCAAAzI,CAAA,6DACjE,CAAE,iBAAAV,GAAqB,MAAAkgB,EAAA,iCAAA0B,CAAA,OAAM,QAAO,uBAA2B,OAAAzY,KAAA,2BAAAyY,CAAA,qCAE/DE,EADW9hB,EAAiB,WACJ,cAAgB,SAE9C,IAAI+hB,EAA6D,UAC7DD,IAAiB,cAAgBA,IAAiB,QAAUA,IAAiB,WAC/EC,EAAiBD,GAGnB,MAAMrhB,EAAYC,EAA4Buf,EAAQ,IAAK8B,CAAc,EACnE,CAAE,aAAA3mB,CAAA,EAAiB,MAAA8kB,EAAA,6BAAA9kB,CAAA,OAAM,QAAO,uBAAuB,OAAA+N,KAAA,uBAAA/N,CAAA,qCACvD6mB,EAAY7mB,EAAa,WAEzB6G,EADOggB,EAAU,KACA,QAAUzmB,EAAE,KAAOymB,EAAU,QAAQ,EAExDhgB,EACF,MAAMrH,EAAI,KAAK,SAASqH,EAAU,GAAIxB,CAAS,EAE/C,MAAM7F,EAAI,KAAK,OAAO6F,CAAS,CAEnC,CCv0BA,MAAM+iB,GAA8C,CAClD,GAAI,QACJ,GAAI,QACJ,GAAI,QACJ,GAAI,QACJ,GAAI,QACJ,GAAI,QACJ,GAAI,QACJ,GAAI,QACJ,GAAI,QACJ,GAAI,QACJ,GAAI,OACN,EAEA,SAASC,GAA2BhC,EAAuB,CAEzD,MAAI,CAACA,GAAQA,IAAS,OAAe,cAC9B+B,GAAoB/B,CAAI,GAAKA,EAAK,SAAS,GAAG,EAAIA,EAAO,GAAGA,CAAI,IAAIA,EAAK,aAAa,EAC/F,CAEO,SAASiC,IAAW,CACzB,KAAM,CAACC,EAAWC,CAAY,EAAI1oB,WAAS,EAAK,EAC1C,CAAC2oB,EAAYC,CAAa,EAAI5oB,WAAS,EAAE,EACzC,CAACijB,EAAcC,CAAe,EAAIljB,WAAS,EAAK,EAChD,CAAC6oB,EAAcC,CAAe,EAAI9oB,WAAS,EAAK,EAChD,CAAC+oB,EAAeC,CAAgB,EAAIhpB,WAAS,EAAK,EAClDipB,EAAW1lB,SAAY,IAAI,EAC3BsB,EAAWC,GAAiB3E,GAASA,EAAM,UAAY,MAAM,EAE7D+oB,EAAY,CAAC,YAAa,SAAU,QAAS,SAAS,EAG5DvlB,YAAU,IAAM,CACd,MAAMwlB,EAAW,OAAe,mBAAsB,OAAe,wBACrE,GAAI,CAACA,EAAI,CACP,QAAQ,KAAK,0CAA0C,EACvD,MACF,CAEA,GAAI,CACF,MAAMC,EAAc,IAAID,EACxBC,EAAY,WAAa,GACzBA,EAAY,eAAiB,GAC7BA,EAAY,KAAOb,GAA2B1jB,CAAQ,EACtDukB,EAAY,gBAAkB,EAE9BA,EAAY,SAAYxnB,GAAe,CACrC,MAAMyI,EAAU,MAAM,QAAQzI,EAAM,OAAO,EAAI,MAAM,KAAKA,EAAM,OAAO,EAAI,GACrEynB,EAAehf,EAAQA,EAAQ,OAAS,CAAC,EACzCse,EAAaU,IAAe,CAAC,GAAG,YAAc,GAEhDA,GAAc,SAEhBT,EAAcD,EAAW,MAAM,EAC/BzF,EAAgB,EAAI,EACpBoG,EAAcX,EAAW,MAAM,GAG/BC,EAAcD,CAAU,CAE5B,EAEAS,EAAY,QAAWxnB,GAAe,CACpC,QAAQ,MAAM,oCAAqCA,EAAM,KAAK,EAC9D8mB,EAAa,EAAK,EAClBxF,EAAgB,EAAK,EACrB0F,EAAc,EAAE,EAEZhnB,EAAM,QAAU,cAClBujB,EAAM,MAAM,qEAAqE,EACxEvjB,EAAM,QAAU,YAEzB8mB,EAAa,EAAK,EAElBvD,EAAM,MAAM,6BAA6BvjB,EAAM,KAAK,EAAE,CAE1D,EAEAwnB,EAAY,MAAQ,IAAM,CACxBV,EAAa,EAAK,EAClBxF,EAAgB,EAAK,EACrB0F,EAAc,EAAE,CAClB,EAEAK,EAAS,QAAUG,CACrB,OAASzpB,EAAO,CACd,QAAQ,MAAM,mDAAoDA,CAAK,CACzE,CACF,EAAG,CAACkF,CAAQ,CAAC,EAEb,MAAMykB,EAAgB,MAAOnS,GAAiB,CAC5C,GAAI,CAACA,EAAK,OAAQ,CAChBuR,EAAa,EAAK,EAClB,MACF,CAEA,GAAI,CACFxF,EAAgB,EAAI,EAGpB,MAAMY,EAAY3M,EAAK,cAGvB,GAFoB+R,EAAU,QAAapF,EAAU,SAASyF,CAAI,CAAC,GAEhDV,EAAc,CAC/BC,EAAgB,EAAI,EACpBE,EAAiB,EAAI,EAGrB,IAAIQ,EAAcrS,EAClB,UAAWsS,KAAYP,EACrB,GAAIpF,EAAU,SAAS2F,CAAQ,EAAG,CAChCD,EAAcrS,EACX,UAAUA,EAAK,cAAc,QAAQsS,CAAQ,EAAIA,EAAS,MAAM,EAChE,OACH,KACF,CAIF,GAAI/kB,KACF,GAAI,CACF,KAAM,CAAE,IAAAhF,CAAA,EAAQ,MAAAslB,EAAA,oBAAAtlB,GAAA,KAAM,QAAO,uBAAkB,OAAAuO,KAAA,cAAAvO,CAAA,qCAGzCgqB,EAAa,MAAMhqB,EAAI,OAAO,gBAG9BiqB,EAAe,eAAeH,GAAerS,CAAI;AAAA,8DACjDyS,EAAiB,MAAMlqB,EAAI,OAAO,QAAQiqB,EAAcD,CAAU,EAGxE,GAAI,oBAAqB,OAAQ,CAC/B,MAAMG,EAAS,IAAI,yBAAyBD,GAAkB,mBAAmB,EACjFC,EAAO,KAAO,QACdA,EAAO,KAAO,EACdA,EAAO,MAAQ,EACf,OAAO,gBAAgB,MAAMA,CAAM,EAGnCjB,EACE,WAAWgB,EAAe,UAAU,EAAG,GAAG,CAAC,GAAGA,EAAe,OAAS,IAAM,MAAQ,EAAE,GAE1F,CACF,OAASjqB,EAAO,CACd,QAAQ,KAAK,oCAAqCA,CAAK,EACvDwlB,EAAM,QAAQ,oDAAoD,CACpE,CAIF,MAAMJ,EAAUlB,GAAkB2F,GAAerS,CAAI,EAC/C2S,EACJ/E,EAAQ,KAAK,OAAO,CAAC,EAAE,cAAgBA,EAAQ,KAAK,MAAM,CAAC,EAAE,QAAQ,IAAK,GAAG,EAC/E6D,EAAc,qBAAqBkB,CAAW,KAAK,EAEnD,MAAMhF,GAAoBC,CAAO,EAEjC6D,EAAc,aAAakB,CAAW,YAAY,CACpD,KAAO,CAEL,MAAM/E,EAAUlB,GAAkB1M,CAAI,EAChC2S,EACJ/E,EAAQ,KAAK,OAAO,CAAC,EAAE,cAAgBA,EAAQ,KAAK,MAAM,CAAC,EAAE,QAAQ,IAAK,GAAG,EAC/E6D,EAAc,aAAakB,CAAW,KAAK,EAE3C,MAAMhF,GAAoBC,CAAO,EAEjC6D,EAAc,KAAKkB,CAAW,YAAY,CAC5C,CAEA,WAAW,IAAM,CACflB,EAAc,EAAE,CAClB,EAAG,GAAI,CACT,OAASjpB,EAAO,CACd,QAAQ,MAAM,mCAAoCA,CAAK,EACvDipB,EAAc,kBAAkB,EAChCzD,EAAM,MAAM,2BAA2B,EACvC,WAAW,IAAM,CACfyD,EAAc,EAAE,CAClB,EAAG,GAAI,CACT,SACE1F,EAAgB,EAAK,EACrBwF,EAAa,EAAK,EAClB,WAAW,IAAM,CACfE,EAAc,EAAE,CAClB,EAAG,GAAI,CACT,CACF,EAEMmB,EAAiB,IAAM,CAC3B,MAAMZ,EAAUF,EAAS,QACzB,GAAI,CAACE,EAAI,CACPhE,EAAM,MAAM,8DAA8D,EAC1E,MACF,CAEA,GAAI,CACFuD,EAAa,EAAI,EACjBE,EAAc,EAAE,EAChB1F,EAAgB,EAAK,EACrBiG,EAAG,QACHhE,EAAM,KAAK,8BAA8B,CAC3C,OAASxlB,EAAY,CACnB,QAAQ,MAAM,uCAAwCA,CAAK,EAC3D+oB,EAAa,EAAK,EACd/oB,EAAM,SAAS,SAAS,iBAAiB,GAE3CwpB,EAAG,OACH,WAAW,IAAM,CACfA,EAAG,QACHT,EAAa,EAAI,CACnB,EAAG,GAAG,GAENvD,EAAM,MAAM,mCAAmC,CAEnD,CACF,EAEM6E,EAAgB,IAAM,CAC1B,MAAMb,EAAUF,EAAS,QACzB,GAAIE,EACF,GAAI,CACFA,EAAG,MACL,OAASxpB,EAAO,CACd,QAAQ,MAAM,sCAAuCA,CAAK,CAC5D,CAEF+oB,EAAa,EAAK,EAClBxF,EAAgB,EAAK,EACrB0F,EAAc,EAAE,CAClB,EAIAjlB,mBAAU,IAAM,CACVe,OACyB,SAAY,CACrC,GAAI,CACF,KAAM,CAAE,UAAAqJ,CAAA,EAAc,MAAAiX,EAAA,0BAAAjX,GAAA,KAAM,QAAO,6BAAmB,OAAAE,KAAA,oBAAAF,CAAA,2DAGtDA,EAAU,GAAG,aAAc,IAAM,CAC1B0a,IACHsB,EAAA,EACAjB,EAAgB,EAAI,EACpB3D,EAAM,KAAK,wBAAwB,EAEvC,CAAC,EAGDpX,EAAU,GAAG,kBAAmB,SAAY,CAC1C,KAAM,CAAE,YAAArH,CAAA,EAAgB,4CAAM,QAAO,uBAAmB,OAAAuH,KAAA,sBAAAvH,CAAA,qCACxDA,EAAY,WAAW,QAAQ,OAAO,EACtCye,EAAM,KAAK,mBAAmB,CAChC,CAAC,CACH,OAASxlB,EAAO,CACd,QAAQ,KAAK,sCAAuCA,CAAK,CAC3D,CACF,GAEA,CAEJ,EAAG,CAAC8oB,CAAS,CAAC,EAGd9kB,YAAU,IAAM,CACd,MAAMsmB,EAAaroB,GAAyB,CACtCA,EAAM,SAAWA,EAAM,OAAS,SAAW,CAACA,EAAM,WACpDA,EAAM,iBACNA,EAAM,kBACF6mB,EACFuB,EAAA,GAEAD,EAAA,EACAjB,EAAgB,EAAI,IAKpBL,IAAc7mB,EAAM,MAAQ,UAAaA,EAAM,SAAWA,EAAM,MAAQ,OAC1EA,EAAM,iBACNooB,EAAA,EACA7E,EAAM,KAAK,eAAe,EAE9B,EAEA,cAAO,iBAAiB,UAAW8E,EAAW,EAAI,EAC3C,IAAM,OAAO,oBAAoB,UAAWA,EAAW,EAAI,CACpE,EAAG,CAACxB,CAAS,CAAC,EAGZ9nB,OAAAyP,WAAA,CAEE,UAAAzP,OAACE,EAAO,IAAP,CACC,KAAI,GACJ,aAAc,GACd,UAAU,2CACV,WAAY,CAAE,MAAO,MACrB,SAAU,CAAE,MAAO,KAEnB,UAAAF,OAAC,UACC,QAAS,IAAO8nB,EAAYuB,EAAA,EAAkBD,EAAA,EAC9C,UAAU,WACV,aAAW,wBAEX,UAAAnpB,MAAC,OACC,UAAW,kIACT6nB,EAAY,oDAAsD,iBACpE,IAAII,EAAe,uBAAyB,EAAE,GAE7C,SAAAJ,EACC7nB,MAACspB,GAAA,CAAI,UAAU,sCAAsC,EACnDrB,EACFjoB,MAACupB,GAAA,CAAM,UAAU,uBAAuB,EAExCvpB,MAACG,GAAA,CAAS,UAAU,uBAAuB,IAG9CgoB,SACE,OAAI,UAAU,gGACb,SAAAnoB,MAACwpB,GAAA,CAAI,UAAU,qBAAqB,EACtC,WAGH,OAAI,UAAU,4IACZ,SAAAvB,EAAe,cAAgB,uBAClC,KAIDJ,GACC9nB,OAACE,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,EAAG,KAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,GAC1B,KAAM,CAAE,QAAS,EAAG,EAAG,KACvB,UAAU,yHAEV,UAAAF,OAAC,OAAI,UAAU,yCACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAC,MAAC,OAAI,UAAU,gDAAgD,QAC9D,KAAE,UAAU,qCACV,SAAAqiB,EAAe,gBAAkB,qBACpC,GACF,EACAriB,MAAC,UACC,QAASopB,EACT,UAAU,mDACV,aAAW,iBAEX,SAAAppB,MAACqL,GAAA,CAAE,UAAU,UAAU,GACzB,EACF,EAEC0c,GACChoB,OAAC,OAAI,UAAU,mEACb,UAAAC,MAAC,KAAE,UAAU,6BAA6B,qBAAS,EACnDA,MAAC,KAAE,UAAU,iCAAkC,SAAA+nB,CAAA,CAAW,GAC5D,QAGD,KAAE,UAAU,6BACV,SAAA1F,EACG,4BACA;AAAA;AAAA,qCACN,EAEAriB,MAAC,UACC,QAASopB,EACT,UAAU,iJACX,kCAED,GACF,EAEJ,CAEJ,CCzWA,MAAM5pB,GAAqE,CACzE,CAAE,GAAI,UAAW,MAAO,UAAW,KAAMQ,MAACuL,GAAA,CAAM,KAAM,GAAI,GAC1D,CAAE,GAAI,YAAa,MAAO,YAAa,KAAMvL,MAACypB,GAAA,CAAK,KAAM,GAAI,GAC7D,CAAE,GAAI,aAAc,MAAO,aAAc,KAAMzpB,MAAC0pB,GAAA,CAAW,KAAM,GAAI,GACrE,CAAE,GAAI,YAAa,MAAO,YAAa,KAAM1pB,MAACmV,GAAA,CAAS,KAAM,GAAI,EACnE,EAEO,SAASwU,GAAiB,CAC/B,KAAAhgB,EACA,QAAA0C,EACA,WAAAud,EAAa,UACb,MAAA/b,EAAQ,GACV,EAA0B,CACxB,KAAM,CAAC1H,EAAW0jB,CAAY,EAAIzqB,WAAkBwqB,CAAU,EACxD,CAAChqB,EAAakX,CAAc,EAAI1X,WAAS,EAAE,EAC3C,CAAC0qB,EAAWC,CAAY,EAAI3qB,WAAS,EAAK,EAC1C,CAAC4qB,EAAUC,CAAW,EAAI7qB,WAAS,EAAK,EAc9C,GAZA2D,YAAU,IAAM,CACd,MAAMmnB,EAAc,IAAM,CACxBD,EAAY,OAAO,WAAa,GAAG,EAC/B,OAAO,WAAa,KACtBF,EAAa,EAAK,CAEtB,EACA,OAAAG,EAAA,EACA,OAAO,iBAAiB,SAAUA,CAAW,EACtC,IAAM,OAAO,oBAAoB,SAAUA,CAAW,CAC/D,EAAG,EAAE,EAED,CAACvgB,EAAM,OAAO,KAElB,MAAMwgB,EAAaL,EAAY,GAAKE,EAAW,OAASnc,EAExD,OACE7N,MAACiG,GAAA,CACE,SAAA0D,GACC5J,OAAAyP,WAAA,CAEE,UAAAxP,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,GACpB,QAAS,CAAE,QAAS,GACpB,KAAM,CAAE,QAAS,GACjB,QAASoM,EACT,UAAU,kDACV,cAAY,SAIdtM,OAACE,EAAO,IAAP,CACC,QAAS,CAAE,EAAG,QACd,QAAS,CAAE,EAAG,GACd,KAAM,CAAE,EAAG,QACX,WAAY,CACV,KAAM,SACN,QAAS,GACT,UAAW,KAEb,UAAW,mIACT+pB,EAAW,SAAW,EACxB,GACA,MAAO,CAAE,MAAO,OAAOG,GAAe,SAAWA,EAAa,GAAGA,CAAU,MAC3E,KAAK,SACL,aAAW,OACX,aAAW,aAGX,UAAApqB,OAAC,OAAI,UAAU,0EACZ,WAAC+pB,GACA9pB,MAAC,OAAI,UAAU,0BACb,eAAC,MAAG,UAAU,sCAAsC,mBAAO,EAC7D,EAEFD,OAAC,OAAI,UAAU,kCACZ,WAACiqB,GACAhqB,MAAC,UACC,QAAS,IAAM+pB,EAAa,CAACD,CAAS,EACtC,UAAU,4FACV,MAAOA,EAAY,SAAW,WAE9B,SAAA9pB,MAACsZ,GAAA,CACC,KAAM,GACN,UAAW,wBAAwBwQ,EAAY,aAAe,EAAE,IAClE,GAGJ9pB,MAAC,UACC,QAASE,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACFmM,EAAA,CACF,EACA,YAAanM,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAU,mJACV,MAAO,CAAE,OAAQ,MAAO,UAAW,WACnC,aAAW,cAEX,SAAAF,MAACqL,GAAA,CAAE,KAAM,GAAI,GACf,EACF,GACF,EAGC,CAACye,GACA9pB,MAAC,OAAI,UAAU,oEACZ,SAAAR,GACE,OAAOkE,GAAOA,GAAOA,EAAI,EAAE,EAC3B,IAAIA,GACH3D,OAAC,UAEC,QAASG,GAAK,CACXA,EAAU,2BACXA,EAAE,kBACEwD,GAAKmmB,EAAanmB,EAAI,EAAE,CAC9B,EACA,YAAaxD,GAAK,CACfA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAW;AAAA;AAAA,sBAEXiG,IAAczC,EAAI,GAAK,gBAAkB,mCAAmC;AAAA,oBAE5E,MAAO,CAAE,OAAQ,MAAO,UAAW,WACnC,gBAAeyC,IAAczC,EAAI,GACjC,KAAK,MAEJ,UAAAA,EAAI,KACL1D,MAAC,QAAM,SAAA0D,EAAI,MAAM,EAChByC,IAAczC,EAAI,IACjB1D,MAACC,EAAO,IAAP,CACC,SAAS,YACT,UAAU,qDACV,QAAS,IACX,GAzBGyD,EAAI,GA4BZ,EACL,EAID,CAAComB,IACC3jB,IAAc,WACbA,IAAc,aACdA,IAAc,eACdnG,MAAC,OAAI,UAAU,wCACb,SAAAD,OAAC,OAAI,UAAU,WACb,UAAAC,MAACmL,GAAA,CACC,KAAM,GACN,UAAU,2DAEZnL,MAAC,SACC,KAAK,OACL,MAAOJ,EACP,SAAUM,GAAK4W,EAAe5W,EAAE,OAAO,KAAK,EAC5C,YAAa,UAAUiG,CAAS,MAChC,UAAU,wMACZ,EACF,EACF,EAIH,CAAC2jB,GACA9pB,MAAC,OAAI,UAAU,yBACb,SAAAA,MAACiG,GAAA,CAAgB,KAAK,OACpB,SAAAlG,OAACE,EAAO,IAAP,CAEC,QAAS,CAAE,QAAS,EAAG,EAAG,IAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,GAC1B,KAAM,CAAE,QAAS,EAAG,EAAG,KACvB,WAAY,CAAE,SAAU,IACxB,UAAU,yBAET,UAAAkG,IAAc,WACbnG,MAAC,OAAI,UAAU,SACb,SAAAA,MAACoqB,KAAY,EACf,EAEDjkB,IAAc,aACbnG,MAAC,OAAI,UAAU,SACb,SAAAA,MAACqqB,KAAe,EAClB,EAEDlkB,IAAc,cACbnG,MAAC,OAAI,UAAU,SACb,SAAAA,MAACsqB,KAAgB,EACnB,EAEDnkB,IAAc,aACbnG,MAAC,OAAI,UAAU,SACb,SAAAA,MAACuqB,KAAc,EACjB,IAzBGpkB,CAAA,EA4BT,EACF,IAEJ,EACF,EAEJ,CAEJ,CCtMO,SAASqkB,IAAkB,CAChC,KAAM,CAACxL,EAAQyL,CAAS,EAAIrrB,WAA8B,IAAI,EACxD,CAACsrB,EAAWC,CAAY,EAAIvrB,WAAS,EAAI,EACzC,CAACL,EAAO6rB,CAAQ,EAAIxrB,WAAuB,IAAI,EAE/CyrB,EAAc,SAAY,CAC9B,GAAI,CACFF,EAAa,EAAI,EACjB,MAAMpgB,EAAO,MAAMzL,EAAI,OAAO,YAC9B2rB,EAAUlgB,CAAI,EACdqgB,EAAS,IAAI,CACf,OAASE,EAAK,CACZF,EAASE,aAAe,MAAQA,EAAM,IAAI,MAAM,+BAA+B,CAAC,EAChF,QAAQ,MAAM,4CAA6CA,CAAG,CAChE,SACEH,EAAa,EAAK,CACpB,CACF,EAEA5nB,mBAAU,IAAM,CAGd,GADkB,CAACe,GAAA,GAAuB,CAACE,GAAA,EAC5B,CACb2mB,EAAa,EAAK,EAClB,MACF,CAGAE,EAAA,EAGA,MAAMtjB,EAAW,YAAYsjB,EAAa,GAAI,EAE9C,MAAO,IAAM,cAActjB,CAAQ,CACrC,EAAG,EAAE,EAEE,CACL,KAAMyX,EACN,UAAA0L,EACA,MAAA3rB,EACA,QAAS8rB,CAAA,CAEb,CCxCO,SAASE,IAAa,CAC3B,KAAM,CAACphB,EAAMC,CAAO,EAAIxK,WAAS,EAAK,EAChC,CAACF,EAAOC,CAAQ,EAAIC,WAAS,EAAE,EAC/B,CAACyK,EAAeC,CAAgB,EAAI1K,WAAS,CAAC,EAE9C4X,EAAUlR,EAAYvG,GAASA,EAAM,OAAO,EAC5CyrB,EAAYC,GAAkB1rB,GAASA,EAAM,SAAS,EACtD,CAAE,KAAM2rB,CAAA,EAAiBV,GAAA,EAGzBW,EAAWtoB,UAAuB,IAAM,CAC5C,MAAM4L,EAAuB,CAE3B,CACE,GAAI,gBACJ,MAAO,0BACP,YAAa,mCACb,KAAMtD,GACN,SAAU,CAAC,WAAY,OAAQ,QAAQ,EACvC,SAAU,QACV,OAAQ,IAAM6L,EAAQ,UAAU,GAGlC,CACE,GAAI,UACJ,MAAO,UACP,YAAa,iBACb,KAAM5N,GACN,SAAU,CAAC,MAAO,MAAO,MAAM,EAC/B,SAAU,UACV,OAAQ,SAAY,CAClB,MAAMgiB,EAAS,MAAMtsB,EAAI,KAAK,OAAO,aAAa,EAClD,GAAIssB,EAAQ,CACV,MAAMpsB,EACJ,OAAOosB,GAAW,UAAY,OAAQA,EAClCA,EAAO,GACP,OAAOA,GAAW,SAChBA,EACA,KACJpsB,GAAS,OAAOA,GAAU,UAC5BM,EAAa,WAAW,UAAUN,CAAK,CAE3C,CACF,GAEF,CACE,GAAI,iBACJ,MAAO,iBACP,YAAa,2BACb,KAAMmB,GACN,SAAU,CAAC,QAAS,YAAa,KAAM,KAAK,EAC5C,SAAU,UACV,OAAQ,SAAY,CAClB,MAAM6W,EAAQ,UAAU,EAExB,MAAMhW,EAAQ,IAAI,YAAY,iBAAiB,EAC/C,OAAO,cAAcA,CAAK,CAC5B,GAGF,CACE,GAAI,gBACJ,MAAO,gBACP,YAAa,kBACb,KAAMqqB,GACN,SAAU,CAAC,WAAY,cAAe,QAAQ,EAC9C,SAAU,aACV,OAAQ,IAAM,CACZ,OAAO,SAAS,KAAO,WACzB,GAEF,CACE,GAAI,iBACJ,MAAO,iBACP,YAAa,uBACb,KAAMpgB,GACN,SAAU,CAAC,YAAa,QAAS,WAAW,EAC5C,SAAU,aACV,OAAQ,IAAM,CACZ,MAAMjK,EAAQ,IAAI,YAAY,iBAAkB,CAAE,OAAQ,CAAE,IAAK,aAAe,EAChF,OAAO,cAAcA,CAAK,CAC5B,GAEF,CACE,GAAI,kBACJ,MAAO,kBACP,YAAa,wBACb,KAAM0oB,GACN,SAAU,CAAC,aAAc,WAAY,OAAO,EAC5C,SAAU,aACV,OAAQ,IAAM,CACZ,MAAM1oB,EAAQ,IAAI,YAAY,iBAAkB,CAAE,OAAQ,CAAE,IAAK,cAAgB,EACjF,OAAO,cAAcA,CAAK,CAC5B,GAEF,CACE,GAAI,gBACJ,MAAO,gBACP,YAAa,wCACb,KAAM4gB,GACN,SAAU,CAAC,SAAU,SAAU,SAAU,QAAS,QAAS,QAAQ,EACnE,SAAU,WACV,OAAQ,IAAM,CAEZ,MAAM5gB,EAAQ,IAAI,YAAY,oBAAoB,EAClD,OAAO,cAAcA,CAAK,CAC5B,EACF,EAIF,OAAAgqB,EAAU,MAAM,EAAG,CAAC,EAAE,QAAQM,GAAY,CACxC7c,EAAM,KAAK,CACT,GAAI,YAAY6c,EAAS,EAAE,GAC3B,MAAOA,EAAS,MAChB,YAAaA,EAAS,IACtB,KAAMrgB,GACN,SAAU,CAACqgB,EAAS,MAAOA,EAAS,IAAK,UAAU,EACnD,SAAU,aACV,OAAQ,SAAY,CAClB,MAAMF,EAAS,MAAMtsB,EAAI,KAAK,OAAOwsB,EAAS,GAAG,EACjD,GAAIF,EAAQ,CACV,MAAMpsB,EACJ,OAAOosB,GAAW,UAAY,OAAQA,EAClCA,EAAO,GACP,OAAOA,GAAW,SAChBA,EACA,KACJpsB,GAAS,OAAOA,GAAU,UAC5BM,EAAa,WAAW,UAAUN,CAAK,CAE3C,CACF,EACD,CACH,CAAC,EAEMyP,CACT,EAAG,CAACuc,EAAWhU,EAASkU,CAAY,CAAC,EAG/BK,EAAmB1oB,UAAQ,IAAM,CACrC,GAAI,CAAC3D,EAAM,OAAQ,OAAOisB,EAC1B,MAAMK,EAAatsB,EAAM,cACzB,OAAOisB,EAAS,OACd7gB,GACEA,EAAI,MAAM,cAAc,SAASkhB,CAAU,GAC3ClhB,EAAI,aAAa,cAAc,SAASkhB,CAAU,GAClDlhB,EAAI,SAAS,KAAKmhB,GAAMA,EAAG,cAAc,SAASD,CAAU,CAAC,EAEnE,EAAG,CAACL,EAAUjsB,CAAK,CAAC,EAGpB6D,YAAU,IAAM,CACd,MAAM2H,EAAiBxK,GAAqB,CAQ1C,IANKA,EAAE,SAAWA,EAAE,UAAYA,EAAE,MAAQ,MACxCA,EAAE,iBACF0J,EAAQe,GAAQ,CAACA,CAAI,EACrB+gB,GAAM,oBAAoB,GAGxB/hB,GACF,GAAIzJ,EAAE,MAAQ,SACZ0J,EAAQ,EAAK,UACJ1J,EAAE,MAAQ,YACnBA,EAAE,iBACF4J,EAAiBa,GAAQ,KAAK,IAAIA,EAAO,EAAG4gB,EAAiB,OAAS,CAAC,CAAC,UAC/DrrB,EAAE,MAAQ,UACnBA,EAAE,iBACF4J,KAAyB,KAAK,IAAIa,EAAO,EAAG,CAAC,CAAC,UACrCzK,EAAE,MAAQ,QAAS,CAC5BA,EAAE,iBACF,MAAMikB,EAAUoH,EAAiB1hB,CAAa,EAC1Csa,IACFA,EAAQ,SACRva,EAAQ,EAAK,EACbzK,EAAS,EAAE,EACXusB,GAAM,uBAAwB,CAAE,QAASvH,EAAQ,GAAI,EAEzD,EAEJ,EAEA,cAAO,iBAAiB,UAAWzZ,CAAa,EACzC,IAAM,OAAO,oBAAoB,UAAWA,CAAa,CAClE,EAAG,CAACf,EAAM4hB,EAAkB1hB,CAAa,CAAC,EAG1C9G,YAAU,IAAM,CACd+G,EAAiB,CAAC,CACpB,EAAG,CAAC5K,CAAK,CAAC,EAEV,MAAMysB,EAAsBxH,GAAyB,CACnDA,EAAQ,SACRva,EAAQ,EAAK,EACbzK,EAAS,EAAE,EACXusB,GAAM,uBAAwB,CAAE,QAASvH,EAAQ,GAAI,CACvD,EAGMyH,EAAkB/oB,UAAQ,IAAM,CACpC,MAAMgpB,EAAwC,GAC9C,OAAAN,EAAiB,QAAQjhB,GAAO,CACzBuhB,EAAOvhB,EAAI,QAAQ,IAAGuhB,EAAOvhB,EAAI,QAAQ,EAAI,IAClDuhB,EAAOvhB,EAAI,QAAQ,EAAE,KAAKA,CAAG,CAC/B,CAAC,EACMuhB,CACT,EAAG,CAACN,CAAgB,CAAC,EAEfO,EAAyC,CAC7C,MAAO,QACP,QAAS,UACT,WAAY,aACZ,SAAU,YAGZ,OACE9rB,MAACiG,GAAA,CACE,SAAA0D,GACC5J,OAAAyP,WAAA,CAEE,UAAAxP,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,GACpB,QAAS,CAAE,QAAS,GACpB,KAAM,CAAE,QAAS,GACjB,QAAS,IAAM2J,EAAQ,EAAK,EAC5B,UAAU,wDAIZ7J,OAACE,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,MAAO,IAAM,EAAG,KACvC,QAAS,CAAE,QAAS,EAAG,MAAO,EAAG,EAAG,GACpC,KAAM,CAAE,QAAS,EAAG,MAAO,IAAM,EAAG,KACpC,UAAU,sJAGV,UAAAF,OAAC,OAAI,UAAU,wDACb,UAAAC,MAACmL,GAAA,CAAO,KAAM,GAAI,UAAU,iBAAiB,EAC7CnL,MAAC,SACC,GAAG,qBACH,KAAK,oBACL,KAAK,OACL,MAAOd,EACP,SAAUgB,GAAKf,EAASe,EAAE,OAAO,KAAK,EACtC,YAAY,8BACZ,UAAU,oFACV,UAAS,KAEXH,OAAC,OAAI,UAAU,iDACb,UAAAC,MAAC,OAAI,UAAU,yDACZ,mBAAU,SAAS,SAAS,KAAK,EAAI,IAAM,OAC9C,EACAA,MAAC,QAAK,aAAC,EACPA,MAAC,OAAI,UAAU,yDAAyD,aAAC,GAC3E,GACF,EAGAA,MAAC,OAAI,UAAU,+BACZ,SAAAurB,EAAiB,SAAW,EAC3BxrB,OAAC,OAAI,UAAU,iCACb,UAAAC,MAAC,KAAE,6BAAiB,EACpBA,MAAC,KAAE,UAAU,eAAe,uCAA2B,GACzD,EAEA,OAAO,QAAQ4rB,CAAe,EAAE,IAAI,CAAC,CAACG,EAAUtd,CAAK,IACnD1O,OAAC,OAAmB,UAAU,OAC5B,UAAAC,MAAC,OAAI,UAAU,yEACZ,SAAA8rB,EAAeC,CAAQ,GAAKA,EAC/B,EACCtd,EAAM,IAAI,CAACnE,EAAK0hB,IAAS,CACxB,MAAMC,EAAcV,EAAiB,QAAQjhB,CAAG,EAC1CyV,EAAakM,IAAgBpiB,EACnC,OACE9J,OAAC,UAEC,QAAS,IAAM4rB,EAAmBrhB,CAAG,EACrC,aAAc,IAAMR,EAAiBmiB,CAAW,EAChD,UAAW,yEACTlM,EACI,iFACA,oBACN,GAEA,UAAA/f,MAACsK,EAAI,KAAJ,CACC,KAAM,GACN,UAAWyV,EAAa,kBAAoB,mBAE9ChgB,OAAC,OAAI,UAAU,mBACb,UAAAC,MAAC,OACC,UAAW,eAAe+f,EAAa,aAAe,gBAAgB,GAErE,SAAAzV,EAAI,QAENA,EAAI,aACHtK,MAAC,OAAI,UAAU,gCAAiC,WAAI,YAAY,GAEpE,EACC+f,GAAc/f,MAACksB,GAAA,CAAW,KAAM,GAAI,UAAU,kBAAkB,IAvB5D5hB,EAAI,GA0Bf,CAAC,IAnCOyhB,CAoCV,CACD,EAEL,IACF,EACF,EAEJ,CAEJ,CC7TA,MAAMI,GAA2B,CAC/B,CACE,GAAI,SACJ,KAAM,YACN,KAAMhhB,GACN,YAAa,6CACb,MAAO,6BAET,CACE,GAAI,OACJ,KAAM,UACN,KAAMihB,GACN,YAAa,8CACb,MAAO,+BAET,CACE,GAAI,WACJ,KAAM,cACN,KAAMnhB,GACN,YAAa,8CACb,MAAO,gCAET,CACE,GAAI,UACJ,KAAM,aACN,KAAM7B,GACN,YAAa,6CACb,MAAO,8BAET,CACE,GAAI,YACJ,KAAM,eACN,KAAME,GACN,YAAa,0CACb,MAAO,iCAET,CACE,GAAI,QACJ,KAAM,WACN,KAAM+iB,GACN,YAAa,0CACb,MAAO,4BAEX,EAEO,SAASC,IAAmB,CACjC,KAAM,CAACC,EAAQC,CAAS,EAAIptB,WAAS,EAAK,EACpC,CAACqtB,EAAeC,CAAe,EAAIttB,WAA0B,IAAI,EACjE,CAAE,QAAA4X,CAAA,EAAYlR,EAAA,EAEd6mB,EAAoB5V,GAAmB,CAC3C2V,EAAgB3V,CAAI,EAYpBC,EAT6E,CAC3E,OAAQ,SACR,KAAM,SACN,SAAU,WACV,QAAS,OACT,UAAW,SACX,MAAO,UAGOD,CAAI,CAAC,EAGrB,WAAW,IAAMyV,EAAU,EAAK,EAAG,GAAG,CACxC,EAEA,OACEzsB,OAAAyP,WAAA,CAEE,UAAAzP,OAAC,UACC,QAAS,IAAMysB,EAAU,CAACD,CAAM,EAChC,UAAU,uPAEV,UAAAvsB,MAACG,GAAA,CAAS,UAAU,UAAU,EAC9BH,MAAC,QAAK,wBAAY,KAIpBA,MAACiG,GAAA,CACE,SAAAsmB,GACCxsB,OAAAyP,WAAA,CAEE,UAAAxP,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,GACpB,QAAS,CAAE,QAAS,GACpB,KAAM,CAAE,QAAS,GACjB,QAAS,IAAMusB,EAAU,EAAK,EAC9B,UAAU,sDAIZxsB,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,MAAO,GAAK,EAAG,IACtC,QAAS,CAAE,QAAS,EAAG,MAAO,EAAG,EAAG,GACpC,KAAM,CAAE,QAAS,EAAG,MAAO,GAAK,EAAG,IACnC,UAAU,4DAEV,SAAAF,OAAC,OAAI,UAAU,uFAEb,UAAAA,OAAC,OAAI,UAAU,yCACb,UAAAA,OAAC,OACC,UAAAA,OAAC,MAAG,UAAU,wDACZ,UAAAC,MAACG,GAAA,CAAS,UAAU,0BAA0B,EAAE,gBAElD,EACAH,MAAC,KAAE,UAAU,qBAAqB,8DAElC,GACF,EACAA,MAAC,UACC,QAAS,IAAMwsB,EAAU,EAAK,EAC9B,UAAU,mDAEV,SAAAxsB,MAACqL,GAAA,CAAE,UAAU,UAAU,GACzB,EACF,QAGC,OAAI,UAAU,wCACZ,SAAA8gB,GAAW,IAAIpV,GAAQ,CACtB,MAAMhM,EAAOgM,EAAK,KAClB,OACEhX,OAACE,EAAO,OAAP,CAEC,QAAS,IAAM0sB,EAAiB5V,EAAK,EAAE,EACvC,WAAY,CAAE,MAAO,MACrB,SAAU,CAAE,MAAO,KACnB,UAAW,qBAAqBA,EAAK,KAAK,kEAE1C,UAAA/W,MAAC+K,EAAA,CAAK,UAAU,qEAAqE,EACrF/K,MAAC,MAAG,UAAU,oCAAqC,WAAK,KAAK,EAC7DA,MAAC,KAAE,UAAU,wBAAyB,WAAK,YAAY,IARlD+W,EAAK,GAWhB,CAAC,EACH,EAGAhX,OAAC,OAAI,UAAU,yCAAyC,mBAChDC,MAAC,OAAI,UAAU,iCAAiC,eAAG,EAAM,aACjE,GACF,GACF,EACF,EAEJ,EAGC,OAAO,OAAW,KACjBA,MAAC4sB,GAAA,CAAwB,SAAU,IAAMJ,EAAU,CAACD,CAAM,EAAG,GAEjE,CAEJ,CAEA,SAASK,GAAwB,CAAE,SAAAC,GAAsC,CACvE,OAAI,OAAO,OAAW,KAEtB9pB,YAAU,IAAM,CACd,MAAMsmB,EAAanpB,GAAqB,CAElCA,EAAE,SAAWA,EAAE,UAAYA,EAAE,MAAQ,MACvCA,EAAE,iBACF2sB,EAAA,GAGE3sB,EAAE,MAAQ,UACZ2sB,EAAA,CAEJ,EAEA,cAAO,iBAAiB,UAAWxD,CAAS,EACrC,IAAM,OAAO,oBAAoB,UAAWA,CAAS,CAC9D,EAAG,CAACwD,CAAQ,CAAC,EAEN,IACT,CC5LO,SAASC,IAAiB,CAC/B,KAAM,CAACP,EAAQC,CAAS,EAAIptB,WAAS,EAAK,EACpC,CAACF,EAAOC,CAAQ,EAAIC,WAAS,EAAE,EAC/B,CAACyK,EAAeC,CAAgB,EAAI1K,WAAS,CAAC,EAC9C2K,EAAWpH,SAAyB,IAAI,EACxC,CAAE,QAAAqU,CAAA,EAAYlR,EAAA,EAEdqlB,EAAsB,CAC1B,CACE,GAAI,WACJ,MAAO,gBACP,YAAa,gCACb,KAAMhrB,GACN,SAAU,CAAC,WAAY,SAAU,OAAQ,QAAQ,EACjD,OAAQ,SAAY,CAClB,MAAM6W,EAAQ,UAAU,EACxBwV,EAAU,EAAK,EACfjI,EAAM,KAAK,sBAAsB,CACnC,GAEF,CACE,GAAI,QACJ,MAAO,aACP,YAAa,gCACb,KAAMwI,GACN,SAAU,CAAC,QAAS,UAAW,QAAS,MAAO,QAAQ,EACvD,OAAQ,SAAY,CAClB,MAAM/V,EAAQ,OAAO,EACrBwV,EAAU,EAAK,EACfjI,EAAM,KAAK,mBAAmB,CAChC,GAEF,CACE,GAAI,SACJ,MAAO,cACP,YAAa,0BACb,KAAMvZ,GACN,SAAU,CAAC,SAAU,MAAO,UAAU,EACtC,OAAQ,SAAY,CAClB,MAAMgM,EAAQ,QAAQ,EACtBwV,EAAU,EAAK,EACfjI,EAAM,KAAK,oBAAoB,CACjC,GAEF,CACE,GAAI,QACJ,MAAO,cACP,YAAa,iCACb,KAAMpkB,GACN,SAAU,CAAC,QAAS,QAAS,SAAU,WAAW,EAClD,OAAQ,IAAM,CACZqsB,EAAU,EAAK,EAEf,OAAO,cAAc,IAAI,YAAY,gBAAgB,CAAC,EACtDjI,EAAM,KAAK,iBAAiB,CAC9B,GAEF,CACE,GAAI,gBACJ,MAAO,gBACP,YAAa,6CACb,KAAMnb,GACN,SAAU,CAAC,YAAa,MAAO,SAAU,QAAQ,EACjD,OAAQ,SAAY,CAClBojB,EAAU,EAAK,EAEf,OAAO,cAAc,IAAI,YAAY,kBAAkB,CAAC,EACxDjI,EAAM,KAAK,uBAAuB,CACpC,GAEF,CACE,GAAI,aACJ,MAAO,aACP,YAAa,6CACb,KAAMpZ,GACN,SAAU,CAAC,OAAQ,SAAU,YAAa,OAAO,EACjD,OAAQ,SAAY,CAClBqhB,EAAU,EAAK,EAEf,OAAO,cAAc,IAAI,YAAY,mBAAmB,CAAC,EACzDjI,EAAM,KAAK,qBAAqB,CAClC,EACF,EAIIgH,EAAmB5d,GAAM,QAAQ,IAAM,CAC3C,GAAI,CAACzO,EAAM,OAAQ,OAAOisB,EAE1B,MAAMK,EAAatsB,EAAM,cACzB,OAAOisB,EAAS,OACd7gB,GACEA,EAAI,MAAM,cAAc,SAASkhB,CAAU,GAC3ClhB,EAAI,YAAY,cAAc,SAASkhB,CAAU,GACjDlhB,EAAI,SAAS,KAAKmhB,GAAMA,EAAG,cAAc,SAASD,CAAU,CAAC,EAEnE,EAAG,CAACtsB,CAAK,CAAC,EAGV6D,mBAAU,IAAM,CACd,GAAI,CAACwpB,EAAQ,OAEb,MAAM7hB,EAAiBxK,GAAqB,CACtCA,EAAE,MAAQ,aACZA,EAAE,iBACF4J,EAAiBa,GAAQ,KAAK,IAAIA,EAAO,EAAG4gB,EAAiB,OAAS,CAAC,CAAC,GAC/DrrB,EAAE,MAAQ,WACnBA,EAAE,iBACF4J,KAAyB,KAAK,IAAIa,EAAO,EAAG,CAAC,CAAC,GACrCzK,EAAE,MAAQ,SACnBA,EAAE,iBACEqrB,EAAiB1hB,CAAa,GAChC0hB,EAAiB1hB,CAAa,EAAE,UAEzB3J,EAAE,MAAQ,WACnBssB,EAAU,EAAK,EACfrtB,EAAS,EAAE,EAEf,EAEA,cAAO,iBAAiB,UAAWuL,CAAa,EACzC,IAAM,OAAO,oBAAoB,UAAWA,CAAa,CAClE,EAAG,CAAC6hB,EAAQhB,EAAkB1hB,CAAa,CAAC,EAG5C9G,YAAU,IAAM,CACd,MAAM2H,EAAiBxK,GAAqB,EAC5B,UAAU,SAAS,cAAc,QAAQ,KAAK,GAAK,EACxCA,EAAE,QAAUA,EAAE,UAEvBA,EAAE,MAAQ,MACxBA,EAAE,iBACFssB,EAAU7hB,GAAQ,CAACA,CAAI,EAClB4hB,GACH,WAAW,IAAMxiB,EAAS,SAAS,QAAS,GAAG,EAGrD,EAEA,cAAO,iBAAiB,UAAWW,CAAa,EACzC,IAAM,OAAO,oBAAoB,UAAWA,CAAa,CAClE,EAAG,CAAC6hB,CAAM,CAAC,EAGXxpB,YAAU,IAAM,CACd+G,EAAiB,CAAC,CACpB,EAAG,CAAC5K,CAAK,CAAC,EAGRc,MAACiG,GAAA,CACE,SAAAsmB,GACCxsB,OAAAyP,WAAA,CAEE,UAAAxP,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,GACpB,QAAS,CAAE,QAAS,GACpB,KAAM,CAAE,QAAS,GACjB,QAAS,IAAMusB,EAAU,EAAK,EAC9B,UAAU,oDAIZxsB,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,MAAO,IAAM,EAAG,KACvC,QAAS,CAAE,QAAS,EAAG,MAAO,EAAG,EAAG,GACpC,KAAM,CAAE,QAAS,EAAG,MAAO,IAAM,EAAG,KACpC,UAAU,gEAEV,SAAAF,OAAC,OAAI,UAAU,8EAEb,UAAAA,OAAC,OAAI,UAAU,8DACb,UAAAC,MAACmL,GAAA,CAAO,UAAU,yBAAyB,EAC3CnL,MAAC,SACC,IAAK+J,EACL,KAAK,OACL,MAAO7K,EACP,SAAUgB,GAAKf,EAASe,EAAE,OAAO,KAAK,EACtC,YAAY,8BACZ,UAAU,sEACV,UAAS,KAEXF,MAAC,UACC,QAAS,IAAMwsB,EAAU,EAAK,EAC9B,UAAU,oDAEV,SAAAxsB,MAACqL,GAAA,CAAE,UAAU,UAAU,GACzB,EACF,QAGC,OAAI,UAAU,2BACZ,SAAAkgB,EAAiB,SAAW,EAC3BvrB,MAAC,OAAI,UAAU,uCAAuC,6BAAiB,EAEvEurB,EAAiB,IAAI,CAACjhB,EAAKgB,IAAU,CACnC,MAAMP,EAAOT,EAAI,KACXyV,EAAazU,IAAUzB,EAE7B,OACE9J,OAAC,UAEC,QAAS,IAAMuK,EAAI,SACnB,aAAc,IAAMR,EAAiBwB,CAAK,EAC1C,UAAW,wEACTyU,EACI,gDACA,uBACN,GAEA,UAAA/f,MAAC+K,EAAA,CAAK,KAAM,GAAI,UAAU,iBAAiB,EAC3ChL,OAAC,OAAI,UAAU,SACb,UAAAC,MAAC,OAAI,UAAU,yBAA0B,SAAAsK,EAAI,MAAM,EACnDtK,MAAC,OAAI,UAAU,yBAA0B,WAAI,YAAY,GAC3D,EACC+f,GAAc/f,MAAC,OAAI,UAAU,yBAAyB,iBAAK,IAdvDsK,EAAI,GAiBf,CAAC,EAEL,EAGAvK,OAAC,OAAI,UAAU,+FACb,UAAAC,MAAC,OAAI,kDAAsC,EAC3CA,MAAC,OAAI,kCAAsB,GAC7B,GACF,GACF,EACF,EAEJ,CAEJ,CChOO,SAASgtB,IAAuB,CACrC,KAAM,CAACngB,EAAUogB,CAAW,EAAI7tB,WAAiC,IAAI,EAC/D,CAAC8tB,EAAaC,CAAc,EAAI/tB,WAAS,EAAK,EAC9C,CAAE,UAAA4K,CAAA,EAAc1K,EAAA,EAChB,CAAE,QAAA0X,CAAA,EAAYlR,EAAA,EAEpB/C,YAAU,IAAM,CAId,GAFkB,CAACe,GAAA,GAAuB,CAACE,GAAA,EAGzC,OAIF,MAAMopB,EAAe,SAAY,CAC/B,GAAI,CACF,MAAMnrB,EAAS,MAAMnD,EAAI,QAAQ,eACjC,GAAImD,GAAQ,WAAaA,GAAQ,SAAU,CAEzC,MAAMorB,EAAe,MAAMvuB,EAAI,QAAQ,cACnCuuB,GAAgBA,EAAa,MAAQ,MAAM,QAAQA,EAAa,IAAI,GACtEJ,EAAYI,CAAY,CAE5B,CACF,MAAgB,CAKhB,CACF,EAKA,GAHAD,EAAA,EAGI,OAAO,KAAK,GAAI,CAClB,MAAME,EAAyB,CAC7BC,EACAC,IACG,CACHJ,EAAA,CACF,EAEA,cAAO,IAAI,KAAK,4BAA6BE,CAAsB,EAE5D,IAAM,CACP,OAAO,KAAK,gBACd,OAAO,IAAI,eAAe,4BAA6BA,CAAsB,CAEjF,CACF,CACF,EAAG,EAAE,EAEL,MAAMG,EAAgB,SAAY,CAChC,GAAK5gB,EAEL,CAAAsgB,EAAe,EAAI,EAEnB,GAAI,CAEF,UAAWzpB,KAAOmJ,EAAS,KAAM,CAC/B,MAAMue,EAAS,MAAMtsB,EAAI,KAAK,OAAO,CACnC,IAAK4E,EAAI,IACT,KAAOA,EAAI,MAA2C,SACtD,YAAaA,EAAI,YACjB,mBAAoB,GACrB,EAED,GAAI0nB,GAAU,OAAOA,GAAW,UAAY,OAAQA,EAAQ,CAC1D,MAAMpsB,EAAQ,OAAOosB,EAAO,IAAO,SAAWA,EAAO,GAAK,KACtDpsB,IAAU0E,EAAI,QAAUA,EAAI,KAAOmJ,EAAS,cAC9C7C,EAAUhL,CAAK,CAEnB,CACF,CAGI6N,EAAS,MACXmK,EAAQnK,EAAS,IAAW,EAI9B,MAAM/N,EAAI,QAAQ,iBAClBmuB,EAAY,IAAI,CAClB,OAASluB,EAAO,CACd,QAAQ,MAAM,4CAA6CA,CAAK,CAClE,SACEouB,EAAe,EAAK,CACtB,EACF,EAEMO,EAAgB,SAAY,CAChC,GAAI,CACF,MAAM5uB,EAAI,QAAQ,iBAClBmuB,EAAY,IAAI,CAClB,OAASluB,EAAO,CACd,QAAQ,MAAM,4CAA6CA,CAAK,CAClE,CACF,EAEA,GAAI,CAAC8N,EAAU,OAAO,KAEtB,MAAM8gB,EAAW9gB,EAAS,KAAK,OACzB+gB,EAAY,IAAI,KAAK/gB,EAAS,SAAS,EAE7C,OACE7M,MAAC,OACC,UAAU,mFACV,QAASE,GAAK,CAEGA,EAAE,OACN,QAAQ,QAAQ,CAG7B,EAEA,SAAAH,OAAC,OACC,UAAU,mFACV,QAASG,GAAK,CAEGA,EAAE,OACN,QAAQ,QAAQ,GAI3BA,EAAE,iBACJ,EAEA,UAAAH,OAAC,OAAI,UAAU,yCACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAC,MAAC8M,GAAA,CAAU,UAAU,wBAAwB,QAC5C,MAAG,UAAU,kCAAkC,qCAAyB,GAC3E,EACA9M,MAAC,UACC,KAAK,SACL,QAASE,GAAK,CACZA,EAAE,iBACFA,EAAE,kBACDA,EAAU,2BACX,WAAW,IAAM,CACfwtB,EAAA,CACF,EAAG,CAAC,CACN,EACA,UAAU,sDACV,aAAW,QACX,MAAO,CAAE,cAAe,OAAQ,OAAQ,OAExC,SAAA1tB,MAACqL,GAAA,CAAE,UAAU,UAAU,GACzB,EACF,QAEC,KAAE,UAAU,6BAA6B,6FAE1C,EAEAtL,OAAC,OAAI,UAAU,iDACb,UAAAA,OAAC,OAAI,UAAU,oCACb,gBAAC,QAAK,UAAU,gBAAgB,gBAAI,QACnC,QAAK,UAAU,4BAA6B,SAAA4tB,EAAS,GACxD,EACA5tB,OAAC,OAAI,UAAU,oCACb,gBAAC,QAAK,UAAU,gBAAgB,gBAAI,EACpCC,MAAC,QAAK,UAAU,uCAAwC,WAAS,KAAK,GACxE,EACAD,OAAC,OAAI,UAAU,oCACb,gBAAC,QAAK,UAAU,gBAAgB,sBAAU,EAC1CC,MAAC,QAAK,UAAU,4BACb,SAAAye,GAAoBmP,EAAW,CAAE,UAAW,GAAM,EACrD,GACF,GACF,EAEA7tB,OAAC,OAAI,UAAU,aACb,UAAAC,MAAC,UACC,KAAK,SACL,QAASE,GAAK,CACZA,EAAE,iBACFA,EAAE,kBACDA,EAAU,2BACX,WAAW,IAAM,CACfutB,EAAA,CACF,EAAG,CAAC,CACN,EACA,SAAUP,EACV,UAAU,kKACV,MAAO,CAAE,cAAeA,EAAc,OAAS,OAAQ,OAAQ,OAE9D,WACCntB,OAAAyP,WAAA,CACE,UAAAxP,MAACG,GAAA,CAAS,UAAU,uBAAuB,EAAE,gBAE/C,EAEAJ,OAAAyP,WAAA,CACE,UAAAxP,MAAC8M,GAAA,CAAU,UAAU,UAAU,EAAE,WAEnC,IAGJ9M,MAAC,UACC,KAAK,SACL,QAASE,GAAK,CACZA,EAAE,iBACFA,EAAE,kBACDA,EAAU,2BACX,WAAW,IAAM,CACfwtB,EAAA,CACF,EAAG,CAAC,CACN,EACA,SAAUR,EACV,UAAU,+FACV,MAAO,CAAE,cAAeA,EAAc,OAAS,OAAQ,OAAQ,OAChE,wBAED,EACF,IACF,EAGN,CC/OA,MAAMW,GAAqB,CACzB,0CACA,iDACA,uCACA,2CACA,iBACF,EAGMC,GAAoB,CACxB,oBACA,YACA,iBACA,aACA,iBACA,UACA,SACF,EASMC,GAA0C,CAC9C,QAAS,GACT,qBAAsB,GACtB,YAAa,GACb,UAAW,EACb,EAEA,IAAIC,GAAgB,CAAE,GAAGD,EAAA,EAKzB,eAAsBE,GAAiB1qB,EAIpC,CACD,GAAI,CAEF,MAAM2qB,EADS,IAAI,IAAI3qB,CAAG,EACF,SAAS,cAEjC,IAAI4qB,EAAQ,EACZ,MAAMC,EAAoB,GAG1B,UAAW/K,KAAWwK,IAChBxK,EAAQ,KAAK6K,CAAQ,GAAK7K,EAAQ,KAAK9f,CAAG,KAC5C4qB,GAAS,GACTC,EAAQ,KAAK,8BAA8B/K,EAAQ,MAAM,EAAE,GAK3DyK,GAAkB,KAAKO,GAAUH,EAAS,SAASG,CAAM,CAAC,IAC5DF,GAAS,GACTC,EAAQ,KAAK,wBAAwB,GAIvC,GAAI,CACF,GAAI,OAAQtvB,EAAY,SAAS,SAAY,WAAY,CACvD,MAAMwvB,EAAa,MAAOxvB,EAAY,QAAQ,QAAQyE,CAAG,EACzD,GAAI+qB,GAAc,OAAOA,GAAe,SAAU,CAChD,MAAMC,EAAaD,EAAmB,WAAa,MAC/CC,IAAc,QAAUA,IAAc,YACxCJ,GAAS,GACTC,EAAQ,KAAK,sBAAsBG,CAAS,OAAO,GAC1CA,IAAc,WACvBJ,GAAS,GACTC,EAAQ,KAAK,sBAAsBG,CAAS,OAAO,EAEvD,CACF,CACF,OAASxvB,EAAO,CACd,QAAQ,MAAM,0CAA2CA,CAAK,CAChE,CAEA,MAAO,CACL,YAAaovB,GAASH,GAAc,qBACpC,MAAO,KAAK,IAAI,IAAKG,CAAK,EAC1B,QAAAC,CAAA,CAEJ,OAASrvB,EAAO,CACd,eAAQ,MAAM,mDAAoDA,CAAK,EAChE,CAAE,YAAa,GAAO,MAAO,EAAG,QAAS,EAAC,CACnD,CACF,CAKA,eAAsByvB,GAAkBjrB,EAAasC,EAA6F,CAChJ,GAAI,CAACmoB,GAAc,SAAWnoB,IAAgB,SAC5C,OAAO,KAGT,MAAM4oB,EAAc,MAAMR,GAAiB1qB,CAAG,EAE9C,GAAI,CAACkrB,EAAY,YACf,OAAO,KAMT,GAHA,QAAQ,MAAM,uDAAuDA,EAAY,KAAK,KAAMlrB,EAAKkrB,EAAY,OAAO,EAGhHT,GAAc,UAChB,GAAI,CAEF,MAAMU,EAAY,MAAM5vB,EAAI,IAAI,SAChC,GAAI4vB,GAAa,CAACA,EAAU,KAE1B,OAAKA,EAAU,SACb,MAAM5vB,EAAI,IAAI,QAGhB,MAAMA,EAAI,QAAQ,eAAe,CAAE,IAAAyE,EAAK,EACjC,OAEX,OAASxE,EAAO,CACd,QAAQ,KAAK,yDAA0DA,CAAK,CAC9E,CAIF,GAAIivB,GAAc,YAChB,GAAI,CACF,aAAMlvB,EAAI,QAAQ,aAAa,CAAE,IAAAyE,EAAK,EAC/B,SACT,OAASxE,EAAO,CACd,QAAQ,MAAM,uDAAwDA,CAAK,CAC7E,CAGF,OAAO,IACT,CC5HA,MAAM4vB,GAAY,CAACnvB,EAAqBH,IAA4B,CAClE,MAAMmH,EAAOhH,EACV,IAAKkE,GAAQ,GAAGA,EAAI,SAAW,KAAK,IAAIA,EAAI,KAAO,aAAa,EAAE,EAClE,KAAK,IAAI,EACZ,MAAO,GAAGrE,GAAY,MAAM,IAAImH,CAAI,EACtC,EAEaooB,GAAkBlwB,GAAA,EAC7BqgB,GACE,CAACpgB,EAAKC,KAAS,CACb,SAAU,KACV,aAAc,CAACY,EAAMH,IAAa,CAChC,GAAI,CAAC,MAAM,QAAQG,CAAI,GAAKA,EAAK,SAAW,EAAG,CAC7Cb,EAAI,CAAE,SAAU,KAAM,EACtB,MACF,CACA,MAAMkwB,EAA8BrvB,EAAK,IAAKkE,IAAS,CACrD,GAAIA,EAAI,GACR,IAAKA,EAAI,IACT,MAAOA,EAAI,MACX,QAASA,EAAI,QACb,YAAaA,EAAI,YACjB,cAAeA,EAAI,cACnB,eAAgBA,EAAI,gBACpB,EACIorB,EAAOlwB,IAAM,SACbmwB,EAAOJ,GAAUE,EAAcxvB,CAAQ,EACzCyvB,GAAM,OAASC,GAGnBpwB,EAAI,CACF,SAAU,CACR,UAAW,KAAK,MAChB,SAAUkwB,EAAa,OACvB,KAAMA,EACN,SAAUA,EAAa,KAAMnrB,GAAQA,EAAI,KAAOrE,CAAQ,EAAIA,EAAWwvB,EAAa,CAAC,EAAE,GACvF,KAAAE,CAAA,CACF,CACD,CACH,EACA,cAAe,IAAMpwB,EAAI,CAAE,SAAU,KAAM,EAC3C,oBAAqB,SAAY,CAC/B,MAAMkO,EAAWjO,IAAM,SACvB,GAAI,CAACiO,GAAYA,EAAS,KAAK,SAAW,EACxC,MAAO,CAAE,SAAU,GAAO,SAAU,GAEtC,MAAMmiB,EAAY1vB,EAAa,WACzB2vB,EAA0B,GAChC,UAAWC,KAASriB,EAAS,KAAM,CACjC,MAAMlI,EAAYuqB,EAAM,KAAO,cAC/B,GAAI,CACF,MAAMjtB,EAAS,MAAMnD,EAAI,KAAK,OAAO6F,CAAS,EACxCwqB,EACJ,OAAOltB,GAAW,SAAWA,EAAUA,GAAU,OAAOA,GAAW,SAAYA,EAAe,GAAK,KACjGktB,IACFH,EAAU,UAAUG,EAAY,CAC9B,MAAOD,EAAM,MACb,QAASA,EAAM,QACf,YAAaA,EAAM,YACnB,cAAeA,EAAM,cACrB,eAAgBA,EAAM,eACvB,EACDD,EAAc,KAAKE,CAAU,EAEjC,OAASpwB,EAAO,CACd,QAAQ,KAAK,uDAAwDA,CAAK,CAC5E,CACF,CACA,GAAIkwB,EAAc,SAAW,EAC3B,MAAO,CAAE,SAAU,GAAO,SAAU,GAEtC,MAAMG,EAAsBviB,EAAS,KAAK,UAAWnJ,GAAQA,EAAI,KAAOmJ,EAAS,QAAQ,EACnFwiB,EACJD,GAAuB,EAAIH,EAAcG,CAAmB,EAAIH,EAAcA,EAAc,OAAS,CAAC,EACxG,GAAII,EAAgB,CAClBL,EAAU,UAAUK,CAAc,EAClC,GAAI,CACF,MAAMvwB,EAAI,KAAK,SAAS,CAAE,GAAIuwB,EAAgB,CAChD,OAAStwB,EAAO,CACd,QAAQ,KAAK,kDAAmDA,CAAK,CACvE,CACF,CACA,MAAO,CAAE,SAAU,GAAM,SAAUkwB,EAAc,OACnD,IAEF,CACE,KAAM,yBACN,QAAS,EACX,CAEJ,ECjGMK,GAAsB,gBACtBC,GAAc,IAEdC,GAAqB,IAAsB,CAC/C,GAAI,OAAO,OAAW,IACpB,MAAO,GAET,GAAI,CACF,MAAMC,EAAM,OAAO,aAAa,QAAQH,EAAmB,EAC3D,GAAI,CAACG,EAAK,MAAO,GACjB,MAAMC,EAAS,KAAK,MAAMD,CAAG,EAC7B,OAAK,MAAM,QAAQC,CAAM,EAClBA,EACJ,OAAQC,GAASA,GAAQ,OAAOA,EAAK,IAAO,QAAQ,EACpD,KAAK,CAAC,EAAG3tB,KAAOA,EAAE,WAAa,IAAM,EAAE,WAAa,EAAE,EACtD,MAAM,EAAGutB,EAAW,EAJY,EAKrC,MAAQ,CACN,MAAO,EACT,CACF,EAEMK,GAAkBC,GAA4B,CAClD,GAAI,SAAO,OAAW,KACtB,GAAI,CACF,OAAO,aAAa,QAAQP,GAAqB,KAAK,UAAUO,CAAO,CAAC,CAC1E,OAAS9wB,EAAO,CACd,QAAQ,KAAK,2CAA4CA,CAAK,CAChE,CACF,EAEa+wB,GAAkBpxB,GAAqB,CAACC,EAAKC,KAAS,CACjE,QAAS4wB,GAAA,EACT,SAAWlR,GAAU,CACnB,MAAMyR,EAAyB,CAC7B,GAAGzR,EACH,GAAI,GAAGA,EAAM,IAAI,IAAI,KAAK,KAAK,IAAI,KAAK,SAAS,SAAS,EAAE,EAAE,MAAM,CAAC,CAAC,GACtE,UAAW,KAAK,KAAI,EAEtB3f,EAAKY,GAAU,CACb,MAAM6Y,EAAO,CAAC2X,EAAU,GAAGxwB,EAAM,OAAO,EAAE,MAAM,EAAGgwB,EAAW,EAC9D,OAAAK,GAAexX,CAAI,EACZ,CAAE,QAASA,CAAA,CACpB,CAAC,CACH,EACA,MAAO,IAAM,CACXzZ,EAAI,CAAE,QAAS,GAAI,EACnBixB,GAAe,EAAE,CACnB,EACA,UAAW,CAACI,EAAQ,KACXpxB,EAAA,EAAM,QAAQ,MAAM,EAAGoxB,CAAK,CAEvC,EAAE,EC7DK,SAASC,IAA8B,CAC5C,MAAMC,EAAY,SAAS,eAAe,WAAW,EACrD,GAAIA,EAAW,CACb,MAAMpiB,EAASoiB,EAAU,wBAAwB,OACjD,SAAS,gBAAgB,MAAM,YAAY,sBAAuB,GAAGpiB,CAAM,IAAI,CACjF,MAEE,SAAS,gBAAgB,MAAM,YAAY,sBAAuB,MAAM,CAE5E,CAKO,SAASqiB,IAA2B,CACzC,MAAMC,EAAS,SAAS,cAAc,mBAAmB,EACzD,GAAIA,EAAQ,CACV,MAAMtiB,EAASsiB,EAAO,wBAAwB,OAC9C,SAAS,gBAAgB,MAAM,YAAY,kBAAmB,GAAGtiB,CAAM,IAAI,CAC7E,MACE,SAAS,gBAAgB,MAAM,YAAY,kBAAmB,MAAM,CAExE,CAKO,SAASuiB,IAA2B,CACzC,MAAMC,EAAU,SAAS,cAAc,gBAAgB,EACvD,GAAIA,EAAS,CACX,MAAMziB,EAAQyiB,EAAQ,wBAAwB,MAC9C,SAAS,gBAAgB,MAAM,YAAY,kBAAmB,GAAGziB,CAAK,IAAI,CAC5E,MACE,SAAS,gBAAgB,MAAM,YAAY,kBAAmB,OAAO,CAEzE,CAKO,SAAS0iB,IAA6B,CAE3CN,GAAA,EACAE,GAAA,EACAE,GAAA,EAGA,MAAMjtB,EAAe,IAAM,CACzB6sB,GAAA,EACAE,GAAA,EACAE,GAAA,CACF,EAEA,OAAO,iBAAiB,SAAUjtB,CAAY,EAG9C,MAAM8sB,EAAY,SAAS,eAAe,WAAW,EAC/CM,EAAiBN,EACnB,IAAI,eAAe,IAAM,CACvBD,GAAA,CACF,CAAC,EACD,KAEJ,OAAIC,GAAaM,GACfA,EAAe,QAAQN,CAAS,EAI3B,IAAM,CACX,OAAO,oBAAoB,SAAU9sB,CAAY,EAC7CotB,GAAkBN,GACpBM,EAAe,UAAUN,CAAS,CAEtC,CACF,CCxEO,SAASO,GAAa,CAAE,KAAA9mB,EAAM,QAAA0C,GAA8B,CACjE,KAAM,CAAE,aAAAqkB,EAAc,gBAAAC,EAAiB,UAAAC,EAAW,eAAAC,EAAgB,OAAAC,EAAQ,YAAAC,CAAA,EACxEC,GAAA,EACI,CAAC7sB,EAASC,CAAU,EAAIhF,WAAS,EAAK,EACtC,CAACL,EAAO6rB,CAAQ,EAAIxrB,WAAwB,IAAI,EAChD,CAAC6xB,EAAWC,CAAY,EAAI9xB,WAAS,EAAE,EAE7C2D,YAAU,IAAM,CACd,GAAI,CAAC4G,EAAM,OACX,IAAIwnB,EAAY,GAEhB,MAAMC,EAAY,SAAY,CAC5BhtB,EAAW,EAAI,EACfwmB,EAAS,IAAI,EACb,GAAI,CACF,MAAMyG,EAAQ,MAAMC,GAAgBZ,CAAY,EAC3CS,GACHJ,EAAYL,EAAcW,CAAK,CAEnC,OAASvG,EAAK,CACPqG,GACHvG,EAASE,aAAe,MAAQA,EAAI,QAAU,sBAAsB,CAExE,SACOqG,GACH/sB,EAAW,EAAK,CAEpB,CACF,EAEAgtB,EAAA,EAEA,MAAM7pB,EAAW,YAAY6pB,EAAW,GAAI,EAC5C,MAAO,IAAM,CACXD,EAAY,GACZ,cAAc5pB,CAAQ,CACxB,CACF,EAAG,CAACmpB,EAAc/mB,EAAMonB,CAAW,CAAC,EAEpC,MAAMM,EAAQP,EAAOJ,CAAY,EAC3Ba,GAAkBF,GAAO,QAAU,IAAM,EAE/C,OACEtxB,OAAAyP,WAAA,CAEG,UAAA7F,GACC3J,MAAC,OACC,UAAU,4DACV,QAASqM,EACT,cAAY,SAGhBtM,OAAC,OACC,UAAW,0KACT4J,EAAO,gBAAkB,kBAC3B,GACA,QAASzJ,GAAKA,EAAE,kBAEhB,UAAAH,OAAC,OAAI,UAAU,iEACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAC,MAACwxB,GAAA,CAAO,KAAM,GAAI,UAAU,gBAAgB,SAC3C,OACC,UAAAxxB,MAAC,MAAG,UAAU,mCAAmC,sBAAU,EAC3DA,MAAC,KAAE,UAAU,wBAAwB,+CAAmC,GAC1E,GACF,EACAA,MAAC,UACC,QAASqM,EACT,UAAU,sFACV,aAAW,sBACZ,cAED,EACF,EAEAtM,OAAC,OAAI,UAAU,uCACb,UAAAA,OAAC,OAAI,UAAU,0DACb,UAAAA,OAAC,OAAI,UAAU,oCACb,UAAAA,OAAC,OACC,UAAAC,MAAC,OAAI,UAAU,gDAAgD,yBAAa,EAC5EA,MAAC,OAAI,UAAU,gCAAiC,SAAA0wB,EAAa,EAC5DW,GACCtxB,OAAC,OAAI,UAAU,+BACZ,UAAAwxB,EACCvxB,MAAC+sB,GAAA,CAAW,KAAM,GAAI,UAAU,iBAAiB,EAEjD/sB,MAACyxB,GAAA,CAAa,KAAM,GAAI,UAAU,eAAe,EAEnD1xB,OAAC,QAAK,UAAWwxB,EAAiB,iBAAmB,eAClD,UAAAF,EAAM,OAAO,QAAQ,CAAC,EAAE,KAAGA,EAAM,cAAc,QAAQ,CAAC,EAAE,MAC7D,GACF,GAEJ,EACArxB,MAAC,UACC,QAAS,IACP8wB,EAAOJ,CAAY,GAAKK,EAAYL,EAAcI,EAAOJ,CAAY,CAAE,EAEzE,UAAU,8EACV,MAAM,gBAEN,SAAA1wB,MAAC4M,GAAA,CAAU,KAAM,GAAI,GACvB,EACF,EAEA5M,MAAC,OAAI,UAAU,YACZ,WACCA,MAAC0xB,GAAA,CAAU,OAAQL,EAAM,UAAW,SAAUE,EAAgB,QAE7D,OAAI,UAAU,gEACZ,SAAAptB,EAAU,aAAe,UAC5B,EAEJ,GACF,EAEApE,OAAC,OAAI,UAAU,oEACb,UAAAA,OAAC,OAAI,UAAU,oCACb,UAAAC,MAAC,QAAK,UAAU,sCAAsC,qBAAS,EAC/DD,OAAC,OAAI,UAAU,0BACb,UAAAC,MAAC,SACC,MAAOixB,EACP,SAAU/wB,GAAKgxB,EAAahxB,EAAE,OAAO,MAAM,aAAa,EACxD,YAAY,aACZ,UAAU,iFAEZF,MAAC,UACC,QAAS,IAAM,CACRixB,IACLJ,EAAeI,CAAS,EACxBN,EAAgBM,CAAS,EACzBC,EAAa,EAAE,EACjB,EACA,UAAU,kEAEV,SAAAlxB,MAAC4S,GAAA,CAAK,KAAM,GAAI,GAClB,EACF,GACF,QACC,OAAI,UAAU,uBACZ,SAAAge,EAAU,IAAIpN,GAAU,CACvB,MAAM6N,EAAQP,EAAOtN,CAAM,EACrBmO,EAAWN,EAAQA,EAAM,QAAU,EAAI,GAC7C,OACErxB,MAAC,UAEC,QAAS,IAAM2wB,EAAgBnN,CAAM,EACrC,UAAW,2DACTA,IAAWkN,EACP,kDACA,wDACN,GAEA,SAAA3wB,OAAC,OAAI,UAAU,0BACb,UAAAC,MAAC,QAAM,SAAAwjB,CAAA,CAAO,EACb6N,GACCtxB,OAAC,QAAK,UAAW4xB,EAAW,iBAAmB,eAC5C,UAAAA,EAAW,IAAM,GACjBN,EAAM,cAAc,QAAQ,CAAC,EAAE,KAClC,GAEJ,GAhBK7N,CAAA,CAmBX,CAAC,EACH,GACF,EAEC6N,GACCtxB,OAAC,OAAI,UAAU,oEACb,UAAAA,OAAC,OAAI,UAAU,oCACb,UAAAC,MAAC,QAAK,UAAU,sCAAsC,qBAAS,EAC/DA,MAAC,QACC,UAAW,oCACTqxB,EAAM,YAAc,UAChB,iCACAA,EAAM,YAAc,UAClB,6BACA,2BACR,GAEC,SAAAA,EAAM,WACT,EACF,EACAtxB,OAAC,OAAI,UAAU,+CACb,UAAAA,OAAC,OACC,UAAAC,MAAC,OAAI,UAAU,wBAAwB,iBAAK,EAC5CD,OAAC,OAAI,UAAU,mCAAmC,cAAEsxB,EAAM,MAAM,QAAQ,CAAC,GAAE,GAC7E,SACC,OACC,UAAArxB,MAAC,OAAI,UAAU,wBAAwB,kBAAM,QAC5C,OAAK,SAAAqxB,EAAM,QAAQ,kBAAoB,IAAI,GAC9C,SACC,OACC,UAAArxB,MAAC,OAAI,UAAU,wBAAwB,sBAAU,SAChD,OAAI,cAAEqxB,EAAM,eAAe,QAAQ,CAAC,GAAK,KAAI,GAChD,SACC,OACC,UAAArxB,MAAC,OAAI,UAAU,wBAAwB,mBAAO,EAC9CA,MAAC,OAAK,aAAI,KAAKqxB,EAAM,SAAS,EAAE,oBAAmB,CAAE,GACvD,GACF,GACF,EAGDtyB,GAASiB,MAAC,OAAI,UAAU,uBAAwB,SAAAjB,CAAA,CAAM,GACzD,IACF,EACF,CAEJ,CAEA,SAAS2yB,GAAU,CAAE,OAAAE,EAAQ,SAAAD,GAAqD,CAChF,MAAMpQ,EAAM,KAAK,IAAI,GAAGqQ,CAAM,EACxBC,EAAM,KAAK,IAAI,GAAGD,CAAM,EACxBjP,EAAQpB,EAAMsQ,GAAO,EAC3B,OACE7xB,MAAC,OAAI,UAAU,yCACZ,WAAO,IAAI,CAAC8mB,EAAOgL,IAAQ,CAC1B,MAAMC,GAAkBjL,EAAQ+K,GAAOlP,EAAS,IAChD,OACE3iB,MAAC,OAEC,UAAW,qBAAqB2xB,EAAW,kBAAoB,eAAe,GAC9E,MAAO,CAAE,OAAQ,GAAGI,CAAa,IAAI,EAFhCD,CAAA,CAKX,CAAC,EACH,CAEJ,CChOO,SAASE,GAAgB,CAAE,SAAAC,EAAU,UAAAC,GAAmC,CAC7E,KAAM,CAACC,EAAeC,CAAgB,EAAIhzB,WAAS,EAAK,EAClD,CAACizB,EAAiBC,CAAkB,EAAIlzB,WAAwB,IAAI,EACpE,CAACmzB,EAAcC,CAAe,EAAIpzB,WAAS,EAAK,EAChDqzB,EAAgB9kB,GAAM,OAAO,EAAK,EAKxC5K,YAAU,IAAM,CAEd,GAAI,CAAA0vB,EAAc,QAClB,CAAAA,EAAc,QAAU,GAExB,GAAI,CACF,MAAM/W,EAAS,aAAa,QAAQ,oBAAoB,EACxD,GAAIA,EACF,GAAI,CACF,MAAMnR,EAAO,KAAK,MAAMmR,CAAM,EAE9B,GAAInR,EAAK,UADc,cACgBA,EAAK,SAAU,CACpD+nB,EAAmB/nB,EAAK,OAAO,EAE3B,OAAO0nB,GAAa,YACtB,WAAW,IAAM,CACfA,EAAA,CACF,EAAG,CAAC,EAEN,MACF,CACF,MAAQ,CAER,CAEJ,OAASlzB,EAAO,CACd,QAAQ,MAAM,sDAAuDA,CAAK,CAE5E,EACF,EAAG,EAAE,EAGL,MAAM2zB,EAAgBC,GAAsC,CAE5D,EAEMC,EAAqB,IAAM,CAC3B,OAAOX,GAAa,YACtB,QAAQ,UAAU,KAAK,IAAM,CAC3BA,EAAA,CACF,CAAC,CAEL,EAEMY,EAAe,IAAM,CACzB,GAAI,CAACN,EAAc,CACjB,QAAQ,KAAK,uDAAuD,EACpE,MACF,CAEA,QAAQ,IAAI,yCAAyC,EACrD,GAAI,CACF,MAAMO,EAAiB,CACrB,QAAS,aACT,SAAU,GACV,UAAW,KAAK,KAAI,EAEtB,aAAa,QAAQ,qBAAsB,KAAK,UAAUA,CAAc,CAAC,EACzE,QAAQ,IAAI,oDAAoD,EAGhER,EAAmB,YAAY,EAC/B,QAAQ,IAAI,iDAAiD,EAE7DM,EAAA,CACF,OAAS7zB,EAAO,CACd,QAAQ,MAAM,+CAAgDA,CAAK,EAEnEuzB,EAAmB,YAAY,EAC/BM,EAAA,CACF,CACF,EAEMG,EAAgB,IAAM,CAC1B,GAAI,CAEF,aAAa,WAAW,oBAAoB,CAC9C,OAASh0B,EAAO,CACd,QAAQ,MAAM,gDAAiDA,CAAK,CACtE,CACI,OAAOmzB,GAAc,YACvBA,EAAA,CAEJ,EAGA,OAAIG,GACF,QAAQ,IAAI,iEAAkEA,CAAe,EACtF,MAIPryB,MAACiG,GAAA,CAAgB,KAAK,OACpB,SAAAjG,MAACC,EAAO,IAAP,CAEC,QAAS,CAAE,QAAS,GACpB,QAAS,CAAE,QAAS,GACpB,KAAM,CAAE,QAAS,GACjB,UAAU,+FACV,MAAO,CAAE,cAAe,QACxB,YAAaC,GAAK,CAEhB,MAAMmI,EAASnI,EAAE,OAEfmI,EAAO,QAAQ,QAAQ,GACvBA,EAAO,QAAQ,iBAAiB,GAChCA,EAAO,QAAQ,GAAG,CAItB,EACA,QAASnI,GAAK,CAEZ,MAAMmI,EAASnI,EAAE,OAEfmI,EAAO,QAAQ,QAAQ,GACvBA,EAAO,QAAQ,iBAAiB,GAChCA,EAAO,QAAQ,GAAG,CAItB,EAEA,SAAAtI,OAACE,EAAO,IAAP,CACC,QAAS,CAAE,MAAO,IAAM,QAAS,GACjC,QAAS,CAAE,MAAO,EAAG,QAAS,GAC9B,KAAM,CAAE,MAAO,IAAM,QAAS,GAC9B,UAAU,uGACV,YAAaC,GAAK,CAEhB,MAAMmI,EAASnI,EAAE,OAEfmI,EAAO,QAAQ,QAAQ,GACvBA,EAAO,QAAQ,iBAAiB,GAChCA,EAAO,QAAQ,GAAG,CAItB,EACA,QAASnI,GAAK,CAEZ,MAAMmI,EAASnI,EAAE,OAEfmI,EAAO,QAAQ,QAAQ,GACvBA,EAAO,QAAQ,iBAAiB,GAChCA,EAAO,QAAQ,GAAG,GAKpBnI,EAAE,iBACJ,EAGA,UAAAH,OAAC,OAAI,UAAU,uDACb,UAAAC,MAAC,OAAI,UAAU,gCACb,SAAAA,MAACoJ,IAAS,KAAM,GAAI,UAAU,gBAAgB,EAChD,EACArJ,OAAC,OAAI,UAAU,SACb,UAAAC,MAAC,MAAG,UAAU,sCAAsC,4BAAgB,EACpEA,MAAC,KAAE,UAAU,6BAA6B,mEAE1C,GACF,GACF,EAGAA,MAAC,OACC,UAAU,mEACV,SAAU0yB,EAET,SAAAP,EACCpyB,OAAC,OAAI,UAAU,yCACb,UAAAC,MAAC,KAAE,UAAU,qBACX,SAAAA,MAAC,UAAO,2CAA+B,EACzC,EAEAD,OAAC,WAAQ,UAAU,OACjB,UAAAC,MAAC,MAAG,UAAU,2CAA2C,kCAEzD,EACAA,MAAC,KAAE,gLAIH,GACF,EAEAD,OAAC,WAAQ,UAAU,OACjB,UAAAC,MAAC,MAAG,UAAU,2CAA2C,qCAEzD,EACAA,MAAC,KAAE,gNAIH,GACF,EAEAD,OAAC,WAAQ,UAAU,OACjB,UAAAC,MAAC,MAAG,UAAU,2CAA2C,+BAAmB,EAC5EA,MAAC,KAAE,UAAU,OAAO,+KAIpB,EACAA,MAAC,KAAE,gGAGH,GACF,EAEAD,OAAC,WAAQ,UAAU,OACjB,UAAAC,MAAC,MAAG,UAAU,2CAA2C,6BAAiB,EAC1EA,MAAC,KAAE,UAAU,OAAO,0CAA8B,EAClDD,OAAC,MAAG,UAAU,qDACZ,UAAAC,MAAC,MAAG,sDAA0C,EAC9CA,MAAC,MAAG,oDAAwC,EAC5CA,MAAC,MAAG,sDAA0C,EAC9CA,MAAC,MAAG,wCAA4B,EAChCA,MAAC,MAAG,oDAAwC,GAC9C,GACF,EAEAD,OAAC,WAAQ,UAAU,OACjB,UAAAC,MAAC,MAAG,UAAU,2CAA2C,0BAAc,EACvEA,MAAC,KAAE,UAAU,OAAO,+LAIpB,EACAA,MAAC,KAAE,sIAGH,GACF,EAEAD,OAAC,WAAQ,UAAU,OACjB,UAAAC,MAAC,MAAG,UAAU,2CAA2C,0BAAc,SACtE,KAAE,0GAEY,IACbD,OAAC,KACC,KAAK,uCACL,OAAO,SACP,IAAI,sBACJ,UAAU,6EACX,mBAECC,MAACoG,GAAA,CAAa,KAAM,GAAI,IAC1B,EACF,GACF,QAEC,OAAI,UAAU,+DACb,SAAArG,OAAC,KAAE,UAAU,wBACX,UAAAC,MAAC,UAAO,iBAAK,EAAS,iEACT,IACbA,MAAC,QAAK,UAAU,2CAA2C,+BAE3D,EAAQ,IAAI,KACT,IACHD,OAAC,KACC,KAAK,qEACL,OAAO,SACP,IAAI,sBACJ,UAAU,6EACX,wBAECC,MAACoG,GAAA,CAAa,KAAM,GAAI,IAC1B,EACF,EACF,GACF,EAEArG,OAAC,OAAI,UAAU,YACb,UAAAA,OAAC,OAAI,UAAU,uDACb,UAAAC,MAAC,MAAG,UAAU,mCAAmC,uBAAW,EAC5DD,OAAC,MAAG,UAAU,0BACZ,UAAAA,OAAC,MAAG,UAAU,yBACZ,UAAAC,MAACgzB,GAAA,CAAM,KAAM,GAAI,UAAU,sCAAsC,EACjEhzB,MAAC,QAAK,8CAAkC,GAC1C,EACAD,OAAC,MAAG,UAAU,yBACZ,UAAAC,MAACgzB,GAAA,CAAM,KAAM,GAAI,UAAU,sCAAsC,EACjEhzB,MAAC,QAAK,iDAAqC,GAC7C,EACAD,OAAC,MAAG,UAAU,yBACZ,UAAAC,MAACgzB,GAAA,CAAM,KAAM,GAAI,UAAU,sCAAsC,EACjEhzB,MAAC,QAAK,oEAAwD,GAChE,EACAD,OAAC,MAAG,UAAU,yBACZ,UAAAC,MAACgzB,GAAA,CAAM,KAAM,GAAI,UAAU,sCAAsC,EACjEhzB,MAAC,QAAK,gDAAoC,GAC5C,EACAD,OAAC,MAAG,UAAU,yBACZ,UAAAC,MAACgzB,GAAA,CAAM,KAAM,GAAI,UAAU,sCAAsC,EACjEhzB,MAAC,QAAK,yEAA6D,GACrE,GACF,GACF,EAEAD,OAAC,UACC,KAAK,SACL,QAASG,GAAK,CACZA,EAAE,iBACDA,EAAU,2BACXA,EAAE,kBACFkyB,EAAiB,EAAI,CACvB,EACA,YAAalyB,GAAK,CAChBA,EAAE,iBACDA,EAAU,2BACXA,EAAE,kBACFkyB,EAAiB,EAAI,CACvB,EACA,cAAelyB,GAAK,CAClBA,EAAE,iBACDA,EAAU,2BACXA,EAAE,kBACFkyB,EAAiB,EAAI,CACvB,EACA,UAAU,0KACV,MAAO,CACL,cAAe,OACf,OAAQ,UACR,OAAQ,MACR,SAAU,WACV,UAAW,UACX,YAAa,gBAGf,UAAApyB,MAACoJ,GAAA,CAAS,KAAM,GAAI,EACpBpJ,MAAC,QAAK,sCAA0B,IAClC,EACF,UAKH,OAAI,UAAU,uEACb,SAAAD,OAAC,OAAI,UAAU,6BAEb,UAAAA,OAAC,SAAM,UAAU,8CACf,UAAAC,MAAC,SACC,KAAK,WACL,QAASuyB,EACT,SAAUryB,GAAK,CACbA,EAAE,kBACFsyB,EAAgBtyB,EAAE,OAAO,OAAO,CAClC,EACA,QAASA,GAAK,CACZA,EAAE,iBACJ,EACA,UAAU,mKACV,MAAO,CACL,cAAe,OACf,OAAQ,MACR,SAAU,WACZ,GAEFF,MAAC,QAAK,UAAU,kDAAkD,yDAElE,GACF,EAEAD,OAAC,OAAI,UAAU,0BACb,UAAAA,OAAC,UACC,KAAK,SACL,QAASG,GAAK,CACZA,EAAE,iBACDA,EAAU,2BACXA,EAAE,kBACF6yB,EAAA,CACF,EACA,YAAa7yB,GAAK,CAChBA,EAAE,iBACDA,EAAU,2BACXA,EAAE,kBACF6yB,EAAA,CACF,EACA,cAAe7yB,GAAK,CAClBA,EAAE,iBACDA,EAAU,2BACXA,EAAE,kBACF6yB,EAAA,CACF,EACA,UAAU,kKACV,MAAO,CACL,cAAe,OACf,OAAQ,UACR,OAAQ,MACR,SAAU,WACV,UAAW,UACX,YAAa,gBAGf,UAAA/yB,MAACqL,GAAA,CAAE,KAAM,GAAI,EACbrL,MAAC,QAAK,mBAAO,KAEfD,OAAC,UACC,KAAK,SACL,SAAU,CAACwyB,EACX,QAASryB,GAAK,CACZ,GAAI,CAACqyB,EAAc,CACjBryB,EAAE,iBACFA,EAAE,kBACF,MACF,CACA,QAAQ,IAAI,mDAAmD,EAC/DA,EAAE,iBACFA,EAAE,kBACF2yB,EAAA,CACF,EACA,YAAa3yB,GAAK,CAChB,GAAI,CAACqyB,EAAc,CACjBryB,EAAE,iBACFA,EAAE,kBACF,MACF,CACA,QAAQ,IAAI,uDAAuD,EACnEA,EAAE,iBACFA,EAAE,iBAEJ,EACA,cAAeA,GAAK,CAClB,GAAI,CAACqyB,EAAc,CACjBryB,EAAE,iBACFA,EAAE,kBACF,MACF,CACA,QAAQ,IAAI,yDAAyD,EACrEA,EAAE,iBACFA,EAAE,iBAEJ,EACA,UAAW,wGACTqyB,EACI,0DACA,yDACN,GACA,MAAO,CACL,cAAe,OACf,OAAQA,EAAe,UAAY,cACnC,OAAQ,MACR,SAAU,WACV,UAAW,UACX,YAAa,gBAGf,UAAAvyB,MAACgzB,GAAA,CAAM,KAAM,GAAI,EACjBhzB,MAAC,QAAK,kBAAM,IACd,EACF,GACF,EACF,IACF,EA1WI,0BA4WR,CAEJ,CC9cA,MAAMizB,GAAiB,aAQhB,SAASC,GAAc,CAAE,SAAAjB,EAAU,UAAAC,EAAW,aAAAiB,EAAe,IAA6B,CAC/F,KAAM,CAACC,EAAaC,CAAc,EAAIj0B,WAA4B,CAChE,UAAW,GACX,UAAW,GACX,WAAY,GACZ,YAAa,GACb,UAAW,KAAK,MAChB,QAAS6zB,EAAA,CACV,EACK,CAACK,EAAaC,CAAc,EAAIn0B,WAAS+zB,CAAY,EACrD,CAACK,EAAeC,CAAgB,EAAIr0B,WAAS,EAAK,EAGxD2D,YAAU,IAAM,CACd,GAAI,CACF,MAAM2Y,EAAS,aAAa,QAAQ,sBAAsB,EAC1D,GAAIA,EAAQ,CACV,MAAMnR,EAAO,KAAK,MAAMmR,CAAM,EAC1BnR,EAAK,UAAY0oB,KACnBI,EAAe9oB,CAAI,EACnBkpB,EAAiB,EAAI,EAEzB,CACF,MAAQ,CAER,CACF,EAAG,EAAE,EAEL,MAAMC,EAAkB,IAAM,CAC5B,MAAMC,EAAiC,CACrC,UAAW,GACX,UAAW,GACX,WAAY,GACZ,YAAa,GACb,UAAW,KAAK,MAChB,QAASV,EAAA,EAEXI,EAAeM,CAAW,EAC1BF,EAAiB,EAAI,EACrBxB,EAAS0B,CAAW,CACtB,EAEMC,EAAuB,IAAM,CACjCH,EAAiB,EAAI,EACrBxB,EAASmB,CAAW,CACtB,EAEML,EAAgB,IAAM,CAC1B,MAAMc,EAA6B,CACjC,UAAW,GACX,UAAW,GACX,WAAY,GACZ,YAAa,GACb,UAAW,KAAK,MAChB,QAASZ,EAAA,EAEXI,EAAeQ,CAAO,EACtBJ,EAAiB,EAAI,EACrBxB,EAAS4B,CAAO,EAChB3B,IAAA,CACF,EAEM4B,EAAkB/H,GAA6B,CAC/CA,IAAa,aACjBsH,EAAe1oB,IAAS,CACtB,GAAGA,EACH,CAACohB,CAAQ,EAAG,CAACphB,EAAKohB,CAAQ,GAC1B,CACJ,EAEMgI,EAAmB,CACvB,CACE,GAAI,YACJ,KAAM,oBACN,YAAa,8DACb,SAAU,GACV,SAAU,CAAC,qBAAsB,WAAY,gBAAgB,GAE/D,CACE,GAAI,YACJ,KAAM,oBACN,YAAa,kEACb,SAAU,GACV,SAAU,CAAC,mBAAoB,sBAAuB,gBAAgB,GAExE,CACE,GAAI,aACJ,KAAM,qBACN,YAAa,gDACb,SAAU,GACV,SAAU,CAAC,cAAe,WAAY,iBAAiB,GAEzD,CACE,GAAI,cACJ,KAAM,sBACN,YAAa,2DACb,SAAU,GACV,SAAU,CAAC,qBAAsB,cAAc,EACjD,EAIF,OAAIP,GAAiB,CAACL,GAAgBC,EAAY,UACzC,WAINntB,GAAA,CACC,SAAAjG,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,EAAG,KAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,GAC1B,KAAM,CAAE,QAAS,EAAG,EAAG,KACvB,UAAU,8CACV,MAAO,CAAE,cAAe,QAExB,SAAAD,MAAC,OAAI,UAAU,oBACb,SAAAD,OAACE,EAAO,IAAP,CACC,QAAS,CAAE,MAAO,KAClB,QAAS,CAAE,MAAO,GAClB,UAAU,2EACV,QAASC,GAAK,CAEZ,MAAMmI,EAASnI,EAAE,OAEfmI,EAAO,QAAQ,QAAQ,GACvBA,EAAO,QAAQ,iBAAiB,GAChCA,EAAO,QAAQ,GAAG,GAKpBnI,EAAE,iBACJ,EACA,YAAaA,GAAK,CAEhB,MAAMmI,EAASnI,EAAE,OAEfmI,EAAO,QAAQ,QAAQ,GACvBA,EAAO,QAAQ,iBAAiB,GAChCA,EAAO,QAAQ,GAAG,CAItB,EAGA,UAAAtI,OAAC,OAAI,UAAU,uDACb,UAAAC,MAAC,OAAI,UAAU,gCACb,SAAAA,MAACg0B,IAAO,KAAM,GAAI,UAAU,gBAAgB,EAC9C,EACAj0B,OAAC,OAAI,UAAU,SACb,UAAAC,MAAC,MAAG,UAAU,sCAAsC,8BAAkB,EACtEA,MAAC,KAAE,UAAU,6BAA6B,iFAE1C,GACF,EACCmzB,GACCnzB,MAAC,UACC,KAAK,SACL,QAASE,GAAK,CACZA,EAAE,iBACDA,EAAU,2BACXA,EAAE,kBACFqzB,EAAe,EAAK,CACtB,EACA,YAAarzB,GAAK,CAChBA,EAAE,iBACDA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAU,qDACV,aAAW,QACX,MAAO,CACL,cAAe,OACf,OAAQ,UACR,OAAQ,MACR,UAAW,WAGb,SAAAF,MAACqL,GAAA,CAAE,KAAM,GAAI,UAAU,gBAAgB,GACzC,EAEJ,EAGArL,MAAC,OAAI,UAAU,mCACZ,WACCD,OAAC,OAAI,UAAU,YACb,UAAAC,MAAC,OAAI,UAAU,0DACb,SAAAD,OAAC,OAAI,UAAU,yBACb,UAAAC,MAACi0B,GAAA,CAAK,KAAM,GAAI,UAAU,qCAAqC,EAC/Dl0B,OAAC,KAAE,UAAU,wBACX,UAAAC,MAAC,UAAO,iCAAqB,EAAS,sNAIxC,GACF,EACF,EAEC+zB,EAAiB,IAAIhI,GACpB/rB,MAAC,OAEC,UAAW,yBACTozB,EAAYrH,EAAS,EAAE,EACnB,sCACA,gCACN,GAEA,SAAAhsB,OAAC,OAAI,UAAU,yCACb,UAAAA,OAAC,OAAI,UAAU,SACb,UAAAA,OAAC,OAAI,UAAU,+BACb,UAAAC,MAAC,MAAG,UAAU,8BAA+B,SAAA+rB,EAAS,KAAK,EAC1DA,EAAS,UACR/rB,MAAC,QAAK,UAAU,wDAAwD,oBAExE,GAEJ,EACAA,MAAC,KAAE,UAAU,6BAA8B,WAAS,YAAY,EAChED,OAAC,OAAI,UAAU,wBACb,UAAAC,MAAC,UAAO,qBAAS,EAAS,IAAE+rB,EAAS,SAAS,KAAK,IAAI,GACzD,GACF,EACA/rB,MAAC,OAAI,UAAU,0BACZ,SAAA+rB,EAAS,SACR/rB,MAAC,OAAI,UAAU,oEAAoE,qBAEnF,EAEAA,MAAC,UACC,KAAK,SACL,QAASE,GAAK,CACZA,EAAE,iBACDA,EAAU,2BACXA,EAAE,kBACF4zB,EAAe/H,EAAS,EAAE,CAC5B,EACA,YAAa7rB,GAAK,CAChBA,EAAE,iBACDA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAW,6DACTkzB,EAAYrH,EAAS,EAAE,EACnB,6CACA,6CACN,GACA,MAAO,CACL,cAAe,OACf,OAAQ,UACR,OAAQ,MACR,UAAW,WAGZ,WAAYA,EAAS,EAAE,EACtBhsB,OAAC,QAAK,UAAU,0BACd,UAAAC,MAACgzB,GAAA,CAAM,KAAM,GAAI,EAAE,WAErB,EAEA,YAEJ,CAEJ,GACF,GAhEKjH,EAAS,GAkEjB,QAEA,OAAI,UAAU,8DACb,SAAAhsB,OAAC,OAAI,UAAU,yBACb,UAAAC,MAACk0B,GAAA,CAAY,KAAM,GAAI,UAAU,uCAAuC,EACxEn0B,OAAC,OAAI,UAAU,0BACb,UAAAC,MAAC,UAAO,iBAAK,EAAS,8HAExB,GACF,EACF,GACF,EAEAD,OAAC,OAAI,UAAU,YACb,UAAAC,MAAC,KAAE,UAAU,gBAAgB,4IAG7B,EACAD,OAAC,OAAI,UAAU,gDACb,UAAAC,MAACi0B,GAAA,CAAK,KAAM,GAAI,EAChBj0B,MAAC,QAAK,uEAA2D,GACnE,GACF,EAEJ,EAGAD,OAAC,OAAI,UAAU,sFACb,UAAAA,OAAC,UACC,KAAK,SACL,QAASG,GAAK,CACZA,EAAE,iBACDA,EAAU,2BACXA,EAAE,kBACFqzB,EAAe,CAACD,CAAW,CAC7B,EACA,YAAapzB,GAAK,CAChBA,EAAE,iBACDA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAU,iIACV,MAAO,CACL,cAAe,OACf,OAAQ,UACR,OAAQ,MACR,UAAW,WAGb,UAAAF,MAACqrB,GAAA,CAAS,KAAM,GAAI,EACpBrrB,MAAC,QAAM,SAAAszB,EAAc,eAAiB,YAAY,KAGpDvzB,OAAC,OAAI,UAAU,0BACb,UAAAC,MAAC,UACC,KAAK,SACL,QAASE,GAAK,CACZA,EAAE,iBACDA,EAAU,2BACXA,EAAE,kBACF6yB,EAAA,CACF,EACA,YAAa7yB,GAAK,CAChBA,EAAE,iBACDA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAU,2GACV,MAAO,CACL,cAAe,OACf,OAAQ,UACR,OAAQ,MACR,UAAW,WAEd,mCAGAozB,EACCvzB,OAAC,UACC,KAAK,SACL,QAASG,GAAK,CACZA,EAAE,iBACDA,EAAU,2BACXA,EAAE,kBACF0zB,EAAA,CACF,EACA,YAAa1zB,GAAK,CAChBA,EAAE,iBACDA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAU,gIACV,MAAO,CACL,cAAe,OACf,OAAQ,UACR,OAAQ,MACR,UAAW,WAGb,UAAAF,MAACgzB,GAAA,CAAM,KAAM,GAAI,EACjBhzB,MAAC,QAAK,4BAAgB,KAGxBD,OAAC,UACC,KAAK,SACL,QAASG,GAAK,CACZA,EAAE,iBACDA,EAAU,2BACXA,EAAE,kBACFwzB,EAAA,CACF,EACA,YAAaxzB,GAAK,CAChBA,EAAE,iBACDA,EAAU,2BACXA,EAAE,iBACJ,EACA,UAAU,gIACV,MAAO,CACL,cAAe,OACf,OAAQ,UACR,OAAQ,MACR,UAAW,WAGb,UAAAF,MAACgzB,GAAA,CAAM,KAAM,GAAI,EACjBhzB,MAAC,QAAK,sBAAU,IAClB,EAEJ,GACF,IACF,CACF,IAEJ,CAEJ,CAKO,SAASm0B,IAId,CACA,KAAM,CAACC,EAAcC,CAAe,EAAIj1B,WAAS,EAAK,EAChD,CAACg0B,EAAaC,CAAc,EAAIj0B,WAAmC,IAAI,EACvE,CAACk1B,EAAaC,CAAa,EAAIn1B,WAAS,EAAK,EAEnD2D,mBAAU,IAAM,CACd,GAAI,CACF,MAAM2Y,EAAS,aAAa,QAAQ,sBAAsB,EAC1D,GAAIA,EAAQ,CACV,MAAMnR,EAAO,KAAK,MAAMmR,CAAM,EAC9B,GAAInR,EAAK,UAAY0oB,GAAgB,CACnCI,EAAe9oB,CAAI,EACnB8pB,EAAgB,EAAI,EACpB,MACF,CACF,CAEAE,EAAc,EAAI,CACpB,MAAQ,CACNA,EAAc,EAAI,CACpB,CACF,EAAG,EAAE,EASE,CACL,aAAAH,EACA,YAAAhB,EACA,YAAa,IAAMmB,EAAc,EAAI,EAEzC,CCrdA,MAAMC,GAAc,6BAEPC,GAAoB,CAC/B,aAAuB,CACrB,GAAI,CACF,OAAO,OAAO,aAAa,QAAQD,EAAW,IAAM,GACtD,MAAQ,CACN,MAAO,EACT,CACF,EACA,cAAqB,CACnB,GAAI,CACF,OAAO,aAAa,QAAQA,GAAa,GAAG,CAC9C,MAAQ,CAER,CACF,EACA,OAAc,CACZ,GAAI,CACF,OAAO,aAAa,WAAWA,EAAW,CAC5C,MAAQ,CAER,CACF,CACF,EAEaE,GAAqBh2B,GAAwBC,IAIjD,CACL,QAH2B,OAAO,OAAW,KAAe,CAAC81B,GAAkB,cAI/E,MAAO,IAAM,CAIX91B,EAAI,CAAE,QAAS,GAAM,CACvB,EACA,OAAQ,IAAM,CAIZ81B,GAAkB,eAClB91B,EAAI,CAAE,QAAS,GAAO,CAIxB,EACA,MAAO,IAAM,CACX81B,GAAkB,QAClB91B,EAAI,CAAE,QAAS,GAAM,CACvB,GAEH,EAEG,OAAO,OAAW,MACnB,OAAiE,QAAU,CAC1E,GAAI,OAAiE,QACrE,WAAY+1B,EAAA,GC7DhB,SAASC,GAAa3zB,EAA+B,CACnD,OAAI,OAAO,UAAc,IAAoBA,EAAM,QACrC,UAAU,UAAU,SAAS,KAAK,EACjCA,EAAM,QAAUA,EAAM,OACvC,CAEO,SAAS4zB,IAA2B,CACzC,MAAM5d,EAAUlR,EAAYvG,GAASA,EAAM,OAAO,EAC5Cs1B,EAAsB/uB,EAAYvG,GAASA,EAAM,mBAAmB,EACpEu1B,EAAkBJ,GAAmBn1B,GAASA,EAAM,KAAK,EAE/DwD,YAAU,IAAM,CACd,MAAMhC,EAAWC,GAAyB,CACxC,GAAI,CAAC2zB,GAAa3zB,CAAK,EAAG,OAE1B,MAAM6lB,EAAM7lB,EAAM,IAAI,cAEtB,GAAIA,EAAM,UAAY6lB,IAAQ,IAAK,CACjC7lB,EAAM,iBACNgW,EAAQ,UAAU,EAClB6d,EAAoB,EAAI,EACxBtQ,EAAM,QAAQ,0CAA0C,EACxD,MACF,CAEA,GAAIvjB,EAAM,UAAY6lB,IAAQ,IAAK,CACjC7lB,EAAM,iBACN+zB,GAAA,EAAsB,MAAM,IAAM,CAAC,CAAC,EACpC,MACF,CAEI/zB,EAAM,WAAa6lB,IAAQ,KAAOA,IAAQ,OAC5C7lB,EAAM,iBACN8zB,EAAA,EACAvQ,EAAM,KAAK,0BAA0B,EAEzC,EAEA,cAAO,iBAAiB,UAAWxjB,CAAO,EACnC,IAAM,OAAO,oBAAoB,UAAWA,CAAO,CAC5D,EAAG,CAACiW,EAAS6d,EAAqBC,CAAe,CAAC,CACpD,CCxCO,SAASE,IAAY,CAC1B,OACEh1B,MAACi1B,GAAA,CACC,SAAS,eACT,aAAc,CACZ,SAAU,IACV,MAAO,CACL,WAAY,UACZ,MAAO,UACP,OAAQ,oBACR,aAAc,UACd,QAAS,YACT,SAAU,OACV,SAAU,SAEZ,QAAS,CACP,SAAU,IACV,MAAO,CACL,MAAO,WAET,UAAW,CACT,QAAS,UACT,UAAW,UACb,EAEF,MAAO,CACL,SAAU,IACV,MAAO,CACL,MAAO,WAET,UAAW,CACT,QAAS,UACT,UAAW,UACb,EAEF,QAAS,CACP,SAAU,IACV,MAAO,CACL,MAAO,UACT,CACF,CACF,EAGN,CC/CA,MAAMC,GAAYjzB,GACZA,GAAU,OAAOA,GAAW,UAAY,OAAQA,EAC3C,OAAOA,EAAO,EAAE,EAElB,OAAOA,GAAW,SAAWA,EAAS,OAAO,KAAK,KAAK,GAGhE,eAAsBkzB,GAAgB7W,EAAmB,CACvD,MAAM0Q,EAAY1vB,EAAa,WACzB+I,EAASiW,GAAS0Q,EAAU,oBAClC,GAAI,CAAC3mB,EACH,OAAA4J,GAAU,OAAQ,oCAAoC,EAC/C,GAGLqM,GACF0Q,EAAU,qBAAqB1Q,EAAM,QAAQ,EAG/C,GAAI,CACF,MAAMrc,EAAS,MAAMnD,EAAI,KAAK,OAAO,CACnC,IAAKuJ,EAAO,KAAO,cACnB,YAAaA,EAAO,aAAe,OACpC,EACK+sB,EAAQF,GAASjzB,CAAM,EAG7B,kBAAW,IAAM,CACf,MAAMozB,EAAQ/1B,EAAa,WAC3B+1B,EAAM,UAAUD,EAAO,CACrB,QAAS/sB,EAAO,QAChB,YAAaA,EAAO,YACpB,cAAeA,EAAO,cACtB,eAAgBA,EAAO,eACvB,KAAMA,EAAO,KACb,MAAOA,EAAO,OAASgtB,EAAM,KAAK,KAAM31B,GAAMA,EAAE,KAAO01B,CAAK,GAAG,MAC/D,IAAK/sB,EAAO,IACb,EACDgtB,EAAM,UAAUD,CAAK,CACvB,EAAG,EAAE,EAELnjB,GAAU,UAAW,YAAY5J,EAAO,OAASA,EAAO,KAAO,KAAK,EAAE,EAC/D,EACT,OAAStJ,EAAO,CACd,eAAQ,MAAM,+BAAgCA,CAAK,EACnDiwB,EAAU,mBAAmB3mB,CAAM,EACnC4J,GAAU,QAAS,8BAA8B,EAC1C,EACT,CACF,CAEA,eAAsBqjB,IAA4B,CAChD,OAAOH,GAAA,CACT,CC7BA,MAAMI,GAAqB,wBAYpB,SAASC,IAA2B,CACzC,GAAI,CACF,MAAM9Z,EAAS,aAAa,QAAQ6Z,EAAkB,EACtD,GAAI7Z,EAAQ,CACV,MAAM+Z,EAAS,KAAK,MAAM/Z,CAAM,EAE1B3B,EAAM,KAAK,MACjB,OAAO0b,EAAO,OAAOC,GAASA,EAAM,UAAY3b,CAAG,CACrD,CACF,OAAShb,EAAO,CACd42B,GAAI,KAAK,wDAAyD52B,CAAK,CACzE,CACA,MAAO,EACT,CAKO,SAAS62B,GAAWH,EAA4B,CACrD,GAAI,CACF,aAAa,QAAQF,GAAoB,KAAK,UAAUE,CAAM,CAAC,CACjE,OAAS12B,EAAO,CACd42B,GAAI,KAAK,sDAAuD52B,CAAK,CACvE,CACF,CAsMO,SAAS82B,IAA2B,CACzC,MAAMJ,EAASD,GAAA,EACTzb,EAAM,KAAK,MACX+b,EAASL,EAAO,OAAOC,GAASA,EAAM,UAAY3b,CAAG,EAC3D6b,GAAWE,CAAM,CACnB,CAKO,SAASC,IAA4B,CAE1CF,GAAA,EAGA,YAAYA,GAAoB,GAAK,EAErCF,GAAI,KAAK,+BAA+B,CAC1C,6ICtQA,MAAMK,EAAc,CAApB,cACEt1B,GAAA,KAAQ,iBAA8C,GAAI,EAK1D,SAASwT,EAAiC,CACxC,GAAI,KAAK,WAAW,IAAIA,EAAU,EAAE,EAAG,CACrCyhB,GAAI,KAAK,6BAA6BzhB,EAAU,EAAE,qBAAqB,EACvE,MACF,CAEA,KAAK,WAAW,IAAIA,EAAU,GAAIA,CAAS,EAG3C,MAAM+hB,EAAqB,CACzB,GAAI/hB,EAAU,GACd,KAAMA,EAAU,MAAQA,EAAU,GAClC,QAASA,EAAU,SAAW,QAC9B,YAAa,cAAcA,EAAU,MAAQA,EAAU,EAAE,GACzD,QAAS,GACT,SAAUA,EAAU,SACpB,UAAWA,EAAU,YAGvBgiB,GAAe,SAASD,CAAM,EAE9BN,GAAI,KAAK,yCAAyCzhB,EAAU,EAAE,EAAE,CAClE,CAKA,MAA+D,CAC7D,OAAO,MAAM,KAAK,KAAK,WAAW,QAAQ,EAAE,IAAIiiB,IAAQ,CACtD,GAAIA,EAAI,GACR,KAAMA,EAAI,KACV,QAASA,EAAI,SACb,CACJ,CAKA,IAAIx1B,EAAwC,CAC1C,OAAO,KAAK,WAAW,IAAIA,CAAE,CAC/B,CAKA,MAAM,SAASA,EAA8B,CAC3C,MAAMuT,EAAY,KAAK,WAAW,IAAIvT,CAAE,EACxC,GAAI,CAACuT,EACH,MAAO,GAGT,GAAIA,EAAU,SACZ,GAAI,CACF,aAAMA,EAAU,WAChByhB,GAAI,KAAK,wCAAwCh1B,CAAE,EAAE,EAC9C,EACT,OAAS5B,EAAO,CACd,OAAA42B,GAAI,MAAM,gDAAgDh1B,CAAE,IAAK5B,CAAK,EAC/D,EACT,CAGF,MAAO,EACT,CAKA,MAAM,WAAW4B,EAA8B,CAC7C,MAAMuT,EAAY,KAAK,WAAW,IAAIvT,CAAE,EACxC,GAAI,CAACuT,EACH,MAAO,GAGT,GAAIA,EAAU,WACZ,GAAI,CACF,aAAMA,EAAU,aAChByhB,GAAI,KAAK,0CAA0Ch1B,CAAE,EAAE,EAChD,EACT,OAAS5B,EAAO,CACd,OAAA42B,GAAI,MAAM,kDAAkDh1B,CAAE,IAAK5B,CAAK,EACjE,EACT,CAGF,MAAO,EACT,CACF,CAGA,MAAMq3B,GAAgB,IAAIJ,GAMnB,SAASK,IAA0B,CACxC,GAAI,SAAO,OAAW,KAkBtB,IAbK,OAAO,kBACV,OAAO,gBAAkB,CACvB,SAAWniB,GAA8B,CACvCkiB,GAAc,SAASliB,CAAS,CAClC,EACA,KAAM,IACGkiB,GAAc,MACvB,GAMA,OAAQ,OAAe,0BAA6B,WACtD,GAAI,CACD,OAAe,yBAAyB,OAAO,eAAe,CACjE,OAASr3B,EAAO,CACd42B,GAAI,KAAK,uCAAwC52B,CAAK,CACxD,CAGF42B,GAAI,KAAK,oDAAoD,EAC/D,CAMO,SAASW,IAAyB,CACnC,OAAO,OAAW,MAKrB,OAAe,yBAA4BC,GAAwC,CAClFZ,GAAI,KAAK,qCAAqC,CAEhD,EACF,CCjJO,SAASa,IAAc,CAC5B,MAAMC,EAAYvzB,cAChB,CAAC/B,EAAiBpC,EAAiB8B,EAA2B,KAAO,CACnE,KAAM,CAAE,WAAA61B,EAAa,GAAM,aAAAC,EAAe,GAAM,QAAAC,EAAU,GAAI,SAAAC,EAAW,MAASh2B,EAYlF,GATI81B,GACF,QAAQ,MAAM,cAAex1B,EAAS,CACpC,MAAApC,EACA,GAAG63B,EACH,UAAW,IAAI,OAAO,aAAY,CACnC,EAICF,EAAY,CACd,MAAMI,EACJ,OAAO31B,GAAY,UAAYA,EAAQ,OAAS,EAC5CA,EACA,+BACNojB,EAAM,MAAMuS,CAAW,CACzB,CAEA,OAAOD,CACT,EACA,EAAC,EAGG5xB,EAAc/B,cAClB,CAACnE,EAAgB63B,EAAkB/1B,EAA2B,KAAO,CACnE,MAAMqE,EACJnG,aAAiB,MACbA,EAAM,QACN,OAAOA,GAAU,SACfA,EACA,yBAEFg4B,EAAcH,EAAU,GAAGA,CAAO,KAAK1xB,CAAY,GAAKA,EAE9D,OAAOuxB,EAAUM,EAAah4B,EAAO8B,CAAO,CAC9C,EACA,CAAC41B,CAAS,GAGNO,EAAc9zB,cAClB,MAAU+zB,EAAsBJ,EAAaD,IAAiC,CAC5E,GAAI,CACF,OAAO,MAAMK,EAAA,CACf,OAASl4B,EAAO,CACd,OAAAkG,EAAYlG,EAAO63B,EAAS,CAC1B,WAAY,GACZ,aAAc,GACd,SAAAC,CAAA,CACD,EACMA,CACT,CACF,EACA,CAAC5xB,CAAW,GAGd,MAAO,CACL,UAAAwxB,EACA,YAAAxxB,EACA,YAAA+xB,CAAA,CAEJ,CC/DO,SAASE,GAAgB,CAAE,KAAAvtB,EAAM,QAAA0C,GAAiC,CACvE,KAAM,CAAC8qB,EAAcC,CAAe,EAAIh4B,WAAsB,EAAE,EAGhE2D,YAAU,IAAM,CACd,GAAI4G,EAAM,CACR,MAAM0tB,EAAQC,GAAA,EACdF,EAAgBC,CAAK,CACvB,CACF,EAAG,CAAC1tB,CAAI,CAAC,EAET,MAAM4tB,EAAgBC,GAAoB,CACxBC,GAAWD,EAAK,KAAK,GAEnCjT,GAAM,QAAQ,iBAAiBiT,EAAK,KAAK,MAAM,EAAG,EAAE,CAAC,KAAK,EAC1DnrB,EAAA,GAEAkY,GAAM,MAAM,uBAAuB,CAEvC,EAEMrL,EAAgBwe,GAAkB,CACtCC,GAAgBD,CAAK,EACrBN,KAAwBzsB,EAAK,UAAYitB,EAAE,QAAUF,CAAK,CAAC,EAC3DnT,GAAM,QAAQ,sBAAsB,CACtC,EAEA,OAAK5a,EAGH3J,MAACiG,GAAA,CACC,SAAAlG,OAAC,OAAI,UAAU,0DAEb,UAAAC,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,GACpB,QAAS,CAAE,QAAS,GACpB,KAAM,CAAE,QAAS,GACjB,QAASoM,EACT,UAAU,kDAIZtM,OAACE,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,MAAO,IAAM,EAAG,IACvC,QAAS,CAAE,QAAS,EAAG,MAAO,EAAG,EAAG,GACpC,KAAM,CAAE,QAAS,EAAG,MAAO,IAAM,EAAG,IACpC,UAAU,gIAGV,UAAAF,OAAC,OAAI,UAAU,iEACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAC,MAACk0B,GAAA,CAAY,KAAM,GAAI,UAAU,kBAAkB,EACnDn0B,OAAC,MAAG,UAAU,sCAAsC,4BAClCo3B,EAAa,OAAO,KACtC,GACF,EACAn3B,MAAC,UACC,QAASqM,EACT,UAAU,4FAEV,SAAArM,MAACqL,GAAA,CAAE,KAAM,GAAI,GACf,EACF,EAGArL,MAAC,OAAI,UAAU,6BACZ,SAAAm3B,EAAa,SAAW,EACvBp3B,OAAC,OAAI,UAAU,iCACb,UAAAC,MAAC,KAAE,mCAAuB,EAC1BA,MAAC,KAAE,UAAU,eAAe,6CAAiC,GAC/D,EAEAA,MAAC,OAAI,UAAU,YACZ,SAAAm3B,EAAa,IAAIK,GAChBx3B,MAAC,OAEC,UAAU,0DAEV,SAAAD,OAAC,OAAI,UAAU,yCACb,UAAAA,OAAC,OAAI,UAAU,iBACb,UAAAA,OAAC,OAAI,UAAU,+BACb,UAAAA,OAAC,QAAK,UAAU,oCACb,UAAAy3B,EAAK,MAAM,MAAM,EAAG,CAAC,EAAE,OAC1B,EACAx3B,MAAC,QACC,UAAW,+BACTw3B,EAAK,SAAW,OACZ,iCACAA,EAAK,SAAW,QACd,6BACA,kCACR,GAEC,SAAAA,EAAK,SAEPA,EAAK,MAAQx3B,MAAC,QAAK,UAAU,wBAAyB,WAAK,KAAK,GACnE,QACC,MAAG,UAAU,0CACX,SAAAw3B,EAAK,MAAQ,gBAChB,EACCA,EAAK,YACJz3B,OAAC,KAAE,UAAU,0CACV,UAAAy3B,EAAK,WAAW,MAAM,EAAG,GAAG,EAAE,OACjC,EAEFz3B,OAAC,OAAI,UAAU,wBACZ,UAAAy3B,EAAK,OAAO,OAAO,uBAAqB,IACxC,IAAI,KAAKA,EAAK,SAAS,EAAE,gBAAe,EAC3C,GACF,EACAz3B,OAAC,OAAI,UAAU,0BACb,UAAAA,OAAC,UACC,QAAS,IAAMw3B,EAAaC,CAAI,EAChC,UAAU,uHAEV,UAAAx3B,MAAC63B,GAAA,CAAK,KAAM,GAAI,EAAE,YAGpB73B,MAAC,UACC,QAAS,IAAMkZ,EAAase,EAAK,KAAK,EACtC,UAAU,2FACV,MAAM,SAEN,SAAAx3B,MAACqL,GAAA,CAAE,KAAM,GAAI,GACf,EACF,GACF,GAnDKmsB,EAAK,MAqDb,EACH,EAEJ,EAGAz3B,OAAC,OAAI,UAAU,iEACb,UAAAC,MAAC,KAAE,UAAU,wBAAwB,wFAErC,EACAA,MAAC,UACC,QAASqM,EACT,UAAU,2FACX,kBAED,EACF,IACF,EACF,EACF,EAxHgB,IA0HpB,CC/IA,MAAMyrB,GAA+B,CACnC,CACE,GAAI,IACJ,KAAM,0BACN,YAAa,8EACb,OAAQ,eACR,SAAU,aACV,SAAU,OACV,KAAM,CAAC,WAAY,QAAS,QAAQ,EACpC,UAAW,KACX,OAAQ,IACR,WAAY,uBACZ,UAAW,KAAK,MAAQ,MACxB,UAAW,KAAK,MAAQ,MAE1B,CACE,GAAI,IACJ,KAAM,gCACN,YAAa,+DACb,OAAQ,YACR,SAAU,WACV,SAAU,OACV,KAAM,CAAC,WAAY,eAAgB,SAAS,EAC5C,UAAW,IACX,OAAQ,IACR,WAAY,wBACZ,UAAW,KAAK,MAAQ,OACxB,UAAW,KAAK,MAAQ,MAE1B,CACE,GAAI,IACJ,KAAM,qBACN,YAAa,mEACb,OAAQ,eACR,SAAU,QACV,SAAU,KACV,KAAM,CAAC,QAAS,aAAc,QAAQ,EACtC,UAAW,KACX,OAAQ,IACR,WAAY,gBACZ,UAAW,KAAK,MAAQ,OACxB,UAAW,KAAK,MAAQ,KAE5B,EAOO,SAASC,GAAoB,CAAE,KAAApuB,EAAM,QAAA0C,GAAqC,CAC/E,KAAM,CAAC2rB,CAAS,EAAI54B,WAAqB04B,EAAgB,EACnD,CAACl4B,EAAakX,CAAc,EAAI1X,WAAS,EAAE,EAC3C,CAAC64B,EAAkBC,CAAmB,EAAI94B,WAAiB,KAAK,EAChE,CAAC+4B,EAAkBC,CAAmB,EAAIh5B,WAAiB,KAAK,EAChE,CAAC+E,EAASC,CAAU,EAAIhF,WAAS,EAAK,EAEtCi5B,EAAoBL,EAAU,OAAOM,GAAY,CACrD,MAAMC,EACJ,CAAC34B,GACD04B,EAAS,KAAK,cAAc,SAAS14B,EAAY,aAAa,GAC9D04B,EAAS,YAAY,cAAc,SAAS14B,EAAY,aAAa,GACrE04B,EAAS,KAAK,KAAKzlB,GAAOA,EAAI,cAAc,SAASjT,EAAY,aAAa,CAAC,EAE3E44B,EAAkBP,IAAqB,OAASK,EAAS,WAAaL,EACtEQ,EACJN,IAAqB,OAASG,EAAS,WAAaH,GAAoB,CAACG,EAAS,SAEpF,OAAOC,GAAiBC,GAAmBC,CAC7C,CAAC,EAEKC,EAAgB,MAAOJ,GAAuB,CAClDl0B,EAAW,EAAI,EACf,GAAI,CACF,GAAIk0B,EAAS,WAAY,CAEvB,MAAMr2B,EAAS,MAAM02B,GACnB,CACE,KAAM,mBACN,KAAM,CACJ,WAAYL,EAAS,WACrB,YAAaA,EAAS,aAAe,yBAEvC,WAAY,cACZ,WAAY,OAEdA,EAAS,UAAY,QAGnBr2B,EAAO,QACTsiB,GAAM,QAAQ,uBAAuB+T,EAAS,IAAI,EAAE,EAEpD/T,GAAM,MAAMtiB,EAAO,OAAS,4BAA4B,CAE5D,MACEsiB,GAAM,MAAM,2BAA2B,CAE3C,OAASxlB,EAAY,CACnBwlB,GAAM,MAAM,wBAAwBxlB,EAAM,OAAO,EAAE,CACrD,SACEqF,EAAW,EAAK,CAClB,CACF,EAEMw0B,EAAa,CACjB,CAAE,MAAO,MAAO,MAAO,kBACvB,CAAE,MAAO,aAAc,MAAO,cAC9B,CAAE,MAAO,WAAY,MAAO,YAC5B,CAAE,MAAO,QAAS,MAAO,SACzB,CAAE,MAAO,eAAgB,MAAO,gBAChC,CAAE,MAAO,cAAe,MAAO,cAAc,EAG/C,OAAKjvB,EAGH3J,MAACiG,GAAA,CACC,SAAAlG,OAAC,OAAI,UAAU,0DAEb,UAAAC,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,GACpB,QAAS,CAAE,QAAS,GACpB,KAAM,CAAE,QAAS,GACjB,QAASoM,EACT,UAAU,kDAIZtM,OAACE,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,MAAO,IAAM,EAAG,IACvC,QAAS,CAAE,QAAS,EAAG,MAAO,EAAG,EAAG,GACpC,KAAM,CAAE,QAAS,EAAG,MAAO,IAAM,EAAG,IACpC,UAAU,gIAGV,UAAAF,OAAC,OAAI,UAAU,iEACb,UAAAA,OAAC,OAAI,UAAU,0BACb,UAAAC,MAAC64B,GAAA,CAAS,KAAM,GAAI,UAAU,gBAAgB,SAC7C,OACC,UAAA74B,MAAC,MAAG,UAAU,sCAAsC,gCAAoB,EACxEA,MAAC,KAAE,UAAU,wBAAwB,4CAAgC,GACvE,GACF,EACAA,MAAC,UACC,QAASqM,EACT,UAAU,4FAEV,SAAArM,MAACqL,GAAA,CAAE,KAAM,GAAI,GACf,EACF,EAGAtL,OAAC,OAAI,UAAU,yCACb,UAAAA,OAAC,OAAI,UAAU,WACb,UAAAC,MAACmL,GAAA,CACC,KAAM,GACN,UAAU,2DAEZnL,MAAC,SACC,KAAK,OACL,MAAOJ,EACP,SAAUM,GAAK4W,EAAe5W,EAAE,OAAO,KAAK,EAC5C,YAAY,sBACZ,UAAU,gLACZ,EACF,EACAH,OAAC,OAAI,UAAU,0BACb,UAAAC,MAAC,UACC,MAAOi4B,EACP,SAAU/3B,GAAKg4B,EAAoBh4B,EAAE,OAAO,KAAK,EACjD,UAAU,+IAET,SAAA04B,EAAW,IAAIE,GACd94B,MAAC,UAAuB,MAAO84B,EAAI,MAChC,SAAAA,EAAI,OADMA,EAAI,KAEjB,CACD,IAEH/4B,OAAC,UACC,MAAOo4B,EACP,SAAUj4B,GAAKk4B,EAAoBl4B,EAAE,OAAO,KAAK,EACjD,UAAU,+IAEV,UAAAF,MAAC,UAAO,MAAM,MAAM,yBAAa,EACjCA,MAAC,UAAO,MAAM,OAAO,uBAAW,EAChCA,MAAC,UAAO,MAAM,KAAK,mBAAO,EAC1BA,MAAC,UAAO,MAAM,KAAK,iBAAK,EACxBA,MAAC,UAAO,MAAM,KAAK,iBAAK,EACxBA,MAAC,UAAO,MAAM,KAAK,mBAAO,IAC5B,EACF,GACF,EAGAA,MAAC,OAAI,UAAU,6BACZ,SAAAq4B,EAAkB,SAAW,EAC5Bt4B,OAAC,OAAI,UAAU,kCACb,UAAAC,MAAC,KAAE,+BAAmB,EACtBA,MAAC,KAAE,UAAU,eAAe,iDAAqC,GACnE,EAEAA,MAAC,OAAI,UAAU,wCACZ,SAAAq4B,EAAkB,IAAIC,GACrBv4B,OAACE,EAAO,IAAP,CAEC,QAAS,CAAE,QAAS,EAAG,EAAG,IAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,GAC1B,UAAU,qGAEV,UAAAF,OAAC,OAAI,UAAU,wCACb,UAAAA,OAAC,OAAI,UAAU,SACb,UAAAC,MAAC,MAAG,UAAU,mCAAoC,SAAAs4B,EAAS,KAAK,EAChEt4B,MAAC,KAAE,UAAU,qCAAsC,WAAS,YAAY,GAC1E,EACAD,OAAC,OAAI,UAAU,+CACb,UAAAC,MAACypB,GAAA,CAAK,KAAM,GAAI,UAAU,eAAe,EACzCzpB,MAAC,QAAK,UAAU,UAAW,WAAS,OAAO,GAC7C,GACF,EAEAD,OAAC,OAAI,UAAU,+BACb,UAAAC,MAAC,QAAK,UAAU,2DACb,SAAAs4B,EAAS,SACZ,EACCA,EAAS,UACRt4B,MAAC,QAAK,UAAU,6DACb,WAAS,SACZ,EAEFD,OAAC,QAAK,UAAU,wBAAyB,UAAAu4B,EAAS,UAAU,cAAU,GACxE,EAEAv4B,OAAC,OAAI,UAAU,0BACb,UAAAA,OAAC,UACC,QAAS,IAAM24B,EAAcJ,CAAQ,EACrC,SAAUn0B,EACV,UAAU,8LAEV,UAAAnE,MAACmV,GAAA,CAAS,KAAM,GAAI,EAAE,aAGxBnV,MAAC,UACC,QAAS,IAAM,CAEb,MAAM+4B,EAAW,uDAAuDT,EAAS,YAAcA,EAAS,EAAE,GACtG,UAAU,MACZ,UACG,MAAM,CACL,MAAO,SAASA,EAAS,IAAI,GAC7B,KAAMA,EAAS,YACf,IAAKS,CAAA,CACN,EACA,MAAM,IAAM,CAEX,UAAU,UAAU,UAAUA,CAAQ,EACtCxU,GAAM,QAAQ,oCAAoC,CACpD,CAAC,GAGH,UAAU,UAAU,UAAUwU,CAAQ,EACtCxU,GAAM,QAAQ,oCAAoC,EAEtD,EACA,UAAU,iFACV,MAAM,mCAEN,SAAAvkB,MAACg5B,GAAA,CAAO,KAAM,GAAI,GACpB,EACF,IAhEKV,EAAS,GAkEjB,EACH,EAEJ,EAGAv4B,OAAC,OAAI,UAAU,iEACb,UAAAA,OAAC,OAAI,UAAU,sBACb,UAAAC,MAAC,KAAE,UAAU,wBAAwB,mFAErC,EACAD,OAAC,KAAE,UAAU,wBAAwB,kDACG,IACtCC,MAAC,KACC,KAAK,4CACL,OAAO,SACP,IAAI,sBACJ,UAAU,8CACX,wBAED,EACF,GACF,EACAA,MAAC,UACC,QAASqM,EACT,UAAU,2FACX,kBAED,EACF,IACF,EACF,EACF,EA7LgB,IA+LpB,CC9TA,MAAM4sB,GAID,CACH,CAAE,GAAI,SAAU,MAAO,SAAU,KAAMjuB,EAAA,EACvC,CAAE,GAAI,WAAY,MAAO,WAAY,KAAMkuB,EAAA,EAC3C,CAAE,GAAI,QAAS,MAAO,QAAS,KAAMC,EAAA,CACvC,EAEO,SAASC,GAAW,CACzB,WAAAC,EACA,aAAAC,EACA,cAAAC,EACA,YAAAC,CACF,EAAoB,CAClB,OACEx5B,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,EAAG,IAAK,QAAS,GAC5B,QAAS,CAAE,EAAG,EAAG,QAAS,GAC1B,KAAM,CAAE,EAAG,IAAK,QAAS,GACzB,WAAY,CAAE,KAAM,SAAU,UAAW,IAAK,QAAS,IACvD,UAAU,wFAEV,SAAAF,OAAC,OAAI,UAAU,2IACZ,UAAAk5B,GAAS,IAAItJ,GAAQ,CACpB,MAAM5kB,EAAO4kB,EAAK,KACZroB,EAAWqoB,EAAK,KAAO0J,EAC7B,OACEt5B,OAAC,UAEC,KAAK,SACL,QAAS,IAAMu5B,EAAa3J,EAAK,EAAE,EACnC,UAAW,qGACTroB,EACI,qCACA,qCACN,GACA,eAAcA,EAEd,UAAAtH,MAAC+K,EAAA,CAAK,KAAM,GAAI,EAChB/K,MAAC,QAAM,SAAA2vB,EAAK,MAAM,IAXbA,EAAK,GAchB,CAAC,EAED5vB,OAAC,UACC,KAAK,SACL,QAASw5B,EACT,UAAU,iIAEV,UAAAv5B,MAACy5B,GAAA,CAAQ,KAAM,GAAI,EACnBz5B,MAAC,QAAK,mBAAO,KAGfD,OAAC,UACC,KAAK,SACL,QAASy5B,EACT,UAAU,iIAEV,UAAAx5B,MAAC05B,GAAA,CAAI,KAAM,GAAI,EACf15B,MAAC,QAAK,iBAAK,IACb,EACF,GAGN,CC3DA,MAAM25B,GAAc,CAClB,QAAS,sCACT,MAAO,kCACP,MAAO,mCACT,EAEMC,GAAkB,CAAC,YAAa,UAAU,EAKhD,eAAsBC,IAAyC,CAC7D,GAAI,CAEF,GAAI,OAAO,OAAW,KAAgB,OAAe,IAAK,CACxD,MAAM/6B,EAAO,OAAe,IAC5B,GAAIA,EAAI,QAAU,OAAOA,EAAI,OAAO,cAAiB,WAEnD,OADe,MAAMA,EAAI,OAAO,aAAa,QAAQ,IACtC,YAAc,EAEjC,CAGA,GAAI,CAEF,OADiB,MAAM,MAAM,kCAAmC,CAAE,OAAQ,MAAO,GACjE,EAClB,MAAQ,CACN,MAAO,EACT,CACF,MAAQ,CACN,MAAO,EACT,CACF,CAKA,eAAsBg7B,IAA0C,CAC9D,GAAI,CACF,MAAM9S,EAAW,MAAM,MAAM,iCAAiC,EAC9D,OAAKA,EAAS,KAED,MAAMA,EAAS,QACf,QAAU,IAAI,IAAK7N,GAAWA,EAAE,IAAI,EAHxB,EAI3B,MAAQ,CACN,MAAO,EACT,CACF,CAKA,SAAS4gB,IAA+B,CACtC,MAAMC,EAAW,UAAU,SAAS,cACpC,OAAIA,EAAS,SAAS,KAAK,EAAUL,GAAY,QAC7CK,EAAS,SAAS,KAAK,EAAUL,GAAY,MAC1CA,GAAY,KACrB,CAKA,eAAeM,GAAwBC,EAA+C,CACpF,MAAM32B,EAAMw2B,GAAA,EACZG,EAAW,CACT,MAAO,cACP,SAAU,EACV,QAAS,kCACV,EAED,GAAI,CAEF,GAAI,OAAO,OAAW,KAAgB,OAAe,IAAK,CACxD,MAAMp7B,EAAO,OAAe,IAC5B,GAAIA,EAAI,QAAU,OAAOA,EAAI,OAAO,cAAiB,WAUnD,OATe,MAAMA,EAAI,OAAO,aAAayE,EAAK,CAChD,WAAa42B,GAAqB,CAChCD,EAAW,CACT,MAAO,cACP,SAAAC,EACA,QAAS,yBAAyB,KAAK,MAAMA,CAAQ,CAAC,IACvD,CACH,EACD,IACc,MAAQ,EAE3B,CAGA,MAAMnT,EAAW,MAAM,MAAMzjB,CAAG,EAChC,GAAI,CAACyjB,EAAS,GAAI,MAAM,IAAI,MAAM,2BAA2B,EAG7D,MAAMpT,EAAO,MAAMoT,EAAS,OACtBoT,EAAc,OAAO,IAAI,gBAAgBxmB,CAAI,EAC7C7R,EAAI,SAAS,cAAc,GAAG,EACpC,OAAAA,EAAE,KAAOq4B,EACTr4B,EAAE,SAAW,mBACbA,EAAE,QAEFm4B,EAAW,CACT,MAAO,cACP,SAAU,IACV,QAAS,+CACV,EAEME,CACT,OAASr7B,EAAO,CACd,cAAQ,MAAM,+BAAgCA,CAAK,EAC7CA,CACR,CACF,CAKA,eAAes7B,GAAcC,EAAuBJ,EAA6C,CAC/FA,EAAW,CACT,MAAO,aACP,SAAU,EACV,QAAS,uBACV,EAED,GAAI,CAEF,GAAI,OAAO,OAAW,KAAgB,OAAe,IAAK,CACxD,MAAMp7B,EAAO,OAAe,IAC5B,GAAIA,EAAI,QAAU,OAAOA,EAAI,OAAO,cAAiB,WAAY,CAC/D,MAAMA,EAAI,OAAO,aAAaw7B,EAAe,CAC3C,OAAQ,GACR,WAAaH,GAAqB,CAChCD,EAAW,CACT,MAAO,aACP,SAAAC,EACA,QAAS,wBAAwB,KAAK,MAAMA,CAAQ,CAAC,IACtD,CACH,EACD,EACD,MACF,CACF,CAGAD,EAAW,CACT,MAAO,aACP,SAAU,GACV,QAAS,kEACV,EAGD3V,EAAM,KAAK,4DAA4D,CACzE,OAASxlB,EAAO,CACd,cAAQ,MAAM,mCAAoCA,CAAK,EACjDA,CACR,CACF,CAKA,eAAew7B,GAAUC,EAAeN,EAA6C,CACnFA,EAAW,CACT,MAAO,iBACP,SAAU,EACV,QAAS,eAAeM,CAAK,MAC7B,cAAe,CAAE,MAAAA,EAAO,SAAU,EAAE,CACrC,EAED,GAAI,CACF,MAAMxT,EAAW,MAAM,MAAM,kCAAmC,CAC9D,OAAQ,OACR,QAAS,CAAE,eAAgB,oBAC3B,KAAM,KAAK,UAAU,CAAE,KAAMwT,EAAO,OAAQ,GAAM,EACnD,EAED,GAAI,CAACxT,EAAS,GAAI,MAAM,IAAI,MAAM,kBAAkBwT,CAAK,EAAE,EAE3D,MAAMC,EAASzT,EAAS,MAAM,YACxB0T,EAAU,IAAI,YAEpB,GAAI,CAACD,EAAQ,MAAM,IAAI,MAAM,kBAAkB,EAE/C,IAAIE,EAAS,GACb,OAAa,CACX,KAAM,CAAE,KAAAC,EAAM,MAAA9T,CAAA,EAAU,MAAM2T,EAAO,OACrC,GAAIG,EAAM,MAEVD,GAAUD,EAAQ,OAAO5T,EAAO,CAAE,OAAQ,GAAM,EAChD,MAAM+T,EAAQF,EAAO,MAAM;AAAA,CAAI,EAC/BA,EAASE,EAAM,OAAS,GAExB,UAAWC,KAAQD,EACjB,GAAKC,EAAK,OACV,GAAI,CACF,MAAMvwB,EAAO,KAAK,MAAMuwB,CAAI,EAC5B,GAAIvwB,EAAK,UAAW,CAClB2vB,EAAW,CACT,MAAO,iBACP,SAAU,IACV,QAAS,GAAGM,CAAK,2BACjB,cAAe,CAAE,MAAAA,EAAO,SAAU,IAAI,CACvC,EACD,KACF,CACA,GAAIjwB,EAAK,OAASA,EAAK,YAAc,OAAW,CAC9C,MAAM4vB,EAAY5vB,EAAK,UAAYA,EAAK,MAAS,IACjD2vB,EAAW,CACT,MAAO,iBACP,SAAWC,EAAWP,GAAgB,OAAU,IAChD,QAAS,eAAeY,CAAK,OAAO,KAAK,MAAML,CAAQ,CAAC,IACxD,cAAe,CAAE,MAAAK,EAAO,SAAAL,CAAA,CAAS,CAClC,CACH,CACF,MAAQ,CAER,CAEJ,CACF,OAASp7B,EAAO,CACd,cAAQ,MAAM,8BAA8By7B,CAAK,IAAKz7B,CAAK,EACrDA,CACR,CACF,CAKA,eAAsBg8B,GAAuBb,EAA6C,CACxF,GAAI,CASF,GAPAA,EAAW,CACT,MAAO,WACP,SAAU,EACV,QAAS,kCACV,EAEmB,MAAML,GAAA,EAExBK,EAAW,CACT,MAAO,iBACP,SAAU,EACV,QAAS,+CACV,MACI,CAEL,MAAMI,EAAgB,MAAML,GAAwBC,CAAU,EAG9D,MAAMG,GAAcC,EAAeJ,CAAU,EAG7CA,EAAW,CACT,MAAO,WACP,SAAU,GACV,QAAS,iCACV,EAGD,IAAIc,EAAU,GACd,KAAOA,EAAU,GACX,OAAMnB,MAGV,MAAM,IAAI,QAAQxU,GAAW,WAAWA,EAAS,GAAI,CAAC,EACtD2V,IAGF,GAAIA,IAAY,EACd,MAAM,IAAI,MAAM,+CAA+C,CAEnE,CAGA,MAAMC,EAAkB,MAAMnB,GAAA,EACxBoB,EAAetB,GAAgB,OAAOzgB,GAAK,CAAC8hB,EAAgB,SAAS9hB,CAAC,CAAC,EAE7E,GAAI+hB,EAAa,SAAW,EAAG,CAC7BhB,EAAW,CACT,MAAO,WACP,SAAU,IACV,QAAS,gCACV,EACD,MACF,CAGA,QAASvrB,EAAI,EAAGA,EAAIusB,EAAa,OAAQvsB,IAAK,CAC5C,MAAM6rB,EAAQU,EAAavsB,CAAC,EAC5B,MAAM4rB,GAAUC,EAAON,CAAU,CACnC,CAEAA,EAAW,CACT,MAAO,WACP,SAAU,IACV,QAAS,iDACV,CACH,OAASn7B,EAAO,CACd,cAAQ,MAAM,mCAAoCA,CAAK,EACvDm7B,EAAW,CACT,MAAO,QACP,SAAU,EACV,QAAS,wBAAwBn7B,aAAiB,MAAQA,EAAM,QAAU,eAAe,GAC1F,EACKA,CACR,CACF,CCtTO,SAASo8B,GAAqB,CAAE,WAAAC,EAAY,QAAAC,GAAkB,CACnE,KAAM,CAAClB,EAAUmB,CAAW,EAAIl8B,WAA0B,CACxD,MAAO,WACP,SAAU,EACV,QAAS,kBACV,EACK,CAACm8B,EAAeC,CAAe,EAAIp8B,WAAS,EAAI,EAEtD2D,YAAU,IAAM,CACd,IAAIouB,EAAY,GA0BhB,OAxB0B,SAAY,CACpC,GAAI,CACF,MAAM4J,GAAuBU,GAAQ,CAC/BtK,IACJmK,EAAYG,CAAI,EAEZA,EAAK,QAAU,YACjBD,EAAgB,EAAK,EACrB,WAAW,IAAM,CACfJ,EAAA,CACF,EAAG,GAAI,GACEK,EAAK,QAAU,UACxBD,EAAgB,EAAK,EACrBH,EAAQ,IAAI,MAAMI,EAAK,OAAO,CAAC,GAEnC,CAAC,CACH,OAAS18B,EAAO,CACToyB,IACHqK,EAAgB,EAAK,EACrBH,EAAQt8B,aAAiB,MAAQA,EAAQ,IAAI,MAAM,qBAAqB,CAAC,EAE7E,CACF,GAEA,EAEO,IAAM,CACXoyB,EAAY,EACd,CACF,EAAG,CAACiK,EAAYC,CAAO,CAAC,EAExB,MAAMK,EAAe,IAAM,CACzB,OAAQvB,EAAS,OACf,IAAK,WACH,OAAOn6B,MAAC27B,GAAA,CAAa,UAAU,6BAA6B,EAC9D,IAAK,QACH,OAAO37B,MAACk0B,GAAA,CAAY,UAAU,yBAAyB,EACzD,QACE,OAAOl0B,MAACkG,GAAA,CAAQ,UAAU,yCAAyC,EAEzE,EAEM01B,EAAgB,IAAM,CAC1B,OAAQzB,EAAS,OACf,IAAK,WACH,MAAO,+BACT,IAAK,QACH,MAAO,2BACT,QACE,MAAO,8BAEb,EAEA,OACEn6B,MAAC,OAAI,UAAU,uFACb,SAAAD,OAACE,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,MAAO,IAC9B,QAAS,CAAE,QAAS,EAAG,MAAO,GAC9B,UAAU,6FAGV,UAAAF,OAAC,OAAI,UAAU,mBACb,UAAAC,MAAC,OAAI,UAAU,2BAA4B,SAAA07B,EAAA,EAAe,EAC1D17B,MAAC,MAAG,UAAU,qCACX,SAAAm6B,EAAS,QAAU,WAChB,6BACAA,EAAS,QAAU,QACjB,sBACA,+BACR,EACAn6B,MAAC,KAAE,UAAU,wBAAyB,WAAS,QAAQ,GACzD,EAGAD,OAAC,OAAI,UAAU,OACb,UAAAA,OAAC,OAAI,UAAU,yCACb,UAAAC,MAAC,QAAK,UAAU,wBACb,SAAAm6B,EAAS,QAAU,kBAAoBA,EAAS,cAC7C,GAAGA,EAAS,cAAc,KAAK,KAAK,KAAK,MAAMA,EAAS,cAAc,QAAQ,CAAC,IAC/E,GAAG,KAAK,MAAMA,EAAS,QAAQ,CAAC,IACtC,EACAp6B,OAAC,QAAK,UAAU,wBACb,UAAAo6B,EAAS,QAAU,YAAc,WACjCA,EAAS,QAAU,eAAiB,WACpCA,EAAS,QAAU,cAAgB,WACnCA,EAAS,QAAU,kBAAoB,WACvCA,EAAS,QAAU,YAAc,aACpC,GACF,EACAn6B,MAAC,OAAI,UAAU,gDACb,SAAAA,MAACC,EAAO,IAAP,CACC,UAAW,2BAA2B27B,EAAA,CAAe,aACrD,QAAS,CAAE,MAAO,GAClB,QAAS,CAAE,MAAO,GAAGzB,EAAS,QAAQ,KACtC,WAAY,CAAE,SAAU,GAAK,KAAM,UAAU,EAC/C,CACF,GACF,EAGAn6B,MAACiG,GAAA,CAAgB,KAAK,OACpB,SAAAlG,OAACE,EAAO,IAAP,CAEC,QAAS,CAAE,QAAS,EAAG,EAAG,IAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,GAC1B,KAAM,CAAE,QAAS,EAAG,EAAG,KACvB,UAAU,YAET,UAAAk6B,EAAS,QAAU,YAClBn6B,MAAC,OAAI,UAAU,4BACb,SAAAA,MAAC,KAAE,UAAU,UAAU,8CAAkC,EAC3D,EAGDm6B,EAAS,QAAU,eAClBp6B,OAAC,OAAI,UAAU,4BACb,UAAAC,MAAC,KAAE,UAAU,UAAU,2CAA+B,EACtDA,MAAC,KAAE,UAAU,6BAA6B,uCAA2B,GACvE,EAGDm6B,EAAS,QAAU,cAClBp6B,OAAC,OAAI,UAAU,4BACb,UAAAC,MAAC,KAAE,UAAU,UAAU,gCAAoB,EAC3CA,MAAC,KAAE,UAAU,6BAA6B,sDAE1C,GACF,EAGDm6B,EAAS,QAAU,kBAAoBA,EAAS,eAC/Cp6B,OAAC,OAAI,UAAU,4BACb,UAAAC,MAAC,KAAE,UAAU,sBAAuB,SAAAm6B,EAAS,cAAc,MAAM,EACjEn6B,MAAC,KAAE,UAAU,6BACV,WAAS,cAAc,SAAW,IAC/B,+BACA,eACN,GACF,EAGDm6B,EAAS,QAAU,YAClBn6B,MAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,MAAO,IAC9B,QAAS,CAAE,QAAS,EAAG,MAAO,GAC9B,UAAU,cAEV,SAAAF,OAAC,OAAI,UAAU,+DACb,UAAAC,MAACG,GAAA,CAAS,UAAU,UAAU,EAC9BH,MAAC,KAAE,UAAU,wBAAwB,sCAA0B,GACjE,IAIHm6B,EAAS,QAAU,SAClBp6B,OAAC,OAAI,UAAU,2BACb,UAAAC,MAAC,KAAE,UAAU,UAAW,SAAAm6B,EAAS,QAAQ,EACzCn6B,MAAC,KAAE,UAAU,6BAA6B,kEAE1C,GACF,IA1DGm6B,EAAS,OA6DlB,EAGCA,EAAS,QAAU,kBAClBp6B,OAAC,OAAI,UAAU,iBACb,UAAAC,MAAC,KAAE,UAAU,qDAAqD,kBAAM,EACvE,CAAC,YAAa,UAAU,EAAE,IAAIw6B,GAAS,CACtC,MAAMqB,EACJ1B,EAAS,eAAe,QAAUK,GAASL,EAAS,cAAc,WAAa,IAC3E7yB,EAAW6yB,EAAS,eAAe,QAAUK,EACnD,OACEz6B,OAAC,OAEC,UAAW,0CACTuH,EAAW,+CAAiD,iBAC9D,GAEA,UAAAtH,MAAC,OAAI,UAAU,SACb,SAAAA,MAAC,KAAE,UAAU,wBAAyB,WAAM,EAC9C,EACC67B,GAAc77B,MAAC27B,GAAA,CAAa,UAAU,2BAA2B,EACjEr0B,GAAY,CAACu0B,GACZ77B,MAACkG,GAAA,CAAQ,UAAU,uCAAuC,IAVvDs0B,CAAA,CAcX,CAAC,GACH,KAGN,CAEJ,CCvMA,eAAesB,GAAaC,EAAiE,CAC3F,MAAMl9B,EAA4D,GAC9Dk9B,EAAO,MAAQA,EAAO,OAAS,QACjCl9B,EAAQ,KAAOk9B,EAAO,MAEpBA,EAAO,QAAUA,EAAO,SAAW,QACjCA,EAAO,SAAW,UACpBl9B,EAAQ,SAAW,IACVk9B,EAAO,SAAW,YAAcA,EAAO,SAAW,aAC3Dl9B,EAAQ,SAAW,KAGvB,MAAM+e,EAAO,MAAM9e,EAAI,QAAQ,KAAK,OAAO,KAAKD,CAAO,EAAE,OAAS,EAAIA,EAAU,MAAS,EACzF,GAAI,CAAC,MAAM,QAAQ+e,CAAI,EACrB,MAAO,GAET,IAAIjF,EAAWiF,EACf,OAAIme,EAAO,SAAW,UACpBpjB,EAAWA,EAAS,OAAQe,GAAW,CAACA,EAAO,QAAQ,EAC9CqiB,EAAO,SAAW,WAC3BpjB,EAAWA,EAAS,OAAQe,GAAWA,EAAO,UAAY,CAACA,EAAO,SAAS,EAClEqiB,EAAO,SAAW,YAC3BpjB,EAAWA,EAAS,OAAQe,GAAW,EAAQA,EAAO,SAAU,GAE3Df,EAAS,KAAK,CAAC5W,EAAGC,IAAMA,EAAE,UAAYD,EAAE,SAAS,CAC1D,CAEO,MAAMi6B,GAAyBt9B,GAA4B,CAACC,EAAKC,KAAS,CAC/E,QAAS,GACT,QAAS,GACT,MAAO,KACP,OAAQ,CAAE,KAAM,MAAO,OAAQ,OAC/B,QAAS,GACT,MAAM,MAAO,CACNA,EAAA,EAAM,SACTD,EAAI,CAAE,QAAS,GAAM,EAEvB,MAAMC,EAAA,EAAM,SACd,EACA,OAAQ,CACND,EAAI,CAAE,QAAS,GAAO,CACxB,EACA,MAAM,QAAS,CACTC,EAAA,EAAM,QACRD,EAAI,CAAE,QAAS,GAAO,GAEtBA,EAAI,CAAE,QAAS,GAAM,EACrB,MAAMC,EAAA,EAAM,UAEhB,EACA,MAAM,SAAU,CACdD,EAAI,CAAE,QAAS,GAAM,MAAO,KAAM,EAClC,GAAI,CACF,MAAMs9B,EAAU,MAAMH,GAAal9B,EAAA,EAAM,MAAM,EAC/CD,EAAI,CAAE,QAAAs9B,EAAS,QAAS,GAAO,MAAO,KAAM,CAC9C,OAASl9B,EAAO,CACdJ,EAAI,CACF,QAAS,GACT,MAAOI,aAAiB,MAAQA,EAAM,QAAU,OAAOA,CAAK,EAC7D,CACH,CACF,EACA,MAAM,UAAUmb,EAAS,CACvBvb,EAAKY,IAAW,CAAE,OAAQ,CAAE,GAAGA,EAAM,OAAQ,GAAG2a,CAAA,CAAQ,EAAI,EAC5D,MAAMtb,EAAA,EAAM,SACd,EACA,MAAM,QAAQs9B,EAAW,CACvB,MAAMp9B,EAAI,QAAQ,QAAQo9B,CAAS,EACnC,MAAMt9B,EAAA,EAAM,SACd,EACA,MAAM,OAAOs9B,EAAW,CACtB,MAAMp9B,EAAI,QAAQ,OAAOo9B,CAAS,EAClC,MAAMt9B,EAAA,EAAM,SACd,CACF,EAAE,mKCzEF,MAAM0d,GAAsB,IAC1B,IAAI,QAAQ+I,GACV,WACE,IAAAjB,EAAA,IAAM,2BAAA+X,EAAA,EAAmC,QAAE,KAAKhjB,GAAKA,EAAE,qBAAqB,EAAE,KAAKkM,CAAO,EAC1F,IAEJ,EACIpI,GAA4B,IAChC,IAAI,QAAQoI,GACV,WACE,IAAAjB,EAAA,IACE,2BAAAgY,EAAA,UACG,KAAKjjB,GAAKA,EAAE,2BAA2B,EACvC,KAAKkM,CAAO,EACjB,IAEJ,EACIgX,GAAqB,IACzB,IAAI,QAAQhX,GACV,WACE,IAAAjB,EAAA,IACE,OAAO,+BAAkC,0FAAE,KAAKjL,GAAKA,EAAE,oBAAoB,EAAE,KAAKkM,CAAO,EAC3F,IAEJ,EACIiX,GAAoB,IACxB,IAAI,QAAQjX,GACV,WACE,IAAAjB,EAAA,IACE,OAAO,8BAAiC,0FAAE,KAAKjL,GAAKA,EAAE,mBAAmB,EAAE,KAAKkM,CAAO,EACzF,IAEJ,EACIhG,GAAiB,IACrB,IAAI,QAAQgG,GACV,WACE,IAAAjB,EAAA,IAAM,2BAAAmY,EAAA,UAAuC,KAAKpjB,GAAKA,EAAE,gBAAgB,EAAE,KAAKkM,CAAO,EACvF,IAEJ,EAEImX,GAAsB,UAC1B,OAAO,wBAA2B,uCAAE,KAAKrjB,GAAKA,EAAE,mBAAmB,EAC/DsjB,GAA2B,UAC/B,OAAO,wBAA2B,uCAAE,KAAKtjB,GAAKA,EAAE,wBAAwB,EAKpEujB,GAA2B,IAC/B,IAAI,QAAQrX,GACV,WACE,IAAAjB,EAAA,IACE,OAAO,2BAAmC,OAAA/W,KAAA,qCACvC,KAAK8L,GAAKA,EAAE,0BAA0B,EACtC,KAAKkM,CAAO,EACjB,IAEJ,EAEIsX,GAAkBC,KACpBjvB,GAAM,KAAK,IAAAyW,EAAA,IAAM,OAAO,+BAA0B,0CAAE,SAAW,CAAE,QAASjL,EAAE,iBAAkB,CAAC,EAC/F,KAYE0jB,GAAsBlvB,GAAM,KAAK,IAAAyW,EAAA,IAAM,OAAO,mCAAwB,uDAAC,EAoD7E,MAAM0Y,WAAsBnvB,GAAM,SAGhC,CACA,YAAYO,EAIT,CACD,MAAMA,CAAK,EAsBbxN,GAAA,KAAQ,eAAe,IAAM,CAC3B,OAAO,SAAS,QAClB,GAEAA,GAAA,KAAQ,iBAAiB,SAAY,CACnC,GAAI,CACF,MAAMuB,EAAS,MAAMnD,EAAI,YAAY,WACrC,KAAK,SAAS,CACZ,WAAYmD,GAAQ,QAAU,UAAY,QAC1C,YAAaA,GAAQ,QAAU,sBAAwB,8BACvD,QAAS,GACV,CACH,OAASlD,EAAO,CACd,QAAQ,MAAM,kDAAmDA,CAAK,EACtE,KAAK,SAAS,CACZ,WAAY,QACZ,YAAa,8BACb,QAAS,GACV,CACH,CACF,GAEA2B,GAAA,KAAQ,wBAAwB,SAAY,CAC1C,GAAI,MAAK,MAAM,QACf,MAAK,SAAS,CAAE,QAAS,GAAM,WAAY,KAAM,YAAa,OAAW,EACzE,GAAI,CACF,MAAMuB,EAAS,MAAMnD,EAAI,YAAY,kBACjCmD,GAAQ,aAAe,WAAW,WAAW,WAC/C,MAAM,UAAU,UAAU,UAAUA,EAAO,WAAW,EACtD,KAAK,SAAS,CACZ,WAAY,UACZ,YAAa,mCACb,QAAS,GACV,IAED,KAAK,SAAS,CACZ,WAAY,QACZ,YAAa,wDACb,QAAS,GACV,EACD,QAAQ,KAAK,yBAA0BA,GAAQ,WAAW,EAE9D,OAASlD,EAAO,CACd,QAAQ,MAAM,kDAAmDA,CAAK,EACtE,KAAK,SAAS,CACZ,WAAY,QACZ,YAAa,8BACb,QAAS,GACV,CACH,EACF,GAvEE,KAAK,MAAQ,CAAE,SAAU,GAAO,WAAY,KAAM,QAAS,GAC7D,CAEA,OAAO,yBAAyBA,EAAc,CAC5C,MAAO,CAAE,SAAU,GAAM,MAAAA,CAAA,CAC3B,CAEA,kBAAkBA,EAAcg+B,EAA4B,CAC1D,QAAQ,MACN,6BAA6B,KAAK,MAAM,cAAgB,OAAO,KAAK,MAAM,aAAa,GAAK,EAAE,IAC9Fh+B,EACAg+B,CAAA,EAEF,KAAK,SAAS,CAAE,MAAAh+B,EAAO,UAAWg+B,EAAU,gBAAkB,OAAW,CAM3E,CAsDA,QAAS,CACP,OAAI,KAAK,MAAM,SACT,KAAK,MAAM,SACN,KAAK,MAAM,eAIjB,OAAI,UAAU,6FACb,SAAAh9B,OAAC,OAAI,UAAU,8FACb,UAAAA,OAAC,OAAI,UAAU,yBACb,UAAAC,MAAC,OAAI,UAAU,8CACb,eAAC2M,GAAA,CAAc,UAAU,UAAU,EACrC,SACC,OACC,UAAA5M,OAAC,MAAG,UAAU,qCAAqC,iCAEhD,KAAK,MAAM,cAAgB,WAAW,KAAK,MAAM,aAAa,GAAK,GAAG,KACzE,EACC,KAAK,MAAM,OAAO,eAChB,KAAE,UAAU,+BAAgC,cAAK,MAAM,MAAM,QAAQ,QAEvE,KAAE,UAAU,6BAA6B,yHAG1C,GACF,GACF,EAEAA,OAAC,OAAI,UAAU,uBACb,UAAAC,MAAC,UACC,QAAS,KAAK,aACd,UAAU,6IACX,wBAGDA,MAAC,UACC,QAAS,KAAK,sBACd,SAAU,KAAK,MAAM,QACrB,UAAW,qEACT,KAAK,MAAM,QACP,uEACA,kFACN,GAEC,cAAK,MAAM,QAAU,WAAa,qBAErCA,MAAC,UACC,QAAS,KAAK,eACd,UAAU,yJACX,6BAED,EACF,EAEC,KAAK,MAAM,aACVA,MAAC,OACC,UAAW,WACT,KAAK,MAAM,aAAe,UAAY,mBAAqB,cAC7D,GAEC,cAAK,MAAM,cAIf48B,GAAA,GAAc,KAAK,MAAM,kBACvB,WAAQ,UAAU,wBACjB,gBAAC,WAAQ,UAAU,+BAA+B,uBAAW,QAC5D,OAAI,UAAU,0EACZ,cAAK,MAAM,UACd,GACF,GAEJ,EACF,EAGG,KAAK,MAAM,QACpB,CACF,CAGA,MAAMI,GAASrvB,GAAM,KAAK,IAAAyW,EAAA,IACxB,OAAO,sBAA4B,0FAAE,SAAW,CAAE,QAASjL,EAAE,QAAS,CACxE,EACM8jB,GAAWtvB,GAAM,KAAK,IAAAyW,EAAA,IAAM,OAAO,wBAAY,6FAAE,KAAKjL,IAAM,CAAE,QAASA,EAAE,UAAW,CAAC,EACrF+jB,GAAavvB,GAAM,KAAK,IAAAyW,EAAA,IAAM,OAAO,0BAAc,6FAAE,KAAKjL,IAAM,CAAE,QAASA,EAAE,YAAa,CAAC,EAC3FgkB,GAAexvB,GAAM,KAAK,IAAAyW,EAAA,IAC9B,OAAO,4BAAgB,wEAAE,SAAW,CAAE,QAASjL,EAAE,cAAe,CAClE,EACM2T,GAAiBnf,GAAM,KAAK,IAAAyW,EAAA,IAChC,OAAO,8BAAkB,6DAAE,SAAW,CAAE,QAASjL,EAAE,gBAAiB,CACtE,EACMikB,GAAmBzvB,GAAM,KAAK,IAAAyW,EAAA,IAClC,OAAO,gCAA8B,0CAAE,SAAW,CAAE,QAASjL,EAAE,kBAAmB,CACpF,EACMkkB,GAAgB1vB,GAAM,KAAK,IAAAyW,EAAA,IAC/B,OAAO,6BAA2B,0CAAE,SAAW,CAAE,QAASjL,EAAE,eAAgB,CAC9E,EACMmkB,GAAe3vB,GAAM,KAAK,IAAAyW,EAAA,IAC9B,OAAO,4BAAiB,gEAAE,SAAW,CAAE,QAASjL,EAAE,cAAe,CACnE,EACMokB,GAAe5vB,GAAM,KAAK,IAAAyW,EAAA,IAC9B,OAAO,4BAAuB,uCAAE,SAAW,CAAE,QAASjL,EAAE,cAAe,CACzE,EAEMqkB,GAAsB,IAC1Bx9B,MAAC,OAAI,UAAU,sHACb,SAAAA,MAACu9B,KAAa,EAChB,EAEIE,GAAiB9vB,GAAM,KAAK,IAAAyW,EAAA,IAChC,OAAO,8BAA4B,0CAAE,SAAW,CAAE,QAASjL,EAAE,gBAAiB,CAChF,EACMukB,GAAgB/vB,GAAM,KAAK,IAAAyW,EAAA,IAC/B,OAAO,6BAA2B,0CAAE,SAAW,CAAE,QAASjL,EAAE,eAAgB,CAC9E,EACMwkB,GAAkBhwB,GAAM,KAAK,IAAAyW,EAAA,IACjC,OAAO,+BAAmB,0FAAE,SAAW,CAAE,QAASjL,EAAE,iBAAkB,CACxE,EACMykB,GAAmBjwB,GAAM,KAAK,IAAAyW,EAAA,IAClC,OAAO,gCAA6B,gGAAE,SAAW,CAAE,QAASjL,EAAE,kBAAmB,CACnF,EACM0kB,GAAuBlwB,GAAM,KAAK,IAAAyW,EAAA,IACtC,OAAO,oCAA+B,0FAAE,SAAW,CAAE,QAASjL,EAAE,sBAAuB,CACzF,EACM2kB,GAAenwB,GAAM,KAAK,IAAAyW,EAAA,IAC9B,OAAO,4BAA4B,0FAAE,SAAW,CAAE,QAASjL,EAAE,cAAe,CAC9E,EAMO,SAAS4kB,IAAW,CACzB,KAAM,CAACC,EAAgBC,CAAiB,EAAI7+B,WAAS,EAAK,EACpD,CAAC8+B,EAAoBC,CAAqB,EAAI/+B,WAAS,EAAK,EAC5D,CAACg/B,EAAsBC,CAAuB,EAAIj/B,WAAS,EAAK,EAChE,CAACk/B,EAAmBC,CAAoB,EAAIn/B,WAAmC,IAAI,EACnF,CAACo/B,EAAgBC,CAAiB,EAAIr/B,WAAgC,IAAI,EAC1E,CAACs/B,EAAcC,CAAe,EAAIv/B,WAAS,EAAK,EAChDw/B,EAAoB94B,EAAYvG,GAASA,EAAM,iBAAiB,EAChEs/B,EAAuB/4B,EAAYvG,GAASA,EAAM,oBAAoB,EACtEyX,EAAUlR,EAAYvG,GAASA,EAAM,OAAO,EAC5C,CAACu/B,EAAgBC,CAAiB,EAAI3/B,WAAS,EAAK,EACpD,CAAC4/B,EAAqBC,CAAsB,EAAI7/B,WAAS,EAAK,EAC9D,CAAC8/B,EAAyBC,CAA0B,EAAI//B,WAAS,EAAK,EACtE,CAACggC,EAAeC,CAAgB,EAAIjgC,WAAS,EAAK,EAClDkgC,EAAQ1C,GAAA,EACR2C,EAAkBr7B,GAAiB3E,GAASA,EAAM,WAAW,KAAK,EAClEigC,EAAYt7B,GAAiB3E,GAASA,EAAM,WAAW,SAAS,EAChEkgC,EAAcv7B,GAAiB3E,GAASA,EAAM,QAAQ,WAAW,EACjE,CAAE,WAAAyN,EAAY,cAAAC,GAAe,aAAAT,EAAA,EAAiBO,GAAA,EAGpDhK,YAAU,IACQwtB,GAAA,EAEf,EAAE,EAGLxtB,YAAU,IAAM,CACd,GAAIiB,KAAkB,CACpB,MAAM+E,EAAU4C,GAAA,EAIhB,IAAI+zB,EAAgC,MAEnC,SAAY,CACX,GAAI,CACF,KAAM,CAAE,OAAAC,CAAA,EAAW,MAAAvb,EAAA,uBAAAub,GAAA,KAAM,QAAO,uBAAuB,gBAAAA,CAAA,OACvDD,EAAW,MAAMC,EAAe,kBAAmB3+B,GAAS,CAC1D,QAAQ,IAAI,wCAAyCA,EAAM,OAAO,EAClE,OAAO,SAAS,KAAOA,EAAM,OAC/B,CAAC,CACH,OAASjC,EAAO,CACd,QAAQ,KAAK,wDAAyDA,CAAK,EAE3E,MAAM6gC,EAAkB5+B,GAA+B,CACrD,QAAQ,IAAI,mDAAoDA,EAAM,MAAM,EAC5E,OAAO,SAAS,KAAOA,EAAM,MAC/B,EACA,OAAO,iBAAiB,kBAAmB4+B,CAA+B,EAC1EF,EAAW,IAAM,CACf,OAAO,oBAAoB,kBAAmBE,CAA+B,CAC/E,CACF,CACF,KAGA,MAAMC,EAAqB7+B,GAAwB,CAEjD,KAAM,CAAE,KAAA2P,EAAM,IAAApN,EAAK,YAAAu8B,GAAgB9+B,EAAM,MAAQ,GAEjD,GAAI2P,IAAS,mBAAqBpN,EAAK,CACrC,QAAQ,IAAI,8CAA+C,CACzD,IAAAA,EACA,YAAAu8B,EACA,OAAQ9+B,EAAM,OACf,EAGD,MAAMguB,EAAY1vB,EAAa,WACzB8rB,EAAc,CAClB,GAAI,OAAO,KAAK,KAAK,IAAI,KAAK,SAAS,SAAS,EAAE,EAAE,MAAM,EAAG,CAAC,CAAC,GAC/D,IAAA7nB,EACA,MAAO,UACP,OAAQ,GACR,UAAW,KAAK,KAAI,EAEtByrB,EAAU,IAAI5D,CAAM,CACtB,CACF,EAEA,cAAO,iBAAiB,UAAWyU,CAAiB,EAE7C,IAAM,CACX92B,EAAA,EACI22B,GACFA,EAAA,EAEF,OAAO,oBAAoB,UAAWG,CAAiB,CACzD,CACF,CACF,EAAG,EAAE,EAGL98B,YAAU,IAAM,CACEu0B,GAAA,EACJ,OAAS,GAEnB,WAAW,IAAM,CACf2H,EAAuB,EAAI,CAC7B,EAAG,GAAI,CAEX,EAAG,EAAE,EAGLl8B,YAAU,IAAM,CACd,IAAIgG,EAA+B,KAqBnC,OAnB6B,SAAY,CACvC,KAAM,CAAE,sBAAAg3B,EAAuB,qBAAAC,EAAsB,mBAAAC,GACnD,MAAA7b,EAAA,sCAAA2b,EAAA,qBAAAC,EAAA,mBAAAC,GAAA,KAAM,QAAO,6BAAqC,+BAAAF,EAAA,qBAAAC,EAAA,mBAAAC,CAAA,wCAEpDF,EACE,SAAY,CAEV,MAAME,EAAA,CACR,EACA,SAAY,CAEV,MAAMA,EAAA,EACN1b,EAAM,QAAQ,sEAAsE,CACtF,GAGFxb,EAAU,IAAMi3B,EAAA,CAClB,GAEA,EAEO,IAAM,CACPj3B,GAASA,EAAA,CACf,CACF,EAAG,EAAE,EAKLhG,YAAU,IAAM,CAEd47B,EAAgB,EAAK,EAGrB,MAAMuB,EAAkB,IAAM,CAC5B,MAAMC,EAAwB,CAAC,EAC7B,SAAS,mBACR,OAAe,yBACf,OAAe,sBAEdA,IAA0BzB,GAC5BC,EAAgBwB,CAAqB,CAEzC,EAGMp7B,EAAY,WAAWm7B,EAAiB,GAAG,EAGjD,gBAAS,iBAAiB,mBAAoBA,CAAe,EAC7D,SAAS,iBAAiB,yBAA0BA,CAAe,EACnE,SAAS,iBAAiB,sBAAuBA,CAAe,EAEzD,IAAM,CACX,aAAan7B,CAAS,EACtB,SAAS,oBAAoB,mBAAoBm7B,CAAe,EAChE,SAAS,oBAAoB,yBAA0BA,CAAe,EACtE,SAAS,oBAAoB,sBAAuBA,CAAe,CACrE,CACF,EAAG,EAAE,EACL,KAAM,CAACE,EAAeC,CAAgB,EAAIjhC,WAAS,EAAK,EAClD,CAACkhC,EAAcC,CAAe,EAAInhC,WAAS,EAAK,EAChD,CAACohC,GAAWC,EAAY,EAAIrhC,WAAS,IACzC,OAAO,UAAc,IAAc,CAAC,UAAU,OAAS,IAEnD,CAACshC,GAAiBC,EAAkB,EAAIvhC,WAAS,EAAK,EACtDwhC,GAAoBlM,GAAmBn1B,GAASA,EAAM,OAAO,EAC7Du1B,EAAkBJ,GAAmBn1B,GAASA,EAAM,KAAK,EACrCm1B,GAAmBn1B,GAASA,EAAM,MAAM,EAClEq1B,GAAA,EAGA,KAAM,CAACiM,EAAeC,CAAgB,EAAI1hC,WAAS,EAAK,EAClD2hC,EAAep+B,SAA8B,IAAI,EACjDq+B,GAAkBr+B,SAA8B,IAAI,EACpDkB,GAAahB,UAAQ,IAAMiB,GAAA,EAAqB,EAAE,EAClDm9B,GACJp9B,IACA,OAAO,OAAW,KAClB,CAAC,CAAE,OAA6C,IAElDd,YAAU,IAAM,CACd,MAAMm+B,EAAe,IAAMT,GAAa,EAAK,EACvCU,EAAgB,IAAMV,GAAa,EAAI,EAC7C,cAAO,iBAAiB,SAAUS,CAAY,EAC9C,OAAO,iBAAiB,UAAWC,CAAa,EACzC,IAAM,CACX,OAAO,oBAAoB,SAAUD,CAAY,EACjD,OAAO,oBAAoB,UAAWC,CAAa,CACrD,CACF,EAAG,EAAE,EAGLp+B,YAAU,IAAM,CACd,GAAI,CAACc,GACH,OAGF,MAAMu9B,EAAuBj0B,GAAU,GAAG,aAAc,IAAM,CAE5D,OAAO,cAAc,IAAI,YAAY,gBAAgB,CAAC,EACtDoX,EAAM,KAAK,iBAAiB,CAC9B,CAAC,EAEK8c,EAAuBl0B,GAAU,GAAG,kBAAmB,IAAM,CACjE6J,EAAQ,OAAO,EACfuN,EAAM,KAAK,mBAAmB,CAChC,CAAC,EAEK+c,EAA0Bn0B,GAAU,GAAG,qBAAsB,IAAM,CACvE6J,EAAQ,UAAU,EAClBuN,EAAM,KAAK,sBAAsB,CACnC,CAAC,EAED,MAAO,IAAM,CACX6c,EAAA,EACAC,EAAA,EACAC,EAAA,CACF,CACF,EAAG,CAACtqB,CAAO,CAAC,EAEZjU,YAAU,IAAM,CACd,GAAI,CAACc,GACH,OAGF,IAAI09B,EAAU,GACVC,EAAa,GAEjB,MAAMC,EAAgB,IAAM,CAC1B,MAAMC,EAAM,KAAK,MAAMX,EAAa,SAAS,cAAgB,CAAC,EACxDY,EAAiB,KAAK,MAAMX,GAAgB,SAAS,cAAgB,CAAC,EACtEY,EAASlD,EAAe,EAAIiD,EAG9BD,IAAQH,GACV,SAAS,gBAAgB,MAAM,YAAY,kBAAmB,GAAGG,CAAG,IAAI,GAEtEE,IAAWJ,GAAcI,IAAWD,IACtC,SAAS,gBAAgB,MAAM,YAAY,kBAAmB,GAAGC,CAAM,IAAI,GAGzEF,IAAQH,GAAWK,IAAWJ,KAChCD,EAAUG,EACVF,EAAaI,EACR9iC,EAAI,GAAG,iBAAiB,CAAE,IAAA4iC,EAAK,OAAAE,EAAQ,EAEhD,EAEMC,EAA8B,GAC9BC,EAAkBC,GAAwC,CAC9D,GAAI,CAACA,GAAW,OAAO,eAAmB,IAAa,OACvD,MAAMjhC,EAAW,IAAI,eAAe2gC,CAAa,EACjD3gC,EAAS,QAAQihC,CAAO,EACxBF,EAAU,KAAK/gC,CAAQ,CACzB,EAEA,OAAAghC,EAAef,EAAa,OAAO,EACnCe,EAAed,GAAgB,OAAO,EACtCS,EAAA,EACA,OAAO,iBAAiB,SAAUA,CAAa,EAExC,IAAM,CACX,OAAO,oBAAoB,SAAUA,CAAa,EAClDI,EAAU,QAAQ/gC,GAAYA,EAAS,YAAY,CACrD,CACF,EAAG,CAAC+C,GAAY66B,CAAY,CAAC,EAG7B37B,YAAU,IAAM,CACd,GAAI,CAACg+B,EAAa,QAAS,OAE3B,MAAMiB,EAAqB,IAAM,CAC/B,MAAMl0B,EAASizB,EAAa,SAAS,cAAgB,EAC/CkB,EAAK,GAAGn0B,CAAM,KAGpB,GAFA,SAAS,gBAAgB,MAAM,YAAY,kBAAmBm0B,CAAE,EAChE,SAAS,gBAAgB,MAAM,YAAY,wBAAyBA,CAAE,EAClE,OAAO,OAAW,MACnB,OAAe,sBAAwBn0B,EACpC,OAAQ,OAAe,sBAAyB,YAClD,GAAI,CACD,OAAe,sBAClB,MAAgB,CAIhB,CAGN,EAEAk0B,EAAA,EACA,MAAMlhC,EAAW,IAAI,eAAekhC,CAAkB,EACtD,OAAIjB,EAAa,SACfjgC,EAAS,QAAQigC,EAAa,OAAO,EAGhC,IAAMjgC,EAAS,YACxB,EAAG,EAAE,EAGLiC,YAAU,IAAM,CACdgzB,GAAA,CACF,EAAG,EAAE,EAGLhzB,YAAU,IAAM,CACduzB,GAAA,EACAD,GAAA,CACF,EAAG,EAAE,EAGLtzB,YAAU,IAAM,CACVy9B,GACG1hC,EAAI,OACN,QACA,KAAKmD,GAAU,CACd0+B,GAAmB1+B,GAAQ,WAAa,EAAK,CAC/C,CAAC,EACA,MAAM,IAAM,CACX0+B,GAAmB,EAAK,CAC1B,CAAC,EAEHA,GAAmB,EAAK,CAE5B,EAAG,CAACH,EAAS,CAAC,EAEd,KAAM,CAAC0B,GAAgBC,EAAiB,EAAI/iC,WAIlC,IAAI,EACR,CAACgjC,GAAkBC,EAAmB,EAAIjjC,WAAS,EAAK,EACxD,CAACkjC,GAAeC,EAAgB,EAAInjC,WAA+B,MAAM,EACzE,CAACojC,GAAeC,EAAgB,EAAIrjC,WAAS,IACjD,OAAO,OAAW,IAAc,OAAO,WAAa,MAEhDsjC,GAAkBF,IAAiB,KAGzCz/B,YAAU,IAAM,CACd,GACE,CAACc,IACD,OAAO,OAAW,KAClB,CAAE,OAAe,IACjB,OAAQ,OAAe,GAAG,cAAiB,WAE3C,OAKF,MAAMsmB,EAAa6T,GAAkB,CAACU,GAAgBgE,GAAkB,IAAM,EAE9E,GAAI,CACD,OAAe,GAAG,aAAavY,CAAU,CAI5C,MAAgB,CAIhB,CACF,EAAG,CAAC6T,EAAgBU,EAAcgE,GAAiB7+B,EAAU,CAAC,EAE9D,KAAM,EAAG8+B,EAAkB,EAAIvjC,WAAS,EAAK,EACvCwjC,GAAkBhU,GAAgBrvB,GAASA,EAAM,QAAQ,EACzDsjC,GAAsBjU,GAAgBrvB,GAASA,EAAM,YAAY,EACxCqvB,GAAgBrvB,GAASA,EAAM,mBAAmB,EACjF,MAAMujC,GAAuBlU,GAAgBrvB,GAASA,EAAM,aAAa,EACnEwjC,GAAsBjT,GAAgBvwB,GAASA,EAAM,KAAK,EAC1D4mB,GAAY7mB,EAAA,EAC+Ck3B,GAAA,EACjE,KAAM,CAACwM,GAASC,EAAU,EAAI7jC,WAAS,EAAK,EACtC,CAAC8jC,GAAmBC,EAAoB,EAAI/jC,WAAS,EAAK,EAC1D,CAACgkC,GAAcC,EAAe,EAAIjkC,WAG9B,IAAI,EAGR,CAAE,aAAAg1B,EAAA,EAAiBD,GAAA,EAGnBmP,GAAkBpgC,cAAY,IAAM,CACxC,QAAQ,IAAI,uDAAuD,EACnE,QAAQ,IACN,sCACA8/B,GACA,gBACA5O,GACA,qBACA8O,EAAA,EAEFD,GAAW,EAAK,EAGhB,QAAQ,IACN,qFAEJ,EAAG,CAACD,GAAS5O,GAAc8O,EAAiB,CAAC,EAEvCK,GAAmBrgC,cAAY,IAAM,CAIvC,OAAO,QAAQ,4EAA4E,IAGvF,OAAO,OAAW,KAAgB,OAAe,KAAK,KAAK,KAC5D,OAAe,IAAI,IAAI,OAExB,OAAO,QAGb,EAAG,EAAE,EAELH,YAAU,IAAM,CACd,GAAI,OAAO,OAAW,IAAa,OACnC,MAAMK,EAAe,IAAM,CACzBq/B,GAAiB,OAAO,UAAU,CACpC,EACA,cAAO,iBAAiB,SAAUr/B,CAAY,EACvC,IAAM,OAAO,oBAAoB,SAAUA,CAAY,CAChE,EAAG,EAAE,EAGLL,YAAU,KACRygC,GAAA,EACO,IAAM,CAEb,GACC,EAAE,EAELzgC,YAAU,IAAM,CACd,MAAM0gC,EAAQ,OAAO,WAAW,IAAM,CACpCZ,GAAoB1c,GAAU,KAAMA,GAAU,QAAQ,CACxD,EAAG,GAAG,EACN,MAAO,IAAM,OAAO,aAAasd,CAAK,CACxC,EAAG,CAACtd,GAAU,KAAMA,GAAU,SAAU0c,EAAmB,CAAC,EAE5D9/B,YAAU,IAAM,CACd,GAAI,CAAC08B,EAAa,OAClB,MAAMiE,EAAqB,IAAM,CAC/BZ,GAAA,EACAC,GAAA,EACAzjC,EAAa,WAAW,qBAC1B,EACA,cAAO,iBAAiB,eAAgBokC,CAAkB,EACnD,IAAM,OAAO,oBAAoB,eAAgBA,CAAkB,CAC5E,EAAG,CAACjE,EAAasD,GAAqBD,EAAoB,CAAC,EAE3D//B,YAAU,IAAM,CACd,GAAI,OAAO,SAAa,IAAa,OACrC,MAAM4gC,EAAO,SAAS,gBAChBC,EAAQ,OAAO,WAAW,8BAA8B,EAExDC,EAAmB,IAAM,CAC7B,MAAMC,EACJvE,IAAoB,SAAYqE,EAAM,QAAU,OAAS,QAAWrE,EACtEoE,EAAK,QAAQ,MAAQG,EACrBH,EAAK,QAAQ,QAAUnE,EAAY,OAAS,OAC9C,EAIA,GAFAqE,EAAA,EAEItE,IAAoB,SAAU,CAChC,MAAMx+B,EAAU,IAAM8iC,EAAA,EACtB,OAAAD,EAAM,iBAAiB,SAAU7iC,CAAO,EACjC,IAAM6iC,EAAM,oBAAoB,SAAU7iC,CAAO,CAC1D,CAGF,EAAG,CAACw+B,EAAiBC,CAAS,CAAC,EAG/Bz8B,YAAU,IAAM,CACd,GAAI,CACF,MAAM2Y,EAAS,aAAa,QAAQ,oBAAoB,EACxD,GAAIA,EAAQ,CACV,MAAMnR,EAAO,KAAK,MAAMmR,CAAM,EAE9B,GAAInR,EAAK,UADc,cACgBA,EAAK,SAAU,CACpD04B,GAAW,EAAK,EAEX7O,IACH+O,GAAqB,EAAI,EAE3B,MACF,CACF,CAEAF,GAAW,EAAI,CACjB,MAAQ,CAENA,GAAW,EAAI,CACjB,CACF,EAAG,CAAC7O,EAAY,CAAC,EAGjBrxB,YAAU,IAAM,CACd,GAAI,CAACigC,IAAW,CAAC5O,GAAc,CAC7B,QAAQ,IAAI,yEAAyE,EAErF,MAAMqP,EAAQ,WAAW,IAAM,CAC7BN,GAAqB,EAAI,EACzB,QAAQ,IAAI,uCAAuC,CACrD,EAAG,GAAG,EACN,MAAO,IAAM,aAAaM,CAAK,CACjC,KAAW,CAACT,IAAW5O,KACrB,QAAQ,IAAI,wEAAwE,EACpF+O,GAAqB,EAAK,EAE9B,EAAG,CAACH,GAAS5O,EAAY,CAAC,EAC1BrxB,YAAU,IAAM,CACd,IAAIghC,EAAc,EAElB,MAAMC,EAAehjC,GAAqB,CACxC,MAAMijC,GAAQjjC,EAAM,cAAc,MAClC,OAAKijC,GACE,MAAM,KAAKA,EAAK,EAAE,SAAS,4BAA4B,EAD3C,EAErB,EAEMC,EAAmBljC,GAAqB,CACvCgjC,EAAYhjC,CAAK,IACtBA,EAAM,iBACN+iC,GAAe,EACfjD,EAAiB,EAAI,EACvB,EAEMqD,EAAkBnjC,GAAqB,CACtCgjC,EAAYhjC,CAAK,IACtBA,EAAM,iBACFA,EAAM,eACRA,EAAM,aAAa,WAAa,QAEpC,EAEMojC,EAAmBpjC,GAAqB,CACvCgjC,EAAYhjC,CAAK,IACtB+iC,EAAc,KAAK,IAAI,EAAGA,EAAc,CAAC,EACrCA,IAAgB,GAClBjD,EAAiB,EAAK,EAE1B,EAEMuD,EAAgB,IAAM,CAC1BN,EAAc,EACdjD,EAAiB,EAAK,CACxB,EAEMwD,EAActjC,GAAqB,CACvC,GAAI,CAACgjC,EAAYhjC,CAAK,EAAG,OACzBA,EAAM,iBACN+iC,EAAc,EACdjD,EAAiB,EAAK,EACtB,MAAM9hC,GAAQgC,EAAM,cAAc,QAAQ,4BAA4B,EACtE,GAAIhC,GACF,GAAI,CACGP,GAAiB,WAAW,SAASO,EAAK,CACjD,OAASD,GAAO,CACV69B,MACF,QAAQ,KAAK,iDAAkD79B,EAAK,CAExE,CAEJ,EAEMwlC,EAAsB,IAAM,CAChCR,EAAc,EACdjD,EAAiB,EAAK,CACxB,EAEA,gBAAS,iBAAiB,YAAaoD,CAAe,EACtD,SAAS,iBAAiB,WAAYC,CAAc,EACpD,SAAS,iBAAiB,YAAaC,CAAe,EACtD,SAAS,iBAAiB,UAAWC,CAAa,EAClD,SAAS,iBAAiB,OAAQC,CAAU,EAC5C,OAAO,iBAAiB,mBAAoBC,CAAoC,EAEzE,IAAM,CACX,SAAS,oBAAoB,YAAaL,CAAe,EACzD,SAAS,oBAAoB,WAAYC,CAAc,EACvD,SAAS,oBAAoB,YAAaC,CAAe,EACzD,SAAS,oBAAoB,UAAWC,CAAa,EACrD,SAAS,oBAAoB,OAAQC,CAAU,EAC/C,OAAO,oBAAoB,mBAAoBC,CAAoC,CACrF,CACF,EAAG,EAAE,EACL,MAAMC,GAAiBxI,GAAuBz8B,GAASA,EAAM,OAAO,EAC9DklC,GAAwBC,GAAuBnlC,GAASA,EAAM,OAAO,EAErEolC,GAAWzhC,cAAa0hC,GAAsB,CAClD,KAAM,CAAE,KAAAplC,EAAM,SAAAH,EAAU,UAAA2K,CAAA,EAAc1K,EAAa,WAC7CuG,EAAcC,EAAY,WAAW,KACrC++B,EAAarlC,EAAK,WACf,CAACqG,GAAe,CAACnC,GAAI,SAAWA,GAAI,UAAYmC,GAEzD,GAAIg/B,EAAW,SAAW,EACxB,MAAO,GAET,MAAMC,EAAeD,EAAW,UAAUnhC,IAAOA,GAAI,KAAOrE,CAAQ,EAE9D0lC,IADYD,GAAgB,EAAIA,EAAe,GACtBF,EAAYC,EAAW,QAAUA,EAAW,OACrEx8B,GAASw8B,EAAWE,CAAS,EACnC,OAAI18B,IAAUA,GAAO,KAAOhJ,GAC1B2K,EAAU3B,GAAO,EAAE,EACdvJ,EAAI,KAAK,SAAS,CAAE,GAAIuJ,GAAO,GAAI,EACjC,IAEF,EACT,EAAG,EAAE,EAEC28B,GAAiB9hC,cAAY,CAAC0M,EAAkBq1B,EAAY,KAAU,CAC1E,KAAM,CAAE,KAAAzlC,EAAM,UAAAwK,GAAc1K,EAAa,WACnCuG,EAAcC,EAAY,WAAW,KACrC++B,EAAarlC,EAAK,UACf,CAACqG,GAAe,CAACnC,EAAI,SAAWA,EAAI,UAAYmC,GAEzD,GAAIg/B,EAAW,SAAW,EACxB,MAAO,GAGT,MAAMv5B,EAAQ25B,EACV,KAAK,IAAIJ,EAAW,OAAS,EAAG,CAAC,EACjC,KAAK,IAAI,KAAK,IAAIj1B,EAAU,CAAC,EAAGi1B,EAAW,OAAS,CAAC,EACnDx8B,EAASw8B,EAAWv5B,CAAK,EAC/B,OAAIjD,GACF2B,EAAU3B,EAAO,EAAE,EACdvJ,EAAI,KAAK,SAAS,CAAE,GAAIuJ,EAAO,GAAI,EACjC,IAEF,EACT,EAAG,EAAE,EACClC,EAAYtD,UAAQ,IAAM,CAE9B,MAAMqiC,EAAW,MAAM,QAAQ/e,GAAU,IAAI,EAAIA,GAAU,KAAK,OAAOzmB,GAAKA,GAAKA,EAAE,EAAE,EAAI,GACnFylC,EAAQD,EAAS,QAAYxhC,EAAI,KAAOyiB,GAAU,QAAQ,EAEhE,OAAIA,GAAU,UAAY,CAACgf,GACzB,QAAQ,KAAK,iCAAkC,CAC7C,SAAUhf,GAAU,SACpB,aAAc+e,EAAS,IAAIxlC,GAAKA,EAAE,EAAE,EACpC,UAAWwlC,EAAS,OACrB,EAGIC,GAAS,MAClB,EAAG,CAAChf,GAAU,KAAMA,GAAU,QAAQ,CAAC,EACjCpP,GAAOjR,EAAYvG,GAASA,EAAM,IAAI,EACtCsG,GAAckR,IAAQ,SAE5BhU,YAAU,IAAM,CACd,GAAI,OAAO,SAAa,IAAa,OACrC,MAAMqiC,GAAYruB,IAAQ,UAAU,cACpC,gBAAS,gBAAgB,QAAQ,UAAYquB,EACtC,IAAM,CACX,SAAS,gBAAgB,QAAQ,UAAYA,CAC/C,CACF,EAAG,CAACruB,EAAI,CAAC,EACT,MAAMsuB,GAAmBv/B,EAAYvG,GAASA,EAAM,gBAAgB,EAC9Ds1B,GAAsB/uB,EAAYvG,GAASA,EAAM,mBAAmB,EACpE+lC,GAAmBtU,GAAczxB,GAASA,EAAM,WAAW,EAC3DgmC,GAAsBvU,GAAczxB,GAASA,EAAM,cAAc,EACjEimC,GAAmB1/B,EAAYvG,GAASA,EAAM,gBAAgB,EAC9DkmC,GAAsB3/B,EAAYvG,GAASA,EAAM,mBAAmB,EACpE,CAACmmC,GAAeC,EAAe,EAAIvmC,WAAS,GAAI,EAGhDwmC,GAAiBjjC,SAAe,EAAE,EACxCI,YAAU,IAAM,CACV,CAACoD,GAAW,KAAOA,EAAU,MAAQy/B,GAAe,SAItDz/B,EAAU,IAAI,WAAW,QAAQ,GACjCA,EAAU,IAAI,WAAW,SAAS,GAClCA,EAAU,IAAI,WAAW,OAAO,GAChCA,EAAU,IAAI,WAAW,MAAM,GAC/BA,EAAU,IAAI,WAAW,OAAO,IAMlCy/B,GAAe,QAAUz/B,EAAU,IACnC0/B,GAAW1/B,EAAU,IAAKA,EAAU,MAAO,CACzC,MAAOA,EAAU,GACjB,YAAaA,EAAU,YACxB,EAAE,MAAMpH,GAAS,CAChB,QAAQ,KAAK,oCAAqCA,CAAK,CACzD,CAAC,EACH,EAAG,CAACoH,GAAW,IAAKA,GAAW,MAAOA,GAAW,GAAIA,GAAW,WAAW,CAAC,EAG5EpD,YAAU,IAAM,CAEd,WAAW,IAAM,CACf25B,GAAA,EAA2B,MAAM5R,GAAO,CAClC8R,GAAA,GAAY,QAAQ,KAAK,gDAAiD9R,CAAG,CACnF,CAAC,CACH,EAAG,GAAI,CACT,EAAG,EAAE,EACL,KAAM,CAACgb,GAAmBC,EAAoB,EAAI3mC,WAAS,EAAK,EAC1DuE,GACJu6B,GACA,EAAQI,GACR,EAAQE,GACR4B,GACAE,EACI0F,GAAe7/B,GAAW,KAAO,GAEjC8/B,GACJpgC,KAAgB,YAChBA,KAAgB,SAChB,EAAQmgC,IACR,CAACA,GAAa,WAAW,OAAO,GAChC,CAACA,GAAa,WAAW,QAAQ,GACjC,CAACA,GAAa,WAAW,WAAW,GACpC,CAACA,GAAa,WAAW,SAAS,GAClC,CAACA,GAAa,WAAW,QAAQ,EACnCjjC,YAAU,IAAM,EACV2/B,IAAmB,CAACuD,KACtBtD,GAAmB,EAAK,CAE5B,EAAG,CAACD,GAAiBuD,EAAc,CAAC,EACpC,MAAMC,GAA6BD,IAAkBvD,GAC/CyD,GAAoBjjC,cAAY,IAAM,CACrC+iC,IACLF,GAAqB,EAAI,CAC3B,EAAG,CAACE,EAAc,CAAC,EAEnBljC,YAAU,IAAM,CACd,GAAI,CAAC+iC,GAAmB,OAExB,MAAMM,EAAqBplC,GAAsB,CAC/C2kC,GAAgBh7B,GAAQ,CACtB,MAAMoW,EAAQ/f,EAAM,QAAU,OAAO,WACrC,OAAI,OAAO,MAAM+f,CAAK,EAAUpW,EACzB,KAAK,IAAI,IAAM,KAAK,IAAI,IAAMoW,CAAK,CAAC,CAC7C,CAAC,CACH,EAEMslB,EAAkB,IAAM,CAC5BN,GAAqB,EAAK,CAC5B,EAEA,cAAO,iBAAiB,YAAaK,CAAiB,EACtD,OAAO,iBAAiB,UAAWC,CAAe,EAE3C,IAAM,CACX,OAAO,oBAAoB,YAAaD,CAAiB,EACzD,OAAO,oBAAoB,UAAWC,CAAe,CACvD,CACF,EAAG,CAACP,EAAiB,CAAC,EAEOjjC,UAAQ,IAAM,CACzC,GAAI,CAACq/B,GAAgB,OAAO,KAC5B,GAAI,CACF,OAAOzjB,GAAoB,IAAI,KAAKyjB,GAAe,SAAS,EAAG,CAAE,UAAW,GAAM,CACpF,MAAQ,CACN,OAAO,IACT,CACF,EAAG,CAACA,EAAc,CAAC,EAGnBn/B,YAAU,IAAM,CAEVgU,KAAS,YAKNsuB,IACHxQ,GAAoB,EAAI,EAEtByQ,IACFC,GAAoB,EAAK,GAElBxuB,KAAS,SACbuuB,IACHC,GAAoB,EAAI,EAEtBF,IACFxQ,GAAoB,EAAK,EAEvB+J,GACFC,EAAqB,EAAK,GAEnB9nB,KAAS,aACIjR,EAAY,WAAW,eAE3CA,EAAY,WAAW,kBAGrBu/B,IACFxQ,GAAoB,EAAK,EAEvByQ,IACFC,GAAoB,EAAK,EAEvB3G,GACFC,EAAqB,EAAK,IAIxBwG,IACFxQ,GAAoB,EAAK,EAEvByQ,IACFC,GAAoB,EAAK,EAI/B,EAAG,CACDxuB,GACA6nB,EACAyG,GACAxQ,GACAyQ,GACAC,GACA1G,CAAA,CACD,EAID97B,YAAU,IAAM,EAEI,IAAM,CAClB,wBAAyB,OAC3B,oBACE,IAAM,CACJuZ,GAAA,EAAsB,MAAMwO,GAAO,CAC7B8R,GAAA,GAAY,QAAQ,KAAK,oCAAqC9R,CAAG,CACvE,CAAC,CACH,EACA,CAAE,QAAS,IAAK,EAGlB,WAAW,IAAM,CACfxO,GAAA,EAAsB,MAAMgqB,GAAQ,CAC9B1J,GAAA,GAAY,QAAQ,KAAK,kCAAkC,CACjE,CAAC,CACH,EAAG,GAAG,CAEV,GACA,CACF,EAAG,EAAE,EAEL75B,YAAU,IAAM,CACd,GAAI,CAACk+B,GAAsB,OAC3B,MAAMwC,EAAQ,WAAW,IAAM,CAC7BxmB,GAAA,EAA4B,MAAM6N,GAAO,CACnC8R,GAAA,GAAY,QAAQ,KAAK,yCAA0C9R,CAAG,CAC5E,CAAC,CACH,EAAG,GAAI,EACP,MAAO,IAAM,aAAa2Y,CAAK,CACjC,EAAG,CAACxC,EAAoB,CAAC,EAEzBl+B,YAAU,IAAM,CACd,GAAI,CAACk+B,GAAsB,OAC3B,MAAMwC,EAAQ,WAAW,IAAM,CAC7B,QAAQ,IAAI,CACVpH,GAAA,EAAqB,MAAMvR,GAAO,CAC5B8R,GAAA,GAAY,QAAQ,KAAK,0CAA2C9R,CAAG,CAC7E,CAAC,EACDzL,GAAA,EAAiB,MAAMyL,GAAO,CACxB8R,GAAA,GAAY,QAAQ,KAAK,sCAAuC9R,CAAG,CACzE,CAAC,EACDwR,GAAA,EAAoB,MAAMxR,GAAO,CAC3B8R,GAAA,GAAY,QAAQ,KAAK,yCAA0C9R,CAAG,CAC5E,CAAC,EACF,EAAE,MAAM,IAAM,CAEf,CAAC,CACH,EAAG,IAAI,EACP,MAAO,IAAM,aAAa2Y,CAAK,CACjC,EAAG,CAACxC,EAAoB,CAAC,EAGzBr1B,GAAS5K,GAAS,CAChB,GAAIA,EAAM,OAAS,wBAAyB,CACtC47B,MACF,QAAQ,IAAI,2BAA4B57B,EAAM,OAAO,EAGvD,KAAM,CAAE,OAAA0U,EAAQ,IAAA6wB,EAAK,QAAA3nB,GAAY5d,EAAM,SAAW,GAClDw7B,GAAA,EACG,KAAKgK,GAAY,CAChBA,EAAS,CACP,YAAa9wB,EACb,SAAU6wB,EACV,aAAc3nB,CAAA,CACf,CACH,CAAC,EACA,MAAM,IAAM,CAEb,CAAC,CACL,CAkBA,GAfI5d,EAAM,KAAK,WAAW,eAAe,GAEvCy7B,GAAA,EACG,KAAKgK,GAAS,CACb,MAAMC,EAAkBD,EAAA,EACpBC,EAAgB,OAAS,GAAK9J,GAAA,GAChC,QAAQ,IAAI,kCAAmC8J,CAAe,CAElE,CAAC,EACA,MAAM,IAAM,CAEb,CAAC,EAID1lC,EAAM,OAAS,mBAAoB,CACrC,KAAM,CAAE,KAAA+V,EAAM,MAAAhY,GAAUiC,EAAM,SAAW,GACzC,QAAQ,MAAM,uCAAwC+V,EAAMhY,CAAK,EACjEskC,GAAgB,CACd,QAAS,uBAAuBtsB,CAAI,UAAUhY,GAAS,eAAe,GACtE,QAAS,QACV,CACH,CAGA,GAAIiC,EAAM,OAAS,uBAAwB,CACzC,KAAM,CAAE,KAAA+V,GAAS/V,EAAM,SAAW,EAKpC,CACF,CAAC,EAID+B,YAAU,IAAM,CACd,GAAI,OAAO,OAAW,IAAa,OACnC,GAAIigC,IAAWE,GAAmB,CAChC,QAAQ,IACN,2CACAF,GACA,qBACAE,EAAA,EAEF,MACF,CAEA,QAAQ,IAAI,oDAAqD,CAC/D,YAAazO,GAAkB,cAC/B,kBAAAmM,EAAA,CACD,EAED,MAAM6C,EAAQ,WAAW,IAAM,CACzB,CAAChP,GAAkB,eAAiB,CAACmM,IACvC,QAAQ,IAAI,mCAAmC,EAC/C9L,EAAA,GAEA,QAAQ,IACN,mDACAL,GAAkB,cAClB,WACAmM,EAAA,CAGN,EAAG,IAAI,EACP,MAAO,IAAM,aAAa6C,CAAK,CACjC,EAAG,CAAC7C,GAAmB9L,EAAiBkO,GAASE,EAAiB,CAAC,EAGnEngC,YAAU,IAAM,CACd,GAAIgU,KAAS,UAAY,CAAC5Q,GAAW,IAAK,OAgB1C,MAAMs9B,EAAQ,WAdS,SAAY,CACjC,GAAI,CACF,MAAMlgC,EAAM4C,EAAU,IACtB,GAAI,CAAC5C,EAAK,OACV,MAAMtB,EAAS,MAAMusB,GAAkBjrB,EAAK,QAAQ,CAItD,MAAQ,CAER,CACF,EAGyC,GAAI,EAC7C,MAAO,IAAM,aAAakgC,CAAK,CACjC,EAAG,CAACt9B,GAAW,IAAK4Q,EAAI,CAAC,EAEzBhU,YAAU,IAAM,CACd,GAAI,CAAC6/B,GAAiB,CACpBT,GAAkB,IAAI,EACtB,MACF,CAEA,GAAIS,GAAgB,WAAa,EAAG,CAClCT,GAAkB,IAAI,EACtBE,GAAoB,EAAI,EACxB,MACF,CACIH,IAAkBA,GAAe,YAAcU,GAAgB,YAGnET,GAAkB,CAChB,UAAWS,GAAgB,UAC3B,YAAa,EACb,SAAUA,GAAgB,SAC3B,EACDP,GAAoB,EAAK,EAC3B,EAAG,CAACO,GAAiBV,EAAc,CAAC,EAGpCn/B,YAAU,IAAM,CACd,GAAI,CAACm/B,IAAkBE,GAAkB,OACzC,MAAMqB,EAAQ,WAAW,IAAM,CAC7BpB,GAAoB,EAAI,CAC1B,EAAG,GAAK,EACR,MAAO,IAAM,aAAaoB,CAAK,CACjC,EAAG,CAACvB,GAAgBE,EAAgB,CAAC,EAErCr/B,YAAU,IAAM,CACd,GAAI,CAACqgC,GAAc,OACnB,MAAMr+B,EAAY,OAAO,WAAW,IAAM,CACxCs+B,GAAgB,IAAI,CACtB,EAAG,GAAI,EACP,MAAO,IAAM,CACX,OAAO,aAAat+B,CAAS,CAC/B,CACF,EAAG,CAACq+B,EAAY,CAAC,EAGjBuD,GACE,sBACAC,GAAW,CACTrI,EAAqBqI,CAAO,CAC9B,EACA,EAAC,EAIHD,GACE,wBACA9nC,GAAW,CACT,GAAI,CAACA,GAAW,CAACA,EAAQ,IAAM,CAACA,EAAQ,OAAQ,OAChD,MAAM+nC,EAA0B,CAC9B,GAAI/nC,EAAQ,GACZ,OAAQ,CACN,KAAMA,EAAQ,OAAO,KACrB,YAAaA,EAAQ,OAAO,YAC5B,KAAMA,EAAQ,OAAO,MAAQ,UAE/B,SAAU,MAAOgoC,GAAsB,CACrC,GAAI,CACEA,EACF,MAAM/nC,EAAI,QAAQ,QAAQD,EAAQ,EAAE,EAEpC,MAAMC,EAAI,QAAQ,OAAOD,EAAQ,EAAE,CAEvC,OAASE,EAAO,CACd,QAAQ,MAAM,6BAA8BA,CAAK,CACnD,SACE0/B,EAAkB,IAAI,CACxB,CACF,GAEFA,EAAkBmI,CAAO,CAC3B,EACA,EAAC,EAIH7jC,YAAU,IAAM,CACd,MAAM+jC,EAAoBv8B,GAAkC,CAC1Do0B,EAAgBp0B,EAAK,UAAU,CACjC,EAQA,OALoB4C,GAAU,GAC5B,yBACA25B,CAAA,CAIJ,EAAG,EAAE,EAGL/jC,YAAU,IAAM,CACd,MAAM2H,EAAiBxK,GAAqB,CAE1C,MAAM6mC,EADQ,UAAU,SAAS,cAAc,QAAQ,KAAK,GAAK,EACxC7mC,EAAE,QAAUA,EAAE,QAEvC,GAAIA,EAAE,MAAQ,MAAO,CACnBA,EAAE,iBACGpB,EAAI,cAAc,mBACvB,MACF,CAIA,GAAIioC,GAAY,CAAC7mC,EAAE,UAAY,CAACA,EAAE,QAAUA,EAAE,IAAI,gBAAkB,IAAK,CAGvE,MAAMmI,EAASnI,EAAE,OAIjB,GAFEmI,GAAQ,aAAa,oBAAoB,GACzCA,GAAQ,QAAQ,6BAA6B,EAC1B,CACnBnI,EAAE,iBACFi+B,EAAsB,EAAI,EAC1B,MACF,CAEA,MACF,CAGA,GAAI4I,GAAY7mC,EAAE,UAAY,CAACA,EAAE,QAAUA,EAAE,IAAI,gBAAkB,IAAK,CACtEA,EAAE,iBACFi+B,EAAsB,EAAI,EAC1B,MACF,CAGA,GAAI,EAAA4I,GAAY,CAAC7mC,EAAE,UAAY,CAACA,EAAE,QAAUA,EAAE,IAAI,gBAAkB,KAMpE,IAAI6mC,GAAY,CAAC7mC,EAAE,UAAY,CAACA,EAAE,QAAUA,EAAE,IAAI,gBAAkB,IAAK,CACvEA,EAAE,iBACFpB,EAAI,KAAK,OAAO,aAAa,EAAE,MAAMC,GAAS,CACxC69B,MACF,QAAQ,MAAM,mCAAoC79B,CAAK,CAE3D,CAAC,EACD,MACF,CAGA,GAAIgoC,GAAY,CAAC7mC,EAAE,UAAY,CAACA,EAAE,QAAUA,EAAE,IAAI,gBAAkB,IAAK,CACvEA,EAAE,iBACF,MAAMX,EAAQD,EAAa,WAC3B,GAAIC,EAAM,SAAU,CAClB,MAAMmE,EAAMnE,EAAM,KAAK,QAAUG,EAAE,KAAOH,EAAM,QAAQ,EACpDmE,GACFnE,EAAM,kBAAkBmE,CAAG,EAE7B5E,EAAI,KAAK,MAAM,CAAE,GAAIS,EAAM,SAAU,EAAE,MAAMR,GAAS,CAChD69B,MACF,QAAQ,MAAM,kCAAmC79B,CAAK,CAE1D,CAAC,CACH,CACA,MACF,CAGA,GAAIgoC,GAAY7mC,EAAE,UAAY,CAACA,EAAE,QAAUA,EAAE,IAAI,gBAAkB,IAAK,CACtEA,EAAE,iBACGo1B,GAAA,EACL,MACF,CAGA,GAAIyR,GAAY7mC,EAAE,UAAY,CAACA,EAAE,QAAUA,EAAE,IAAI,gBAAkB,IAAK,CACtEA,EAAE,iBACF+9B,EAAkBtzB,GAAQ,CAACA,CAAI,EAC/B,MACF,CAGA,GAAIo8B,GAAY7mC,EAAE,UAAY,CAACA,EAAE,QAAUA,EAAE,IAAI,gBAAkB,IAAK,CACtEA,EAAE,iBACF2+B,EAAqB,CAACD,CAAiB,EACvC,MACF,CAGA,GAAImI,GAAY7mC,EAAE,UAAY,CAACA,EAAE,QAAUA,EAAE,IAAI,gBAAkB,IAAK,CACtEA,EAAE,iBACFulC,GAAoB,CAACD,EAAgB,EACrC,MACF,CAGA,GAAIuB,GAAY7mC,EAAE,UAAY,CAACA,EAAE,QAAUA,EAAE,IAAI,gBAAkB,IAAK,CACtEA,EAAE,iBACFm+B,EAAwB,CAACD,CAAoB,EAC7C,MACF,CAGA,GAAI2I,GAAY7mC,EAAE,UAAY,CAACA,EAAE,QAAUA,EAAE,IAAI,gBAAkB,IAAK,CACtEA,EAAE,iBACEZ,EAAa,WAAW,UAC1B+gC,EAAiB,EAAI,EAEvB,MACF,CAGA,GAAI0G,GAAY7mC,EAAE,QAAUA,EAAE,IAAI,gBAAkB,IAAK,CACvDA,EAAE,iBAEoB,SAAS,cAAc,uBAAuB,GACrD,QACf,MACF,CAGA,GAAI6mC,GAAY7mC,EAAE,QAAUA,EAAE,IAAI,gBAAkB,IAAK,CACvDA,EAAE,iBAEoB,SAAS,cAAc,uBAAuB,GACrD,QACf,MACF,CAGA,GAAI,EAAA6mC,GAAY,CAAC7mC,EAAE,UAAY,CAACA,EAAE,QAAUA,EAAE,IAAI,gBAAkB,KAKpE,IAAI6mC,GAAY,CAAC7mC,EAAE,QAAUA,EAAE,MAAQ,MAAO,CAC9BykC,GAASzkC,EAAE,SAAW,GAAK,CAAC,GAExCA,EAAE,iBAEJ,MACF,CAGA,GAAI6mC,GAAY,CAAC7mC,EAAE,QAAU,CAACA,EAAE,SAAU,CACxC,MAAM8mC,EAAQ,OAAO9mC,EAAE,GAAG,EAC1B,GAAI,CAAC,OAAO,MAAM8mC,CAAK,GAAKA,GAAS,GAAKA,GAAS,EAAG,CACpD9mC,EAAE,iBACE8mC,IAAU,EACZhC,GAAe,EAAG,EAAI,EAEtBA,GAAegC,EAAQ,CAAC,EAE1B,MACF,CACF,CAOA,GAAI9mC,EAAE,MAAQ,SAAU,CAClBkgC,EACFC,EAAiB,EAAK,EACbnC,EACTC,EAAsB,EAAK,EAClBG,EACTC,EAAqB,IAAI,EAChBC,EACTC,EAAkB,IAAI,EACbT,EACTC,EAAkB,EAAK,EACdW,GACTC,EAAqB,EAAK,EAE5B,MACF,GACF,EAEA,cAAO,iBAAiB,UAAWn0B,CAAa,EACzC,IAAM,OAAO,oBAAoB,UAAWA,CAAa,CAClE,EAAG,CACDwzB,EACAI,EACAE,EACAR,EACAoC,EACAxB,EACA+F,GACAK,EAAA,CACD,EAGDjiC,YAAU,IAAM,CACd,OAAO,cACL,IAAI,YAAY,wBAAyB,CAAE,OAAQ,CAAE,KAAM67B,EAAkB,CAAG,GAGlF,MAAMqI,EAA6BjmC,GAAuB,CACxD,KAAM,CAAE,KAAA2I,GAAS3I,EAAM,OACnB2I,IAASi1B,GACXC,EAAqBl1B,CAAI,CAE7B,EAEA,cAAO,iBAAiB,wBAAyBs9B,CAA0C,EACpF,IAAM,CACX,OAAO,oBACL,wBACAA,CAAA,CAEJ,CACF,EAAG,CAACrI,EAAmBC,CAAoB,CAAC,EAE5C,MAAMqI,GAAwB,MAAOC,GAAiC,CACpE,GAAI,CAAChhC,GAAW,IAAK,CACnBk6B,EAAiB,EAAK,EACtB,MACF,CACA,GAAI,CACF,MAAMplB,EAAW,MAAMnc,EAAI,SAAS,SAASqH,EAAU,GAAG,EACpDihC,EAAQnsB,GAAU,OAAS,GAC3BosB,EAAa,MAAM,QAAQpsB,GAAU,UAAU,EAAIA,EAAS,WAAa,GAC/E,MAAMnc,EAAI,SAAS,UAAUqH,EAAU,IAAKihC,EAAO,CAAC,GAAGC,EAAYF,CAAS,CAAC,EAC7Eh6B,GAAU,KAAK,2BAA4B,CAAE,IAAKhH,EAAU,IAAK,UAAAghC,EAAW,CAC9E,OAASpoC,EAAO,CACd,QAAQ,MAAM,4BAA6BA,CAAK,CAClD,SACEshC,EAAiB,EAAK,CACxB,CACF,EAqCA,eAAQ,IACN,kCACA2C,GACA,qBACAE,GACA,qBACAtC,EAAA,EAIA7gC,OAAC,OACC,UAAU,qEACV,MAAO,CAAE,OAAQ,gDACjB,iBAAe,OAGf,UAAAA,OAAC,OACC,IAAKghC,EACL,kBAAe,GACf,UAAU,4DAGT,WAACrC,GACA1+B,MAACsnC,WAAA,CAAS,eAAW,OAAI,MAAO,CAAE,OAAQ,OAAQ,gBAAiB,UAAU,CAAG,EAC9E,SAAAtnC,MAAC88B,GAAA,CACC,cAAc,SACd,SACE98B,MAAC,OACC,MAAO,CACL,OAAQ,OACR,gBAAiB,UACjB,QAAS,MACT,MAAO,UACP,QAAS,OACT,WAAY,SACZ,SAAU,QAGZ,SAAAA,MAAC,QAAK,iCAAqB,IAK9B,SAAA6F,KAAgB,YAAcA,KAAgB,SAC7C7F,MAACg9B,GAAA,CACC,eAAgB,GAChB,iBAAkB,GAClB,WAAY7W,GAAU,KAAK,QAAUzmB,EAAE,KAAOymB,GAAU,QAAQ,GAAG,IACnE,aAAc,MAAOpP,GAAiB,CAQpC,MAAMwwB,EAN2D,CAC/D,OAAQ,SACR,SAAU,WACV,MAAO,QACP,IAAK,UAEoBxwB,CAAI,GAAK,SAC9BlR,EAAcC,EAAY,WAAW,KAC3C,GAAIyhC,IAAe1hC,EAAa,CAE9B,GAAI,CACF,KAAM,CAAE,IAAA/G,GAAQ,MAAAslB,EAAA,oBAAAC,CAAA,OAAM,QAAO,uBAAqB,OAAAhX,KAAA,cAAAgX,CAAA,qCAGlD,MAAOvlB,EAAY,OAAO,gBAAiB,CACzC,MAAO,QAAQyoC,CAAU,QACzB,KAAMxwB,EAAK,aAAY,CACxB,EAGGwwB,IAAe,QACjB,MAAOzoC,EAAY,OAAO,eAAgB,CACxC,IAAK,4DACL,KAAM,QACP,EACQyoC,IAAe,YACxB,MAAOzoC,EAAY,OAAO,eAAgB,CACxC,IAAK,yBACL,KAAM,WACP,CAEL,OAASC,EAAO,CACd,QAAQ,KAAK,+BAAgCA,CAAK,CACpD,CACA,MAAMiY,EAAQuwB,CAAU,CAC1B,CACF,EACA,mBAAoB,MAAMroC,GAAS,CAEjC,GAAI,CACF,MAAMiH,EAAYggB,GAAU,KAAK,SAAUzmB,GAAE,KAAOymB,GAAU,QAAQ,EAChEqhB,EAAerhC,GAAW,MAAQ,eAAiB,CAACA,GAAW,IAG/D,CAAE,4BAAAvB,CAAA,EAAgC,MAAAwf,EAAA,4CAAAxf,IAAA,KAAM,QAAO,wBAAkB,OAAAyI,OAAA,sCAAAzI,EAAA,6DACjEmhB,EAAW7hB,GAAiB,WAC5BD,EAAW8hB,EAAS,UAAY,OAChCC,EAAeD,EAAS,cAAgB,SAG9C,IAAIE,EAA6D,SAE/DD,IAAiB,cACjBA,IAAiB,QACjBA,IAAiB,QAEjBC,EAAiBD,GACRA,IAAiB,OAASA,IAAiB,UACpDC,EAAiB,UAInB,MAAMthB,EAAYC,EAChB1F,EACA+mB,EACAhiB,IAAa,OAASA,EAAW,QAG/BujC,GAAgBrhC,EAClB,MAAMrH,EAAI,KAAK,SAASqH,EAAU,GAAIxB,CAAS,EAE/C,MAAM7F,EAAI,KAAK,OAAO6F,CAAS,CAEnC,OAAS5F,EAAO,CACd,QAAQ,MAAM,+BAAgCA,CAAK,EACnDwlB,EAAM,MAAM,oBAAoB,CAClC,CACF,GACF,GAGN,EAGDic,IACCzgC,OAAC,OAAI,UAAU,mIACb,UAAAA,OAAC,OAAI,UAAU,0BACb,gBAAC4M,GAAA,CAAc,KAAM,GAAI,UAAU,+BAA+B,EAClE3M,MAAC,QAAK,wFAEN,GACF,EACC0gC,IACC1gC,MAAC,UACC,KAAK,SACL,QAAS,IAAM,CACU,SAAS,cAC9B,2BAEc,OAClB,EACA,UAAU,uMAEV,SAAAA,MAAC,QAAK,wBAAY,GACpB,EAEJ,EAID,CAAC0+B,GACA3+B,OAAAyP,WAAA,CAIG,UAAA3J,KAAgB,YAAcA,KAAgB,SAC7C7F,MAACsnC,WAAA,CAAS,SAAU,KAClB,eAACxK,GAAA,CAAc,cAAc,WAC3B,SAAA98B,MAAC,OAAI,UAAU,uBAAuB,MAAO,CAAE,cAAe,QAC5D,SAAAA,MAACi9B,GAAA,EAAS,EACZ,EACF,EACF,EAEDgJ,IAAkB,CAACvD,IAClB3iC,OAAC,OAAI,UAAU,+EACb,UAAAA,OAAC,UACC,KAAK,SACL,QAAS,IAAM4iC,GAAmB,EAAI,EACtC,UAAU,+KAEV,UAAA3iC,MAACynC,GAAA,CAAc,KAAM,GAAI,EACzBznC,MAAC,QAAK,2BAAe,KAEvBD,OAAC,UACC,KAAK,SACL,QAAS,IAAMk+B,EAAkB,EAAI,EACrC,UAAU,+KAEV,UAAAj+B,MAAC0nC,GAAA,CAAe,KAAM,GAAI,EAC1B1nC,MAAC,QAAK,yBAAa,IACrB,EACF,GAEJ,KAKJD,OAAC,OAAI,UAAU,0DAEb,UAAAC,MAAC,OAAI,UAAU,+DAEZ,YACCD,OAAC,OAAI,UAAU,2DAGb,UAAAC,MAAC,OACC,UAAU,sFACV,MAAO,CAAE,OAAQ,EAAG,SAAU,YAG7B,SAAAgE,KACChE,MAAC2G,GAAA,CAAiB,KAAMwf,GAAU,KAAM,YAAaA,GAAU,SAAU,EAEzEnmB,MAACyD,GAAA,CAAkB,IAAK0C,EAAW,cAAAxC,GAA8B,IAGpEuiC,IACCnmC,OAAAyP,WAAA,CACE,UAAAxP,MAAC,OACC,YAAammC,GACb,UAAU,uIAEV,SAAAnmC,MAAC,OAAI,UAAU,4CAA4C,UAE5D,OAAI,UAAU,uHACb,eAAC,OAAI,UAAU,iCACb,eAAC2nC,GAAA,EAAO,EACV,EACF,GACF,GAEJ,EAEA3nC,MAAC,OACC,UAAW,uDAAuD0+B,EAAe,mBAAqB,EAAE,GAGxG,SAAA1+B,MAAC,OACC,UAAW,4CAA4C2D,GAAgB,kBAAoB,EAAE,GAE7F,eAACgkC,GAAA,EAAO,GACV,GAGN,EAGC,CAACjJ,GAAgBgE,IAAmB1E,SAClCsJ,WAAA,CAAS,SAAU,KAClB,SAAAtnC,MAAC88B,GAAA,CAAc,cAAc,aAC3B,SAAA98B,MAAC,OACC,UAAU,sFACV,eAAY,GAEZ,SAAAA,MAACk9B,IAAW,KAAMc,EAAgB,QAAS,IAAMC,EAAkB,EAAK,EAAG,GAC7E,CACF,EACF,GAEJ,EAGAj+B,MAAC,OACC,IAAKghC,GACL,GAAG,YACH,UAAU,+FACV,MAAO,CACL,UAAW,+BACX,WAAY,qEAGb,UAACtC,GAAgB74B,KAAgB,gBAC/ByhC,WAAA,CAAS,SAAU,KAClB,SAAAtnC,MAAC88B,IAAc,cAAc,eAC3B,SAAA98B,MAACm9B,GAAA,EAAa,EAChB,EACF,IAIH,CAACuB,GAAgB,CAACgE,IAAmBuD,IACpCjmC,MAACo5B,GAAA,CACC,WAAYvzB,GACZ,aAAcmR,EACd,cAAe,IAAMqnB,EAAwB,EAAI,EACjD,YAAa,IAAMJ,EAAkB,EAAI,IAK7Cj+B,MAACsnC,WAAA,CAAS,SAAU,KAClB,eAACM,GAAA,CACC,SAAA5nC,MAAC88B,GAAA,CAAc,cAAc,eAC3B,SAAA98B,MAACs9B,GAAA,EAAa,EAChB,EACF,EACF,EAEAt9B,MAACsnC,YAAS,SAAU,KAClB,eAACM,GAAA,CACC,SAAA5nC,MAAC88B,GAAA,CAAc,cAAc,iBAC3B,SAAA98B,MAACy9B,GAAA,CACC,OAAQ2C,EACR,SAAU,IAAMC,EAAiB,EAAK,EACtC,kBAAmB6G,EAAA,EACrB,CACF,EACF,EACF,EAEAlnC,MAACsnC,YAAS,SAAU,KAClB,eAACM,GAAA,CACC,SAAA5nC,MAAC88B,GAAA,CAAc,cAAc,gBAC3B,SAAA98B,MAAC09B,GAAA,CACC,OAAQ4C,EACR,QAAS,IAAMC,EAAgB,EAAK,EACpC,MAAOpa,GAAU,SACjB,IAAKhgB,GAAW,KAClB,CACF,EACF,EACF,EAEC06B,GACC7gC,MAAC4nC,GAAA,CACC,eAAC,OAAI,UAAU,4EACb,SAAA7nC,OAAC,OAAI,UAAU,0IACb,gBAAC,OAAI,UAAU,4DAA4D,qBAE3E,QACC,OAAI,UAAU,6CAA6C,sCAE5D,QACC,OAAI,UAAU,kCAAkC,uDAEjD,GACF,EACF,EACF,EAGFC,MAACsnC,WAAA,CAAS,SAAU,KAClB,eAACM,GAAA,CACC,SAAA5nC,MAAC88B,GAAA,CAAc,cAAc,kBAC3B,SAAA98B,MAAC29B,GAAA,EAAgB,EACnB,EACF,EACF,EAGC,CAACe,GACA1+B,MAACsnC,WAAA,CAAS,SAAU,KAGpB,EAGD9C,IACCxkC,MAACsnC,WAAA,CAAS,SAAU,KAClB,SAAAtnC,MAAC4nC,GAAA,CACC,SAAA5nC,MAAC88B,GAAA,CAAc,cAAc,mBAC3B,SAAA98B,MAAC49B,GAAA,EAAiB,EACpB,EACF,EACF,EAGD6G,IACCzkC,MAACsnC,WAAA,CAAS,SAAU,KAClB,SAAAtnC,MAAC4nC,GAAA,CACC,SAAA5nC,MAAC88B,GAAA,CAAc,cAAc,uBAC3B,SAAA98B,MAAC69B,GAAA,EAAqB,EACxB,EACF,EACF,EAID+C,IAAqB,CAACoC,IAAW,CAACE,IACjCljC,MAACsnC,WAAA,CAAS,SAAU,KAClB,SAAAtnC,MAAC4nC,GAAA,CACC,SAAA5nC,MAAC88B,GAAA,CAAc,cAAc,eAC3B,SAAA98B,MAAC89B,GAAA,CACC,QAAS,IAAM,CAGf,GACF,CACF,EACF,EACF,EAIDI,SACEoJ,WAAA,CAAS,SAAU,KAClB,SAAAtnC,MAAC4nC,GAAA,CACC,eAAC9K,GAAA,CAAc,cAAc,iBAC3B,SAAA98B,MAAC8sB,GAAA,CAAe,QAAS,IAAMqR,EAAsB,EAAK,EAAG,EAC/D,EACF,EACF,EAGDG,GACCt+B,MAACsnC,WAAA,CAAS,SAAU,KAClB,eAACM,GAAA,CACC,SAAA5nC,MAAC88B,GAAA,CAAc,cAAc,mBAC3B,SAAA98B,MAACo9B,GAAA,CACC,QAASkB,EACT,QAAS,IAAMC,EAAqB,IAAI,GAC1C,CACF,EACF,EACF,EAGDC,SACE8I,WAAA,CAAS,SAAU,KAClB,SAAAtnC,MAAC4nC,GAAA,CACC,SAAA5nC,MAAC88B,GAAA,CAAc,cAAc,gBAC3B,eAACO,GAAA,CAAc,QAASmB,EAAgB,QAAS,IAAMC,EAAkB,IAAI,EAAG,EAClF,EACF,EACF,EAGDzxB,GACChN,MAACiM,GAAA,CACC,MAAOe,EAAW,MAClB,OAAQA,EAAW,OACnB,SAAUA,EAAW,SACrB,QAAS,IAAMC,GAAc,IAAI,EACjC,SAAUT,EAAA,GAKb3G,KAAgB,YACf7F,MAAC4W,GAAA,CACC,KAAMgoB,EACN,QAAS,IAAM,CACbC,EAAqB,EAAK,EAE1B,OAAO,cACL,IAAI,YAAY,wBAAyB,CAAE,OAAQ,CAAE,KAAM,GAAM,CAAG,EAExE,EACA,eAAgB,IAAM,CAEtB,IAIHh5B,KAAgB,SACf7F,MAACywB,GAAA,CAAa,KAAM6U,GAAkB,QAAS,IAAMC,GAAoB,EAAK,EAAG,EAIlF,CAAC7G,GAAgBgE,IAAmB8C,UAClC8B,WAAA,CAAS,SAAU,KAClB,SAAAtnC,MAAC88B,IAAc,cAAc,eAC3B,SAAA98B,MAACw9B,GAAA,EAAoB,EACvB,EACF,EAID8B,GAAS3C,IACR38B,MAACsnC,WAAA,CAAS,SAAU,KAClB,SAAAtnC,MAAC28B,GAAA,CAAgB,KAAMmC,EAAgB,QAAS,IAAMC,EAAkB,EAAK,EAAG,EAClF,QAED3gB,GAAA,EAAoB,QACpB8B,GAAA,EAAiB,QACjB,OAAI,UAAU,yEACb,SAAAlgB,MAACghB,KAAc,EACjB,EAKCoiB,IACCpjC,MAAC4nC,GAAA,CACC,eAAC,OAAI,UAAU,8BACb,SAAA5nC,MAAC,OACC,UAAW,iEACTojC,GAAa,UAAY,UACrB,2DACA,oDACN,GAEC,SAAAA,GAAa,SAChB,CACF,EACF,EAIDJ,UAAYhR,GAAA,CAAgB,SAAUsR,GAAiB,UAAWC,GAAkB,EAGpFL,IAAqB,CAACF,IAAW,CAACpC,IACjC5gC,MAACkzB,GAAA,CACC,SAAUE,GAAe,CACvB,QAAQ,IAAI,sCAAuCA,CAAW,EAC9D,aAAa,QAAQ,uBAAwB,KAAK,UAAUA,CAAW,CAAC,EAExE,WAAW,IAAM,CACf+P,GAAqB,EAAK,EAC1B,QAAQ,IAAI,qEAAqE,EAGjF,QAAQ,IAAI,yCAA0C,CACpD,QAAAH,GACA,kBAAmB,GACnB,aAAA5O,GACA,kBAAAwM,EAAA,CACD,CACH,EAAG,GAAG,CACR,EACA,UAAW,IAAM,CACf,QAAQ,IAAI,oCAAoC,EAEhD,MAAM/M,EAA6B,CACjC,UAAW,GACX,UAAW,GACX,WAAY,GACZ,YAAa,GACb,UAAW,KAAK,MAChB,QAAS,cAEX,aAAa,QAAQ,uBAAwB,KAAK,UAAUA,CAAO,CAAC,EACpE,WAAW,IAAM,CACfsP,GAAqB,EAAK,EAC1B,QAAQ,IAAI,qEAAqE,CACnF,EAAG,GAAG,CACR,UAGHnO,GAAA,EAAU,QAGVsS,WAAA,CAAS,SAAU,KAClB,SAAAtnC,MAAC68B,KAAoB,EACvB,EAGA78B,MAACk3B,IAAgB,KAAM8H,EAAqB,QAAS,IAAMC,EAAuB,EAAK,EAAG,EAG1Fj/B,MAAC+3B,GAAA,CACC,KAAMmH,EACN,QAAS,IAAMC,EAA2B,EAAK,UAGhD31B,GAAA,EAAa,QACboe,GAAA,EAAS,QACT0E,GAAA,EAAiB,QAGjBvK,GAAA,CAAY,QAAS,CAACpe,IAAiBsiC,GAAgB,EAGvD,CAACvH,GAAgBgE,IAChB1iC,MAAC2pB,GAAA,CACC,KAAMyU,EACN,QAAS,IAAMC,EAAwB,EAAK,UAK/CtT,GAAA,EAAW,QAGX8c,GAAA,EAAoB,EAMpBhiC,KAAgB,UAAY7F,MAACgtB,GAAA,EAAqB,EAGlDoS,GACCp/B,MAACm7B,GAAA,CACC,WAAY,SAAY,CACtB,KAAM,CAAE,kBAAA2M,CAAA,EAAsB,MAAA1jB,EAAA,kCAAA0jB,CAAA,OAAM,QAAO,2BAAkC,2BAAAA,CAAA,wCAC7EA,EAAA,EACAzI,EAAiB,EAAK,EACtB9a,EAAM,QAAQ,yCAAyC,CACzD,EACA,QAASxlB,GAAS,CAChB,QAAQ,MAAM,8BAA+BA,CAAK,EAClDwlB,EAAM,MACJ,iBAAiBxlB,EAAM,OAAO,oDAGlC,GACF,GAIR","names":["useTabGraphStore","create","set","get","payload","ipc","error","tabId","NewTabPage","query","setQuery","useState","activeId","useTabsStore","state","tabs","activeTabData","t","handleSearch","searchQuery","urlToNavigate","searchUrl","jsxs","jsx","motion","e","Sparkles","throttleViewUpdate","throttle","callback","debounceResize","debounce","IframeManager","__publicField","id","iframe","options","observer","handler","event","rect","allowedOrigins","message","targetOrigin","iframeManagerInstance","getIframeManager","OptimizedViewRenderer","rendererInstance","getViewRenderer","PerformanceMonitor","label","startTime","duration","times","a","b","result","monitorInstance","getPerformanceMonitor","useOptimizedView","iframeId","lazy","sandbox","onResize","onMessage","iframeRef","useRef","renderer","useMemo","monitor","useEffect","iframeManager","queueUpdate","useCallback","endTiming","handleResize","INTERNAL_PROTOCOLS","isInternalUrl","url","prefix","TabContentSurface","tab","overlayActive","containerRef","isElectron","isElectronRuntime","isTauri","isTauriRuntime","language","useSettingsStore","loading","setLoading","failedMessage","setFailedMessage","blockedExternal","setBlockedExternal","SAFE_IFRAME_SANDBOX","_rect","targetUrl","normalizeInputToUrlOrSearch","isMounted","LOADING_TIMEOUT_MS","timeoutId","handleLoad","handleError","errorMessage","errorTarget","isFrameBlocked","urlLower","urlObj","bingUrl","handleTabClose","launchExternal","panelId","labelledById","isInactive","currentMode","useAppStore","isBrowseMode","el","AnimatePresence","Loader2","activeTab","ExternalLink","OmniDesk","getPrivacySandboxAttributes","privacyMode","base","applyPrivacyModeToIframe","getTabIframeUrl","TabIframeManager","activeTabId","privacySettings","iframeRefs","blockedTabs","observerRefs","clickHandlerRefs","navigationHandlerRefs","setIframeRef","iframeUrl","currentSrc","isActive","interval","_iframe","clickHandler","navHandler","currentIframeUrl","currentIframe","win","doc","currentUrl","currentTitle","updates","deriveTitleFromUrl","derivedTitle","_originalOpen","target","_features","urlStr","anchor","clickedUrl","handleNavigation","newUrl","newTitle","popstateHandler","hashchangeHandler","cleanup","titleObserver","titleElement","getDocumentCommands","navigate","FileText","FileCheck","Languages","Table","GlobalSearch","results","setResults","open","setOpen","selectedIndex","setSelectedIndex","inputRef","setActive","useNavigate","docCommands","performSearch","allResults","queryLower","cmd","data","multiSearch","hit","handleKeyDown","prev","handleResultClick","existingTab","getResultIcon","Icon","Globe","BookOpen","BarChart3","Search","getResultTitle","X","index","Clock","handleIframeBlocked","invoke","extError","setupIframeBlockedListener","useRedix","eventType","handlerRef","actualHandler","Redix","CrashRecoveryDialog","_tabId","reason","exitCode","onClose","onReload","snapshots","handleReload","handleRestoreSnapshot","_snapshotId","AlertTriangle","RefreshCw","snapshot","RotateCcw","useCrashRecovery","crashedTab","setCrashedTab","handleCrash","ipcEvents","getSpacing","n","useTokens","skeletonBase","skeletonAnimation","variantStyles","Skeleton","React","variant","width","height","animate","className","style","props","ref","variantClass","customStyle","motionProps","cn","SkeletonList","items","_","i","toneClassMap","sizeClassMap","Button","forwardRef","tone","size","icon","trailingIcon","fullWidth","disabled","children","isDisabled","Fragment","IconButton","iconSize","FAB","position","fixed","positionClasses","Input","leadingIcon","TextArea","MEMORY_TYPES","Bookmark","CheckSquare","CreateMemoryDialog","onCreated","initialType","initialUrl","initialTitle","tokens","type","setType","title","setTitle","setUrl","content","setContent","tags","setTags","tagInput","setTagInput","priority","setPriority","dueDate","setDueDate","handleAddTag","trimmed","handleRemoveTag","tagToRemove","handleTagInputKeyDown","handleSubmit","eventId","showToast","trackNote","bookmarkMetadata","trackBookmark","taskMetadata","trackTask","handleClose","selectedTypeInfo","typeOption","Link","Tag","Plus","tag","exportMemoriesToJSON","events","exportData","exportMemoriesToCSV","headers","rows","date","pinned","escapeCSV","row","field","downloadFile","filename","mimeType","blob","link","exportMemories","filteredEvents","eventTags","timestamp","extension","ExportMemoriesDialog","availableTags","format","setFormat","dateRange","setDateRange","selectedTypes","setSelectedTypes","selectedTags","setSelectedTags","allEventTypes","handleToggleType","handleToggleTag","handleExport","count","filteredCount","Download","FileJson","FileSpreadsheet","Calendar","Filter","TagIcon","MemoryCard","memory","compact","onPin","onCopy","onOpen","onDelete","isPinned","typeLabel","w","typeInitial","timeStr","dateStr","handleCopy","text","handleOpen","Pin","PinOff","Copy","ResearchMemoryPanel","onCreateMemory","setSearchQuery","mode","setMode","displayMode","setDisplayMode","sortMode","setSortMode","setEvents","semanticResults","setSemanticResults","allTags","setAllTags","_focusedIndex","setFocusedIndex","createDialogOpen","setCreateDialogOpen","exportDialogOpen","setExportDialogOpen","searchInputRef","listRef","debouncedQuery","useDebounce","next","loadEvents","loaded","MemoryStoreInstance","handleMemoryCreated","superMemoryDB","semanticSearchMemories","filtered","semanticIds","r","aMatch","bMatch","handleTogglePin","_memory","handleDelete","m","List","LayoutGrid","ChevronRight","MAX_SUSPENSIONS","SUSPENSION_MAX_AGE_MS","useTabSuspensionStore","record","suspensions","suspensionEntries","toKeep","current","now","DEFAULT_OPTIONS","MemoryPool","partial","metrics","dispatch","usageByTab","sample","activeTabs","backgroundTabs","totalBudget","reserveForActive","perActiveCap","perBackgroundCap","pending","observed","targetCap","capMB","existing","memoryPool","initializeMemoryPool","configureMemoryPool","DEFAULT_POLICY","currentPolicy","suspendedTabs","heavyTabs","loadPolicy","stored","savePolicy","policy","getPolicy","suspendTab","thawTab","markTabHeavy","heavy","isTabSuspended","isTabHeavy","optimizePerformance","lastActive","initializeOptimizer","MIN_INACTIVITY_MINUTES","EVALUATION_INTERVAL","DEFAULT_CAPTURE_WIDTH","initialized","evaluateTimer","latestTabs","suspendQueue","cleanupStaleData","currentTabIds","suspensionStore","startTabSuspensionService","inactivityThresholdMs","handleTabsUpdated","cleanupResolvedSuspensions","unsubscribeTabs","unsubscribeActive","previous","resumeSuspendedTab","unsubscribeTabsStore","evaluateSuspensions","thresholdMs","list","shouldAutoSuspend","suspendTabWithSnapshot","preview","tabMap","meta","acknowledgeSuspendedTab","manuallySuspendTab","SuspensionIndicator","unacknowledged","entry","Moon","PauseCircle","formatDistanceToNow","defaultBattery","deriveEffectiveMode","battery","level","usePowerStore","persist","status","nextBattery","effectiveMode","MODE_PRESETS","unsubscribe","initPowerModes","applyEffectiveMode","setPowerMode","preset","MODE_CARDS","PowerModeSelector","selected","effective","onSelect","card","isSelected","isEffective","formatPercent","BatteryIndicator","selectedMode","selectorOpen","setSelectorOpen","BatteryCharging","Battery","levelLabel","modeLabel","Zap","useMemoryStore","history","capacity","severityColor","ratio","MemoryMonitor","latest","capacityMB","expanded","setExpanded","topTabs","sparklinePoints","max","arr","total","percent","severity","Activity","point","actions","MiniHoverAI","enabled","onAction","selectedText","setSelectedText","setPosition","isProcessing","setIsProcessing","showActions","setShowActions","handleSelection","selection","range","handleClickOutside","handleAction","actionId","chunk","action","parseWisprCommand","lowerText","originalText","tradePatterns","pattern","match","isSell","symbol","quantity","slMatch","stopLoss","city","from","to","returnDate","tabsMatch","queryMatch","executeWisprCommand","command","__vitePreload","ipc2","modeName","toast","executeTradeCommand","executeResearchCommand","executeSearchCommand","executeSummarizeCommand","executeExplainCommand","executeFillFormCommand","executeSaveProfileCommand","executeScreenshotCommand","executeOpenTabsCommand","executeNavigateCommand","executeWeatherCommand","executeTrainCommand","executeFlightCommand","resolve","orderType","takeProfit","validOrderType","tradeApi","elapsed","lang","utterance","errorMsg","useSettingsStore2","settings","searchEngine","searchProvider","_command","tabsState","aiEngine","fillAllForms","getUserProfile","profile","filledCount","saveUserProfile","forms","form","formData","key","value","lowerKey","response","parts","toParts","dateParts","departDate","captureAndAnalyze","analysis","modal","handleEscape","tabsCount","LANGUAGE_LOCALE_MAP","getSpeechRecognitionLocale","WisprOrb","listening","setListening","transcript","setTranscript","isJarvisMode","setIsJarvisMode","visionEnabled","setVisionEnabled","recogRef","wakeWords","SR","recognition","latestResult","handleCommand","word","commandText","wakeWord","screenshot","visionPrompt","visionResponse","speech","commandType","startListening","stopListening","handleKey","Mic","Brain","Eye","Star","FolderOpen","UnifiedSidePanel","defaultTab","setActiveTab","collapsed","setCollapsed","isMobile","setIsMobile","checkMobile","panelWidth","HistoryPage","BookmarksPanel","WorkspacesPanel","DownloadsPage","useSystemStatus","setStatus","isLoading","setIsLoading","setError","fetchStatus","err","CommandBar","bookmarks","useBookmarksStore","systemStatus","commands","newTab","Settings","bookmark","filteredCommands","lowerQuery","kw","track","handleCommandClick","groupedCommands","groups","categoryLabels","category","_idx","globalIndex","ArrowRight","OMNI_MODES","Code","ImageIcon","OmniModeSwitcher","isOpen","setIsOpen","_selectedMode","setSelectedMode","handleModeSelect","OmniModeKeyboardHandler","onToggle","CommandPalette","TrendingUp","SessionRestorePrompt","setSnapshot","isRestoring","setIsRestoring","checkRestore","fullSnapshot","handleRestoreAvailable","_event","_data","handleRestore","handleDismiss","tabCount","lastSaved","SENSITIVE_PATTERNS","SENSITIVE_DOMAINS","DEFAULT_CONFIG","currentConfig","checkSensitivity","hostname","score","reasons","domain","threatScan","riskLevel","autoTogglePrivacy","sensitivity","torStatus","buildHash","useSessionStore","snapshotTabs","last","hash","tabsStore","createdTabIds","saved","resolvedId","snapshotActiveIndex","resolvedActive","HISTORY_STORAGE_KEY","MAX_ENTRIES","loadInitialHistory","raw","parsed","item","persistHistory","entries","useHistoryStore","newEntry","limit","updateBottomBarHeight","bottomBar","updateTopbarHeight","topbar","updateSidebarWidth","sidebar","initLayoutSync","resizeObserver","TradeSidebar","activeSymbol","setActiveSymbol","watchlist","addToWatchlist","quotes","updateQuote","useTradeStore","newSymbol","setNewSymbol","cancelled","loadQuote","quote","fetchTradeQuote","changePositive","Shield","TrendingDown","Sparkline","positive","values","min","idx","heightPercent","TermsAcceptance","onAccept","onDecline","showFullTerms","setShowFullTerms","acceptedVersion","setAcceptedVersion","termsChecked","setTermsChecked","hasCheckedRef","handleScroll","_e","callAcceptCallback","handleAccept","acceptanceData","handleDecline","Check","COOKIE_VERSION","CookieConsent","showSettings","preferences","setPreferences","showDetails","setShowDetails","hasInteracted","setHasInteracted","handleAcceptAll","allAccepted","handleAcceptSelected","minimal","toggleCategory","cookieCategories","Cookie","Info","AlertCircle","useCookieConsent","hasConsented","setHasConsented","_showBanner","setShowBanner","STORAGE_KEY","onboardingStorage","useOnboardingStore","isCommandKey","useResearchHotkeys","setResearchPaneOpen","startOnboarding","exportSessionToFile","ToastHost","Toaster","ensureId","reopenClosedTab","newId","store","reopenMostRecentClosedTab","ALERTS_STORAGE_KEY","loadAlerts","alerts","alert","log","saveAlerts","clearExpiredAlerts","active","initTradeAlertsCron","ExtensionsAPI","plugin","pluginRegistry","ext","extensionsAPI","initExtensionsAPI","setupPreloadHook","_api","useAppError","showError","showToUser","logToConsole","context","fallback","userMessage","fullMessage","safeExecute","fn","LoopResumeModal","crashedLoops","setCrashedLoops","loops","checkForCrashedLoops","handleResume","loop","resumeLoop","runId","deleteLoopState","l","Play","SAMPLE_WORKFLOWS","WorkflowMarketplace","workflows","selectedCategory","setSelectedCategory","selectedLanguage","setSelectedLanguage","filteredWorkflows","workflow","matchesSearch","matchesCategory","matchesLanguage","handleInstall","handoffToN8n","categories","Workflow","cat","shareUrl","Share2","navItems","FlaskConical","LineChart","MobileDock","activeMode","onSelectMode","onOpenLibrary","onOpenAgent","Library","Bot","OLLAMA_URLS","REQUIRED_MODELS","checkOllamaInstalled","checkInstalledModels","getOllamaDownloadUrl","platform","downloadOllamaInstaller","onProgress","progress","downloadUrl","installOllama","installerPath","pullModel","model","reader","decoder","buffer","done","lines","line","installOllamaAndModels","retries","installedModels","modelsToPull","InstallProgressModal","onComplete","onError","setProgress","_isInstalling","setIsInstalling","prog","getStageIcon","CheckCircle2","getStageColor","isComplete","fetchRecords","filter","useConsentOverlayStore","records","consentId","optimizer","tabSuspension","initBatteryManager","initMemoryManager","powerModes","updatePolicyMetrics","getPolicyRecommendations","initNightlySummarization","RedixDebugPanel","isDevEnv","SessionRestoreModal","ErrorBoundary","errorInfo","TopBar","TabStrip","RightPanel","BottomStatus","PermissionPrompt","ConsentPrompt","AgentOverlay","RegenSidebar","RegenSidebarWrapper","ClipperOverlay","ReaderOverlay","TabGraphOverlay","ConsentDashboard","TrustEthicsDashboard","ResearchTour","AppShell","rightPanelOpen","setRightPanelOpen","commandPaletteOpen","setCommandPaletteOpen","unifiedSidePanelOpen","setUnifiedSidePanelOpen","permissionRequest","setPermissionRequest","consentRequest","setConsentRequest","isFullscreen","setIsFullscreen","memorySidebarOpen","setMemorySidebarOpen","redixDebugOpen","setRedixDebugOpen","loopResumeModalOpen","setLoopResumeModalOpen","workflowMarketplaceOpen","setWorkflowMarketplaceOpen","showInstaller","setShowInstaller","isDev","themePreference","compactUI","clearOnExit","unlisten","listen","handleNavigate","handlePostMessage","sourceTabId","startMemoryMonitoring","stopMemoryMonitoring","unloadInactiveTabs","checkFullscreen","isCurrentlyFullscreen","clipperActive","setClipperActive","readerActive","setReaderActive","isOffline","setIsOffline","ollamaAvailable","setOllamaAvailable","onboardingVisible","graphDropHint","setGraphDropHint","topChromeRef","bottomChromeRef","desktopServicesReady","handleOnline","handleOffline","unsubscribeWakeWispr","unsubscribeTradeMode","unsubscribeResearchMode","lastTop","lastBottom","updateOffsets","top","bottomMeasured","bottom","observers","attachObserver","element","updateHeaderHeight","px","restoreSummary","setRestoreSummary","restoreDismissed","setRestoreDismissed","restoreStatus","setRestoreStatus","viewportWidth","setViewportWidth","isDesktopLayout","setToolsDrawerOpen","sessionSnapshot","saveSessionSnapshot","clearSessionSnapshot","clearHistoryEntries","showTOS","setShowTOS","showCookieConsent","setShowCookieConsent","restoreToast","setRestoreToast","handleTOSAccept","handleTOSDecline","startSnapshotting","timer","handleBeforeUnload","root","media","applyPreferences","resolvedTheme","dragCounter","isGraphDrag","types","handleDragEnter","handleDragOver","handleDragLeave","handleDragEnd","handleDrop","handleCustomDragEnd","consentVisible","trustDashboardVisible","useTrustDashboardStore","cycleTab","direction","scopedTabs","currentIndex","nextIndex","jumpToTabIndex","snapToEnd","safeTabs","found","nextMode","researchPaneOpen","tradeSidebarOpen","setTradeSidebarOpen","regenSidebarOpen","setRegenSidebarOpen","_contentSplit","setContentSplit","lastTrackedUrl","trackVisit","isResizingContent","setIsResizingContent","activeTabUrl","showWebContent","shouldShowInlineToolsPanel","handleResizeStart","handlePointerMove","handlePointerUp","_err","cpu","updateFn","getFn","recommendations","useIPCEvent","request","approved","handleFullscreen","modifier","digit","handleMemorySidebarToggle","handleCreateHighlight","highlight","notes","highlights","Suspense","targetMode","isAboutBlank","PanelsTopLeft","PanelRightOpen","Outlet","Portal","QuickCommandPalette","markSetupComplete"],"ignoreList":[],"sources":["../../src/state/tabGraphStore.ts","../../src/components/Browse/NewTabPage.tsx","../../src/utils/gve-optimizer.ts","../../src/hooks/useOptimizedView.ts","../../src/components/layout/TabContentSurface.tsx","../../src/utils/privacyMode.ts","../../src/components/layout/TabIframeManager.tsx","../../src/components/command-palette/DocumentCommands.tsx","../../src/components/search/GlobalSearch.tsx","../../src/utils/iframeBlockedFallback.ts","../../src/core/redix/useRedix.ts","../../src/components/CrashRecoveryDialog.tsx","../../src/ui/useTokens.ts","../../src/ui/skeleton.tsx","../../src/ui/button.tsx","../../src/ui/input.tsx","../../src/components/research/CreateMemoryDialog.tsx","../../src/utils/export.ts","../../src/components/research/ExportMemoriesDialog.tsx","../../src/components/research/ResearchMemoryPanel.tsx","../../src/state/tabSuspensionStore.ts","../../src/core/redix/memory-pool.ts","../../src/core/redix/optimizer.ts","../../src/core/redix/tab-suspension.ts","../../src/components/redix/SuspensionIndicator.tsx","../../src/state/powerStore.ts","../../src/core/redix/power-modes.ts","../../src/components/redix/PowerModeSelector.tsx","../../src/components/redix/BatteryIndicator.tsx","../../src/state/memoryStore.ts","../../src/components/redix/MemoryMonitor.tsx","../../src/components/interaction/MiniHoverAI.tsx","../../src/core/wispr/commandHandler.ts","../../src/components/WisprOrb.tsx","../../src/components/side-panel/UnifiedSidePanel.tsx","../../src/hooks/useSystemStatus.ts","../../src/components/command-bar/CommandBar.tsx","../../src/components/omni-mode/OmniModeSwitcher.tsx","../../src/components/CommandPalette.tsx","../../src/components/SessionRestorePrompt.tsx","../../src/core/privacy/auto-toggle.ts","../../src/state/sessionStore.ts","../../src/state/historyStore.ts","../../src/utils/layoutSync.ts","../../src/components/trade/TradeSidebar.tsx","../../src/components/Onboarding/TermsAcceptance.tsx","../../src/components/Onboarding/CookieConsent.tsx","../../src/state/onboardingStore.ts","../../src/hooks/useResearchHotkeys.ts","../../src/components/common/ToastHost.tsx","../../src/lib/tabLifecycle.ts","../../src/services/tradeAlertsCron.ts","../../src/core/extensions/api.ts","../../src/hooks/useAppError.ts","../../src/components/agents/LoopResumeModal.tsx","../../src/components/workflows/WorkflowMarketplace.tsx","../../src/components/layout/MobileDock.tsx","../../src/core/installer/ollamaInstaller.ts","../../src/components/installer/InstallProgressModal.tsx","../../src/state/consentOverlayStore.ts","../../src/components/layout/AppShell.tsx"],"sourcesContent":["import { create } from 'zustand';\r\nimport { ipc } from '../lib/ipc-typed';\r\n\r\nexport type TabGraphNode = {\r\n  id: string;\r\n  title: string;\r\n  url: string;\r\n  domain: string;\r\n  containerId?: string;\r\n  containerName?: string;\r\n  containerColor?: string;\r\n  mode?: 'normal' | 'ghost' | 'private';\r\n  active: boolean;\r\n  createdAt?: number;\r\n  lastActiveAt?: number;\r\n};\r\n\r\nexport type TabGraphEdge = {\r\n  id: string;\r\n  source: string;\r\n  target: string;\r\n  weight: number;\r\n  reasons: string[];\r\n};\r\n\r\nexport type TabGraphSummary = {\r\n  totalTabs: number;\r\n  activeTabs: number;\r\n  domains: number;\r\n  containers: number;\r\n};\r\n\r\nexport type TabGraphData = {\r\n  nodes: TabGraphNode[];\r\n  edges: TabGraphEdge[];\r\n  summary: TabGraphSummary;\r\n  updatedAt: number;\r\n  clusters?: Array<{ id: string; label: string; tabIds: string[]; domain?: string; strength: number }>;\r\n};\r\n\r\ninterface TabGraphState {\r\n  visible: boolean;\r\n  loading: boolean;\r\n  error: string | null;\r\n  data: TabGraphData | null;\r\n  focusedTabId: string | null;\r\n  open: () => Promise<void>;\r\n  close: () => void;\r\n  toggle: () => Promise<void>;\r\n  refresh: () => Promise<void>;\r\n  setFocusedTab: (tabId: string | null) => void;\r\n  focusTab: (tabId: string) => Promise<void>;\r\n}\r\n\r\nexport const useTabGraphStore = create<TabGraphState>((set, get) => ({\r\n  visible: false,\r\n  loading: false,\r\n  error: null,\r\n  data: null,\r\n  focusedTabId: null,\r\n  async open() {\r\n    if (!get().visible) {\r\n      set({ visible: true });\r\n    }\r\n    await get().refresh();\r\n  },\r\n  close() {\r\n    set({ visible: false, focusedTabId: null });\r\n  },\r\n  async toggle() {\r\n    if (get().visible) {\r\n      set({ visible: false, focusedTabId: null });\r\n    } else {\r\n      set({ visible: true });\r\n      await get().refresh();\r\n    }\r\n  },\r\n  async refresh() {\r\n    set({ loading: true, error: null });\r\n    try {\r\n      const payload = await ipc.graph.tabs();\r\n      if (!payload || typeof payload !== 'object') {\r\n        throw new Error('Graph data unavailable');\r\n      }\r\n      set({ data: payload as TabGraphData, loading: false, error: null });\r\n    } catch (error) {\r\n      set({ loading: false, error: error instanceof Error ? error.message : String(error) });\r\n    }\r\n  },\r\n  setFocusedTab(tabId) {\r\n    set({ focusedTabId: tabId });\r\n  },\r\n  async focusTab(tabId) {\r\n    set({ visible: true, focusedTabId: tabId });\r\n    await get().refresh();\r\n  },\r\n}));\r\n","// Custom New Tab Page - Beautiful & Dark\nimport { useState } from 'react';\nimport { motion } from 'framer-motion';\nimport { Sparkles } from 'lucide-react';\nimport { ipc } from '../../lib/ipc-typed';\nimport { useTabsStore } from '../../state/tabsStore';\n\nexport default function NewTabPage() {\n  const [query, setQuery] = useState('');\n  const activeId = useTabsStore(state => state.activeId);\n  const tabs = useTabsStore(state => state.tabs);\n  const activeTabData = activeId ? tabs.find(t => t.id === activeId) : null;\n\n  const handleSearch = async (searchQuery: string) => {\n    if (!searchQuery.trim()) return;\n\n    // Check if it's a URL\n    const isUrl =\n      /^https?:\\/\\//i.test(searchQuery) || /^[a-zA-Z0-9-]+\\.[a-zA-Z]{2,}/.test(searchQuery);\n\n    if (isUrl) {\n      const urlToNavigate = searchQuery.startsWith('http') ? searchQuery : `https://${searchQuery}`;\n      if (activeTabData) {\n        await ipc.tabs.navigate(activeTabData.id, urlToNavigate);\n      } else {\n        await ipc.tabs.create(urlToNavigate);\n      }\n    } else {\n      // Search query - use Google or DuckDuckGo\n      const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(searchQuery)}`;\n      if (activeTabData) {\n        await ipc.tabs.navigate(activeTabData.id, searchUrl);\n      } else {\n        await ipc.tabs.create(searchUrl);\n      }\n    }\n    setQuery('');\n  };\n\n  return (\n    <div className=\"h-screen bg-gradient-to-br from-purple-950 via-black to-pink-950 text-white flex items-center justify-center overflow-hidden\">\n      <div className=\"text-center max-w-4xl w-full px-10\">\n        <motion.h1\n          initial={{ opacity: 0, scale: 0.8 }}\n          animate={{ opacity: 1, scale: 1 }}\n          className=\"text-8xl md:text-9xl font-black bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent mb-8\"\n        >\n          REGEN\n        </motion.h1>\n        <motion.p\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.2 }}\n          className=\"text-3xl md:text-4xl mt-8 text-purple-300 mb-16\"\n        >\n          The Future of Browsing\n        </motion.p>\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.4 }}\n          className=\"relative max-w-2xl mx-auto\"\n        >\n          <input\n            type=\"text\"\n            value={query}\n            onChange={e => setQuery(e.target.value)}\n            onKeyDown={e => {\n              if (e.key === 'Enter') {\n                handleSearch(query);\n              }\n            }}\n            placeholder=\"Search or ask AI anything...\"\n            className=\"w-full px-8 py-6 bg-white/10 backdrop-blur-xl rounded-full text-xl md:text-2xl placeholder-purple-400 focus:outline-none focus:ring-4 focus:ring-purple-500/50 transition-all text-white\"\n            autoFocus\n          />\n          <motion.button\n            whileHover={{ scale: 1.1 }}\n            whileTap={{ scale: 0.9 }}\n            onClick={() => handleSearch(query)}\n            className=\"absolute right-8 top-1/2 -translate-y-1/2 p-2 rounded-full hover:bg-white/10 transition\"\n            title=\"AI Search\"\n          >\n            <Sparkles className=\"w-7 h-7 md:w-9 md:h-9 text-pink-400 animate-pulse\" />\n          </motion.button>\n        </motion.div>\n      </div>\n    </div>\n  );\n}\n","/**\r\n * GVE (Global View Engine) Optimizer\r\n * Performance optimizations to eliminate lag and handle iframes efficiently\r\n * Target: 2x faster than Comet's cloud\r\n */\r\n\r\nimport { debounce, throttle } from 'lodash-es';\r\n\r\n/**\r\n * View update throttler - limits updates to 60fps\r\n */\r\nexport const throttleViewUpdate = throttle(\r\n  (callback: () => void) => {\r\n    requestAnimationFrame(callback);\r\n  },\r\n  16, // ~60fps\r\n  { leading: true, trailing: true }\r\n);\r\n\r\n/**\r\n * Debounced view resize handler\r\n */\r\nexport const debounceResize = debounce(\r\n  (callback: () => void) => {\r\n    callback();\r\n  },\r\n  100 // 100ms debounce\r\n);\r\n\r\n/**\r\n * Iframe isolation manager\r\n * Handles iframe loading, communication, and performance\r\n */\r\nexport class IframeManager {\r\n  private iframes = new Map<string, HTMLIFrameElement>();\r\n  private observers = new Map<string, ResizeObserver>();\r\n  private messageHandlers = new Map<string, (event: MessageEvent) => void>();\r\n\r\n  /**\r\n   * Register iframe with optimizations\r\n   */\r\n  registerIframe(id: string, iframe: HTMLIFrameElement, options: {\r\n    lazy?: boolean;\r\n    sandbox?: string[];\r\n    allow?: string;\r\n  } = {}) {\r\n    // Apply sandbox for security\r\n    if (options.sandbox) {\r\n      iframe.setAttribute('sandbox', options.sandbox.join(' '));\r\n    }\r\n\r\n    // Apply allow policies\r\n    if (options.allow) {\r\n      iframe.setAttribute('allow', options.allow);\r\n    }\r\n\r\n    // Lazy loading\r\n    if (options.lazy) {\r\n      iframe.setAttribute('loading', 'lazy');\r\n    }\r\n\r\n    // Performance optimizations\r\n    iframe.setAttribute('fetchpriority', 'low');\r\n    iframe.style.contentVisibility = 'auto';\r\n    iframe.style.contain = 'layout style paint';\r\n\r\n    this.iframes.set(id, iframe);\r\n\r\n    // Setup resize observer for efficient size tracking\r\n    const observer = new ResizeObserver(() => {\r\n      throttleViewUpdate(() => {\r\n        this.handleIframeResize(id, iframe);\r\n      });\r\n    });\r\n    observer.observe(iframe);\r\n    this.observers.set(id, observer);\r\n\r\n    // Setup message handler\r\n    const handler = (event: MessageEvent) => {\r\n      if (event.source === iframe.contentWindow) {\r\n        this.handleIframeMessage(id, event);\r\n      }\r\n    };\r\n    window.addEventListener('message', handler);\r\n    this.messageHandlers.set(id, handler);\r\n  }\r\n\r\n  /**\r\n   * Handle iframe resize efficiently\r\n   */\r\n  private handleIframeResize(id: string, iframe: HTMLIFrameElement) {\r\n    // Use requestAnimationFrame for smooth updates\r\n    requestAnimationFrame(() => {\r\n      const rect = iframe.getBoundingClientRect();\r\n      // Emit custom event for view updates\r\n      window.dispatchEvent(new CustomEvent('iframe-resize', {\r\n        detail: { id, rect }\r\n      }));\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle iframe messages\r\n   */\r\n  private handleIframeMessage(id: string, event: MessageEvent) {\r\n    // Validate origin for security\r\n    const allowedOrigins = ['*']; // Configure based on needs\r\n    if (allowedOrigins.includes('*') || allowedOrigins.includes(event.origin)) {\r\n      window.dispatchEvent(new CustomEvent('iframe-message', {\r\n        detail: { id, data: event.data, origin: event.origin }\r\n      }));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unregister iframe\r\n   */\r\n  unregisterIframe(id: string) {\r\n    const iframe = this.iframes.get(id);\r\n    if (iframe) {\r\n      const observer = this.observers.get(id);\r\n      if (observer) {\r\n        observer.disconnect();\r\n        this.observers.delete(id);\r\n      }\r\n\r\n      const handler = this.messageHandlers.get(id);\r\n      if (handler) {\r\n        window.removeEventListener('message', handler);\r\n        this.messageHandlers.delete(id);\r\n      }\r\n\r\n      this.iframes.delete(id);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get iframe by ID\r\n   */\r\n  getIframe(id: string): HTMLIFrameElement | undefined {\r\n    return this.iframes.get(id);\r\n  }\r\n\r\n  /**\r\n   * Send message to iframe\r\n   */\r\n  postMessage(id: string, message: any, targetOrigin: string = '*') {\r\n    const iframe = this.iframes.get(id);\r\n    if (iframe?.contentWindow) {\r\n      iframe.contentWindow.postMessage(message, targetOrigin);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Singleton iframe manager\r\n */\r\nlet iframeManagerInstance: IframeManager | null = null;\r\n\r\nexport function getIframeManager(): IframeManager {\r\n  if (!iframeManagerInstance) {\r\n    iframeManagerInstance = new IframeManager();\r\n  }\r\n  return iframeManagerInstance;\r\n}\r\n\r\n/**\r\n * View renderer with performance optimizations\r\n */\r\nexport class OptimizedViewRenderer {\r\n  private renderQueue: Array<() => void> = [];\r\n  private isRendering = false;\r\n  private frameId: number | null = null;\r\n\r\n  /**\r\n   * Queue a render operation\r\n   */\r\n  queueRender(callback: () => void) {\r\n    this.renderQueue.push(callback);\r\n    this.scheduleRender();\r\n  }\r\n\r\n  /**\r\n   * Schedule next render frame\r\n   */\r\n  private scheduleRender() {\r\n    if (this.isRendering || this.frameId !== null) {\r\n      return;\r\n    }\r\n\r\n    this.frameId = requestAnimationFrame(() => {\r\n      this.frameId = null;\r\n      this.flushRenderQueue();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Flush render queue\r\n   */\r\n  private flushRenderQueue() {\r\n    if (this.renderQueue.length === 0) {\r\n      this.isRendering = false;\r\n      return;\r\n    }\r\n\r\n    this.isRendering = true;\r\n    const batch = this.renderQueue.splice(0, 10); // Process up to 10 at a time\r\n    \r\n    batch.forEach(callback => {\r\n      try {\r\n        callback();\r\n      } catch (error) {\r\n        console.error('[OptimizedViewRenderer] Render error:', error);\r\n      }\r\n    });\r\n\r\n    // Schedule next batch if queue not empty\r\n    if (this.renderQueue.length > 0) {\r\n      this.scheduleRender();\r\n    } else {\r\n      this.isRendering = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cancel pending renders\r\n   */\r\n  cancel() {\r\n    if (this.frameId !== null) {\r\n      cancelAnimationFrame(this.frameId);\r\n      this.frameId = null;\r\n    }\r\n    this.renderQueue = [];\r\n    this.isRendering = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Singleton renderer\r\n */\r\nlet rendererInstance: OptimizedViewRenderer | null = null;\r\n\r\nexport function getViewRenderer(): OptimizedViewRenderer {\r\n  if (!rendererInstance) {\r\n    rendererInstance = new OptimizedViewRenderer();\r\n  }\r\n  return rendererInstance;\r\n}\r\n\r\n/**\r\n * Performance monitor\r\n */\r\nexport class PerformanceMonitor {\r\n  private metrics: Map<string, number[]> = new Map();\r\n\r\n  /**\r\n   * Start timing\r\n   */\r\n  start(label: string): () => void {\r\n    const startTime = performance.now();\r\n    return () => {\r\n      const duration = performance.now() - startTime;\r\n      const times = this.metrics.get(label) || [];\r\n      times.push(duration);\r\n      if (times.length > 100) {\r\n        times.shift(); // Keep last 100 measurements\r\n      }\r\n      this.metrics.set(label, times);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get average time for label\r\n   */\r\n  getAverage(label: string): number {\r\n    const times = this.metrics.get(label) || [];\r\n    if (times.length === 0) return 0;\r\n    return times.reduce((a, b) => a + b, 0) / times.length;\r\n  }\r\n\r\n  /**\r\n   * Get all metrics\r\n   */\r\n  getMetrics(): Record<string, { avg: number; count: number }> {\r\n    const result: Record<string, { avg: number; count: number }> = {};\r\n    this.metrics.forEach((times, label) => {\r\n      result[label] = {\r\n        avg: this.getAverage(label),\r\n        count: times.length,\r\n      };\r\n    });\r\n    return result;\r\n  }\r\n}\r\n\r\n/**\r\n * Singleton performance monitor\r\n */\r\nlet monitorInstance: PerformanceMonitor | null = null;\r\n\r\nexport function getPerformanceMonitor(): PerformanceMonitor {\r\n  if (!monitorInstance) {\r\n    monitorInstance = new PerformanceMonitor();\r\n  }\r\n  return monitorInstance;\r\n}\r\n\r\n","/**\r\n * useOptimizedView Hook\r\n * React hook for optimized view rendering with GVE performance improvements\r\n */\r\n\r\nimport { useEffect, useRef, useCallback, useMemo } from 'react';\r\nimport { getIframeManager, getViewRenderer, getPerformanceMonitor } from '../utils/gve-optimizer';\r\nimport { debounceResize } from '../utils/gve-optimizer';\r\n\r\ninterface UseOptimizedViewOptions {\r\n  iframeId?: string;\r\n  lazy?: boolean;\r\n  sandbox?: string[];\r\n  onResize?: (rect: DOMRect) => void;\r\n  onMessage?: (data: any) => void;\r\n}\r\n\r\nexport function useOptimizedView(options: UseOptimizedViewOptions = {}) {\r\n  const {\r\n    iframeId,\r\n    lazy = true,\r\n    sandbox,\r\n    onResize,\r\n    onMessage,\r\n  } = options;\r\n\r\n  const iframeRef = useRef<HTMLIFrameElement | null>(null);\r\n  const renderer = useMemo(() => getViewRenderer(), []);\r\n  const monitor = useMemo(() => getPerformanceMonitor(), []);\r\n\r\n  /**\r\n   * Register iframe with optimizations\r\n   */\r\n  useEffect(() => {\r\n    if (iframeId && iframeRef.current) {\r\n      const iframeManager = getIframeManager();\r\n      iframeManager.registerIframe(iframeId, iframeRef.current, {\r\n        lazy,\r\n        sandbox: sandbox || ['allow-scripts', 'allow-same-origin'],\r\n        allow: 'clipboard-read; clipboard-write',\r\n      });\r\n\r\n      return () => {\r\n        iframeManager.unregisterIframe(iframeId);\r\n      };\r\n    }\r\n  }, [iframeId, lazy, sandbox]);\r\n\r\n  /**\r\n   * Handle resize events\r\n   */\r\n  useEffect(() => {\r\n    if (!onResize) return;\r\n\r\n    const handler = (event: CustomEvent) => {\r\n      if (event.detail.id === iframeId) {\r\n        const rect = event.detail.rect;\r\n        onResize(rect);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('iframe-resize', handler as EventListener);\r\n    return () => {\r\n      window.removeEventListener('iframe-resize', handler as EventListener);\r\n    };\r\n  }, [iframeId, onResize]);\r\n\r\n  /**\r\n   * Handle iframe messages\r\n   */\r\n  useEffect(() => {\r\n    if (!onMessage) return;\r\n\r\n    const handler = (event: CustomEvent) => {\r\n      if (event.detail.id === iframeId) {\r\n        onMessage(event.detail.data);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('iframe-message', handler as EventListener);\r\n    return () => {\r\n      window.removeEventListener('iframe-message', handler as EventListener);\r\n    };\r\n  }, [iframeId, onMessage]);\r\n\r\n  /**\r\n   * Queue render update\r\n   */\r\n  const queueUpdate = useCallback((callback: () => void) => {\r\n    const endTiming = monitor.start('view-update');\r\n    renderer.queueRender(() => {\r\n      callback();\r\n      endTiming();\r\n    });\r\n  }, [renderer, monitor]);\r\n\r\n  /**\r\n   * Optimized resize handler\r\n   */\r\n  const handleResize = useCallback(() => {\r\n    debounceResize(() => {\r\n      if (iframeRef.current) {\r\n        const rect = iframeRef.current.getBoundingClientRect();\r\n        onResize?.(rect);\r\n      }\r\n    });\r\n  }, [onResize]);\r\n\r\n  /**\r\n   * Setup window resize listener\r\n   */\r\n  useEffect(() => {\r\n    window.addEventListener('resize', handleResize);\r\n    return () => {\r\n      window.removeEventListener('resize', handleResize);\r\n    };\r\n  }, [handleResize]);\r\n\r\n  return {\r\n    iframeRef,\r\n    queueUpdate,\r\n    getMetrics: () => monitor.getMetrics(),\r\n  };\r\n}\r\n\r\n","// @ts-nocheck\r\n\r\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\r\nimport { ExternalLink, Loader2 } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport type { Tab } from '../../state/tabsStore';\r\nimport { isElectronRuntime, isTauriRuntime } from '../../lib/env';\r\nimport { OmniDesk } from '../OmniDesk';\r\nimport NewTabPage from '../Browse/NewTabPage';\r\nimport { ipc } from '../../lib/ipc-typed';\r\nimport { useTabsStore } from '../../state/tabsStore';\r\nimport { useSettingsStore } from '../../state/settingsStore';\r\nimport { useAppStore } from '../../state/appStore';\r\nimport { SAFE_IFRAME_SANDBOX } from '../../config/security';\r\nimport { normalizeInputToUrlOrSearch } from '../../lib/search';\r\nimport { useOptimizedView } from '../../hooks/useOptimizedView';\r\nimport { getIframeManager, throttleViewUpdate } from '../../utils/gve-optimizer';\r\n\r\ninterface TabContentSurfaceProps {\r\n  tab: Tab | undefined;\r\n  overlayActive?: boolean;\r\n}\r\n\r\nconst INTERNAL_PROTOCOLS = ['ob://', 'about:', 'chrome://', 'edge://', 'app://', 'regen://'];\r\n\r\nfunction isInternalUrl(url?: string | null): boolean {\r\n  if (!url) return true;\r\n  return INTERNAL_PROTOCOLS.some(prefix => url.startsWith(prefix));\r\n}\r\n\r\nexport function TabContentSurface({ tab, overlayActive }: TabContentSurfaceProps) {\r\n  const containerRef = useRef<HTMLDivElement | null>(null);\r\n  // const webviewRef = useRef<any>(null); // Used for Tauri webview (currently unused)\r\n  const iframeRef = useRef<HTMLIFrameElement | null>(null);\r\n  const isElectron = isElectronRuntime();\r\n  const isTauri = isTauriRuntime();\r\n  const language = useSettingsStore(state => state.language || 'auto');\r\n  const [loading, setLoading] = useState(false);\r\n  const [failedMessage, setFailedMessage] = useState<string | null>(null);\r\n  const [blockedExternal, setBlockedExternal] = useState(false);\r\n  \r\n  // GVE Optimization: Use optimized view hook\r\n  const { queueUpdate: _queueUpdate } = useOptimizedView({\r\n    iframeId: tab?.id,\r\n    lazy: !tab?.active,\r\n    sandbox: SAFE_IFRAME_SANDBOX.split(' '),\r\n    onResize: (_rect) => {\r\n      // Handle resize with throttled updates\r\n      throttleViewUpdate(() => {\r\n        // Update view if needed\r\n      });\r\n    },\r\n  });\r\n  // const loadingTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null); // Not used - BrowserView managed by main process\r\n  // const retryCountRef = useRef(0); // Not used - BrowserView managed by main process\r\n\r\n  const targetUrl = useMemo(() => {\r\n    let url = tab?.url;\r\n\r\n    // For about:blank or empty URLs, show OmniDesk (search page) instead of webview\r\n    if (!url || url === 'about:blank' || isInternalUrl(url)) {\r\n      return null;\r\n    }\r\n\r\n    // If URL doesn't start with http/https, treat as search query\r\n    if (!url.startsWith('http://') && !url.startsWith('https://')) {\r\n      // Convert to search in user's language\r\n      // Use iframe-friendly search engine (Bing) to avoid X-Frame-Options blocking\r\n      const searchUrl = normalizeInputToUrlOrSearch(\r\n        url,\r\n        'bing', // Use Bing as default - it allows iframe embedding\r\n        language !== 'auto' ? language : undefined,\r\n        true // prefer iframe-friendly\r\n      );\r\n      if (searchUrl) {\r\n        return searchUrl;\r\n      }\r\n      // Fallback to Bing search (iframe-friendly)\r\n      return `https://www.bing.com/search?q=${encodeURIComponent(url)}`;\r\n    }\r\n\r\n    return url;\r\n  }, [tab?.url, language]);\r\n\r\n  // Tauri: Use IPC to navigate main window or create new webview window\r\n  // For now, we'll use iframe for Tauri as well (Tauri v2 doesn't support webview tag)\r\n\r\n  // In Electron, BrowserView is managed by main process, so we don't need webview event handlers\r\n  // The main process handles all BrowserView lifecycle events\r\n  // Cleanup: Ensure no memory leaks when tab is hibernated or closed\r\n  useEffect(() => {\r\n    if (!isElectron || !targetUrl || isTauri) {\r\n      return;\r\n    }\r\n\r\n    // BrowserView is managed by electron/services/tabs.ts\r\n    // No need for webview event handlers here\r\n\r\n    // Cleanup function to prevent memory leaks\r\n    return () => {\r\n      // Clear any pending timeouts or intervals\r\n      // Reset state to prevent stale references\r\n      setLoading(false);\r\n      setFailedMessage(null);\r\n      setBlockedExternal(false);\r\n    };\r\n  }, [isElectron, isTauri, targetUrl]);\r\n\r\n  // WebView stability: Add error handling and lifecycle management for iframe\r\n  useEffect(() => {\r\n    if (isElectron || !targetUrl || !iframeRef.current) {\r\n      return;\r\n    }\r\n\r\n    const iframe = iframeRef.current;\r\n    let isMounted = true;\r\n    const LOADING_TIMEOUT_MS = 30000; // 30 seconds\r\n    let timeoutId: ReturnType<typeof setTimeout> | null = null;\r\n\r\n    const handleLoad = () => {\r\n      if (!isMounted) return; // Don't update state if unmounted\r\n      if (timeoutId) {\r\n        clearTimeout(timeoutId);\r\n        timeoutId = null;\r\n      }\r\n      setLoading(false);\r\n      setFailedMessage(null);\r\n      if (!iframeRef.current) return;\r\n\r\n      // Check if iframe loaded successfully\r\n      // Cross-origin frames will throw when accessing contentDocument, but that's OK\r\n      // Only set blockedExternal if we can't access the iframe at all\r\n      try {\r\n        const doc = iframeRef.current.contentDocument;\r\n        void doc?.title;\r\n        setBlockedExternal(false);\r\n      } catch (error) {\r\n        // Cross-origin is normal - don't block unless there's an actual error\r\n        // Only block if we can't even access the iframe element\r\n        if (import.meta.env.DEV) {\r\n          console.debug('[TabContentSurface] cross-origin frame (normal)', error);\r\n        }\r\n        // Don't set blockedExternal for cross-origin - many sites work fine\r\n        // Only block if there's an actual X-Frame-Options error (detected via error handler)\r\n        setBlockedExternal(false);\r\n      }\r\n    };\r\n\r\n    const handleError = (event: ErrorEvent | Event) => {\r\n      if (!isMounted) return; // Don't update state if unmounted\r\n      if (timeoutId) {\r\n        clearTimeout(timeoutId);\r\n        timeoutId = null;\r\n      }\r\n      setLoading(false);\r\n\r\n      // Check if this is an X-Frame-Options blocking error\r\n      // Note: iframe error events don't always provide detailed error messages\r\n      // We'll check the iframe's state to determine if it's actually blocked\r\n      const errorMessage = event instanceof ErrorEvent ? event.message || '' : '';\r\n      const errorTarget = event.target;\r\n\r\n      // Check if the iframe itself failed to load (not just cross-origin)\r\n      // If iframe has no contentWindow, it might be blocked\r\n      const isFrameBlocked =\r\n        (errorMessage &&\r\n          (errorMessage.toLowerCase().includes('x-frame-options') ||\r\n            errorMessage.toLowerCase().includes('frame-ancestors') ||\r\n            errorMessage.toLowerCase().includes('refused to display') ||\r\n            errorMessage.toLowerCase().includes('denied') ||\r\n            (errorMessage.toLowerCase().includes('frame') &&\r\n              errorMessage.toLowerCase().includes('blocked')))) ||\r\n        (errorTarget === iframe &&\r\n          iframe.contentWindow === null &&\r\n          iframe.contentDocument === null);\r\n\r\n      // Additional check: If URL is a search engine that blocks iframes, try alternative\r\n      if (targetUrl && !isFrameBlocked) {\r\n        const urlLower = targetUrl.toLowerCase();\r\n        // DuckDuckGo and Google often block iframes\r\n        if (urlLower.includes('duckduckgo.com') || urlLower.includes('google.com/search')) {\r\n          // Try to convert to Bing search (iframe-friendly)\r\n          try {\r\n            const urlObj = new URL(targetUrl);\r\n            const query = urlObj.searchParams.get('q') || urlObj.searchParams.get('query') || '';\r\n            if (query) {\r\n              // Convert to Bing search URL\r\n              const bingUrl = `https://www.bing.com/search?q=${encodeURIComponent(query)}`;\r\n              console.log('[TabContentSurface] Converting iframe-blocked search to Bing:', bingUrl);\r\n              setTimeout(() => {\r\n                if (iframeRef.current) {\r\n                  iframeRef.current.src = bingUrl;\r\n                  setLoading(true);\r\n                  setFailedMessage(null);\r\n                }\r\n              }, 100);\r\n              return; // Don't set error, we're retrying with Bing\r\n            }\r\n          } catch {\r\n            // URL parsing failed, continue with error handling\r\n          }\r\n        }\r\n      }\r\n\r\n      if (isFrameBlocked) {\r\n        setBlockedExternal(true);\r\n        setFailedMessage('This site blocks embedded views (X-Frame-Options).');\r\n      } else {\r\n        // Generic error - don't assume it's blocking, might be network issue\r\n        setFailedMessage('Failed to load this page. Please check the URL or your connection.');\r\n        setBlockedExternal(false);\r\n      }\r\n    };\r\n\r\n    // Set loading timeout\r\n    timeoutId = setTimeout(() => {\r\n      if (!isMounted) return; // Don't update state if unmounted\r\n      setLoading(false);\r\n      setFailedMessage(\r\n        'This page is taking too long to load. Check your connection or try refreshing.'\r\n      );\r\n      timeoutId = null;\r\n    }, LOADING_TIMEOUT_MS);\r\n\r\n    iframe.addEventListener('load', handleLoad);\r\n    iframe.addEventListener('error', handleError as EventListener);\r\n\r\n    // Cleanup function to prevent memory leaks on tab hibernation/close\r\n    return () => {\r\n      isMounted = false; // Mark as unmounted to prevent state updates\r\n      if (timeoutId) {\r\n        clearTimeout(timeoutId);\r\n        timeoutId = null;\r\n      }\r\n      if (iframe && iframeRef.current) {\r\n        iframe.removeEventListener('load', handleLoad);\r\n        iframe.removeEventListener('error', handleError);\r\n      }\r\n      // Clear state to prevent memory leaks\r\n      setLoading(false);\r\n      setFailedMessage(null);\r\n      setBlockedExternal(false);\r\n    };\r\n\r\n    /* Legacy webview code - kept for reference but not used\r\n    const webviewElement = webviewRef.current as Electron.WebviewTag;\r\n    const LOADING_TIMEOUT_MS = 30000; // 30 seconds\r\n    // const MAX_RETRIES = 2; // Reserved for future use\r\n\r\n    const handleDidStartLoading = () => {\r\n      setLoading(true);\r\n      setFailedMessage(null);\r\n      retryCountRef.current = 0;\r\n      \r\n      // Clear any existing timeout\r\n      if (loadingTimeoutRef.current) {\r\n        clearTimeout(loadingTimeoutRef.current);\r\n      }\r\n      \r\n      // Set timeout for loading with retry option\r\n      loadingTimeoutRef.current = setTimeout(() => {\r\n        setLoading(false);\r\n        setFailedMessage('This page is taking too long to load. Check your connection or try refreshing.');\r\n        // Auto-retry once after timeout\r\n        if (retryCountRef.current < 1 && targetUrl) {\r\n          retryCountRef.current++;\r\n          setTimeout(() => {\r\n            if (webviewRef.current && targetUrl) {\r\n              const webviewElement = webviewRef.current as Electron.WebviewTag;\r\n              try {\r\n                webviewElement.reload();\r\n                setLoading(true);\r\n                setFailedMessage(null);\r\n              } catch (error) {\r\n                console.warn('[TabContentSurface] Retry failed:', error);\r\n              }\r\n            }\r\n          }, 2000);\r\n        }\r\n      }, LOADING_TIMEOUT_MS);\r\n    };\r\n\r\n    const handleDidStopLoading = () => {\r\n      if (loadingTimeoutRef.current) {\r\n        clearTimeout(loadingTimeoutRef.current);\r\n        loadingTimeoutRef.current = null;\r\n      }\r\n      setLoading(false);\r\n    };\r\n\r\n    const handleDomReady = () => {\r\n      if (loadingTimeoutRef.current) {\r\n        clearTimeout(loadingTimeoutRef.current);\r\n        loadingTimeoutRef.current = null;\r\n      }\r\n      setLoading(false);\r\n      setFailedMessage(null);\r\n      retryCountRef.current = 0;\r\n    };\r\n\r\n    const handleFailLoad = (event: any) => {\r\n      if (loadingTimeoutRef.current) {\r\n        clearTimeout(loadingTimeoutRef.current);\r\n        loadingTimeoutRef.current = null;\r\n      }\r\n      setLoading(false);\r\n      \r\n      const errorCode = event?.errorCode ?? -1;\r\n      const errorDescription = event?.errorDescription ?? 'Unknown error';\r\n      \r\n      let message = 'Failed to load this page.';\r\n      if (errorCode === -105 || errorDescription.includes('ERR_NAME_NOT_RESOLVED')) {\r\n        message = 'Could not resolve the website address. Check your internet connection.';\r\n      } else if (errorCode === -106 || errorDescription.includes('ERR_INTERNET_DISCONNECTED')) {\r\n        message = 'No internet connection. Please check your network settings.';\r\n      } else if (errorCode === -118 || errorDescription.includes('ERR_CONNECTION_TIMED_OUT')) {\r\n        message = 'Connection timed out. The server may be slow or unreachable.';\r\n      } else if (errorDescription.includes('ERR_BLOCKED_BY_RESPONSE')) {\r\n        message = 'This site cannot be embedded for security reasons.';\r\n      } else {\r\n        message = `Failed to load: ${errorDescription || 'Unknown error'}`;\r\n      }\r\n      \r\n      setFailedMessage(message);\r\n    };\r\n\r\n    webviewElement.addEventListener('did-start-loading', handleDidStartLoading);\r\n    webviewElement.addEventListener('did-stop-loading', handleDidStopLoading);\r\n    webviewElement.addEventListener('dom-ready', handleDomReady);\r\n    webviewElement.addEventListener('did-fail-load', handleFailLoad);\r\n\r\n    return () => {\r\n      if (loadingTimeoutRef.current) {\r\n        clearTimeout(loadingTimeoutRef.current);\r\n        loadingTimeoutRef.current = null;\r\n      }\r\n      webviewElement.removeEventListener('did-start-loading', handleDidStartLoading);\r\n      webviewElement.removeEventListener('did-stop-loading', handleDidStopLoading);\r\n      webviewElement.removeEventListener('dom-ready', handleDomReady);\r\n      webviewElement.removeEventListener('did-fail-load', handleFailLoad);\r\n    };\r\n    */\r\n  }, [isElectron, isTauri, targetUrl]);\r\n\r\n  useEffect(() => {\r\n    // Use iframe for both web builds and Tauri (Tauri v2 doesn't support webview tag)\r\n    if (isElectron || !iframeRef.current || !targetUrl) {\r\n      return;\r\n    }\r\n\r\n    const iframe = iframeRef.current;\r\n    let isMounted = true; // Track if component is still mounted\r\n    const LOADING_TIMEOUT_MS = 30000; // 30 seconds\r\n    let timeoutId: ReturnType<typeof setTimeout> | null = null;\r\n\r\n    const handleLoad = () => {\r\n      if (!isMounted) return; // Don't update state if unmounted\r\n      if (timeoutId) {\r\n        clearTimeout(timeoutId);\r\n        timeoutId = null;\r\n      }\r\n      setLoading(false);\r\n      setFailedMessage(null);\r\n      if (!iframeRef.current) return;\r\n\r\n      // Check if iframe loaded successfully\r\n      // Cross-origin frames will throw when accessing contentDocument, but that's OK\r\n      // Only set blockedExternal if we can't access the iframe at all\r\n      try {\r\n        const doc = iframeRef.current.contentDocument;\r\n        void doc?.title;\r\n        setBlockedExternal(false);\r\n      } catch (error) {\r\n        // Cross-origin is normal - don't block unless there's an actual error\r\n        // Only block if we can't even access the iframe element\r\n        if (import.meta.env.DEV) {\r\n          console.debug('[TabContentSurface] cross-origin frame (normal)', error);\r\n        }\r\n        // Don't set blockedExternal for cross-origin - many sites work fine\r\n        // Only block if there's an actual X-Frame-Options error (detected via error handler)\r\n        setBlockedExternal(false);\r\n      }\r\n    };\r\n\r\n    const handleError = (event: ErrorEvent | Event) => {\r\n      if (!isMounted) return; // Don't update state if unmounted\r\n      if (timeoutId) {\r\n        clearTimeout(timeoutId);\r\n        timeoutId = null;\r\n      }\r\n      setLoading(false);\r\n\r\n      // Check if this is an X-Frame-Options blocking error\r\n      // Note: iframe error events don't always provide detailed error messages\r\n      // We'll check the iframe's state to determine if it's actually blocked\r\n      const errorMessage = event instanceof ErrorEvent ? event.message || '' : '';\r\n      const errorTarget = event.target;\r\n\r\n      // Check if the iframe itself failed to load (not just cross-origin)\r\n      // If iframe has no contentWindow, it might be blocked\r\n      const isFrameBlocked =\r\n        (errorMessage &&\r\n          (errorMessage.toLowerCase().includes('x-frame-options') ||\r\n            errorMessage.toLowerCase().includes('frame-ancestors') ||\r\n            errorMessage.toLowerCase().includes('refused to display') ||\r\n            errorMessage.toLowerCase().includes('denied') ||\r\n            (errorMessage.toLowerCase().includes('frame') &&\r\n              errorMessage.toLowerCase().includes('blocked')))) ||\r\n        (errorTarget === iframe &&\r\n          iframe.contentWindow === null &&\r\n          iframe.contentDocument === null);\r\n\r\n      // Additional check: If URL is a search engine that blocks iframes, try alternative\r\n      if (targetUrl && !isFrameBlocked) {\r\n        const urlLower = targetUrl.toLowerCase();\r\n        // DuckDuckGo and Google often block iframes\r\n        if (urlLower.includes('duckduckgo.com') || urlLower.includes('google.com/search')) {\r\n          // Try to convert to Bing search (iframe-friendly)\r\n          try {\r\n            const urlObj = new URL(targetUrl);\r\n            const query = urlObj.searchParams.get('q') || urlObj.searchParams.get('query') || '';\r\n            if (query) {\r\n              // Convert to Bing search URL\r\n              const bingUrl = `https://www.bing.com/search?q=${encodeURIComponent(query)}`;\r\n              console.log('[TabContentSurface] Converting iframe-blocked search to Bing:', bingUrl);\r\n              setTimeout(() => {\r\n                if (iframeRef.current) {\r\n                  iframeRef.current.src = bingUrl;\r\n                  setLoading(true);\r\n                  setFailedMessage(null);\r\n                }\r\n              }, 100);\r\n              return; // Don't set error, we're retrying with Bing\r\n            }\r\n          } catch {\r\n            // URL parsing failed, continue with error handling\r\n          }\r\n        }\r\n      }\r\n\r\n      if (isFrameBlocked) {\r\n        setBlockedExternal(true);\r\n        setFailedMessage('This site blocks embedded views (X-Frame-Options).');\r\n      } else {\r\n        // Generic error - don't assume it's blocking, might be network issue\r\n        setFailedMessage('Failed to load this page. Please check the URL or your connection.');\r\n        setBlockedExternal(false);\r\n      }\r\n    };\r\n\r\n    // Set loading timeout\r\n    timeoutId = setTimeout(() => {\r\n      if (!isMounted) return; // Don't update state if unmounted\r\n      setLoading(false);\r\n      setFailedMessage(\r\n        'This page is taking too long to load. Check your connection or try refreshing.'\r\n      );\r\n      timeoutId = null;\r\n    }, LOADING_TIMEOUT_MS);\r\n\r\n    iframe.addEventListener('load', handleLoad);\r\n    iframe.addEventListener('error', handleError as EventListener);\r\n\r\n    // MEMORY LEAK FIX: Listen for tab close event to cleanup\r\n    const handleTabClose = ((e: CustomEvent) => {\r\n      if (e.detail?.tabId === tab?.id) {\r\n        isMounted = false;\r\n        if (timeoutId) {\r\n          clearTimeout(timeoutId);\r\n          timeoutId = null;\r\n        }\r\n        if (iframe && iframeRef.current) {\r\n          iframe.removeEventListener('load', handleLoad);\r\n          iframe.removeEventListener('error', handleError);\r\n          // Clear iframe src to release resources\r\n          iframe.src = 'about:blank';\r\n        }\r\n      }\r\n    }) as EventListener;\r\n\r\n    window.addEventListener('tab-closed', handleTabClose);\r\n\r\n    // Cleanup function to prevent memory leaks on tab hibernation/close\r\n    return () => {\r\n      isMounted = false; // Mark as unmounted to prevent state updates\r\n      window.removeEventListener('tab-closed', handleTabClose);\r\n      if (timeoutId) {\r\n        clearTimeout(timeoutId);\r\n        timeoutId = null;\r\n      }\r\n      if (iframe && iframeRef.current) {\r\n        iframe.removeEventListener('load', handleLoad);\r\n        iframe.removeEventListener('error', handleError);\r\n        // Clear iframe src to release resources\r\n        iframe.src = 'about:blank';\r\n      }\r\n      // Clear state to prevent memory leaks\r\n      setLoading(false);\r\n      setFailedMessage(null);\r\n      setBlockedExternal(false);\r\n    };\r\n  }, [isElectron, isTauri, targetUrl, tab?.id]);\r\n\r\n  const launchExternal = useCallback(() => {\r\n    if (!targetUrl) return;\r\n    try {\r\n      window.open(targetUrl, '_blank', 'noopener,noreferrer');\r\n    } catch (error) {\r\n      console.warn('[TabContentSurface] failed to open external window', error);\r\n    }\r\n  }, [targetUrl]);\r\n\r\n  useEffect(() => {\r\n    if (!targetUrl) {\r\n      setLoading(false);\r\n      setFailedMessage(null);\r\n      setBlockedExternal(false);\r\n      return;\r\n    }\r\n\r\n    // In Electron, BrowserView navigation is handled by electron/services/tabs.ts\r\n    // For Tauri and web builds, use iframe\r\n    if (isElectron) {\r\n      // BrowserView is managed by main process\r\n      return;\r\n    } else {\r\n      const iframe = iframeRef.current;\r\n      if (!iframe) return;\r\n      if (iframe.src !== targetUrl) {\r\n        setLoading(true);\r\n        iframe.src = targetUrl;\r\n      }\r\n      setBlockedExternal(false);\r\n    }\r\n  }, [isElectron, isTauri, targetUrl]);\r\n\r\n  const panelId = tab?.id ? `tabpanel-${tab.id}` : 'tabpanel-empty';\r\n  const labelledById = tab?.id ? `tab-${tab.id}` : undefined;\r\n  const isInactive = !tab || !tab.active;\r\n\r\n  // Show NewTabPage for about:blank or internal URLs in Browse mode\r\n  // Show OmniDesk for other modes\r\n  const currentMode = useAppStore(state => state.mode ?? 'Browse');\r\n  const isBrowseMode = currentMode === 'Browse' || !currentMode;\r\n\r\n  if (!targetUrl) {\r\n    return (\r\n      <motion.div\r\n        id={panelId}\r\n        role=\"tabpanel\"\r\n        aria-labelledby={labelledById}\r\n        aria-hidden={isInactive}\r\n        className=\"h-full w-full overflow-hidden bg-black\"\r\n        initial={{ opacity: 0 }}\r\n        animate={{ opacity: 1 }}\r\n        transition={{ duration: 0.2 }}\r\n        style={{\r\n          position: 'absolute',\r\n          inset: 0,\r\n          zIndex: isInactive ? 0 : 1,\r\n          pointerEvents: 'auto',\r\n        }}\r\n      >\r\n        {isBrowseMode ? <NewTabPage /> : <OmniDesk variant=\"split\" forceShow />}\r\n      </motion.div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <motion.div\r\n      ref={containerRef}\r\n      className={`h-full w-full bg-black ${overlayActive ? 'pointer-events-none' : ''}`}\r\n      key={targetUrl}\r\n      id={panelId}\r\n      role=\"tabpanel\"\r\n      aria-labelledby={labelledById}\r\n      aria-hidden={isInactive}\r\n      initial={{ opacity: 0.4 }}\r\n      animate={{ opacity: 1 }}\r\n      transition={{ duration: 0.35, ease: 'easeOut' }}\r\n      style={{\r\n        position: 'absolute',\r\n        top: 0,\r\n        left: 0,\r\n        right: 0,\r\n        bottom: 0,\r\n        width: '100%',\r\n        height: '100%',\r\n        zIndex: isInactive ? 0 : 1,\r\n      }}\r\n    >\r\n      {/* In Electron, BrowserView is managed by main process */}\r\n      {/* For Tauri and web builds, use iframe (Tauri v2 doesn't support webview tag) */}\r\n      {!isElectron && targetUrl ? (\r\n        <iframe\r\n          ref={el => {\r\n            if (el) {\r\n              iframeRef.current = el;\r\n              // GVE Optimization: Register iframe with optimizations\r\n              if (tab?.id) {\r\n                const iframeManager = getIframeManager();\r\n                throttleViewUpdate(() => {\r\n                  iframeManager.registerIframe(tab.id, el, {\r\n                    lazy: !tab.active,\r\n                    sandbox: SAFE_IFRAME_SANDBOX.split(' '),\r\n                    allow: 'fullscreen; autoplay; camera; microphone; geolocation; payment; clipboard-read; clipboard-write; display-capture; storage-access',\r\n                  });\r\n                });\r\n              }\r\n            }\r\n          }}\r\n          className=\"h-full w-full border-0\"\r\n          style={{\r\n            position: 'absolute',\r\n            top: 0,\r\n            left: 0,\r\n            right: 0,\r\n            bottom: 0,\r\n            width: '100%',\r\n            height: '100%',\r\n            border: 'none',\r\n            // GVE Optimization: Performance improvements\r\n            contentVisibility: tab?.active ? 'auto' : 'hidden',\r\n            contain: 'layout style paint',\r\n          }}\r\n          src={targetUrl && targetUrl !== 'about:blank' ? targetUrl : 'regen://newtab'}\r\n          sandbox={SAFE_IFRAME_SANDBOX}\r\n          allow=\"fullscreen; autoplay; camera; microphone; geolocation; payment; clipboard-read; clipboard-write; display-capture; storage-access\"\r\n          referrerPolicy=\"no-referrer\"\r\n          loading={tab?.active ? 'eager' : 'lazy'}\r\n          fetchPriority={tab?.active ? 'high' : 'low'}\r\n          title={tab?.title ?? 'Tab content'}\r\n          aria-label={\r\n            tab?.title\r\n              ? `Content for ${tab.title}`\r\n              : targetUrl\r\n                ? `External content for ${new URL(targetUrl).hostname}`\r\n                : 'Tab content'\r\n          }\r\n          aria-live=\"off\"\r\n          onError={e => {\r\n            // Additional error handling for iframe\r\n            console.warn('[TabContentSurface] Iframe error event:', e);\r\n            // Check if it's a blocked iframe\r\n            const iframe = e.currentTarget;\r\n            if (iframe && !iframe.contentWindow && !iframe.contentDocument) {\r\n              setBlockedExternal(true);\r\n              setFailedMessage('This site blocks embedded views (X-Frame-Options).');\r\n            }\r\n          }}\r\n        />\r\n      ) : null}\r\n\r\n      <AnimatePresence>\r\n        {loading && (\r\n          <motion.div\r\n            className=\"pointer-events-none absolute inset-0 z-10 flex items-center justify-center bg-slate-950/55 backdrop-blur-sm\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            role=\"status\"\r\n            aria-live=\"polite\"\r\n            aria-label=\"Loading page content\"\r\n          >\r\n            <motion.div\r\n              initial={{ scale: 0.95, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.95, opacity: 0 }}\r\n              transition={{ duration: 0.2 }}\r\n              className=\"flex flex-col items-center gap-4 rounded-2xl border border-slate-700/60 bg-slate-900/90 px-6 py-5 text-sm text-slate-200 shadow-lg shadow-black/40\"\r\n            >\r\n              <motion.div\r\n                animate={{ rotate: 360 }}\r\n                transition={{ duration: 1, repeat: Infinity, ease: 'linear' }}\r\n              >\r\n                <Loader2 className=\"h-6 w-6 text-emerald-300\" aria-hidden=\"true\" />\r\n              </motion.div>\r\n              <div className=\"w-full max-w-xs text-center\">\r\n                <div className=\"mb-2 font-medium\">Loading {new URL(targetUrl).hostname}</div>\r\n                <div className=\"mb-3 mt-1 text-xs text-slate-400\">This may take a moment</div>\r\n                <div className=\"w-full\">\r\n                  <div className=\"h-1 w-full overflow-hidden rounded-full bg-slate-800/60\">\r\n                    <motion.div\r\n                      className=\"h-full bg-gradient-to-r from-emerald-500 via-cyan-500 to-emerald-500\"\r\n                      initial={{ x: '-100%', width: '40%' }}\r\n                      animate={{\r\n                        x: ['-100%', '100%'],\r\n                      }}\r\n                      transition={{\r\n                        duration: 1.5,\r\n                        repeat: Infinity,\r\n                        ease: 'easeInOut',\r\n                      }}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      <AnimatePresence>\r\n        {failedMessage && (\r\n          <motion.div\r\n            className=\"pointer-events-auto absolute inset-0 z-10 flex items-center justify-center bg-slate-950/80 backdrop-blur-sm\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            role=\"alert\"\r\n            aria-live=\"assertive\"\r\n          >\r\n            <motion.div\r\n              initial={{ scale: 0.95, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.9, opacity: 0 }}\r\n              transition={{ duration: 0.18 }}\r\n              className=\"max-w-md space-y-3 rounded-2xl border border-amber-400/40 bg-amber-500/15 px-5 py-4 text-center text-sm text-amber-100 shadow-lg shadow-black/50\"\r\n            >\r\n              <div className=\"font-medium\">{failedMessage}</div>\r\n              <div className=\"flex items-center justify-center gap-2\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => {\r\n                    if (targetUrl && isElectron) {\r\n                      // In Electron, reload is handled by main process via IPC\r\n                      const activeTab = useTabsStore.getState().activeId;\r\n                      if (activeTab) {\r\n                        ipc.tabs.reload({ id: activeTab }).catch(console.error);\r\n                      }\r\n                      setFailedMessage(null);\r\n                      setLoading(true);\r\n                    } else if (targetUrl && !isElectron && iframeRef.current) {\r\n                      setFailedMessage(null);\r\n                      setLoading(true);\r\n                      iframeRef.current.src = targetUrl;\r\n                    }\r\n                  }}\r\n                  className=\"rounded-lg border border-amber-400/60 bg-amber-500/20 px-3 py-1.5 text-xs font-medium text-amber-50 transition-colors hover:bg-amber-500/30\"\r\n                >\r\n                  Retry\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n\r\n      <AnimatePresence>\r\n        {!isElectron && blockedExternal && (\r\n          <motion.div\r\n            className=\"absolute inset-0 z-20 flex items-center justify-center bg-slate-950/85 px-6\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n          >\r\n            <motion.div\r\n              initial={{ scale: 0.95, opacity: 0 }}\r\n              animate={{ scale: 1, opacity: 1 }}\r\n              exit={{ scale: 0.92, opacity: 0 }}\r\n              transition={{ duration: 0.22 }}\r\n              className=\"max-w-lg space-y-4 rounded-3xl border border-emerald-500/40 bg-emerald-500/15 p-6 text-center text-sm text-emerald-100 shadow-2xl shadow-black/50\"\r\n            >\r\n              <div className=\"text-lg font-semibold text-emerald-50\">\r\n                {targetUrl ? new URL(targetUrl).hostname : 'This page'} cannot be embedded\r\n              </div>\r\n              <p className=\"text-emerald-100/70\">\r\n                This site blocks embedded views for security (X-Frame-Options). You can open it in\r\n                your system browser or use the desktop build for full webview support.\r\n              </p>\r\n              <div className=\"flex items-center justify-center gap-3\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={launchExternal}\r\n                  className=\"inline-flex items-center gap-2 rounded-xl border border-emerald-400/60 bg-emerald-500/20 px-4 py-2 text-sm font-medium text-emerald-50 transition hover:border-emerald-300/70 hover:bg-emerald-500/30\"\r\n                >\r\n                  <ExternalLink size={16} />\r\n                  Open in Browser\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    </motion.div>\r\n  );\r\n}\r\n","/**\r\n * Privacy Mode Utilities\r\n * Applies privacy settings to iframes and the application\r\n */\r\n\r\nimport { useSettingsStore } from '../state/settingsStore';\r\n\r\n/**\r\n * Get privacy-enhanced iframe sandbox attributes\r\n */\r\nexport function getPrivacySandboxAttributes(privacyMode: boolean): string {\r\n  const base = 'allow-scripts allow-same-origin allow-forms allow-popups allow-modals';\r\n  if (privacyMode) {\r\n    // In privacy mode, restrict more permissions\r\n    return 'allow-scripts allow-forms allow-popups';\r\n  }\r\n  return base;\r\n}\r\n\r\n/**\r\n * Get privacy-enhanced iframe referrer policy\r\n */\r\nexport function getPrivacyReferrerPolicy(privacyMode: boolean): ReferrerPolicy {\r\n  if (privacyMode) {\r\n    return 'no-referrer';\r\n  }\r\n  return 'no-referrer-when-downgrade';\r\n}\r\n\r\n/**\r\n * Apply privacy mode to an iframe element\r\n */\r\nexport function applyPrivacyModeToIframe(iframe: HTMLIFrameElement, privacyMode: boolean): void {\r\n  if (!iframe) return;\r\n\r\n  // Update sandbox attributes\r\n  if (privacyMode) {\r\n    iframe.setAttribute('sandbox', getPrivacySandboxAttributes(true));\r\n    iframe.setAttribute('referrerpolicy', 'no-referrer');\r\n  } else {\r\n    iframe.setAttribute('sandbox', getPrivacySandboxAttributes(false));\r\n    iframe.setAttribute('referrerpolicy', 'no-referrer-when-downgrade');\r\n  }\r\n\r\n  // Note: Third-party cookie blocking and tracker blocking would need to be\r\n  // implemented at the browser/engine level (Tauri backend) or via content scripts\r\n  // This is a client-side helper that sets iframe attributes\r\n}\r\n\r\n/**\r\n * Check if privacy mode is enabled\r\n */\r\nexport function isPrivacyModeEnabled(): boolean {\r\n  const store = useSettingsStore.getState();\r\n  return store.privacy.trackerProtection && store.privacy.adBlockEnabled;\r\n}\r\n\r\n/**\r\n * Block third-party requests (client-side helper)\r\n * This would need to be implemented via Tauri backend or service worker\r\n */\r\nexport function shouldBlockRequest(url: string, privacyMode: boolean): boolean {\r\n  if (!privacyMode) return false;\r\n\r\n  // Simple heuristic: block known tracker domains\r\n  const trackerPatterns = [\r\n    /doubleclick\\.net/i,\r\n    /google-analytics\\.com/i,\r\n    /googletagmanager\\.com/i,\r\n    /facebook\\.net/i,\r\n    /facebook\\.com\\/tr/i,\r\n    /analytics\\./i,\r\n    /tracking\\./i,\r\n    /adservice\\./i,\r\n  ];\r\n\r\n  return trackerPatterns.some(pattern => pattern.test(url));\r\n}\r\n","/**\n * TabIframeManager - PR: Fix tab switch null issues in Tauri\n * Implements iframe-per-tab pattern: all iframes stay mounted, visibility toggled via CSS\n * This preserves page state and prevents null refs when switching tabs\n */\n\nimport { useRef, useEffect } from 'react';\nimport type { Tab } from '../../state/tabsStore';\nimport { useTabsStore } from '../../state/tabsStore';\nimport { SAFE_IFRAME_SANDBOX } from '../../config/security';\nimport { isElectronRuntime } from '../../lib/env';\nimport { normalizeInputToUrlOrSearch } from '../../lib/search';\nimport { useSettingsStore } from '../../state/settingsStore';\nimport { deriveTitleFromUrl } from '../../lib/ipc-typed';\nimport { applyPrivacyModeToIframe } from '../../utils/privacyMode';\nimport { getIframeManager, getViewRenderer, throttleViewUpdate } from '../../utils/gve-optimizer';\n\ninterface TabIframeManagerProps {\n  tabs: Tab[];\n  activeTabId: string | null;\n}\n\nconst INTERNAL_PROTOCOLS = ['ob://', 'about:', 'chrome://', 'edge://', 'app://', 'regen://'];\n\nfunction isInternalUrl(url?: string | null): boolean {\n  if (!url) return true;\n  return INTERNAL_PROTOCOLS.some(prefix => url.startsWith(prefix));\n}\n\n/**\n * Get the actual URL to load in iframe for a tab\n */\nfunction getTabIframeUrl(tab: Tab, language: string): string | null {\n  let url = tab.url;\n\n  // For about:blank or empty URLs, return null (will show NewTabPage)\n  if (!url || url === 'about:blank' || isInternalUrl(url)) {\n    return null;\n  }\n\n  // If URL doesn't start with http/https, treat as search query\n  if (!url.startsWith('http://') && !url.startsWith('https://')) {\n    // Convert to search in user's language\n    // Use iframe-friendly search engine (Bing) to avoid X-Frame-Options blocking\n    const searchUrl = normalizeInputToUrlOrSearch(\n      url,\n      'bing', // Use Bing as default - it allows iframe embedding\n      language !== 'auto' ? language : undefined,\n      true // prefer iframe-friendly\n    );\n    if (searchUrl) {\n      return searchUrl;\n    }\n    // Fallback to Bing search (iframe-friendly)\n    return `https://www.bing.com/search?q=${encodeURIComponent(url)}`;\n  }\n\n  return url;\n}\n\nexport function TabIframeManager({ tabs, activeTabId }: TabIframeManagerProps) {\n  const language = useSettingsStore(state => state.language || 'auto');\n  const privacySettings = useSettingsStore(state => state.privacy);\n  const privacyMode = privacySettings.trackerProtection && privacySettings.adBlockEnabled;\n  const isElectron = isElectronRuntime();\n\n  // PR: Fix tab switch - use useRef map to store iframe refs (stable, doesn't cause re-renders)\n  const iframeRefs = useRef<Map<string, HTMLIFrameElement>>(new Map());\n  \n  // GVE Optimization: Initialize iframe manager and renderer\n  const iframeManager = useRef(getIframeManager());\n  const _renderer = useRef(getViewRenderer());\n\n  // PR: Fix tab switch - track which tabs have X-Frame-Options blocking\n  const blockedTabs = useRef<Set<string>>(new Set());\n\n  // PR: Fix memory leaks - track observers and listeners for cleanup\n  const observerRefs = useRef<Map<string, MutationObserver>>(new Map());\n  const clickHandlerRefs = useRef<Map<string, (e: MouseEvent) => void>>(new Map());\n  const navigationHandlerRefs = useRef<Map<string, () => void>>(new Map());\n\n  // PR: Fix tab switch - set iframe ref callback (stable function)\n  const setIframeRef = (tabId: string) => (el: HTMLIFrameElement | null) => {\n    if (el) {\n      iframeRefs.current.set(tabId, el);\n      // GVE Optimization: Register iframe with optimizations\n      if (!isElectron) {\n        throttleViewUpdate(() => {\n          iframeManager.current.registerIframe(tabId, el, {\n            lazy: true,\n            sandbox: privacyMode \n              ? ['allow-scripts', 'allow-forms', 'allow-popups'] \n              : SAFE_IFRAME_SANDBOX.split(' '),\n            allow: 'fullscreen; autoplay; camera; microphone; geolocation; payment; clipboard-read; clipboard-write; display-capture; storage-access',\n          });\n        });\n      }\n    } else {\n      iframeRefs.current.delete(tabId);\n      // GVE Optimization: Unregister iframe\n      if (!isElectron) {\n        iframeManager.current.unregisterIframe(tabId);\n      }\n    }\n  };\n\n  // PR: Fix navigation - Update iframe src when tab URL changes programmatically\n  useEffect(() => {\n    if (isElectron) return;\n\n    tabs.forEach(tab => {\n      const iframe = iframeRefs.current.get(tab.id);\n      if (!iframe) return;\n\n      const iframeUrl = getTabIframeUrl(tab, language);\n      const currentSrc = iframe.src;\n\n      // Update iframe src if tab URL changed (e.g., from address bar)\n      if (iframeUrl && iframeUrl !== currentSrc && iframeUrl !== 'about:blank') {\n        // Only update if this is the active tab or if src is about:blank\n        const isActive = tab.id === activeTabId;\n        if (isActive || currentSrc === 'about:blank') {\n          console.log('[TabIframeManager] Updating iframe src from tab URL change', {\n            tabId: tab.id,\n            oldSrc: currentSrc,\n            newSrc: iframeUrl,\n            isActive,\n          });\n          iframe.src = iframeUrl;\n        }\n      }\n    });\n  }, [tabs, language, activeTabId, isElectron]);\n\n  // PR: Fix tab switch - detect X-Frame-Options blocking\n  useEffect(() => {\n    if (isElectron) return; // Electron uses BrowserView, not iframes\n\n    const checkBlockedFrames = () => {\n      tabs.forEach(tab => {\n        const iframe = iframeRefs.current.get(tab.id);\n        if (!iframe) return;\n\n        // Check if iframe is blocked (X-Frame-Options)\n        // If contentWindow is null or we can't access contentDocument, it's likely blocked\n        try {\n          // Try to access contentWindow - will throw for cross-origin if blocked\n          const hasContent = iframe.contentWindow !== null;\n\n          // Check if we can access contentDocument (same-origin only)\n          // For cross-origin, this will be null even if not blocked\n          // So we use a timeout-based heuristic: if iframe loads but contentWindow is null, it's blocked\n          if (!hasContent && iframe.src && !iframe.src.startsWith('about:')) {\n            // Set a timeout to check if content loaded\n            setTimeout(() => {\n              try {\n                // If still no contentWindow after load, likely blocked\n                if (!iframe.contentWindow && iframe.src) {\n                  console.warn(\n                    '[TabIframeManager] Detected X-Frame-Options blocking for tab',\n                    tab.id,\n                    tab.url\n                  );\n                  blockedTabs.current.add(tab.id);\n\n                  // Emit event for fallback handling\n                  window.dispatchEvent(\n                    new CustomEvent('iframe-blocked', {\n                      detail: { tabId: tab.id, url: tab.url },\n                    })\n                  );\n                }\n              } catch {\n                // Cross-origin access denied is expected, not a block\n              }\n            }, 2000);\n          } else {\n            // Iframe has content, remove from blocked set\n            blockedTabs.current.delete(tab.id);\n          }\n        } catch {\n          // Cross-origin access denied - this is normal, not a block\n        }\n      });\n    };\n\n    // Check periodically for blocked frames\n    const interval = setInterval(checkBlockedFrames, 1000);\n\n    // Cleanup function\n    return () => {\n      clearInterval(interval);\n      // GVE Optimization: Cleanup iframe manager\n      if (!isElectron) {\n        iframeRefs.current.forEach((_iframe, tabId) => {\n          iframeManager.current.unregisterIframe(tabId);\n        });\n      }\n      // Cleanup all iframe event listeners and observers\n      iframeRefs.current.forEach((iframe, tabId) => {\n        // Cleanup stored cleanup function\n        if ((iframe as any)._cleanup) {\n          (iframe as any)._cleanup();\n          delete (iframe as any)._cleanup;\n        }\n\n        // Cleanup MutationObserver\n        const observer = observerRefs.current.get(tabId);\n        if (observer) {\n          observer.disconnect();\n          observerRefs.current.delete(tabId);\n        }\n\n        // Cleanup click handlers\n        const clickHandler = clickHandlerRefs.current.get(tabId);\n        if (clickHandler && iframe.contentDocument) {\n          try {\n            iframe.contentDocument.removeEventListener('click', clickHandler, true);\n          } catch {\n            // Cross-origin - ignore\n          }\n          clickHandlerRefs.current.delete(tabId);\n        }\n\n        // Cleanup navigation handlers\n        const navHandler = navigationHandlerRefs.current.get(tabId);\n        if (navHandler && iframe.contentWindow) {\n          try {\n            iframe.contentWindow.removeEventListener('popstate', navHandler);\n            iframe.contentWindow.removeEventListener('hashchange', navHandler);\n          } catch {\n            // Cross-origin - ignore\n          }\n          navigationHandlerRefs.current.delete(tabId);\n        }\n      });\n    };\n  }, [tabs, isElectron]);\n\n  // PR: Fix tab switch - render all iframes, toggle visibility with CSS\n  // Never unmount iframes - this preserves page state\n  return (\n    <div className=\"relative h-full w-full\">\n      {tabs.map(tab => {\n        const iframeUrl = getTabIframeUrl(tab, language);\n        const isActive = tab.id === activeTabId;\n        const _isBlocked = blockedTabs.current.has(tab.id);\n\n        // PR: Fix tab switch - always render iframe, toggle visibility\n        // Use stable key based on tab.id (not URL) to prevent React from recreating\n        // PR: Fix navigation - Update iframe src only when URL actually changes\n        const currentIframeUrl = iframeUrl || 'about:blank';\n        const iframe = iframeRefs.current.get(tab.id);\n        const needsSrcUpdate =\n          iframe && iframe.src !== currentIframeUrl && currentIframeUrl !== 'about:blank';\n\n        // Update src if needed (for initial load or programmatic navigation)\n        // Only update when tab is active to prevent unnecessary reloads\n        if (needsSrcUpdate && isActive) {\n          console.log('[TabIframeManager] Updating iframe src', {\n            tabId: tab.id,\n            oldSrc: iframe.src,\n            newSrc: currentIframeUrl,\n            isActive,\n          });\n          // Use requestAnimationFrame to ensure DOM is ready\n          requestAnimationFrame(() => {\n            const currentIframe = iframeRefs.current.get(tab.id);\n            if (currentIframe && tab.id === activeTabId) {\n              currentIframe.src = currentIframeUrl;\n            }\n          });\n        }\n\n        return (\n          <iframe\n            key={tab.id} // PR: Fix - stable key based on tab.id, not URL\n            ref={el => {\n              setIframeRef(tab.id)(el);\n              // Apply privacy mode when iframe is created\n              if (el && privacyMode) {\n                applyPrivacyModeToIframe(el, privacyMode);\n              }\n              // GVE Optimization: Apply performance optimizations\n              if (el && !isElectron) {\n                el.style.contentVisibility = isActive ? 'auto' : 'hidden';\n                el.style.contain = 'layout style paint';\n                el.setAttribute('fetchpriority', isActive ? 'high' : 'low');\n              }\n            }}\n            src={currentIframeUrl}\n            title={tab.title ?? 'Tab content'}\n            sandbox={privacyMode ? 'allow-scripts allow-forms allow-popups' : SAFE_IFRAME_SANDBOX}\n            allow=\"fullscreen; autoplay; camera; microphone; geolocation; payment; clipboard-read; clipboard-write; display-capture; storage-access\"\n            referrerPolicy={privacyMode ? 'no-referrer' : 'no-referrer-when-downgrade'}\n            loading={isActive ? 'eager' : 'lazy'}\n            className=\"absolute inset-0 h-full w-full border-0\"\n            style={{\n              // PR: Fix tab switch - toggle visibility with CSS, never unmount\n              // Show iframe if it's the active tab (regardless of iframeUrl to prevent flicker)\n              display: isActive ? 'block' : 'none',\n              pointerEvents: isActive ? 'auto' : 'none',\n              zIndex: isActive ? 1 : 0,\n              visibility: isActive ? 'visible' : 'hidden',\n              // GVE Optimization: Performance improvements\n              contentVisibility: isActive ? 'auto' : 'hidden',\n              contain: 'layout style paint',\n            }}\n            aria-label={\n              tab.title\n                ? `Content for ${tab.title}`\n                : iframeUrl\n                  ? `External content for ${new URL(iframeUrl).hostname}`\n                  : 'Tab content'\n            }\n            aria-live=\"off\"\n            onLoad={() => {\n              const iframe = iframeRefs.current.get(tab.id);\n              if (!iframe) return;\n\n              // PR: Fix navigation - Track URL changes and update tab store + title\n              try {\n                const win = iframe.contentWindow;\n                const doc = iframe.contentDocument;\n                let currentUrl: string | null = null;\n                let currentTitle: string | null = null;\n\n                // Try to read URL and title (works for same-origin only)\n                try {\n                  currentUrl = win?.location.href || null;\n                  currentTitle = doc?.title || null;\n                } catch {\n                  // Cross-origin - can't read, but navigation still works\n                  // Use iframe.src as fallback (may be stale for cross-origin navigation)\n                  currentUrl = iframe.src || null;\n                }\n\n                console.log('[TabIframeManager] Iframe loaded', {\n                  tabId: tab.id,\n                  currentUrl,\n                  currentTitle,\n                  iframeSrc: iframe.src,\n                  isActive,\n                });\n\n                // Update tab URL if it changed (navigation happened)\n                if (currentUrl && currentUrl !== tab.url && !currentUrl.startsWith('about:')) {\n                  console.log('[TabIframeManager] URL changed, updating tab', {\n                    tabId: tab.id,\n                    oldUrl: tab.url,\n                    newUrl: currentUrl,\n                  });\n\n                  // Update both URL and title\n                  const updates: { url: string; title?: string } = { url: currentUrl };\n                  if (currentTitle) {\n                    updates.title = currentTitle;\n                  } else {\n                    // Cross-origin: derive title from URL\n                    updates.title = deriveTitleFromUrl(currentUrl);\n                  }\n\n                  useTabsStore.getState().updateTab(tab.id, updates);\n                } else if (currentTitle && currentTitle !== tab.title) {\n                  // Title changed but URL didn't (e.g., page title update)\n                  console.log('[TabIframeManager] Title changed, updating tab', {\n                    tabId: tab.id,\n                    oldTitle: tab.title,\n                    newTitle: currentTitle,\n                  });\n                  useTabsStore.getState().updateTab(tab.id, { title: currentTitle });\n                } else if (!currentTitle && currentUrl && currentUrl !== tab.url) {\n                  // Cross-origin navigation: can't read title, derive from URL\n                  const derivedTitle = deriveTitleFromUrl(currentUrl);\n                  console.log(\n                    '[TabIframeManager] Cross-origin navigation, deriving title from URL',\n                    {\n                      tabId: tab.id,\n                      url: currentUrl,\n                      derivedTitle,\n                    }\n                  );\n                  useTabsStore\n                    .getState()\n                    .updateTab(tab.id, { url: currentUrl, title: derivedTitle });\n                }\n\n                // PR: Fix navigation - inject click interceptor and window.open override\n                // Only intercept popups, allow regular navigation\n                if (win && doc) {\n                  console.log('[TabIframeManager] Injecting interceptors for tab', tab.id);\n\n                  // Override window.open to intercept popups (but allow regular navigation)\n                  const _originalOpen = win.open;\n                  win.open = (url?: string | URL, target?: string, _features?: string) => {\n                    console.log('[TabIframeManager] window.open intercepted', {\n                      url,\n                      target,\n                      tabId: tab.id,\n                    });\n\n                    if (url) {\n                      const urlStr = typeof url === 'string' ? url : url.toString();\n                      // Post message to parent to create new tab\n                      window.postMessage(\n                        { type: 'open-in-new-tab', url: urlStr, sourceTabId: tab.id },\n                        '*' // In production, restrict to specific origin\n                      );\n                    }\n\n                    // Return null to prevent actual popup\n                    return null;\n                  };\n\n                  // Intercept anchor clicks: handle target=\"_blank\" for new tabs, track regular navigation\n                  const clickHandler = (e: MouseEvent) => {\n                    const target = e.target as HTMLElement;\n                    const anchor = target.closest?.('a') as HTMLAnchorElement | null;\n\n                    if (!anchor || !anchor.href) return;\n\n                    // Handle target=\"_blank\" - open in new tab\n                    if (anchor.target === '_blank' || anchor.target === '_new') {\n                      e.preventDefault();\n                      e.stopPropagation();\n\n                      console.log('[TabIframeManager] target=\"_blank\" click intercepted', {\n                        href: anchor.href,\n                        tabId: tab.id,\n                      });\n                      // Post message to parent to create new tab\n                      window.postMessage(\n                        { type: 'open-in-new-tab', url: anchor.href, sourceTabId: tab.id },\n                        '*' // In production, restrict to specific origin\n                      );\n                      return;\n                    }\n\n                    // PR: Fix navigation - Track regular link clicks to update tab URL immediately\n                    // This helps with cross-origin navigation where we can't read location.href after navigation\n                    if (\n                      anchor.href &&\n                      anchor.href !== tab.url &&\n                      !anchor.href.startsWith('about:')\n                    ) {\n                      // Extract absolute URL (anchor.href is always absolute)\n                      const clickedUrl = anchor.href;\n\n                      console.log('[TabIframeManager] Link clicked, updating tab URL', {\n                        tabId: tab.id,\n                        clickedUrl,\n                        currentUrl: tab.url,\n                      });\n\n                      // Update tab URL immediately (navigation will happen in iframe)\n                      // This ensures tab title/URL update even if we can't read it after navigation\n                      // Derive title from URL for immediate feedback (will be updated on load if same-origin)\n                      const derivedTitle = deriveTitleFromUrl(clickedUrl);\n                      useTabsStore\n                        .getState()\n                        .updateTab(tab.id, { url: clickedUrl, title: derivedTitle });\n\n                      // Note: We don't preventDefault - let the iframe navigate normally\n                      // The iframe will navigate, and onLoad will try to read the final URL/title\n                    }\n                  };\n\n                  // Store handler for cleanup\n                  clickHandlerRefs.current.set(tab.id, clickHandler);\n                  doc.addEventListener('click', clickHandler, true); // Use capture phase to catch early\n\n                  // PR: Fix navigation - Listen for navigation events to update URL and title\n                  // Track when iframe navigates (for same-tab navigation)\n                  const handleNavigation = () => {\n                    try {\n                      const newUrl = win.location.href;\n                      const newTitle = doc?.title || null;\n\n                      if (newUrl && newUrl !== tab.url && !newUrl.startsWith('about:')) {\n                        console.log(\n                          '[TabIframeManager] Navigation detected, updating URL and title',\n                          {\n                            tabId: tab.id,\n                            newUrl,\n                            newTitle,\n                          }\n                        );\n\n                        const updates: { url: string; title?: string } = { url: newUrl };\n                        if (newTitle) {\n                          updates.title = newTitle;\n                        }\n\n                        useTabsStore.getState().updateTab(tab.id, updates);\n                      } else if (newTitle && newTitle !== tab.title) {\n                        // Title changed without URL change\n                        console.log('[TabIframeManager] Title updated', {\n                          tabId: tab.id,\n                          newTitle,\n                        });\n                        useTabsStore.getState().updateTab(tab.id, { title: newTitle });\n                      }\n                    } catch {\n                      // Cross-origin - can't read location, but navigation will work\n                      console.log(\n                        '[TabIframeManager] Navigation detected (cross-origin, URL tracking limited)',\n                        tab.id\n                      );\n                    }\n                  };\n\n                  // Listen for popstate (back/forward) and hashchange\n                  const popstateHandler = handleNavigation;\n                  const hashchangeHandler = handleNavigation;\n\n                  // Store handlers for cleanup\n                  navigationHandlerRefs.current.set(tab.id, popstateHandler);\n\n                  win.addEventListener('popstate', popstateHandler);\n                  win.addEventListener('hashchange', hashchangeHandler);\n\n                  // Cleanup function stored for later\n                  const cleanup = () => {\n                    try {\n                      win.removeEventListener('popstate', popstateHandler);\n                      win.removeEventListener('hashchange', hashchangeHandler);\n                      navigationHandlerRefs.current.delete(tab.id);\n                    } catch {\n                      // Cross-origin access - ignore\n                    }\n                  };\n\n                  // Store cleanup for iframe unload\n                  (iframe as any)._cleanup = cleanup;\n\n                  // PR: Fix title tracking - Watch for title changes via MutationObserver\n                  if (doc) {\n                    const titleObserver = new MutationObserver(() => {\n                      try {\n                        const newTitle = doc.title;\n                        if (newTitle && newTitle !== tab.title) {\n                          console.log('[TabIframeManager] Title changed via MutationObserver', {\n                            tabId: tab.id,\n                            newTitle,\n                          });\n                          useTabsStore.getState().updateTab(tab.id, { title: newTitle });\n                        }\n                      } catch {\n                        // Cross-origin or other error\n                      }\n                    });\n\n                    // Observe title element changes\n                    const titleElement = doc.querySelector('title');\n                    if (titleElement) {\n                      titleObserver.observe(titleElement, {\n                        childList: true,\n                        subtree: true,\n                        characterData: true,\n                      });\n\n                      // Store observer for cleanup\n                      observerRefs.current.set(tab.id, titleObserver);\n                    }\n                  }\n\n                  console.log('[TabIframeManager] Interceptors installed for tab', tab.id);\n                } else {\n                  console.warn(\n                    '[TabIframeManager] Cannot access iframe contentWindow/contentDocument (cross-origin)',\n                    tab.id\n                  );\n                  // Cross-origin: navigation will still work, just can't track URL changes\n                }\n              } catch {\n                // Cross-origin frames will throw - this is expected\n                console.warn(\n                  '[TabIframeManager] Could not inject interceptors (cross-origin expected)',\n                  tab.id\n                );\n                // Navigation will still work in cross-origin iframes\n              }\n\n              // Check if blocked after load\n              try {\n                // Try to access contentWindow - will be null if blocked\n                if (!iframe.contentWindow && iframeUrl && !iframeUrl.startsWith('about:')) {\n                  console.warn('[TabIframeManager] X-Frame-Options detected on load', tab.id);\n                  blockedTabs.current.add(tab.id);\n                  window.dispatchEvent(\n                    new CustomEvent('iframe-blocked', {\n                      detail: { tabId: tab.id, url: tab.url },\n                    })\n                  );\n                }\n              } catch {\n                // Cross-origin access denied is normal\n              }\n            }}\n            onError={e => {\n              console.warn('[TabIframeManager] Iframe error', {\n                tabId: tab.id,\n                url: iframeUrl,\n                error: e,\n              });\n\n              // Mark as blocked if error occurs\n              if (iframeUrl && !iframeUrl.startsWith('about:')) {\n                blockedTabs.current.add(tab.id);\n                window.dispatchEvent(\n                  new CustomEvent('iframe-blocked', {\n                    detail: { tabId: tab.id, url: tab.url },\n                  })\n                );\n              }\n            }}\n          />\n        );\n      })}\n    </div>\n  );\n}\n","/**\r\n * Document Editing Commands for Command Palette\r\n * Integrates with GlobalSearch or standalone command system\r\n */\r\n\r\nimport { FileText, Sparkles, Languages, FileCheck, Table, LucideIcon } from 'lucide-react';\r\n\r\nexport interface DocumentCommand {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  icon: LucideIcon;\r\n  action: () => void;\r\n  keywords: string[];\r\n  category: 'document';\r\n}\r\n\r\nexport function getDocumentCommands(navigate: (path: string) => void): DocumentCommand[] {\r\n  return [\r\n    {\r\n      id: 'doc-edit-open',\r\n      title: 'Open Document Editor',\r\n      description: 'Open the document auto-edit interface',\r\n      icon: FileText,\r\n      action: () => navigate('/doc-editor'),\r\n      keywords: ['document', 'edit', 'doc', 'file', 'word', 'pdf', 'excel'],\r\n      category: 'document',\r\n    },\r\n    {\r\n      id: 'doc-rewrite',\r\n      title: 'Rewrite Document',\r\n      description: 'AI-powered document rewriting',\r\n      icon: Sparkles,\r\n      action: () => {\r\n        navigate('/doc-editor');\r\n        // Trigger rewrite task after navigation\r\n        setTimeout(() => {\r\n          window.dispatchEvent(new CustomEvent('doc-command', {\r\n            detail: { task: 'rewrite' },\r\n          }));\r\n        }, 500);\r\n      },\r\n      keywords: ['rewrite', 'rephrase', 'edit', 'improve'],\r\n      category: 'document',\r\n    },\r\n    {\r\n      id: 'doc-grammar',\r\n      title: 'Fix Grammar',\r\n      description: 'Fix grammar and spelling errors',\r\n      icon: FileCheck,\r\n      action: () => {\r\n        navigate('/doc-editor');\r\n        setTimeout(() => {\r\n          window.dispatchEvent(new CustomEvent('doc-command', {\r\n            detail: { task: 'grammar' },\r\n          }));\r\n        }, 500);\r\n      },\r\n      keywords: ['grammar', 'spell', 'check', 'fix', 'correct'],\r\n      category: 'document',\r\n    },\r\n    {\r\n      id: 'doc-translate',\r\n      title: 'Translate Document',\r\n      description: 'Translate document to another language',\r\n      icon: Languages,\r\n      action: () => {\r\n        navigate('/doc-editor');\r\n        setTimeout(() => {\r\n          window.dispatchEvent(new CustomEvent('doc-command', {\r\n            detail: { task: 'translate' },\r\n          }));\r\n        }, 500);\r\n      },\r\n      keywords: ['translate', 'language', 'convert', 'hindi', 'english'],\r\n      category: 'document',\r\n    },\r\n    {\r\n      id: 'doc-excel-normalize',\r\n      title: 'Normalize Excel Data',\r\n      description: 'Clean and normalize spreadsheet data',\r\n      icon: Table,\r\n      action: () => {\r\n        navigate('/doc-editor');\r\n        setTimeout(() => {\r\n          window.dispatchEvent(new CustomEvent('doc-command', {\r\n            detail: { task: 'normalize' },\r\n          }));\r\n        }, 500);\r\n      },\r\n      keywords: ['excel', 'normalize', 'clean', 'spreadsheet', 'data'],\r\n      category: 'document',\r\n    },\r\n  ];\r\n}\r\n\r\n","// Global Search Component - Ctrl+K / Cmd+K\n// Full-text search across Tabs, Notes, Research, Charts\n// Supports Hindi + English\n\nimport { useState, useEffect, useRef, useMemo } from 'react';\nimport { Search, X, FileText, Globe, BookOpen, BarChart3, Clock } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useNavigate } from 'react-router-dom';\nimport { useTabsStore } from '../../state/tabsStore';\nimport { multiSearch } from '../../lib/meili';\nimport { getDocumentCommands } from '../command-palette/DocumentCommands';\n\ninterface SearchResult {\n  id: string | number;\n  title?: string;\n  content?: string;\n  url?: string;\n  symbol?: string;\n  _index: string;\n  [key: string]: any;\n}\n\nexport function GlobalSearch() {\n  const [query, setQuery] = useState('');\n  const [results, setResults] = useState<SearchResult[]>([]);\n  const [open, setOpen] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [selectedIndex, setSelectedIndex] = useState(0);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const { tabs, setActive } = useTabsStore();\n  const navigate = useNavigate();\n\n  // Get document commands\n  const docCommands = useMemo(() => getDocumentCommands(navigate), [navigate]);\n\n  // Multi-search across all indexes + document commands\n  async function performSearch(searchQuery: string) {\n    if (searchQuery.length < 2) {\n      setResults([]);\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const allResults: SearchResult[] = [];\n\n      // 1. Search document commands (local, fast)\n      const queryLower = searchQuery.toLowerCase();\n      const matchingCommands = docCommands.filter(cmd => {\n        const searchable =\n          `${cmd.title} ${cmd.description} ${cmd.keywords.join(' ')}`.toLowerCase();\n        return searchable.includes(queryLower);\n      });\n\n      matchingCommands.forEach(cmd => {\n        allResults.push({\n          id: cmd.id,\n          title: cmd.title,\n          content: cmd.description,\n          _index: 'commands',\n          command: cmd,\n        });\n      });\n\n      // 2. Use MeiliSearch multi-search function for content\n      try {\n        const data = await multiSearch([\n          { indexUid: 'tabs', q: searchQuery, limit: 5 },\n          { indexUid: 'notes', q: searchQuery, limit: 5 },\n          { indexUid: 'research', q: searchQuery, limit: 5 },\n          { indexUid: 'charts', q: searchQuery, limit: 5 },\n        ]);\n\n        if (data.results && Array.isArray(data.results)) {\n          data.results.forEach((result: any) => {\n            if (result.hits && Array.isArray(result.hits)) {\n              result.hits.forEach((hit: any) => {\n                allResults.push({\n                  ...hit,\n                  _index: result.indexUid,\n                });\n              });\n            }\n          });\n        }\n      } catch {\n        // MeiliSearch not available, continue with commands only\n        console.debug('[GlobalSearch] MeiliSearch not available');\n      }\n\n      setResults(allResults);\n      setSelectedIndex(0);\n    } catch (error) {\n      console.error('[GlobalSearch] Search error:', error);\n      setResults([]);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  // Debounced search\n  useEffect(() => {\n    if (!open) return;\n\n    const timeoutId = setTimeout(() => {\n      performSearch(query);\n    }, 300);\n\n    return () => clearTimeout(timeoutId);\n  }, [query, open]);\n\n  // Keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Ctrl+K or Cmd+K to open\n      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {\n        e.preventDefault();\n        setOpen(true);\n        setTimeout(() => inputRef.current?.focus(), 100);\n      }\n\n      // Escape to close\n      if (e.key === 'Escape' && open) {\n        setOpen(false);\n        setQuery('');\n        setResults([]);\n      }\n\n      // Arrow keys to navigate\n      if (open && results.length > 0) {\n        if (e.key === 'ArrowDown') {\n          e.preventDefault();\n          setSelectedIndex(prev => Math.min(prev + 1, results.length - 1));\n        } else if (e.key === 'ArrowUp') {\n          e.preventDefault();\n          setSelectedIndex(prev => Math.max(prev - 1, 0));\n        } else if (e.key === 'Enter' && selectedIndex >= 0 && selectedIndex < results.length) {\n          e.preventDefault();\n          handleResultClick(results[selectedIndex]);\n        }\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [open, results, selectedIndex]);\n\n  // Auto-focus input when opened\n  useEffect(() => {\n    if (open) {\n      setTimeout(() => inputRef.current?.focus(), 100);\n    }\n  }, [open]);\n\n  const handleResultClick = (result: SearchResult) => {\n    // Handle document commands\n    if (result._index === 'commands' && (result as any).command) {\n      const cmd = (result as any).command;\n      cmd.action();\n      setOpen(false);\n      setQuery('');\n      setResults([]);\n      return;\n    }\n\n    if (result._index === 'tabs' && result.url) {\n      // Find or create tab\n      const existingTab = tabs.find(t => t.url === result.url);\n      if (existingTab) {\n        setActive(existingTab.id);\n      } else {\n        // Create new tab\n        useTabsStore.getState().add({\n          id: `tab-${Date.now()}`,\n          title: result.title || 'New Tab',\n          url: result.url,\n        });\n      }\n    } else if (result._index === 'notes' || result._index === 'research') {\n      // Open in research mode or notes view\n      // TODO: Implement navigation to notes/research\n      console.log('Open note/research:', result);\n    } else if (result._index === 'charts') {\n      // Open chart\n      // TODO: Implement chart navigation\n      console.log('Open chart:', result);\n    }\n\n    setOpen(false);\n    setQuery('');\n    setResults([]);\n  };\n\n  const getResultIcon = (result: SearchResult) => {\n    // Use command icon if available\n    if (result._index === 'commands' && (result as any).command) {\n      const Icon = (result as any).command.icon;\n      return <Icon size={16} className=\"text-cyan-400\" />;\n    }\n\n    switch (result._index) {\n      case 'tabs':\n        return <Globe size={16} className=\"text-blue-400\" />;\n      case 'notes':\n        return <FileText size={16} className=\"text-green-400\" />;\n      case 'research':\n        return <BookOpen size={16} className=\"text-purple-400\" />;\n      case 'charts':\n        return <BarChart3 size={16} className=\"text-yellow-400\" />;\n      case 'commands':\n        return <FileText size={16} className=\"text-cyan-400\" />;\n      default:\n        return <Search size={16} className=\"text-gray-400\" />;\n    }\n  };\n\n  const getResultTitle = (result: SearchResult) => {\n    return result.title || result.content || result.symbol || 'Untitled';\n  };\n\n  return (\n    <AnimatePresence>\n      {open && (\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          className=\"fixed inset-0 z-[99999] flex items-start justify-center bg-black/70 pt-32 backdrop-blur-sm\"\n          onClick={() => {\n            setOpen(false);\n            setQuery('');\n            setResults([]);\n          }}\n        >\n          <motion.div\n            initial={{ scale: 0.95, opacity: 0 }}\n            animate={{ scale: 1, opacity: 1 }}\n            exit={{ scale: 0.95, opacity: 0 }}\n            className=\"w-full max-w-3xl overflow-hidden rounded-2xl border border-purple-800 bg-gray-900 shadow-2xl\"\n            onClick={e => e.stopPropagation()}\n          >\n            {/* Search Input */}\n            <div className=\"flex items-center gap-4 border-b border-gray-800 px-6 py-4\">\n              <Search size={20} className=\"text-purple-400\" />\n              <input\n                ref={inputRef}\n                id=\"global-search-input\"\n                name=\"global-search-query\"\n                type=\"text\"\n                placeholder=\"Search tabs, notes, charts, research (Hindi bhi chalega)\"\n                className=\"flex-1 bg-transparent text-lg text-white placeholder-purple-400 outline-none\"\n                value={query}\n                onChange={e => setQuery(e.target.value)}\n                onKeyDown={e => {\n                  if (e.key === 'Escape') {\n                    setOpen(false);\n                    setQuery('');\n                    setResults([]);\n                  }\n                }}\n              />\n              {query && (\n                <button\n                  onClick={() => {\n                    setQuery('');\n                    setResults([]);\n                    inputRef.current?.focus();\n                  }}\n                  className=\"text-gray-400 hover:text-white\"\n                >\n                  <X size={18} />\n                </button>\n              )}\n            </div>\n\n            {/* Results */}\n            <div className=\"max-h-96 overflow-y-auto\">\n              {loading ? (\n                <div className=\"flex items-center justify-center py-12\">\n                  <div className=\"h-8 w-8 animate-spin rounded-full border-b-2 border-purple-400\"></div>\n                </div>\n              ) : results.length === 0 && query.length >= 2 ? (\n                <div className=\"py-12 text-center text-gray-500\">\n                  No results found for \"{query}\"\n                </div>\n              ) : results.length === 0 ? (\n                <div className=\"py-12 text-center text-gray-500\">\n                  <p className=\"mb-2\">Type to search...</p>\n                  <p className=\"text-sm text-gray-600\">\n                    Search across tabs, notes, research, and charts\n                  </p>\n                </div>\n              ) : (\n                results.map((result, index) => (\n                  <motion.div\n                    key={`${result._index}-${result.id}`}\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    transition={{ delay: index * 0.05 }}\n                    className={`flex cursor-pointer items-center gap-4 px-6 py-4 transition-colors ${\n                      index === selectedIndex\n                        ? 'border-l-2 border-purple-400 bg-purple-900/50'\n                        : 'hover:bg-purple-900/30'\n                    }`}\n                    onClick={() => handleResultClick(result)}\n                    onMouseEnter={() => setSelectedIndex(index)}\n                  >\n                    {getResultIcon(result)}\n                    <div className=\"min-w-0 flex-1\">\n                      <div className=\"mb-1 flex items-center gap-2\">\n                        <span className=\"text-xs font-medium uppercase text-purple-400\">\n                          {result._index}\n                        </span>\n                        {result.timestamp && (\n                          <span className=\"text-xs text-gray-500\">\n                            <Clock size={12} className=\"mr-1 inline\" />\n                            {new Date(result.timestamp).toLocaleDateString()}\n                          </span>\n                        )}\n                      </div>\n                      <div className=\"truncate font-medium text-white\">\n                        {getResultTitle(result)}\n                      </div>\n                      {result.content && result.content !== getResultTitle(result) && (\n                        <div className=\"mt-1 truncate text-sm text-gray-400\">\n                          {result.content.slice(0, 100)}\n                          {result.content.length > 100 ? '...' : ''}\n                        </div>\n                      )}\n                      {result.url && (\n                        <div className=\"mt-1 truncate text-xs text-gray-500\">{result.url}</div>\n                      )}\n                    </div>\n                  </motion.div>\n                ))\n              )}\n            </div>\n\n            {/* Footer hint */}\n            {results.length > 0 && (\n              <div className=\"flex items-center justify-between border-t border-gray-800 px-6 py-3 text-xs text-gray-500\">\n                <span> Navigate  Enter Select  Esc Close</span>\n                <span>\n                  {results.length} result{results.length !== 1 ? 's' : ''}\n                </span>\n              </div>\n            )}\n          </motion.div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n","/**\n * Iframe Blocked Fallback Handler - PR: Fix tab switch null issues\n * Handles X-Frame-Options blocking by opening URL in main Tauri webview or external browser\n */\n\nimport { isTauriRuntime } from '../lib/env';\nimport { invoke } from '@tauri-apps/api/core';\n\n/**\n * Handle iframe blocked event - open URL in main webview or external browser\n */\nexport async function handleIframeBlocked(tabId: string, url: string): Promise<void> {\n  console.log('[IframeBlockedFallback] Handling blocked iframe', { tabId, url });\n\n  if (isTauriRuntime()) {\n    try {\n      // Option 1: Emit event to navigate main Tauri webview to the URL\n      // The Tauri backend will emit an event that we listen to\n      await invoke('navigate_main_webview', { url });\n      console.log('[IframeBlockedFallback] Emitted navigation event');\n    } catch (error) {\n      console.warn(\n        '[IframeBlockedFallback] Failed to open in main webview, trying external browser',\n        error\n      );\n\n      // Option 2: Fallback to external browser\n      try {\n        await invoke('open_external', { url });\n        console.log('[IframeBlockedFallback] Opened in external browser');\n      } catch (extError) {\n        console.error('[IframeBlockedFallback] Failed to open in external browser', extError);\n        // Last resort: use window.open (may be blocked by popup blockers)\n        window.open(url, '_blank');\n      }\n    }\n  } else {\n    // Web/Electron: open in new window or external browser\n    window.open(url, '_blank');\n  }\n}\n\n/**\n * Setup global listener for iframe-blocked events\n */\nexport function setupIframeBlockedListener(): () => void {\n  const handler = (event: CustomEvent<{ tabId: string; url: string }>) => {\n    handleIframeBlocked(event.detail.tabId, event.detail.url);\n  };\n\n  window.addEventListener('iframe-blocked', handler as EventListener);\n\n  return () => {\n    window.removeEventListener('iframe-blocked', handler as EventListener);\n  };\n}\n","/**\r\n * useRedix Hook - React hook for Redix events\r\n */\r\n\r\nimport { useEffect, useRef } from 'react';\r\nimport { Redix, RedixEvent, RedixDispatchEvent } from './runtime';\r\n\r\n/**\r\n * Hook to watch for Redix events\r\n */\r\nexport function useRedix(\r\n  eventType: string | ((event: RedixEvent) => void),\r\n  handler?: (event: RedixEvent) => void\r\n): void {\r\n  const handlerRef = useRef(handler);\r\n\r\n  // Update handler ref when it changes\r\n  useEffect(() => {\r\n    handlerRef.current = handler;\r\n  }, [handler]);\r\n\r\n  useEffect(() => {\r\n    const actualHandler = typeof eventType === 'function' ? eventType : handlerRef.current;\r\n    if (!actualHandler) return;\r\n\r\n    const unsubscribe = Redix.watch(eventType as any, (event) => {\r\n      if (typeof eventType === 'string') {\r\n        actualHandler(event);\r\n      } else {\r\n        actualHandler(event);\r\n      }\r\n    });\r\n\r\n    return unsubscribe;\r\n  }, [eventType]);\r\n}\r\n\r\n/**\r\n * Hook to dispatch Redix events\r\n */\r\nexport function useRedixDispatch() {\r\n  return (event: RedixDispatchEvent) => {\r\n    Redix.dispatch(event);\r\n  };\r\n}\r\n\r\n","/**\n * Crash Recovery Dialog\n * Shows when a tab crashes and offers recovery options\n */\n\nimport { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { AlertTriangle, RotateCcw, X, RefreshCw } from 'lucide-react';\nimport { ipc } from '../lib/ipc-typed';\nimport { ipcEvents } from '../lib/ipc-events';\n\ninterface CrashRecoveryDialogProps {\n  tabId: string;\n  reason?: string;\n  exitCode?: number;\n  onClose: () => void;\n  onReload: () => void;\n}\n\nexport function CrashRecoveryDialog({\n  tabId: _tabId,\n  reason,\n  exitCode,\n  onClose,\n  onReload,\n}: CrashRecoveryDialogProps) {\n  const [snapshots] = useState<Array<{ id: string; timestamp: number }>>([]);\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    // Load available snapshots\n    const loadSnapshots = async () => {\n      try {\n        // Note: This would need to be added to IPC schema\n        // const result = await ipc.performance.snapshotList();\n        // setSnapshots(result.snapshots || []);\n      } catch (error) {\n        console.error('Failed to load snapshots:', error);\n      }\n    };\n    loadSnapshots();\n  }, []);\n\n  const handleReload = () => {\n    onReload();\n    onClose();\n  };\n\n  const handleRestoreSnapshot = async (_snapshotId: string) => {\n    setLoading(true);\n    try {\n      // Note: This would need to be added to IPC schema\n      // await ipc.performance.snapshotRestore({ snapshotId });\n      // Then restore tabs from snapshot\n      onClose();\n    } catch (error) {\n      console.error('Failed to restore snapshot:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <AnimatePresence>\n      <div\n        className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/50 backdrop-blur-sm\"\n        onClick={e => {\n          // Close on backdrop click\n          if (e.target === e.currentTarget) {\n            onClose();\n          }\n        }}\n      >\n        <motion.div\n          initial={{ opacity: 0, scale: 0.9 }}\n          animate={{ opacity: 1, scale: 1 }}\n          exit={{ opacity: 0, scale: 0.9 }}\n          className=\"rounded-2xl border border-red-500/40 bg-gray-900/95 backdrop-blur-xl shadow-2xl p-6 max-w-md w-full mx-4\"\n        >\n          <div className=\"flex items-start gap-4\">\n            <div className=\"rounded-full bg-red-500/20 p-3\">\n              <AlertTriangle size={24} className=\"text-red-400\" />\n            </div>\n            <div className=\"flex-1\">\n              <h3 className=\"text-lg font-semibold text-white mb-1\">Tab Crashed</h3>\n              <p className=\"text-sm text-gray-400 mb-4\">\n                This tab encountered an error and stopped responding.\n                {reason && (\n                  <span className=\"block mt-1 text-xs\">\n                    Reason: {reason}\n                    {exitCode !== undefined && ` (Exit code: ${exitCode})`}\n                  </span>\n                )}\n              </p>\n\n              <div className=\"flex flex-col gap-2\">\n                <button\n                  onClick={e => {\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                    handleReload();\n                  }}\n                  onMouseDown={e => {\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                  }}\n                  disabled={loading}\n                  className=\"flex items-center justify-center gap-2 rounded-lg border border-blue-500/60 bg-blue-500/20 px-4 py-2 text-sm font-medium text-blue-100 transition-colors hover:bg-blue-500/30 disabled:opacity-50 disabled:cursor-not-allowed\"\n                  style={{ zIndex: 10011, isolation: 'isolate' }}\n                >\n                  <RefreshCw size={16} />\n                  Reload Tab\n                </button>\n\n                {snapshots.length > 0 && (\n                  <div className=\"mt-2\">\n                    <p className=\"text-xs text-gray-500 mb-2\">Or restore from snapshot:</p>\n                    <div className=\"space-y-1 max-h-32 overflow-y-auto\">\n                      {snapshots.slice(0, 3).map(snapshot => (\n                        <button\n                          key={snapshot.id}\n                          onClick={e => {\n                            (e as any).stopImmediatePropagation();\n                            e.stopPropagation();\n                            handleRestoreSnapshot(snapshot.id);\n                          }}\n                          onMouseDown={e => {\n                            (e as any).stopImmediatePropagation();\n                            e.stopPropagation();\n                          }}\n                          disabled={loading}\n                          className=\"w-full flex items-center justify-between rounded-lg border border-gray-700/60 bg-gray-800/60 px-3 py-2 text-xs text-gray-300 transition-colors hover:bg-gray-700/60 disabled:opacity-50\"\n                          style={{ zIndex: 10011, isolation: 'isolate' }}\n                        >\n                          <span className=\"flex items-center gap-2\">\n                            <RotateCcw size={12} />\n                            {new Date(snapshot.timestamp).toLocaleString()}\n                          </span>\n                        </button>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                <button\n                  onClick={e => {\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                    onClose();\n                  }}\n                  onMouseDown={e => {\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                  }}\n                  className=\"mt-2 rounded-lg border border-gray-700/60 bg-gray-800/60 px-4 py-2 text-sm text-gray-400 transition-colors hover:bg-gray-700/60\"\n                  style={{ zIndex: 10011, isolation: 'isolate' }}\n                >\n                  Close\n                </button>\n              </div>\n            </div>\n            <button\n              onClick={e => {\n                (e as any).stopImmediatePropagation();\n                e.stopPropagation();\n                onClose();\n              }}\n              onMouseDown={e => {\n                (e as any).stopImmediatePropagation();\n                e.stopPropagation();\n              }}\n              className=\"rounded-lg p-1 text-gray-400 hover:text-gray-200 transition-colors\"\n              style={{ zIndex: 10011, isolation: 'isolate' }}\n            >\n              <X size={18} />\n            </button>\n          </div>\n        </motion.div>\n      </div>\n    </AnimatePresence>\n  );\n}\n\n/**\n * Hook to manage crash recovery dialog state\n */\nexport function useCrashRecovery() {\n  const [crashedTab, setCrashedTab] = useState<{\n    tabId: string;\n    reason?: string;\n    exitCode?: number;\n  } | null>(null);\n\n  useEffect(() => {\n    const handleCrash = (data: { tabId: string; reason?: string; exitCode?: number }) => {\n      setCrashedTab(data);\n    };\n\n    const unsubscribe = ipcEvents.on('tabs:crash-detected', handleCrash);\n    return unsubscribe;\n  }, []);\n\n  const handleReload = async () => {\n    if (!crashedTab) return;\n    try {\n      const tab = await ipc.tabs.list();\n      const crashedTabData = tab.find((t: any) => t.id === crashedTab.tabId);\n      if (crashedTabData) {\n        await ipc.tabs.reload(crashedTab.tabId);\n      } else {\n        // Tab was removed, create new one\n        await ipc.tabs.create('about:blank');\n      }\n    } catch (error) {\n      console.error('Failed to reload crashed tab:', error);\n    }\n  };\n\n  return {\n    crashedTab,\n    setCrashedTab,\n    handleReload,\n  };\n}\n","/**\n * useTokens Hook\n * Provides runtime access to design tokens\n */\n\nexport interface Tokens {\n  spacing: {\n    (n: number): string;\n    xs: string;\n    sm: string;\n    md: string;\n    lg: string;\n    xl: string;\n    '2xl': string;\n  };\n  fontSize: {\n    xs: string;\n    sm: string;\n    base: string;\n    lg: string;\n    xl: string;\n    '2xl': string;\n    '3xl': string;\n    '4xl': string;\n    '5xl': string;\n  };\n  color: {\n    primary: string;\n    primaryHover: string;\n    primaryActive: string;\n    surface: string;\n    surfaceHover: string;\n    surfaceActive: string;\n    border: string;\n    borderStrong: string;\n    text: string;\n    textMuted: string;\n    accent: string;\n  };\n  radius: {\n    sm: string;\n    md: string;\n    lg: string;\n    pill: string;\n  };\n  shadow: {\n    sm: string;\n    md: string;\n    lg: string;\n  };\n}\n\n/**\n * Get spacing token by number or name\n */\nfunction getSpacing(n: number | string): string {\n  if (typeof n === 'string') {\n    return `var(--space-${n})`;\n  }\n  return `var(--space-${n})`;\n}\n\n/**\n * useTokens Hook\n * Returns design tokens for runtime use\n */\nexport function useTokens(): Tokens {\n  return {\n    spacing: Object.assign(getSpacing, {\n      xs: 'var(--space-2)',\n      sm: 'var(--space-3)',\n      md: 'var(--space-4)',\n      lg: 'var(--space-6)',\n      xl: 'var(--space-8)',\n      '2xl': 'var(--space-10)',\n    }),\n    fontSize: {\n      xs: 'var(--font-size-xs)',\n      sm: 'var(--font-size-sm)',\n      base: 'var(--font-size-base)',\n      lg: 'var(--font-size-lg)',\n      xl: 'var(--font-size-xl)',\n      '2xl': 'var(--font-size-2xl)',\n      '3xl': 'var(--font-size-3xl)',\n      '4xl': 'var(--font-size-4xl)',\n      '5xl': 'var(--font-size-5xl)',\n    },\n    color: {\n      primary: 'var(--color-primary-500)',\n      primaryHover: 'var(--color-primary-400)',\n      primaryActive: 'var(--color-primary-600)',\n      surface: 'var(--surface-panel)',\n      surfaceHover: 'var(--surface-hover)',\n      surfaceActive: 'var(--surface-active)',\n      border: 'var(--surface-border)',\n      borderStrong: 'var(--surface-border-strong)',\n      text: 'var(--text-primary)',\n      textMuted: 'var(--text-muted)',\n      accent: 'var(--accent)',\n    },\n    radius: {\n      sm: 'var(--radius-md, 0.375rem)',\n      md: 'var(--radius-lg, 0.5rem)',\n      lg: 'var(--radius-2xl, 1rem)',\n      pill: '9999px',\n    },\n    shadow: {\n      sm: 'var(--shadow-sm)',\n      md: 'var(--shadow-md)',\n      lg: 'var(--shadow-lg)',\n    },\n  };\n}\n\n/**\n * getTokens - Non-hook version for use outside React components\n */\nexport function getTokens(): Tokens {\n  return useTokens();\n}\n","/**\n * Skeleton Loaders - Unified loading states\n * Chrome-like skeleton screens for consistent UX\n */\n\nimport React from 'react';\nimport { motion } from 'framer-motion';\nimport { cn } from '../lib/utils';\n\nexport interface SkeletonProps extends React.HTMLAttributes<HTMLDivElement> {\n  variant?: 'text' | 'circular' | 'rectangular' | 'rounded';\n  width?: string | number;\n  height?: string | number;\n  animate?: boolean;\n}\n\nconst skeletonBase = 'bg-slate-800/60 rounded';\nconst skeletonAnimation = 'animate-pulse';\n\nconst variantStyles = {\n  text: 'h-4',\n  circular: 'rounded-full',\n  rectangular: 'rounded-md',\n  rounded: 'rounded-lg',\n};\n\nexport const Skeleton = React.forwardRef<HTMLDivElement, SkeletonProps>(\n  ({ variant = 'rectangular', width, height, animate = true, className, style, ...props }, ref) => {\n    const variantClass = variantStyles[variant];\n    const customStyle: React.CSSProperties = {\n      width: width ? (typeof width === 'number' ? `${width}px` : width) : undefined,\n      height: height ? (typeof height === 'number' ? `${height}px` : height) : undefined,\n      ...style,\n    };\n\n    const motionProps = {\n      initial: { opacity: 0.6 },\n      animate: { opacity: [0.6, 1, 0.6] },\n      transition: { duration: 1.5, repeat: Infinity, ease: 'easeInOut' as const },\n    };\n\n    return (\n      <motion.div\n        ref={ref}\n        className={cn(skeletonBase, variantClass, animate && skeletonAnimation, className)}\n        style={customStyle}\n        {...motionProps}\n        aria-busy=\"true\"\n        aria-label=\"Loading content\"\n        {...(props as any)}\n      />\n    );\n  }\n);\n\nSkeleton.displayName = 'Skeleton';\n\n/**\n * Skeleton Text - For text content\n */\nexport function SkeletonText({\n  lines = 3,\n  className,\n  ...props\n}: { lines?: number; className?: string } & React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div className={cn('space-y-2', className)} {...props}>\n      {Array.from({ length: lines }).map((_, i) => (\n        <Skeleton key={i} variant=\"text\" width={i === lines - 1 ? '75%' : '100%'} className=\"h-4\" />\n      ))}\n    </div>\n  );\n}\n\n/**\n * Skeleton Card - For card content\n */\nexport function SkeletonCard({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\n        'rounded-xl border border-slate-700/60 bg-slate-900/40 p-4 space-y-3',\n        className\n      )}\n      data-testid=\"skeleton-card\"\n      {...props}\n    >\n      <Skeleton variant=\"rectangular\" height={20} width=\"60%\" />\n      <SkeletonText lines={3} />\n      <div className=\"flex items-center gap-2\">\n        <Skeleton variant=\"circular\" width={32} height={32} />\n        <Skeleton variant=\"text\" width=\"40%\" height={16} />\n      </div>\n    </div>\n  );\n}\n\n/**\n * Skeleton List - For list content\n */\nexport function SkeletonList({\n  items = 5,\n  className,\n  ...props\n}: { items?: number; className?: string } & React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div className={cn('space-y-2', className)} {...props}>\n      {Array.from({ length: items }).map((_, i) => (\n        <div key={i} className=\"flex items-center gap-3 p-2 rounded-lg\">\n          <Skeleton variant=\"circular\" width={40} height={40} />\n          <div className=\"flex-1 space-y-2\">\n            <Skeleton variant=\"text\" width=\"70%\" height={16} />\n            <Skeleton variant=\"text\" width=\"50%\" height={12} />\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n\n/**\n * Skeleton Table - For table content\n */\nexport function SkeletonTable({\n  rows = 5,\n  cols = 4,\n  className,\n  ...props\n}: { rows?: number; cols?: number; className?: string } & React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div className={cn('space-y-2', className)} {...props}>\n      {/* Header */}\n      <div className=\"flex gap-2 pb-2 border-b border-slate-700/60\">\n        {Array.from({ length: cols }).map((_, i) => (\n          <Skeleton key={i} variant=\"text\" width=\"100%\" height={20} />\n        ))}\n      </div>\n      {/* Rows */}\n      {Array.from({ length: rows }).map((_, rowIdx) => (\n        <div key={rowIdx} className=\"flex gap-2\">\n          {Array.from({ length: cols }).map((_, colIdx) => (\n            <Skeleton key={colIdx} variant=\"text\" width=\"100%\" height={16} />\n          ))}\n        </div>\n      ))}\n    </div>\n  );\n}\n","import { forwardRef } from 'react';\nimport { Loader2 } from 'lucide-react';\nimport { motion, HTMLMotionProps } from 'framer-motion';\n\nimport { cn } from '../lib/utils';\n\ntype ButtonTone = 'primary' | 'secondary' | 'ghost' | 'danger';\ntype ButtonSize = 'sm' | 'md' | 'lg';\n\nexport interface ButtonProps extends Omit<HTMLMotionProps<'button'>, 'size' | 'children'> {\n  tone?: ButtonTone;\n  size?: ButtonSize;\n  loading?: boolean;\n  icon?: React.ReactNode;\n  trailingIcon?: React.ReactNode;\n  fullWidth?: boolean;\n  children?: React.ReactNode;\n}\n\nconst toneClassMap: Record<ButtonTone, string> = {\n  primary:\n    'bg-[var(--color-primary-600)] text-white shadow-[0_12px_20px_rgba(37,99,235,0.25)] hover:bg-[var(--color-primary-500)] focus-visible:ring-[var(--color-primary-400)]',\n  secondary:\n    'bg-[var(--surface-elevated)] text-[var(--text-primary)] border border-[var(--surface-border)] hover:bg-[var(--surface-hover)] focus-visible:ring-[var(--surface-border-strong)]',\n  ghost:\n    'bg-transparent text-[var(--text-primary)] hover:bg-[var(--surface-hover)] focus-visible:ring-[var(--surface-border)]',\n  danger: 'bg-[#dc2626] text-white hover:bg-[#b91c1c] focus-visible:ring-[#f87171]',\n};\n\nconst sizeClassMap: Record<ButtonSize, string> = {\n  sm: 'h-8 px-3 text-xs gap-1.5',\n  md: 'h-10 px-4 text-sm gap-2',\n  lg: 'h-12 px-6 text-base gap-2.5',\n};\n\nexport const Button = forwardRef<HTMLButtonElement, ButtonProps>(\n  (\n    {\n      tone = 'primary',\n      size = 'md',\n      loading = false,\n      icon,\n      trailingIcon,\n      fullWidth,\n      disabled,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isDisabled = disabled || loading;\n\n    return (\n      <motion.button\n        {...props}\n        ref={ref}\n        className={cn(\n          'inline-flex items-center justify-center rounded-full font-medium transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--surface-root)]',\n          toneClassMap[tone],\n          sizeClassMap[size],\n          fullWidth && 'w-full',\n          isDisabled && 'opacity-50 cursor-not-allowed',\n          className\n        )}\n        disabled={isDisabled}\n        whileHover={!isDisabled ? { scale: 1.015 } : undefined}\n        whileTap={!isDisabled ? { scale: 0.97 } : undefined}\n      >\n        {loading ? (\n          <>\n            <Loader2 className=\"animate-spin\" size={size === 'sm' ? 14 : size === 'md' ? 16 : 18} />\n            <span>Loading</span>\n          </>\n        ) : (\n          <>\n            {icon && <span className=\"flex-shrink-0\">{icon}</span>}\n            {children && <span className=\"truncate\">{children}</span>}\n            {trailingIcon && <span className=\"flex-shrink-0\">{trailingIcon}</span>}\n          </>\n        )}\n      </motion.button>\n    );\n  }\n);\n\nButton.displayName = 'Button';\n\n/**\n * IconButton - Icon-only button variant\n */\nexport interface IconButtonProps extends Omit<ButtonProps, 'icon' | 'trailingIcon' | 'children'> {\n  icon: React.ReactNode;\n  'aria-label': string;\n}\n\nexport const IconButton = forwardRef<HTMLButtonElement, IconButtonProps>(\n  ({ icon, size = 'md', ...props }, ref) => {\n    const iconSize = size === 'sm' ? 16 : size === 'md' ? 18 : 20;\n\n    return (\n      <Button\n        ref={ref}\n        {...props}\n        size={size}\n        className={cn(\n          'rounded-full p-0',\n          size === 'sm' && 'w-8 h-8',\n          size === 'md' && 'w-10 h-10',\n          size === 'lg' && 'w-12 h-12',\n          props.className\n        )}\n      >\n        <span\n          style={{ width: iconSize, height: iconSize }}\n          className=\"flex items-center justify-center\"\n        >\n          {icon}\n        </span>\n      </Button>\n    );\n  }\n);\n\nIconButton.displayName = 'IconButton';\n\n/**\n * FAB - Floating Action Button\n */\nexport interface FABProps extends Omit<ButtonProps, 'size'> {\n  position?: 'bottom-right' | 'bottom-left' | 'top-right' | 'top-left';\n  fixed?: boolean;\n}\n\nexport const FAB = forwardRef<HTMLButtonElement, FABProps>(\n  ({ position = 'bottom-right', fixed = true, className, ...props }, ref) => {\n    const positionClasses = {\n      'bottom-right': fixed ? 'fixed bottom-6 right-6' : '',\n      'bottom-left': fixed ? 'fixed bottom-6 left-6' : '',\n      'top-right': fixed ? 'fixed top-6 right-6' : '',\n      'top-left': fixed ? 'fixed top-6 left-6' : '',\n    };\n\n    return (\n      <Button\n        ref={ref}\n        {...props}\n        size=\"lg\"\n        className={cn('rounded-full shadow-lg z-50', positionClasses[position], className)}\n      />\n    );\n  }\n);\n\nFAB.displayName = 'FAB';\n","import { forwardRef } from 'react';\n\nimport { cn } from '../lib/utils';\n\nexport interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {\n  leadingIcon?: React.ReactNode;\n  trailingIcon?: React.ReactNode;\n}\n\nexport const Input = forwardRef<HTMLInputElement, InputProps>(\n  ({ className, leadingIcon, trailingIcon, disabled, ...props }, ref) => {\n    return (\n      <label\n        className={cn(\n          'inline-flex h-11 items-center gap-2 rounded-2xl border border-[var(--surface-border)] bg-[var(--surface-elevated)] px-3 text-sm text-[var(--text-primary)] transition focus-within:border-[var(--surface-border-strong)] focus-within:ring-2 focus-within:ring-[var(--accent)]',\n          disabled && 'opacity-60 cursor-not-allowed',\n          className\n        )}\n      >\n        {leadingIcon && <span className=\"text-[var(--text-muted)]\">{leadingIcon}</span>}\n        <input\n          {...props}\n          ref={ref}\n          disabled={disabled}\n          className=\"h-full flex-1 bg-transparent text-[var(--text-primary)] placeholder:text-[var(--text-muted)] focus:outline-none\"\n        />\n        {trailingIcon && <span className=\"text-[var(--text-muted)]\">{trailingIcon}</span>}\n      </label>\n    );\n  }\n);\n\nInput.displayName = 'Input';\n\nexport interface TextAreaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {\n  label?: string;\n}\n\nexport const TextArea = forwardRef<HTMLTextAreaElement, TextAreaProps>(\n  ({ className, label, disabled, ...props }, ref) => (\n    <div className=\"space-y-1.5\">\n      {label && (\n        <p className=\"text-xs uppercase tracking-[0.2em] text-[var(--text-muted)]\">{label}</p>\n      )}\n      <textarea\n        {...props}\n        ref={ref}\n        disabled={disabled}\n        className={cn(\n          'w-full rounded-2xl border border-[var(--surface-border)] bg-[var(--surface-elevated)] px-3 py-2 text-sm text-[var(--text-primary)] placeholder:text-[var(--text-muted)] transition focus:border-[var(--surface-border-strong)] focus:outline-none focus:ring-2 focus:ring-[var(--accent)]',\n          disabled && 'opacity-60 cursor-not-allowed',\n          className\n        )}\n      />\n    </div>\n  )\n);\n\nTextArea.displayName = 'TextArea';\n","/**\n * Create Memory Dialog\n * Modal for creating new memory events (notes, bookmarks, tasks)\n */\n\nimport React, { useState, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { X, FileText, Bookmark, CheckSquare, Tag, Link, Plus } from 'lucide-react';\nimport { trackNote, trackBookmark, trackTask } from '../../core/supermemory/tracker';\nimport { showToast } from '../../state/toastStore';\nimport { useTokens } from '../../ui/useTokens';\nimport { Button } from '../../ui/button';\nimport { Input, TextArea } from '../../ui/input';\nimport type { MemoryEventType } from '../../core/supermemory/event-types';\n\ninterface CreateMemoryDialogProps {\n  open: boolean;\n  onClose: () => void;\n  onCreated?: () => void;\n  initialType?: MemoryEventType;\n  initialUrl?: string;\n  initialTitle?: string;\n}\n\ntype MemoryFormType = 'note' | 'bookmark' | 'task';\n\nconst MEMORY_TYPES: Array<{\n  value: MemoryFormType;\n  label: string;\n  icon: React.ComponentType<any>;\n  description: string;\n}> = [\n  { value: 'note', label: 'Note', icon: FileText, description: 'Save a text note with tags' },\n  { value: 'bookmark', label: 'Bookmark', icon: Bookmark, description: 'Bookmark a URL for later' },\n  {\n    value: 'task',\n    label: 'Task',\n    icon: CheckSquare,\n    description: 'Create a task with optional due date',\n  },\n];\n\nexport function CreateMemoryDialog({\n  open,\n  onClose,\n  onCreated,\n  initialType,\n  initialUrl,\n  initialTitle,\n}: CreateMemoryDialogProps) {\n  const tokens = useTokens();\n  const [type, setType] = useState<MemoryFormType>(\n    (initialType === 'note' || initialType === 'bookmark' || initialType === 'task'\n      ? initialType\n      : 'note') as MemoryFormType\n  );\n  const [title, setTitle] = useState(initialTitle || '');\n  const [url, setUrl] = useState(initialUrl || '');\n  const [content, setContent] = useState('');\n  const [tags, setTags] = useState<string[]>([]);\n  const [tagInput, setTagInput] = useState('');\n  const [priority, setPriority] = useState<'low' | 'medium' | 'high'>('medium');\n  const [dueDate, setDueDate] = useState('');\n  const [loading, setLoading] = useState(false);\n\n  const handleAddTag = useCallback(() => {\n    const trimmed = tagInput.trim();\n    if (trimmed && !tags.includes(trimmed)) {\n      setTags([...tags, trimmed.startsWith('#') ? trimmed : `#${trimmed}`]);\n      setTagInput('');\n    }\n  }, [tagInput, tags]);\n\n  const handleRemoveTag = useCallback(\n    (tagToRemove: string) => {\n      setTags(tags.filter(t => t !== tagToRemove));\n    },\n    [tags]\n  );\n\n  const handleTagInputKeyDown = useCallback(\n    (e: React.KeyboardEvent<HTMLInputElement>) => {\n      if (e.key === 'Enter' || e.key === ',') {\n        e.preventDefault();\n        handleAddTag();\n      }\n    },\n    [handleAddTag]\n  );\n\n  const handleSubmit = useCallback(\n    async (e: React.FormEvent) => {\n      e.preventDefault();\n      setLoading(true);\n\n      try {\n        let eventId = '';\n\n        if (type === 'note') {\n          if (!content.trim()) {\n            showToast('error', 'Note content is required');\n            setLoading(false);\n            return;\n          }\n          eventId = await trackNote(url || window.location.href, {\n            title: title || 'Untitled Note',\n            notePreview: content,\n            noteLength: content.length,\n            tags: tags.length > 0 ? tags : undefined,\n            url: url || undefined,\n          });\n        } else if (type === 'bookmark') {\n          if (!url.trim()) {\n            showToast('error', 'URL is required for bookmarks');\n            setLoading(false);\n            return;\n          }\n          const bookmarkMetadata: any = {\n            title: title || 'Untitled Bookmark',\n          };\n          if (tags.length > 0) {\n            bookmarkMetadata.tags = tags;\n          }\n          eventId = await trackBookmark(url, bookmarkMetadata);\n        } else if (type === 'task') {\n          if (!title.trim()) {\n            showToast('error', 'Task title is required');\n            setLoading(false);\n            return;\n          }\n          // trackTask doesn't support tags directly, but we can add them to metadata\n          const taskMetadata: any = {\n            url: url || undefined,\n            notes: content || undefined,\n            priority,\n            dueDate: dueDate ? new Date(dueDate).getTime() : undefined,\n          };\n          if (tags.length > 0) {\n            taskMetadata.tags = tags;\n          }\n          eventId = await trackTask(title, taskMetadata);\n        }\n\n        if (eventId) {\n          showToast(\n            'success',\n            `${MEMORY_TYPES.find(t => t.value === type)?.label} created successfully`\n          );\n          // Reset form\n          setTitle('');\n          setUrl('');\n          setContent('');\n          setTags([]);\n          setTagInput('');\n          setPriority('medium');\n          setDueDate('');\n          onCreated?.();\n          onClose();\n        } else {\n          showToast('error', 'Failed to create memory');\n        }\n      } catch (error) {\n        console.error('[CreateMemoryDialog] Failed to create memory:', error);\n        showToast('error', 'Failed to create memory');\n      } finally {\n        setLoading(false);\n      }\n    },\n    [type, title, url, content, tags, priority, dueDate, onCreated, onClose]\n  );\n\n  const handleClose = useCallback(() => {\n    if (!loading) {\n      onClose();\n    }\n  }, [loading, onClose]);\n\n  if (!open) return null;\n\n  const selectedTypeInfo = MEMORY_TYPES.find(t => t.value === type);\n\n  return (\n    <AnimatePresence>\n      {open && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={handleClose}\n            className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50\"\n            aria-hidden=\"true\"\n          />\n\n          {/* Dialog */}\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\n            transition={{ type: 'spring', damping: 25, stiffness: 300 }}\n            className=\"fixed inset-0 z-50 flex items-center justify-center p-4\"\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-labelledby=\"create-memory-title\"\n          >\n            <div\n              className=\"w-full max-w-lg bg-[var(--surface-root)] border border-[var(--surface-border)] rounded-xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden\"\n              onClick={e => e.stopPropagation()}\n            >\n              {/* Header */}\n              <div\n                className=\"flex items-center justify-between border-b border-[var(--surface-border)]\"\n                style={{ padding: tokens.spacing(4) }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  {selectedTypeInfo && (\n                    <selectedTypeInfo.icon\n                      size={20}\n                      className=\"text-[var(--color-primary-400)] flex-shrink-0\"\n                    />\n                  )}\n                  <h2\n                    id=\"create-memory-title\"\n                    className=\"font-semibold text-[var(--text-primary)]\"\n                    style={{ fontSize: tokens.fontSize.lg }}\n                  >\n                    Create Memory\n                  </h2>\n                </div>\n                <button\n                  onClick={e => {\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                    handleClose();\n                  }}\n                  onMouseDown={e => {\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                  }}\n                  disabled={loading}\n                  className=\"rounded-lg p-1.5 text-[var(--text-muted)] hover:text-[var(--text-primary)] hover:bg-[var(--surface-hover)] transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] disabled:opacity-50\"\n                  style={{ zIndex: 10011, isolation: 'isolate' }}\n                  aria-label=\"Close dialog\"\n                >\n                  <X size={18} />\n                </button>\n              </div>\n\n              {/* Type Selector */}\n              <div\n                className=\"border-b border-[var(--surface-border)]\"\n                style={{ padding: tokens.spacing(3), paddingTop: tokens.spacing(2) }}\n              >\n                <div className=\"flex gap-2\">\n                  {MEMORY_TYPES.map(typeOption => {\n                    const Icon = typeOption.icon;\n                    return (\n                      <button\n                        key={typeOption.value}\n                        onClick={e => {\n                          (e as any).stopImmediatePropagation();\n                          e.stopPropagation();\n                          setType(typeOption.value);\n                        }}\n                        onMouseDown={e => {\n                          (e as any).stopImmediatePropagation();\n                          e.stopPropagation();\n                        }}\n                        className={`\n                          flex-1 flex flex-col items-center gap-2 px-3 py-2.5 rounded-lg border transition-all\n                          ${\n                            type === typeOption.value\n                              ? 'bg-[var(--color-primary-600)] border-[var(--color-primary-500)] text-white'\n                              : 'bg-[var(--surface-elevated)] border-[var(--surface-border)] text-[var(--text-secondary)] hover:bg-[var(--surface-hover)]'\n                          }\n                          focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1\n                        `}\n                        style={{ zIndex: 10011, isolation: 'isolate' }}\n                        aria-pressed={type === typeOption.value}\n                      >\n                        <Icon size={18} />\n                        <div className=\"text-xs font-medium\">{typeOption.label}</div>\n                      </button>\n                    );\n                  })}\n                </div>\n              </div>\n\n              {/* Form */}\n              <form\n                onSubmit={e => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  void handleSubmit(e);\n                }}\n                className=\"flex-1 overflow-y-auto\"\n                style={{ padding: tokens.spacing(4) }}\n                onMouseDown={e => {\n                  // Don't interfere with form submission\n                  const target = e.target as HTMLElement;\n                  if (\n                    target.closest('button[type=\"submit\"]') ||\n                    target.closest('input') ||\n                    target.closest('textarea') ||\n                    target.closest('select')\n                  ) {\n                    return;\n                  }\n                }}\n                onClick={e => {\n                  // Don't interfere with form submission\n                  const target = e.target as HTMLElement;\n                  if (\n                    target.closest('button[type=\"submit\"]') ||\n                    target.closest('input') ||\n                    target.closest('textarea') ||\n                    target.closest('select')\n                  ) {\n                    return;\n                  }\n                }}\n              >\n                <div className=\"space-y-4\">\n                  {/* Title */}\n                  <div>\n                    <label\n                      htmlFor=\"memory-title\"\n                      className=\"block text-sm font-medium text-[var(--text-primary)] mb-1.5\"\n                      style={{ fontSize: tokens.fontSize.sm }}\n                    >\n                      Title {type === 'task' && <span className=\"text-red-400\">*</span>}\n                    </label>\n                    <Input\n                      id=\"memory-title\"\n                      value={title}\n                      onChange={e => setTitle(e.target.value)}\n                      placeholder={type === 'task' ? 'Task title...' : 'Optional title...'}\n                      required={type === 'task'}\n                      disabled={loading}\n                    />\n                  </div>\n\n                  {/* URL */}\n                  {(type === 'bookmark' || type === 'note') && (\n                    <div>\n                      <label\n                        htmlFor=\"memory-url\"\n                        className=\"block text-sm font-medium text-[var(--text-primary)] mb-1.5\"\n                        style={{ fontSize: tokens.fontSize.sm }}\n                      >\n                        URL {type === 'bookmark' && <span className=\"text-red-400\">*</span>}\n                      </label>\n                      <div className=\"flex items-center gap-2\">\n                        <Link size={16} className=\"text-[var(--text-muted)] flex-shrink-0\" />\n                        <Input\n                          id=\"memory-url\"\n                          type=\"url\"\n                          value={url}\n                          onChange={e => setUrl(e.target.value)}\n                          placeholder=\"https://example.com\"\n                          required={type === 'bookmark'}\n                          disabled={loading}\n                        />\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Content/Notes */}\n                  {(type === 'note' || type === 'task') && (\n                    <div>\n                      <label\n                        htmlFor=\"memory-content\"\n                        className=\"block text-sm font-medium text-[var(--text-primary)] mb-1.5\"\n                        style={{ fontSize: tokens.fontSize.sm }}\n                      >\n                        {type === 'note' ? 'Content' : 'Notes'}{' '}\n                        {type === 'note' && <span className=\"text-red-400\">*</span>}\n                      </label>\n                      <TextArea\n                        id=\"memory-content\"\n                        value={content}\n                        onChange={e => setContent(e.target.value)}\n                        placeholder={type === 'note' ? 'Write your note...' : 'Optional notes...'}\n                        rows={type === 'note' ? 6 : 4}\n                        required={type === 'note'}\n                        disabled={loading}\n                      />\n                    </div>\n                  )}\n\n                  {/* Task-specific fields */}\n                  {type === 'task' && (\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div>\n                        <label\n                          htmlFor=\"memory-priority\"\n                          className=\"block text-sm font-medium text-[var(--text-primary)] mb-1.5\"\n                          style={{ fontSize: tokens.fontSize.sm }}\n                        >\n                          Priority\n                        </label>\n                        <select\n                          id=\"memory-priority\"\n                          value={priority}\n                          onChange={e => setPriority(e.target.value as 'low' | 'medium' | 'high')}\n                          className=\"w-full px-3 py-2 rounded-lg bg-[var(--surface-panel)] border border-[var(--surface-border)] text-[var(--text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)]\"\n                          style={{ fontSize: tokens.fontSize.sm }}\n                          disabled={loading}\n                        >\n                          <option value=\"low\">Low</option>\n                          <option value=\"medium\">Medium</option>\n                          <option value=\"high\">High</option>\n                        </select>\n                      </div>\n                      <div>\n                        <label\n                          htmlFor=\"memory-due-date\"\n                          className=\"block text-sm font-medium text-[var(--text-primary)] mb-1.5\"\n                          style={{ fontSize: tokens.fontSize.sm }}\n                        >\n                          Due Date\n                        </label>\n                        <Input\n                          id=\"memory-due-date\"\n                          type=\"date\"\n                          value={dueDate}\n                          onChange={e => setDueDate(e.target.value)}\n                          disabled={loading}\n                        />\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Tags */}\n                  <div>\n                    <label\n                      htmlFor=\"memory-tags\"\n                      className=\"block text-sm font-medium text-[var(--text-primary)] mb-1.5\"\n                      style={{ fontSize: tokens.fontSize.sm }}\n                    >\n                      Tags\n                    </label>\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <Tag size={16} className=\"text-[var(--text-muted)] flex-shrink-0\" />\n                      <Input\n                        id=\"memory-tags\"\n                        value={tagInput}\n                        onChange={e => setTagInput(e.target.value)}\n                        onKeyDown={handleTagInputKeyDown}\n                        placeholder=\"Add tags (press Enter or comma)\"\n                        disabled={loading}\n                      />\n                      <Button\n                        type=\"button\"\n                        tone=\"secondary\"\n                        size=\"sm\"\n                        icon={<Plus size={14} />}\n                        onClick={e => {\n                          (e as any).stopImmediatePropagation();\n                          e.stopPropagation();\n                          handleAddTag();\n                        }}\n                        onMouseDown={e => {\n                          (e as any).stopImmediatePropagation();\n                          e.stopPropagation();\n                        }}\n                        disabled={loading || !tagInput.trim()}\n                        style={{ zIndex: 10011, isolation: 'isolate' }}\n                      >\n                        Add\n                      </Button>\n                    </div>\n                    {tags.length > 0 && (\n                      <div className=\"flex flex-wrap gap-2\">\n                        {tags.map(tag => (\n                          <span\n                            key={tag}\n                            className=\"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-[var(--surface-elevated)] text-[var(--color-primary-300)] text-xs\"\n                            style={{ fontSize: tokens.fontSize.xs }}\n                          >\n                            {tag}\n                            <button\n                              type=\"button\"\n                              onClick={e => {\n                                (e as any).stopImmediatePropagation();\n                                e.stopPropagation();\n                                handleRemoveTag(tag);\n                              }}\n                              onMouseDown={e => {\n                                (e as any).stopImmediatePropagation();\n                                e.stopPropagation();\n                              }}\n                              className=\"hover:text-red-400 transition-colors\"\n                              style={{ zIndex: 10011, isolation: 'isolate' }}\n                              aria-label={`Remove tag ${tag}`}\n                            >\n                              <X size={12} />\n                            </button>\n                          </span>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </form>\n\n              {/* Footer */}\n              <div\n                className=\"flex items-center justify-end gap-3 border-t border-[var(--surface-border)]\"\n                style={{ padding: tokens.spacing(4) }}\n              >\n                <Button\n                  type=\"button\"\n                  tone=\"secondary\"\n                  onClick={e => {\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                    handleClose();\n                  }}\n                  onMouseDown={e => {\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                  }}\n                  disabled={loading}\n                  style={{ zIndex: 10011, isolation: 'isolate' }}\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  tone=\"primary\"\n                  onClick={e => {\n                    // Prevent double submission - form onSubmit will handle it\n                    e.preventDefault();\n                    e.stopPropagation();\n                    (e as any).stopImmediatePropagation();\n                  }}\n                  onMouseDown={e => {\n                    // Allow mousedown to proceed normally for form submission\n                    e.stopPropagation();\n                  }}\n                  disabled={loading || !title.trim()}\n                  loading={loading}\n                  style={{ zIndex: 10011, isolation: 'isolate', pointerEvents: 'auto' }}\n                >\n                  Create {selectedTypeInfo?.label}\n                </Button>\n              </div>\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n}\n","/**\n * Export Utilities\n * Functions for exporting data to various formats (JSON, CSV, etc.)\n */\n\nimport type { MemoryEvent } from '../core/supermemory/tracker';\n\n/**\n * Convert memory events to JSON format\n */\nexport function exportMemoriesToJSON(events: MemoryEvent[]): string {\n  const exportData = {\n    version: '1.0',\n    exportedAt: new Date().toISOString(),\n    count: events.length,\n    memories: events.map(event => ({\n      id: event.id,\n      type: event.type,\n      value: event.value,\n      metadata: event.metadata,\n      timestamp: event.ts,\n      score: event.score,\n    })),\n  };\n\n  return JSON.stringify(exportData, null, 2);\n}\n\n/**\n * Convert memory events to CSV format\n */\nexport function exportMemoriesToCSV(events: MemoryEvent[]): string {\n  if (events.length === 0) {\n    return 'Type,Value,Title,URL,Timestamp,Tags\\n';\n  }\n\n  const headers = ['Type', 'Value', 'Title', 'URL', 'Timestamp', 'Date', 'Time', 'Tags', 'Pinned'];\n  const rows = events.map(event => {\n    const date = new Date(event.ts);\n    const tags = Array.isArray(event.metadata?.tags) ? event.metadata.tags.join('; ') : '';\n    const pinned = event.metadata?.pinned ? 'Yes' : 'No';\n\n    return [\n      event.type,\n      escapeCSV(String(event.value || '')),\n      escapeCSV(event.metadata?.title || ''),\n      escapeCSV(event.metadata?.url || ''),\n      event.ts.toString(),\n      date.toLocaleDateString(),\n      date.toLocaleTimeString(),\n      escapeCSV(tags),\n      pinned,\n    ];\n  });\n\n  const csvRows = [headers.join(','), ...rows.map(row => row.join(','))];\n  return csvRows.join('\\n');\n}\n\n/**\n * Escape CSV field (handle commas, quotes, newlines)\n */\nfunction escapeCSV(field: string): string {\n  if (!field) return '';\n\n  // If field contains comma, quote, or newline, wrap in quotes and escape quotes\n  if (field.includes(',') || field.includes('\"') || field.includes('\\n')) {\n    return `\"${field.replace(/\"/g, '\"\"')}\"`;\n  }\n\n  return field;\n}\n\n/**\n * Download data as a file\n */\nexport function downloadFile(\n  content: string,\n  filename: string,\n  mimeType: string = 'text/plain'\n): void {\n  const blob = new Blob([content], { type: mimeType });\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = filename;\n  link.style.display = 'none';\n\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n\n  // Clean up\n  setTimeout(() => {\n    URL.revokeObjectURL(url);\n  }, 100);\n}\n\n/**\n * Export memories with options\n */\nexport interface ExportOptions {\n  format: 'json' | 'csv';\n  includeMetadata?: boolean;\n  dateRange?: {\n    start?: number;\n    end?: number;\n  };\n  filterByType?: string[];\n  filterByTags?: string[];\n}\n\nexport function exportMemories(events: MemoryEvent[], options: ExportOptions): void {\n  // Filter events based on options\n  let filteredEvents = [...events];\n\n  if (options.dateRange) {\n    if (options.dateRange.start) {\n      filteredEvents = filteredEvents.filter(e => e.ts >= options.dateRange!.start!);\n    }\n    if (options.dateRange.end) {\n      filteredEvents = filteredEvents.filter(e => e.ts <= options.dateRange!.end!);\n    }\n  }\n\n  if (options.filterByType && options.filterByType.length > 0) {\n    filteredEvents = filteredEvents.filter(e => options.filterByType!.includes(e.type));\n  }\n\n  if (options.filterByTags && options.filterByTags.length > 0) {\n    filteredEvents = filteredEvents.filter(e => {\n      const eventTags = Array.isArray(e.metadata?.tags) ? e.metadata.tags : [];\n      return options.filterByTags!.some(tag => eventTags.includes(tag));\n    });\n  }\n\n  // Generate filename\n  const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\n  const extension = options.format === 'json' ? 'json' : 'csv';\n  const filename = `regen-memories-${timestamp}.${extension}`;\n\n  // Export based on format\n  let content: string;\n  let mimeType: string;\n\n  if (options.format === 'json') {\n    content = exportMemoriesToJSON(filteredEvents);\n    mimeType = 'application/json';\n  } else {\n    content = exportMemoriesToCSV(filteredEvents);\n    mimeType = 'text/csv';\n  }\n\n  // Download file\n  downloadFile(content, filename, mimeType);\n}\n","/**\n * Export Memories Dialog\n * Modal for exporting memories to JSON or CSV with filtering options\n */\n\nimport React, { useState, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  X,\n  Download,\n  FileJson,\n  FileSpreadsheet,\n  Calendar,\n  Filter,\n  Tag as TagIcon,\n} from 'lucide-react';\nimport { exportMemories, type ExportOptions } from '../../utils/export';\nimport { showToast } from '../../state/toastStore';\nimport { useTokens } from '../../ui/useTokens';\nimport { Button } from '../../ui/button';\nimport { Input } from '../../ui/input';\nimport type { MemoryEvent } from '../../core/supermemory/tracker';\nimport type { MemoryEventType } from '../../core/supermemory/event-types';\n\ninterface ExportMemoriesDialogProps {\n  open: boolean;\n  onClose: () => void;\n  events: MemoryEvent[];\n  availableTags: string[];\n}\n\nexport function ExportMemoriesDialog({\n  open,\n  onClose,\n  events,\n  availableTags,\n}: ExportMemoriesDialogProps) {\n  const tokens = useTokens();\n  const [format, setFormat] = useState<'json' | 'csv'>('json');\n  const [dateRange, setDateRange] = useState<{ start?: string; end?: string }>({});\n  const [selectedTypes, setSelectedTypes] = useState<string[]>([]);\n  const [selectedTags, setSelectedTags] = useState<string[]>([]);\n  const [loading, setLoading] = useState(false);\n\n  const allEventTypes: MemoryEventType[] = [\n    'search',\n    'visit',\n    'mode_switch',\n    'bookmark',\n    'note',\n    'task',\n    'highlight',\n    'screenshot',\n    'agent',\n  ];\n\n  const handleToggleType = useCallback((type: string) => {\n    setSelectedTypes(prev =>\n      prev.includes(type) ? prev.filter(t => t !== type) : [...prev, type]\n    );\n  }, []);\n\n  const handleToggleTag = useCallback((tag: string) => {\n    setSelectedTags(prev => (prev.includes(tag) ? prev.filter(t => t !== tag) : [...prev, tag]));\n  }, []);\n\n  const handleExport = useCallback(() => {\n    setLoading(true);\n\n    try {\n      const options: ExportOptions = {\n        format,\n        dateRange:\n          dateRange.start || dateRange.end\n            ? {\n                start: dateRange.start ? new Date(dateRange.start).getTime() : undefined,\n                end: dateRange.end ? new Date(dateRange.end).getTime() : undefined,\n              }\n            : undefined,\n        filterByType: selectedTypes.length > 0 ? selectedTypes : undefined,\n        filterByTags: selectedTags.length > 0 ? selectedTags : undefined,\n      };\n\n      exportMemories(events, options);\n\n      const count = events.length;\n      showToast(\n        'success',\n        `Exported ${count} ${count === 1 ? 'memory' : 'memories'} to ${format.toUpperCase()}`\n      );\n      onClose();\n    } catch (error) {\n      console.error('[ExportMemoriesDialog] Export failed:', error);\n      showToast('error', 'Failed to export memories');\n    } finally {\n      setLoading(false);\n    }\n  }, [format, dateRange, selectedTypes, selectedTags, events, onClose]);\n\n  const handleClose = useCallback(() => {\n    if (!loading) {\n      onClose();\n    }\n  }, [loading, onClose]);\n\n  if (!open) return null;\n\n  const filteredCount = events.length; // Could calculate actual filtered count\n\n  return (\n    <AnimatePresence>\n      {open && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={e => {\n              // Only close if clicking directly on backdrop, not on dialog content\n              if (e.target === e.currentTarget) {\n                handleClose();\n              }\n            }}\n            onMouseDown={e => {\n              // Don't interfere with button clicks\n              const target = e.target as HTMLElement;\n              if (\n                target.closest('button') ||\n                target.closest('[role=\"button\"]') ||\n                target.closest('[role=\"dialog\"]')\n              ) {\n                return;\n              }\n            }}\n            className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-50\"\n            aria-hidden=\"true\"\n          />\n\n          {/* Dialog */}\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\n            transition={{ type: 'spring', damping: 25, stiffness: 300 }}\n            className=\"fixed inset-0 z-50 flex items-center justify-center p-4\"\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-labelledby=\"export-memories-title\"\n          >\n            <div\n              className=\"w-full max-w-2xl bg-[var(--surface-root)] border border-[var(--surface-border)] rounded-xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden\"\n              onClick={e => e.stopPropagation()}\n            >\n              {/* Header */}\n              <div\n                className=\"flex items-center justify-between border-b border-[var(--surface-border)]\"\n                style={{ padding: tokens.spacing(4) }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <Download size={20} className=\"text-[var(--color-primary-400)]\" />\n                  <h2\n                    id=\"export-memories-title\"\n                    className=\"font-semibold text-[var(--text-primary)]\"\n                    style={{ fontSize: tokens.fontSize.lg }}\n                  >\n                    Export Memories\n                  </h2>\n                </div>\n                <button\n                  onClick={e => {\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                    handleClose();\n                  }}\n                  onMouseDown={e => {\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                  }}\n                  disabled={loading}\n                  className=\"rounded-lg p-1.5 text-[var(--text-muted)] hover:text-[var(--text-primary)] hover:bg-[var(--surface-hover)] transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] disabled:opacity-50\"\n                  style={{ zIndex: 10011, isolation: 'isolate' }}\n                  aria-label=\"Close dialog\"\n                >\n                  <X size={18} />\n                </button>\n              </div>\n\n              {/* Content */}\n              <div className=\"flex-1 overflow-y-auto\" style={{ padding: tokens.spacing(4) }}>\n                <div className=\"space-y-6\">\n                  {/* Format Selection */}\n                  <div>\n                    <label\n                      className=\"block text-sm font-medium text-[var(--text-primary)] mb-3\"\n                      style={{ fontSize: tokens.fontSize.sm }}\n                    >\n                      Export Format\n                    </label>\n                    <div className=\"flex gap-3\">\n                      <button\n                        onClick={e => {\n                          (e as any).stopImmediatePropagation();\n                          e.stopPropagation();\n                          setFormat('json');\n                        }}\n                        onMouseDown={e => {\n                          (e as any).stopImmediatePropagation();\n                          e.stopPropagation();\n                        }}\n                        className={`\n                          flex-1 flex items-center gap-3 px-4 py-3 rounded-lg border transition-all\n                          ${\n                            format === 'json'\n                              ? 'bg-[var(--color-primary-600)] border-[var(--color-primary-500)] text-white'\n                              : 'bg-[var(--surface-elevated)] border-[var(--surface-border)] text-[var(--text-secondary)] hover:bg-[var(--surface-hover)]'\n                          }\n                          focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1\n                        `}\n                        style={{ zIndex: 10011, isolation: 'isolate' }}\n                        aria-pressed={format === 'json'}\n                      >\n                        <FileJson size={20} />\n                        <div className=\"text-left\">\n                          <div className=\"font-medium\">JSON</div>\n                          <div className=\"text-xs opacity-80\">Structured data format</div>\n                        </div>\n                      </button>\n                      <button\n                        onClick={e => {\n                          (e as any).stopImmediatePropagation();\n                          e.stopPropagation();\n                          setFormat('csv');\n                        }}\n                        onMouseDown={e => {\n                          (e as any).stopImmediatePropagation();\n                          e.stopPropagation();\n                        }}\n                        className={`\n                          flex-1 flex items-center gap-3 px-4 py-3 rounded-lg border transition-all\n                          ${\n                            format === 'csv'\n                              ? 'bg-[var(--color-primary-600)] border-[var(--color-primary-500)] text-white'\n                              : 'bg-[var(--surface-elevated)] border-[var(--surface-border)] text-[var(--text-secondary)] hover:bg-[var(--surface-hover)]'\n                          }\n                          focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1\n                        `}\n                        style={{ zIndex: 10011, isolation: 'isolate' }}\n                        aria-pressed={format === 'csv'}\n                      >\n                        <FileSpreadsheet size={20} />\n                        <div className=\"text-left\">\n                          <div className=\"font-medium\">CSV</div>\n                          <div className=\"text-xs opacity-80\">Spreadsheet format</div>\n                        </div>\n                      </button>\n                    </div>\n                  </div>\n\n                  {/* Date Range */}\n                  <div>\n                    <label\n                      className=\"block text-sm font-medium text-[var(--text-primary)] mb-3\"\n                      style={{ fontSize: tokens.fontSize.sm }}\n                    >\n                      <Calendar size={16} className=\"inline mr-2\" />\n                      Date Range (Optional)\n                    </label>\n                    <div className=\"grid grid-cols-2 gap-3\">\n                      <div>\n                        <label\n                          htmlFor=\"export-start-date\"\n                          className=\"block text-xs text-[var(--text-muted)] mb-1.5\"\n                          style={{ fontSize: tokens.fontSize.xs }}\n                        >\n                          Start Date\n                        </label>\n                        <Input\n                          id=\"export-start-date\"\n                          type=\"date\"\n                          value={dateRange.start || ''}\n                          onChange={e => setDateRange(prev => ({ ...prev, start: e.target.value }))}\n                          disabled={loading}\n                        />\n                      </div>\n                      <div>\n                        <label\n                          htmlFor=\"export-end-date\"\n                          className=\"block text-xs text-[var(--text-muted)] mb-1.5\"\n                          style={{ fontSize: tokens.fontSize.xs }}\n                        >\n                          End Date\n                        </label>\n                        <Input\n                          id=\"export-end-date\"\n                          type=\"date\"\n                          value={dateRange.end || ''}\n                          onChange={e => setDateRange(prev => ({ ...prev, end: e.target.value }))}\n                          disabled={loading}\n                        />\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Type Filter */}\n                  <div>\n                    <label\n                      className=\"block text-sm font-medium text-[var(--text-primary)] mb-3\"\n                      style={{ fontSize: tokens.fontSize.sm }}\n                    >\n                      <Filter size={16} className=\"inline mr-2\" />\n                      Filter by Type (Optional)\n                    </label>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {allEventTypes.map(type => (\n                        <button\n                          key={type}\n                          onClick={e => {\n                            (e as any).stopImmediatePropagation();\n                            e.stopPropagation();\n                            handleToggleType(type);\n                          }}\n                          onMouseDown={e => {\n                            (e as any).stopImmediatePropagation();\n                            e.stopPropagation();\n                          }}\n                          className={`\n                            px-3 py-1.5 rounded-full text-sm font-medium transition-colors\n                            ${\n                              selectedTypes.includes(type)\n                                ? 'bg-[var(--color-primary-600)] text-white'\n                                : 'bg-[var(--surface-elevated)] text-[var(--text-secondary)] hover:bg-[var(--surface-hover)]'\n                            }\n                            focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1\n                          `}\n                          style={{\n                            fontSize: tokens.fontSize.sm,\n                            zIndex: 10011,\n                            isolation: 'isolate',\n                          }}\n                          aria-pressed={selectedTypes.includes(type)}\n                        >\n                          {type.replace('_', ' ')}\n                        </button>\n                      ))}\n                      {selectedTypes.length > 0 && (\n                        <button\n                          onClick={e => {\n                            (e as any).stopImmediatePropagation();\n                            e.stopPropagation();\n                            setSelectedTypes([]);\n                          }}\n                          onMouseDown={e => {\n                            (e as any).stopImmediatePropagation();\n                            e.stopPropagation();\n                          }}\n                          className=\"px-3 py-1.5 rounded-full text-sm text-[var(--text-muted)] hover:text-[var(--text-primary)] hover:bg-[var(--surface-hover)] transition-colors\"\n                          style={{\n                            fontSize: tokens.fontSize.sm,\n                            zIndex: 10011,\n                            isolation: 'isolate',\n                          }}\n                        >\n                          Clear\n                        </button>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Tag Filter */}\n                  {availableTags.length > 0 && (\n                    <div>\n                      <label\n                        className=\"block text-sm font-medium text-[var(--text-primary)] mb-3\"\n                        style={{ fontSize: tokens.fontSize.sm }}\n                      >\n                        <TagIcon size={16} className=\"inline mr-2\" />\n                        Filter by Tags (Optional)\n                      </label>\n                      <div className=\"flex flex-wrap gap-2\">\n                        {availableTags.slice(0, 10).map(tag => (\n                          <button\n                            key={tag}\n                            onClick={e => {\n                              (e as any).stopImmediatePropagation();\n                              e.stopPropagation();\n                              handleToggleTag(tag);\n                            }}\n                            onMouseDown={e => {\n                              (e as any).stopImmediatePropagation();\n                              e.stopPropagation();\n                            }}\n                            className={`\n                              px-3 py-1.5 rounded-full text-sm font-medium transition-colors\n                              ${\n                                selectedTags.includes(tag)\n                                  ? 'bg-[var(--color-primary-600)] text-white'\n                                  : 'bg-[var(--surface-elevated)] text-[var(--text-secondary)] hover:bg-[var(--surface-hover)]'\n                              }\n                              focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1\n                            `}\n                            style={{\n                              fontSize: tokens.fontSize.sm,\n                              zIndex: 10011,\n                              isolation: 'isolate',\n                            }}\n                            aria-pressed={selectedTags.includes(tag)}\n                          >\n                            #{tag}\n                          </button>\n                        ))}\n                        {selectedTags.length > 0 && (\n                          <button\n                            onClick={e => {\n                              (e as any).stopImmediatePropagation();\n                              e.stopPropagation();\n                              setSelectedTags([]);\n                            }}\n                            onMouseDown={e => {\n                              (e as any).stopImmediatePropagation();\n                              e.stopPropagation();\n                            }}\n                            className=\"px-3 py-1.5 rounded-full text-sm text-[var(--text-muted)] hover:text-[var(--text-primary)] hover:bg-[var(--surface-hover)] transition-colors\"\n                            style={{\n                              fontSize: tokens.fontSize.sm,\n                              zIndex: 10011,\n                              isolation: 'isolate',\n                            }}\n                          >\n                            Clear\n                          </button>\n                        )}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Summary */}\n                  <div\n                    className=\"rounded-lg border border-[var(--surface-border)] bg-[var(--surface-elevated)]\"\n                    style={{ padding: tokens.spacing(3) }}\n                  >\n                    <div className=\"text-sm text-[var(--text-primary)] font-medium mb-1\">\n                      Export Summary\n                    </div>\n                    <div className=\"text-xs text-[var(--text-muted)] space-y-1\">\n                      <div>Format: {format.toUpperCase()}</div>\n                      <div>Memories: {filteredCount}</div>\n                      {dateRange.start && (\n                        <div>From: {new Date(dateRange.start).toLocaleDateString()}</div>\n                      )}\n                      {dateRange.end && (\n                        <div>To: {new Date(dateRange.end).toLocaleDateString()}</div>\n                      )}\n                      {selectedTypes.length > 0 && (\n                        <div>Types: {selectedTypes.length} selected</div>\n                      )}\n                      {selectedTags.length > 0 && <div>Tags: {selectedTags.length} selected</div>}\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Footer */}\n              <div\n                className=\"flex items-center justify-end gap-3 border-t border-[var(--surface-border)]\"\n                style={{ padding: tokens.spacing(4) }}\n              >\n                <Button\n                  type=\"button\"\n                  tone=\"secondary\"\n                  onClick={e => {\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                    handleClose();\n                  }}\n                  onMouseDown={e => {\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                  }}\n                  disabled={loading}\n                  style={{ zIndex: 10011, isolation: 'isolate' }}\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"button\"\n                  tone=\"primary\"\n                  icon={<Download size={16} />}\n                  onClick={e => {\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                    handleExport();\n                  }}\n                  onMouseDown={e => {\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                  }}\n                  disabled={loading}\n                  loading={loading}\n                  style={{ zIndex: 10011, isolation: 'isolate' }}\n                >\n                  Export {format.toUpperCase()}\n                </Button>\n              </div>\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n}\n","/**\n * Research Memory Panel - Redesigned SuperMemory UI\n * Modern, scannable, keyboard-first interface for browsing memories\n */\n\nimport React, { useState, useEffect, useMemo, useRef, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Search,\n  X,\n  Pin,\n  PinOff,\n  Copy,\n  ExternalLink,\n  FileText,\n  Plus,\n  Tag as TagIcon,\n  Filter,\n  LayoutGrid,\n  List,\n  ChevronRight,\n} from 'lucide-react';\nimport { MemoryEvent } from '../../core/supermemory/tracker';\nimport { semanticSearchMemories, SemanticMemoryMatch } from '../../core/supermemory/search';\nimport { useDebounce } from '../../utils/useDebounce';\nimport { superMemoryDB } from '../../core/supermemory/db';\nimport { MemoryStoreInstance } from '../../core/supermemory/store';\nimport { showToast } from '../../state/toastStore';\nimport { useTokens } from '../../ui/useTokens';\nimport { SkeletonList } from '../../ui/skeleton';\nimport { Button } from '../../ui/button';\nimport { ipc } from '../../lib/ipc-typed';\nimport { CreateMemoryDialog } from './CreateMemoryDialog';\nimport { ExportMemoriesDialog } from './ExportMemoriesDialog';\n\ninterface ResearchMemoryPanelProps {\n  open: boolean;\n  onClose: () => void;\n  onCreateMemory?: () => void;\n}\n\ntype ViewMode = 'all' | 'research' | 'trade';\ntype DisplayMode = 'expanded' | 'compact';\ntype SortMode = 'newest' | 'oldest' | 'relevance';\n\ninterface MemoryCardProps {\n  memory: MemoryEvent;\n  compact?: boolean;\n  onPin: (id: string, pinned: boolean) => void;\n  onCopy: (memory: MemoryEvent) => void;\n  onOpen: (memory: MemoryEvent) => void;\n  onDelete?: (id: string) => void;\n}\n\nfunction MemoryCard({ memory, compact, onPin, onCopy, onOpen, onDelete }: MemoryCardProps) {\n  const tokens = useTokens();\n  const isPinned = memory.metadata?.pinned ?? false;\n  const typeLabel = memory.type\n    .split('_')\n    .map(w => w.charAt(0).toUpperCase() + w.slice(1))\n    .join(' ');\n  const typeInitial = memory.type.charAt(0).toUpperCase();\n  const timeStr = new Date(memory.ts).toLocaleTimeString([], {\n    hour: '2-digit',\n    minute: '2-digit',\n  });\n  const dateStr = new Date(memory.ts).toLocaleDateString([], { month: 'short', day: 'numeric' });\n\n  const handleCopy = useCallback(() => {\n    const text = memory.metadata?.title || memory.value || '';\n    navigator.clipboard\n      .writeText(text)\n      .then(() => {\n        showToast('success', 'Copied to clipboard');\n        onCopy(memory);\n      })\n      .catch(() => {\n        showToast('error', 'Failed to copy');\n      });\n  }, [memory, onCopy]);\n\n  const handleOpen = useCallback(() => {\n    if (memory.metadata?.url) {\n      window.open(memory.metadata.url, '_blank');\n    }\n    onOpen(memory);\n  }, [memory, onOpen]);\n\n  return (\n    <motion.li\n      initial={{ opacity: 0, y: 8 }}\n      animate={{ opacity: 1, y: 0 }}\n      exit={{ opacity: 0, y: -8 }}\n      transition={{ duration: 0.15 }}\n      className=\"group relative\"\n    >\n      <div\n        className={`rounded-lg border transition-all duration-200 ${\n          isPinned\n            ? 'border-[var(--color-primary-500)]/40 bg-[var(--surface-elevated)] shadow-md'\n            : 'hover:border-[var(--color-primary-500)]/30 border-[var(--surface-border)] bg-[var(--surface-panel)]'\n        } hover:shadow-md`}\n        style={{ padding: tokens.spacing(3) }}\n      >\n        <div className=\"flex items-start gap-3\">\n          {/* Type indicator */}\n          <div\n            className=\"flex flex-shrink-0 flex-col items-center\"\n            style={{ width: tokens.spacing(10) }}\n          >\n            <div\n              className={`flex items-center justify-center rounded-full text-xs font-semibold ${\n                isPinned\n                  ? 'bg-[var(--color-primary-500)]/20 text-[var(--color-primary-400)]'\n                  : 'bg-[var(--surface-elevated)] text-[var(--text-muted)]'\n              } `}\n              style={{\n                width: tokens.spacing(8),\n                height: tokens.spacing(8),\n              }}\n              aria-label={`Type: ${typeLabel}`}\n            >\n              {typeInitial}\n            </div>\n            {!compact && (\n              <div\n                className=\"mt-1 text-xs text-[var(--text-muted)]\"\n                style={{ fontSize: tokens.fontSize.xs }}\n              >\n                {dateStr}\n              </div>\n            )}\n          </div>\n\n          {/* Content */}\n          <div className=\"min-w-0 flex-1\">\n            <div className=\"mb-1 flex items-start justify-between gap-2\">\n              <div className=\"flex min-w-0 flex-1 items-center gap-2\">\n                <span\n                  className=\"text-xs font-medium uppercase tracking-wide text-[var(--text-muted)]\"\n                  style={{ fontSize: tokens.fontSize.xs }}\n                >\n                  {typeLabel}\n                </span>\n                {isPinned && (\n                  <Pin\n                    size={12}\n                    className=\"flex-shrink-0 text-[var(--color-primary-400)]\"\n                    aria-label=\"Pinned\"\n                  />\n                )}\n              </div>\n              <div\n                className=\"flex-shrink-0 text-xs text-[var(--text-muted)]\"\n                style={{ fontSize: tokens.fontSize.xs }}\n              >\n                {timeStr}\n              </div>\n            </div>\n\n            <h4\n              className=\"mb-1 line-clamp-2 font-semibold text-[var(--text-primary)]\"\n              style={{ fontSize: tokens.fontSize.sm }}\n            >\n              {memory.metadata?.title || memory.value}\n            </h4>\n\n            {!compact && memory.metadata?.url && (\n              <div\n                className=\"mb-2 truncate text-xs text-[var(--text-muted)]\"\n                style={{ fontSize: tokens.fontSize.xs }}\n              >\n                {memory.metadata.url}\n              </div>\n            )}\n\n            {!compact && memory.value && memory.value !== memory.metadata?.title && (\n              <p\n                className=\"mb-2 line-clamp-2 text-sm text-[var(--text-secondary)]\"\n                style={{ fontSize: tokens.fontSize.sm }}\n              >\n                {memory.value}\n              </p>\n            )}\n\n            {/* Tags */}\n            {memory.metadata?.tags && memory.metadata.tags.length > 0 && (\n              <div className=\"mt-2 flex flex-wrap gap-1.5\">\n                {memory.metadata.tags.map((tag: string) => (\n                  <span\n                    key={tag}\n                    className=\"inline-flex items-center gap-1 rounded-full bg-[var(--surface-elevated)] px-2 py-0.5 text-xs text-[var(--color-primary-300)]\"\n                    style={{ fontSize: tokens.fontSize.xs }}\n                  >\n                    <TagIcon size={10} />\n                    {tag.startsWith('#') ? tag : `#${tag}`}\n                  </span>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {/* Quick actions - always visible but subtle */}\n          <div\n            className=\"ml-2 flex flex-col gap-1 opacity-0 transition-opacity focus-within:opacity-100 group-hover:opacity-100\"\n            role=\"group\"\n            aria-label=\"Memory actions\"\n          >\n            <button\n              onClick={() => onPin(memory.id, !isPinned)}\n              className={`rounded-md p-1.5 transition-colors ${\n                isPinned\n                  ? 'bg-[var(--color-primary-500)]/10 text-[var(--color-primary-400)]'\n                  : 'text-[var(--text-muted)] hover:bg-[var(--surface-hover)] hover:text-[var(--color-primary-400)]'\n              } focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1`}\n              aria-label={isPinned ? 'Unpin memory' : 'Pin memory'}\n              title={isPinned ? 'Unpin' : 'Pin'}\n            >\n              {isPinned ? <Pin size={14} /> : <PinOff size={14} />}\n            </button>\n            {memory.metadata?.url && (\n              <button\n                onClick={handleOpen}\n                className=\"rounded-md p-1.5 text-[var(--text-muted)] transition-colors hover:bg-[var(--surface-hover)] hover:text-[var(--color-primary-400)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1\"\n                aria-label=\"Open in new tab\"\n                title=\"Open\"\n              >\n                <ExternalLink size={14} />\n              </button>\n            )}\n            <button\n              onClick={handleCopy}\n              className=\"rounded-md p-1.5 text-[var(--text-muted)] transition-colors hover:bg-[var(--surface-hover)] hover:text-[var(--color-primary-400)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1\"\n              aria-label=\"Copy to clipboard\"\n              title=\"Copy\"\n            >\n              <Copy size={14} />\n            </button>\n            {onDelete && (\n              <button\n                onClick={() => onDelete(memory.id)}\n                className=\"rounded-md p-1.5 text-[var(--text-muted)] transition-colors hover:bg-red-500/10 hover:text-red-400 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-1\"\n                aria-label=\"Delete memory\"\n                title=\"Delete\"\n              >\n                <X size={14} />\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n    </motion.li>\n  );\n}\n\nexport function ResearchMemoryPanel({ open, onClose, onCreateMemory }: ResearchMemoryPanelProps) {\n  const tokens = useTokens();\n  const [searchQuery, setSearchQuery] = useState('');\n  const [mode, setMode] = useState<ViewMode>('all');\n  const [displayMode, setDisplayMode] = useState<DisplayMode>('expanded');\n  const [sortMode, setSortMode] = useState<SortMode>('newest');\n  const [events, setEvents] = useState<MemoryEvent[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [semanticResults, setSemanticResults] = useState<SemanticMemoryMatch[]>([]);\n  const [selectedTags, setSelectedTags] = useState<string[]>([]);\n  const [allTags, setAllTags] = useState<string[]>([]);\n  // Reserved for future timeline view\n  // const [timelineCollapsed, setTimelineCollapsed] = useState(false);\n  const [_focusedIndex, setFocusedIndex] = useState<number | null>(null);\n  const [createDialogOpen, setCreateDialogOpen] = useState(false);\n  const [exportDialogOpen, setExportDialogOpen] = useState(false);\n  const searchInputRef = useRef<HTMLInputElement>(null);\n  const listRef = useRef<HTMLUListElement>(null);\n  const debouncedQuery = useDebounce(searchQuery, 300);\n\n  // Keyboard shortcuts\n  useEffect(() => {\n    if (!open) return;\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Focus search with /\n      if (e.key === '/' && !(e.target instanceof HTMLInputElement)) {\n        e.preventDefault();\n        searchInputRef.current?.focus();\n        return;\n      }\n\n      // Create memory with n\n      if ((e.key === 'n' || e.key === 'N') && (e.metaKey || e.ctrlKey)) {\n        e.preventDefault();\n        setCreateDialogOpen(true);\n        return;\n      }\n\n      // Navigate list with j/k (vim-style)\n      if (e.key === 'j' && !(e.target instanceof HTMLInputElement)) {\n        e.preventDefault();\n        setFocusedIndex(prev => {\n          const next = prev === null ? 0 : Math.min(prev + 1, events.length - 1);\n          // Scroll into view\n          if (listRef.current) {\n            const item = listRef.current.children[next];\n            item?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n          }\n          return next;\n        });\n        return;\n      }\n\n      if (e.key === 'k' && !(e.target instanceof HTMLInputElement)) {\n        e.preventDefault();\n        setFocusedIndex(prev => {\n          const next = prev === null ? events.length - 1 : Math.max(prev - 1, 0);\n          if (listRef.current) {\n            const item = listRef.current.children[next];\n            item?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n          }\n          return next;\n        });\n        return;\n      }\n\n      // Escape to close\n      if (e.key === 'Escape' && !(e.target instanceof HTMLInputElement)) {\n        onClose();\n        return;\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [open, events.length, onCreateMemory, onClose]);\n\n  // Load events\n  const loadEvents = useCallback(async () => {\n    setLoading(true);\n    try {\n      const loaded = await MemoryStoreInstance.getEvents({\n        limit: 500,\n      });\n      setEvents(loaded);\n    } catch (error) {\n      console.error('[ResearchMemoryPanel] Failed to load events:', error);\n      showToast('error', 'Failed to load memories');\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (!open) return;\n    void loadEvents();\n  }, [open, loadEvents]);\n\n  // Refresh after memory creation\n  const handleMemoryCreated = useCallback(() => {\n    void loadEvents();\n  }, [loadEvents]);\n\n  // Load tags\n  useEffect(() => {\n    if (!open) return;\n\n    const loadTags = async () => {\n      try {\n        const tags = await superMemoryDB.getAllTags();\n        setAllTags(tags);\n      } catch (error) {\n        console.error('[ResearchMemoryPanel] Failed to load tags:', error);\n      }\n    };\n\n    void loadTags();\n  }, [open]);\n\n  // Semantic search\n  useEffect(() => {\n    if (!debouncedQuery || debouncedQuery.length < 3) {\n      setSemanticResults([]);\n      return;\n    }\n\n    const performSemanticSearch = async () => {\n      try {\n        const results = await semanticSearchMemories(debouncedQuery, {\n          limit: 50,\n          minSimilarity: 0.5,\n        });\n        setSemanticResults(results);\n      } catch (error) {\n        console.error('[ResearchMemoryPanel] Semantic search failed:', error);\n        setSemanticResults([]);\n      }\n    };\n\n    void performSemanticSearch();\n  }, [debouncedQuery]);\n\n  // Filter and sort events\n  const filteredEvents = useMemo(() => {\n    let filtered = events;\n\n    // Mode filter\n    if (mode === 'research') {\n      filtered = filtered.filter(e =>\n        e.metadata?.tags?.some((t: string) => t.includes('research') || t.includes('#research'))\n      );\n    } else if (mode === 'trade') {\n      filtered = filtered.filter(e =>\n        e.metadata?.tags?.some((t: string) => t.includes('trade') || t.includes('#trade'))\n      );\n    }\n\n    // Tag filter\n    if (selectedTags.length > 0) {\n      filtered = filtered.filter(e => selectedTags.some(tag => e.metadata?.tags?.includes(tag)));\n    }\n\n    // Search filter\n    if (debouncedQuery) {\n      if (semanticResults.length > 0) {\n        const semanticIds = new Set(semanticResults.map(r => r.event.id));\n        filtered = filtered.filter(e => semanticIds.has(e.id));\n      } else {\n        const queryLower = debouncedQuery.toLowerCase();\n        filtered = filtered.filter(\n          e =>\n            e.value.toLowerCase().includes(queryLower) ||\n            e.metadata?.title?.toLowerCase().includes(queryLower) ||\n            e.metadata?.tags?.some((t: string) => t.toLowerCase().includes(queryLower))\n        );\n      }\n    }\n\n    // Sort\n    filtered = [...filtered].sort((a, b) => {\n      if (sortMode === 'newest') return b.ts - a.ts;\n      if (sortMode === 'oldest') return a.ts - b.ts;\n      if (sortMode === 'relevance' && semanticResults.length > 0) {\n        const aMatch = semanticResults.find(r => r.event.id === a.id);\n        const bMatch = semanticResults.find(r => r.event.id === b.id);\n        if (aMatch && bMatch) return bMatch.similarity - aMatch.similarity;\n        if (aMatch) return -1;\n        if (bMatch) return 1;\n      }\n      return b.ts - a.ts;\n    });\n\n    return filtered;\n  }, [events, mode, selectedTags, debouncedQuery, semanticResults, sortMode]);\n\n  const handleTogglePin = async (id: string, pinned: boolean) => {\n    try {\n      await superMemoryDB.updateEventMetadata(id, { pinned });\n      setEvents(prev =>\n        prev.map(e => (e.id === id ? { ...e, metadata: { ...e.metadata, pinned } } : e))\n      );\n      showToast('success', pinned ? 'Memory pinned' : 'Memory unpinned');\n    } catch (error) {\n      console.error('[ResearchMemoryPanel] Failed to toggle pin:', error);\n      showToast('error', 'Failed to update memory');\n    }\n  };\n\n  const handleCopy = useCallback((_memory: MemoryEvent) => {\n    // Already handled in MemoryCard\n  }, []);\n\n  const handleOpen = useCallback(async (memory: MemoryEvent) => {\n    if (memory.metadata?.url) {\n      try {\n        await ipc.tabs.create({ url: memory.metadata.url });\n        showToast('success', 'Opened in new tab');\n      } catch (error) {\n        console.error('[ResearchMemoryPanel] Failed to open tab:', error);\n        showToast('error', 'Failed to open in new tab');\n      }\n    }\n  }, []);\n\n  const handleDelete = async (id: string) => {\n    try {\n      await superMemoryDB.deleteEvent(id);\n      setEvents(prev => prev.filter(e => e.id !== id));\n      showToast('success', 'Memory deleted');\n    } catch (error) {\n      console.error('[ResearchMemoryPanel] Failed to delete event:', error);\n      showToast('error', 'Failed to delete memory');\n    }\n  };\n\n  const handleToggleTag = (tag: string) => {\n    setSelectedTags(prev => (prev.includes(tag) ? prev.filter(t => t !== tag) : [...prev, tag]));\n  };\n\n  // Group by date for timeline (reserved for future timeline view)\n  // const groupedByDate = useMemo(() => {\n  //   const groups = new Map<string, MemoryEvent[]>();\n  //   for (const event of filteredEvents) {\n  //     const date = new Date(event.ts);\n  //     const dateKey = date.toLocaleDateString();\n  //     if (!groups.has(dateKey)) {\n  //       groups.set(dateKey, []);\n  //     }\n  //     groups.get(dateKey)!.push(event);\n  //   }\n  //   return Array.from(groups.entries()).sort(\n  //     (a, b) => new Date(b[0]).getTime() - new Date(a[0]).getTime()\n  //   );\n  // }, [filteredEvents]);\n\n  if (!open) return null;\n\n  return (\n    <AnimatePresence>\n      {open && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={onClose}\n            className=\"fixed inset-0 z-40 bg-black/50 backdrop-blur-sm\"\n            aria-hidden=\"true\"\n          />\n\n          {/* Panel */}\n          <motion.div\n            initial={{ x: '100%' }}\n            animate={{ x: 0 }}\n            exit={{ x: '100%' }}\n            transition={{ type: 'spring', damping: 25, stiffness: 200 }}\n            className=\"fixed bottom-0 right-0 top-0 z-50 flex w-0 max-w-[90vw] flex-col overflow-hidden border-l border-[var(--surface-border)] bg-[var(--surface-root)] shadow-2xl backdrop-blur-xl sm:max-w-full md:w-[420px] md:overflow-visible\"\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-label=\"Research Memory Panel\"\n            onClick={e => e.stopPropagation()}\n          >\n            {/* Header */}\n            <div\n              className=\"flex items-center justify-between border-b border-[var(--surface-border)]\"\n              style={{ padding: tokens.spacing(4) }}\n            >\n              <div className=\"flex items-center gap-2\">\n                <FileText size={20} className=\"text-[var(--color-primary-400)]\" />\n                <h2\n                  className=\"font-semibold text-[var(--text-primary)]\"\n                  style={{ fontSize: tokens.fontSize.lg }}\n                >\n                  SuperMemory\n                </h2>\n              </div>\n              <button\n                onClick={onClose}\n                className=\"rounded-lg p-1.5 text-[var(--text-muted)] transition-colors hover:bg-[var(--surface-hover)] hover:text-[var(--text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)]\"\n                aria-label=\"Close panel\"\n              >\n                <X size={18} />\n              </button>\n            </div>\n\n            {/* Search */}\n            <div style={{ padding: tokens.spacing(4), paddingBottom: tokens.spacing(3) }}>\n              <div className=\"relative\">\n                <Search\n                  size={16}\n                  className=\"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-[var(--text-muted)]\"\n                />\n                <input\n                  ref={searchInputRef}\n                  type=\"text\"\n                  placeholder=\"Search memories... (Press / to focus)\"\n                  value={searchQuery}\n                  onChange={e => setSearchQuery(e.target.value)}\n                  className=\"w-full rounded-lg border border-[var(--surface-border)] bg-[var(--surface-panel)] py-2 pl-10 pr-4 text-[var(--text-primary)] transition-all placeholder:text-[var(--text-muted)] focus:border-transparent focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)]\"\n                  style={{ fontSize: tokens.fontSize.sm }}\n                  aria-label=\"Search memories\"\n                />\n              </div>\n            </div>\n\n            {/* Primary Filters */}\n            <div\n              className=\"flex flex-wrap items-center gap-2 border-b border-[var(--surface-border)]\"\n              style={{\n                padding: tokens.spacing(4),\n                paddingTop: tokens.spacing(2),\n                paddingBottom: tokens.spacing(3),\n              }}\n            >\n              {(['all', 'research', 'trade'] as ViewMode[]).map(m => (\n                <button\n                  key={m}\n                  onClick={() => setMode(m)}\n                  className={`rounded-full px-3 py-1.5 text-sm font-medium transition-colors ${\n                    mode === m\n                      ? 'bg-[var(--color-primary-600)] text-white'\n                      : 'bg-[var(--surface-elevated)] text-[var(--text-secondary)] hover:bg-[var(--surface-hover)]'\n                  } focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1`}\n                  style={{ fontSize: tokens.fontSize.sm }}\n                  aria-pressed={mode === m}\n                >\n                  {m.charAt(0).toUpperCase() + m.slice(1)}\n                </button>\n              ))}\n\n              <div className=\"ml-auto flex items-center gap-2\">\n                <button\n                  onClick={() => setDisplayMode(displayMode === 'compact' ? 'expanded' : 'compact')}\n                  className=\"rounded-md p-1.5 text-[var(--text-muted)] transition-colors hover:bg-[var(--surface-hover)] hover:text-[var(--text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)]\"\n                  aria-label={`Switch to ${displayMode === 'compact' ? 'expanded' : 'compact'} view`}\n                  title={displayMode === 'compact' ? 'Expanded view' : 'Compact view'}\n                >\n                  {displayMode === 'compact' ? <List size={16} /> : <LayoutGrid size={16} />}\n                </button>\n                <div\n                  className=\"text-sm text-[var(--text-muted)]\"\n                  style={{ fontSize: tokens.fontSize.sm }}\n                >\n                  {filteredEvents.length} {filteredEvents.length === 1 ? 'item' : 'items'}\n                </div>\n              </div>\n            </div>\n\n            {/* Secondary Controls */}\n            <div\n              className=\"flex flex-wrap items-center gap-2 border-b border-[var(--surface-border)]\"\n              style={{\n                padding: tokens.spacing(3),\n                paddingTop: tokens.spacing(2),\n                paddingBottom: tokens.spacing(2),\n              }}\n            >\n              <div className=\"flex items-center gap-2\">\n                <Filter size={14} className=\"text-[var(--text-muted)]\" />\n                <span\n                  className=\"text-xs text-[var(--text-muted)]\"\n                  style={{ fontSize: tokens.fontSize.xs }}\n                >\n                  Sort:\n                </span>\n                <select\n                  value={sortMode}\n                  onChange={e => setSortMode(e.target.value as SortMode)}\n                  className=\"rounded-md border border-[var(--surface-border)] bg-[var(--surface-elevated)] px-2 py-1 text-xs text-[var(--text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)]\"\n                  style={{ fontSize: tokens.fontSize.xs }}\n                  aria-label=\"Sort mode\"\n                >\n                  <option value=\"newest\">Newest</option>\n                  <option value=\"oldest\">Oldest</option>\n                  <option value=\"relevance\">Relevance</option>\n                </select>\n              </div>\n\n              {/* Tag quick filters */}\n              {allTags.slice(0, 5).map(tag => (\n                <button\n                  key={tag}\n                  onClick={() => handleToggleTag(tag)}\n                  className={`rounded-full px-2 py-1 text-xs font-medium transition-colors ${\n                    selectedTags.includes(tag)\n                      ? 'bg-[var(--color-primary-600)] text-white'\n                      : 'bg-[var(--surface-elevated)] text-[var(--text-secondary)] hover:bg-[var(--surface-hover)]'\n                  } focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1`}\n                  style={{ fontSize: tokens.fontSize.xs }}\n                  aria-pressed={selectedTags.includes(tag)}\n                >\n                  #{tag}\n                </button>\n              ))}\n              {selectedTags.length > 0 && (\n                <button\n                  onClick={() => setSelectedTags([])}\n                  className=\"rounded-full px-2 py-1 text-xs text-[var(--text-muted)] transition-colors hover:bg-[var(--surface-hover)] hover:text-[var(--text-primary)]\"\n                  style={{ fontSize: tokens.fontSize.xs }}\n                >\n                  Clear\n                </button>\n              )}\n            </div>\n\n            {/* Content */}\n            <div className=\"flex-1 overflow-y-auto\" aria-busy={loading}>\n              {loading ? (\n                <div style={{ padding: tokens.spacing(4) }}>\n                  <SkeletonList items={5} />\n                </div>\n              ) : filteredEvents.length === 0 ? (\n                <div\n                  className=\"flex flex-col items-center justify-center rounded-2xl border border-[var(--surface-border)] bg-gradient-to-br from-[#281b5f] via-[#152038] to-[#0f172a] text-center text-white shadow-inner shadow-black/30\"\n                  style={{ padding: tokens.spacing(8), minHeight: '300px' }}\n                >\n                  <FileText size={48} className=\"mb-4 text-purple-200\" />\n                  <p className=\"mb-2 text-2xl font-semibold\">Welcome to Research Mode</p>\n                  <p className=\"mb-4 max-w-md text-sm text-purple-100/80\">\n                    Ask Regen in Hindi, Tamil, Bengali, or English. Your best answers and agent\n                    handoffs land here automatically.\n                  </p>\n                  <button\n                    type=\"button\"\n                    onClick={() =>\n                      window.dispatchEvent(\n                        new CustomEvent('research:quickstart', {\n                          detail: { query: 'Compare Nifty vs BankNifty for intraday' },\n                        })\n                      )\n                    }\n                    className=\"inline-flex items-center gap-2 rounded-full bg-white/90 px-5 py-2 text-sm font-semibold text-[#0f172a] transition hover:bg-white\"\n                  >\n                    Try Compare Nifty vs BankNifty\n                    <ChevronRight size={16} />\n                  </button>\n                </div>\n              ) : (\n                <ul\n                  ref={listRef}\n                  className=\"flex flex-col gap-3\"\n                  style={{ padding: tokens.spacing(4) }}\n                  role=\"list\"\n                >\n                  <AnimatePresence mode=\"popLayout\">\n                    {filteredEvents.map(event => (\n                      <MemoryCard\n                        key={event.id}\n                        memory={event}\n                        compact={displayMode === 'compact'}\n                        onPin={handleTogglePin}\n                        onCopy={handleCopy}\n                        onOpen={handleOpen}\n                        onDelete={handleDelete}\n                      />\n                    ))}\n                  </AnimatePresence>\n                </ul>\n              )}\n            </div>\n\n            {/* Footer */}\n            <div\n              className=\"flex items-center gap-2 border-t border-[var(--surface-border)]\"\n              style={{ padding: tokens.spacing(4) }}\n            >\n              <Button\n                tone=\"primary\"\n                size=\"sm\"\n                icon={<Plus size={16} />}\n                onClick={() => setCreateDialogOpen(true)}\n                fullWidth\n                className=\"flex-1\"\n              >\n                Create Memory\n              </Button>\n              <Button tone=\"secondary\" size=\"sm\" onClick={() => setExportDialogOpen(true)}>\n                Export\n              </Button>\n            </div>\n          </motion.div>\n\n          {/* Create Memory Dialog */}\n          <CreateMemoryDialog\n            open={createDialogOpen}\n            onClose={() => setCreateDialogOpen(false)}\n            onCreated={handleMemoryCreated}\n          />\n\n          {/* Export Memories Dialog */}\n          <ExportMemoriesDialog\n            open={exportDialogOpen}\n            onClose={() => setExportDialogOpen(false)}\n            events={events}\n            availableTags={allTags}\n          />\n        </>\n      )}\n    </AnimatePresence>\n  );\n}\n","import { create } from 'zustand';\n\nexport type SuspensionReason = 'inactivity' | 'manual' | 'memory';\n\nexport interface SuspendedTabRecord {\n  tabId: string;\n  title?: string;\n  url?: string;\n  snapshot?: string | null;\n  suspendedAt: number;\n  lastActiveAt?: number;\n  acknowledged?: boolean;\n  reason?: SuspensionReason;\n}\n\ninterface SuspensionEvent {\n  tabId: string;\n  type: 'suspended' | 'restored';\n  timestamp: number;\n  reason?: SuspensionReason;\n}\n\ninterface TabSuspensionState {\n  suspensions: Record<string, SuspendedTabRecord>;\n  lastEvent?: SuspensionEvent;\n  setSuspended: (record: SuspendedTabRecord) => void;\n  acknowledge: (tabId: string) => void;\n  resolve: (tabId: string, options?: { silent?: boolean }) => void;\n  cleanup: () => void; // Clean up old suspensions\n}\n\nconst MAX_SUSPENSIONS = 100; // Limit number of stored suspensions\nconst SUSPENSION_MAX_AGE_MS = 7 * 24 * 60 * 60 * 1000; // 7 days\n\nexport const useTabSuspensionStore = create<TabSuspensionState>(set => ({\n  suspensions: {},\n  lastEvent: undefined,\n  setSuspended: record =>\n    set(state => {\n      let suspensions: Record<string, SuspendedTabRecord> = {\n        ...state.suspensions,\n        [record.tabId]: {\n          ...(state.suspensions[record.tabId] ?? {}),\n          ...record,\n          acknowledged: false,\n        },\n      };\n\n      // Limit number of suspensions to prevent memory leaks\n      const suspensionEntries = Object.entries(suspensions);\n      if (suspensionEntries.length > MAX_SUSPENSIONS) {\n        // Remove oldest suspensions\n        const sorted = suspensionEntries.sort(\n          (a, b) => (a[1].suspendedAt || 0) - (b[1].suspendedAt || 0)\n        );\n        const toKeep = sorted.slice(-MAX_SUSPENSIONS);\n        suspensions = Object.fromEntries(toKeep);\n      }\n\n      return {\n        suspensions,\n        lastEvent: {\n          tabId: record.tabId,\n          type: 'suspended',\n          timestamp: Date.now(),\n          reason: record.reason,\n        },\n      };\n    }),\n  acknowledge: tabId =>\n    set(state => {\n      const current = state.suspensions[tabId];\n      if (!current) {\n        return state;\n      }\n      return {\n        suspensions: {\n          ...state.suspensions,\n          [tabId]: {\n            ...current,\n            acknowledged: true,\n          },\n        },\n      };\n    }),\n  resolve: (tabId, options) =>\n    set(state => {\n      if (!state.suspensions[tabId]) {\n        return state;\n      }\n      const next = { ...state.suspensions };\n      delete next[tabId];\n      return {\n        suspensions: next,\n        lastEvent: options?.silent\n          ? state.lastEvent\n          : {\n              tabId,\n              type: 'restored',\n              timestamp: Date.now(),\n            },\n      };\n    }),\n  cleanup: () =>\n    set(state => {\n      const now = Date.now();\n      const suspensions: Record<string, SuspendedTabRecord> = {};\n\n      // Remove old suspensions (older than 7 days)\n      Object.entries(state.suspensions).forEach(([tabId, record]) => {\n        const age = now - (record.suspendedAt || 0);\n        if (age < SUSPENSION_MAX_AGE_MS) {\n          suspensions[tabId] = record;\n        }\n      });\n\n      return { suspensions };\n    }),\n}));\n","// @ts-nocheck\n\nimport { ipc } from '../../lib/ipc-typed';\nimport { dispatch } from './runtime';\nimport { isElectronRuntime, isTauriRuntime } from '../../lib/env';\n\ntype MemorySample = {\n  tabId: string;\n  memoryMB: number;\n  timestamp: number;\n};\n\ntype PoolAllocation = {\n  tabId: string;\n  capMB: number;\n  lastUpdated: number;\n};\n\ninterface MemoryPoolOptions {\n  tabCapMB: number;\n  maxTotalMB: number;\n  rebalanceIntervalMs: number;\n  reserveForActiveTabsMB: number;\n}\n\nconst DEFAULT_OPTIONS: MemoryPoolOptions = {\n  tabCapMB: 512,\n  maxTotalMB: 4096,\n  rebalanceIntervalMs: 30_000,\n  reserveForActiveTabsMB: 1024,\n};\n\nclass MemoryPool {\n  private options: MemoryPoolOptions = { ...DEFAULT_OPTIONS };\n  private samples: MemorySample[] = [];\n  private pool: Map<string, PoolAllocation> = new Map();\n  private metricsTimer: ReturnType<typeof setInterval> | null = null;\n  private rebalanceTimer: ReturnType<typeof setInterval> | null = null;\n\n  start(options?: Partial<MemoryPoolOptions>) {\n    this.options = { ...DEFAULT_OPTIONS, ...(options ?? {}) };\n    this.pollUsage();\n    this.rebalance();\n    if (this.metricsTimer) clearInterval(this.metricsTimer);\n    if (this.rebalanceTimer) clearInterval(this.rebalanceTimer);\n    this.metricsTimer = setInterval(() => this.pollUsage(), 20_000);\n    this.rebalanceTimer = setInterval(() => this.rebalance(), this.options.rebalanceIntervalMs);\n  }\n\n  stop() {\n    if (this.metricsTimer) clearInterval(this.metricsTimer);\n    if (this.rebalanceTimer) clearInterval(this.rebalanceTimer);\n    this.metricsTimer = null;\n    this.rebalanceTimer = null;\n  }\n\n  update(partial: Partial<MemoryPoolOptions>) {\n    this.start({ ...this.options, ...partial });\n  }\n\n  private async pollUsage() {\n    if (!ipc?.tabs?.getAllMetrics) return;\n    try {\n      const metrics = await ipc.tabs.getAllMetrics();\n      const now = Date.now();\n      Object.entries(metrics || {}).forEach(([tabId, data]: [string, any]) => {\n        if (typeof data?.memoryMB !== 'number') return;\n        this.samples.push({ tabId, memoryMB: data.memoryMB, timestamp: now });\n        if (this.samples.length > 2000) {\n          this.samples.splice(0, this.samples.length - 2000);\n        }\n      });\n      dispatch({\n        type: 'redix:memory:sample',\n        payload: {\n          totalTabs: Object.keys(metrics ?? {}).length,\n          timestamp: now,\n        },\n      });\n    } catch (error) {\n      console.warn('[MemoryPool] Failed to poll usage', error);\n    }\n  }\n\n  private async rebalance() {\n    // Skip in web mode - no backend available\n    const isWebMode = !isElectronRuntime() && !isTauriRuntime();\n\n    if (isWebMode || !ipc?.tabs?.list) {\n      return; // Skip rebalancing in web mode\n    }\n\n    try {\n      const tabs = await ipc.tabs.list();\n      const now = Date.now();\n      const usageByTab = new Map<string, number>();\n      this.samples.forEach(sample => {\n        if (!usageByTab.has(sample.tabId) || sample.timestamp > now - 60_000) {\n          usageByTab.set(sample.tabId, sample.memoryMB);\n        }\n      });\n\n      const activeTabs = tabs.filter(tab => tab.active);\n      const backgroundTabs = tabs.filter(tab => !tab.active);\n\n      const totalBudget = this.options.maxTotalMB;\n      const reserveForActive = Math.min(\n        totalBudget * 0.5,\n        Math.max(\n          this.options.reserveForActiveTabsMB,\n          activeTabs.length * (this.options.tabCapMB / 2)\n        )\n      );\n\n      const perActiveCap = activeTabs.length\n        ? Math.max(this.options.tabCapMB, reserveForActive / activeTabs.length)\n        : 0;\n      const perBackgroundCap = backgroundTabs.length\n        ? Math.max(256, (totalBudget - reserveForActive) / backgroundTabs.length)\n        : this.options.tabCapMB;\n\n      const pending: Array<Promise<any>> = [];\n\n      for (const tab of activeTabs) {\n        pending.push(this.setCap(tab.id, Math.round(perActiveCap)));\n      }\n\n      for (const tab of backgroundTabs) {\n        const observed = usageByTab.get(tab.id) ?? 0;\n        const targetCap = Math.max(256, Math.min(perBackgroundCap, observed + 128));\n        pending.push(this.setCap(tab.id, Math.round(targetCap)));\n      }\n\n      await Promise.allSettled(pending);\n\n      dispatch({\n        type: 'redix:memory:pool:update',\n        payload: {\n          timestamp: now,\n          activeTabs: activeTabs.length,\n          backgroundTabs: backgroundTabs.length,\n          caps: Array.from(this.pool.values()),\n        },\n      });\n    } catch (error) {\n      console.warn('[MemoryPool] Failed to rebalance', error);\n    }\n  }\n\n  private async setCap(tabId: string, capMB: number) {\n    const existing = this.pool.get(tabId);\n    if (existing && Math.abs(existing.capMB - capMB) < 32) {\n      return existing;\n    }\n    try {\n      await ipc.tabs.setMemoryCap(tabId, capMB);\n      const record: PoolAllocation = { tabId, capMB, lastUpdated: Date.now() };\n      this.pool.set(tabId, record);\n      return record;\n    } catch (error) {\n      console.warn('[MemoryPool] Failed to set cap', { tabId, capMB }, error);\n      return existing;\n    }\n  }\n}\n\nexport const memoryPool = new MemoryPool();\n\nexport function initializeMemoryPool(): void {\n  memoryPool.start();\n  window.addEventListener('visibilitychange', () => {\n    if (document.visibilityState === 'visible') {\n      memoryPool.start();\n    }\n  });\n}\n\nexport function configureMemoryPool(options: Partial<MemoryPoolOptions>): void {\n  memoryPool.update(options);\n}\n","/**\n * Redix Resource Optimizer\n * Manages tab suspension, throttling, and resource allocation\n */\n\nimport { Redix, dispatch } from './runtime';\nimport { ipc } from '../../lib/ipc-typed';\nimport { initializeMemoryPool } from './memory-pool';\nimport { isElectronRuntime, isTauriRuntime } from '../../lib/env';\n\nexport interface ResourcePolicy {\n  suspendBackgroundTabs: boolean;\n  suspendAfterMinutes: number;\n  throttleHeavyTabs: boolean;\n  memoryThreshold: number; // 0-100 percentage\n  cpuThreshold: number; // 0-100 percentage\n  batteryThreshold: number; // 0-100 percentage\n  prefetchEnabled: boolean;\n  prefetchOnWifiOnly: boolean;\n}\n\nconst DEFAULT_POLICY: ResourcePolicy = {\n  suspendBackgroundTabs: true,\n  suspendAfterMinutes: 12,\n  throttleHeavyTabs: true,\n  memoryThreshold: 70,\n  cpuThreshold: 80,\n  batteryThreshold: 20,\n  prefetchEnabled: true,\n  prefetchOnWifiOnly: true,\n};\n\nlet currentPolicy: ResourcePolicy = { ...DEFAULT_POLICY };\nlet suspendedTabs: Set<string> = new Set();\nlet heavyTabs: Set<string> = new Set();\n\n/**\n * Load policy from storage or use default\n */\nexport async function loadPolicy(): Promise<ResourcePolicy> {\n  try {\n    if (typeof window !== 'undefined' && window.localStorage) {\n      const stored = localStorage.getItem('redix:policy');\n      if (stored) {\n        currentPolicy = { ...DEFAULT_POLICY, ...JSON.parse(stored) };\n      }\n    }\n  } catch (error) {\n    console.warn('[Redix] Failed to load policy:', error);\n  }\n  return currentPolicy;\n}\n\n/**\n * Save policy to storage\n */\nexport function savePolicy(policy: Partial<ResourcePolicy>): void {\n  currentPolicy = { ...currentPolicy, ...policy };\n  try {\n    if (typeof window !== 'undefined' && window.localStorage) {\n      localStorage.setItem('redix:policy', JSON.stringify(currentPolicy));\n      dispatch({\n        type: 'redix:policy:update',\n        payload: currentPolicy,\n      });\n    }\n  } catch (error) {\n    console.error('[Redix] Failed to save policy:', error);\n  }\n}\n\n/**\n * Get current policy\n */\nexport function getPolicy(): ResourcePolicy {\n  return { ...currentPolicy };\n}\n\n/**\n * Suspend a tab (hibernate it to save resources)\n */\nexport async function suspendTab(tabId: string): Promise<void> {\n  if (suspendedTabs.has(tabId)) return;\n\n  try {\n    // Mark as suspended\n    suspendedTabs.add(tabId);\n\n    // Notify Redix\n    dispatch({\n      type: 'redix:tab:suspend',\n      payload: { tabId },\n    });\n\n    // Try to hibernate via IPC (if available)\n    try {\n      if (typeof ipc !== 'undefined' && ipc?.tabs?.wake) {\n        await ipc.tabs.wake(tabId);\n      }\n    } catch {\n      // IPC might not be available, continue\n    }\n  } catch (error) {\n    console.error('[Redix] Failed to suspend tab:', error);\n    suspendedTabs.delete(tabId);\n  }\n}\n\n/**\n * Thaw (restore) a suspended tab\n */\nexport async function thawTab(tabId: string): Promise<void> {\n  if (!suspendedTabs.has(tabId)) return;\n\n  try {\n    suspendedTabs.delete(tabId);\n\n    dispatch({\n      type: 'redix:tab:thaw',\n      payload: { tabId },\n    });\n\n    // Try to wake via IPC\n    try {\n      if (typeof ipc !== 'undefined' && ipc?.tabs?.wake) {\n        await ipc.tabs.wake(tabId);\n      }\n    } catch {\n      // IPC might not be available, continue\n    }\n  } catch (error) {\n    console.error('[Redix] Failed to thaw tab:', error);\n  }\n}\n\n/**\n * Mark a tab as heavy (CPU/memory intensive)\n */\nexport function markTabHeavy(tabId: string, heavy: boolean): void {\n  if (heavy) {\n    heavyTabs.add(tabId);\n    dispatch({\n      type: 'redix:tab:heavy',\n      payload: { tabId },\n    });\n  } else {\n    heavyTabs.delete(tabId);\n    dispatch({\n      type: 'redix:tab:light',\n      payload: { tabId },\n    });\n  }\n}\n\n/**\n * Check if tab is suspended\n */\nexport function isTabSuspended(tabId: string): boolean {\n  return suspendedTabs.has(tabId);\n}\n\n/**\n * Check if tab is marked as heavy\n */\nexport function isTabHeavy(tabId: string): boolean {\n  return heavyTabs.has(tabId);\n}\n\n/**\n * Optimize performance based on current policy and system state\n */\nexport async function optimizePerformance(metrics?: {\n  memoryUsage?: number;\n  cpuUsage?: number;\n  batteryLevel?: number;\n}): Promise<void> {\n  const policy = getPolicy();\n\n  // Check if we should suspend background tabs\n  if (policy.suspendBackgroundTabs) {\n    try {\n      // Skip in web mode - no backend available\n      const isWebMode = !isElectronRuntime() && !isTauriRuntime();\n\n      if (isWebMode) {\n        return; // Skip optimization in web mode\n      }\n\n      // Check if IPC is available\n      if (typeof ipc === 'undefined' || !ipc?.tabs?.list) {\n        return; // IPC not available, skip optimization\n      }\n\n      const tabs = await ipc.tabs.list();\n      if (!Array.isArray(tabs) || tabs.length === 0) {\n        return; // No tabs to optimize\n      }\n\n      const activeTab = tabs.find((t: any) => t.active);\n      const activeId = activeTab?.id;\n\n      for (const tab of tabs) {\n        if (tab.id === activeId) continue;\n        if (tab.url?.startsWith('about:') || tab.url?.startsWith('chrome:')) continue;\n\n        // Check if tab should be suspended\n        const lastActive = tab.lastActiveAt || tab.createdAt || 0;\n        const minutesSinceActive = (Date.now() - lastActive) / (1000 * 60);\n\n        if (minutesSinceActive > policy.suspendAfterMinutes) {\n          await suspendTab(tab.id);\n        }\n      }\n    } catch (error) {\n      console.warn('[Redix] Failed to optimize tabs:', error);\n    }\n  }\n\n  // Check memory threshold\n  if (metrics?.memoryUsage && metrics.memoryUsage > policy.memoryThreshold) {\n    dispatch({\n      type: 'redix:performance:low',\n      payload: { reason: 'memory', usage: metrics.memoryUsage },\n    });\n  }\n\n  // Check CPU threshold\n  if (metrics?.cpuUsage && metrics.cpuUsage > policy.cpuThreshold) {\n    dispatch({\n      type: 'redix:performance:low',\n      payload: { reason: 'cpu', usage: metrics.cpuUsage },\n    });\n  }\n\n  // Check battery threshold\n  if (metrics?.batteryLevel && metrics.batteryLevel < policy.batteryThreshold) {\n    dispatch({\n      type: 'redix:performance:low',\n      payload: { reason: 'battery', level: metrics.batteryLevel },\n    });\n\n    // Disable prefetch on low battery\n    if (policy.prefetchEnabled) {\n      savePolicy({ prefetchEnabled: false });\n    }\n  }\n}\n\n/**\n * Initialize optimizer (load policy, set up listeners)\n */\nexport async function initializeOptimizer(): Promise<void> {\n  await loadPolicy();\n  initializeMemoryPool();\n\n  // Watch for performance events\n  Redix.watch(event => {\n    if (event.type === 'redix:performance:low') {\n      optimizePerformance();\n    }\n  });\n\n  // Periodic optimization check\n  setInterval(() => {\n    optimizePerformance();\n  }, 30000); // Every 30 seconds\n}\n","// @ts-nocheck\n\nimport { ipc } from '../../lib/ipc-typed';\nimport { ipcEvents } from '../../lib/ipc-events';\nimport { isElectronRuntime } from '../../lib/env';\nimport { useTabSuspensionStore, type SuspensionReason } from '../../state/tabSuspensionStore';\nimport { useTabsStore } from '../../state/tabsStore';\nimport { dispatch } from './runtime';\nimport { loadPolicy, getPolicy } from './optimizer';\n\ntype TabSummary = {\n  id: string;\n  title?: string;\n  url?: string;\n  active?: boolean;\n  pinned?: boolean;\n  sleeping?: boolean;\n  lastActiveAt?: number;\n  createdAt?: number;\n};\n\nconst MIN_INACTIVITY_MINUTES = 5;\nconst EVALUATION_INTERVAL = 60 * 1000;\nconst DEFAULT_CAPTURE_WIDTH = 640;\n\nlet initialized = false;\nlet evaluateTimer: ReturnType<typeof setInterval> | null = null;\nlet latestTabs: TabSummary[] = [];\nconst suspendQueue = new Set<string>();\n\n// Cleanup function to prevent memory leaks\nfunction cleanupStaleData(): void {\n  // Remove tabs from latestTabs that no longer exist\n  const currentTabIds = new Set(useTabsStore.getState().tabs.map(t => t.id));\n  latestTabs = latestTabs.filter(tab => currentTabIds.has(tab.id));\n\n  // Clean up suspend queue for tabs that no longer exist\n  suspendQueue.forEach(tabId => {\n    if (!currentTabIds.has(tabId)) {\n      suspendQueue.delete(tabId);\n    }\n  });\n\n  // Clean up suspensions for closed tabs\n  const suspensionStore = useTabSuspensionStore.getState();\n  Object.keys(suspensionStore.suspensions).forEach(tabId => {\n    if (!currentTabIds.has(tabId)) {\n      suspensionStore.resolve(tabId, { silent: true });\n    }\n  });\n}\n\nexport function startTabSuspensionService(): void {\n  if (initialized || typeof window === 'undefined' || !isElectronRuntime()) {\n    return;\n  }\n  initialized = true;\n\n  let inactivityThresholdMs = MIN_INACTIVITY_MINUTES * 60 * 1000;\n\n  // Load persisted policy if present\n  loadPolicy()\n    .then(policy => {\n      if (policy?.suspendAfterMinutes) {\n        inactivityThresholdMs = Math.max(1, policy.suspendAfterMinutes) * 60 * 1000;\n      }\n    })\n    .catch(() => {\n      const policy = getPolicy?.();\n      if (policy?.suspendAfterMinutes) {\n        inactivityThresholdMs = Math.max(1, policy.suspendAfterMinutes) * 60 * 1000;\n      }\n    });\n\n  const handleTabsUpdated = (payload: any) => {\n    if (Array.isArray(payload)) {\n      latestTabs = payload as TabSummary[];\n      cleanupStaleData(); // Clean up stale data first\n      cleanupResolvedSuspensions();\n    }\n  };\n\n  const unsubscribeTabs = ipcEvents.on('tabs:updated', handleTabsUpdated);\n\n  // Ensure we react when tabs close or active tab changes\n  const unsubscribeActive = useTabsStore.subscribe(\n    state => state.activeId,\n    (activeId, previous) => {\n      if (!activeId || activeId === previous) return;\n      const target = useTabsStore.getState().tabs.find(tab => tab.id === activeId);\n      if (target?.sleeping) {\n        resumeSuspendedTab(activeId, { activate: false });\n      } else {\n        useTabSuspensionStore.getState().resolve(activeId, { silent: true });\n      }\n    }\n  );\n\n  const unsubscribeTabsStore = useTabsStore.subscribe(\n    state => state.tabs,\n    () => {\n      cleanupResolvedSuspensions();\n    }\n  );\n\n  evaluateTimer = setInterval(() => {\n    cleanupStaleData(); // Clean up stale data periodically\n    evaluateSuspensions(inactivityThresholdMs).catch(() => {});\n  }, EVALUATION_INTERVAL);\n\n  // Run an immediate pass once tabs list is available\n  evaluateSuspensions(inactivityThresholdMs).catch(() => {});\n\n  // Attach cleanup to window unload\n  window.addEventListener(\n    'beforeunload',\n    () => {\n      unsubscribeTabs();\n      unsubscribeActive();\n      unsubscribeTabsStore();\n      if (evaluateTimer) {\n        clearInterval(evaluateTimer);\n      }\n    },\n    { once: true }\n  );\n}\n\nasync function evaluateSuspensions(thresholdMs: number): Promise<void> {\n  if (!ipc?.tabs?.list) return;\n\n  let tabs = latestTabs;\n  if (!tabs.length) {\n    const list = await ipc.tabs.list().catch(() => []);\n    if (Array.isArray(list)) {\n      tabs = list as TabSummary[];\n      latestTabs = tabs;\n    }\n  }\n\n  if (!tabs.length) return;\n\n  const now = Date.now();\n  for (const tab of tabs) {\n    if (shouldAutoSuspend(tab, now, thresholdMs)) {\n      await suspendTabWithSnapshot(tab, 'inactivity');\n    }\n  }\n}\n\nfunction shouldAutoSuspend(tab: TabSummary, now: number, thresholdMs: number): boolean {\n  if (!tab || !tab.id) return false;\n  if (tab.active) return false;\n  if (tab.sleeping) return false;\n  if (tab.pinned) return false;\n  if (\n    !tab.url ||\n    tab.url.startsWith('about:') ||\n    tab.url.startsWith('chrome:') ||\n    tab.url.startsWith('edge:')\n  ) {\n    return false;\n  }\n  const lastActive = tab.lastActiveAt ?? tab.createdAt ?? 0;\n  if (!lastActive) return false;\n  return now - lastActive >= thresholdMs;\n}\n\nasync function suspendTabWithSnapshot(tab: TabSummary, reason: SuspensionReason): Promise<void> {\n  if (!ipc?.tabs?.hibernate || suspendQueue.has(tab.id)) return;\n  suspendQueue.add(tab.id);\n  try {\n    let snapshot: string | null = null;\n    if (ipc.tabs.capturePreview) {\n      try {\n        const preview = await ipc.tabs.capturePreview({\n          id: tab.id,\n          maxWidth: DEFAULT_CAPTURE_WIDTH,\n          quality: 0.65,\n        });\n        if (preview?.success && preview.dataUrl) {\n          snapshot = preview.dataUrl;\n        }\n      } catch {\n        // Ignore preview errors  suspension still proceeds\n      }\n    }\n\n    await ipc.tabs.hibernate({ id: tab.id });\n\n    useTabSuspensionStore.getState().setSuspended({\n      tabId: tab.id,\n      title: tab.title,\n      url: tab.url,\n      snapshot,\n      suspendedAt: Date.now(),\n      lastActiveAt: tab.lastActiveAt,\n      reason,\n    });\n\n    dispatch({\n      type: 'redix:tab:suspended',\n      payload: { tabId: tab.id, reason },\n    });\n  } catch (error) {\n    console.warn('[Redix] Failed to suspend tab', tab?.id, error);\n  } finally {\n    suspendQueue.delete(tab.id);\n  }\n}\n\nfunction cleanupResolvedSuspensions(): void {\n  const state = useTabSuspensionStore.getState();\n  const tabMap = new Map(latestTabs.map(tab => [tab.id, tab]));\n  const currentTabIds = new Set(useTabsStore.getState().tabs.map(t => t.id));\n\n  // Periodic cleanup of old suspensions\n  state.cleanup();\n\n  Object.keys(state.suspensions).forEach(tabId => {\n    // Remove suspensions for tabs that no longer exist\n    if (!currentTabIds.has(tabId)) {\n      state.resolve(tabId, { silent: true });\n      return;\n    }\n\n    const meta = tabMap.get(tabId);\n    // Resolve if tab is no longer sleeping (was resumed or closed)\n    if (!meta || !meta.sleeping) {\n      state.resolve(tabId, { silent: true });\n    }\n  });\n}\n\nexport async function resumeSuspendedTab(\n  tabId: string,\n  options?: { activate?: boolean }\n): Promise<void> {\n  if (!ipc?.tabs?.wake) {\n    useTabSuspensionStore.getState().resolve(tabId, { silent: true });\n    return;\n  }\n  try {\n    await ipc.tabs.wake({ id: tabId });\n    useTabSuspensionStore.getState().resolve(tabId);\n    dispatch({\n      type: 'redix:tab:resumed',\n      payload: { tabId },\n    });\n    if (options?.activate) {\n      await ipc.tabs.activate({ id: tabId }).catch(() => {});\n    }\n  } catch (error) {\n    console.warn('[Redix] Failed to resume tab', tabId, error);\n  }\n}\n\nexport function acknowledgeSuspendedTab(tabId: string): void {\n  useTabSuspensionStore.getState().acknowledge(tabId);\n}\n\nexport async function manuallySuspendTab(tabId: string): Promise<void> {\n  const tab = latestTabs.find(t => t.id === tabId);\n  if (!tab) return;\n  await suspendTabWithSnapshot(tab, 'manual');\n}\n","import { useMemo } from 'react';\nimport { formatDistanceToNow } from 'date-fns';\nimport { PauseCircle, RotateCcw, Moon } from 'lucide-react';\nimport { useTabSuspensionStore } from '../../state/tabSuspensionStore';\nimport { acknowledgeSuspendedTab, resumeSuspendedTab } from '../../core/redix/tab-suspension';\n\nexport function SuspensionIndicator() {\n  const suspensions = useTabSuspensionStore(state => state.suspensions);\n  const unacknowledged = useMemo(\n    () => Object.values(suspensions).filter(entry => !entry.acknowledged),\n    [suspensions]\n  );\n\n  if (!unacknowledged.length) {\n    return null;\n  }\n\n  const list = [...unacknowledged]\n    .sort((a, b) => (b.suspendedAt || 0) - (a.suspendedAt || 0))\n    .slice(0, 3);\n\n  return (\n    <div className=\"fixed bottom-6 left-6 z-[120] flex flex-col gap-3\">\n      {list.map(entry => (\n        <article\n          key={entry.tabId}\n          className=\"flex w-[320px] items-center gap-3 rounded-2xl border border-purple-500/30 bg-slate-950/90 px-3 py-3 shadow-xl shadow-black/40 backdrop-blur\"\n        >\n          <div className=\"relative overflow-hidden rounded-xl border border-white/10 bg-slate-900/80\">\n            {entry.snapshot ? (\n              <img\n                src={entry.snapshot}\n                alt={entry.title || entry.url || 'Sleeping tab'}\n                className=\"h-16 w-16 object-cover\"\n              />\n            ) : (\n              <div className=\"flex h-16 w-16 items-center justify-center text-purple-300\">\n                <Moon size={20} />\n              </div>\n            )}\n            <span className=\"absolute inset-0 bg-gradient-to-tr from-purple-600/30 to-transparent\" />\n          </div>\n\n          <div className=\"flex-1\">\n            <div className=\"flex items-center gap-2 text-xs uppercase tracking-[0.3em] text-purple-300\">\n              <PauseCircle size={12} />\n              <span>Suspended</span>\n            </div>\n            <p className=\"text-sm font-semibold text-white line-clamp-1\">\n              {entry.title || entry.url || 'Sleeping tab'}\n            </p>\n            <p className=\"text-xs text-slate-400\">\n              {entry.reason === 'memory'\n                ? 'Paused for memory health'\n                : 'Suspended to save resources'}{' '}\n               {formatDistanceToNow(entry.suspendedAt ?? Date.now(), { addSuffix: true })}\n            </p>\n            <div className=\"mt-2 flex items-center gap-2\">\n              <button\n                type=\"button\"\n                onClick={() => resumeSuspendedTab(entry.tabId, { activate: true })}\n                className=\"inline-flex items-center gap-1 rounded-full bg-purple-500/90 px-3 py-1 text-xs font-semibold text-white shadow-sm shadow-purple-500/40 transition hover:brightness-110\"\n              >\n                <RotateCcw size={12} />\n                Resume\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => acknowledgeSuspendedTab(entry.tabId)}\n                className=\"rounded-full border border-white/15 px-3 py-1 text-xs text-slate-300 transition hover:border-white/40 hover:text-white\"\n              >\n                Keep sleeping\n              </button>\n            </div>\n          </div>\n        </article>\n      ))}\n      {unacknowledged.length > list.length && (\n        <div className=\"rounded-full border border-white/15 bg-slate-950/70 px-3 py-1 text-xs text-slate-300 shadow-sm\">\n          +{unacknowledged.length - list.length} more tabs sleeping\n        </div>\n      )}\n    </div>\n  );\n}\n","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\nexport type PowerMode = 'Performance' | 'Balanced' | 'PowerSave' | 'Auto';\nexport type EffectivePowerMode = 'Performance' | 'Balanced' | 'PowerSave';\n\nexport interface BatteryStatus {\n  supported: boolean;\n  level: number | null;\n  charging: boolean | null;\n  chargingTime?: number | null;\n  dischargingTime?: number | null;\n  lastUpdated: number;\n}\n\ninterface PowerState {\n  battery: BatteryStatus;\n  selectedMode: PowerMode;\n  effectiveMode: EffectivePowerMode;\n  setBattery: (status: Partial<BatteryStatus> | BatteryStatus) => void;\n  setMode: (mode: PowerMode) => void;\n}\n\nconst defaultBattery: BatteryStatus = {\n  supported: typeof navigator !== 'undefined' && 'getBattery' in navigator,\n  level: null,\n  charging: null,\n  chargingTime: null,\n  dischargingTime: null,\n  lastUpdated: Date.now(),\n};\n\nfunction deriveEffectiveMode(mode: PowerMode, battery: BatteryStatus): EffectivePowerMode {\n  if (mode !== 'Auto') {\n    return mode;\n  }\n  const level = typeof battery.level === 'number' ? battery.level : null;\n  if (level !== null && !battery.charging && level <= 0.25) {\n    return 'PowerSave';\n  }\n  if (level !== null && battery.charging && level >= 0.95) {\n    return 'Performance';\n  }\n  return 'Balanced';\n}\n\nexport const usePowerStore = create<PowerState>()(\n  persist(\n    set => ({\n      battery: defaultBattery,\n      selectedMode: 'Balanced',\n      effectiveMode: 'Balanced',\n      setBattery: status =>\n        set(state => {\n          const nextBattery = {\n            ...state.battery,\n            ...status,\n            supported:\n              typeof status.supported === 'boolean' ? status.supported : state.battery.supported,\n            lastUpdated: status && 'lastUpdated' in status ? status.lastUpdated! : Date.now(),\n          };\n          const effectiveMode = deriveEffectiveMode(state.selectedMode, nextBattery);\n          return {\n            battery: nextBattery,\n            effectiveMode,\n          };\n        }),\n      setMode: mode =>\n        set(state => {\n          const effectiveMode = deriveEffectiveMode(mode, state.battery);\n          return {\n            selectedMode: mode,\n            effectiveMode,\n          };\n        }),\n    }),\n    {\n      name: 'redix:power-store',\n      partialize: state => ({\n        selectedMode: state.selectedMode,\n      }),\n      onRehydrateStorage: () => state => {\n        if (state) {\n          state.effectiveMode = deriveEffectiveMode(\n            state.selectedMode,\n            state.battery ?? defaultBattery\n          );\n        }\n      },\n    }\n  )\n);\n","// @ts-nocheck\n\nimport { configureMemoryPool } from './memory-pool';\nimport { dispatch } from './runtime';\nimport { usePowerStore, EffectivePowerMode, PowerMode } from '../../state/powerStore';\n\nconst MODE_PRESETS: Record<\n  EffectivePowerMode,\n  { tabCapMB: number; maxTotalMB: number; reserveForActiveTabsMB: number }\n> = {\n  Performance: {\n    tabCapMB: 768,\n    maxTotalMB: 6144,\n    reserveForActiveTabsMB: 2048,\n  },\n  Balanced: {\n    tabCapMB: 512,\n    maxTotalMB: 4096,\n    reserveForActiveTabsMB: 1536,\n  },\n  PowerSave: {\n    tabCapMB: 384,\n    maxTotalMB: 3072,\n    reserveForActiveTabsMB: 1024,\n  },\n};\n\nlet initialized = false;\nlet unsubscribe: (() => void) | null = null;\n\nexport function initPowerModes(): void {\n  if (initialized) return;\n  initialized = true;\n\n  applyEffectiveMode(usePowerStore.getState().effectiveMode);\n\n  unsubscribe = usePowerStore.subscribe(\n    state => state.effectiveMode,\n    (mode, prev) => {\n      if (mode !== prev) {\n        applyEffectiveMode(mode);\n      }\n    }\n  );\n\n  window.addEventListener(\n    'beforeunload',\n    () => {\n      unsubscribe?.();\n    },\n    { once: true }\n  );\n}\n\nexport function setPowerMode(mode: PowerMode): void {\n  usePowerStore.getState().setMode(mode);\n}\n\nfunction applyEffectiveMode(mode: EffectivePowerMode) {\n  const preset = MODE_PRESETS[mode] ?? MODE_PRESETS.Balanced;\n  configureMemoryPool(preset);\n  dispatch({\n    type: 'redix:power:mode',\n    payload: {\n      effectiveMode: mode,\n      selectedMode: usePowerStore.getState().selectedMode,\n    },\n  });\n}\n","import { motion, AnimatePresence } from 'framer-motion';\nimport { PowerMode } from '../../state/powerStore';\nimport { setPowerMode } from '../../core/redix/power-modes';\n\ntype Props = {\n  selected: PowerMode;\n  effective: 'Performance' | 'Balanced' | 'PowerSave';\n  onClose: () => void;\n  onSelect: (mode: PowerMode) => void;\n};\n\nconst MODE_CARDS: Array<{\n  id: PowerMode;\n  title: string;\n  description: string;\n  metrics: string;\n}> = [\n  {\n    id: 'Performance',\n    title: 'Performance',\n    description: 'Full power, no throttling. Ideal when plugged in.',\n    metrics: 'Max tabs  High AI throughput',\n  },\n  {\n    id: 'Balanced',\n    title: 'Balanced',\n    description: 'Smart defaults for everyday browsing.',\n    metrics: 'Adaptive caps  Standard prefetch',\n  },\n  {\n    id: 'PowerSave',\n    title: 'Power-save',\n    description: 'Aggressive throttling to extend battery life.',\n    metrics: 'Lower tab caps  Prefetch paused',\n  },\n  {\n    id: 'Auto',\n    title: 'Auto',\n    description: 'Automatically chooses the best mode using battery signals.',\n    metrics: 'Smart switching',\n  },\n];\n\nexport function PowerModeSelector({ selected, effective, onClose, onSelect }: Props) {\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 z-[160] flex items-center justify-center bg-black/60 backdrop-blur-sm px-4\"\n      >\n        <motion.div\n          initial={{ y: 20, opacity: 0 }}\n          animate={{ y: 0, opacity: 1 }}\n          exit={{ y: 20, opacity: 0 }}\n          className=\"w-full max-w-3xl rounded-[32px] border border-white/10 bg-slate-950/90 p-6 shadow-[0_35px_120px_rgba(0,0,0,0.55)]\"\n        >\n          <header className=\"mb-6 flex items-center justify-between gap-4\">\n            <div>\n              <p className=\"text-xs uppercase tracking-[0.4em] text-slate-500\">Power modes</p>\n              <h2 className=\"text-2xl font-semibold text-white\">Optimize Redix for the moment</h2>\n              <p className=\"text-sm text-slate-400\">\n                {selected === 'Auto'\n                  ? `Auto is managing power. Currently running ${effective}.`\n                  : `Active mode: ${selected}. Switch whenever you need.`}\n              </p>\n            </div>\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"rounded-full border border-white/20 px-4 py-2 text-xs font-semibold uppercase tracking-[0.3em] text-slate-300 hover:border-white/40\"\n            >\n              Close\n            </button>\n          </header>\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            {MODE_CARDS.map(card => {\n              const isSelected = selected === card.id;\n              const isEffective = card.id !== 'Auto' && effective === card.id;\n              return (\n                <button\n                  key={card.id}\n                  type=\"button\"\n                  onClick={() => {\n                    setPowerMode(card.id);\n                    onSelect(card.id);\n                  }}\n                  className={`flex h-full flex-col items-start gap-2 rounded-3xl border px-4 py-4 text-left transition ${\n                    isSelected\n                      ? 'border-purple-400/70 bg-purple-500/10 shadow-[0_0_25px_rgba(168,85,247,0.2)]'\n                      : 'border-white/10 bg-white/5 hover:border-white/30'\n                  }`}\n                >\n                  <div className=\"flex w-full items-center justify-between\">\n                    <div>\n                      <p className=\"text-lg font-semibold text-white\">{card.title}</p>\n                      <p className=\"text-xs text-slate-400\">{card.metrics}</p>\n                    </div>\n                    {isSelected && (\n                      <span className=\"rounded-full bg-purple-500/20 px-3 py-1 text-xs font-semibold text-purple-200\">\n                        Active\n                      </span>\n                    )}\n                  </div>\n                  <p className=\"text-sm text-slate-300\">{card.description}</p>\n                  {card.id === 'Auto' && isEffective && (\n                    <p className=\"text-xs text-emerald-300\">\n                      Auto is currently running {effective}\n                    </p>\n                  )}\n                </button>\n              );\n            })}\n          </div>\n        </motion.div>\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n","import { useState, useMemo } from 'react';\nimport { Battery, BatteryCharging, Zap } from 'lucide-react';\nimport { usePowerStore, PowerMode } from '../../state/powerStore';\nimport { PowerModeSelector } from './PowerModeSelector';\nimport { setPowerMode } from '../../core/redix/power-modes';\n\nfunction formatPercent(level: number | null): string {\n  if (typeof level !== 'number') return '';\n  return `${Math.round(level * 100)}%`;\n}\n\nexport function BatteryIndicator() {\n  const battery = usePowerStore(state => state.battery);\n  const selectedMode = usePowerStore(state => state.selectedMode);\n  const effectiveMode = usePowerStore(state => state.effectiveMode);\n  const [selectorOpen, setSelectorOpen] = useState(false);\n\n  const icon = useMemo(() => {\n    if (battery.charging) {\n      return <BatteryCharging size={18} className=\"text-emerald-300\" />;\n    }\n    return <Battery size={18} className=\"text-slate-200\" />;\n  }, [battery.charging]);\n\n  const levelLabel = formatPercent(battery.level);\n  const autoActive = selectedMode === 'Auto';\n\n  const modeLabel = autoActive ? `Auto  ${effectiveMode}` : effectiveMode;\n\n  return (\n    <>\n      <div className=\"fixed bottom-6 right-6 z-[110] flex flex-col items-end gap-2\">\n        <button\n          type=\"button\"\n          onClick={() => setSelectorOpen(true)}\n          className=\"flex items-center gap-3 rounded-2xl border border-white/10 bg-slate-900/80 px-3 py-2 text-left text-sm text-white shadow-lg shadow-black/40 backdrop-blur transition hover:border-white/30\"\n        >\n          <div className=\"flex items-center gap-2\">\n            {icon}\n            <div className=\"flex flex-col leading-tight\">\n              <span className=\"text-xs uppercase tracking-[0.35em] text-slate-400\">Battery</span>\n              <span className=\"text-sm font-semibold text-white\">{levelLabel}</span>\n            </div>\n          </div>\n          <div className=\"flex flex-col text-right leading-tight\">\n            <span className=\"text-xs uppercase tracking-[0.35em] text-slate-400\">Mode</span>\n            <span className=\"text-sm font-semibold text-white\">{modeLabel}</span>\n          </div>\n          <div className=\"rounded-full bg-purple-500/20 p-1.5 text-purple-200\">\n            <Zap size={14} />\n          </div>\n        </button>\n        {!battery.supported && (\n          <span className=\"text-xs text-slate-400\">Battery telemetry unavailable</span>\n        )}\n      </div>\n      {selectorOpen && (\n        <PowerModeSelector\n          selected={selectedMode}\n          effective={effectiveMode}\n          onClose={() => setSelectorOpen(false)}\n          onSelect={(mode: PowerMode) => {\n            setPowerMode(mode);\n            setSelectorOpen(false);\n          }}\n        />\n      )}\n    </>\n  );\n}\n","import { create } from 'zustand';\n\nexport interface TabMemorySample {\n  tabId: string;\n  title?: string;\n  url?: string;\n  memoryMB: number;\n  timestamp: number;\n  pinned?: boolean;\n  appMode?: string;\n  sleeping?: boolean;\n}\n\nexport interface MemorySnapshot {\n  totalMB: number;\n  freeMB?: number;\n  timestamp: number;\n  tabs: TabMemorySample[];\n  savingsMB?: number;\n}\n\ninterface MemoryState {\n  history: MemorySnapshot[];\n  latest?: MemorySnapshot;\n  capacityMB?: number;\n  pushSnapshot: (snapshot: MemorySnapshot) => void;\n  setCapacity: (capacity: number) => void;\n}\n\nconst MAX_HISTORY = 200;\n\nexport const useMemoryStore = create<MemoryState>(set => ({\n  history: [],\n  latest: undefined,\n  capacityMB: undefined,\n  pushSnapshot: snapshot =>\n    set(state => {\n      const history = [...state.history, snapshot].slice(-MAX_HISTORY);\n      return {\n        latest: snapshot,\n        history,\n      };\n    }),\n  setCapacity: capacity =>\n    set(() => ({\n      capacityMB: capacity,\n    })),\n}));\n","import { useMemo, useState } from 'react';\nimport { Activity, AlertTriangle, BarChart3 } from 'lucide-react';\nimport { useMemoryStore } from '../../state/memoryStore';\n\nconst severityColor = (ratio: number) => {\n  if (ratio >= 0.85) return 'text-red-400';\n  if (ratio >= 0.7) return 'text-amber-300';\n  return 'text-emerald-300';\n};\n\nexport function MemoryMonitor() {\n  const latest = useMemoryStore(state => state.latest);\n  const history = useMemoryStore(state => state.history);\n  const capacityMB = useMemoryStore(state => state.capacityMB);\n  const [expanded, setExpanded] = useState(true);\n\n  const topTabs = useMemo(() => {\n    if (!latest) return [];\n    return [...latest.tabs].sort((a, b) => b.memoryMB - a.memoryMB).slice(0, 5);\n  }, [latest]);\n\n  const sparklinePoints = useMemo(() => {\n    if (!history.length) return [];\n    const max = Math.max(...history.map(snapshot => snapshot.totalMB || 0), 1);\n    return history.slice(-40).map((snapshot, index, arr) => ({\n      x: (index / Math.max(1, arr.length - 1)) * 100,\n      y: 40 - (Math.min(snapshot.totalMB || 0, max) / max) * 40,\n    }));\n  }, [history]);\n\n  if (!latest) return null;\n\n  const total = latest.totalMB;\n  const capacity = capacityMB ?? Math.max(total * 1.5, 4096);\n  const ratio = Math.min(total / capacity, 1);\n  const percent = Math.round(ratio * 100);\n  const severity = severityColor(ratio);\n\n  return (\n    <div className=\"rounded-3xl border border-slate-900/60 bg-slate-950/70 p-4 shadow-inner shadow-black/40\">\n      <header className=\"mb-3 flex items-center justify-between\">\n        <div className=\"flex items-center gap-2 text-white\">\n          <Activity size={16} className=\"text-purple-300\" />\n          <h3 className=\"text-sm font-semibold uppercase tracking-[0.3em]\">Memory Monitor</h3>\n        </div>\n        <button\n          type=\"button\"\n          onClick={() => setExpanded(prev => !prev)}\n          className=\"text-xs text-slate-400 underline-offset-2 hover:text-white\"\n        >\n          {expanded ? 'Hide' : 'Show'}\n        </button>\n      </header>\n      <div className=\"flex flex-wrap items-center gap-4\">\n        <div className=\"flex-1 min-w-[200px]\">\n          <div className=\"text-xs text-slate-400\">Total usage</div>\n          <div className=\"text-xl font-semibold text-white\">\n            {total.toFixed(0)} MB{' '}\n            <span className=\"text-sm text-slate-500\">\n              / {capacity.toFixed(0)} MB\n              {latest.freeMB ? ` (${latest.freeMB.toFixed(0)} MB free)` : ''}\n            </span>\n          </div>\n          <div className=\"mt-2 h-3 overflow-hidden rounded-full bg-slate-800\">\n            <div\n              className={`h-full rounded-full ${ratio >= 0.85 ? 'bg-red-500' : ratio >= 0.7 ? 'bg-amber-400' : 'bg-emerald-400'}`}\n              style={{ width: `${percent}%` }}\n            />\n          </div>\n          <p className={`mt-1 text-xs font-semibold ${severity}`}>{percent}% of budget used</p>\n        </div>\n        <div className=\"flex min-w-[160px] flex-col gap-1 rounded-2xl border border-white/10 bg-white/5 px-3 py-2 text-xs text-slate-300\">\n          <span className=\"text-slate-400\">Trend (last 30 samples)</span>\n          <svg\n            width=\"140\"\n            height=\"40\"\n            viewBox=\"0 0 100 40\"\n            preserveAspectRatio=\"none\"\n            className=\"text-purple-300\"\n          >\n            <polyline\n              fill=\"none\"\n              stroke=\"currentColor\"\n              strokeWidth=\"2\"\n              points={sparklinePoints.map(point => `${point.x},${point.y}`).join(' ')}\n            />\n          </svg>\n        </div>\n      </div>\n      {expanded && (\n        <div className=\"mt-4 grid gap-3 md:grid-cols-2\">\n          <div className=\"rounded-2xl border border-white/10 bg-white/5 p-3\">\n            <div className=\"mb-2 flex items-center gap-2 text-xs uppercase tracking-[0.2em] text-slate-400\">\n              <BarChart3 size={14} />\n              Top tabs\n            </div>\n            <div className=\"space-y-2\">\n              {topTabs.map(tab => (\n                <div\n                  key={tab.tabId}\n                  className=\"flex items-center justify-between rounded-xl bg-black/20 px-3 py-2 text-sm text-slate-200\"\n                >\n                  <div className=\"min-w-0\">\n                    <p className=\"truncate font-semibold text-white\">\n                      {tab.title || tab.url || 'Untitled tab'}\n                    </p>\n                    <p className=\"text-xs text-slate-400\">{tab.appMode || 'Browse'}</p>\n                  </div>\n                  <span className=\"ml-3 font-semibold text-slate-100\">\n                    {tab.memoryMB.toFixed(0)} MB\n                  </span>\n                </div>\n              ))}\n            </div>\n          </div>\n          <div className=\"rounded-2xl border border-white/10 bg-white/5 p-3\">\n            <div className=\"mb-2 flex items-center gap-2 text-xs uppercase tracking-[0.2em] text-slate-400\">\n              <AlertTriangle size={14} />\n              Alerts\n            </div>\n            {percent >= 85 ? (\n              <div className=\"rounded-xl border border-red-400/40 bg-red-500/10 px-3 py-2 text-sm text-red-200\">\n                Memory is critically high. Consider closing heavy tabs.\n              </div>\n            ) : percent >= 70 ? (\n              <div className=\"rounded-xl border border-amber-400/40 bg-amber-500/10 px-3 py-2 text-sm text-amber-200\">\n                Memory usage elevated. Auto power-save may trigger soon.\n              </div>\n            ) : (\n              <div className=\"rounded-xl border border-emerald-400/40 bg-emerald-500/10 px-3 py-2 text-sm text-emerald-200\">\n                Memory is healthy. Redix is reclaiming surplus automatically.\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","/**\n * MiniHoverAI - Hover-based AI assistant for text selection\n * Based on Figma UI/UX Prototype Flow redesign\n */\n\nimport { useState, useEffect, useRef } from 'react';\nimport { Sparkles, Copy, BookOpen, Search, X, Loader2 } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ipc } from '../../lib/ipc-typed';\n\nexport interface MiniHoverAIProps {\n  enabled?: boolean;\n  onAction?: (action: string, text: string) => void;\n}\n\ntype ActionType = 'summarize' | 'explain' | 'translate' | 'search' | 'copy';\n\nconst actions: Array<{ id: ActionType; label: string; icon: React.ReactNode }> = [\n  { id: 'summarize', label: 'Summarize', icon: <BookOpen size={14} /> },\n  { id: 'explain', label: 'Explain', icon: <Sparkles size={14} /> },\n  { id: 'translate', label: 'Translate', icon: <Search size={14} /> },\n  { id: 'search', label: 'Search', icon: <Search size={14} /> },\n  { id: 'copy', label: 'Copy', icon: <Copy size={14} /> },\n];\n\nexport function MiniHoverAI({ enabled = true, onAction }: MiniHoverAIProps) {\n  const [selectedText, setSelectedText] = useState<string>('');\n  const [position, setPosition] = useState<{ x: number; y: number } | null>(null);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [showActions, setShowActions] = useState(false);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (!enabled) return;\n\n    const handleSelection = () => {\n      const selection = window.getSelection();\n      const text = selection?.toString().trim() || '';\n\n      if (text.length > 0 && text.length < 500) {\n        // Get selection position\n        const range = selection?.getRangeAt(0);\n        if (range) {\n          const rect = range.getBoundingClientRect();\n          setPosition({\n            x: rect.left + rect.width / 2,\n            y: rect.top - 10,\n          });\n          setSelectedText(text);\n          setShowActions(true);\n        }\n      } else {\n        setShowActions(false);\n        setSelectedText('');\n        setPosition(null);\n      }\n    };\n\n    const handleClickOutside = (e: MouseEvent) => {\n      if (containerRef.current && !containerRef.current.contains(e.target as Node)) {\n        setShowActions(false);\n        setSelectedText('');\n        setPosition(null);\n      }\n    };\n\n    document.addEventListener('selectionchange', handleSelection);\n    document.addEventListener('mousedown', handleClickOutside);\n\n    return () => {\n      document.removeEventListener('selectionchange', handleSelection);\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [enabled]);\n\n  const handleAction = async (actionId: ActionType) => {\n    if (!selectedText) return;\n\n    setIsProcessing(true);\n\n    try {\n      switch (actionId) {\n        case 'copy':\n          await navigator.clipboard.writeText(selectedText);\n          onAction?.(actionId, selectedText);\n          break;\n\n        case 'summarize':\n        case 'explain':\n        case 'translate':\n        case 'search':\n          // Trigger AI action via IPC\n          try {\n            await ipc.redix.stream(\n              `${actionId}: ${selectedText}`,\n              { sessionId: `minihover-${Date.now()}` },\n              chunk => {\n                // Handle streaming response\n                if (chunk.type === 'token' && chunk.text) {\n                  // Could show a toast or open right panel\n                  console.log('[MiniHoverAI] Response:', chunk.text);\n                }\n              }\n            );\n            onAction?.(actionId, selectedText);\n          } catch (error) {\n            console.error('[MiniHoverAI] AI action failed:', error);\n          }\n          break;\n      }\n    } catch (error) {\n      console.error('[MiniHoverAI] Action failed:', error);\n    } finally {\n      setIsProcessing(false);\n      setShowActions(false);\n      setSelectedText('');\n      setPosition(null);\n      // Clear selection\n      window.getSelection()?.removeAllRanges();\n    }\n  };\n\n  if (!enabled || !showActions || !position) return null;\n\n  return (\n    <AnimatePresence>\n      {showActions && position && (\n        <motion.div\n          ref={containerRef}\n          initial={{ opacity: 0, scale: 0.8, y: 10 }}\n          animate={{ opacity: 1, scale: 1, y: 0 }}\n          exit={{ opacity: 0, scale: 0.8, y: 10 }}\n          transition={{ duration: 0.2 }}\n          className=\"fixed z-[9999] pointer-events-auto\"\n          style={{\n            left: `${position.x}px`,\n            top: `${position.y}px`,\n            transform: 'translate(-50%, -100%)',\n          }}\n        >\n          <div className=\"bg-gray-900/95 backdrop-blur-xl border border-gray-700/50 rounded-lg shadow-2xl p-2 flex items-center gap-1\">\n            {isProcessing ? (\n              <div className=\"flex items-center gap-2 px-3 py-2 text-sm text-gray-300\">\n                <Loader2 size={16} className=\"animate-spin text-blue-400\" />\n                <span>Processing...</span>\n              </div>\n            ) : (\n              <>\n                {actions.map(action => (\n                  <motion.button\n                    key={action.id}\n                    onClick={() => handleAction(action.id)}\n                    whileHover={{ scale: 1.05 }}\n                    whileTap={{ scale: 0.95 }}\n                    className=\"flex items-center gap-1.5 px-3 py-2 rounded-md bg-gray-800/60 hover:bg-gray-700/80 border border-gray-700/50 text-gray-300 hover:text-blue-400 transition-colors text-xs font-medium\"\n                    title={action.label}\n                  >\n                    {action.icon}\n                    <span>{action.label}</span>\n                  </motion.button>\n                ))}\n                <button\n                  onClick={() => {\n                    setShowActions(false);\n                    setSelectedText('');\n                    setPosition(null);\n                    window.getSelection()?.removeAllRanges();\n                  }}\n                  className=\"p-2 rounded-md text-gray-400 hover:text-gray-200 hover:bg-gray-800/60 transition-colors\"\n                  title=\"Close\"\n                >\n                  <X size={14} />\n                </button>\n              </>\n            )}\n          </div>\n          {/* Arrow pointing to selection */}\n          <div className=\"absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-full w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-700/50\" />\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n","/**\n * WISPR Command Handler\n * Parses and routes voice commands to appropriate executors\n */\n\nimport { useAppStore } from '../../state/appStore';\nimport { useSettingsStore } from '../../state/settingsStore';\nimport { ipc } from '../../lib/ipc-typed';\nimport { toast } from '../../utils/toast';\nimport { aiEngine } from '../ai/engine';\n\nexport type WisprCommandType =\n  | 'trade'\n  | 'search'\n  | 'research'\n  | 'summarize'\n  | 'explain'\n  | 'fill_form'\n  | 'save_profile'\n  | 'screenshot'\n  | 'open_tabs'\n  | 'navigate'\n  | 'weather'\n  | 'train'\n  | 'flight'\n  | 'unknown';\n\nexport interface ParsedWisprCommand {\n  type: WisprCommandType;\n  query?: string;\n  symbol?: string;\n  quantity?: number;\n  stopLoss?: number;\n  takeProfit?: number;\n  orderType?: 'buy' | 'sell' | 'market' | 'limit';\n  tabs?: number;\n  url?: string;\n  language?: string;\n  originalText: string;\n}\n\n/**\n * Parse voice command into structured command\n */\nexport function parseWisprCommand(text: string): ParsedWisprCommand {\n  const lowerText = text.toLowerCase().trim();\n  const originalText = text.trim();\n\n  // Trade commands - Enhanced Hindi + English patterns\n  const tradePatterns = [\n    // Hindi: \"  50\" or \" 50 \"\n    /(?:|nifty|reliance||tcs|hdfc|)\\s*(?:(\\d+)\\s*)?(?:|kharido|buy||becho|sell)/i,\n    // \"Nifty kharido 50 quantity SL 24700\"\n    /(?:buy|kharido||becho||sell)\\s+(\\w+)\\s*(?:(\\d+)\\s*(?:quantity|qty|qty|))?\\s*(?:SL|stop\\s*loss|\\s*)\\s*(\\d+)?/i,\n    // \"100 HDFC Bank becho at market\"\n    /(\\d+)\\s+(\\w+(?:\\s+\\w+)?)\\s+(?:buy|kharido||becho||sell)\\s*(?:at\\s*market|market\\s*price)?/i,\n    // \"Buy 50 Nifty\" or \"50 Nifty buy\"\n    /(?:buy|kharido|)\\s+(\\d+)\\s+(\\w+)/i,\n    /(\\d+)\\s+(\\w+)\\s+(?:buy|kharido||sell|becho|)/i,\n  ];\n\n  for (const pattern of tradePatterns) {\n    const match = lowerText.match(pattern);\n    if (match) {\n      const isSell =\n        lowerText.includes('sell') || lowerText.includes('becho') || lowerText.includes('');\n\n      // Extract symbol (handle Hindi names)\n      let symbol = match[2] || match[1];\n      if (lowerText.includes('') || lowerText.includes('nifty')) {\n        symbol = 'NIFTY';\n      } else if (lowerText.includes('') || lowerText.includes('tcs')) {\n        symbol = 'TCS';\n      } else if (lowerText.includes('') || lowerText.includes('hdfc')) {\n        symbol = 'HDFC';\n      } else if (lowerText.includes('reliance')) {\n        symbol = 'RELIANCE';\n      }\n\n      // Extract quantity\n      let quantity = 1;\n      if (match[1] && !isNaN(parseInt(match[1], 10))) {\n        quantity = parseInt(match[1], 10);\n      } else if (match[2] && !isNaN(parseInt(match[2], 10))) {\n        quantity = parseInt(match[2], 10);\n      }\n\n      // Extract stop loss\n      const slMatch = lowerText.match(/(?:SL|stop\\s*loss|\\s*)\\s*(\\d+)/i);\n      const stopLoss = slMatch ? parseInt(slMatch[1], 10) : undefined;\n\n      return {\n        type: 'trade',\n        orderType: isSell ? 'sell' : 'buy',\n        symbol: symbol.toUpperCase(),\n        quantity,\n        stopLoss,\n        originalText,\n      };\n    }\n  }\n\n  // Weather commands - Hindi + English\n  if (\n    lowerText.includes('') ||\n    lowerText.includes('weather') ||\n    lowerText.includes('') ||\n    lowerText.includes('') ||\n    lowerText.includes('temperature') ||\n    lowerText.includes('')\n  ) {\n    let city = 'Delhi'; // default\n    if (lowerText.includes('') || lowerText.includes('mumbai')) city = 'Mumbai';\n    if (lowerText.includes('') || lowerText.includes('bangalore')) city = 'Bangalore';\n    if (lowerText.includes('') || lowerText.includes('kolkata')) city = 'Kolkata';\n    if (lowerText.includes('') || lowerText.includes('chennai')) city = 'Chennai';\n    if (lowerText.includes('') || lowerText.includes('hyderabad')) city = 'Hyderabad';\n\n    return {\n      type: 'weather',\n      query: city,\n      originalText,\n    };\n  }\n\n  // Train booking commands\n  if (\n    lowerText.includes('') ||\n    lowerText.includes('train') ||\n    lowerText.includes('') ||\n    lowerText.includes('ticket') ||\n    (lowerText.includes('book') && (lowerText.includes('train') || lowerText.includes('')))\n  ) {\n    let from = 'Delhi';\n    let to = 'Mumbai';\n    let date = 'tomorrow';\n\n    // Extract cities\n    if (lowerText.includes('') || lowerText.includes('mumbai')) {\n      if (lowerText.includes('') || lowerText.includes('from')) to = 'Mumbai';\n      else from = 'Mumbai';\n    }\n    if (lowerText.includes('') || lowerText.includes('delhi')) {\n      if (lowerText.includes('') || lowerText.includes('from')) from = 'Delhi';\n      else to = 'Delhi';\n    }\n    if (lowerText.includes('') || lowerText.includes('chennai')) to = 'Chennai';\n    if (lowerText.includes('') || lowerText.includes('bangalore')) to = 'Bangalore';\n    if (lowerText.includes('') || lowerText.includes('kolkata')) to = 'Kolkata';\n\n    return {\n      type: 'train',\n      query: `${from} to ${to} on ${date}`,\n      url: `train:${from}:${to}:${date}`,\n      originalText,\n    };\n  }\n\n  // Flight booking commands\n  if (\n    lowerText.includes('') ||\n    lowerText.includes('flight') ||\n    lowerText.includes(' ') ||\n    lowerText.includes('') ||\n    (lowerText.includes('book') && (lowerText.includes('flight') || lowerText.includes('')))\n  ) {\n    let from = 'Delhi';\n    let to = 'Mumbai';\n    let date = 'tomorrow';\n    let returnDate: string | undefined = undefined;\n\n    // Extract cities\n    if (lowerText.includes('') || lowerText.includes('mumbai')) to = 'Mumbai';\n    if (lowerText.includes('') || lowerText.includes('bangalore')) to = 'Bangalore';\n    if (lowerText.includes('') || lowerText.includes('chennai')) to = 'Chennai';\n    if (lowerText.includes('') || lowerText.includes('delhi')) from = 'Delhi';\n\n    // Detect round-trip\n    if (\n      lowerText.includes('') ||\n      lowerText.includes('return') ||\n      lowerText.includes('') ||\n      lowerText.includes(' ')\n    ) {\n      returnDate = '20 December'; // Parse from text if needed\n    }\n\n    return {\n      type: 'flight',\n      query: `${from} to ${to} on ${date}${returnDate ? ` return ${returnDate}` : ''}`,\n      url: `flight:${from}:${to}:${date}${returnDate ? `:${returnDate}` : ''}`,\n      originalText,\n    };\n  }\n\n  // Research commands\n  if (lowerText.includes('research') || lowerText.includes('research kar')) {\n    const researchMatch = lowerText.match(/research\\s+(?:kar\\s+)?(.+)/i);\n    return {\n      type: 'research',\n      query: researchMatch?.[1] || originalText.replace(/research\\s+(?:kar\\s+)?/i, ''),\n      originalText,\n    };\n  }\n\n  // Search commands\n  if (\n    lowerText.includes('search') ||\n    lowerText.includes('dhundho') ||\n    lowerText.includes('') ||\n    lowerText.includes('show me') ||\n    lowerText.includes('dikhao')\n  ) {\n    const searchMatch = lowerText.match(/(?:search|dhundho||show\\s+me|dikhao)\\s+(.+)/i);\n    return {\n      type: 'search',\n      query: searchMatch?.[1] || originalText,\n      originalText,\n    };\n  }\n\n  // Summarize commands\n  if (\n    lowerText.includes('summarize') ||\n    lowerText.includes('summary') ||\n    lowerText.includes('samjha de') ||\n    lowerText.includes(' ')\n  ) {\n    return {\n      type: 'summarize',\n      query: originalText,\n      originalText,\n    };\n  }\n\n  // Explain code commands\n  if (\n    lowerText.includes('explain') ||\n    lowerText.includes('kya kar raha hai') ||\n    lowerText.includes('   ')\n  ) {\n    return {\n      type: 'explain',\n      query: originalText,\n      originalText,\n    };\n  }\n\n  // Fill form commands\n  if (\n    lowerText.includes('fill') ||\n    lowerText.includes('daal do') ||\n    lowerText.includes(' ') ||\n    lowerText.includes('form fill') ||\n    lowerText.includes('auto fill')\n  ) {\n    return {\n      type: 'fill_form',\n      query: originalText,\n      originalText,\n    };\n  }\n\n  // Save profile commands\n  if (\n    lowerText.includes('save my profile') ||\n    lowerText.includes('save profile') ||\n    lowerText.includes('mera profile save kar') ||\n    lowerText.includes('   ')\n  ) {\n    return {\n      type: 'save_profile',\n      query: originalText,\n      originalText,\n    };\n  }\n\n  // Screenshot/analysis commands - Enhanced Hindi support\n  if (\n    lowerText.includes('screenshot') ||\n    lowerText.includes('') ||\n    lowerText.includes('screenshot le') ||\n    lowerText.includes(' ') ||\n    lowerText.includes('isme kya hai') ||\n    lowerText.includes('  ') ||\n    lowerText.includes('analysis') ||\n    lowerText.includes('analysis kar') ||\n    lowerText.includes(' ') ||\n    lowerText.includes('yeh chart') ||\n    lowerText.includes(' ')\n  ) {\n    return {\n      type: 'screenshot',\n      query: originalText,\n      originalText,\n    };\n  }\n\n  // Open multiple tabs\n  if (lowerText.includes('open') && lowerText.match(/\\d+\\s+tab/)) {\n    const tabsMatch = lowerText.match(/open\\s+(\\d+)\\s+tab/i);\n    const queryMatch = lowerText.match(/about\\s+(.+)/i);\n    return {\n      type: 'open_tabs',\n      tabs: tabsMatch ? parseInt(tabsMatch[1], 10) : 5,\n      query: queryMatch?.[1],\n      originalText,\n    };\n  }\n\n  // Navigate commands\n  if (lowerText.includes('open') || lowerText.includes('go to') || lowerText.includes('kholo')) {\n    const urlMatch = lowerText.match(/(?:open|go\\s+to|kholo)\\s+(.+)/i);\n    return {\n      type: 'navigate',\n      url: urlMatch?.[1] || originalText,\n      originalText,\n    };\n  }\n\n  // Default: treat as search\n  return {\n    type: 'search',\n    query: originalText,\n    originalText,\n  };\n}\n\n/**\n * Execute parsed WISPR command\n */\nexport async function executeWisprCommand(command: ParsedWisprCommand): Promise<void> {\n  const currentMode = useAppStore.getState().mode;\n\n  try {\n    // Route command to backend if in Tauri\n    const { isElectronRuntime } = await import('../../lib/env');\n    if (isElectronRuntime()) {\n      try {\n        const { ipc } = await import('../../lib/ipc-typed');\n        const modeName = currentMode.toLowerCase();\n        const result = await (ipc as any).invoke('wispr_command', {\n          input: command.originalText,\n          mode: modeName,\n        });\n        if (result) {\n          toast.success(result);\n          return;\n        }\n      } catch (error) {\n        console.warn('[WISPR] Backend routing failed, using frontend:', error);\n      }\n    }\n\n    // Fallback to frontend execution\n    switch (command.type) {\n      case 'trade':\n        await executeTradeCommand(command);\n        break;\n\n      case 'research':\n        await executeResearchCommand(command);\n        break;\n\n      case 'search':\n        await executeSearchCommand(command);\n        break;\n\n      case 'summarize':\n        await executeSummarizeCommand(command);\n        break;\n\n      case 'explain':\n        await executeExplainCommand(command);\n        break;\n\n      case 'fill_form':\n        await executeFillFormCommand(command);\n        break;\n\n      case 'save_profile':\n        await executeSaveProfileCommand(command);\n        break;\n\n      case 'screenshot':\n        await executeScreenshotCommand(command);\n        break;\n\n      case 'open_tabs':\n        await executeOpenTabsCommand(command);\n        break;\n\n      case 'navigate':\n        await executeNavigateCommand(command);\n        break;\n\n      case 'weather':\n        await executeWeatherCommand(command);\n        break;\n\n      case 'train':\n        await executeTrainCommand(command);\n        break;\n\n      case 'flight':\n        await executeFlightCommand(command);\n        break;\n\n      default:\n        // Fallback to AI search\n        await executeSearchCommand(command);\n    }\n  } catch (error) {\n    console.error('[WISPR] Command execution failed:', error);\n    toast.error(`Failed to execute: ${command.originalText}`);\n  }\n}\n\nasync function executeTradeCommand(command: ParsedWisprCommand) {\n  // Switch to Trade mode if not already\n  if (useAppStore.getState().mode !== 'Trade') {\n    useAppStore.getState().setMode('Trade');\n    await new Promise(resolve => setTimeout(resolve, 300)); // Wait for mode switch\n  }\n\n  const { symbol, quantity, orderType, stopLoss, takeProfit } = command;\n  if (!symbol || !quantity) {\n    toast.error('Missing symbol or quantity for trade command');\n    return;\n  }\n\n  // Filter orderType to only 'buy' or 'sell' (API doesn't accept 'limit' or 'market')\n  const validOrderType: 'buy' | 'sell' =\n    orderType === 'buy' || orderType === 'sell' ? orderType : 'buy';\n\n  // Execute REAL Zerodha order via API\n  try {\n    const startTime = Date.now();\n    toast.info(`Placing ${validOrderType} order: ${quantity} ${symbol}...`);\n\n    const { tradeApi } = await import('../../lib/api-client');\n    const result = await tradeApi.placeOrder({\n      symbol: symbol.toUpperCase(),\n      quantity,\n      orderType: validOrderType,\n      stopLoss,\n      takeProfit,\n    });\n\n    const elapsed = Date.now() - startTime;\n\n    if (result.success) {\n      const message = `${validOrderType === 'buy' ? 'BUY' : 'SELL'} order placed: ${quantity}  ${symbol}\\nOrder ID: ${result.orderId}\\nTime: ${elapsed}ms${stopLoss ? `\\nSL: ${stopLoss}` : ''}${takeProfit ? ` | TP: ${takeProfit}` : ''}`;\n      toast.success(message);\n\n      // Emit event for UI update\n      window.dispatchEvent(\n        new CustomEvent('wispr:trade', {\n          detail: {\n            symbol,\n            quantity,\n            orderType: validOrderType,\n            stopLoss,\n            orderId: result.orderId,\n            success: true,\n          },\n        })\n      );\n\n      // Voice confirmation in Hindi/English\n      if ('speechSynthesis' in window) {\n        const lang = useSettingsStore.getState().language || 'en';\n        const utterance = new SpeechSynthesisUtterance(\n          lang === 'hi'\n            ? `${validOrderType === 'buy' ? '' : ''}  ${result.orderId} `\n            : `${validOrderType === 'buy' ? 'Buy' : 'Sell'} order ${result.orderId} placed successfully`\n        );\n        utterance.lang = lang === 'hi' ? 'hi-IN' : 'en-US';\n        speechSynthesis.speak(utterance);\n      }\n    } else {\n      throw new Error('Order placement failed');\n    }\n  } catch (error: any) {\n    console.error('[WISPR] Trade order failed:', error);\n    const errorMsg = error.message || 'Failed to place order. Check Zerodha API keys.';\n    toast.error(`Order failed: ${errorMsg}`);\n\n    // Fallback: Emit event for mock execution (for testing)\n    window.dispatchEvent(\n      new CustomEvent('wispr:trade', {\n        detail: { symbol, quantity, orderType, stopLoss, success: false, error: errorMsg },\n      })\n    );\n  }\n}\n\nasync function executeResearchCommand(command: ParsedWisprCommand) {\n  // Switch to Research mode\n  const currentMode = useAppStore.getState().mode;\n  if (currentMode !== 'Research') {\n    useAppStore.getState().setMode('Research');\n    await new Promise(resolve => setTimeout(resolve, 500));\n  }\n\n  if (!command.query) {\n    toast.error('No research query provided');\n    return;\n  }\n\n  // Trigger research search\n  window.dispatchEvent(\n    new CustomEvent('wispr:research', {\n      detail: { query: command.query },\n    })\n  );\n\n  toast.info(`Researching: ${command.query}`);\n}\n\nasync function executeSearchCommand(command: ParsedWisprCommand) {\n  if (!command.query) return;\n\n  // Use omni-search: search web + tabs + trading data\n  const { normalizeInputToUrlOrSearch } = await import('../../lib/search');\n  const { useSettingsStore } = await import('../../state/settingsStore');\n  const settings = useSettingsStore.getState();\n  const language = settings.language || 'auto';\n  const searchEngine = settings.searchEngine || 'google';\n\n  let searchProvider: 'google' | 'duckduckgo' | 'bing' | 'yahoo' = 'google';\n  if (searchEngine === 'duckduckgo' || searchEngine === 'bing' || searchEngine === 'yahoo') {\n    searchProvider = searchEngine;\n  }\n\n  const targetUrl = normalizeInputToUrlOrSearch(\n    command.query,\n    searchProvider,\n    language !== 'auto' ? language : undefined\n  );\n  await ipc.tabs.create(targetUrl);\n  toast.success(`Searching: ${command.query}`);\n}\n\nasync function executeSummarizeCommand(_command: ParsedWisprCommand) {\n  // Get active tab content and summarize\n  const { useTabsStore } = await import('../../state/tabsStore');\n  const tabsState = useTabsStore.getState();\n  const tabs = tabsState.tabs;\n  const activeTab = tabs.find(t => t.id === tabsState.activeId);\n\n  if (!activeTab?.url || activeTab.url === 'about:blank') {\n    toast.error('No page to summarize');\n    return;\n  }\n\n  // Use AI to summarize\n  const result = await aiEngine.runTask({\n    kind: 'summary',\n    prompt: `Summarize this page in 3 bullet points: ${activeTab.url}`,\n    context: { url: activeTab.url },\n  });\n\n  // Show summary in a toast or overlay\n  toast.success(result.text.substring(0, 200) + '...', { duration: 10000 });\n}\n\nasync function executeExplainCommand(_command: ParsedWisprCommand) {\n  // Get selected text or page content\n  const selectedText = window.getSelection()?.toString();\n\n  if (!selectedText) {\n    toast.error('No code selected. Please select code to explain.');\n    return;\n  }\n\n  const result = await aiEngine.runTask({\n    kind: 'chat',\n    prompt: `Explain this code in simple language:\\n\\n${selectedText}`,\n  });\n\n  toast.success(result.text.substring(0, 300) + '...', { duration: 10000 });\n}\n\nasync function executeFillFormCommand(_command: ParsedWisprCommand) {\n  const { fillAllForms, getUserProfile } = await import('./formFiller');\n\n  const forms = document.querySelectorAll('form');\n  if (forms.length === 0) {\n    toast.error('No forms found on this page');\n    return;\n  }\n\n  const profile = getUserProfile();\n  if (Object.keys(profile).length === 0) {\n    toast.info('No saved profile found. Say \"Save my profile\" to store your information first.');\n    return;\n  }\n\n  const filledCount = fillAllForms(profile);\n\n  if (filledCount > 0) {\n    toast.success(\n      `Filled ${filledCount} form field${filledCount === 1 ? '' : 's'} with saved profile`\n    );\n  } else {\n    toast.info('No matching fields found. Profile data may not match form fields.');\n  }\n}\n\nasync function executeSaveProfileCommand(_command: ParsedWisprCommand) {\n  const { saveUserProfile } = await import('./formFiller');\n\n  // Try to extract profile data from current page forms\n  const forms = document.querySelectorAll('form');\n  if (forms.length === 0) {\n    toast.info('No forms found. Please fill a form first, then say \"Save my profile\" again.');\n    return;\n  }\n\n  // Extract data from the first form\n  const form = forms[0] as HTMLFormElement;\n  const formData = new FormData(form);\n  const profile: Record<string, string> = {};\n\n  // Extract common fields\n  // @ts-ignore - FormData.entries() exists but TypeScript types may be outdated\n  for (const [key, value] of formData.entries()) {\n    if (typeof value === 'string' && value.trim()) {\n      const lowerKey = key.toLowerCase();\n      if (lowerKey.includes('name') && !profile.name) {\n        profile.name = value;\n      } else if (lowerKey.includes('email') && !profile.email) {\n        profile.email = value;\n      } else if ((lowerKey.includes('phone') || lowerKey.includes('mobile')) && !profile.phone) {\n        profile.phone = value;\n      } else if (lowerKey.includes('address') && !profile.address) {\n        profile.address = value;\n      } else if (lowerKey.includes('city') && !profile.city) {\n        profile.city = value;\n      } else if (\n        lowerKey.includes('pincode') ||\n        lowerKey.includes('zip') ||\n        lowerKey.includes('postal')\n      ) {\n        profile.pincode = value;\n      } else if (lowerKey.includes('aadhaar') || lowerKey.includes('aadhar')) {\n        profile.aadhaar = value;\n      } else if (lowerKey.includes('pan')) {\n        profile.pan = value;\n      }\n    }\n  }\n\n  if (Object.keys(profile).length > 0) {\n    saveUserProfile(profile);\n    toast.success(\n      `Profile saved with ${Object.keys(profile).length} field${Object.keys(profile).length === 1 ? '' : 's'}`\n    );\n  } else {\n    toast.info('No profile data found in forms. Please fill a form first.');\n  }\n}\n\nexport async function executeWeatherCommand(command: ParsedWisprCommand) {\n  try {\n    const city = command.query || 'Delhi';\n\n    // Use Tauri invoke if available\n    if (typeof window !== 'undefined' && (window as any).__TAURI__) {\n      const { invoke } = await import('@tauri-apps/api/core');\n      await invoke('get_weather', { city });\n      toast.success(`Weather for ${city} loading...`);\n    } else {\n      // Fallback: HTTP API\n      try {\n        const response = await fetch(`http://127.0.0.1:4000/api/weather/${city}`);\n        if (response.ok) {\n          const data = await response.json();\n          window.dispatchEvent(new CustomEvent('weather-update', { detail: data }));\n        }\n      } catch (error) {\n        console.warn('[WISPR] Weather API fallback failed:', error);\n      }\n    }\n  } catch (error) {\n    console.error('[WISPR] Weather command failed:', error);\n    toast.error('Failed to get weather. Check internet connection.');\n  }\n}\n\nexport async function executeTrainCommand(command: ParsedWisprCommand) {\n  try {\n    // Parse train command: \"Delhi to Mumbai on tomorrow\"\n    const parts = command.query?.split(' to ') || [];\n    const from = parts[0] || 'Delhi';\n    const toParts = parts[1]?.split(' on ') || [];\n    const to = toParts[0] || 'Mumbai';\n    const date = toParts[1] || 'tomorrow';\n\n    if (typeof window !== 'undefined' && (window as any).__TAURI__) {\n      const { invoke } = await import('@tauri-apps/api/core');\n      await invoke('book_train', { from, to, date });\n      toast.success(`Booking train from ${from} to ${to}...`);\n    } else {\n      toast.info(`Train booking: ${from}  ${to} on ${date}`);\n    }\n  } catch (error) {\n    console.error('[WISPR] Train command failed:', error);\n    toast.error('Failed to book train. Please try again.');\n  }\n}\n\nexport async function executeFlightCommand(command: ParsedWisprCommand) {\n  try {\n    // Parse flight command: \"Delhi to Mumbai on tomorrow return 20 December\"\n    const parts = command.query?.split(' to ') || [];\n    const from = parts[0] || 'Delhi';\n    const toParts = parts[1]?.split(' on ') || [];\n    const to = toParts[0] || 'Mumbai';\n    const dateParts = toParts[1]?.split(' return ') || [];\n    const departDate = dateParts[0] || 'tomorrow';\n    const returnDate = dateParts[1] || undefined;\n\n    if (typeof window !== 'undefined' && (window as any).__TAURI__) {\n      const { invoke } = await import('@tauri-apps/api/core');\n      await invoke('book_flight', { from, to, departDate, returnDate });\n      toast.success(`Booking flight: ${from}  ${to}${returnDate ? ' (round-trip)' : ''}...`);\n    } else {\n      toast.info(\n        `Flight booking: ${from}  ${to} on ${departDate}${returnDate ? ` return ${returnDate}` : ''}`\n      );\n    }\n  } catch (error) {\n    console.error('[WISPR] Flight command failed:', error);\n    toast.error('Failed to book flight. Please try again.');\n  }\n}\n\nasync function executeScreenshotCommand(_command: ParsedWisprCommand) {\n  const { captureAndAnalyze } = await import('./screenshotAnalyzer');\n\n  // Extract query from command (e.g., \"Yeh chart ka analysis kar\")\n  const query = _command.query\n    ?.replace(/screenshot|isme kya hai|  |analysis|analyze/gi, '')\n    .trim();\n\n  toast.info('Capturing screenshot...');\n  const analysis = await captureAndAnalyze(query || undefined);\n\n  if (analysis) {\n    // Show analysis in a modal or expanded panel\n    const modal = document.createElement('div');\n    modal.className =\n      'fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm';\n    modal.innerHTML = `\n      <div class=\"bg-slate-900 border border-purple-600 rounded-3xl p-8 max-w-2xl max-h-[80vh] overflow-y-auto shadow-2xl\">\n        <div class=\"flex items-center justify-between mb-4\">\n          <h2 class=\"text-2xl font-bold text-purple-300\">WISPR Screenshot Analysis</h2>\n          <button class=\"text-gray-400 hover:text-white\" onclick=\"this.closest('.fixed').remove()\"></button>\n        </div>\n        <div class=\"text-gray-200 whitespace-pre-wrap\">${analysis}</div>\n        <button \n          class=\"mt-4 px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-white\"\n          onclick=\"this.closest('.fixed').remove()\"\n        >\n          Close\n        </button>\n      </div>\n    `;\n    document.body.appendChild(modal);\n\n    // Close on click outside\n    modal.addEventListener('click', e => {\n      if (e.target === modal) {\n        modal.remove();\n      }\n    });\n\n    // Close on Escape key\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        modal.remove();\n        document.removeEventListener('keydown', handleEscape);\n      }\n    };\n    document.addEventListener('keydown', handleEscape);\n  } else {\n    toast.error('Failed to analyze screenshot');\n  }\n}\n\nasync function executeOpenTabsCommand(command: ParsedWisprCommand) {\n  const tabsCount = command.tabs || 5;\n  const query = command.query || '';\n\n  if (!query) {\n    toast.error('No search query provided');\n    return;\n  }\n\n  // Search and open multiple tabs\n  const { normalizeInputToUrlOrSearch } = await import('../../lib/search');\n  const { useSettingsStore } = await import('../../state/settingsStore');\n  const settings = useSettingsStore.getState();\n  const searchEngine = settings.searchEngine || 'google';\n\n  let searchProvider: 'google' | 'duckduckgo' | 'bing' | 'yahoo' = 'google';\n  if (searchEngine === 'duckduckgo' || searchEngine === 'bing' || searchEngine === 'yahoo') {\n    searchProvider = searchEngine;\n  }\n\n  // Open multiple tabs with search variations\n  for (let i = 0; i < tabsCount; i++) {\n    const searchQuery = `${query} ${i > 0 ? `page ${i + 1}` : ''}`;\n    const targetUrl = normalizeInputToUrlOrSearch(searchQuery, searchProvider);\n    await ipc.tabs.create(targetUrl);\n    await new Promise(resolve => setTimeout(resolve, 200)); // Stagger tab creation\n  }\n\n  toast.success(`Opened ${tabsCount} tabs about: ${query}`);\n}\n\nasync function executeNavigateCommand(command: ParsedWisprCommand) {\n  if (!command.url) return;\n\n  const { normalizeInputToUrlOrSearch } = await import('../../lib/search');\n  const { useSettingsStore } = await import('../../state/settingsStore');\n  const settings = useSettingsStore.getState();\n  const searchEngine = settings.searchEngine || 'google';\n\n  let searchProvider: 'google' | 'duckduckgo' | 'bing' | 'yahoo' = 'google';\n  if (searchEngine === 'duckduckgo' || searchEngine === 'bing' || searchEngine === 'yahoo') {\n    searchProvider = searchEngine;\n  }\n\n  const targetUrl = normalizeInputToUrlOrSearch(command.url, searchProvider);\n  const { useTabsStore } = await import('../../state/tabsStore');\n  const tabsState = useTabsStore.getState();\n  const tabs = tabsState.tabs;\n  const activeTab = tabs.find(t => t.id === tabsState.activeId);\n\n  if (activeTab) {\n    await ipc.tabs.navigate(activeTab.id, targetUrl);\n  } else {\n    await ipc.tabs.create(targetUrl);\n  }\n}\n","import React, { useEffect, useState, useRef } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { Mic, Sparkles, X, Eye, Brain } from 'lucide-react';\r\nimport { useSettingsStore } from '../state/settingsStore';\r\nimport { parseWisprCommand, executeWisprCommand } from '../core/wispr/commandHandler';\r\nimport { toast } from '../utils/toast';\r\nimport { isElectronRuntime } from '../lib/env';\r\n\r\nconst LANGUAGE_LOCALE_MAP: Record<string, string> = {\r\n  hi: 'hi-IN',\r\n  en: 'en-US',\r\n  ta: 'ta-IN',\r\n  te: 'te-IN',\r\n  bn: 'bn-IN',\r\n  mr: 'mr-IN',\r\n  kn: 'kn-IN',\r\n  ml: 'ml-IN',\r\n  gu: 'gu-IN',\r\n  pa: 'pa-IN',\r\n  ur: 'ur-PK',\r\n};\r\n\r\nfunction getSpeechRecognitionLocale(lang?: string): string {\r\n  // Support both Hindi and English simultaneously for best accuracy\r\n  if (!lang || lang === 'auto') return 'hi-IN,en-US';\r\n  return LANGUAGE_LOCALE_MAP[lang] || lang.includes('-') ? lang : `${lang}-${lang.toUpperCase()}`;\r\n}\r\n\r\nexport function WisprOrb() {\r\n  const [listening, setListening] = useState(false);\r\n  const [transcript, setTranscript] = useState('');\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [isJarvisMode, setIsJarvisMode] = useState(false);\r\n  const [visionEnabled, setVisionEnabled] = useState(false);\r\n  const recogRef = useRef<any>(null);\r\n  const language = useSettingsStore(state => state.language || 'auto');\r\n\r\n  const wakeWords = ['hey wispr', 'jarvis', 'regen', 'wake up'];\r\n\r\n  // Initialize Speech Recognition\r\n  useEffect(() => {\r\n    const SR: any = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\r\n    if (!SR) {\r\n      console.warn('[WISPR] Speech Recognition not available');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const recognition = new SR();\r\n      recognition.continuous = false;\r\n      recognition.interimResults = true;\r\n      recognition.lang = getSpeechRecognitionLocale(language);\r\n      recognition.maxAlternatives = 1;\r\n\r\n      recognition.onresult = (event: any) => {\r\n        const results = Array.isArray(event.results) ? Array.from(event.results) : [];\r\n        const latestResult = results[results.length - 1] as any;\r\n        const transcript = latestResult?.[0]?.transcript || '';\r\n\r\n        if (latestResult?.isFinal) {\r\n          // Final result - execute command\r\n          setTranscript(transcript.trim());\r\n          setIsProcessing(true);\r\n          handleCommand(transcript.trim());\r\n        } else {\r\n          // Interim result - show live transcript\r\n          setTranscript(transcript);\r\n        }\r\n      };\r\n\r\n      recognition.onerror = (event: any) => {\r\n        console.error('[WISPR] Speech recognition error:', event.error);\r\n        setListening(false);\r\n        setIsProcessing(false);\r\n        setTranscript('');\r\n\r\n        if (event.error === 'not-allowed') {\r\n          toast.error('Microphone permission denied. Please enable it in browser settings.');\r\n        } else if (event.error === 'no-speech') {\r\n          // Silent timeout - just stop listening\r\n          setListening(false);\r\n        } else {\r\n          toast.error(`Speech recognition error: ${event.error}`);\r\n        }\r\n      };\r\n\r\n      recognition.onend = () => {\r\n        setListening(false);\r\n        setIsProcessing(false);\r\n        setTranscript('');\r\n      };\r\n\r\n      recogRef.current = recognition;\r\n    } catch (error) {\r\n      console.error('[WISPR] Failed to initialize speech recognition:', error);\r\n    }\r\n  }, [language]);\r\n\r\n  const handleCommand = async (text: string) => {\r\n    if (!text.trim()) {\r\n      setListening(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsProcessing(true);\r\n\r\n      // Check for wake words (Jarvis mode)\r\n      const lowerText = text.toLowerCase();\r\n      const hasWakeWord = wakeWords.some(word => lowerText.includes(word));\r\n\r\n      if (hasWakeWord || isJarvisMode) {\r\n        setIsJarvisMode(true);\r\n        setVisionEnabled(true);\r\n\r\n        // Extract command after wake word\r\n        let commandText = text;\r\n        for (const wakeWord of wakeWords) {\r\n          if (lowerText.includes(wakeWord)) {\r\n            commandText = text\r\n              .substring(text.toLowerCase().indexOf(wakeWord) + wakeWord.length)\r\n              .trim();\r\n            break;\r\n          }\r\n        }\r\n\r\n        // Vision: Auto-screenshot + send to llava\r\n        if (isElectronRuntime()) {\r\n          try {\r\n            const { ipc } = await import('../lib/ipc-typed');\r\n\r\n            // Capture screen\r\n            const screenshot = await ipc.vision.captureScreen();\r\n\r\n            // Analyze with vision\r\n            const visionPrompt = `User said: \"${commandText || text}\"\\nDescribe what you see on screen and suggest the best action.`;\r\n            const visionResponse = await ipc.vision.analyze(visionPrompt, screenshot);\r\n\r\n            // Speak response\r\n            if ('speechSynthesis' in window) {\r\n              const speech = new SpeechSynthesisUtterance(visionResponse || 'Command processed');\r\n              speech.lang = 'en-IN'; // Indian English\r\n              speech.rate = 1.0;\r\n              speech.pitch = 1.0;\r\n              window.speechSynthesis.speak(speech);\r\n\r\n              // Show vision response in transcript\r\n              setTranscript(\r\n                `Jarvis: ${visionResponse.substring(0, 100)}${visionResponse.length > 100 ? '...' : ''}`\r\n              );\r\n            }\r\n          } catch (error) {\r\n            console.warn('[WISPR] Vision processing failed:', error);\r\n            toast.warning('Vision analysis unavailable. Using text-only mode.');\r\n          }\r\n        }\r\n\r\n        // Action: Execute command\r\n        const command = parseWisprCommand(commandText || text);\r\n        const commandType =\r\n          command.type.charAt(0).toUpperCase() + command.type.slice(1).replace('_', ' ');\r\n        setTranscript(`Jarvis: Executing ${commandType}...`);\r\n\r\n        await executeWisprCommand(command);\r\n\r\n        setTranscript(` Jarvis: ${commandType} completed`);\r\n      } else {\r\n        // Normal command execution\r\n        const command = parseWisprCommand(text);\r\n        const commandType =\r\n          command.type.charAt(0).toUpperCase() + command.type.slice(1).replace('_', ' ');\r\n        setTranscript(`Executing ${commandType}...`);\r\n\r\n        await executeWisprCommand(command);\r\n\r\n        setTranscript(` ${commandType} completed`);\r\n      }\r\n\r\n      setTimeout(() => {\r\n        setTranscript('');\r\n      }, 2000);\r\n    } catch (error) {\r\n      console.error('[WISPR] Command execution error:', error);\r\n      setTranscript(' Command failed');\r\n      toast.error('Failed to execute command');\r\n      setTimeout(() => {\r\n        setTranscript('');\r\n      }, 2000);\r\n    } finally {\r\n      setIsProcessing(false);\r\n      setListening(false);\r\n      setTimeout(() => {\r\n        setTranscript('');\r\n      }, 3000);\r\n    }\r\n  };\r\n\r\n  const startListening = () => {\r\n    const SR: any = recogRef.current;\r\n    if (!SR) {\r\n      toast.error('Speech recognition not available. Please use Chrome or Edge.');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setListening(true);\r\n      setTranscript('');\r\n      setIsProcessing(false);\r\n      SR.start();\r\n      toast.info('WISPR listening... Speak now');\r\n    } catch (error: any) {\r\n      console.error('[WISPR] Failed to start recognition:', error);\r\n      setListening(false);\r\n      if (error.message?.includes('already started')) {\r\n        // Recognition already running, stop and restart\r\n        SR.stop();\r\n        setTimeout(() => {\r\n          SR.start();\r\n          setListening(true);\r\n        }, 100);\r\n      } else {\r\n        toast.error('Failed to start voice recognition');\r\n      }\r\n    }\r\n  };\r\n\r\n  const stopListening = () => {\r\n    const SR: any = recogRef.current;\r\n    if (SR) {\r\n      try {\r\n        SR.stop();\r\n      } catch (error) {\r\n        console.error('[WISPR] Error stopping recognition:', error);\r\n      }\r\n    }\r\n    setListening(false);\r\n    setIsProcessing(false);\r\n    setTranscript('');\r\n  };\r\n\r\n  // Global hotkey: Ctrl + Space\r\n  // Listen for global hotkey events from Tauri\r\n  useEffect(() => {\r\n    if (isElectronRuntime()) {\r\n      const setupGlobalHotkeys = async () => {\r\n        try {\r\n          const { ipcEvents } = await import('../lib/ipc-events');\r\n\r\n          // Listen for wake-wispr event (Ctrl+Shift+Space)\r\n          ipcEvents.on('wake-wispr', () => {\r\n            if (!listening) {\r\n              startListening();\r\n              setIsJarvisMode(true);\r\n              toast.info('Jarvis mode activated!');\r\n            }\r\n          });\r\n\r\n          // Listen for open-trade-mode event (Ctrl+Shift+T)\r\n          ipcEvents.on('open-trade-mode', async () => {\r\n            const { useAppStore } = await import('../state/appStore');\r\n            useAppStore.getState().setMode('Trade');\r\n            toast.info('Trade mode opened');\r\n          });\r\n        } catch (error) {\r\n          console.warn('[WISPR] Global hotkey setup failed:', error);\r\n        }\r\n      };\r\n\r\n      setupGlobalHotkeys();\r\n    }\r\n  }, [listening]);\r\n\r\n  // Global hotkey: Ctrl + Space (works everywhere)\r\n  useEffect(() => {\r\n    const handleKey = (event: KeyboardEvent) => {\r\n      if (event.ctrlKey && event.code === 'Space' && !event.shiftKey) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        if (listening) {\r\n          stopListening();\r\n        } else {\r\n          startListening();\r\n          setIsJarvisMode(true);\r\n        }\r\n      }\r\n      \r\n      // Cancel with \"Band kar\" / \"Stop\" - also listen for these keys\r\n      if (listening && (event.key === 'Escape' || (event.ctrlKey && event.key === 'c'))) {\r\n        event.preventDefault();\r\n        stopListening();\r\n        toast.info('WISPR stopped');\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKey, true); // Use capture phase\r\n    return () => window.removeEventListener('keydown', handleKey, true);\r\n  }, [listening]);\r\n\r\n  return (\r\n    <>\r\n      {/* Floating Orb */}\r\n      <motion.div\r\n        drag\r\n        dragMomentum={false}\r\n        className=\"fixed bottom-24 right-8 z-50 cursor-move\"\r\n        whileHover={{ scale: 1.05 }}\r\n        whileTap={{ scale: 0.95 }}\r\n      >\r\n        <button\r\n          onClick={() => (listening ? stopListening() : startListening())}\r\n          className=\"relative\"\r\n          aria-label=\"WISPR Voice Assistant\"\r\n        >\r\n          <div\r\n            className={`w-20 h-20 rounded-full bg-gradient-to-r from-purple-600 to-pink-600 shadow-2xl flex items-center justify-center transition-all ${\r\n              listening ? 'animate-pulse scale-110 ring-4 ring-purple-500/50' : 'hover:scale-105'\r\n            } ${isJarvisMode ? 'ring-4 ring-blue-500' : ''}`}\r\n          >\r\n            {listening ? (\r\n              <Mic className=\"w-10 h-10 text-white animate-bounce\" />\r\n            ) : isJarvisMode ? (\r\n              <Brain className=\"w-10 h-10 text-white\" />\r\n            ) : (\r\n              <Sparkles className=\"w-10 h-10 text-white\" />\r\n            )}\r\n          </div>\r\n          {visionEnabled && (\r\n            <div className=\"absolute -bottom-2 -right-2 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center\">\r\n              <Eye className=\"w-3 h-3 text-white\" />\r\n            </div>\r\n          )}\r\n        </button>\r\n        <div className=\"absolute -top-10 left-1/2 -translate-x-1/2 bg-black/80 backdrop-blur px-4 py-2 rounded-full text-sm whitespace-nowrap pointer-events-none\">\r\n          {isJarvisMode ? 'Jarvis Mode' : 'Ctrl + Space to talk'}\r\n        </div>\r\n      </motion.div>\r\n\r\n      {/* Voice Panel (when active) */}\r\n      {listening && (\r\n        <motion.div\r\n          initial={{ opacity: 0, y: 100 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          exit={{ opacity: 0, y: 100 }}\r\n          className=\"fixed bottom-48 right-8 bg-black/90 backdrop-blur-xl border border-purple-600 rounded-3xl p-8 shadow-2xl max-w-md z-50\"\r\n        >\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"w-4 h-4 bg-red-500 rounded-full animate-pulse\" />\r\n              <p className=\"text-2xl font-bold text-purple-300\">\r\n                {isProcessing ? 'Processing...' : 'WISPR Listening...'}\r\n              </p>\r\n            </div>\r\n            <button\r\n              onClick={stopListening}\r\n              className=\"text-gray-400 hover:text-white transition-colors\"\r\n              aria-label=\"Stop listening\"\r\n            >\r\n              <X className=\"w-5 h-5\" />\r\n            </button>\r\n          </div>\r\n\r\n          {transcript && (\r\n            <div className=\"mt-4 p-4 bg-purple-900/20 rounded-xl border border-purple-500/30\">\r\n              <p className=\"text-sm text-gray-300 mb-2\">You said:</p>\r\n              <p className=\"text-white font-medium text-lg\">{transcript}</p>\r\n            </div>\r\n          )}\r\n\r\n          <p className=\"mt-4 text-gray-400 text-sm\">\r\n            {isProcessing\r\n              ? 'Executing your command...'\r\n              : 'Say in Hindi or English:\\n\"  50\" or \"Buy 50 Nifty\"\\n\"Research Tesla\" or \"Screenshot le\"'}\r\n          </p>\r\n          \r\n          <button\r\n            onClick={stopListening}\r\n            className=\"mt-4 w-full bg-red-600/20 hover:bg-red-600/30 border border-red-500/50 rounded-lg px-4 py-2 text-red-300 text-sm font-medium transition-colors\"\r\n          >\r\n            Band kar / Stop (Esc)\r\n          </button>\r\n        </motion.div>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default WisprOrb;\r\n","/**\n * UnifiedSidePanel - Combined History, Bookmarks, and Downloads panel\n * Based on Figma UI/UX Prototype Flow redesign\n */\n\nimport { useState, useEffect } from 'react';\nimport { Clock, Star, Download, X, Search, FolderOpen, ChevronRight } from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\n// Use existing BookmarksPanel from bookmarks folder (has folders support)\nimport { BookmarksPanel } from '../bookmarks/BookmarksPanel';\nimport { WorkspacesPanel } from '../WorkspacesPanel';\nimport HistoryPage from '../../routes/History';\nimport DownloadsPage from '../../routes/Downloads';\n\nexport interface UnifiedSidePanelProps {\n  open: boolean;\n  onClose: () => void;\n  defaultTab?: 'history' | 'bookmarks' | 'workspaces' | 'downloads';\n  width?: number;\n}\n\ntype TabType = 'history' | 'bookmarks' | 'workspaces' | 'downloads';\n\nconst tabs: Array<{ id: TabType; label: string; icon: React.ReactNode }> = [\n  { id: 'history', label: 'History', icon: <Clock size={16} /> },\n  { id: 'bookmarks', label: 'Bookmarks', icon: <Star size={16} /> },\n  { id: 'workspaces', label: 'Workspaces', icon: <FolderOpen size={16} /> },\n  { id: 'downloads', label: 'Downloads', icon: <Download size={16} /> },\n];\n\nexport function UnifiedSidePanel({\n  open,\n  onClose,\n  defaultTab = 'history',\n  width = 420,\n}: UnifiedSidePanelProps) {\n  const [activeTab, setActiveTab] = useState<TabType>(defaultTab);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [collapsed, setCollapsed] = useState(false);\n  const [isMobile, setIsMobile] = useState(false);\n\n  useEffect(() => {\n    const checkMobile = () => {\n      setIsMobile(window.innerWidth < 768);\n      if (window.innerWidth < 768) {\n        setCollapsed(false); // Full width on mobile\n      }\n    };\n    checkMobile();\n    window.addEventListener('resize', checkMobile);\n    return () => window.removeEventListener('resize', checkMobile);\n  }, []);\n\n  if (!open) return null;\n\n  const panelWidth = collapsed ? 64 : isMobile ? '100%' : width;\n\n  return (\n    <AnimatePresence>\n      {open && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={onClose}\n            className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-40\"\n            aria-hidden=\"true\"\n          />\n\n          {/* Panel */}\n          <motion.div\n            initial={{ x: '100%' }}\n            animate={{ x: 0 }}\n            exit={{ x: '100%' }}\n            transition={{\n              type: 'spring',\n              damping: 25,\n              stiffness: 200,\n            }}\n            className={`fixed right-0 top-0 bottom-0 z-50 bg-[#1A1D28] border-l border-gray-800/60 flex flex-col shadow-2xl transition-all duration-300 ${\n              isMobile ? 'w-full' : ''\n            }`}\n            style={{ width: typeof panelWidth === 'string' ? panelWidth : `${panelWidth}px` }}\n            role=\"dialog\"\n            aria-modal=\"true\"\n            aria-label=\"Side panel\"\n          >\n            {/* Header */}\n            <div className=\"flex items-center justify-between border-b border-gray-800/60 px-4 py-3\">\n              {!collapsed && (\n                <div className=\"flex items-center gap-2\">\n                  <h2 className=\"text-lg font-semibold text-gray-100\">Library</h2>\n                </div>\n              )}\n              <div className=\"flex items-center gap-2 ml-auto\">\n                {!isMobile && (\n                  <button\n                    onClick={() => setCollapsed(!collapsed)}\n                    className=\"p-1.5 rounded-lg text-gray-400 hover:text-gray-100 hover:bg-gray-800/60 transition-colors\"\n                    title={collapsed ? 'Expand' : 'Collapse'}\n                  >\n                    <ChevronRight\n                      size={18}\n                      className={`transition-transform ${collapsed ? 'rotate-180' : ''}`}\n                    />\n                  </button>\n                )}\n                <button\n                  onClick={e => {\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                    onClose();\n                  }}\n                  onMouseDown={e => {\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                  }}\n                  className=\"p-1.5 rounded-lg text-gray-400 hover:text-gray-100 hover:bg-gray-800/60 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500/40\"\n                  style={{ zIndex: 10011, isolation: 'isolate' }}\n                  aria-label=\"Close panel\"\n                >\n                  <X size={18} />\n                </button>\n              </div>\n            </div>\n\n            {/* Tabs */}\n            {!collapsed && (\n              <div className=\"flex items-center border-b border-gray-800/60 px-4 bg-gray-900/30\">\n                {tabs\n                  .filter(tab => tab && tab.id)\n                  .map(tab => (\n                    <button\n                      key={tab.id}\n                      onClick={e => {\n                        (e as any).stopImmediatePropagation();\n                        e.stopPropagation();\n                        if (tab) setActiveTab(tab.id);\n                      }}\n                      onMouseDown={e => {\n                        (e as any).stopImmediatePropagation();\n                        e.stopPropagation();\n                      }}\n                      className={`\n                    relative flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors\n                    ${activeTab === tab.id ? 'text-blue-400' : 'text-gray-400 hover:text-gray-200'}\n                  `}\n                      style={{ zIndex: 10011, isolation: 'isolate' }}\n                      aria-selected={activeTab === tab.id}\n                      role=\"tab\"\n                    >\n                      {tab.icon}\n                      <span>{tab.label}</span>\n                      {activeTab === tab.id && (\n                        <motion.div\n                          layoutId=\"activeTab\"\n                          className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-400\"\n                          initial={false}\n                        />\n                      )}\n                    </button>\n                  ))}\n              </div>\n            )}\n\n            {/* Search Bar (optional, can be shown based on active tab) */}\n            {!collapsed &&\n              (activeTab === 'history' ||\n                activeTab === 'bookmarks' ||\n                activeTab === 'workspaces') && (\n                <div className=\"px-4 py-3 border-b border-gray-800/60\">\n                  <div className=\"relative\">\n                    <Search\n                      size={16}\n                      className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\"\n                    />\n                    <input\n                      type=\"text\"\n                      value={searchQuery}\n                      onChange={e => setSearchQuery(e.target.value)}\n                      placeholder={`Search ${activeTab}...`}\n                      className=\"w-full pl-9 pr-3 py-2 bg-gray-900/60 border border-gray-700/50 rounded-lg text-sm text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40 focus:border-blue-500/40\"\n                    />\n                  </div>\n                </div>\n              )}\n\n            {/* Content */}\n            {!collapsed && (\n              <div className=\"flex-1 overflow-hidden\">\n                <AnimatePresence mode=\"wait\">\n                  <motion.div\n                    key={activeTab}\n                    initial={{ opacity: 0, x: 20 }}\n                    animate={{ opacity: 1, x: 0 }}\n                    exit={{ opacity: 0, x: -20 }}\n                    transition={{ duration: 0.2 }}\n                    className=\"h-full overflow-y-auto\"\n                  >\n                    {activeTab === 'history' && (\n                      <div className=\"h-full\">\n                        <HistoryPage />\n                      </div>\n                    )}\n                    {activeTab === 'bookmarks' && (\n                      <div className=\"h-full\">\n                        <BookmarksPanel />\n                      </div>\n                    )}\n                    {activeTab === 'workspaces' && (\n                      <div className=\"h-full\">\n                        <WorkspacesPanel />\n                      </div>\n                    )}\n                    {activeTab === 'downloads' && (\n                      <div className=\"h-full\">\n                        <DownloadsPage />\n                      </div>\n                    )}\n                  </motion.div>\n                </AnimatePresence>\n              </div>\n            )}\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n}\n","/**\n * useSystemStatus Hook\n * Hook for fetching system status with auto-refresh\n */\n\nimport { useState, useEffect } from 'react';\nimport { ipc } from '../lib/ipc-typed';\nimport { isElectronRuntime, isTauriRuntime } from '../lib/env';\n\nexport interface SystemStatus {\n  redisConnected: boolean;\n  redixAvailable: boolean;\n  workerState: 'running' | 'stopped' | 'error';\n  vpn: {\n    connected: boolean;\n    profile?: string;\n    type?: string;\n  };\n  tor: {\n    running: boolean;\n    bootstrapped: boolean;\n  };\n  mode: string;\n  uptime: number;\n  memoryUsage: {\n    heapUsed: number;\n    heapTotal: number;\n    external: number;\n    rss: number;\n  };\n}\n\nexport function useSystemStatus() {\n  const [status, setStatus] = useState<SystemStatus | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<Error | null>(null);\n\n  const fetchStatus = async () => {\n    try {\n      setIsLoading(true);\n      const data = await ipc.system.getStatus();\n      setStatus(data);\n      setError(null);\n    } catch (err) {\n      setError(err instanceof Error ? err : new Error('Failed to fetch system status'));\n      console.error('[useSystemStatus] Failed to fetch status:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    // Skip backend status checks in web mode - backend is optional\n    const isWebMode = !isElectronRuntime() && !isTauriRuntime();\n    if (isWebMode) {\n      setIsLoading(false);\n      return;\n    }\n\n    // Fetch immediately\n    fetchStatus();\n\n    // Then refresh every 5 seconds\n    const interval = setInterval(fetchStatus, 5000);\n\n    return () => clearInterval(interval);\n  }, []);\n\n  return {\n    data: status,\n    isLoading,\n    error,\n    refetch: fetchStatus,\n  };\n}\n","/**\n * Global Command Bar - Tier 3\n * Spotlight-style command palette (K / Ctrl+K)\n */\n\nimport { useState, useEffect, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Search,\n  Sparkles,\n  FileText,\n  Settings,\n  BookOpen,\n  FolderOpen,\n  ArrowRight,\n  Activity,\n} from 'lucide-react';\nimport { useAppStore } from '../../state/appStore';\nimport { useTabsStore } from '../../state/tabsStore';\nimport { useBookmarksStore } from '../../state/bookmarksStore';\nimport { ipc } from '../../lib/ipc-typed';\nimport { track } from '../../services/analytics';\nimport { useSystemStatus } from '../../hooks/useSystemStatus';\n\ntype CommandItem = {\n  id: string;\n  label: string;\n  description?: string;\n  icon: React.ComponentType<any>;\n  keywords: string[];\n  action: () => void | Promise<void>;\n  category: 'modes' | 'actions' | 'navigation' | 'settings';\n};\n\nexport function CommandBar() {\n  const [open, setOpen] = useState(false);\n  const [query, setQuery] = useState('');\n  const [selectedIndex, setSelectedIndex] = useState(0);\n\n  const setMode = useAppStore(state => state.setMode);\n  const bookmarks = useBookmarksStore(state => state.bookmarks);\n  const { data: systemStatus } = useSystemStatus();\n\n  // Build command list\n  const commands = useMemo<CommandItem[]>(() => {\n    const items: CommandItem[] = [\n      // Modes\n      {\n        id: 'mode-research',\n        label: 'Switch to Research Mode',\n        description: 'AI-powered research and analysis',\n        icon: Search,\n        keywords: ['research', 'mode', 'switch'],\n        category: 'modes',\n        action: () => setMode('Research'),\n      },\n      // Actions\n      {\n        id: 'new-tab',\n        label: 'New Tab',\n        description: 'Open a new tab',\n        icon: FileText,\n        keywords: ['new', 'tab', 'open'],\n        category: 'actions',\n        action: async () => {\n          const newTab = await ipc.tabs.create('about:blank');\n          if (newTab) {\n            const tabId =\n              typeof newTab === 'object' && 'id' in newTab\n                ? newTab.id\n                : typeof newTab === 'string'\n                  ? newTab\n                  : null;\n            if (tabId && typeof tabId === 'string') {\n              useTabsStore.getState().setActive(tabId);\n            }\n          }\n        },\n      },\n      {\n        id: 'open-omniagent',\n        label: 'Open OmniAgent',\n        description: 'Ask OmniAgent a question',\n        icon: Sparkles,\n        keywords: ['agent', 'omniagent', 'ai', 'ask'],\n        category: 'actions',\n        action: async () => {\n          await setMode('Research');\n          // Focus on OmniAgent input\n          const event = new CustomEvent('omniagent:focus');\n          window.dispatchEvent(event);\n        },\n      },\n      // Navigation\n      {\n        id: 'open-settings',\n        label: 'Open Settings',\n        description: 'Configure Regen',\n        icon: Settings,\n        keywords: ['settings', 'preferences', 'config'],\n        category: 'navigation',\n        action: () => {\n          window.location.href = '/settings';\n        },\n      },\n      {\n        id: 'open-bookmarks',\n        label: 'Open Bookmarks',\n        description: 'View saved bookmarks',\n        icon: BookOpen,\n        keywords: ['bookmarks', 'saved', 'favorites'],\n        category: 'navigation',\n        action: () => {\n          const event = new CustomEvent('sidepanel:open', { detail: { tab: 'bookmarks' } });\n          window.dispatchEvent(event);\n        },\n      },\n      {\n        id: 'open-workspaces',\n        label: 'Open Workspaces',\n        description: 'View saved workspaces',\n        icon: FolderOpen,\n        keywords: ['workspaces', 'sessions', 'saved'],\n        category: 'navigation',\n        action: () => {\n          const event = new CustomEvent('sidepanel:open', { detail: { tab: 'workspaces' } });\n          window.dispatchEvent(event);\n        },\n      },\n      {\n        id: 'system-status',\n        label: 'System Status',\n        description: 'View system health and service status',\n        icon: Activity,\n        keywords: ['system', 'status', 'health', 'redis', 'redix', 'worker'],\n        category: 'settings',\n        action: () => {\n          // Trigger system status panel to open\n          const event = new CustomEvent('system-status:open');\n          window.dispatchEvent(event);\n        },\n      },\n    ];\n\n    // Add bookmarks as commands\n    bookmarks.slice(0, 5).forEach(bookmark => {\n      items.push({\n        id: `bookmark-${bookmark.id}`,\n        label: bookmark.title,\n        description: bookmark.url,\n        icon: BookOpen,\n        keywords: [bookmark.title, bookmark.url, 'bookmark'],\n        category: 'navigation',\n        action: async () => {\n          const newTab = await ipc.tabs.create(bookmark.url);\n          if (newTab) {\n            const tabId =\n              typeof newTab === 'object' && 'id' in newTab\n                ? newTab.id\n                : typeof newTab === 'string'\n                  ? newTab\n                  : null;\n            if (tabId && typeof tabId === 'string') {\n              useTabsStore.getState().setActive(tabId);\n            }\n          }\n        },\n      });\n    });\n\n    return items;\n  }, [bookmarks, setMode, systemStatus]);\n\n  // Filter commands based on query\n  const filteredCommands = useMemo(() => {\n    if (!query.trim()) return commands;\n    const lowerQuery = query.toLowerCase();\n    return commands.filter(\n      cmd =>\n        cmd.label.toLowerCase().includes(lowerQuery) ||\n        cmd.description?.toLowerCase().includes(lowerQuery) ||\n        cmd.keywords.some(kw => kw.toLowerCase().includes(lowerQuery))\n    );\n  }, [commands, query]);\n\n  // Keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // K or Ctrl+K\n      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {\n        e.preventDefault();\n        setOpen(prev => !prev);\n        track('command_bar_opened');\n      }\n\n      if (open) {\n        if (e.key === 'Escape') {\n          setOpen(false);\n        } else if (e.key === 'ArrowDown') {\n          e.preventDefault();\n          setSelectedIndex(prev => Math.min(prev + 1, filteredCommands.length - 1));\n        } else if (e.key === 'ArrowUp') {\n          e.preventDefault();\n          setSelectedIndex(prev => Math.max(prev - 1, 0));\n        } else if (e.key === 'Enter') {\n          e.preventDefault();\n          const command = filteredCommands[selectedIndex];\n          if (command) {\n            command.action();\n            setOpen(false);\n            setQuery('');\n            track('command_bar_executed', { command: command.id });\n          }\n        }\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [open, filteredCommands, selectedIndex]);\n\n  // Reset selected index when query changes\n  useEffect(() => {\n    setSelectedIndex(0);\n  }, [query]);\n\n  const handleCommandClick = (command: CommandItem) => {\n    command.action();\n    setOpen(false);\n    setQuery('');\n    track('command_bar_executed', { command: command.id });\n  };\n\n  // Group commands by category\n  const groupedCommands = useMemo(() => {\n    const groups: Record<string, CommandItem[]> = {};\n    filteredCommands.forEach(cmd => {\n      if (!groups[cmd.category]) groups[cmd.category] = [];\n      groups[cmd.category].push(cmd);\n    });\n    return groups;\n  }, [filteredCommands]);\n\n  const categoryLabels: Record<string, string> = {\n    modes: 'Modes',\n    actions: 'Actions',\n    navigation: 'Navigation',\n    settings: 'Settings',\n  };\n\n  return (\n    <AnimatePresence>\n      {open && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={() => setOpen(false)}\n            className=\"fixed inset-0 z-[1080] bg-black/60 backdrop-blur-sm\"\n          />\n\n          {/* Command bar */}\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: -20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: -20 }}\n            className=\"fixed left-1/2 top-1/2 z-[1080] mx-4 w-full max-w-2xl -translate-x-1/2 -translate-y-1/2 rounded-2xl border border-slate-700 bg-slate-900 shadow-2xl\"\n          >\n            {/* Search input */}\n            <div className=\"flex items-center gap-3 border-b border-slate-800 p-4\">\n              <Search size={20} className=\"text-slate-400\" />\n              <input\n                id=\"command-bar-search\"\n                name=\"command-bar-query\"\n                type=\"text\"\n                value={query}\n                onChange={e => setQuery(e.target.value)}\n                placeholder=\"Type a command or search...\"\n                className=\"flex-1 bg-transparent text-lg text-white placeholder-slate-500 focus:outline-none\"\n                autoFocus\n              />\n              <div className=\"flex items-center gap-2 text-xs text-slate-500\">\n                <kbd className=\"rounded border border-slate-700 bg-slate-800 px-2 py-1\">\n                  {navigator.platform.includes('Mac') ? '' : 'Ctrl'}\n                </kbd>\n                <span>+</span>\n                <kbd className=\"rounded border border-slate-700 bg-slate-800 px-2 py-1\">K</kbd>\n              </div>\n            </div>\n\n            {/* Results */}\n            <div className=\"max-h-96 overflow-y-auto p-2\">\n              {filteredCommands.length === 0 ? (\n                <div className=\"p-8 text-center text-slate-400\">\n                  <p>No commands found</p>\n                  <p className=\"mt-2 text-sm\">Try a different search term</p>\n                </div>\n              ) : (\n                Object.entries(groupedCommands).map(([category, items]) => (\n                  <div key={category} className=\"mb-4\">\n                    <div className=\"px-3 py-2 text-xs font-semibold uppercase tracking-wide text-slate-500\">\n                      {categoryLabels[category] || category}\n                    </div>\n                    {items.map((cmd, _idx) => {\n                      const globalIndex = filteredCommands.indexOf(cmd);\n                      const isSelected = globalIndex === selectedIndex;\n                      return (\n                        <button\n                          key={cmd.id}\n                          onClick={() => handleCommandClick(cmd)}\n                          onMouseEnter={() => setSelectedIndex(globalIndex)}\n                          className={`flex w-full items-center gap-3 rounded-lg px-3 py-2 transition-colors ${\n                            isSelected\n                              ? 'border border-purple-500/40 bg-gradient-to-r from-purple-500/20 to-cyan-500/20'\n                              : 'hover:bg-slate-800'\n                          }`}\n                        >\n                          <cmd.icon\n                            size={18}\n                            className={isSelected ? 'text-purple-300' : 'text-slate-400'}\n                          />\n                          <div className=\"flex-1 text-left\">\n                            <div\n                              className={`font-medium ${isSelected ? 'text-white' : 'text-slate-200'}`}\n                            >\n                              {cmd.label}\n                            </div>\n                            {cmd.description && (\n                              <div className=\"mt-0.5 text-xs text-slate-500\">{cmd.description}</div>\n                            )}\n                          </div>\n                          {isSelected && <ArrowRight size={16} className=\"text-purple-300\" />}\n                        </button>\n                      );\n                    })}\n                  </div>\n                ))\n              )}\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n}\n","/**\n * AI Omni Mode Switcher - Hero Feature\n * One button  browser becomes an AI operating system\n */\n\nimport { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Search,\n  Code,\n  BookOpen,\n  FileText,\n  Languages,\n  Image as ImageIcon,\n  Sparkles,\n  X,\n} from 'lucide-react';\nimport { useAppStore } from '../../state/appStore';\n\nexport type OmniMode = 'search' | 'code' | 'research' | 'writing' | 'translate' | 'image';\n\ninterface ModeConfig {\n  id: OmniMode;\n  name: string;\n  icon: React.ComponentType<{ className?: string }>;\n  description: string;\n  color: string;\n}\n\nconst OMNI_MODES: ModeConfig[] = [\n  {\n    id: 'search',\n    name: 'AI Search',\n    icon: Search,\n    description: 'Intelligent search with AI-powered results',\n    color: 'from-blue-500 to-cyan-500',\n  },\n  {\n    id: 'code',\n    name: 'AI Code',\n    icon: Code,\n    description: 'Code generation, debugging, and explanation',\n    color: 'from-purple-500 to-pink-500',\n  },\n  {\n    id: 'research',\n    name: 'AI Research',\n    icon: BookOpen,\n    description: 'Deep research with multi-source aggregation',\n    color: 'from-emerald-500 to-teal-500',\n  },\n  {\n    id: 'writing',\n    name: 'AI Writing',\n    icon: FileText,\n    description: 'Content creation, editing, and enhancement',\n    color: 'from-orange-500 to-red-500',\n  },\n  {\n    id: 'translate',\n    name: 'AI Translate',\n    icon: Languages,\n    description: 'Real-time translation in 100+ languages',\n    color: 'from-indigo-500 to-purple-500',\n  },\n  {\n    id: 'image',\n    name: 'AI Image',\n    icon: ImageIcon,\n    description: 'Image generation, analysis, and editing',\n    color: 'from-pink-500 to-rose-500',\n  },\n];\n\nexport function OmniModeSwitcher() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [_selectedMode, setSelectedMode] = useState<OmniMode | null>(null);\n  const { setMode } = useAppStore();\n\n  const handleModeSelect = (mode: OmniMode) => {\n    setSelectedMode(mode);\n\n    // Map Omni modes to app modes\n    const modeMap: Record<OmniMode, 'Browse' | 'Research' | 'Docs' | 'Images'> = {\n      search: 'Browse',\n      code: 'Browse',\n      research: 'Research',\n      writing: 'Docs',\n      translate: 'Browse',\n      image: 'Images',\n    };\n\n    setMode(modeMap[mode]);\n\n    // Close after selection\n    setTimeout(() => setIsOpen(false), 300);\n  };\n\n  return (\n    <>\n      {/* Omni Mode Button */}\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-2 font-semibold transition-all hover:scale-105\"\n      >\n        <Sparkles className=\"w-5 h-5\" />\n        <span>AI Omni Mode</span>\n      </button>\n\n      {/* Mode Selection Modal */}\n      <AnimatePresence>\n        {isOpen && (\n          <>\n            {/* Backdrop */}\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              onClick={() => setIsOpen(false)}\n              className=\"fixed inset-0 bg-black/80 backdrop-blur-sm z-[60]\"\n            />\n\n            {/* Modal */}\n            <motion.div\n              initial={{ opacity: 0, scale: 0.9, y: 20 }}\n              animate={{ opacity: 1, scale: 1, y: 0 }}\n              exit={{ opacity: 0, scale: 0.9, y: 20 }}\n              className=\"fixed inset-0 z-[70] flex items-center justify-center p-4\"\n            >\n              <div className=\"bg-slate-900 border border-purple-500/50 rounded-3xl p-8 max-w-4xl w-full shadow-2xl\">\n                {/* Header */}\n                <div className=\"flex items-center justify-between mb-6\">\n                  <div>\n                    <h2 className=\"text-3xl font-bold text-white flex items-center gap-3\">\n                      <Sparkles className=\"w-8 h-8 text-purple-400\" />\n                      AI Omni Mode\n                    </h2>\n                    <p className=\"text-gray-400 mt-2\">\n                      Transform your browser into an AI operating system\n                    </p>\n                  </div>\n                  <button\n                    onClick={() => setIsOpen(false)}\n                    className=\"text-gray-400 hover:text-white transition-colors\"\n                  >\n                    <X className=\"w-6 h-6\" />\n                  </button>\n                </div>\n\n                {/* Mode Grid */}\n                <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\n                  {OMNI_MODES.map(mode => {\n                    const Icon = mode.icon;\n                    return (\n                      <motion.button\n                        key={mode.id}\n                        onClick={() => handleModeSelect(mode.id)}\n                        whileHover={{ scale: 1.05 }}\n                        whileTap={{ scale: 0.95 }}\n                        className={`bg-gradient-to-br ${mode.color} p-6 rounded-2xl text-left hover:shadow-xl transition-all group`}\n                      >\n                        <Icon className=\"w-8 h-8 text-white mb-3 group-hover:scale-110 transition-transform\" />\n                        <h3 className=\"text-xl font-bold text-white mb-1\">{mode.name}</h3>\n                        <p className=\"text-white/80 text-sm\">{mode.description}</p>\n                      </motion.button>\n                    );\n                  })}\n                </div>\n\n                {/* Footer */}\n                <div className=\"mt-6 text-center text-gray-400 text-sm\">\n                  Press <kbd className=\"px-2 py-1 bg-slate-800 rounded\">Esc</kbd> to close\n                </div>\n              </div>\n            </motion.div>\n          </>\n        )}\n      </AnimatePresence>\n\n      {/* Keyboard shortcut */}\n      {typeof window !== 'undefined' && (\n        <OmniModeKeyboardHandler onToggle={() => setIsOpen(!isOpen)} />\n      )}\n    </>\n  );\n}\n\nfunction OmniModeKeyboardHandler({ onToggle }: { onToggle: () => void }) {\n  if (typeof window === 'undefined') return null;\n\n  useEffect(() => {\n    const handleKey = (e: KeyboardEvent) => {\n      // Ctrl+Shift+O for Omni Mode\n      if (e.ctrlKey && e.shiftKey && e.key === 'O') {\n        e.preventDefault();\n        onToggle();\n      }\n      // Esc to close\n      if (e.key === 'Escape') {\n        onToggle();\n      }\n    };\n\n    window.addEventListener('keydown', handleKey);\n    return () => window.removeEventListener('keydown', handleKey);\n  }, [onToggle]);\n\n  return null;\n}\n","/**\r\n * Command Palette (Cmd+K / Ctrl+K)\r\n * SigmaOS/Arc-style command bar for quick actions\r\n */\r\n\r\nimport React, { useEffect, useState, useRef } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Search, Sparkles, TrendingUp, Globe, FileText, X } from 'lucide-react';\r\nimport { useAppStore } from '../state/appStore';\r\nimport { toast } from '../utils/toast';\r\n\r\ninterface Command {\r\n  id: string;\r\n  label: string;\r\n  description: string;\r\n  icon: React.ComponentType<any>;\r\n  action: () => void | Promise<void>;\r\n  keywords: string[];\r\n}\r\n\r\nexport function CommandPalette() {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [query, setQuery] = useState('');\r\n  const [selectedIndex, setSelectedIndex] = useState(0);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n  const { setMode } = useAppStore();\r\n\r\n  const commands: Command[] = [\r\n    {\r\n      id: 'research',\r\n      label: 'Research Mode',\r\n      description: 'Open research mode and search',\r\n      icon: Sparkles,\r\n      keywords: ['research', 'search', 'find', 'lookup'],\r\n      action: async () => {\r\n        await setMode('Research');\r\n        setIsOpen(false);\r\n        toast.info('Research mode opened');\r\n      },\r\n    },\r\n    {\r\n      id: 'trade',\r\n      label: 'Trade Mode',\r\n      description: 'Open trading mode with charts',\r\n      icon: TrendingUp,\r\n      keywords: ['trade', 'trading', 'chart', 'btc', 'crypto'],\r\n      action: async () => {\r\n        await setMode('Trade');\r\n        setIsOpen(false);\r\n        toast.info('Trade mode opened');\r\n      },\r\n    },\r\n    {\r\n      id: 'browse',\r\n      label: 'Browse Mode',\r\n      description: 'Switch to browsing mode',\r\n      icon: Globe,\r\n      keywords: ['browse', 'web', 'internet'],\r\n      action: async () => {\r\n        await setMode('Browse');\r\n        setIsOpen(false);\r\n        toast.info('Browse mode opened');\r\n      },\r\n    },\r\n    {\r\n      id: 'wispr',\r\n      label: 'WISPR Voice',\r\n      description: 'Activate WISPR voice assistant',\r\n      icon: Sparkles,\r\n      keywords: ['wispr', 'voice', 'jarvis', 'assistant'],\r\n      action: () => {\r\n        setIsOpen(false);\r\n        // Trigger WISPR activation\r\n        window.dispatchEvent(new CustomEvent('activate-wispr'));\r\n        toast.info('WISPR activated');\r\n      },\r\n    },\r\n    {\r\n      id: 'new-workspace',\r\n      label: 'New Workspace',\r\n      description: 'Create a new workspace for organizing tabs',\r\n      icon: FileText,\r\n      keywords: ['workspace', 'new', 'create', 'folder'],\r\n      action: async () => {\r\n        setIsOpen(false);\r\n        // Trigger workspace creation\r\n        window.dispatchEvent(new CustomEvent('create-workspace'));\r\n        toast.info('New workspace created');\r\n      },\r\n    },\r\n    {\r\n      id: 'look-it-up',\r\n      label: 'Look It Up',\r\n      description: 'Quick search and summarize (SigmaOS-style)',\r\n      icon: Search,\r\n      keywords: ['look', 'search', 'summarize', 'quick'],\r\n      action: async () => {\r\n        setIsOpen(false);\r\n        // Open quick search\r\n        window.dispatchEvent(new CustomEvent('open-quick-search'));\r\n        toast.info('Quick search opened');\r\n      },\r\n    },\r\n  ];\r\n\r\n  // Filter commands based on query\r\n  const filteredCommands = React.useMemo(() => {\r\n    if (!query.trim()) return commands;\r\n\r\n    const lowerQuery = query.toLowerCase();\r\n    return commands.filter(\r\n      cmd =>\r\n        cmd.label.toLowerCase().includes(lowerQuery) ||\r\n        cmd.description.toLowerCase().includes(lowerQuery) ||\r\n        cmd.keywords.some(kw => kw.toLowerCase().includes(lowerQuery))\r\n    );\r\n  }, [query]);\r\n\r\n  // Keyboard navigation\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.key === 'ArrowDown') {\r\n        e.preventDefault();\r\n        setSelectedIndex(prev => Math.min(prev + 1, filteredCommands.length - 1));\r\n      } else if (e.key === 'ArrowUp') {\r\n        e.preventDefault();\r\n        setSelectedIndex(prev => Math.max(prev - 1, 0));\r\n      } else if (e.key === 'Enter') {\r\n        e.preventDefault();\r\n        if (filteredCommands[selectedIndex]) {\r\n          filteredCommands[selectedIndex].action();\r\n        }\r\n      } else if (e.key === 'Escape') {\r\n        setIsOpen(false);\r\n        setQuery('');\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [isOpen, filteredCommands, selectedIndex]);\r\n\r\n  // Global shortcut: Cmd+K / Ctrl+K\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;\r\n      const modifier = isMac ? e.metaKey : e.ctrlKey;\r\n\r\n      if (modifier && e.key === 'k') {\r\n        e.preventDefault();\r\n        setIsOpen(prev => !prev);\r\n        if (!isOpen) {\r\n          setTimeout(() => inputRef.current?.focus(), 100);\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [isOpen]);\r\n\r\n  // Reset selection when query changes\r\n  useEffect(() => {\r\n    setSelectedIndex(0);\r\n  }, [query]);\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isOpen && (\r\n        <>\r\n          {/* Backdrop */}\r\n          <motion.div\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            onClick={() => setIsOpen(false)}\r\n            className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50\"\r\n          />\r\n\r\n          {/* Palette */}\r\n          <motion.div\r\n            initial={{ opacity: 0, scale: 0.95, y: -20 }}\r\n            animate={{ opacity: 1, scale: 1, y: 0 }}\r\n            exit={{ opacity: 0, scale: 0.95, y: -20 }}\r\n            className=\"fixed top-1/4 left-1/2 -translate-x-1/2 w-full max-w-2xl z-50\"\r\n          >\r\n            <div className=\"bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl overflow-hidden\">\r\n              {/* Search Input */}\r\n              <div className=\"flex items-center gap-3 px-4 py-3 border-b border-slate-800\">\r\n                <Search className=\"w-5 h-5 text-slate-400\" />\r\n                <input\r\n                  ref={inputRef}\r\n                  type=\"text\"\r\n                  value={query}\r\n                  onChange={e => setQuery(e.target.value)}\r\n                  placeholder=\"Type a command or search...\"\r\n                  className=\"flex-1 bg-transparent text-white placeholder-slate-500 outline-none\"\r\n                  autoFocus\r\n                />\r\n                <button\r\n                  onClick={() => setIsOpen(false)}\r\n                  className=\"text-slate-400 hover:text-white transition-colors\"\r\n                >\r\n                  <X className=\"w-5 h-5\" />\r\n                </button>\r\n              </div>\r\n\r\n              {/* Commands List */}\r\n              <div className=\"max-h-96 overflow-y-auto\">\r\n                {filteredCommands.length === 0 ? (\r\n                  <div className=\"px-4 py-8 text-center text-slate-400\">No commands found</div>\r\n                ) : (\r\n                  filteredCommands.map((cmd, index) => {\r\n                    const Icon = cmd.icon;\r\n                    const isSelected = index === selectedIndex;\r\n\r\n                    return (\r\n                      <button\r\n                        key={cmd.id}\r\n                        onClick={() => cmd.action()}\r\n                        onMouseEnter={() => setSelectedIndex(index)}\r\n                        className={`w-full flex items-center gap-3 px-4 py-3 text-left transition-colors ${\r\n                          isSelected\r\n                            ? 'bg-purple-600/20 border-l-2 border-purple-500'\r\n                            : 'hover:bg-slate-800/50'\r\n                        }`}\r\n                      >\r\n                        <Icon size={20} className=\"text-slate-400\" />\r\n                        <div className=\"flex-1\">\r\n                          <div className=\"text-white font-medium\">{cmd.label}</div>\r\n                          <div className=\"text-sm text-slate-400\">{cmd.description}</div>\r\n                        </div>\r\n                        {isSelected && <div className=\"text-xs text-slate-500\">Enter</div>}\r\n                      </button>\r\n                    );\r\n                  })\r\n                )}\r\n              </div>\r\n\r\n              {/* Footer */}\r\n              <div className=\"px-4 py-2 border-t border-slate-800 text-xs text-slate-500 flex items-center justify-between\">\r\n                <div> Navigate  Enter Select  Esc Close</div>\r\n                <div>Cmd+K / Ctrl+K to open</div>\r\n              </div>\r\n            </div>\r\n          </motion.div>\r\n        </>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n}\r\n","/**\n * SessionRestorePrompt Component\n * Prompts user to restore previous session after crash or restart\n */\n\nimport { useState, useEffect } from 'react';\nimport { ipc } from '../lib/ipc-typed';\nimport { useTabsStore } from '../state/tabsStore';\nimport { useAppStore } from '../state/appStore';\nimport { isElectronRuntime, isTauriRuntime } from '../lib/env';\nimport { X, RotateCcw, Sparkles } from 'lucide-react';\nimport { formatDistanceToNow } from 'date-fns';\n\ninterface SessionSnapshot {\n  version: number;\n  tabs: Array<{\n    id: string;\n    url: string;\n    title: string;\n    active: boolean;\n    mode?: string;\n    containerId?: string;\n  }>;\n  mode: string;\n  activeTabId: string | null;\n  timestamp: number;\n}\n\nexport function SessionRestorePrompt() {\n  const [snapshot, setSnapshot] = useState<SessionSnapshot | null>(null);\n  const [isRestoring, setIsRestoring] = useState(false);\n  const { setActive } = useTabsStore();\n  const { setMode } = useAppStore();\n\n  useEffect(() => {\n    // Skip session restore in web mode - no backend available\n    const isWebMode = !isElectronRuntime() && !isTauriRuntime();\n\n    if (isWebMode) {\n      return; // Skip session restore in web mode\n    }\n\n    // Check for restore availability\n    const checkRestore = async () => {\n      try {\n        const result = await ipc.session.checkRestore();\n        if (result?.available && result?.snapshot) {\n          // Get full snapshot\n          const fullSnapshot = await ipc.session.getSnapshot();\n          if (fullSnapshot && fullSnapshot.tabs && Array.isArray(fullSnapshot.tabs)) {\n            setSnapshot(fullSnapshot);\n          }\n        }\n      } catch (error) {\n        // Silently fail - session restore is optional\n        if (process.env.NODE_ENV === 'development') {\n          console.debug('[SessionRestorePrompt] No restore available:', error);\n        }\n      }\n    };\n\n    checkRestore();\n\n    // Also listen for IPC event from main process\n    if (window.ipc?.on) {\n      const handleRestoreAvailable = (\n        _event: any,\n        _data: { tabCount: number; timestamp: number }\n      ) => {\n        checkRestore();\n      };\n\n      window.ipc.on?.('session:restore-available', handleRestoreAvailable);\n\n      return () => {\n        if (window.ipc?.removeListener) {\n          window.ipc.removeListener('session:restore-available', handleRestoreAvailable);\n        }\n      };\n    }\n  }, []);\n\n  const handleRestore = async () => {\n    if (!snapshot) return;\n\n    setIsRestoring(true);\n\n    try {\n      // Restore tabs\n      for (const tab of snapshot.tabs) {\n        const newTab = await ipc.tabs.create({\n          url: tab.url,\n          mode: (tab.mode as 'normal' | 'ghost' | 'private') || 'normal',\n          containerId: tab.containerId,\n          fromSessionRestore: true,\n        });\n\n        if (newTab && typeof newTab === 'object' && 'id' in newTab) {\n          const tabId = typeof newTab.id === 'string' ? newTab.id : null;\n          if (tabId && (tab.active || tab.id === snapshot.activeTabId)) {\n            setActive(tabId);\n          }\n        }\n      }\n\n      // Restore mode\n      if (snapshot.mode) {\n        setMode(snapshot.mode as any);\n      }\n\n      // Dismiss restore\n      await ipc.session.dismissRestore();\n      setSnapshot(null);\n    } catch (error) {\n      console.error('[SessionRestorePrompt] Failed to restore:', error);\n    } finally {\n      setIsRestoring(false);\n    }\n  };\n\n  const handleDismiss = async () => {\n    try {\n      await ipc.session.dismissRestore();\n      setSnapshot(null);\n    } catch (error) {\n      console.error('[SessionRestorePrompt] Failed to dismiss:', error);\n    }\n  };\n\n  if (!snapshot) return null;\n\n  const tabCount = snapshot.tabs.length;\n  const lastSaved = new Date(snapshot.timestamp);\n\n  return (\n    <div\n      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm\"\n      onClick={e => {\n        // Don't interfere with button clicks\n        const target = e.target as HTMLElement;\n        if (target.closest('button')) {\n          return; // Let button handle it\n        }\n      }}\n    >\n      <div\n        className=\"mx-4 w-full max-w-md rounded-lg border border-gray-700 bg-gray-900 p-6 shadow-xl\"\n        onClick={e => {\n          // Don't interfere with button clicks\n          const target = e.target as HTMLElement;\n          if (target.closest('button')) {\n            return; // Let button handle it\n          }\n          // Prevent clicks on modal from bubbling to backdrop\n          e.stopPropagation();\n        }}\n      >\n        <div className=\"mb-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <RotateCcw className=\"h-5 w-5 text-blue-500\" />\n            <h2 className=\"text-xl font-bold text-gray-200\">Restore Previous Session?</h2>\n          </div>\n          <button\n            type=\"button\"\n            onClick={e => {\n              e.preventDefault();\n              e.stopPropagation();\n              (e as any).stopImmediatePropagation();\n              setTimeout(() => {\n                handleDismiss();\n              }, 0);\n            }}\n            className=\"text-gray-400 transition-colors hover:text-gray-300\"\n            aria-label=\"Close\"\n            style={{ pointerEvents: 'auto', zIndex: 10001 }}\n          >\n            <X className=\"h-5 w-5\" />\n          </button>\n        </div>\n\n        <p className=\"mb-4 text-sm text-gray-400\">\n          We found a session snapshot from your last session. Would you like to restore it?\n        </p>\n\n        <div className=\"mb-4 space-y-2 rounded bg-gray-800 p-3 text-sm\">\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-gray-400\">Tabs</span>\n            <span className=\"font-medium text-gray-200\">{tabCount}</span>\n          </div>\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-gray-400\">Mode</span>\n            <span className=\"font-medium capitalize text-gray-200\">{snapshot.mode}</span>\n          </div>\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-gray-400\">Last saved</span>\n            <span className=\"font-medium text-gray-200\">\n              {formatDistanceToNow(lastSaved, { addSuffix: true })}\n            </span>\n          </div>\n        </div>\n\n        <div className=\"flex gap-3\">\n          <button\n            type=\"button\"\n            onClick={e => {\n              e.preventDefault();\n              e.stopPropagation();\n              (e as any).stopImmediatePropagation();\n              setTimeout(() => {\n                handleRestore();\n              }, 0);\n            }}\n            disabled={isRestoring}\n            className=\"flex flex-1 items-center justify-center gap-2 rounded bg-blue-500 px-4 py-2 transition-colors hover:bg-blue-600 disabled:cursor-not-allowed disabled:opacity-50\"\n            style={{ pointerEvents: isRestoring ? 'none' : 'auto', zIndex: 10001 }}\n          >\n            {isRestoring ? (\n              <>\n                <Sparkles className=\"h-4 w-4 animate-spin\" />\n                Restoring...\n              </>\n            ) : (\n              <>\n                <RotateCcw className=\"h-4 w-4\" />\n                Restore\n              </>\n            )}\n          </button>\n          <button\n            type=\"button\"\n            onClick={e => {\n              e.preventDefault();\n              e.stopPropagation();\n              (e as any).stopImmediatePropagation();\n              setTimeout(() => {\n                handleDismiss();\n              }, 0);\n            }}\n            disabled={isRestoring}\n            className=\"flex-1 rounded bg-gray-700 px-4 py-2 transition-colors hover:bg-gray-600 disabled:opacity-50\"\n            style={{ pointerEvents: isRestoring ? 'none' : 'auto', zIndex: 10001 }}\n          >\n            Start Fresh\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","/**\r\n * Privacy Auto-Toggle - Automatically switch to Private mode on sensitive sites\r\n * \r\n * Uses Redix threat scanning to detect sensitive content and auto-enable privacy\r\n */\r\n\r\nimport { ipc } from '../../lib/ipc-typed';\r\n\r\n// Sensitive domain patterns\r\nconst SENSITIVE_PATTERNS = [\r\n  /banking|financial|credit|loan|mortgage/i,\r\n  /medical|health|patient|diagnosis|prescription/i,\r\n  /legal|lawyer|attorney|court|lawsuit/i,\r\n  /government|gov|irs|tax|social.*security/i,\r\n  /adult|xxx|porn/i,\r\n];\r\n\r\n// Known sensitive domains\r\nconst SENSITIVE_DOMAINS = [\r\n  'bankofamerica.com',\r\n  'chase.com',\r\n  'wellsfargo.com',\r\n  'paypal.com',\r\n  'healthcare.gov',\r\n  'irs.gov',\r\n  'ssa.gov',\r\n];\r\n\r\nexport interface PrivacyAutoToggleConfig {\r\n  enabled: boolean;\r\n  sensitivityThreshold: number; // 0-100\r\n  autoPrivate: boolean;\r\n  autoGhost: boolean;\r\n}\r\n\r\nconst DEFAULT_CONFIG: PrivacyAutoToggleConfig = {\r\n  enabled: true,\r\n  sensitivityThreshold: 70,\r\n  autoPrivate: false, // Default to Ghost (Tor) for sensitive sites\r\n  autoGhost: true,\r\n};\r\n\r\nlet currentConfig = { ...DEFAULT_CONFIG };\r\n\r\n/**\r\n * Check if a URL is sensitive based on domain and content patterns\r\n */\r\nexport async function checkSensitivity(url: string): Promise<{\r\n  isSensitive: boolean;\r\n  score: number;\r\n  reasons: string[];\r\n}> {\r\n  try {\r\n    const urlObj = new URL(url);\r\n    const hostname = urlObj.hostname.toLowerCase();\r\n    \r\n    let score = 0;\r\n    const reasons: string[] = [];\r\n\r\n    // Check domain patterns\r\n    for (const pattern of SENSITIVE_PATTERNS) {\r\n      if (pattern.test(hostname) || pattern.test(url)) {\r\n        score += 20;\r\n        reasons.push(`Matches sensitive pattern: ${pattern.source}`);\r\n      }\r\n    }\r\n\r\n    // Check known sensitive domains\r\n    if (SENSITIVE_DOMAINS.some(domain => hostname.includes(domain))) {\r\n      score += 30;\r\n      reasons.push('Known sensitive domain');\r\n    }\r\n\r\n    // Use Redix threat scanning if available (check if IPC method exists)\r\n    try {\r\n      if (typeof (ipc as any).threats?.scanUrl === 'function') {\r\n        const threatScan = await (ipc as any).threats.scanUrl(url);\r\n        if (threatScan && typeof threatScan === 'object') {\r\n          const riskLevel = (threatScan as any).riskLevel || 'low';\r\n          if (riskLevel === 'high' || riskLevel === 'critical') {\r\n            score += 40;\r\n            reasons.push(`Redix threat scan: ${riskLevel} risk`);\r\n          } else if (riskLevel === 'medium') {\r\n            score += 20;\r\n            reasons.push(`Redix threat scan: ${riskLevel} risk`);\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.debug('[PrivacyAutoToggle] Threat scan failed:', error);\r\n    }\r\n\r\n    return {\r\n      isSensitive: score >= currentConfig.sensitivityThreshold,\r\n      score: Math.min(100, score),\r\n      reasons,\r\n    };\r\n  } catch (error) {\r\n    console.error('[PrivacyAutoToggle] Failed to check sensitivity:', error);\r\n    return { isSensitive: false, score: 0, reasons: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Auto-enable privacy mode for sensitive sites\r\n */\r\nexport async function autoTogglePrivacy(url: string, currentMode: 'Normal' | 'Private' | 'Ghost'): Promise<'Normal' | 'Private' | 'Ghost' | null> {\r\n  if (!currentConfig.enabled || currentMode !== 'Normal') {\r\n    return null; // Already in privacy mode or auto-toggle disabled\r\n  }\r\n\r\n  const sensitivity = await checkSensitivity(url);\r\n  \r\n  if (!sensitivity.isSensitive) {\r\n    return null; // Not sensitive enough\r\n  }\r\n\r\n  console.debug(`[PrivacyAutoToggle] Sensitive site detected (score: ${sensitivity.score}):`, url, sensitivity.reasons);\r\n\r\n  // Auto-enable Ghost mode (Tor) for maximum privacy\r\n  if (currentConfig.autoGhost) {\r\n    try {\r\n      // Check if Tor is available\r\n      const torStatus = await ipc.tor.status() as any;\r\n      if (torStatus && !torStatus.stub) {\r\n        // Start Tor if not running\r\n        if (!torStatus.running) {\r\n          await ipc.tor.start();\r\n        }\r\n        // Create ghost tab with Tor proxy\r\n        await ipc.private.createGhostTab({ url });\r\n        return 'Ghost';\r\n      }\r\n    } catch (error) {\r\n      console.warn('[PrivacyAutoToggle] Ghost mode failed, trying Private:', error);\r\n    }\r\n  }\r\n\r\n  // Fallback to Private mode (incognito)\r\n  if (currentConfig.autoPrivate) {\r\n    try {\r\n      await ipc.private.createWindow({ url });\r\n      return 'Private';\r\n    } catch (error) {\r\n      console.error('[PrivacyAutoToggle] Failed to create private window:', error);\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Update auto-toggle configuration\r\n */\r\nexport function updateConfig(config: Partial<PrivacyAutoToggleConfig>): void {\r\n  currentConfig = { ...currentConfig, ...config };\r\n}\r\n\r\n/**\r\n * Get current configuration\r\n */\r\nexport function getConfig(): PrivacyAutoToggleConfig {\r\n  return { ...currentConfig };\r\n}\r\n\r\n","import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\nimport { ipc } from '../lib/ipc-typed';\nimport { useTabsStore, type Tab } from './tabsStore';\n\ntype SnapshotTab = Pick<\n  Tab,\n  'id' | 'url' | 'title' | 'appMode' | 'containerId' | 'containerName' | 'containerColor'\n>;\n\ntype SessionSnapshot = {\n  updatedAt: number;\n  tabCount: number;\n  tabs: SnapshotTab[];\n  activeId: string | null;\n  hash: string;\n};\n\ntype SessionStore = {\n  snapshot: SessionSnapshot | null;\n  saveSnapshot: (tabs: Tab[], activeId: string | null) => void;\n  clearSnapshot: () => void;\n  restoreFromSnapshot: () => Promise<{ restored: boolean; tabCount: number }>;\n};\n\nconst buildHash = (tabs: SnapshotTab[], activeId: string | null) => {\n  const base = tabs\n    .map((tab) => `${tab.appMode ?? 'all'}|${tab.url ?? 'about:blank'}`)\n    .join('::');\n  return `${activeId ?? 'none'}#${base}`;\n};\n\nexport const useSessionStore = create<SessionStore>()(\n  persist(\n    (set, get) => ({\n      snapshot: null,\n      saveSnapshot: (tabs, activeId) => {\n        if (!Array.isArray(tabs) || tabs.length === 0) {\n          set({ snapshot: null });\n          return;\n        }\n        const snapshotTabs: SnapshotTab[] = tabs.map((tab) => ({\n          id: tab.id,\n          url: tab.url,\n          title: tab.title,\n          appMode: tab.appMode,\n          containerId: tab.containerId,\n          containerName: tab.containerName,\n          containerColor: tab.containerColor,\n        }));\n        const last = get().snapshot;\n        const hash = buildHash(snapshotTabs, activeId);\n        if (last?.hash === hash) {\n          return;\n        }\n        set({\n          snapshot: {\n            updatedAt: Date.now(),\n            tabCount: snapshotTabs.length,\n            tabs: snapshotTabs,\n            activeId: snapshotTabs.some((tab) => tab.id === activeId) ? activeId : snapshotTabs[0].id,\n            hash,\n          },\n        });\n      },\n      clearSnapshot: () => set({ snapshot: null }),\n      restoreFromSnapshot: async () => {\n        const snapshot = get().snapshot;\n        if (!snapshot || snapshot.tabs.length === 0) {\n          return { restored: false, tabCount: 0 };\n        }\n        const tabsStore = useTabsStore.getState();\n        const createdTabIds: string[] = [];\n        for (const saved of snapshot.tabs) {\n          const targetUrl = saved.url || 'about:blank';\n          try {\n            const result = await ipc.tabs.create(targetUrl);\n            const resolvedId =\n              typeof result === 'string' ? result : (result && typeof result === 'object' ? (result as any).id : null);\n            if (resolvedId) {\n              tabsStore.updateTab(resolvedId, {\n                title: saved.title,\n                appMode: saved.appMode,\n                containerId: saved.containerId,\n                containerName: saved.containerName,\n                containerColor: saved.containerColor,\n              });\n              createdTabIds.push(resolvedId);\n            }\n          } catch (error) {\n            console.warn('[SessionStore] Failed to recreate tab from snapshot:', error);\n          }\n        }\n        if (createdTabIds.length === 0) {\n          return { restored: false, tabCount: 0 };\n        }\n        const snapshotActiveIndex = snapshot.tabs.findIndex((tab) => tab.id === snapshot.activeId);\n        const resolvedActive =\n          snapshotActiveIndex >= 0 ? createdTabIds[snapshotActiveIndex] : createdTabIds[createdTabIds.length - 1];\n        if (resolvedActive) {\n          tabsStore.setActive(resolvedActive);\n          try {\n            await ipc.tabs.activate({ id: resolvedActive });\n          } catch (error) {\n            console.warn('[SessionStore] Failed to activate restored tab:', error);\n          }\n        }\n        return { restored: true, tabCount: createdTabIds.length };\n      },\n    }),\n    {\n      name: 'regen:session-snapshot',\n      version: 1,\n    },\n  ),\n);\n","import { create } from 'zustand';\r\n\r\nexport type HistoryEntry = {\r\n  id: string;\r\n  type: 'search' | 'url';\r\n  value: string;\r\n  url?: string;\r\n  appMode?: string;\r\n  timestamp: number;\r\n};\r\n\r\ntype HistoryStore = {\r\n  entries: HistoryEntry[];\r\n  addEntry: (entry: Omit<HistoryEntry, 'id' | 'timestamp'>) => void;\r\n  clear: () => void;\r\n  getRecent: (limit?: number) => HistoryEntry[];\r\n};\r\n\r\nconst HISTORY_STORAGE_KEY = 'regen:history';\r\nconst MAX_ENTRIES = 150;\r\n\r\nconst loadInitialHistory = (): HistoryEntry[] => {\r\n  if (typeof window === 'undefined') {\r\n    return [];\r\n  }\r\n  try {\r\n    const raw = window.localStorage.getItem(HISTORY_STORAGE_KEY);\r\n    if (!raw) return [];\r\n    const parsed = JSON.parse(raw);\r\n    if (!Array.isArray(parsed)) return [];\r\n    return parsed\r\n      .filter((item) => item && typeof item.id === 'string')\r\n      .sort((a, b) => (b.timestamp ?? 0) - (a.timestamp ?? 0))\r\n      .slice(0, MAX_ENTRIES);\r\n  } catch {\r\n    return [];\r\n  }\r\n};\r\n\r\nconst persistHistory = (entries: HistoryEntry[]) => {\r\n  if (typeof window === 'undefined') return;\r\n  try {\r\n    window.localStorage.setItem(HISTORY_STORAGE_KEY, JSON.stringify(entries));\r\n  } catch (error) {\r\n    console.warn('[historyStore] Failed to persist history', error);\r\n  }\r\n};\r\n\r\nexport const useHistoryStore = create<HistoryStore>((set, get) => ({\r\n  entries: loadInitialHistory(),\r\n  addEntry: (entry) => {\r\n    const newEntry: HistoryEntry = {\r\n      ...entry,\r\n      id: `${entry.type}-${Date.now()}-${Math.random().toString(36).slice(2)}`,\r\n      timestamp: Date.now(),\r\n    };\r\n    set((state) => {\r\n      const next = [newEntry, ...state.entries].slice(0, MAX_ENTRIES);\r\n      persistHistory(next);\r\n      return { entries: next };\r\n    });\r\n  },\r\n  clear: () => {\r\n    set({ entries: [] });\r\n    persistHistory([]);\r\n  },\r\n  getRecent: (limit = 15) => {\r\n    return get().entries.slice(0, limit);\r\n  },\r\n}));\r\n","/**\n * Layout Sync Utility - PR: Fix layout overlap issues\n * Keeps CSS variables in sync with actual component heights\n */\n\n/**\n * Update bottom bar height CSS variable\n */\nexport function updateBottomBarHeight(): void {\n  const bottomBar = document.getElementById('bottomBar');\n  if (bottomBar) {\n    const height = bottomBar.getBoundingClientRect().height;\n    document.documentElement.style.setProperty('--bottom-bar-height', `${height}px`);\n  } else {\n    // Default fallback\n    document.documentElement.style.setProperty('--bottom-bar-height', '80px');\n  }\n}\n\n/**\n * Update topbar height CSS variable\n */\nexport function updateTopbarHeight(): void {\n  const topbar = document.querySelector('[data-top-chrome]');\n  if (topbar) {\n    const height = topbar.getBoundingClientRect().height;\n    document.documentElement.style.setProperty('--topbar-height', `${height}px`);\n  } else {\n    document.documentElement.style.setProperty('--topbar-height', '56px');\n  }\n}\n\n/**\n * Update sidebar width CSS variable\n */\nexport function updateSidebarWidth(): void {\n  const sidebar = document.querySelector('[data-sidebar]');\n  if (sidebar) {\n    const width = sidebar.getBoundingClientRect().width;\n    document.documentElement.style.setProperty('--sidebar-width', `${width}px`);\n  } else {\n    document.documentElement.style.setProperty('--sidebar-width', '320px');\n  }\n}\n\n/**\n * Initialize layout sync - call on mount\n */\nexport function initLayoutSync(): () => void {\n  // Initial update\n  updateBottomBarHeight();\n  updateTopbarHeight();\n  updateSidebarWidth();\n\n  // Update on resize\n  const handleResize = () => {\n    updateBottomBarHeight();\n    updateTopbarHeight();\n    updateSidebarWidth();\n  };\n\n  window.addEventListener('resize', handleResize);\n\n  // Use ResizeObserver for more accurate updates\n  const bottomBar = document.getElementById('bottomBar');\n  const resizeObserver = bottomBar\n    ? new ResizeObserver(() => {\n        updateBottomBarHeight();\n      })\n    : null;\n\n  if (bottomBar && resizeObserver) {\n    resizeObserver.observe(bottomBar);\n  }\n\n  // Cleanup\n  return () => {\n    window.removeEventListener('resize', handleResize);\n    if (resizeObserver && bottomBar) {\n      resizeObserver.unobserve(bottomBar);\n    }\n  };\n}\n","import { useEffect, useState } from 'react';\nimport { TrendingUp, TrendingDown, Shield, RefreshCw, Plus } from 'lucide-react';\nimport { fetchTradeQuote } from '../../core/trade/dataService';\nimport { useTradeStore } from '../../state/tradeStore';\n\ninterface TradeSidebarProps {\n  open: boolean;\n  onClose: () => void;\n}\n\nexport function TradeSidebar({ open, onClose }: TradeSidebarProps) {\n  const { activeSymbol, setActiveSymbol, watchlist, addToWatchlist, quotes, updateQuote } =\n    useTradeStore();\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [newSymbol, setNewSymbol] = useState('');\n\n  useEffect(() => {\n    if (!open) return;\n    let cancelled = false;\n\n    const loadQuote = async () => {\n      setLoading(true);\n      setError(null);\n      try {\n        const quote = await fetchTradeQuote(activeSymbol);\n        if (!cancelled) {\n          updateQuote(activeSymbol, quote);\n        }\n      } catch (err) {\n        if (!cancelled) {\n          setError(err instanceof Error ? err.message : 'Failed to load quote');\n        }\n      } finally {\n        if (!cancelled) {\n          setLoading(false);\n        }\n      }\n    };\n\n    loadQuote();\n    // Real-time updates: Poll every 5 seconds for active trading\n    const interval = setInterval(loadQuote, 5000);\n    return () => {\n      cancelled = true;\n      clearInterval(interval);\n    };\n  }, [activeSymbol, open, updateQuote]);\n\n  const quote = quotes[activeSymbol];\n  const changePositive = (quote?.change || 0) >= 0;\n\n  return (\n    <>\n      {/* Backdrop for mobile */}\n      {open && (\n        <div\n          className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-30 sm:hidden\"\n          onClick={onClose}\n          aria-hidden=\"true\"\n        />\n      )}\n      <div\n        className={`fixed right-0 top-0 bottom-0 w-96 max-w-[90vw] sm:max-w-full bg-gray-900/95 backdrop-blur-xl border-l border-gray-800 z-40 transform transition-transform duration-300 ${\n          open ? 'translate-x-0' : 'translate-x-full'\n        }`}\n        onClick={e => e.stopPropagation()}\n      >\n        <div className=\"flex items-center justify-between p-4 border-b border-gray-800\">\n          <div className=\"flex items-center gap-2\">\n            <Shield size={18} className=\"text-blue-400\" />\n            <div>\n              <h2 className=\"text-lg font-semibold text-white\">Trade Mode</h2>\n              <p className=\"text-xs text-gray-400\">Ghost + VPN enabled for market data</p>\n            </div>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"rounded-lg p-1.5 text-gray-400 hover:text-white hover:bg-gray-800 transition-colors\"\n            aria-label=\"Close trade sidebar\"\n          >\n            \n          </button>\n        </div>\n\n        <div className=\"p-4 space-y-4 overflow-y-auto h-full\">\n          <div className=\"bg-gray-800/50 rounded-xl border border-gray-700/50 p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <div className=\"text-xs uppercase text-gray-400 tracking-wide\">Active Symbol</div>\n                <div className=\"text-2xl font-bold text-white\">{activeSymbol}</div>\n                {quote && (\n                  <div className=\"flex items-center gap-2 mt-2\">\n                    {changePositive ? (\n                      <TrendingUp size={16} className=\"text-green-400\" />\n                    ) : (\n                      <TrendingDown size={16} className=\"text-red-400\" />\n                    )}\n                    <span className={changePositive ? 'text-green-400' : 'text-red-400'}>\n                      {quote.change.toFixed(2)} ({quote.changePercent.toFixed(2)}%)\n                    </span>\n                  </div>\n                )}\n              </div>\n              <button\n                onClick={() =>\n                  quotes[activeSymbol] && updateQuote(activeSymbol, quotes[activeSymbol]!)\n                }\n                className=\"p-2 rounded-lg bg-gray-800 text-gray-300 hover:text-white hover:bg-gray-700\"\n                title=\"Refresh quote\"\n              >\n                <RefreshCw size={16} />\n              </button>\n            </div>\n\n            <div className=\"mt-4 h-24\">\n              {quote ? (\n                <Sparkline values={quote.sparkline} positive={changePositive} />\n              ) : (\n                <div className=\"flex items-center justify-center h-full text-gray-500 text-sm\">\n                  {loading ? 'Loading...' : 'No data'}\n                </div>\n              )}\n            </div>\n          </div>\n\n          <div className=\"bg-gray-800/50 rounded-xl border border-gray-700/50 p-4 space-y-2\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm font-semibold text-gray-200\">Watchlist</span>\n              <div className=\"flex items-center gap-2\">\n                <input\n                  value={newSymbol}\n                  onChange={e => setNewSymbol(e.target.value.toUpperCase())}\n                  placeholder=\"Add symbol\"\n                  className=\"bg-gray-900 border border-gray-700 text-sm text-white rounded px-2 py-1 w-24\"\n                />\n                <button\n                  onClick={() => {\n                    if (!newSymbol) return;\n                    addToWatchlist(newSymbol);\n                    setActiveSymbol(newSymbol);\n                    setNewSymbol('');\n                  }}\n                  className=\"p-1.5 rounded bg-blue-500/20 text-blue-300 hover:bg-blue-500/30\"\n                >\n                  <Plus size={14} />\n                </button>\n              </div>\n            </div>\n            <div className=\"flex flex-wrap gap-2\">\n              {watchlist.map(symbol => {\n                const quote = quotes[symbol];\n                const positive = quote ? quote.change >= 0 : true;\n                return (\n                  <button\n                    key={symbol}\n                    onClick={() => setActiveSymbol(symbol)}\n                    className={`px-3 py-1.5 rounded-lg border text-sm transition-colors ${\n                      symbol === activeSymbol\n                        ? 'border-blue-500/40 bg-blue-500/10 text-blue-200'\n                        : 'border-gray-700 text-gray-300 hover:border-blue-500/40'\n                    }`}\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <span>{symbol}</span>\n                      {quote && (\n                        <span className={positive ? 'text-green-400' : 'text-red-400'}>\n                          {positive ? '+' : ''}\n                          {quote.changePercent.toFixed(1)}%\n                        </span>\n                      )}\n                    </div>\n                  </button>\n                );\n              })}\n            </div>\n          </div>\n\n          {quote && (\n            <div className=\"bg-gray-800/50 rounded-xl border border-gray-700/50 p-4 space-y-2\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm font-semibold text-gray-200\">Sentiment</span>\n                <span\n                  className={`text-xs px-2 py-0.5 rounded-full ${\n                    quote.sentiment === 'bullish'\n                      ? 'bg-green-500/20 text-green-300'\n                      : quote.sentiment === 'bearish'\n                        ? 'bg-red-500/20 text-red-300'\n                        : 'bg-gray-700 text-gray-300'\n                  }`}\n                >\n                  {quote.sentiment}\n                </span>\n              </div>\n              <div className=\"grid grid-cols-2 gap-3 text-sm text-gray-300\">\n                <div>\n                  <div className=\"text-xs text-gray-500\">Price</div>\n                  <div className=\"text-lg font-semibold text-white\">${quote.price.toFixed(2)}</div>\n                </div>\n                <div>\n                  <div className=\"text-xs text-gray-500\">Volume</div>\n                  <div>{quote.volume?.toLocaleString() || ''}</div>\n                </div>\n                <div>\n                  <div className=\"text-xs text-gray-500\">Prev Close</div>\n                  <div>${quote.previousClose?.toFixed(2) ?? ''}</div>\n                </div>\n                <div>\n                  <div className=\"text-xs text-gray-500\">Updated</div>\n                  <div>{new Date(quote.updatedAt).toLocaleTimeString()}</div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {error && <div className=\"text-sm text-red-400\">{error}</div>}\n        </div>\n      </div>\n    </>\n  );\n}\n\nfunction Sparkline({ values, positive }: { values: number[]; positive: boolean }) {\n  const max = Math.max(...values);\n  const min = Math.min(...values);\n  const range = max - min || 1;\n  return (\n    <div className=\"h-full w-full flex items-end gap-[2px]\">\n      {values.map((value, idx) => {\n        const heightPercent = ((value - min) / range) * 100;\n        return (\n          <div\n            key={idx}\n            className={`flex-1 rounded-sm ${positive ? 'bg-green-500/60' : 'bg-red-500/60'}`}\n            style={{ height: `${heightPercent}%` }}\n          />\n        );\n      })}\n    </div>\n  );\n}\n","/**\n * TermsAcceptance - First-run TOS acceptance component\n *\n * Displays Terms of Service and requires user acceptance before proceeding.\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { FileText, Check, X, ExternalLink } from 'lucide-react';\n// import { useSettingsStore } from '../../state/settingsStore'; // Unused for now\n\ninterface TermsAcceptanceProps {\n  onAccept: () => void;\n  onDecline: () => void;\n}\n\nexport function TermsAcceptance({ onAccept, onDecline }: TermsAcceptanceProps) {\n  const [showFullTerms, setShowFullTerms] = useState(false);\n  const [acceptedVersion, setAcceptedVersion] = useState<string | null>(null);\n  const [termsChecked, setTermsChecked] = useState(false);\n  const hasCheckedRef = React.useRef(false);\n\n  // const settings = useSettingsStore(); // Unused for now\n\n  // Check if user has already accepted current version\n  useEffect(() => {\n    // Only check once\n    if (hasCheckedRef.current) return;\n    hasCheckedRef.current = true;\n\n    try {\n      const stored = localStorage.getItem('regen:tos:accepted');\n      if (stored) {\n        try {\n          const data = JSON.parse(stored);\n          const currentVersion = '2025-12-17'; // Update when TOS changes\n          if (data.version === currentVersion && data.accepted) {\n            setAcceptedVersion(data.version);\n            // Auto-accept if already accepted - use setTimeout to avoid calling during render\n            if (typeof onAccept === 'function') {\n              setTimeout(() => {\n                onAccept();\n              }, 0);\n            }\n            return;\n          }\n        } catch {\n          // Invalid stored data, show acceptance screen\n        }\n      }\n    } catch (error) {\n      console.error('[TermsAcceptance] Error checking acceptance status:', error);\n      // Show acceptance screen on error\n    }\n  }, []); // Only run once on mount\n\n  // Track scrolling to enable accept button\n  const handleScroll = (_e: React.UIEvent<HTMLDivElement>) => {\n    // Scrolling no longer required to accept, but we keep hook for future metrics\n  };\n\n  const callAcceptCallback = () => {\n    if (typeof onAccept === 'function') {\n      Promise.resolve().then(() => {\n        onAccept();\n      });\n    }\n  };\n\n  const handleAccept = () => {\n    if (!termsChecked) {\n      console.warn('[TermsAcceptance] Accept called but terms not checked');\n      return;\n    }\n\n    console.log('[TermsAcceptance] Accept button clicked');\n    try {\n      const acceptanceData = {\n        version: '2025-12-17',\n        accepted: true,\n        timestamp: Date.now(),\n      };\n      localStorage.setItem('regen:tos:accepted', JSON.stringify(acceptanceData));\n      console.log('[TermsAcceptance] Acceptance saved to localStorage');\n\n      // Update state to hide component immediately\n      setAcceptedVersion('2025-12-17');\n      console.log('[TermsAcceptance] acceptedVersion state updated');\n\n      callAcceptCallback();\n    } catch (error) {\n      console.error('[TermsAcceptance] Failed to save acceptance:', error);\n      // Still update state and call onAccept to allow app to continue\n      setAcceptedVersion('2025-12-17');\n      callAcceptCallback();\n    }\n  };\n\n  const handleDecline = () => {\n    try {\n      // Clear any previous acceptance\n      localStorage.removeItem('regen:tos:accepted');\n    } catch (error) {\n      console.error('[TermsAcceptance] Failed to clear acceptance:', error);\n    }\n    if (typeof onDecline === 'function') {\n      onDecline();\n    }\n  };\n\n  // Don't show if already accepted\n  if (acceptedVersion) {\n    console.log('[TermsAcceptance] Component hidden - already accepted version:', acceptedVersion);\n    return null;\n  }\n\n  return (\n    <AnimatePresence mode=\"wait\">\n      <motion.div\n        key=\"terms-acceptance-modal\"\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        exit={{ opacity: 0 }}\n        className=\"fixed inset-0 z-[10002] bg-gray-900/95 backdrop-blur-sm flex items-center justify-center p-4\"\n        style={{ pointerEvents: 'auto' }}\n        onMouseDown={e => {\n          // Completely ignore button clicks - don't interfere at all\n          const target = e.target as HTMLElement;\n          if (\n            target.closest('button') ||\n            target.closest('[role=\"button\"]') ||\n            target.closest('a')\n          ) {\n            return; // Don't do anything - let button handle it completely\n          }\n        }}\n        onClick={e => {\n          // Completely ignore button clicks - don't interfere at all\n          const target = e.target as HTMLElement;\n          if (\n            target.closest('button') ||\n            target.closest('[role=\"button\"]') ||\n            target.closest('a')\n          ) {\n            return; // Don't do anything - let button handle it completely\n          }\n        }}\n      >\n        <motion.div\n          initial={{ scale: 0.95, opacity: 0 }}\n          animate={{ scale: 1, opacity: 1 }}\n          exit={{ scale: 0.95, opacity: 0 }}\n          className=\"bg-gray-800 border border-gray-700 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col\"\n          onMouseDown={e => {\n            // Completely ignore button clicks - don't interfere at all\n            const target = e.target as HTMLElement;\n            if (\n              target.closest('button') ||\n              target.closest('[role=\"button\"]') ||\n              target.closest('a')\n            ) {\n              return; // Don't do anything - let button handle it completely\n            }\n          }}\n          onClick={e => {\n            // Completely ignore button clicks - don't interfere at all\n            const target = e.target as HTMLElement;\n            if (\n              target.closest('button') ||\n              target.closest('[role=\"button\"]') ||\n              target.closest('a')\n            ) {\n              return; // Don't do anything - let button handle it completely\n            }\n            // Only stop propagation for non-button clicks\n            e.stopPropagation();\n          }}\n        >\n          {/* Header */}\n          <div className=\"flex items-center gap-3 p-6 border-b border-gray-700\">\n            <div className=\"p-2 bg-blue-500/20 rounded-lg\">\n              <FileText size={24} className=\"text-blue-400\" />\n            </div>\n            <div className=\"flex-1\">\n              <h2 className=\"text-xl font-semibold text-gray-100\">Terms of Service</h2>\n              <p className=\"text-sm text-gray-400 mt-1\">\n                Please read and accept our Terms of Service to continue\n              </p>\n            </div>\n          </div>\n\n          {/* Terms Content */}\n          <div\n            className=\"flex-1 overflow-y-auto p-6 text-sm text-gray-300 leading-relaxed\"\n            onScroll={handleScroll}\n          >\n            {showFullTerms ? (\n              <div className=\"prose prose-invert prose-sm max-w-none\">\n                <p className=\"text-gray-400 mb-4\">\n                  <strong>Last Updated: December 17, 2025</strong>\n                </p>\n\n                <section className=\"mb-6\">\n                  <h3 className=\"text-lg font-semibold text-gray-100 mb-3\">\n                    1. Acceptance of Terms\n                  </h3>\n                  <p>\n                    By downloading, installing, accessing, or using Regen, you agree to be bound by\n                    these Terms of Service. If you do not agree to these Terms, do not use the\n                    Software.\n                  </p>\n                </section>\n\n                <section className=\"mb-6\">\n                  <h3 className=\"text-lg font-semibold text-gray-100 mb-3\">\n                    2. Description of Service\n                  </h3>\n                  <p>\n                    Regen is a privacy-first, agentic research browser that provides multi-mode\n                    browsing, privacy features (Tor, VPN, Shields, Ghost Mode), AI-powered content\n                    processing, and knowledge graph tracking.\n                  </p>\n                </section>\n\n                <section className=\"mb-6\">\n                  <h3 className=\"text-lg font-semibold text-gray-100 mb-3\">3. Privacy and Data</h3>\n                  <p className=\"mb-2\">\n                    Regen stores data locally on your device by default. When using Ghost Mode (Tor\n                    Browser integration), all data is stored in ephemeral sessions with no\n                    persistence.\n                  </p>\n                  <p>\n                    You may export your data at any time using the GDPR data export feature in\n                    Settings.\n                  </p>\n                </section>\n\n                <section className=\"mb-6\">\n                  <h3 className=\"text-lg font-semibold text-gray-100 mb-3\">4. Acceptable Use</h3>\n                  <p className=\"mb-2\">You agree NOT to use Regen to:</p>\n                  <ul className=\"list-disc list-inside space-y-1 text-gray-400 ml-4\">\n                    <li>Violate any applicable laws or regulations</li>\n                    <li>Infringe on intellectual property rights</li>\n                    <li>Transmit malicious code or harmful content</li>\n                    <li>Engage in illegal activities</li>\n                    <li>Attempt to reverse engineer the Software</li>\n                  </ul>\n                </section>\n\n                <section className=\"mb-6\">\n                  <h3 className=\"text-lg font-semibold text-gray-100 mb-3\">5. Disclaimers</h3>\n                  <p className=\"mb-2\">\n                    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND. We do not\n                    guarantee that the Software will be available at all times, free from errors, or\n                    secure from all threats.\n                  </p>\n                  <p>\n                    AI-generated content is provided \"as-is\" and may contain errors. Always verify\n                    important information from primary sources.\n                  </p>\n                </section>\n\n                <section className=\"mb-6\">\n                  <h3 className=\"text-lg font-semibold text-gray-100 mb-3\">6. Open Source</h3>\n                  <p>\n                    Regen is open-source software licensed under the MIT License. The source code is\n                    available at{' '}\n                    <a\n                      href=\"https://github.com/nrbns/Omnibrowser\"\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"text-blue-400 hover:text-blue-300 underline inline-flex items-center gap-1\"\n                    >\n                      GitHub\n                      <ExternalLink size={12} />\n                    </a>\n                  </p>\n                </section>\n\n                <div className=\"mt-8 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg\">\n                  <p className=\"text-sm text-blue-200\">\n                    <strong>Note:</strong> This is a summary. The full Terms of Service are\n                    available in{' '}\n                    <code className=\"bg-gray-900/50 px-2 py-1 rounded text-xs\">\n                      TERMS_OF_SERVICE.md\n                    </code>{' '}\n                    or{' '}\n                    <a\n                      href=\"https://github.com/nrbns/Omnibrowser/blob/main/TERMS_OF_SERVICE.md\"\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"text-blue-400 hover:text-blue-300 underline inline-flex items-center gap-1\"\n                    >\n                      view online\n                      <ExternalLink size={12} />\n                    </a>\n                  </p>\n                </div>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                <div className=\"p-4 bg-gray-900/50 rounded-lg border border-gray-700\">\n                  <h3 className=\"font-semibold text-gray-100 mb-2\">Key Points:</h3>\n                  <ul className=\"space-y-2 text-gray-300\">\n                    <li className=\"flex items-start gap-2\">\n                      <Check size={16} className=\"text-green-400 mt-0.5 flex-shrink-0\" />\n                      <span>Regen is open-source (MIT License)</span>\n                    </li>\n                    <li className=\"flex items-start gap-2\">\n                      <Check size={16} className=\"text-green-400 mt-0.5 flex-shrink-0\" />\n                      <span>Data is stored locally on your device</span>\n                    </li>\n                    <li className=\"flex items-start gap-2\">\n                      <Check size={16} className=\"text-green-400 mt-0.5 flex-shrink-0\" />\n                      <span>Ghost Mode provides maximum privacy (ephemeral sessions)</span>\n                    </li>\n                    <li className=\"flex items-start gap-2\">\n                      <Check size={16} className=\"text-green-400 mt-0.5 flex-shrink-0\" />\n                      <span>You can export your data at any time</span>\n                    </li>\n                    <li className=\"flex items-start gap-2\">\n                      <Check size={16} className=\"text-green-400 mt-0.5 flex-shrink-0\" />\n                      <span>AI content is provided \"as-is\" - verify important information</span>\n                    </li>\n                  </ul>\n                </div>\n\n                <button\n                  type=\"button\"\n                  onClick={e => {\n                    e.preventDefault();\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                    setShowFullTerms(true);\n                  }}\n                  onMouseDown={e => {\n                    e.preventDefault();\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                    setShowFullTerms(true);\n                  }}\n                  onPointerDown={e => {\n                    e.preventDefault();\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                    setShowFullTerms(true);\n                  }}\n                  className=\"w-full px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm text-gray-200 transition-colors flex items-center justify-center gap-2 cursor-pointer active:scale-95\"\n                  style={{\n                    pointerEvents: 'auto',\n                    cursor: 'pointer',\n                    zIndex: 10010,\n                    position: 'relative',\n                    isolation: 'isolate',\n                    touchAction: 'manipulation',\n                  }}\n                >\n                  <FileText size={16} />\n                  <span>Read Full Terms of Service</span>\n                </button>\n              </div>\n            )}\n          </div>\n\n          {/* Footer Actions */}\n          <div className=\"flex items-center justify-between p-6 border-t border-gray-700 gap-4\">\n            <div className=\"flex flex-col gap-3 flex-1\">\n              {/* Terms Acceptance Checkbox */}\n              <label className=\"flex items-start gap-3 cursor-pointer group\">\n                <input\n                  type=\"checkbox\"\n                  checked={termsChecked}\n                  onChange={e => {\n                    e.stopPropagation();\n                    setTermsChecked(e.target.checked);\n                  }}\n                  onClick={e => {\n                    e.stopPropagation();\n                  }}\n                  className=\"mt-1 h-4 w-4 rounded border-gray-600 bg-gray-800 text-blue-500 focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-2 focus:ring-offset-gray-900 cursor-pointer\"\n                  style={{\n                    pointerEvents: 'auto',\n                    zIndex: 10011,\n                    position: 'relative',\n                  }}\n                />\n                <span className=\"text-sm text-gray-300 group-hover:text-gray-200\">\n                  I have read and agree to the Terms of Service\n                </span>\n              </label>\n\n              <div className=\"flex items-center gap-3\">\n                <button\n                  type=\"button\"\n                  onClick={e => {\n                    e.preventDefault();\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                    handleDecline();\n                  }}\n                  onMouseDown={e => {\n                    e.preventDefault();\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                    handleDecline();\n                  }}\n                  onPointerDown={e => {\n                    e.preventDefault();\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                    handleDecline();\n                  }}\n                  className=\"px-6 py-2.5 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm font-medium text-gray-200 transition-colors flex items-center gap-2 cursor-pointer active:scale-95\"\n                  style={{\n                    pointerEvents: 'auto',\n                    cursor: 'pointer',\n                    zIndex: 10010,\n                    position: 'relative',\n                    isolation: 'isolate',\n                    touchAction: 'manipulation',\n                  }}\n                >\n                  <X size={16} />\n                  <span>Decline</span>\n                </button>\n                <button\n                  type=\"button\"\n                  disabled={!termsChecked}\n                  onClick={e => {\n                    if (!termsChecked) {\n                      e.preventDefault();\n                      e.stopPropagation();\n                      return;\n                    }\n                    console.log('[TermsAcceptance] Accept button onClick triggered');\n                    e.preventDefault();\n                    e.stopPropagation();\n                    handleAccept();\n                  }}\n                  onMouseDown={e => {\n                    if (!termsChecked) {\n                      e.preventDefault();\n                      e.stopPropagation();\n                      return;\n                    }\n                    console.log('[TermsAcceptance] Accept button onMouseDown triggered');\n                    e.preventDefault();\n                    e.stopPropagation();\n                    // Don't call handleAccept here - let onClick handle it\n                  }}\n                  onPointerDown={e => {\n                    if (!termsChecked) {\n                      e.preventDefault();\n                      e.stopPropagation();\n                      return;\n                    }\n                    console.log('[TermsAcceptance] Accept button onPointerDown triggered');\n                    e.preventDefault();\n                    e.stopPropagation();\n                    // Don't call handleAccept here - let onClick handle it\n                  }}\n                  className={`px-6 py-2.5 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 active:scale-95 ${\n                    termsChecked\n                      ? 'bg-blue-600 hover:bg-blue-700 text-white cursor-pointer'\n                      : 'bg-gray-700 text-gray-400 cursor-not-allowed opacity-50'\n                  }`}\n                  style={{\n                    pointerEvents: 'auto',\n                    cursor: termsChecked ? 'pointer' : 'not-allowed',\n                    zIndex: 10010,\n                    position: 'relative',\n                    isolation: 'isolate',\n                    touchAction: 'manipulation',\n                  }}\n                >\n                  <Check size={16} />\n                  <span>Accept</span>\n                </button>\n              </div>\n            </div>\n          </div>\n        </motion.div>\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n","/**\n * CookieConsent - GDPR-Compliant Cookie Consent Banner\n *\n * Displays cookie consent options and stores user preferences.\n * Complies with GDPR requirements for cookie consent.\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Cookie, Settings, X, Check, AlertCircle, Info } from 'lucide-react';\n// import { useSettingsStore } from '../../state/settingsStore'; // Unused for now\n\nexport type CookieCategory = 'essential' | 'analytics' | 'functional' | 'advertising';\n\nexport interface CookiePreferences {\n  essential: boolean; // Always true (required for app to function)\n  analytics: boolean;\n  functional: boolean;\n  advertising: boolean;\n  timestamp: number;\n  version: string;\n}\n\nconst COOKIE_VERSION = '2025-12-17';\n\ninterface CookieConsentProps {\n  onAccept: (preferences: CookiePreferences) => void;\n  onDecline?: () => void;\n  showSettings?: boolean;\n}\n\nexport function CookieConsent({ onAccept, onDecline, showSettings = false }: CookieConsentProps) {\n  const [preferences, setPreferences] = useState<CookiePreferences>({\n    essential: true, // Always required\n    analytics: false,\n    functional: false,\n    advertising: false,\n    timestamp: Date.now(),\n    version: COOKIE_VERSION,\n  });\n  const [showDetails, setShowDetails] = useState(showSettings);\n  const [hasInteracted, setHasInteracted] = useState(false);\n\n  // Load saved preferences\n  useEffect(() => {\n    try {\n      const stored = localStorage.getItem('regen:cookie-consent');\n      if (stored) {\n        const data = JSON.parse(stored);\n        if (data.version === COOKIE_VERSION) {\n          setPreferences(data);\n          setHasInteracted(true);\n        }\n      }\n    } catch {\n      // Invalid stored data, use defaults\n    }\n  }, []);\n\n  const handleAcceptAll = () => {\n    const allAccepted: CookiePreferences = {\n      essential: true,\n      analytics: true,\n      functional: true,\n      advertising: true,\n      timestamp: Date.now(),\n      version: COOKIE_VERSION,\n    };\n    setPreferences(allAccepted);\n    setHasInteracted(true);\n    onAccept(allAccepted);\n  };\n\n  const handleAcceptSelected = () => {\n    setHasInteracted(true);\n    onAccept(preferences);\n  };\n\n  const handleDecline = () => {\n    const minimal: CookiePreferences = {\n      essential: true, // Required\n      analytics: false,\n      functional: false,\n      advertising: false,\n      timestamp: Date.now(),\n      version: COOKIE_VERSION,\n    };\n    setPreferences(minimal);\n    setHasInteracted(true);\n    onAccept(minimal);\n    onDecline?.();\n  };\n\n  const toggleCategory = (category: CookieCategory) => {\n    if (category === 'essential') return; // Can't disable essential\n    setPreferences(prev => ({\n      ...prev,\n      [category]: !prev[category],\n    }));\n  };\n\n  const cookieCategories = [\n    {\n      id: 'essential' as CookieCategory,\n      name: 'Essential Cookies',\n      description: 'Required for the app to function. These cannot be disabled.',\n      required: true,\n      examples: ['Session management', 'Security', 'Authentication'],\n    },\n    {\n      id: 'analytics' as CookieCategory,\n      name: 'Analytics Cookies',\n      description: 'Help us understand how you use Regen to improve the experience.',\n      required: false,\n      examples: ['Usage statistics', 'Performance metrics', 'Error tracking'],\n    },\n    {\n      id: 'functional' as CookieCategory,\n      name: 'Functional Cookies',\n      description: 'Enable enhanced features and personalization.',\n      required: false,\n      examples: ['Preferences', 'Settings', 'Theme selection'],\n    },\n    {\n      id: 'advertising' as CookieCategory,\n      name: 'Advertising Cookies',\n      description: 'Used for personalized ads (currently not used in Regen).',\n      required: false,\n      examples: ['Ad personalization', 'Ad targeting'],\n    },\n  ];\n\n  // Don't show if already accepted and not in settings mode\n  if (hasInteracted && !showSettings && preferences.essential) {\n    return null;\n  }\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0, y: 100 }}\n        animate={{ opacity: 1, y: 0 }}\n        exit={{ opacity: 0, y: 100 }}\n        className=\"fixed bottom-0 left-0 right-0 z-[10001] p-4\"\n        style={{ pointerEvents: 'auto' }}\n      >\n        <div className=\"max-w-4xl mx-auto\">\n          <motion.div\n            initial={{ scale: 0.95 }}\n            animate={{ scale: 1 }}\n            className=\"bg-gray-800 border border-gray-700 rounded-xl shadow-2xl overflow-hidden\"\n            onClick={e => {\n              // Completely ignore button clicks - don't interfere at all\n              const target = e.target as HTMLElement;\n              if (\n                target.closest('button') ||\n                target.closest('[role=\"button\"]') ||\n                target.closest('a')\n              ) {\n                return; // Don't do anything - let button handle it completely\n              }\n              // Only stop propagation for non-button clicks\n              e.stopPropagation();\n            }}\n            onMouseDown={e => {\n              // Completely ignore button clicks - don't interfere at all\n              const target = e.target as HTMLElement;\n              if (\n                target.closest('button') ||\n                target.closest('[role=\"button\"]') ||\n                target.closest('a')\n              ) {\n                return; // Don't do anything - let button handle it completely\n              }\n            }}\n          >\n            {/* Header */}\n            <div className=\"flex items-center gap-3 p-6 border-b border-gray-700\">\n              <div className=\"p-2 bg-blue-500/20 rounded-lg\">\n                <Cookie size={24} className=\"text-blue-400\" />\n              </div>\n              <div className=\"flex-1\">\n                <h2 className=\"text-xl font-semibold text-gray-100\">Cookie Preferences</h2>\n                <p className=\"text-sm text-gray-400 mt-1\">\n                  We use cookies to enhance your browsing experience and analyze usage.\n                </p>\n              </div>\n              {showSettings && (\n                <button\n                  type=\"button\"\n                  onClick={e => {\n                    e.preventDefault();\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                    setShowDetails(false);\n                  }}\n                  onMouseDown={e => {\n                    e.preventDefault();\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                  }}\n                  className=\"p-2 hover:bg-gray-700 rounded-lg transition-colors\"\n                  aria-label=\"Close\"\n                  style={{\n                    pointerEvents: 'auto',\n                    cursor: 'pointer',\n                    zIndex: 10011,\n                    isolation: 'isolate',\n                  }}\n                >\n                  <X size={20} className=\"text-gray-400\" />\n                </button>\n              )}\n            </div>\n\n            {/* Content */}\n            <div className=\"p-6 max-h-[60vh] overflow-y-auto\">\n              {showDetails ? (\n                <div className=\"space-y-4\">\n                  <div className=\"p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg\">\n                    <div className=\"flex items-start gap-2\">\n                      <Info size={16} className=\"text-blue-400 mt-0.5 flex-shrink-0\" />\n                      <p className=\"text-sm text-blue-200\">\n                        <strong>Your Privacy Matters:</strong> Regen stores data locally on your\n                        device by default. Cookies and similar technologies are used only for\n                        essential functionality and optional analytics. You can change these\n                        preferences at any time in Settings.\n                      </p>\n                    </div>\n                  </div>\n\n                  {cookieCategories.map(category => (\n                    <div\n                      key={category.id}\n                      className={`p-4 rounded-lg border ${\n                        preferences[category.id]\n                          ? 'bg-green-500/10 border-green-500/30'\n                          : 'bg-gray-900/50 border-gray-700'\n                      }`}\n                    >\n                      <div className=\"flex items-start justify-between gap-4\">\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-2 mb-2\">\n                            <h3 className=\"font-semibold text-gray-100\">{category.name}</h3>\n                            {category.required && (\n                              <span className=\"text-xs px-2 py-0.5 bg-gray-700 text-gray-300 rounded\">\n                                Required\n                              </span>\n                            )}\n                          </div>\n                          <p className=\"text-sm text-gray-400 mb-2\">{category.description}</p>\n                          <div className=\"text-xs text-gray-500\">\n                            <strong>Examples:</strong> {category.examples.join(', ')}\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          {category.required ? (\n                            <div className=\"px-3 py-1.5 bg-gray-700 text-gray-300 rounded text-sm font-medium\">\n                              Always On\n                            </div>\n                          ) : (\n                            <button\n                              type=\"button\"\n                              onClick={e => {\n                                e.preventDefault();\n                                (e as any).stopImmediatePropagation();\n                                e.stopPropagation();\n                                toggleCategory(category.id);\n                              }}\n                              onMouseDown={e => {\n                                e.preventDefault();\n                                (e as any).stopImmediatePropagation();\n                                e.stopPropagation();\n                              }}\n                              className={`px-3 py-1.5 rounded text-sm font-medium transition-colors ${\n                                preferences[category.id]\n                                  ? 'bg-green-600 hover:bg-green-700 text-white'\n                                  : 'bg-gray-700 hover:bg-gray-600 text-gray-300'\n                              }`}\n                              style={{\n                                pointerEvents: 'auto',\n                                cursor: 'pointer',\n                                zIndex: 10011,\n                                isolation: 'isolate',\n                              }}\n                            >\n                              {preferences[category.id] ? (\n                                <span className=\"flex items-center gap-1\">\n                                  <Check size={14} />\n                                  Enabled\n                                </span>\n                              ) : (\n                                'Disabled'\n                              )}\n                            </button>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n\n                  <div className=\"p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg\">\n                    <div className=\"flex items-start gap-2\">\n                      <AlertCircle size={16} className=\"text-yellow-400 mt-0.5 flex-shrink-0\" />\n                      <div className=\"text-sm text-yellow-200\">\n                        <strong>Note:</strong> Disabling non-essential cookies may limit some\n                        features. Essential cookies are required for the app to function properly.\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  <p className=\"text-gray-300\">\n                    We use cookies to provide essential functionality and optional analytics. Your\n                    data is stored locally on your device by default.\n                  </p>\n                  <div className=\"flex items-center gap-2 text-sm text-gray-400\">\n                    <Info size={14} />\n                    <span>You can customize cookie preferences or accept all cookies.</span>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* Footer Actions */}\n            <div className=\"flex items-center justify-between p-6 border-t border-gray-700 gap-4 bg-gray-900/50\">\n              <button\n                type=\"button\"\n                onClick={e => {\n                  e.preventDefault();\n                  (e as any).stopImmediatePropagation();\n                  e.stopPropagation();\n                  setShowDetails(!showDetails);\n                }}\n                onMouseDown={e => {\n                  e.preventDefault();\n                  (e as any).stopImmediatePropagation();\n                  e.stopPropagation();\n                }}\n                className=\"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm font-medium text-gray-200 transition-colors flex items-center gap-2\"\n                style={{\n                  pointerEvents: 'auto',\n                  cursor: 'pointer',\n                  zIndex: 10011,\n                  isolation: 'isolate',\n                }}\n              >\n                <Settings size={16} />\n                <span>{showDetails ? 'Hide Details' : 'Customize'}</span>\n              </button>\n\n              <div className=\"flex items-center gap-3\">\n                <button\n                  type=\"button\"\n                  onClick={e => {\n                    e.preventDefault();\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                    handleDecline();\n                  }}\n                  onMouseDown={e => {\n                    e.preventDefault();\n                    (e as any).stopImmediatePropagation();\n                    e.stopPropagation();\n                  }}\n                  className=\"px-6 py-2.5 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm font-medium text-gray-200 transition-colors\"\n                  style={{\n                    pointerEvents: 'auto',\n                    cursor: 'pointer',\n                    zIndex: 10011,\n                    isolation: 'isolate',\n                  }}\n                >\n                  Accept Essential Only\n                </button>\n                {showDetails ? (\n                  <button\n                    type=\"button\"\n                    onClick={e => {\n                      e.preventDefault();\n                      (e as any).stopImmediatePropagation();\n                      e.stopPropagation();\n                      handleAcceptSelected();\n                    }}\n                    onMouseDown={e => {\n                      e.preventDefault();\n                      (e as any).stopImmediatePropagation();\n                      e.stopPropagation();\n                    }}\n                    className=\"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium text-white transition-colors flex items-center gap-2\"\n                    style={{\n                      pointerEvents: 'auto',\n                      cursor: 'pointer',\n                      zIndex: 10011,\n                      isolation: 'isolate',\n                    }}\n                  >\n                    <Check size={16} />\n                    <span>Save Preferences</span>\n                  </button>\n                ) : (\n                  <button\n                    type=\"button\"\n                    onClick={e => {\n                      e.preventDefault();\n                      (e as any).stopImmediatePropagation();\n                      e.stopPropagation();\n                      handleAcceptAll();\n                    }}\n                    onMouseDown={e => {\n                      e.preventDefault();\n                      (e as any).stopImmediatePropagation();\n                      e.stopPropagation();\n                    }}\n                    className=\"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium text-white transition-colors flex items-center gap-2\"\n                    style={{\n                      pointerEvents: 'auto',\n                      cursor: 'pointer',\n                      zIndex: 10011,\n                      isolation: 'isolate',\n                    }}\n                  >\n                    <Check size={16} />\n                    <span>Accept All</span>\n                  </button>\n                )}\n              </div>\n            </div>\n          </motion.div>\n        </div>\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n\n/**\n * Hook to check if cookie consent has been given\n */\nexport function useCookieConsent(): {\n  hasConsented: boolean;\n  preferences: CookiePreferences | null;\n  showConsent: () => void;\n} {\n  const [hasConsented, setHasConsented] = useState(false);\n  const [preferences, setPreferences] = useState<CookiePreferences | null>(null);\n  const [_showBanner, setShowBanner] = useState(false);\n\n  useEffect(() => {\n    try {\n      const stored = localStorage.getItem('regen:cookie-consent');\n      if (stored) {\n        const data = JSON.parse(stored);\n        if (data.version === COOKIE_VERSION) {\n          setPreferences(data);\n          setHasConsented(true);\n          return;\n        }\n      }\n      // No consent given yet\n      setShowBanner(true);\n    } catch {\n      setShowBanner(true);\n    }\n  }, []);\n\n  const _handleAccept = (prefs: CookiePreferences) => {\n    localStorage.setItem('regen:cookie-consent', JSON.stringify(prefs));\n    setPreferences(prefs);\n    setHasConsented(true);\n    setShowBanner(false);\n  };\n\n  return {\n    hasConsented,\n    preferences,\n    showConsent: () => setShowBanner(true),\n  };\n}\n\n/**\n * Get current cookie preferences\n */\nexport function getCookiePreferences(): CookiePreferences | null {\n  try {\n    const stored = localStorage.getItem('regen:cookie-consent');\n    if (stored) {\n      const data = JSON.parse(stored);\n      if (data.version === COOKIE_VERSION) {\n        return data;\n      }\n    }\n  } catch {\n    // Invalid data\n  }\n  return null;\n}\n\n/**\n * Check if a specific cookie category is enabled\n */\nexport function isCookieCategoryEnabled(category: CookieCategory): boolean {\n  const prefs = getCookiePreferences();\n  if (!prefs) return category === 'essential'; // Default to essential only\n  return prefs[category] ?? false;\n}\n","import { create } from 'zustand';\n\ninterface OnboardingState {\n  visible: boolean;\n  start: () => void;\n  finish: () => void;\n  reset: () => void;\n}\n\nconst STORAGE_KEY = 'regen:onboarding:completed';\n\nexport const onboardingStorage = {\n  isCompleted(): boolean {\n    try {\n      return window.localStorage.getItem(STORAGE_KEY) === '1';\n    } catch {\n      return false;\n    }\n  },\n  setCompleted(): void {\n    try {\n      window.localStorage.setItem(STORAGE_KEY, '1');\n    } catch {\n      /* ignore */\n    }\n  },\n  clear(): void {\n    try {\n      window.localStorage.removeItem(STORAGE_KEY);\n    } catch {\n      /* ignore */\n    }\n  },\n};\n\nexport const useOnboardingStore = create<OnboardingState>(set => {\n  // Check if onboarding should be shown on first run\n  const shouldShowOnboarding = typeof window !== 'undefined' && !onboardingStorage.isCompleted();\n\n  return {\n    visible: shouldShowOnboarding,\n    start: () => {\n      if (process.env.NODE_ENV === 'development') {\n        console.debug('[OnboardingStore] start() called');\n      }\n      set({ visible: true });\n    },\n    finish: () => {\n      if (process.env.NODE_ENV === 'development') {\n        console.debug('[OnboardingStore] finish() called');\n      }\n      onboardingStorage.setCompleted();\n      set({ visible: false });\n      if (process.env.NODE_ENV === 'development') {\n        console.debug('[OnboardingStore] visible set to false');\n      }\n    },\n    reset: () => {\n      onboardingStorage.clear();\n      set({ visible: true });\n    },\n  };\n});\n\nif (typeof window !== 'undefined') {\n  (window as typeof window & { __STORE?: Record<string, unknown> }).__STORE = {\n    ...(window as typeof window & { __STORE?: Record<string, unknown> }).__STORE,\n    onboarding: useOnboardingStore,\n  };\n}\n","import { useEffect } from 'react';\nimport { useAppStore } from '../state/appStore';\nimport { useOnboardingStore } from '../state/onboardingStore';\nimport { toast } from '../utils/toast';\nimport { exportSessionToFile } from '../lib/session-transfer';\n\nfunction isCommandKey(event: KeyboardEvent): boolean {\n  if (typeof navigator === 'undefined') return event.ctrlKey;\n  const isMac = navigator.userAgent.includes('Mac');\n  return isMac ? event.metaKey : event.ctrlKey;\n}\n\nexport function useResearchHotkeys(): void {\n  const setMode = useAppStore(state => state.setMode);\n  const setResearchPaneOpen = useAppStore(state => state.setResearchPaneOpen);\n  const startOnboarding = useOnboardingStore(state => state.start);\n\n  useEffect(() => {\n    const handler = (event: KeyboardEvent) => {\n      if (!isCommandKey(event)) return;\n\n      const key = event.key.toLowerCase();\n\n      if (event.shiftKey && key === 'r') {\n        event.preventDefault();\n        setMode('Research');\n        setResearchPaneOpen(true);\n        toast.success('Research agent ready  type your prompt.');\n        return;\n      }\n\n      if (event.shiftKey && key === 's') {\n        event.preventDefault();\n        exportSessionToFile().catch(() => {});\n        return;\n      }\n\n      if (event.shiftKey && (key === '/' || key === '?')) {\n        event.preventDefault();\n        startOnboarding();\n        toast.info('Launching Research tour');\n      }\n    };\n\n    window.addEventListener('keydown', handler);\n    return () => window.removeEventListener('keydown', handler);\n  }, [setMode, setResearchPaneOpen, startOnboarding]);\n}\n","/**\n * ToastHost - Renders toast notifications using react-hot-toast\n * Provides better UX with animations, positioning, and loading states\n */\n\nimport { Toaster } from 'react-hot-toast';\n\nexport function ToastHost() {\n  return (\n    <Toaster\n      position=\"bottom-right\"\n      toastOptions={{\n        duration: 4000,\n        style: {\n          background: '#1e293b',\n          color: '#e2e8f0',\n          border: '1px solid #334155',\n          borderRadius: '0.75rem',\n          padding: '12px 16px',\n          fontSize: '14px',\n          maxWidth: '400px',\n        },\n        success: {\n          duration: 4000,\n          style: {\n            color: '#10b981',\n          },\n          iconTheme: {\n            primary: '#10b981',\n            secondary: '#1e293b',\n          },\n        },\n        error: {\n          duration: 5000,\n          style: {\n            color: '#ef4444',\n          },\n          iconTheme: {\n            primary: '#ef4444',\n            secondary: '#1e293b',\n          },\n        },\n        loading: {\n          duration: Infinity,\n          style: {\n            color: '#e2e8f0',\n          },\n        },\n      }}\n    />\n  );\n}\n","import { ipc } from './ipc-typed';\r\nimport { showToast } from '../state/toastStore';\r\nimport { useTabsStore, type ClosedTab } from '../state/tabsStore';\r\n\r\nconst ensureId = (result: any): string => {\r\n  if (result && typeof result === 'object' && 'id' in result) {\r\n    return String(result.id);\r\n  }\r\n  return typeof result === 'string' ? result : `tab-${Date.now()}`;\r\n};\r\n\r\nexport async function reopenClosedTab(entry?: ClosedTab) {\r\n  const tabsStore = useTabsStore.getState();\r\n  const target = entry ?? tabsStore.popRecentlyClosed();\r\n  if (!target) {\r\n    showToast('info', 'No recently closed tabs to reopen.');\r\n    return false;\r\n  }\r\n\r\n  if (entry) {\r\n    tabsStore.removeRecentlyClosed(entry.closedId);\r\n  }\r\n\r\n  try {\r\n    const result = await ipc.tabs.create({\r\n      url: target.url || 'about:blank',\r\n      containerId: target.containerId || undefined,\r\n    });\r\n    const newId = ensureId(result);\r\n\r\n    // Delay to allow main process to broadcast new tab details\r\n    setTimeout(() => {\r\n      const store = useTabsStore.getState();\r\n      store.updateTab(newId, {\r\n        appMode: target.appMode,\r\n        containerId: target.containerId,\r\n        containerName: target.containerName,\r\n        containerColor: target.containerColor,\r\n        mode: target.mode,\r\n        title: target.title || store.tabs.find((t) => t.id === newId)?.title,\r\n        url: target.url,\r\n      });\r\n      store.setActive(newId);\r\n    }, 75);\r\n\r\n    showToast('success', `Reopened ${target.title || target.url || 'tab'}`);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Failed to reopen closed tab:', error);\r\n    tabsStore.pushRecentlyClosed(target);\r\n    showToast('error', 'Failed to reopen closed tab.');\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function reopenMostRecentClosedTab() {\r\n  return reopenClosedTab();\r\n}\r\n\r\n","/**\n * Trade Alerts Cron Service\n * Runs every 30 seconds to generate AI trading alerts\n * Persists alerts to localStorage for crash recovery\n * Supports multilingual alerts based on user language preference\n */\n\nimport { log } from '../utils/logger';\nimport { aiEngine } from '../core/ai';\n// import type { AITaskResult } from '../core/ai'; // Reserved for future use\nimport { useSettingsStore } from '../state/settingsStore';\nimport { translateText } from '../core/offline/translator';\n// import { detectLanguage } from './languageDetection'; // Reserved for future use\n// import type { AISignal } from '../components/trade/AISignalPanel'; // Reserved for future use\n\nexport interface TradeAlert {\n  id: string;\n  symbol: string;\n  action: 'buy' | 'sell' | 'hold' | 'close';\n  confidence: number;\n  message: string;\n  price: number;\n  timestamp: number;\n  language: string;\n  expiresAt: number;\n  acknowledged: boolean;\n}\n\nconst ALERTS_STORAGE_KEY = 'regen_trade_alerts_v1';\nconst ALERT_INTERVAL_MS = 30000; // 30 seconds\nconst ALERT_EXPIRY_MS = 5 * 60 * 1000; // 5 minutes\n\nlet cronInterval: ReturnType<typeof setInterval> | null = null;\nlet isRunning = false;\nlet watchedSymbols: string[] = [];\nlet alertCallbacks: Array<(alert: TradeAlert) => void> = [];\n\n/**\n * Load alerts from localStorage\n */\nexport function loadAlerts(): TradeAlert[] {\n  try {\n    const stored = localStorage.getItem(ALERTS_STORAGE_KEY);\n    if (stored) {\n      const alerts = JSON.parse(stored) as TradeAlert[];\n      // Filter out expired alerts\n      const now = Date.now();\n      return alerts.filter(alert => alert.expiresAt > now);\n    }\n  } catch (error) {\n    log.warn('[TradeAlertsCron] Failed to load alerts from storage:', error);\n  }\n  return [];\n}\n\n/**\n * Save alerts to localStorage\n */\nexport function saveAlerts(alerts: TradeAlert[]): void {\n  try {\n    localStorage.setItem(ALERTS_STORAGE_KEY, JSON.stringify(alerts));\n  } catch (error) {\n    log.warn('[TradeAlertsCron] Failed to save alerts to storage:', error);\n  }\n}\n\n/**\n * Generate AI trading signal for a symbol\n */\nasync function generateAlertForSymbol(\n  symbol: string,\n  language: string\n): Promise<TradeAlert | null> {\n  try {\n    // Get current price (mock for now, should use real API)\n    const currentPrice = 150.0; // TODO: Get from real API\n\n    // Generate AI signal using the AI engine\n    const prompt = `Analyze ${symbol} stock. Provide a trading signal (buy/sell/hold) with confidence percentage and brief rationale. Format: ACTION|CONFIDENCE|RATIONALE`;\n\n    const result = await aiEngine.runTask({\n      kind: 'search',\n      prompt,\n      context: {\n        symbol,\n        currentPrice,\n        timeframe: '1h',\n      },\n      mode: 'trade',\n      llm: {\n        temperature: 0.3,\n        maxTokens: 200,\n      },\n    });\n\n    if (!result.text) {\n      return null;\n    }\n\n    // Parse AI response\n    const parts = result.text.split('|');\n    const action = (parts[0]?.toLowerCase().trim() || 'hold') as 'buy' | 'sell' | 'hold' | 'close';\n    const confidence = parseInt(parts[1]?.trim() || '50', 10);\n    const rationale = parts[2]?.trim() || result.text;\n\n    // Translate message to user's language if needed\n    let message = `${symbol}: ${action.toUpperCase()} signal (${confidence}% confidence). ${rationale}`;\n    if (language !== 'auto' && language !== 'en') {\n      try {\n        const translated = await translateText(message, language, 'en');\n        message = translated.text;\n      } catch (error) {\n        log.warn('[TradeAlertsCron] Translation failed, using English:', error);\n      }\n    }\n\n    const alert: TradeAlert = {\n      id: `alert-${symbol}-${Date.now()}`,\n      symbol,\n      action,\n      confidence,\n      message,\n      price: currentPrice,\n      timestamp: Date.now(),\n      language,\n      expiresAt: Date.now() + ALERT_EXPIRY_MS,\n      acknowledged: false,\n    };\n\n    return alert;\n  } catch (error) {\n    log.error(`[TradeAlertsCron] Failed to generate alert for ${symbol}:`, error);\n    return null;\n  }\n}\n\n/**\n * Process alerts for all watched symbols\n */\nasync function processAlerts(): Promise<void> {\n  if (watchedSymbols.length === 0) {\n    return;\n  }\n\n  const language = useSettingsStore.getState().language || 'auto';\n  const alerts: TradeAlert[] = [];\n\n  // Generate alerts for each watched symbol\n  for (const symbol of watchedSymbols) {\n    try {\n      const alert = await generateAlertForSymbol(symbol, language);\n      if (alert) {\n        alerts.push(alert);\n      }\n    } catch (error) {\n      log.warn(`[TradeAlertsCron] Failed to process alert for ${symbol}:`, error);\n    }\n  }\n\n  // Save new alerts\n  if (alerts.length > 0) {\n    const existingAlerts = loadAlerts();\n    const allAlerts = [...existingAlerts, ...alerts];\n    saveAlerts(allAlerts);\n\n    // Notify callbacks\n    for (const alert of alerts) {\n      for (const callback of alertCallbacks) {\n        try {\n          callback(alert);\n        } catch (error) {\n          log.warn('[TradeAlertsCron] Callback error:', error);\n        }\n      }\n    }\n\n    log.info(`[TradeAlertsCron] Generated ${alerts.length} new alerts`);\n  }\n}\n\n/**\n * Start the cron loop\n */\nexport function startTradeAlertsCron(symbols: string[]): void {\n  if (isRunning) {\n    stopTradeAlertsCron();\n  }\n\n  watchedSymbols = [...symbols];\n  isRunning = true;\n\n  // Process immediately\n  processAlerts().catch(error => {\n    log.error('[TradeAlertsCron] Initial alert processing failed:', error);\n  });\n\n  // Set up interval\n  cronInterval = setInterval(() => {\n    if (isRunning) {\n      processAlerts().catch(error => {\n        log.error('[TradeAlertsCron] Periodic alert processing failed:', error);\n      });\n    }\n  }, ALERT_INTERVAL_MS);\n\n  log.info(\n    `[TradeAlertsCron] Started with ${symbols.length} symbols, interval: ${ALERT_INTERVAL_MS}ms`\n  );\n}\n\n/**\n * Stop the cron loop\n */\nexport function stopTradeAlertsCron(): void {\n  if (cronInterval) {\n    clearInterval(cronInterval);\n    cronInterval = null;\n  }\n  isRunning = false;\n  log.info('[TradeAlertsCron] Stopped');\n}\n\n/**\n * Update watched symbols\n */\nexport function updateWatchedSymbols(symbols: string[]): void {\n  watchedSymbols = [...symbols];\n  log.debug(`[TradeAlertsCron] Updated watched symbols: ${symbols.join(', ')}`);\n}\n\n/**\n * Register callback for new alerts\n */\nexport function onAlert(callback: (alert: TradeAlert) => void): () => void {\n  alertCallbacks.push(callback);\n  return () => {\n    alertCallbacks = alertCallbacks.filter(cb => cb !== callback);\n  };\n}\n\n/**\n * Acknowledge an alert\n */\nexport function acknowledgeAlert(alertId: string): void {\n  const alerts = loadAlerts();\n  const updated = alerts.map(alert =>\n    alert.id === alertId ? { ...alert, acknowledged: true } : alert\n  );\n  saveAlerts(updated);\n}\n\n/**\n * Get unacknowledged alerts\n */\nexport function getUnacknowledgedAlerts(): TradeAlert[] {\n  const alerts = loadAlerts();\n  return alerts.filter(alert => !alert.acknowledged);\n}\n\n/**\n * Clear expired alerts\n */\nexport function clearExpiredAlerts(): void {\n  const alerts = loadAlerts();\n  const now = Date.now();\n  const active = alerts.filter(alert => alert.expiresAt > now);\n  saveAlerts(active);\n}\n\n/**\n * Initialize cron service (call on app start)\n */\nexport function initTradeAlertsCron(): void {\n  // Clear expired alerts on startup\n  clearExpiredAlerts();\n\n  // Auto-clear expired alerts every minute\n  setInterval(clearExpiredAlerts, 60000);\n\n  log.info('[TradeAlertsCron] Initialized');\n}\n","/**\n * Extensions API\n * Provides window.regenExtensions for Chrome-compatible extension registration\n * Preload hook for Chrome compatibility\n */\n\nimport { log } from '../../utils/logger';\nimport { pluginRegistry, type OmniPlugin } from '../plugins/registry';\n\nexport interface RegenExtension {\n  id: string;\n  name?: string;\n  version?: string;\n  activate?: () => void | Promise<void>;\n  deactivate?: () => void | Promise<void>;\n  provide?: Record<string, unknown>;\n}\n\nclass ExtensionsAPI {\n  private extensions: Map<string, RegenExtension> = new Map();\n\n  /**\n   * Register an extension\n   */\n  register(extension: RegenExtension): void {\n    if (this.extensions.has(extension.id)) {\n      log.warn(`[ExtensionsAPI] Extension ${extension.id} already registered`);\n      return;\n    }\n\n    this.extensions.set(extension.id, extension);\n\n    // Convert to plugin format and register with plugin registry\n    const plugin: OmniPlugin = {\n      id: extension.id,\n      name: extension.name || extension.id,\n      version: extension.version || '1.0.0',\n      description: `Extension: ${extension.name || extension.id}`,\n      enabled: true,\n      onEnable: extension.activate,\n      onDisable: extension.deactivate,\n    };\n\n    pluginRegistry.register(plugin);\n\n    log.info(`[ExtensionsAPI] Registered extension: ${extension.id}`);\n  }\n\n  /**\n   * List all registered extensions\n   */\n  list(): Array<{ id: string; name?: string; version?: string }> {\n    return Array.from(this.extensions.values()).map(ext => ({\n      id: ext.id,\n      name: ext.name,\n      version: ext.version,\n    }));\n  }\n\n  /**\n   * Get extension by ID\n   */\n  get(id: string): RegenExtension | undefined {\n    return this.extensions.get(id);\n  }\n\n  /**\n   * Activate an extension\n   */\n  async activate(id: string): Promise<boolean> {\n    const extension = this.extensions.get(id);\n    if (!extension) {\n      return false;\n    }\n\n    if (extension.activate) {\n      try {\n        await extension.activate();\n        log.info(`[ExtensionsAPI] Activated extension: ${id}`);\n        return true;\n      } catch (error) {\n        log.error(`[ExtensionsAPI] Failed to activate extension ${id}:`, error);\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Deactivate an extension\n   */\n  async deactivate(id: string): Promise<boolean> {\n    const extension = this.extensions.get(id);\n    if (!extension) {\n      return false;\n    }\n\n    if (extension.deactivate) {\n      try {\n        await extension.deactivate();\n        log.info(`[ExtensionsAPI] Deactivated extension: ${id}`);\n        return true;\n      } catch (error) {\n        log.error(`[ExtensionsAPI] Failed to deactivate extension ${id}:`, error);\n        return false;\n      }\n    }\n\n    return true;\n  }\n}\n\n// Singleton instance\nconst extensionsAPI = new ExtensionsAPI();\n\n/**\n * Initialize Extensions API on window object\n * Provides Chrome-compatible extension registration\n */\nexport function initExtensionsAPI(): void {\n  if (typeof window === 'undefined') {\n    return;\n  }\n\n  // Initialize window.regenExtensions if not already present\n  if (!window.regenExtensions) {\n    window.regenExtensions = {\n      register: (extension: RegenExtension) => {\n        extensionsAPI.register(extension);\n      },\n      list: () => {\n        return extensionsAPI.list();\n      },\n    };\n  }\n\n  // Preload hook for Chrome compatibility\n  // This allows extensions to register before the app fully loads\n  if (typeof (window as any).__regenExtensionsPreload === 'function') {\n    try {\n      (window as any).__regenExtensionsPreload(window.regenExtensions);\n    } catch (error) {\n      log.warn('[ExtensionsAPI] Preload hook failed:', error);\n    }\n  }\n\n  log.info('[ExtensionsAPI] Initialized window.regenExtensions');\n}\n\n/**\n * Preload hook for Chrome compatibility\n * Allows extensions to register early\n */\nexport function setupPreloadHook(): void {\n  if (typeof window === 'undefined') {\n    return;\n  }\n\n  // Create preload function that extensions can call\n  (window as any).__regenExtensionsPreload = (_api: typeof window.regenExtensions) => {\n    log.info('[ExtensionsAPI] Preload hook called');\n    // Extensions can use this to register before app initialization\n  };\n}\n","/**\n * Centralized error reporting hook\n * Provides consistent error handling and user feedback across the app\n */\n\nimport { useCallback } from 'react';\nimport { toast } from '../utils/toast';\n\nexport interface AppErrorOptions {\n  /** Show error to user via toast */\n  showToUser?: boolean;\n  /** Log to console */\n  logToConsole?: boolean;\n  /** Additional context for logging */\n  context?: Record<string, unknown>;\n  /** Fallback value to return */\n  fallback?: unknown;\n}\n\nexport function useAppError() {\n  const showError = useCallback(\n    (message: string, error?: unknown, options: AppErrorOptions = {}) => {\n      const { showToUser = true, logToConsole = true, context = {}, fallback = null } = options;\n\n      // Log to console with context\n      if (logToConsole) {\n        console.error('[App Error]', message, {\n          error,\n          ...context,\n          timestamp: new Date().toISOString(),\n        });\n      }\n\n      // Show user-friendly toast\n      if (showToUser) {\n        const userMessage =\n          typeof message === 'string' && message.length > 0\n            ? message\n            : 'An unexpected error occurred';\n        toast.error(userMessage);\n      }\n\n      return fallback;\n    },\n    []\n  );\n\n  const handleError = useCallback(\n    (error: unknown, context?: string, options: AppErrorOptions = {}) => {\n      const errorMessage =\n        error instanceof Error\n          ? error.message\n          : typeof error === 'string'\n            ? error\n            : 'Unknown error occurred';\n\n      const fullMessage = context ? `${context}: ${errorMessage}` : errorMessage;\n\n      return showError(fullMessage, error, options);\n    },\n    [showError]\n  );\n\n  const safeExecute = useCallback(\n    async <T>(fn: () => Promise<T>, fallback: T, context?: string): Promise<T> => {\n      try {\n        return await fn();\n      } catch (error) {\n        handleError(error, context, {\n          showToUser: false, // Don't spam user for background operations\n          logToConsole: true,\n          fallback,\n        });\n        return fallback;\n      }\n    },\n    [handleError]\n  );\n\n  return {\n    showError,\n    handleError,\n    safeExecute,\n  };\n}\n","/**\n * Loop Resume Modal\n * Shows crashed loops and offers to resume them\n */\n\nimport { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { X, AlertCircle, Play } from 'lucide-react';\nimport {\n  checkForCrashedLoops,\n  resumeLoop,\n  deleteLoopState,\n  type LoopState,\n} from '../../core/agents/loopResume';\nimport { toast } from 'react-hot-toast';\n\ninterface LoopResumeModalProps {\n  open: boolean;\n  onClose: () => void;\n}\n\nexport function LoopResumeModal({ open, onClose }: LoopResumeModalProps) {\n  const [crashedLoops, setCrashedLoops] = useState<LoopState[]>([]);\n  // const { setRun, setStatus } = useAgentStreamStore(); // Reserved for future use\n\n  useEffect(() => {\n    if (open) {\n      const loops = checkForCrashedLoops();\n      setCrashedLoops(loops);\n    }\n  }, [open]);\n\n  const handleResume = (loop: LoopState) => {\n    const success = resumeLoop(loop.runId);\n    if (success) {\n      toast.success(`Resumed loop: ${loop.goal.slice(0, 50)}...`);\n      onClose();\n    } else {\n      toast.error('Failed to resume loop');\n    }\n  };\n\n  const handleDelete = (runId: string) => {\n    deleteLoopState(runId);\n    setCrashedLoops(prev => prev.filter(l => l.runId !== runId));\n    toast.success('Deleted crashed loop');\n  };\n\n  if (!open) return null;\n\n  return (\n    <AnimatePresence>\n      <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n        {/* Backdrop */}\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          onClick={onClose}\n          className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\n        />\n\n        {/* Modal */}\n        <motion.div\n          initial={{ opacity: 0, scale: 0.95, y: 20 }}\n          animate={{ opacity: 1, scale: 1, y: 0 }}\n          exit={{ opacity: 0, scale: 0.95, y: 20 }}\n          className=\"relative bg-[#1A1D28] border border-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col\"\n        >\n          {/* Header */}\n          <div className=\"flex items-center justify-between p-4 border-b border-gray-800\">\n            <div className=\"flex items-center gap-2\">\n              <AlertCircle size={20} className=\"text-yellow-400\" />\n              <h2 className=\"text-lg font-semibold text-gray-100\">\n                Crashed Loops ({crashedLoops.length})\n              </h2>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"p-1.5 rounded-lg text-gray-400 hover:text-gray-100 hover:bg-gray-800/60 transition-colors\"\n            >\n              <X size={18} />\n            </button>\n          </div>\n\n          {/* Content */}\n          <div className=\"flex-1 overflow-y-auto p-4\">\n            {crashedLoops.length === 0 ? (\n              <div className=\"text-center py-8 text-gray-400\">\n                <p>No crashed loops found.</p>\n                <p className=\"text-sm mt-2\">All loops completed successfully.</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {crashedLoops.map(loop => (\n                  <div\n                    key={loop.runId}\n                    className=\"bg-gray-900/60 rounded-lg p-4 border border-gray-800/50\"\n                  >\n                    <div className=\"flex items-start justify-between gap-3\">\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                          <span className=\"text-xs font-medium text-gray-400\">\n                            {loop.runId.slice(0, 8)}...\n                          </span>\n                          <span\n                            className={`text-xs px-2 py-0.5 rounded ${\n                              loop.status === 'live'\n                                ? 'bg-green-900/30 text-green-400'\n                                : loop.status === 'error'\n                                  ? 'bg-red-900/30 text-red-400'\n                                  : 'bg-yellow-900/30 text-yellow-400'\n                            }`}\n                          >\n                            {loop.status}\n                          </span>\n                          {loop.mode && <span className=\"text-xs text-gray-500\">{loop.mode}</span>}\n                        </div>\n                        <h3 className=\"font-medium text-gray-200 mb-1 truncate\">\n                          {loop.goal || 'Untitled loop'}\n                        </h3>\n                        {loop.transcript && (\n                          <p className=\"text-xs text-gray-400 line-clamp-2 mb-2\">\n                            {loop.transcript.slice(0, 150)}...\n                          </p>\n                        )}\n                        <div className=\"text-xs text-gray-500\">\n                          {loop.events.length} events  Last saved{' '}\n                          {new Date(loop.lastSaved).toLocaleString()}\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <button\n                          onClick={() => handleResume(loop)}\n                          className=\"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium transition-colors flex items-center gap-1.5\"\n                        >\n                          <Play size={14} />\n                          Resume\n                        </button>\n                        <button\n                          onClick={() => handleDelete(loop.runId)}\n                          className=\"p-1.5 text-gray-400 hover:text-red-400 hover:bg-gray-800/60 rounded-lg transition-colors\"\n                          title=\"Delete\"\n                        >\n                          <X size={16} />\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {/* Footer */}\n          <div className=\"p-4 border-t border-gray-800 flex items-center justify-between\">\n            <p className=\"text-xs text-gray-400\">\n              Loops are auto-saved every 5 seconds. Resume to continue where you left off.\n            </p>\n            <button\n              onClick={onClose}\n              className=\"px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm font-medium transition-colors\"\n            >\n              Close\n            </button>\n          </div>\n        </motion.div>\n      </div>\n    </AnimatePresence>\n  );\n}\n","/**\n * n8n Workflow Marketplace\n * Browse, share, and install workflows\n */\n\nimport { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Search, Download, Share2, Star, Workflow, X } from 'lucide-react';\nimport { toast } from 'react-hot-toast';\nimport { handoffToN8n } from '../../core/agents/handoff';\n\nexport interface Workflow {\n  id: string;\n  name: string;\n  description: string;\n  author: string;\n  category: 'automation' | 'research' | 'trade' | 'productivity' | 'integration';\n  language?: string;\n  tags: string[];\n  downloads: number;\n  rating: number;\n  workflowUrl?: string;\n  workflowId?: string;\n  createdAt: number;\n  updatedAt: number;\n}\n\nconst SAMPLE_WORKFLOWS: Workflow[] = [\n  {\n    id: '1',\n    name: 'Research to Trade Alert',\n    description: 'Automatically sends trading alerts when research finds market opportunities',\n    author: 'RegenBrowser',\n    category: 'automation',\n    language: 'auto',\n    tags: ['research', 'trade', 'alerts'],\n    downloads: 1250,\n    rating: 4.8,\n    workflowId: 'research-trade-alert',\n    createdAt: Date.now() - 86400000,\n    updatedAt: Date.now() - 3600000,\n  },\n  {\n    id: '2',\n    name: 'Multilingual Research Summary',\n    description: 'Summarizes research in any language and sends to email/Slack',\n    author: 'Community',\n    category: 'research',\n    language: 'auto',\n    tags: ['research', 'multilingual', 'summary'],\n    downloads: 890,\n    rating: 4.6,\n    workflowId: 'multilingual-research',\n    createdAt: Date.now() - 172800000,\n    updatedAt: Date.now() - 7200000,\n  },\n  {\n    id: '3',\n    name: 'Nifty Monitor Loop',\n    description: 'Monitors Nifty index every 30s and alerts on significant changes',\n    author: 'RegenBrowser',\n    category: 'trade',\n    language: 'hi',\n    tags: ['nifty', 'monitoring', 'alerts'],\n    downloads: 2100,\n    rating: 4.9,\n    workflowId: 'nifty-monitor',\n    createdAt: Date.now() - 259200000,\n    updatedAt: Date.now() - 1800000,\n  },\n];\n\ninterface WorkflowMarketplaceProps {\n  open: boolean;\n  onClose: () => void;\n}\n\nexport function WorkflowMarketplace({ open, onClose }: WorkflowMarketplaceProps) {\n  const [workflows] = useState<Workflow[]>(SAMPLE_WORKFLOWS);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [selectedCategory, setSelectedCategory] = useState<string>('all');\n  const [selectedLanguage, setSelectedLanguage] = useState<string>('all');\n  const [loading, setLoading] = useState(false);\n\n  const filteredWorkflows = workflows.filter(workflow => {\n    const matchesSearch =\n      !searchQuery ||\n      workflow.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      workflow.description.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      workflow.tags.some(tag => tag.toLowerCase().includes(searchQuery.toLowerCase()));\n\n    const matchesCategory = selectedCategory === 'all' || workflow.category === selectedCategory;\n    const matchesLanguage =\n      selectedLanguage === 'all' || workflow.language === selectedLanguage || !workflow.language;\n\n    return matchesSearch && matchesCategory && matchesLanguage;\n  });\n\n  const handleInstall = async (workflow: Workflow) => {\n    setLoading(true);\n    try {\n      if (workflow.workflowId) {\n        // Use handoffToN8n to trigger workflow (now supports loops)\n        const result = await handoffToN8n(\n          {\n            type: 'install-workflow',\n            data: {\n              workflowId: workflow.workflowId,\n              workflowUrl: workflow.workflowUrl || 'http://localhost:5678',\n            },\n            sourceMode: 'marketplace',\n            targetMode: 'n8n',\n          },\n          workflow.language || 'auto'\n        );\n\n        if (result.success) {\n          toast.success(`Installed workflow: ${workflow.name}`);\n        } else {\n          toast.error(result.error || 'Failed to install workflow');\n        }\n      } else {\n        toast.error('Workflow ID not available');\n      }\n    } catch (error: any) {\n      toast.error(`Installation failed: ${error.message}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const categories = [\n    { value: 'all', label: 'All Categories' },\n    { value: 'automation', label: 'Automation' },\n    { value: 'research', label: 'Research' },\n    { value: 'trade', label: 'Trade' },\n    { value: 'productivity', label: 'Productivity' },\n    { value: 'integration', label: 'Integration' },\n  ];\n\n  if (!open) return null;\n\n  return (\n    <AnimatePresence>\n      <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n        {/* Backdrop */}\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          onClick={onClose}\n          className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\n        />\n\n        {/* Modal */}\n        <motion.div\n          initial={{ opacity: 0, scale: 0.95, y: 20 }}\n          animate={{ opacity: 1, scale: 1, y: 0 }}\n          exit={{ opacity: 0, scale: 0.95, y: 20 }}\n          className=\"relative bg-[#1A1D28] border border-gray-800 rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col\"\n        >\n          {/* Header */}\n          <div className=\"flex items-center justify-between p-4 border-b border-gray-800\">\n            <div className=\"flex items-center gap-3\">\n              <Workflow size={24} className=\"text-blue-400\" />\n              <div>\n                <h2 className=\"text-xl font-semibold text-gray-100\">Workflow Marketplace</h2>\n                <p className=\"text-sm text-gray-400\">Browse and install n8n workflows</p>\n              </div>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"p-1.5 rounded-lg text-gray-400 hover:text-gray-100 hover:bg-gray-800/60 transition-colors\"\n            >\n              <X size={20} />\n            </button>\n          </div>\n\n          {/* Search and Filters */}\n          <div className=\"p-4 border-b border-gray-800 space-y-3\">\n            <div className=\"relative\">\n              <Search\n                size={18}\n                className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400\"\n              />\n              <input\n                type=\"text\"\n                value={searchQuery}\n                onChange={e => setSearchQuery(e.target.value)}\n                placeholder=\"Search workflows...\"\n                className=\"w-full pl-10 pr-4 py-2 bg-gray-900/60 border border-gray-700/50 rounded-lg text-sm text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50\"\n              />\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <select\n                value={selectedCategory}\n                onChange={e => setSelectedCategory(e.target.value)}\n                className=\"px-3 py-1.5 bg-gray-900/60 border border-gray-700/50 rounded-lg text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50\"\n              >\n                {categories.map(cat => (\n                  <option key={cat.value} value={cat.value}>\n                    {cat.label}\n                  </option>\n                ))}\n              </select>\n              <select\n                value={selectedLanguage}\n                onChange={e => setSelectedLanguage(e.target.value)}\n                className=\"px-3 py-1.5 bg-gray-900/60 border border-gray-700/50 rounded-lg text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50\"\n              >\n                <option value=\"all\">All Languages</option>\n                <option value=\"auto\">Auto-detect</option>\n                <option value=\"en\">English</option>\n                <option value=\"hi\">Hindi</option>\n                <option value=\"ta\">Tamil</option>\n                <option value=\"bn\">Bengali</option>\n              </select>\n            </div>\n          </div>\n\n          {/* Workflows List */}\n          <div className=\"flex-1 overflow-y-auto p-4\">\n            {filteredWorkflows.length === 0 ? (\n              <div className=\"text-center py-12 text-gray-400\">\n                <p>No workflows found.</p>\n                <p className=\"text-sm mt-2\">Try adjusting your search or filters.</p>\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {filteredWorkflows.map(workflow => (\n                  <motion.div\n                    key={workflow.id}\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    className=\"bg-gray-900/60 rounded-lg p-4 border border-gray-800/50 hover:border-gray-700/50 transition-colors\"\n                  >\n                    <div className=\"flex items-start justify-between mb-2\">\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-semibold text-gray-100 mb-1\">{workflow.name}</h3>\n                        <p className=\"text-sm text-gray-400 line-clamp-2\">{workflow.description}</p>\n                      </div>\n                      <div className=\"flex items-center gap-1 text-yellow-400 ml-2\">\n                        <Star size={14} className=\"fill-current\" />\n                        <span className=\"text-xs\">{workflow.rating}</span>\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center gap-2 mb-3\">\n                      <span className=\"text-xs px-2 py-0.5 bg-blue-900/30 text-blue-400 rounded\">\n                        {workflow.category}\n                      </span>\n                      {workflow.language && (\n                        <span className=\"text-xs px-2 py-0.5 bg-green-900/30 text-green-400 rounded\">\n                          {workflow.language}\n                        </span>\n                      )}\n                      <span className=\"text-xs text-gray-500\">{workflow.downloads} downloads</span>\n                    </div>\n\n                    <div className=\"flex items-center gap-2\">\n                      <button\n                        onClick={() => handleInstall(workflow)}\n                        disabled={loading}\n                        className=\"flex-1 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-700 disabled:cursor-not-allowed rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1.5\"\n                      >\n                        <Download size={14} />\n                        Install\n                      </button>\n                      <button\n                        onClick={() => {\n                          // Share workflow - open GitHub repo or copy link\n                          const shareUrl = `https://github.com/regenbrowser/workflows/tree/main/${workflow.workflowId || workflow.id}`;\n                          if (navigator.share) {\n                            navigator\n                              .share({\n                                title: `Share ${workflow.name}`,\n                                text: workflow.description,\n                                url: shareUrl,\n                              })\n                              .catch(() => {\n                                // Fallback to copy\n                                navigator.clipboard.writeText(shareUrl);\n                                toast.success('Workflow link copied to clipboard!');\n                              });\n                          } else {\n                            // Copy to clipboard\n                            navigator.clipboard.writeText(shareUrl);\n                            toast.success('Workflow link copied to clipboard!');\n                          }\n                        }}\n                        className=\"px-3 py-1.5 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm transition-colors\"\n                        title=\"Share workflow (Earn affiliates)\"\n                      >\n                        <Share2 size={14} />\n                      </button>\n                    </div>\n                  </motion.div>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {/* Footer */}\n          <div className=\"p-4 border-t border-gray-800 flex items-center justify-between\">\n            <div className=\"flex flex-col gap-1\">\n              <p className=\"text-xs text-gray-400\">\n                Workflows run on your local n8n instance. Install n8n to use workflows.\n              </p>\n              <p className=\"text-xs text-gray-500\">\n                Share n8n workflows  Earn affiliates{' '}\n                <a\n                  href=\"https://github.com/regenbrowser/workflows\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  className=\"text-blue-400 hover:text-blue-300 underline\"\n                >\n                  GitHub repo\n                </a>\n              </p>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm font-medium transition-colors\"\n            >\n              Close\n            </button>\n          </div>\n        </motion.div>\n      </div>\n    </AnimatePresence>\n  );\n}\n","import { motion } from 'framer-motion';\r\nimport { Bot, FlaskConical, Globe, Library, LineChart } from 'lucide-react';\r\nimport type { AppState } from '../../state/appStore';\r\n\r\ntype ModeId = AppState['mode'];\r\n\r\ninterface MobileDockProps {\r\n  activeMode: ModeId;\r\n  onSelectMode: (mode: ModeId) => void;\r\n  onOpenLibrary: () => void;\r\n  onOpenAgent: () => void;\r\n}\r\n\r\nconst navItems: Array<{\r\n  id: ModeId;\r\n  label: string;\r\n  icon: React.ComponentType<{ size?: number | string }>;\r\n}> = [\r\n  { id: 'Browse', label: 'Browse', icon: Globe },\r\n  { id: 'Research', label: 'Research', icon: FlaskConical },\r\n  { id: 'Trade', label: 'Trade', icon: LineChart },\r\n];\r\n\r\nexport function MobileDock({\r\n  activeMode,\r\n  onSelectMode,\r\n  onOpenLibrary,\r\n  onOpenAgent,\r\n}: MobileDockProps) {\r\n  return (\r\n    <motion.nav\r\n      initial={{ y: 120, opacity: 0 }}\r\n      animate={{ y: 0, opacity: 1 }}\r\n      exit={{ y: 120, opacity: 0 }}\r\n      transition={{ type: 'spring', stiffness: 260, damping: 30 }}\r\n      className=\"fixed inset-x-0 bottom-0 z-[65] px-4 pb-[calc(env(safe-area-inset-bottom)+16px)] pt-3\"\r\n    >\r\n      <div className=\"flex items-center justify-between rounded-2xl border border-slate-800/70 bg-slate-950/95 p-2 shadow-2xl shadow-black/40 backdrop-blur-xl\">\r\n        {navItems.map(item => {\r\n          const Icon = item.icon;\r\n          const isActive = item.id === activeMode;\r\n          return (\r\n            <button\r\n              key={item.id}\r\n              type=\"button\"\r\n              onClick={() => onSelectMode(item.id)}\r\n              className={`flex flex-1 flex-col items-center gap-1 rounded-xl px-2 py-1 text-[11px] font-semibold transition ${\r\n                isActive\r\n                  ? 'bg-emerald-500/10 text-emerald-300'\r\n                  : 'text-slate-400 hover:text-slate-100'\r\n              }`}\r\n              aria-pressed={isActive}\r\n            >\r\n              <Icon size={20} />\r\n              <span>{item.label}</span>\r\n            </button>\r\n          );\r\n        })}\r\n\r\n        <button\r\n          type=\"button\"\r\n          onClick={onOpenLibrary}\r\n          className=\"flex flex-col items-center gap-1 rounded-xl px-2 py-1 text-[11px] font-semibold text-slate-400 transition hover:text-slate-100\"\r\n        >\r\n          <Library size={20} />\r\n          <span>Library</span>\r\n        </button>\r\n\r\n        <button\r\n          type=\"button\"\r\n          onClick={onOpenAgent}\r\n          className=\"flex flex-col items-center gap-1 rounded-xl px-2 py-1 text-[11px] font-semibold text-slate-400 transition hover:text-slate-100\"\r\n        >\r\n          <Bot size={20} />\r\n          <span>Agent</span>\r\n        </button>\r\n      </div>\r\n    </motion.nav>\r\n  );\r\n}\r\n","/**\n * Ollama Auto-Installer\n * Downloads, installs Ollama, and pulls required models automatically\n * Works on Windows, macOS, and Linux\n */\n\nimport { toast } from '../../utils/toast';\n\nexport interface InstallProgress {\n  stage: 'checking' | 'downloading' | 'installing' | 'pulling_models' | 'complete' | 'error';\n  progress: number; // 0-100\n  message: string;\n  modelProgress?: {\n    model: string;\n    progress: number;\n  };\n}\n\ntype ProgressCallback = (progress: InstallProgress) => void;\n\nconst OLLAMA_URLS = {\n  windows: 'https://ollama.com/download/windows',\n  macos: 'https://ollama.com/download/mac',\n  linux: 'https://ollama.com/download/linux',\n};\n\nconst REQUIRED_MODELS = ['phi3:mini', 'llava:7b'];\n\n/**\n * Check if Ollama is already installed\n */\nexport async function checkOllamaInstalled(): Promise<boolean> {\n  try {\n    // Try to run 'ollama --version' or check if ollama command exists\n    if (typeof window !== 'undefined' && (window as any).ipc) {\n      const ipc = (window as any).ipc;\n      if (ipc.system && typeof ipc.system.checkCommand === 'function') {\n        const result = await ipc.system.checkCommand('ollama');\n        return result?.installed === true;\n      }\n    }\n\n    // Fallback: Check if Ollama service is running\n    try {\n      const response = await fetch('http://localhost:11434/api/tags', { method: 'GET' });\n      return response.ok;\n    } catch {\n      return false;\n    }\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Check which models are already installed\n */\nexport async function checkInstalledModels(): Promise<string[]> {\n  try {\n    const response = await fetch('http://localhost:11434/api/tags');\n    if (!response.ok) return [];\n\n    const data = await response.json();\n    return (data.models || []).map((m: any) => m.name);\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get platform-specific Ollama download URL\n */\nfunction getOllamaDownloadUrl(): string {\n  const platform = navigator.platform.toLowerCase();\n  if (platform.includes('win')) return OLLAMA_URLS.windows;\n  if (platform.includes('mac')) return OLLAMA_URLS.macos;\n  return OLLAMA_URLS.linux;\n}\n\n/**\n * Download Ollama installer\n */\nasync function downloadOllamaInstaller(onProgress: ProgressCallback): Promise<string> {\n  const url = getOllamaDownloadUrl();\n  onProgress({\n    stage: 'downloading',\n    progress: 0,\n    message: 'Downloading Ollama installer...',\n  });\n\n  try {\n    // Use IPC to download if available (for Electron/Tauri)\n    if (typeof window !== 'undefined' && (window as any).ipc) {\n      const ipc = (window as any).ipc;\n      if (ipc.system && typeof ipc.system.downloadFile === 'function') {\n        const result = await ipc.system.downloadFile(url, {\n          onProgress: (progress: number) => {\n            onProgress({\n              stage: 'downloading',\n              progress,\n              message: `Downloading Ollama... ${Math.round(progress)}%`,\n            });\n          },\n        });\n        return result?.path || '';\n      }\n    }\n\n    // Fallback: Direct download (will need to handle differently)\n    const response = await fetch(url);\n    if (!response.ok) throw new Error('Failed to download Ollama');\n\n    // For browser, we'll need to trigger download\n    const blob = await response.blob();\n    const downloadUrl = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = downloadUrl;\n    a.download = 'ollama-installer';\n    a.click();\n\n    onProgress({\n      stage: 'downloading',\n      progress: 100,\n      message: 'Download complete. Please run the installer.',\n    });\n\n    return downloadUrl;\n  } catch (error) {\n    console.error('[Installer] Download failed:', error);\n    throw error;\n  }\n}\n\n/**\n * Install Ollama (platform-specific)\n */\nasync function installOllama(installerPath: string, onProgress: ProgressCallback): Promise<void> {\n  onProgress({\n    stage: 'installing',\n    progress: 0,\n    message: 'Installing Ollama...',\n  });\n\n  try {\n    // Use IPC to run installer if available\n    if (typeof window !== 'undefined' && (window as any).ipc) {\n      const ipc = (window as any).ipc;\n      if (ipc.system && typeof ipc.system.runInstaller === 'function') {\n        await ipc.system.runInstaller(installerPath, {\n          silent: true,\n          onProgress: (progress: number) => {\n            onProgress({\n              stage: 'installing',\n              progress,\n              message: `Installing Ollama... ${Math.round(progress)}%`,\n            });\n          },\n        });\n        return;\n      }\n    }\n\n    // Fallback: Open installer (user must click through)\n    onProgress({\n      stage: 'installing',\n      progress: 50,\n      message: 'Please complete the Ollama installation in the opened window...',\n    });\n\n    // For browser, we can't auto-install, so we guide the user\n    toast.info('Please complete the Ollama installation, then return here.');\n  } catch (error) {\n    console.error('[Installer] Installation failed:', error);\n    throw error;\n  }\n}\n\n/**\n * Pull a model with progress tracking\n */\nasync function pullModel(model: string, onProgress: ProgressCallback): Promise<void> {\n  onProgress({\n    stage: 'pulling_models',\n    progress: 0,\n    message: `Downloading ${model}...`,\n    modelProgress: { model, progress: 0 },\n  });\n\n  try {\n    const response = await fetch('http://localhost:11434/api/pull', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ name: model, stream: true }),\n    });\n\n    if (!response.ok) throw new Error(`Failed to pull ${model}`);\n\n    const reader = response.body?.getReader();\n    const decoder = new TextDecoder();\n\n    if (!reader) throw new Error('No response body');\n\n    let buffer = '';\n    while (true) {\n      const { done, value } = await reader.read();\n      if (done) break;\n\n      buffer += decoder.decode(value, { stream: true });\n      const lines = buffer.split('\\n');\n      buffer = lines.pop() || '';\n\n      for (const line of lines) {\n        if (!line.trim()) continue;\n        try {\n          const data = JSON.parse(line);\n          if (data.completed) {\n            onProgress({\n              stage: 'pulling_models',\n              progress: 100,\n              message: `${model} downloaded successfully`,\n              modelProgress: { model, progress: 100 },\n            });\n            break;\n          }\n          if (data.total && data.completed !== undefined) {\n            const progress = (data.completed / data.total) * 100;\n            onProgress({\n              stage: 'pulling_models',\n              progress: (progress / REQUIRED_MODELS.length) * 100,\n              message: `Downloading ${model}... ${Math.round(progress)}%`,\n              modelProgress: { model, progress },\n            });\n          }\n        } catch {\n          // Skip invalid JSON\n        }\n      }\n    }\n  } catch (error) {\n    console.error(`[Installer] Failed to pull ${model}:`, error);\n    throw error;\n  }\n}\n\n/**\n * Full installation workflow\n */\nexport async function installOllamaAndModels(onProgress: ProgressCallback): Promise<void> {\n  try {\n    // Step 1: Check if already installed\n    onProgress({\n      stage: 'checking',\n      progress: 0,\n      message: 'Checking Ollama installation...',\n    });\n\n    const isInstalled = await checkOllamaInstalled();\n    if (isInstalled) {\n      onProgress({\n        stage: 'pulling_models',\n        progress: 0,\n        message: 'Ollama already installed. Checking models...',\n      });\n    } else {\n      // Step 2: Download installer\n      const installerPath = await downloadOllamaInstaller(onProgress);\n\n      // Step 3: Install Ollama\n      await installOllama(installerPath, onProgress);\n\n      // Step 4: Wait for Ollama to be ready\n      onProgress({\n        stage: 'checking',\n        progress: 90,\n        message: 'Waiting for Ollama to start...',\n      });\n\n      // Poll until Ollama is ready\n      let retries = 30;\n      while (retries > 0) {\n        if (await checkOllamaInstalled()) {\n          break;\n        }\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        retries--;\n      }\n\n      if (retries === 0) {\n        throw new Error('Ollama did not start. Please restart the app.');\n      }\n    }\n\n    // Step 5: Check and pull required models\n    const installedModels = await checkInstalledModels();\n    const modelsToPull = REQUIRED_MODELS.filter(m => !installedModels.includes(m));\n\n    if (modelsToPull.length === 0) {\n      onProgress({\n        stage: 'complete',\n        progress: 100,\n        message: 'All models already installed!',\n      });\n      return;\n    }\n\n    // Pull each model\n    for (let i = 0; i < modelsToPull.length; i++) {\n      const model = modelsToPull[i];\n      await pullModel(model, onProgress);\n    }\n\n    onProgress({\n      stage: 'complete',\n      progress: 100,\n      message: 'Installation complete! Your AI brain is ready.',\n    });\n  } catch (error) {\n    console.error('[Installer] Installation failed:', error);\n    onProgress({\n      stage: 'error',\n      progress: 0,\n      message: `Installation failed: ${error instanceof Error ? error.message : 'Unknown error'}`,\n    });\n    throw error;\n  }\n}\n","/**\n * Beautiful Install Progress Modal\n * Shows \"Downloading your AI brain...\" with sexy progress bar\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Sparkles, CheckCircle2, AlertCircle, Loader2 } from 'lucide-react';\nimport { installOllamaAndModels, type InstallProgress } from '../../core/installer/ollamaInstaller';\n\ninterface Props {\n  onComplete: () => void;\n  onError: (error: Error) => void;\n}\n\nexport function InstallProgressModal({ onComplete, onError }: Props) {\n  const [progress, setProgress] = useState<InstallProgress>({\n    stage: 'checking',\n    progress: 0,\n    message: 'Initializing...',\n  });\n  const [_isInstalling, setIsInstalling] = useState(true);\n\n  useEffect(() => {\n    let cancelled = false;\n\n    const startInstallation = async () => {\n      try {\n        await installOllamaAndModels(prog => {\n          if (cancelled) return;\n          setProgress(prog);\n\n          if (prog.stage === 'complete') {\n            setIsInstalling(false);\n            setTimeout(() => {\n              onComplete();\n            }, 2000);\n          } else if (prog.stage === 'error') {\n            setIsInstalling(false);\n            onError(new Error(prog.message));\n          }\n        });\n      } catch (error) {\n        if (!cancelled) {\n          setIsInstalling(false);\n          onError(error instanceof Error ? error : new Error('Installation failed'));\n        }\n      }\n    };\n\n    startInstallation();\n\n    return () => {\n      cancelled = true;\n    };\n  }, [onComplete, onError]);\n\n  const getStageIcon = () => {\n    switch (progress.stage) {\n      case 'complete':\n        return <CheckCircle2 className=\"w-16 h-16 text-emerald-400\" />;\n      case 'error':\n        return <AlertCircle className=\"w-16 h-16 text-red-400\" />;\n      default:\n        return <Loader2 className=\"w-16 h-16 text-purple-400 animate-spin\" />;\n    }\n  };\n\n  const getStageColor = () => {\n    switch (progress.stage) {\n      case 'complete':\n        return 'from-emerald-500 to-teal-600';\n      case 'error':\n        return 'from-red-500 to-rose-600';\n      default:\n        return 'from-purple-500 to-pink-600';\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-[9999] flex items-center justify-center bg-black/90 backdrop-blur-sm\">\n      <motion.div\n        initial={{ opacity: 0, scale: 0.9 }}\n        animate={{ opacity: 1, scale: 1 }}\n        className=\"bg-slate-900 border border-purple-600/50 rounded-3xl p-12 max-w-2xl w-full mx-4 shadow-2xl\"\n      >\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <div className=\"flex justify-center mb-4\">{getStageIcon()}</div>\n          <h2 className=\"text-3xl font-bold text-white mb-2\">\n            {progress.stage === 'complete'\n              ? 'Your AI Brain is Ready! '\n              : progress.stage === 'error'\n                ? 'Installation Failed'\n                : 'Downloading Your AI Brain...'}\n          </h2>\n          <p className=\"text-gray-400 text-lg\">{progress.message}</p>\n        </div>\n\n        {/* Progress Bar */}\n        <div className=\"mb-6\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <span className=\"text-sm text-gray-400\">\n              {progress.stage === 'pulling_models' && progress.modelProgress\n                ? `${progress.modelProgress.model}: ${Math.round(progress.modelProgress.progress)}%`\n                : `${Math.round(progress.progress)}%`}\n            </span>\n            <span className=\"text-sm text-gray-400\">\n              {progress.stage === 'checking' && 'Step 1/4'}\n              {progress.stage === 'downloading' && 'Step 2/4'}\n              {progress.stage === 'installing' && 'Step 3/4'}\n              {progress.stage === 'pulling_models' && 'Step 4/4'}\n              {progress.stage === 'complete' && 'Complete!'}\n            </span>\n          </div>\n          <div className=\"h-4 bg-slate-800 rounded-full overflow-hidden\">\n            <motion.div\n              className={`h-full bg-gradient-to-r ${getStageColor()} shadow-lg`}\n              initial={{ width: 0 }}\n              animate={{ width: `${progress.progress}%` }}\n              transition={{ duration: 0.3, ease: 'easeOut' }}\n            />\n          </div>\n        </div>\n\n        {/* Stage Details */}\n        <AnimatePresence mode=\"wait\">\n          <motion.div\n            key={progress.stage}\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: -10 }}\n            className=\"space-y-2\"\n          >\n            {progress.stage === 'checking' && (\n              <div className=\"text-center text-gray-300\">\n                <p className=\"text-sm\">Checking if Ollama is installed...</p>\n              </div>\n            )}\n\n            {progress.stage === 'downloading' && (\n              <div className=\"text-center text-gray-300\">\n                <p className=\"text-sm\">Downloading Ollama installer...</p>\n                <p className=\"text-xs text-gray-500 mt-1\">This may take a few minutes</p>\n              </div>\n            )}\n\n            {progress.stage === 'installing' && (\n              <div className=\"text-center text-gray-300\">\n                <p className=\"text-sm\">Installing Ollama...</p>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  Please wait while we set up your AI engine\n                </p>\n              </div>\n            )}\n\n            {progress.stage === 'pulling_models' && progress.modelProgress && (\n              <div className=\"text-center text-gray-300\">\n                <p className=\"text-sm font-medium\">{progress.modelProgress.model}</p>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  {progress.modelProgress.progress < 100\n                    ? 'Downloading model weights...'\n                    : 'Model ready!'}\n                </p>\n              </div>\n            )}\n\n            {progress.stage === 'complete' && (\n              <motion.div\n                initial={{ opacity: 0, scale: 0.9 }}\n                animate={{ opacity: 1, scale: 1 }}\n                className=\"text-center\"\n              >\n                <div className=\"flex items-center justify-center gap-2 text-emerald-400 mb-4\">\n                  <Sparkles className=\"w-5 h-5\" />\n                  <p className=\"text-lg font-semibold\">All set! Starting Regen...</p>\n                </div>\n              </motion.div>\n            )}\n\n            {progress.stage === 'error' && (\n              <div className=\"text-center text-red-400\">\n                <p className=\"text-sm\">{progress.message}</p>\n                <p className=\"text-xs text-gray-500 mt-2\">\n                  You can try installing Ollama manually from ollama.com\n                </p>\n              </div>\n            )}\n          </motion.div>\n        </AnimatePresence>\n\n        {/* Model List */}\n        {progress.stage === 'pulling_models' && (\n          <div className=\"mt-6 space-y-2\">\n            <p className=\"text-xs text-gray-500 uppercase tracking-wide mb-2\">Models</p>\n            {['phi3:mini', 'llava:7b'].map(model => {\n              const isComplete =\n                progress.modelProgress?.model === model && progress.modelProgress.progress === 100;\n              const isActive = progress.modelProgress?.model === model;\n              return (\n                <div\n                  key={model}\n                  className={`flex items-center gap-3 p-2 rounded-lg ${\n                    isActive ? 'bg-purple-500/20 border border-purple-500/50' : 'bg-slate-800/50'\n                  }`}\n                >\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm text-gray-300\">{model}</p>\n                  </div>\n                  {isComplete && <CheckCircle2 className=\"w-4 h-4 text-emerald-400\" />}\n                  {isActive && !isComplete && (\n                    <Loader2 className=\"w-4 h-4 text-purple-400 animate-spin\" />\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </motion.div>\n    </div>\n  );\n}\n","import { create } from 'zustand';\r\nimport { ipc } from '../lib/ipc-typed';\r\nimport type { ConsentRecord, ConsentActionType } from '../types/consent';\r\n\r\ninterface ConsentOverlayState {\r\n  visible: boolean;\r\n  loading: boolean;\r\n  error: string | null;\r\n  filter: {\r\n    type?: ConsentActionType | 'all';\r\n    status?: 'all' | 'pending' | 'approved' | 'revoked';\r\n  };\r\n  records: ConsentRecord[];\r\n  open: () => Promise<void>;\r\n  close: () => void;\r\n  toggle: () => Promise<void>;\r\n  refresh: () => Promise<void>;\r\n  setFilter: (filter: Partial<ConsentOverlayState['filter']>) => Promise<void>;\r\n  approve: (consentId: string) => Promise<void>;\r\n  revoke: (consentId: string) => Promise<void>;\r\n}\r\n\r\nasync function fetchRecords(filter: ConsentOverlayState['filter']): Promise<ConsentRecord[]> {\r\n  const payload: { type?: ConsentActionType; approved?: boolean } = {};\r\n  if (filter.type && filter.type !== 'all') {\r\n    payload.type = filter.type;\r\n  }\r\n  if (filter.status && filter.status !== 'all') {\r\n    if (filter.status === 'pending') {\r\n      payload.approved = false;\r\n    } else if (filter.status === 'approved' || filter.status === 'revoked') {\r\n      payload.approved = true;\r\n    }\r\n  }\r\n  const list = await ipc.consent.list(Object.keys(payload).length > 0 ? payload : undefined);\r\n  if (!Array.isArray(list)) {\r\n    return [];\r\n  }\r\n  let filtered = list;\r\n  if (filter.status === 'pending') {\r\n    filtered = filtered.filter((record) => !record.approved);\r\n  } else if (filter.status === 'approved') {\r\n    filtered = filtered.filter((record) => record.approved && !record.revokedAt);\r\n  } else if (filter.status === 'revoked') {\r\n    filtered = filtered.filter((record) => Boolean(record.revokedAt));\r\n  }\r\n  return filtered.sort((a, b) => b.timestamp - a.timestamp);\r\n}\r\n\r\nexport const useConsentOverlayStore = create<ConsentOverlayState>((set, get) => ({\r\n  visible: false,\r\n  loading: false,\r\n  error: null,\r\n  filter: { type: 'all', status: 'all' },\r\n  records: [],\r\n  async open() {\r\n    if (!get().visible) {\r\n      set({ visible: true });\r\n    }\r\n    await get().refresh();\r\n  },\r\n  close() {\r\n    set({ visible: false });\r\n  },\r\n  async toggle() {\r\n    if (get().visible) {\r\n      set({ visible: false });\r\n    } else {\r\n      set({ visible: true });\r\n      await get().refresh();\r\n    }\r\n  },\r\n  async refresh() {\r\n    set({ loading: true, error: null });\r\n    try {\r\n      const records = await fetchRecords(get().filter);\r\n      set({ records, loading: false, error: null });\r\n    } catch (error) {\r\n      set({\r\n        loading: false,\r\n        error: error instanceof Error ? error.message : String(error),\r\n      });\r\n    }\r\n  },\r\n  async setFilter(partial) {\r\n    set((state) => ({ filter: { ...state.filter, ...partial } }));\r\n    await get().refresh();\r\n  },\r\n  async approve(consentId) {\r\n    await ipc.consent.approve(consentId);\r\n    await get().refresh();\r\n  },\r\n  async revoke(consentId) {\r\n    await ipc.consent.revoke(consentId);\r\n    await get().refresh();\r\n  },\r\n}));\r\n","/**\r\n * AppShell - Main layout container with all components wired\r\n */\r\n\r\nimport React, { useState, useEffect, Suspense, useMemo, useCallback, useRef } from 'react';\r\nimport { AlertTriangle, PanelsTopLeft, PanelRightOpen } from 'lucide-react';\r\n// RotateCcw, Loader2, X - unused (restore banner removed)\r\nimport { Outlet } from 'react-router-dom';\r\nimport { PermissionRequest, ConsentRequest, ipcEvents } from '../../lib/ipc-events';\r\nimport { useIPCEvent } from '../../lib/use-ipc-event';\r\nimport { useTabsStore, type Tab } from '../../state/tabsStore';\r\nimport { ipc } from '../../lib/ipc-typed';\r\nimport { ResearchHighlight } from '../../types/research';\r\nimport { Portal } from '../common/Portal';\r\nimport { formatDistanceToNow } from 'date-fns';\r\nimport { useTabGraphStore } from '../../state/tabGraphStore';\r\nimport { isDevEnv, isElectronRuntime, isTauriRuntime } from '../../lib/env';\r\nimport { TabContentSurface } from './TabContentSurface';\r\nimport { TabIframeManager } from './TabIframeManager';\r\nimport { GlobalSearch } from '../search/GlobalSearch';\r\nimport { setupIframeBlockedListener } from '../../utils/iframeBlockedFallback';\r\n// Voice components removed by user request\r\n// Lazy load heavy Redix services - DEFER until after first render\r\nconst initializeOptimizer = () =>\r\n  new Promise(resolve =>\r\n    setTimeout(\r\n      () => import('../../core/redix/optimizer').then(m => m.initializeOptimizer()).then(resolve),\r\n      2000\r\n    )\r\n  );\r\nconst startTabSuspensionService = () =>\r\n  new Promise(resolve =>\r\n    setTimeout(\r\n      () =>\r\n        import('../../core/redix/tab-suspension')\r\n          .then(m => m.startTabSuspensionService())\r\n          .then(resolve),\r\n      2000\r\n    )\r\n  );\r\nconst initBatteryManager = () =>\r\n  new Promise(resolve =>\r\n    setTimeout(\r\n      () =>\r\n        import('../../core/redix/battery-manager').then(m => m.initBatteryManager()).then(resolve),\r\n      2000\r\n    )\r\n  );\r\nconst initMemoryManager = () =>\r\n  new Promise(resolve =>\r\n    setTimeout(\r\n      () =>\r\n        import('../../core/redix/memory-manager').then(m => m.initMemoryManager()).then(resolve),\r\n      2000\r\n    )\r\n  );\r\nconst initPowerModes = () =>\r\n  new Promise(resolve =>\r\n    setTimeout(\r\n      () => import('../../core/redix/power-modes').then(m => m.initPowerModes()).then(resolve),\r\n      2000\r\n    )\r\n  );\r\nimport { useRedix } from '../../core/redix/useRedix';\r\nconst updatePolicyMetrics = () =>\r\n  import('../../core/redix/policies').then(m => m.updatePolicyMetrics);\r\nconst getPolicyRecommendations = () =>\r\n  import('../../core/redix/policies').then(m => m.getPolicyRecommendations);\r\nimport { CrashRecoveryDialog, useCrashRecovery } from '../CrashRecoveryDialog';\r\nimport { ResearchMemoryPanel } from '../research/ResearchMemoryPanel';\r\nimport { trackVisit } from '../../core/supermemory/tracker';\r\n// Lazy load heavy summarization service - DEFER significantly\r\nconst initNightlySummarization = () =>\r\n  new Promise(resolve =>\r\n    setTimeout(\r\n      () =>\r\n        import('../../core/supermemory/summarizer')\r\n          .then(m => m.initNightlySummarization())\r\n          .then(resolve),\r\n      3000\r\n    )\r\n  );\r\n// RedixDebugPanel - lazy loaded, dev only\r\nconst RedixDebugPanel = isDevEnv()\r\n  ? React.lazy(() => import('../redix/RedixDebugPanel').then(m => ({ default: m.RedixDebugPanel })))\r\n  : null;\r\nimport { SuspensionIndicator } from '../redix/SuspensionIndicator';\r\nimport { BatteryIndicator } from '../redix/BatteryIndicator';\r\nimport { MemoryMonitor } from '../redix/MemoryMonitor';\r\nimport { MiniHoverAI } from '../interaction/MiniHoverAI';\r\nimport { WisprOrb } from '../WisprOrb';\r\nimport { UnifiedSidePanel } from '../side-panel/UnifiedSidePanel';\r\nimport { CommandBar } from '../command-bar/CommandBar';\r\nimport { OmniModeSwitcher } from '../omni-mode/OmniModeSwitcher';\r\nimport { CommandPalette as QuickCommandPalette } from '../CommandPalette';\r\n// import { WorkspaceTabs } from '../tabs/WorkspaceTabs'; // Reserved for future use\r\nimport { SessionRestorePrompt } from '../SessionRestorePrompt';\r\nconst SessionRestoreModal = React.lazy(() => import('../SessionRestoreModal'));\r\nimport { autoTogglePrivacy } from '../../core/privacy/auto-toggle';\r\nimport { useAppStore } from '../../state/appStore';\r\nimport { useSessionStore } from '../../state/sessionStore';\r\nimport { useHistoryStore } from '../../state/historyStore';\r\nimport { initLayoutSync } from '../../utils/layoutSync';\r\nimport { useSettingsStore } from '../../state/settingsStore';\r\n// import { ModeManager } from '../../core/modes/manager'; // Unused for now\r\nimport { useTradeStore } from '../../state/tradeStore';\r\nimport { TradeSidebar } from '../trade/TradeSidebar';\r\nimport { TermsAcceptance } from '../Onboarding/TermsAcceptance';\r\nimport {\r\n  CookieConsent,\r\n  useCookieConsent,\r\n  type CookiePreferences,\r\n} from '../Onboarding/CookieConsent';\r\nimport { useResearchHotkeys } from '../../hooks/useResearchHotkeys';\r\nimport { ToastHost } from '../common/ToastHost';\r\nimport { reopenMostRecentClosedTab } from '../../lib/tabLifecycle';\r\nimport { toast } from '../../utils/toast';\r\nimport { startSnapshotting } from '../../core/recovery';\r\nimport { initTradeAlertsCron } from '../../services/tradeAlertsCron';\r\n// Tab resurrection functions - imported for future use\r\n// import {\r\n//   startAutoSaveTabs,\r\n//   checkForResurrectableTabs,\r\n//   scheduleAutoResurrection,\r\n// } from '../../core/tabs/resurrection';\r\nimport { initExtensionsAPI, setupPreloadHook } from '../../core/extensions/api';\r\nimport { useAppError } from '../../hooks/useAppError';\r\nimport { LoopResumeModal } from '../agents/LoopResumeModal';\r\nimport { checkForCrashedLoops } from '../../core/agents/loopResume';\r\nimport { WorkflowMarketplace } from '../workflows/WorkflowMarketplace';\r\nimport { MobileDock } from './MobileDock';\r\nimport { InstallProgressModal } from '../installer/InstallProgressModal';\r\n\r\ndeclare global {\r\n  interface Window {\r\n    __OMNIX_TOPBAR_HEIGHT?: number;\r\n    __omnix_apply_topbar?: () => void;\r\n  }\r\n}\r\n\r\ntype ErrorBoundaryState = {\r\n  hasError: boolean;\r\n  error?: Error;\r\n  errorInfo?: string;\r\n  copyStatus: 'success' | 'error' | null;\r\n  copyMessage?: string;\r\n  copying: boolean;\r\n};\r\n\r\nclass ErrorBoundary extends React.Component<\r\n  { children: React.ReactNode; fallback?: React.ReactNode; componentName?: string },\r\n  ErrorBoundaryState\r\n> {\r\n  constructor(props: {\r\n    children: React.ReactNode;\r\n    fallback?: React.ReactNode;\r\n    componentName?: string;\r\n  }) {\r\n    super(props);\r\n    this.state = { hasError: false, copyStatus: null, copying: false };\r\n  }\r\n\r\n  static getDerivedStateFromError(error: Error) {\r\n    return { hasError: true, error };\r\n  }\r\n\r\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n    console.error(\r\n      `ErrorBoundary caught error${this.props.componentName ? ` in ${this.props.componentName}` : ''}:`,\r\n      error,\r\n      errorInfo\r\n    );\r\n    this.setState({ error, errorInfo: errorInfo.componentStack ?? undefined });\r\n\r\n    // Optional: Send to error tracking service (e.g., Sentry)\r\n    if (process.env.NODE_ENV === 'production') {\r\n      // Example: Sentry.captureException(error, { contexts: { react: errorInfo } });\r\n    }\r\n  }\r\n\r\n  private handleReload = () => {\r\n    window.location.reload();\r\n  };\r\n\r\n  private handleOpenLogs = async () => {\r\n    try {\r\n      const result = await ipc.diagnostics.openLogs();\r\n      this.setState({\r\n        copyStatus: result?.success ? 'success' : 'error',\r\n        copyMessage: result?.success ? 'Logs folder opened.' : 'Unable to open logs folder.',\r\n        copying: false,\r\n      });\r\n    } catch (error) {\r\n      console.error('Failed to open logs folder from error boundary:', error);\r\n      this.setState({\r\n        copyStatus: 'error',\r\n        copyMessage: 'Failed to open logs folder.',\r\n        copying: false,\r\n      });\r\n    }\r\n  };\r\n\r\n  private handleCopyDiagnostics = async () => {\r\n    if (this.state.copying) return;\r\n    this.setState({ copying: true, copyStatus: null, copyMessage: undefined });\r\n    try {\r\n      const result = await ipc.diagnostics.copyDiagnostics();\r\n      if (result?.diagnostics && navigator?.clipboard?.writeText) {\r\n        await navigator.clipboard.writeText(result.diagnostics);\r\n        this.setState({\r\n          copyStatus: 'success',\r\n          copyMessage: 'Diagnostics copied to clipboard.',\r\n          copying: false,\r\n        });\r\n      } else {\r\n        this.setState({\r\n          copyStatus: 'error',\r\n          copyMessage: 'Clipboard unavailable. Diagnostics logged to console.',\r\n          copying: false,\r\n        });\r\n        console.info('[Diagnostics] Summary:', result?.diagnostics);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to copy diagnostics from error boundary:', error);\r\n      this.setState({\r\n        copyStatus: 'error',\r\n        copyMessage: 'Failed to copy diagnostics.',\r\n        copying: false,\r\n      });\r\n    }\r\n  };\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      if (this.props.fallback) {\r\n        return this.props.fallback;\r\n      }\r\n\r\n      return (\r\n        <div className=\"flex min-h-screen w-full items-center justify-center bg-slate-950 px-6 py-12 text-gray-100\">\r\n          <div className=\"w-full max-w-xl space-y-5 rounded-2xl border border-slate-800 bg-slate-900/70 p-6 shadow-lg\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <div className=\"rounded-full bg-red-500/20 p-2 text-red-200\">\r\n                <AlertTriangle className=\"h-5 w-5\" />\r\n              </div>\r\n              <div>\r\n                <h1 className=\"text-lg font-semibold text-red-200\">\r\n                  Something went wrong\r\n                  {this.props.componentName ? ` inside ${this.props.componentName}` : ''}.\r\n                </h1>\r\n                {this.state.error?.message && (\r\n                  <p className=\"mt-2 text-sm text-red-100/80\">{this.state.error.message}</p>\r\n                )}\r\n                <p className=\"mt-2 text-sm text-gray-400\">\r\n                  Try reloading the interface. You can also copy diagnostics or inspect the latest\r\n                  logs to share with the team.\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex flex-wrap gap-3\">\r\n              <button\r\n                onClick={this.handleReload}\r\n                className=\"rounded-lg border border-blue-500/50 bg-blue-500/10 px-4 py-2 text-sm font-medium text-blue-100 transition-colors hover:border-blue-500/70\"\r\n              >\r\n                Reload app\r\n              </button>\r\n              <button\r\n                onClick={this.handleCopyDiagnostics}\r\n                disabled={this.state.copying}\r\n                className={`rounded-lg border px-4 py-2 text-sm font-medium transition-colors ${\r\n                  this.state.copying\r\n                    ? 'cursor-wait border-indigo-500/30 bg-indigo-500/10 text-indigo-200/60'\r\n                    : 'border-indigo-500/50 bg-indigo-500/10 text-indigo-100 hover:border-indigo-500/70'\r\n                }`}\r\n              >\r\n                {this.state.copying ? 'Copying' : 'Copy diagnostics'}\r\n              </button>\r\n              <button\r\n                onClick={this.handleOpenLogs}\r\n                className=\"rounded-lg border border-emerald-500/50 bg-emerald-500/10 px-4 py-2 text-sm font-medium text-emerald-100 transition-colors hover:border-emerald-500/70\"\r\n              >\r\n                Open logs folder\r\n              </button>\r\n            </div>\r\n\r\n            {this.state.copyMessage && (\r\n              <div\r\n                className={`text-sm ${\r\n                  this.state.copyStatus === 'success' ? 'text-emerald-300' : 'text-red-300'\r\n                }`}\r\n              >\r\n                {this.state.copyMessage}\r\n              </div>\r\n            )}\r\n\r\n            {isDevEnv() && this.state.errorInfo && (\r\n              <details className=\"text-xs text-gray-400\">\r\n                <summary className=\"cursor-pointer text-gray-300\">Stack trace</summary>\r\n                <pre className=\"mt-2 max-h-48 overflow-auto whitespace-pre-wrap rounded bg-black/40 p-3\">\r\n                  {this.state.errorInfo}\r\n                </pre>\r\n              </details>\r\n            )}\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\n// Lazy load heavy components\r\nconst TopBar = React.lazy(() =>\r\n  import('../../ui/components/TopBar').then(m => ({ default: m.TopBar }))\r\n);\r\nconst TabStrip = React.lazy(() => import('./TabStrip').then(m => ({ default: m.TabStrip })));\r\nconst RightPanel = React.lazy(() => import('./RightPanel').then(m => ({ default: m.RightPanel })));\r\nconst BottomStatus = React.lazy(() =>\r\n  import('./BottomStatus').then(m => ({ default: m.BottomStatus }))\r\n);\r\nconst CommandPalette = React.lazy(() =>\r\n  import('./CommandPalette').then(m => ({ default: m.CommandPalette }))\r\n);\r\nconst PermissionPrompt = React.lazy(() =>\r\n  import('../Overlays/PermissionPrompt').then(m => ({ default: m.PermissionPrompt }))\r\n);\r\nconst ConsentPrompt = React.lazy(() =>\r\n  import('../Overlays/ConsentPrompt').then(m => ({ default: m.ConsentPrompt }))\r\n);\r\nconst AgentOverlay = React.lazy(() =>\r\n  import('../AgentOverlay').then(m => ({ default: m.AgentOverlay }))\r\n);\r\nconst RegenSidebar = React.lazy(() =>\r\n  import('../regen/RegenSidebar').then(m => ({ default: m.RegenSidebar }))\r\n);\r\n\r\nconst RegenSidebarWrapper = () => (\r\n  <div className=\"fixed bottom-0 right-0 top-0 z-50 h-full min-h-0 w-[400px] overflow-hidden border-l border-slate-800/60 bg-gray-900\">\r\n    <RegenSidebar />\r\n  </div>\r\n);\r\nconst ClipperOverlay = React.lazy(() =>\r\n  import('../Overlays/ClipperOverlay').then(m => ({ default: m.ClipperOverlay }))\r\n);\r\nconst ReaderOverlay = React.lazy(() =>\r\n  import('../Overlays/ReaderOverlay').then(m => ({ default: m.ReaderOverlay }))\r\n);\r\nconst TabGraphOverlay = React.lazy(() =>\r\n  import('./TabGraphOverlay').then(m => ({ default: m.TabGraphOverlay }))\r\n);\r\nconst ConsentDashboard = React.lazy(() =>\r\n  import('../Consent/ConsentDashboard').then(m => ({ default: m.ConsentDashboard }))\r\n);\r\nconst TrustEthicsDashboard = React.lazy(() =>\r\n  import('../trust/TrustEthicsDashboard').then(m => ({ default: m.TrustEthicsDashboard }))\r\n);\r\nconst ResearchTour = React.lazy(() =>\r\n  import('../Onboarding/ResearchTour').then(m => ({ default: m.ResearchTour }))\r\n);\r\n\r\nimport { useOnboardingStore, onboardingStorage } from '../../state/onboardingStore';\r\nimport { useConsentOverlayStore } from '../../state/consentOverlayStore';\r\nimport { useTrustDashboardStore } from '../../state/trustDashboardStore';\r\n\r\nexport function AppShell() {\r\n  const [rightPanelOpen, setRightPanelOpen] = useState(false);\r\n  const [commandPaletteOpen, setCommandPaletteOpen] = useState(false);\r\n  const [unifiedSidePanelOpen, setUnifiedSidePanelOpen] = useState(false);\r\n  const [permissionRequest, setPermissionRequest] = useState<PermissionRequest | null>(null);\r\n  const [consentRequest, setConsentRequest] = useState<ConsentRequest | null>(null);\r\n  const [isFullscreen, setIsFullscreen] = useState(false);\r\n  const memorySidebarOpen = useAppStore(state => state.memorySidebarOpen);\r\n  const setMemorySidebarOpen = useAppStore(state => state.setMemorySidebarOpen);\r\n  const setMode = useAppStore(state => state.setMode);\r\n  const [redixDebugOpen, setRedixDebugOpen] = useState(false);\r\n  const [loopResumeModalOpen, setLoopResumeModalOpen] = useState(false);\r\n  const [workflowMarketplaceOpen, setWorkflowMarketplaceOpen] = useState(false);\r\n  const [showInstaller, setShowInstaller] = useState(false);\r\n  const isDev = isDevEnv();\r\n  const themePreference = useSettingsStore(state => state.appearance.theme);\r\n  const compactUI = useSettingsStore(state => state.appearance.compactUI);\r\n  const clearOnExit = useSettingsStore(state => state.privacy.clearOnExit);\r\n  const { crashedTab, setCrashedTab, handleReload } = useCrashRecovery();\r\n\r\n  // PR: Fix layout overlap - Initialize layout sync\r\n  useEffect(() => {\r\n    const cleanup = initLayoutSync();\r\n    return cleanup;\r\n  }, []);\r\n\r\n  // PR: Fix tab switch - Setup iframe blocked fallback handler\r\n  useEffect(() => {\r\n    if (isTauriRuntime()) {\r\n      const cleanup = setupIframeBlockedListener();\r\n\r\n      // Listen for navigation events from Tauri backend\r\n      // Tauri v2 emits events that we can listen to\r\n      let unlisten: (() => void) | null = null;\r\n\r\n      (async () => {\r\n        try {\r\n          const { listen } = await import('@tauri-apps/api/event');\r\n          unlisten = await listen<string>('navigate-to-url', event => {\r\n            console.log('[AppShell] Received navigation event:', event.payload);\r\n            window.location.href = event.payload;\r\n          });\r\n        } catch (error) {\r\n          console.warn('[AppShell] Failed to setup Tauri navigation listener:', error);\r\n          // Fallback: listen to window events\r\n          const handleNavigate = (event: CustomEvent<string>) => {\r\n            console.log('[AppShell] Received navigation event (fallback):', event.detail);\r\n            window.location.href = event.detail;\r\n          };\r\n          window.addEventListener('navigate-to-url', handleNavigate as EventListener);\r\n          unlisten = () => {\r\n            window.removeEventListener('navigate-to-url', handleNavigate as EventListener);\r\n          };\r\n        }\r\n      })();\r\n\r\n      // PR: Fix tab switch - Listen for postMessage from iframes to create new tabs\r\n      const handlePostMessage = (event: MessageEvent) => {\r\n        // In production, check event.origin for security\r\n        const { type, url, sourceTabId } = event.data || {};\r\n\r\n        if (type === 'open-in-new-tab' && url) {\r\n          console.log('[AppShell] Received open-in-new-tab message', {\r\n            url,\r\n            sourceTabId,\r\n            origin: event.origin,\r\n          });\r\n\r\n          // Create new tab with the URL\r\n          const tabsStore = useTabsStore.getState();\r\n          const newTab: Tab = {\r\n            id: `tab-${Date.now()}-${Math.random().toString(36).slice(2, 7)}`,\r\n            url,\r\n            title: 'New Tab',\r\n            active: false,\r\n            createdAt: Date.now(),\r\n          };\r\n          tabsStore.add(newTab);\r\n        }\r\n      };\r\n\r\n      window.addEventListener('message', handlePostMessage);\r\n\r\n      return () => {\r\n        cleanup();\r\n        if (unlisten) {\r\n          unlisten();\r\n        }\r\n        window.removeEventListener('message', handlePostMessage);\r\n      };\r\n    }\r\n  }, []);\r\n\r\n  // Check for crashed loops on mount\r\n  useEffect(() => {\r\n    const crashed = checkForCrashedLoops();\r\n    if (crashed.length > 0) {\r\n      // Show modal after a short delay to not interrupt initial load\r\n      setTimeout(() => {\r\n        setLoopResumeModalOpen(true);\r\n      }, 2000);\r\n    }\r\n  }, []);\r\n\r\n  // Memory monitoring - auto-unload tabs when memory is low\r\n  useEffect(() => {\r\n    let cleanup: (() => void) | null = null;\r\n\r\n    const initMemoryMonitoring = async () => {\r\n      const { startMemoryMonitoring, stopMemoryMonitoring, unloadInactiveTabs } =\r\n        await import('../../core/monitoring/memoryMonitor');\r\n\r\n      startMemoryMonitoring(\r\n        async () => {\r\n          // Low memory: unload inactive tabs\r\n          await unloadInactiveTabs();\r\n        },\r\n        async () => {\r\n          // Critical memory: unload more aggressively\r\n          await unloadInactiveTabs();\r\n          toast.warning('Low memory detected. Some tabs were unloaded for better performance.');\r\n        }\r\n      );\r\n\r\n      cleanup = () => stopMemoryMonitoring();\r\n    };\r\n\r\n    initMemoryMonitoring();\r\n\r\n    return () => {\r\n      if (cleanup) cleanup();\r\n    };\r\n  }, []);\r\n\r\n  // Tab resurrection is now handled in the initialization effect below\r\n\r\n  // Initialize fullscreen state on mount - ensure it starts as false\r\n  useEffect(() => {\r\n    // Force initial state to false (window should not start in fullscreen)\r\n    setIsFullscreen(false);\r\n\r\n    // Check initial fullscreen state after a brief delay to ensure window is ready\r\n    const checkFullscreen = () => {\r\n      const isCurrentlyFullscreen = !!(\r\n        document.fullscreenElement ||\r\n        (window as any).webkitFullscreenElement ||\r\n        (window as any).mozFullScreenElement\r\n      );\r\n      if (isCurrentlyFullscreen !== isFullscreen) {\r\n        setIsFullscreen(isCurrentlyFullscreen);\r\n      }\r\n    };\r\n\r\n    // Check after a brief delay to ensure window is ready\r\n    const timeoutId = setTimeout(checkFullscreen, 100);\r\n\r\n    // Listen for fullscreen changes\r\n    document.addEventListener('fullscreenchange', checkFullscreen);\r\n    document.addEventListener('webkitfullscreenchange', checkFullscreen);\r\n    document.addEventListener('mozfullscreenchange', checkFullscreen);\r\n\r\n    return () => {\r\n      clearTimeout(timeoutId);\r\n      document.removeEventListener('fullscreenchange', checkFullscreen);\r\n      document.removeEventListener('webkitfullscreenchange', checkFullscreen);\r\n      document.removeEventListener('mozfullscreenchange', checkFullscreen);\r\n    };\r\n  }, []);\r\n  const [clipperActive, setClipperActive] = useState(false);\r\n  const [readerActive, setReaderActive] = useState(false);\r\n  const [isOffline, setIsOffline] = useState(() =>\r\n    typeof navigator !== 'undefined' ? !navigator.onLine : false\r\n  );\r\n  const [ollamaAvailable, setOllamaAvailable] = useState(false);\r\n  const onboardingVisible = useOnboardingStore(state => state.visible);\r\n  const startOnboarding = useOnboardingStore(state => state.start);\r\n  const _finishOnboarding = useOnboardingStore(state => state.finish);\r\n  useResearchHotkeys();\r\n\r\n  // Debug: log visibility changes (removed for production performance)\r\n  const [graphDropHint, setGraphDropHint] = useState(false);\r\n  const topChromeRef = useRef<HTMLDivElement | null>(null);\r\n  const bottomChromeRef = useRef<HTMLDivElement | null>(null);\r\n  const isElectron = useMemo(() => isElectronRuntime(), []);\r\n  const desktopServicesReady =\r\n    isElectron &&\r\n    typeof window !== 'undefined' &&\r\n    !!(window as typeof window & { ipc?: unknown }).ipc;\r\n\r\n  useEffect(() => {\r\n    const handleOnline = () => setIsOffline(false);\r\n    const handleOffline = () => setIsOffline(true);\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n    return () => {\r\n      window.removeEventListener('online', handleOnline);\r\n      window.removeEventListener('offline', handleOffline);\r\n    };\r\n  }, []);\r\n\r\n  // Listen for global shortcut events (OS-level hotkeys)\r\n  useEffect(() => {\r\n    if (!isElectron) {\r\n      return;\r\n    }\r\n\r\n    const unsubscribeWakeWispr = ipcEvents.on('wake-wispr', () => {\r\n      // Trigger WISPR activation\r\n      window.dispatchEvent(new CustomEvent('activate-wispr'));\r\n      toast.info('WISPR activated');\r\n    });\r\n\r\n    const unsubscribeTradeMode = ipcEvents.on('open-trade-mode', () => {\r\n      setMode('Trade');\r\n      toast.info('Trade mode opened');\r\n    });\r\n\r\n    const unsubscribeResearchMode = ipcEvents.on('open-research-mode', () => {\r\n      setMode('Research');\r\n      toast.info('Research mode opened');\r\n    });\r\n\r\n    return () => {\r\n      unsubscribeWakeWispr();\r\n      unsubscribeTradeMode();\r\n      unsubscribeResearchMode();\r\n    };\r\n  }, [setMode]);\r\n\r\n  useEffect(() => {\r\n    if (!isElectron) {\r\n      return;\r\n    }\r\n\r\n    let lastTop = -1;\r\n    let lastBottom = -1;\r\n\r\n    const updateOffsets = () => {\r\n      const top = Math.round(topChromeRef.current?.offsetHeight ?? 0);\r\n      const bottomMeasured = Math.round(bottomChromeRef.current?.offsetHeight ?? 0);\r\n      const bottom = isFullscreen ? 0 : bottomMeasured;\r\n\r\n      // Set CSS variable for header height (useful for Electron main process)\r\n      if (top !== lastTop) {\r\n        document.documentElement.style.setProperty('--header-height', `${top}px`);\r\n      }\r\n      if (bottom !== lastBottom || bottom !== bottomMeasured) {\r\n        document.documentElement.style.setProperty('--footer-height', `${bottom}px`);\r\n      }\r\n\r\n      if (top !== lastTop || bottom !== lastBottom) {\r\n        lastTop = top;\r\n        lastBottom = bottom;\r\n        void ipc.ui.setChromeOffsets({ top, bottom });\r\n      }\r\n    };\r\n\r\n    const observers: ResizeObserver[] = [];\r\n    const attachObserver = (element: Element | null | undefined) => {\r\n      if (!element || typeof ResizeObserver === 'undefined') return;\r\n      const observer = new ResizeObserver(updateOffsets);\r\n      observer.observe(element);\r\n      observers.push(observer);\r\n    };\r\n\r\n    attachObserver(topChromeRef.current);\r\n    attachObserver(bottomChromeRef.current);\r\n    updateOffsets();\r\n    window.addEventListener('resize', updateOffsets);\r\n\r\n    return () => {\r\n      window.removeEventListener('resize', updateOffsets);\r\n      observers.forEach(observer => observer.disconnect());\r\n    };\r\n  }, [isElectron, isFullscreen]);\r\n\r\n  // Set CSS variable for header height (always, not just Electron)\r\n  useEffect(() => {\r\n    if (!topChromeRef.current) return;\r\n\r\n    const updateHeaderHeight = () => {\r\n      const height = topChromeRef.current?.offsetHeight ?? 0;\r\n      const px = `${height}px`;\r\n      document.documentElement.style.setProperty('--header-height', px);\r\n      document.documentElement.style.setProperty('--omnix-topbar-height', px);\r\n      if (typeof window !== 'undefined') {\r\n        (window as any).__OMNIX_TOPBAR_HEIGHT = height;\r\n        if (typeof (window as any).__omnix_apply_topbar === 'function') {\r\n          try {\r\n            (window as any).__omnix_apply_topbar();\r\n          } catch (error) {\r\n            if (process.env.NODE_ENV === 'development') {\r\n              console.warn('[AppShell] Failed to notify injected topbar script', error);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    updateHeaderHeight();\r\n    const observer = new ResizeObserver(updateHeaderHeight);\r\n    if (topChromeRef.current) {\r\n      observer.observe(topChromeRef.current);\r\n    }\r\n\r\n    return () => observer.disconnect();\r\n  }, []);\r\n\r\n  // Initialize Trade Alerts Cron service on app start\r\n  useEffect(() => {\r\n    initTradeAlertsCron();\r\n  }, []);\r\n\r\n  // Initialize Extensions API on app start\r\n  useEffect(() => {\r\n    setupPreloadHook();\r\n    initExtensionsAPI();\r\n  }, []);\r\n\r\n  // Check Ollama availability when offline\r\n  useEffect(() => {\r\n    if (isOffline) {\r\n      void ipc.ollama\r\n        .check()\r\n        .then(result => {\r\n          setOllamaAvailable(result?.available ?? false);\r\n        })\r\n        .catch(() => {\r\n          setOllamaAvailable(false);\r\n        });\r\n    } else {\r\n      setOllamaAvailable(false);\r\n    }\r\n  }, [isOffline]);\r\n\r\n  const [restoreSummary, setRestoreSummary] = useState<{\r\n    updatedAt: number;\r\n    windowCount: number;\r\n    tabCount: number;\r\n  } | null>(null);\r\n  const [restoreDismissed, setRestoreDismissed] = useState(false);\r\n  const [restoreStatus, setRestoreStatus] = useState<'idle' | 'restoring'>('idle');\r\n  const [viewportWidth, setViewportWidth] = useState(() =>\r\n    typeof window !== 'undefined' ? window.innerWidth : 1920\r\n  );\r\n  const isDesktopLayout = viewportWidth >= 1280;\r\n\r\n  // Notify main process when right panel opens/closes so BrowserView bounds can be updated\r\n  useEffect(() => {\r\n    if (\r\n      !isElectron ||\r\n      typeof window === 'undefined' ||\r\n      !(window as any).ui ||\r\n      typeof (window as any).ui.setRightDock !== 'function'\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    // Right panel uses w-[340px] max-w-[380px], use 360px as average\r\n    // Only send width if panel is open and not in fullscreen\r\n    const panelWidth = rightPanelOpen && !isFullscreen && isDesktopLayout ? 360 : 0;\r\n\r\n    try {\r\n      (window as any).ui.setRightDock(panelWidth);\r\n      if (process.env.NODE_ENV === 'development') {\r\n        // Debug logging removed for production\r\n      }\r\n    } catch (error) {\r\n      if (process.env.NODE_ENV === 'development') {\r\n        console.warn('[AppShell] Failed to update right panel width:', error);\r\n      }\r\n    }\r\n  }, [rightPanelOpen, isFullscreen, isDesktopLayout, isElectron]);\r\n\r\n  const [, setToolsDrawerOpen] = useState(false);\r\n  const sessionSnapshot = useSessionStore(state => state.snapshot);\r\n  const saveSessionSnapshot = useSessionStore(state => state.saveSnapshot);\r\n  const restoreSessionSnapshot = useSessionStore(state => state.restoreFromSnapshot);\r\n  const clearSessionSnapshot = useSessionStore(state => state.clearSnapshot);\r\n  const clearHistoryEntries = useHistoryStore(state => state.clear);\r\n  const tabsState = useTabsStore();\r\n  const { handleError: _handleError, safeExecute: _safeExecute } = useAppError();\r\n  const [showTOS, setShowTOS] = useState(false);\r\n  const [showCookieConsent, setShowCookieConsent] = useState(false);\r\n  const [restoreToast, setRestoreToast] = useState<{\r\n    message: string;\r\n    variant: 'success' | 'error';\r\n  } | null>(null);\r\n\r\n  // All hooks must be called before any conditional logic\r\n  const { hasConsented } = useCookieConsent();\r\n\r\n  // Memoize TOS callbacks to prevent hook order issues - must be called unconditionally\r\n  const handleTOSAccept = useCallback(() => {\r\n    console.log('[AppShell] handleTOSAccept called - closing TOS modal');\r\n    console.log(\r\n      '[AppShell] Current state - showTOS:',\r\n      showTOS,\r\n      'hasConsented:',\r\n      hasConsented,\r\n      'showCookieConsent:',\r\n      showCookieConsent\r\n    );\r\n    setShowTOS(false);\r\n    // The onboarding will start automatically via the useEffect that checks showTOS\r\n    // But first cookie consent will be shown if not already consented\r\n    console.log(\r\n      '[AppShell] TOS modal closed, waiting for cookie consent and onboarding to start...'\r\n    );\r\n  }, [showTOS, hasConsented, showCookieConsent]);\r\n\r\n  const handleTOSDecline = useCallback(() => {\r\n    // User declined TOS - could show a message or prevent app usage\r\n    // For now, we'll just close the app or show a message\r\n    if (\r\n      window.confirm('You must accept the Terms of Service to use Regen. Would you like to exit?')\r\n    ) {\r\n      // In Electron, we could close the window\r\n      if (typeof window !== 'undefined' && (window as any).api?.app?.quit) {\r\n        (window as any).api.app.quit();\r\n      } else {\r\n        window.close();\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n    const handleResize = () => {\r\n      setViewportWidth(window.innerWidth);\r\n    };\r\n    window.addEventListener('resize', handleResize);\r\n    return () => window.removeEventListener('resize', handleResize);\r\n  }, []);\r\n\r\n  // Tier 2: Initialize snapshotting on mount\r\n  useEffect(() => {\r\n    startSnapshotting();\r\n    return () => {\r\n      // Cleanup handled by stopSnapshotting if needed\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const timer = window.setTimeout(() => {\r\n      saveSessionSnapshot(tabsState.tabs, tabsState.activeId);\r\n    }, 500);\r\n    return () => window.clearTimeout(timer);\r\n  }, [tabsState.tabs, tabsState.activeId, saveSessionSnapshot]);\r\n\r\n  useEffect(() => {\r\n    if (!clearOnExit) return;\r\n    const handleBeforeUnload = () => {\r\n      clearSessionSnapshot();\r\n      clearHistoryEntries();\r\n      useTabsStore.getState().clearRecentlyClosed();\r\n    };\r\n    window.addEventListener('beforeunload', handleBeforeUnload);\r\n    return () => window.removeEventListener('beforeunload', handleBeforeUnload);\r\n  }, [clearOnExit, clearHistoryEntries, clearSessionSnapshot]);\r\n\r\n  useEffect(() => {\r\n    if (typeof document === 'undefined') return;\r\n    const root = document.documentElement;\r\n    const media = window.matchMedia('(prefers-color-scheme: dark)');\r\n\r\n    const applyPreferences = () => {\r\n      const resolvedTheme =\r\n        themePreference === 'system' ? (media.matches ? 'dark' : 'light') : themePreference;\r\n      root.dataset.theme = resolvedTheme;\r\n      root.dataset.compact = compactUI ? 'true' : 'false';\r\n    };\r\n\r\n    applyPreferences();\r\n\r\n    if (themePreference === 'system') {\r\n      const handler = () => applyPreferences();\r\n      media.addEventListener('change', handler);\r\n      return () => media.removeEventListener('change', handler);\r\n    }\r\n\r\n    return undefined;\r\n  }, [themePreference, compactUI]);\r\n\r\n  // Check TOS acceptance on mount\r\n  useEffect(() => {\r\n    try {\r\n      const stored = localStorage.getItem('regen:tos:accepted');\r\n      if (stored) {\r\n        const data = JSON.parse(stored);\r\n        const currentVersion = '2025-12-17'; // Update when TOS changes\r\n        if (data.version === currentVersion && data.accepted) {\r\n          setShowTOS(false);\r\n          // Only show cookie consent after TOS is accepted\r\n          if (!hasConsented) {\r\n            setShowCookieConsent(true);\r\n          }\r\n          return;\r\n        }\r\n      }\r\n      // TOS not accepted or version mismatch - show TOS\r\n      setShowTOS(true);\r\n    } catch {\r\n      // Invalid stored data - show TOS\r\n      setShowTOS(true);\r\n    }\r\n  }, [hasConsented]);\r\n\r\n  // Show cookie consent after TOS is accepted\r\n  useEffect(() => {\r\n    if (!showTOS && !hasConsented) {\r\n      console.log('[AppShell] Showing cookie consent - TOS accepted, cookie consent needed');\r\n      // Small delay to ensure TOS modal is fully closed\r\n      const timer = setTimeout(() => {\r\n        setShowCookieConsent(true);\r\n        console.log('[AppShell] Cookie consent modal shown');\r\n      }, 300);\r\n      return () => clearTimeout(timer);\r\n    } else if (!showTOS && hasConsented) {\r\n      console.log('[AppShell] Cookie consent already given, skipping cookie consent modal');\r\n      setShowCookieConsent(false);\r\n    }\r\n  }, [showTOS, hasConsented]);\r\n  useEffect(() => {\r\n    let dragCounter = 0;\r\n\r\n    const isGraphDrag = (event: DragEvent) => {\r\n      const types = event.dataTransfer?.types;\r\n      if (!types) return false;\r\n      return Array.from(types).includes('application/x-regen-tab-id');\r\n    };\r\n\r\n    const handleDragEnter = (event: DragEvent) => {\r\n      if (!isGraphDrag(event)) return;\r\n      event.preventDefault();\r\n      dragCounter += 1;\r\n      setGraphDropHint(true);\r\n    };\r\n\r\n    const handleDragOver = (event: DragEvent) => {\r\n      if (!isGraphDrag(event)) return;\r\n      event.preventDefault();\r\n      if (event.dataTransfer) {\r\n        event.dataTransfer.dropEffect = 'copy';\r\n      }\r\n    };\r\n\r\n    const handleDragLeave = (event: DragEvent) => {\r\n      if (!isGraphDrag(event)) return;\r\n      dragCounter = Math.max(0, dragCounter - 1);\r\n      if (dragCounter === 0) {\r\n        setGraphDropHint(false);\r\n      }\r\n    };\r\n\r\n    const handleDragEnd = () => {\r\n      dragCounter = 0;\r\n      setGraphDropHint(false);\r\n    };\r\n\r\n    const handleDrop = (event: DragEvent) => {\r\n      if (!isGraphDrag(event)) return;\r\n      event.preventDefault();\r\n      dragCounter = 0;\r\n      setGraphDropHint(false);\r\n      const tabId = event.dataTransfer?.getData('application/x-regen-tab-id');\r\n      if (tabId) {\r\n        try {\r\n          void useTabGraphStore.getState().focusTab(tabId);\r\n        } catch (error) {\r\n          if (isDevEnv()) {\r\n            console.warn('[AppShell] Failed to focus tab graph from drop', error);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    const handleCustomDragEnd = () => {\r\n      dragCounter = 0;\r\n      setGraphDropHint(false);\r\n    };\r\n\r\n    document.addEventListener('dragenter', handleDragEnter);\r\n    document.addEventListener('dragover', handleDragOver);\r\n    document.addEventListener('dragleave', handleDragLeave);\r\n    document.addEventListener('dragend', handleDragEnd);\r\n    document.addEventListener('drop', handleDrop);\r\n    window.addEventListener('tabgraph:dragend', handleCustomDragEnd as EventListener);\r\n\r\n    return () => {\r\n      document.removeEventListener('dragenter', handleDragEnter);\r\n      document.removeEventListener('dragover', handleDragOver);\r\n      document.removeEventListener('dragleave', handleDragLeave);\r\n      document.removeEventListener('dragend', handleDragEnd);\r\n      document.removeEventListener('drop', handleDrop);\r\n      window.removeEventListener('tabgraph:dragend', handleCustomDragEnd as EventListener);\r\n    };\r\n  }, []);\r\n  const consentVisible = useConsentOverlayStore(state => state.visible);\r\n  const trustDashboardVisible = useTrustDashboardStore(state => state.visible);\r\n\r\n  const cycleTab = useCallback((direction: number) => {\r\n    const { tabs, activeId, setActive } = useTabsStore.getState();\r\n    const currentMode = useAppStore.getState().mode;\r\n    const scopedTabs = tabs.filter(\r\n      tab => !currentMode || !tab.appMode || tab.appMode === currentMode\r\n    );\r\n    if (scopedTabs.length === 0) {\r\n      return false;\r\n    }\r\n    const currentIndex = scopedTabs.findIndex(tab => tab.id === activeId);\r\n    const baseIndex = currentIndex >= 0 ? currentIndex : 0;\r\n    const nextIndex = (baseIndex + direction + scopedTabs.length) % scopedTabs.length;\r\n    const target = scopedTabs[nextIndex];\r\n    if (target && target.id !== activeId) {\r\n      setActive(target.id);\r\n      void ipc.tabs.activate({ id: target.id });\r\n      return true;\r\n    }\r\n    return false;\r\n  }, []);\r\n\r\n  const jumpToTabIndex = useCallback((position: number, snapToEnd = false) => {\r\n    const { tabs, setActive } = useTabsStore.getState();\r\n    const currentMode = useAppStore.getState().mode;\r\n    const scopedTabs = tabs.filter(\r\n      tab => !currentMode || !tab.appMode || tab.appMode === currentMode\r\n    );\r\n    if (scopedTabs.length === 0) {\r\n      return false;\r\n    }\r\n\r\n    const index = snapToEnd\r\n      ? Math.max(scopedTabs.length - 1, 0)\r\n      : Math.min(Math.max(position, 0), scopedTabs.length - 1);\r\n    const target = scopedTabs[index];\r\n    if (target) {\r\n      setActive(target.id);\r\n      void ipc.tabs.activate({ id: target.id });\r\n      return true;\r\n    }\r\n    return false;\r\n  }, []);\r\n  const activeTab = useMemo(() => {\r\n    // PR: Fix tab switch - defensive null checks with logging\r\n    const safeTabs = Array.isArray(tabsState.tabs) ? tabsState.tabs.filter(t => t && t.id) : [];\r\n    const found = safeTabs.find(tab => tab.id === tabsState.activeId);\r\n\r\n    if (tabsState.activeId && !found) {\r\n      console.warn('[AppShell] activeTab not found', {\r\n        activeId: tabsState.activeId,\r\n        availableIds: safeTabs.map(t => t.id),\r\n        totalTabs: safeTabs.length,\r\n      });\r\n    }\r\n\r\n    return found || undefined;\r\n  }, [tabsState.tabs, tabsState.activeId]);\r\n  const mode = useAppStore(state => state.mode);\r\n  const currentMode = mode ?? 'Browse';\r\n\r\n  useEffect(() => {\r\n    if (typeof document === 'undefined') return;\r\n    const nextMode = (mode ?? 'browse').toLowerCase();\r\n    document.documentElement.dataset.modeTheme = nextMode;\r\n    return () => {\r\n      document.documentElement.dataset.modeTheme = nextMode;\r\n    };\r\n  }, [mode]);\r\n  const researchPaneOpen = useAppStore(state => state.researchPaneOpen);\r\n  const setResearchPaneOpen = useAppStore(state => state.setResearchPaneOpen);\r\n  const tradeSidebarOpen = useTradeStore(state => state.sidebarOpen);\r\n  const setTradeSidebarOpen = useTradeStore(state => state.setSidebarOpen);\r\n  const regenSidebarOpen = useAppStore(state => state.regenSidebarOpen);\r\n  const setRegenSidebarOpen = useAppStore(state => state.setRegenSidebarOpen);\r\n  const [_contentSplit, setContentSplit] = useState(0.62);\r\n\r\n  // Track visits when active tab URL changes\r\n  const lastTrackedUrl = useRef<string>('');\r\n  useEffect(() => {\r\n    if (!activeTab?.url || activeTab.url === lastTrackedUrl.current) return;\r\n\r\n    // Skip special pages\r\n    if (\r\n      activeTab.url.startsWith('about:') ||\r\n      activeTab.url.startsWith('chrome:') ||\r\n      activeTab.url.startsWith('edge:') ||\r\n      activeTab.url.startsWith('app:') ||\r\n      activeTab.url.startsWith('ob://')\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    // Track visit\r\n    lastTrackedUrl.current = activeTab.url;\r\n    trackVisit(activeTab.url, activeTab.title, {\r\n      tabId: activeTab.id,\r\n      containerId: activeTab.containerId,\r\n    }).catch(error => {\r\n      console.warn('[AppShell] Failed to track visit:', error);\r\n    });\r\n  }, [activeTab?.url, activeTab?.title, activeTab?.id, activeTab?.containerId]);\r\n\r\n  // Initialize nightly summarization\r\n  useEffect(() => {\r\n    // Defer nightly summarization initialization\r\n    setTimeout(() => {\r\n      initNightlySummarization().catch(err => {\r\n        if (isDevEnv()) console.warn('[AppShell] Nightly summarization init failed:', err);\r\n      });\r\n    }, 2000);\r\n  }, []);\r\n  const [isResizingContent, setIsResizingContent] = useState(false);\r\n  const overlayActive =\r\n    commandPaletteOpen ||\r\n    Boolean(permissionRequest) ||\r\n    Boolean(consentRequest) ||\r\n    clipperActive ||\r\n    readerActive;\r\n  const activeTabUrl = activeTab?.url ?? '';\r\n  // Hide webview content in Research and Trade modes - they have their own UI\r\n  const showWebContent =\r\n    currentMode !== 'Research' &&\r\n    currentMode !== 'Trade' &&\r\n    Boolean(activeTabUrl) &&\r\n    !activeTabUrl.startsWith('ob://') &&\r\n    !activeTabUrl.startsWith('about:') &&\r\n    !activeTabUrl.startsWith('chrome://') &&\r\n    !activeTabUrl.startsWith('edge://') &&\r\n    !activeTabUrl.startsWith('app://');\r\n  useEffect(() => {\r\n    if (isDesktopLayout || !showWebContent) {\r\n      setToolsDrawerOpen(false);\r\n    }\r\n  }, [isDesktopLayout, showWebContent]);\r\n  const shouldShowInlineToolsPanel = showWebContent && isDesktopLayout;\r\n  const handleResizeStart = useCallback(() => {\r\n    if (!showWebContent) return;\r\n    setIsResizingContent(true);\r\n  }, [showWebContent]);\r\n\r\n  useEffect(() => {\r\n    if (!isResizingContent) return;\r\n\r\n    const handlePointerMove = (event: MouseEvent) => {\r\n      setContentSplit(prev => {\r\n        const ratio = event.clientX / window.innerWidth;\r\n        if (Number.isNaN(ratio)) return prev;\r\n        return Math.min(0.85, Math.max(0.25, ratio));\r\n      });\r\n    };\r\n\r\n    const handlePointerUp = () => {\r\n      setIsResizingContent(false);\r\n    };\r\n\r\n    window.addEventListener('mousemove', handlePointerMove);\r\n    window.addEventListener('mouseup', handlePointerUp);\r\n\r\n    return () => {\r\n      window.removeEventListener('mousemove', handlePointerMove);\r\n      window.removeEventListener('mouseup', handlePointerUp);\r\n    };\r\n  }, [isResizingContent]);\r\n\r\n  const _restoreRelativeTime = useMemo(() => {\r\n    if (!restoreSummary) return null;\r\n    try {\r\n      return formatDistanceToNow(new Date(restoreSummary.updatedAt), { addSuffix: true });\r\n    } catch {\r\n      return null;\r\n    }\r\n  }, [restoreSummary]);\r\n\r\n  // Auto-open mode-specific panels (mode manager handles this via onActivate hooks, but we keep this as a fallback)\r\n  useEffect(() => {\r\n    // Mode manager's onActivate hooks handle most of this, but we ensure UI stays in sync\r\n    if (mode === 'Research') {\r\n      // Don't auto-open memory sidebar in Research Mode - let users toggle it to avoid overlapping the gradient UI\r\n      // if (!memorySidebarOpen) {\r\n      //   setMemorySidebarOpen(true);\r\n      // }\r\n      if (!researchPaneOpen) {\r\n        setResearchPaneOpen(true);\r\n      }\r\n      if (tradeSidebarOpen) {\r\n        setTradeSidebarOpen(false);\r\n      }\r\n    } else if (mode === 'Trade') {\r\n      if (!tradeSidebarOpen) {\r\n        setTradeSidebarOpen(true);\r\n      }\r\n      if (researchPaneOpen) {\r\n        setResearchPaneOpen(false);\r\n      }\r\n      if (memorySidebarOpen) {\r\n        setMemorySidebarOpen(false);\r\n      }\r\n    } else if (mode === 'GraphMind') {\r\n      const graphDockOpen = useAppStore.getState().graphDockOpen;\r\n      if (!graphDockOpen) {\r\n        useAppStore.getState().toggleGraphDock();\r\n      }\r\n      // Close other panels\r\n      if (researchPaneOpen) {\r\n        setResearchPaneOpen(false);\r\n      }\r\n      if (tradeSidebarOpen) {\r\n        setTradeSidebarOpen(false);\r\n      }\r\n      if (memorySidebarOpen) {\r\n        setMemorySidebarOpen(false);\r\n      }\r\n    } else {\r\n      // Browse mode or other modes - close mode-specific panels\r\n      if (researchPaneOpen) {\r\n        setResearchPaneOpen(false);\r\n      }\r\n      if (tradeSidebarOpen) {\r\n        setTradeSidebarOpen(false);\r\n      }\r\n      // Keep memory sidebar open in Browse mode if user wants it\r\n    }\r\n  }, [\r\n    mode,\r\n    memorySidebarOpen,\r\n    researchPaneOpen,\r\n    setResearchPaneOpen,\r\n    tradeSidebarOpen,\r\n    setTradeSidebarOpen,\r\n    setMemorySidebarOpen,\r\n  ]);\r\n\r\n  // Initialize Redix optimizer\r\n  // Defer heavy Redix service initialization to avoid blocking initial render\r\n  useEffect(() => {\r\n    // Use requestIdleCallback or setTimeout to defer initialization\r\n    const deferInit = () => {\r\n      if ('requestIdleCallback' in window) {\r\n        requestIdleCallback(\r\n          () => {\r\n            initializeOptimizer().catch(err => {\r\n              if (isDevEnv()) console.warn('[AppShell] Optimizer init failed:', err);\r\n            });\r\n          },\r\n          { timeout: 2000 }\r\n        );\r\n      } else {\r\n        setTimeout(() => {\r\n          initializeOptimizer().catch(_err => {\r\n            if (isDevEnv()) console.warn('[AppShell] Optimizer init failed');\r\n          });\r\n        }, 500);\r\n      }\r\n    };\r\n    deferInit();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!desktopServicesReady) return;\r\n    const timer = setTimeout(() => {\r\n      startTabSuspensionService().catch(err => {\r\n        if (isDevEnv()) console.warn('[AppShell] Tab suspension init failed:', err);\r\n      });\r\n    }, 1000);\r\n    return () => clearTimeout(timer);\r\n  }, [desktopServicesReady]);\r\n\r\n  useEffect(() => {\r\n    if (!desktopServicesReady) return;\r\n    const timer = setTimeout(() => {\r\n      Promise.all([\r\n        initBatteryManager().catch(err => {\r\n          if (isDevEnv()) console.warn('[AppShell] Battery manager init failed:', err);\r\n        }),\r\n        initPowerModes().catch(err => {\r\n          if (isDevEnv()) console.warn('[AppShell] Power modes init failed:', err);\r\n        }),\r\n        initMemoryManager().catch(err => {\r\n          if (isDevEnv()) console.warn('[AppShell] Memory manager init failed:', err);\r\n        }),\r\n      ]).catch(() => {\r\n        // Silently handle errors - these are optional services\r\n      });\r\n    }, 1500);\r\n    return () => clearTimeout(timer);\r\n  }, [desktopServicesReady]);\r\n\r\n  // Watch for Redix performance events\r\n  useRedix(event => {\r\n    if (event.type === 'redix:performance:low') {\r\n      if (isDevEnv()) {\r\n        console.log('[Redix] Performance low:', event.payload);\r\n      }\r\n      // Update policy metrics for automatic evaluation (lazy loaded)\r\n      const { memory, cpu, battery } = event.payload || {};\r\n      updatePolicyMetrics()\r\n        .then(updateFn => {\r\n          updateFn({\r\n            memoryUsage: memory,\r\n            cpuUsage: cpu,\r\n            batteryLevel: battery,\r\n          });\r\n        })\r\n        .catch(() => {\r\n          // Silently handle errors - policy metrics are optional\r\n        });\r\n    }\r\n\r\n    // Handle policy events\r\n    if (event.type.startsWith('redix:policy:')) {\r\n      // Lazy load policy recommendations\r\n      getPolicyRecommendations()\r\n        .then(getFn => {\r\n          const recommendations = getFn();\r\n          if (recommendations.length > 0 && isDevEnv()) {\r\n            console.log('[Redix] Policy recommendations:', recommendations);\r\n          }\r\n        })\r\n        .catch(() => {\r\n          // Silently handle errors\r\n        });\r\n    }\r\n\r\n    // Handle mode transition errors\r\n    if (event.type === 'redix:mode:error') {\r\n      const { mode, error } = event.payload || {};\r\n      console.error('[ModeManager] Mode transition error:', mode, error);\r\n      setRestoreToast({\r\n        message: `Failed to switch to ${mode} mode: ${error || 'Unknown error'}`,\r\n        variant: 'error',\r\n      });\r\n    }\r\n\r\n    // Handle successful mode activation\r\n    if (event.type === 'redix:mode:activated') {\r\n      const { mode } = event.payload || {};\r\n      if (mode && mode !== 'Browse') {\r\n        // Optionally show success toast for non-Browse modes\r\n        // setRestoreToast({ message: `Switched to ${mode} mode`, variant: 'success' });\r\n      }\r\n    }\r\n  });\r\n\r\n  // Auto-start onboarding for new users (with a small delay to let UI settle)\r\n  // Only start if TOS and Cookie Consent are not showing\r\n  useEffect(() => {\r\n    if (typeof window === 'undefined') return;\r\n    if (showTOS || showCookieConsent) {\r\n      console.log(\r\n        '[AppShell] Onboarding blocked - showTOS:',\r\n        showTOS,\r\n        'showCookieConsent:',\r\n        showCookieConsent\r\n      );\r\n      return; // Don't start onboarding if modals are showing\r\n    }\r\n\r\n    console.log('[AppShell] Checking if onboarding should start...', {\r\n      isCompleted: onboardingStorage.isCompleted(),\r\n      onboardingVisible,\r\n    });\r\n\r\n    const timer = setTimeout(() => {\r\n      if (!onboardingStorage.isCompleted() && !onboardingVisible) {\r\n        console.log('[AppShell] Starting onboarding...');\r\n        startOnboarding();\r\n      } else {\r\n        console.log(\r\n          '[AppShell] Onboarding not started - isCompleted:',\r\n          onboardingStorage.isCompleted(),\r\n          'visible:',\r\n          onboardingVisible\r\n        );\r\n      }\r\n    }, 1200); // Delay to let UI render first (increased for slower machines)\r\n    return () => clearTimeout(timer);\r\n  }, [onboardingVisible, startOnboarding, showTOS, showCookieConsent]);\r\n\r\n  // Privacy auto-toggle: Auto-enable Private/Ghost mode on sensitive sites (Browse mode only)\r\n  useEffect(() => {\r\n    if (mode !== 'Browse' || !activeTab?.url) return;\r\n\r\n    const checkAndToggle = async () => {\r\n      try {\r\n        const url = activeTab.url;\r\n        if (!url) return;\r\n        const result = await autoTogglePrivacy(url, 'Normal');\r\n        if (result) {\r\n          // Debug logging removed for production\r\n        }\r\n      } catch {\r\n        // Error already logged in autoTogglePrivacy\r\n      }\r\n    };\r\n\r\n    // Debounce to avoid excessive checks\r\n    const timer = setTimeout(checkAndToggle, 1000);\r\n    return () => clearTimeout(timer);\r\n  }, [activeTab?.url, mode]);\r\n\r\n  useEffect(() => {\r\n    if (!sessionSnapshot) {\r\n      setRestoreSummary(null);\r\n      return;\r\n    }\r\n    // Only show restore banner if there are tabs to restore\r\n    if (sessionSnapshot.tabCount === 0) {\r\n      setRestoreSummary(null);\r\n      setRestoreDismissed(true);\r\n      return;\r\n    }\r\n    if (restoreSummary && restoreSummary.updatedAt === sessionSnapshot.updatedAt) {\r\n      return;\r\n    }\r\n    setRestoreSummary({\r\n      updatedAt: sessionSnapshot.updatedAt,\r\n      windowCount: 1,\r\n      tabCount: sessionSnapshot.tabCount,\r\n    });\r\n    setRestoreDismissed(false);\r\n  }, [sessionSnapshot, restoreSummary]);\r\n\r\n  // Auto-dismiss restore banner after 30 seconds\r\n  useEffect(() => {\r\n    if (!restoreSummary || restoreDismissed) return;\r\n    const timer = setTimeout(() => {\r\n      setRestoreDismissed(true);\r\n    }, 30000); // 30 seconds\r\n    return () => clearTimeout(timer);\r\n  }, [restoreSummary, restoreDismissed]);\r\n\r\n  useEffect(() => {\r\n    if (!restoreToast) return;\r\n    const timeoutId = window.setTimeout(() => {\r\n      setRestoreToast(null);\r\n    }, 6000);\r\n    return () => {\r\n      window.clearTimeout(timeoutId);\r\n    };\r\n  }, [restoreToast]);\r\n\r\n  // Listen for permission requests\r\n  useIPCEvent<PermissionRequest>(\r\n    'permissions:request',\r\n    request => {\r\n      setPermissionRequest(request);\r\n    },\r\n    []\r\n  );\r\n\r\n  // Listen for consent requests\r\n  useIPCEvent<any>(\r\n    'agent:consent:request',\r\n    payload => {\r\n      if (!payload || !payload.id || !payload.action) return;\r\n      const request: ConsentRequest = {\r\n        id: payload.id,\r\n        action: {\r\n          type: payload.action.type,\r\n          description: payload.action.description,\r\n          risk: payload.action.risk ?? 'medium',\r\n        },\r\n        callback: async (approved: boolean) => {\r\n          try {\r\n            if (approved) {\r\n              await ipc.consent.approve(payload.id);\r\n            } else {\r\n              await ipc.consent.revoke(payload.id);\r\n            }\r\n          } catch (error) {\r\n            console.error('Failed to resolve consent:', error);\r\n          } finally {\r\n            setConsentRequest(null);\r\n          }\r\n        },\r\n      };\r\n      setConsentRequest(request);\r\n    },\r\n    []\r\n  );\r\n\r\n  // Listen for fullscreen changes from Electron IPC\r\n  useEffect(() => {\r\n    const handleFullscreen = (data: { fullscreen: boolean }) => {\r\n      setIsFullscreen(data.fullscreen);\r\n    };\r\n\r\n    // Use the IPC event bus\r\n    const unsubscribe = ipcEvents.on<{ fullscreen: boolean }>(\r\n      'app:fullscreen-changed',\r\n      handleFullscreen\r\n    );\r\n\r\n    return unsubscribe;\r\n  }, []);\r\n\r\n  // Global keyboard shortcuts (Windows/Linux: Ctrl, macOS: Cmd)\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;\r\n      const modifier = isMac ? e.metaKey : e.ctrlKey;\r\n\r\n      if (e.key === 'F11') {\r\n        e.preventDefault();\r\n        void ipc.windowControl.toggleFullscreen();\r\n        return;\r\n      }\r\n\r\n      // K / Ctrl+K: Focus Omnibox (primary action - AI omnibar is the hero)\r\n      // Note: TopBar also handles this with capture:true, so this is a fallback\r\n      if (modifier && !e.shiftKey && !e.altKey && e.key.toLowerCase() === 'k') {\r\n        // Let TopBar handle this to focus address bar\r\n        // If omnibox is already focused, then open command palette\r\n        const target = e.target as HTMLElement | null;\r\n        const isWithinOmnibox =\r\n          target?.hasAttribute('data-omnibox-input') ||\r\n          target?.closest('[data-onboarding=\"omnibox\"]');\r\n        if (isWithinOmnibox) {\r\n          e.preventDefault();\r\n          setCommandPaletteOpen(true);\r\n          return;\r\n        }\r\n        // Otherwise, let TopBar handle focusing the address bar\r\n        return;\r\n      }\r\n\r\n      // K / Ctrl+Shift+K: Command Palette (alternative shortcut)\r\n      if (modifier && e.shiftKey && !e.altKey && e.key.toLowerCase() === 'k') {\r\n        e.preventDefault();\r\n        setCommandPaletteOpen(true);\r\n        return;\r\n      }\r\n\r\n      // L / Ctrl+L: Focus URL bar (handled in Omnibox, but ensure it works)\r\n      if (modifier && !e.shiftKey && !e.altKey && e.key.toLowerCase() === 'l') {\r\n        // Let Omnibox handle this, but don't prevent default if it's already handled\r\n        return;\r\n      }\r\n\r\n      // T / Ctrl+T: New Tab\r\n      if (modifier && !e.shiftKey && !e.altKey && e.key.toLowerCase() === 't') {\r\n        e.preventDefault();\r\n        ipc.tabs.create('about:blank').catch(error => {\r\n          if (isDevEnv()) {\r\n            console.error('[AppShell] Failed to create tab:', error);\r\n          }\r\n        });\r\n        return;\r\n      }\r\n\r\n      // W / Ctrl+W: Close Tab\r\n      if (modifier && !e.shiftKey && !e.altKey && e.key.toLowerCase() === 'w') {\r\n        e.preventDefault();\r\n        const state = useTabsStore.getState();\r\n        if (state.activeId) {\r\n          const tab = state.tabs.find(t => t.id === state.activeId);\r\n          if (tab) {\r\n            state.rememberClosedTab(tab);\r\n          }\r\n          ipc.tabs.close({ id: state.activeId }).catch(error => {\r\n            if (isDevEnv()) {\r\n              console.error('[AppShell] Failed to close tab:', error);\r\n            }\r\n          });\r\n        }\r\n        return;\r\n      }\r\n\r\n      // T / Ctrl+Shift+T: Reopen Closed Tab\r\n      if (modifier && e.shiftKey && !e.altKey && e.key.toLowerCase() === 't') {\r\n        e.preventDefault();\r\n        void reopenMostRecentClosedTab();\r\n        return;\r\n      }\r\n\r\n      // A / Ctrl+Shift+A: Toggle Agent Console\r\n      if (modifier && e.shiftKey && !e.altKey && e.key.toLowerCase() === 'a') {\r\n        e.preventDefault();\r\n        setRightPanelOpen(prev => !prev);\r\n        return;\r\n      }\r\n\r\n      // M / Ctrl+Shift+M: Toggle Memory Sidebar\r\n      if (modifier && e.shiftKey && !e.altKey && e.key.toLowerCase() === 'm') {\r\n        e.preventDefault();\r\n        setMemorySidebarOpen(!memorySidebarOpen);\r\n        return;\r\n      }\r\n\r\n      // R / Ctrl+Shift+R: Toggle Regen Sidebar\r\n      if (modifier && e.shiftKey && !e.altKey && e.key.toLowerCase() === 'r') {\r\n        e.preventDefault();\r\n        setRegenSidebarOpen(!regenSidebarOpen);\r\n        return;\r\n      }\r\n\r\n      // L / Ctrl+Shift+L: Toggle Unified Side Panel (History/Bookmarks/Downloads)\r\n      if (modifier && e.shiftKey && !e.altKey && e.key.toLowerCase() === 'l') {\r\n        e.preventDefault();\r\n        setUnifiedSidePanelOpen(!unifiedSidePanelOpen);\r\n        return;\r\n      }\r\n\r\n      // H / Ctrl+Shift+H: Highlight clipper\r\n      if (modifier && e.shiftKey && !e.altKey && e.key.toLowerCase() === 'h') {\r\n        e.preventDefault();\r\n        if (useTabsStore.getState().activeId) {\r\n          setClipperActive(true);\r\n        }\r\n        return;\r\n      }\r\n\r\n      // P / Alt+Ctrl+P: Proxy Menu (opens NetworkButton menu)\r\n      if (modifier && e.altKey && e.key.toLowerCase() === 'p') {\r\n        e.preventDefault();\r\n        // Trigger NetworkButton click via data attribute\r\n        const networkButton = document.querySelector('[data-network-button]') as HTMLElement;\r\n        networkButton?.click();\r\n        return;\r\n      }\r\n\r\n      // S / Alt+Ctrl+S: Shields Menu (opens ShieldsButton menu)\r\n      if (modifier && e.altKey && e.key.toLowerCase() === 's') {\r\n        e.preventDefault();\r\n        // Trigger ShieldsButton click via data attribute\r\n        const shieldsButton = document.querySelector('[data-shields-button]') as HTMLElement;\r\n        shieldsButton?.click();\r\n        return;\r\n      }\r\n\r\n      // F / Ctrl+F: Find in Page (handled by browser)\r\n      if (modifier && !e.shiftKey && !e.altKey && e.key.toLowerCase() === 'f') {\r\n        return;\r\n      }\r\n\r\n      // Ctrl/Cmd + Tab to cycle through tabs\r\n      if (modifier && !e.altKey && e.key === 'Tab') {\r\n        const moved = cycleTab(e.shiftKey ? -1 : 1);\r\n        if (moved) {\r\n          e.preventDefault();\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Ctrl/Cmd + number keys to jump to tab\r\n      if (modifier && !e.altKey && !e.shiftKey) {\r\n        const digit = Number(e.key);\r\n        if (!Number.isNaN(digit) && digit >= 1 && digit <= 9) {\r\n          e.preventDefault();\r\n          if (digit === 9) {\r\n            jumpToTabIndex(0, true);\r\n          } else {\r\n            jumpToTabIndex(digit - 1);\r\n          }\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Alt+ / : Go back (handled by TopBar)\r\n      // Alt+ / : Go forward (handled by TopBar)\r\n      // Ctrl+R / R: Refresh (handled by TopBar)\r\n\r\n      // Esc: Close modals\r\n      if (e.key === 'Escape') {\r\n        if (clipperActive) {\r\n          setClipperActive(false);\r\n        } else if (commandPaletteOpen) {\r\n          setCommandPaletteOpen(false);\r\n        } else if (permissionRequest) {\r\n          setPermissionRequest(null);\r\n        } else if (consentRequest) {\r\n          setConsentRequest(null);\r\n        } else if (rightPanelOpen) {\r\n          setRightPanelOpen(false);\r\n        } else if (memorySidebarOpen) {\r\n          setMemorySidebarOpen(false);\r\n        }\r\n        return;\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [\r\n    commandPaletteOpen,\r\n    permissionRequest,\r\n    consentRequest,\r\n    rightPanelOpen,\r\n    clipperActive,\r\n    memorySidebarOpen,\r\n    cycleTab,\r\n    jumpToTabIndex,\r\n  ]);\r\n\r\n  // Sync memory sidebar state with TopBar and listen for external changes\r\n  useEffect(() => {\r\n    window.dispatchEvent(\r\n      new CustomEvent('memory-sidebar:toggle', { detail: { open: memorySidebarOpen } })\r\n    );\r\n\r\n    const handleMemorySidebarToggle = (event: CustomEvent) => {\r\n      const { open } = event.detail;\r\n      if (open !== memorySidebarOpen) {\r\n        setMemorySidebarOpen(open);\r\n      }\r\n    };\r\n\r\n    window.addEventListener('memory-sidebar:toggle', handleMemorySidebarToggle as EventListener);\r\n    return () => {\r\n      window.removeEventListener(\r\n        'memory-sidebar:toggle',\r\n        handleMemorySidebarToggle as EventListener\r\n      );\r\n    };\r\n  }, [memorySidebarOpen, setMemorySidebarOpen]);\r\n\r\n  const handleCreateHighlight = async (highlight: ResearchHighlight) => {\r\n    if (!activeTab?.url) {\r\n      setClipperActive(false);\r\n      return;\r\n    }\r\n    try {\r\n      const existing = await ipc.research.getNotes(activeTab.url);\r\n      const notes = existing?.notes ?? '';\r\n      const highlights = Array.isArray(existing?.highlights) ? existing.highlights : [];\r\n      await ipc.research.saveNotes(activeTab.url, notes, [...highlights, highlight]);\r\n      ipcEvents.emit('research:highlight-added', { url: activeTab.url, highlight });\r\n    } catch (error) {\r\n      console.error('Failed to save highlight:', error);\r\n    } finally {\r\n      setClipperActive(false);\r\n    }\r\n  };\r\n\r\n  const _handleRestoreSession = async () => {\r\n    if (!restoreSummary || restoreStatus === 'restoring') return;\r\n    setRestoreStatus('restoring');\r\n    try {\r\n      const result = await restoreSessionSnapshot();\r\n      if (result.restored) {\r\n        const restoredCount = result.tabCount ?? restoreSummary?.tabCount ?? 0;\r\n        setRestoreToast({\r\n          message: `Restored ${restoredCount} tab${restoredCount === 1 ? '' : 's'} from last session.`,\r\n          variant: 'success',\r\n        });\r\n        setRestoreDismissed(true);\r\n      } else {\r\n        setRestoreToast({\r\n          message: 'No saved session snapshot available to restore.',\r\n          variant: 'error',\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to restore session snapshot:', error);\r\n      setRestoreToast({\r\n        message: 'Failed to restore session snapshot.',\r\n        variant: 'error',\r\n      });\r\n    } finally {\r\n      setRestoreStatus('idle');\r\n    }\r\n  };\r\n\r\n  const _handleDismissRestore = () => {\r\n    setRestoreDismissed(true);\r\n    setRestoreSummary(null);\r\n  };\r\n\r\n  // Ensure we always render something - never return null or empty\r\n  console.log(\r\n    '[AppShell] Rendering - showTOS:',\r\n    showTOS,\r\n    'showCookieConsent:',\r\n    showCookieConsent,\r\n    'onboardingVisible:',\r\n    onboardingVisible\r\n  );\r\n\r\n  return (\r\n    <div\r\n      className=\"flex w-screen flex-col overflow-hidden bg-slate-950 text-slate-100\"\r\n      style={{ height: 'calc(100vh - var(--bottom-bar-height, 80px))' }}\r\n      data-app-shell=\"true\"\r\n    >\r\n      {/* Top Chrome Elements - Fixed header, never scrolls */}\r\n      <div\r\n        ref={topChromeRef}\r\n        data-top-chrome\r\n        className=\"flex-none shrink-0 border-b border-slate-800 bg-slate-950\"\r\n      >\r\n        {/* Top Navigation - Hidden in fullscreen */}\r\n        {!isFullscreen && (\r\n          <Suspense fallback={<div style={{ height: '40px', backgroundColor: '#0f172a' }} />}>\r\n            <ErrorBoundary\r\n              componentName=\"TopBar\"\r\n              fallback={\r\n                <div\r\n                  style={{\r\n                    height: '40px',\r\n                    backgroundColor: '#0f172a',\r\n                    padding: '8px',\r\n                    color: '#94a3b8',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    fontSize: '12px',\r\n                  }}\r\n                >\r\n                  <span>Loading navigation...</span>\r\n                </div>\r\n              }\r\n            >\r\n              {/* Hide TopBar in Research and Trade modes - they have their own UI */}\r\n              {currentMode !== 'Research' && currentMode !== 'Trade' && (\r\n                <TopBar\r\n                  showAddressBar={true}\r\n                  showQuickActions={true}\r\n                  currentUrl={tabsState.tabs.find(t => t.id === tabsState.activeId)?.url}\r\n                  onModeChange={async (mode: string) => {\r\n                    // Map mode string to AppState mode\r\n                    const modeMap: Record<string, 'Browse' | 'Research' | 'Trade'> = {\r\n                      browse: 'Browse',\r\n                      research: 'Research',\r\n                      trade: 'Trade',\r\n                      dev: 'Browse', // Dev maps to Browse for now\r\n                    };\r\n                    const targetMode = modeMap[mode] || 'Browse';\r\n                    const currentMode = useAppStore.getState().mode;\r\n                    if (targetMode !== currentMode) {\r\n                      // Initialize mode in backend and launch browser if needed\r\n                      try {\r\n                        const { ipc } = await import('../../lib/ipc-typed');\r\n\r\n                        // Initialize mode\r\n                        await (ipc as any).invoke('wispr_command', {\r\n                          input: `Init ${targetMode} mode`,\r\n                          mode: mode.toLowerCase(),\r\n                        });\r\n\r\n                        // Launch browser for mode-specific URLs\r\n                        if (targetMode === 'Trade') {\r\n                          await (ipc as any).invoke('regen_launch', {\r\n                            url: 'https://www.tradingview.com/chart/?symbol=BINANCE:BTCUSDT',\r\n                            mode: 'trade',\r\n                          });\r\n                        } else if (targetMode === 'Research') {\r\n                          await (ipc as any).invoke('regen_launch', {\r\n                            url: 'https://www.google.com',\r\n                            mode: 'research',\r\n                          });\r\n                        }\r\n                      } catch (error) {\r\n                        console.warn('[AppShell] Mode init failed:', error);\r\n                      }\r\n                      await setMode(targetMode);\r\n                    }\r\n                  }}\r\n                  onAddressBarSubmit={async query => {\r\n                    // Handle address bar navigation/search\r\n                    try {\r\n                      const activeTab = tabsState.tabs.find(t => t.id === tabsState.activeId);\r\n                      const isAboutBlank = activeTab?.url === 'about:blank' || !activeTab?.url;\r\n\r\n                      // Use normalizeInputToUrlOrSearch to properly handle URLs vs search queries\r\n                      const { normalizeInputToUrlOrSearch } = await import('../../lib/search');\r\n                      const settings = useSettingsStore.getState();\r\n                      const language = settings.language || 'auto';\r\n                      const searchEngine = settings.searchEngine || 'google';\r\n\r\n                      // Normalize search engine type to match function signature\r\n                      let searchProvider: 'google' | 'duckduckgo' | 'bing' | 'yahoo' = 'google';\r\n                      if (\r\n                        searchEngine === 'duckduckgo' ||\r\n                        searchEngine === 'bing' ||\r\n                        searchEngine === 'yahoo'\r\n                      ) {\r\n                        searchProvider = searchEngine;\r\n                      } else if (searchEngine === 'all' || searchEngine === 'mock') {\r\n                        searchProvider = 'google'; // Default to Google for 'all' or 'mock'\r\n                      }\r\n\r\n                      // Normalize the query to a URL or search URL\r\n                      const targetUrl = normalizeInputToUrlOrSearch(\r\n                        query,\r\n                        searchProvider,\r\n                        language !== 'auto' ? language : undefined\r\n                      );\r\n\r\n                      if (isAboutBlank && activeTab) {\r\n                        await ipc.tabs.navigate(activeTab.id, targetUrl);\r\n                      } else {\r\n                        await ipc.tabs.create(targetUrl);\r\n                      }\r\n                    } catch (error) {\r\n                      console.error('[TopBar] Failed to navigate:', error);\r\n                      toast.error('Failed to navigate');\r\n                    }\r\n                  }}\r\n                />\r\n              )}\r\n            </ErrorBoundary>\r\n          </Suspense>\r\n        )}\r\n\r\n        {isOffline && (\r\n          <div className=\"flex items-center justify-between gap-3 border-b border-amber-500/40 bg-amber-500/15 px-4 py-2 text-xs text-amber-100 sm:text-sm\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <AlertTriangle size={14} className=\"flex-shrink-0 text-amber-300\" />\r\n              <span>\r\n                Offline mode: remote AI and sync are paused. Local actions remain available.\r\n              </span>\r\n            </div>\r\n            {ollamaAvailable && (\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => {\r\n                  const settingsButton = document.querySelector(\r\n                    '[data-settings-button]'\r\n                  ) as HTMLElement;\r\n                  settingsButton?.click();\r\n                }}\r\n                className=\"flex items-center gap-1.5 rounded-md border border-amber-400/40 bg-amber-500/20 px-2.5 py-1 text-[11px] font-medium text-amber-100 transition-colors hover:border-amber-400/60 hover:bg-amber-500/30\"\r\n              >\r\n                <span>Try Local AI</span>\r\n              </button>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Restore Banner and TabStrip */}\r\n        {!isFullscreen && (\r\n          <>\r\n            {/* HIDDEN: Restore session banner (kills premium feel - Chrome 2015 vibes) */}\r\n            {/* Banner removed - it looked like Chrome 2015 and killed the premium feel */}\r\n            {/* Hide TabStrip in Research and Trade modes - they have their own UI */}\r\n            {currentMode !== 'Research' && currentMode !== 'Trade' && (\r\n              <Suspense fallback={null}>\r\n                <ErrorBoundary componentName=\"TabStrip\">\r\n                  <div className=\"relative z-50 w-full\" style={{ pointerEvents: 'auto' }}>\r\n                    <TabStrip />\r\n                  </div>\r\n                </ErrorBoundary>\r\n              </Suspense>\r\n            )}\r\n            {showWebContent && !isDesktopLayout && (\r\n              <div className=\"flex items-center justify-end gap-2 px-3 py-2 text-xs text-slate-300 sm:px-4\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setToolsDrawerOpen(true)}\r\n                  className=\"inline-flex items-center gap-2 rounded-full border border-slate-700/60 bg-slate-900/70 px-3 py-1.5 font-medium text-slate-100 shadow-sm transition hover:border-slate-500/70\"\r\n                >\r\n                  <PanelsTopLeft size={14} />\r\n                  <span>Workspace tools</span>\r\n                </button>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setRightPanelOpen(true)}\r\n                  className=\"inline-flex items-center gap-2 rounded-full border border-slate-700/60 bg-slate-900/70 px-3 py-1.5 font-medium text-slate-100 shadow-sm transition hover:border-slate-500/70\"\r\n                >\r\n                  <PanelRightOpen size={14} />\r\n                  <span>Agent console</span>\r\n                </button>\r\n              </div>\r\n            )}\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      {/* Main Layout - Content area that fills remaining space */}\r\n      <div className=\"flex min-h-0 w-full flex-1 overflow-hidden bg-slate-950\">\r\n        {/* Center Content - Full Width, only this area scrolls */}\r\n        <div className=\"content-wrapper flex min-w-0 flex-1 flex-col overflow-hidden\">\r\n          {/* Route/Web Content */}\r\n          {showWebContent ? (\r\n            <div className=\"flex min-h-0 min-w-0 flex-1 overflow-hidden bg-slate-950\">\r\n              {/* Webview container - fills remaining space, only this scrolls */}\r\n              {/* PR: Fix tab switch - Ensure frame area has proper z-index and pointer-events */}\r\n              <div\r\n                className=\"webview-container relative flex min-h-0 min-w-0 flex-1 overflow-hidden bg-slate-950\"\r\n                style={{ zIndex: 0, position: 'relative' }}\r\n              >\r\n                {/* PR: Fix tab switch - use iframe-per-tab manager for Tauri, TabContentSurface for Electron */}\r\n                {isTauriRuntime() ? (\r\n                  <TabIframeManager tabs={tabsState.tabs} activeTabId={tabsState.activeId} />\r\n                ) : (\r\n                  <TabContentSurface tab={activeTab} overlayActive={overlayActive} />\r\n                )}\r\n              </div>\r\n              {shouldShowInlineToolsPanel && (\r\n                <>\r\n                  <div\r\n                    onMouseDown={handleResizeStart}\r\n                    className=\"z-20 h-full w-[6px] flex-shrink-0 cursor-col-resize items-center justify-center bg-slate-900/50 transition-colors hover:bg-slate-800\"\r\n                  >\r\n                    <div className=\"h-24 w-[2px] rounded-full bg-slate-700/80\" />\r\n                  </div>\r\n                  <div className=\"relative w-[320px] min-w-[300px] max-w-sm flex-shrink-0 overflow-hidden border-l border-slate-800/60 bg-slate-950/40\">\r\n                    <div className=\"h-full min-h-0 overflow-y-auto\">\r\n                      <Outlet />\r\n                    </div>\r\n                  </div>\r\n                </>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <div\r\n              className={`min-h-0 min-w-0 flex-1 overflow-hidden bg-slate-950 ${isFullscreen ? 'absolute inset-0' : ''}`}\r\n            >\r\n              {/* Route content - fills remaining space, scrollable */}\r\n              <div\r\n                className={`h-full w-full overflow-auto bg-slate-950 ${overlayActive ? 'webview--masked' : ''}`}\r\n              >\r\n                <Outlet />\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Right Panel (Agent Console) */}\r\n        {!isFullscreen && isDesktopLayout && rightPanelOpen && (\r\n          <Suspense fallback={null}>\r\n            <ErrorBoundary componentName=\"RightPanel\">\r\n              <div\r\n                className=\"h-full min-h-0 w-[340px] max-w-[380px] overflow-y-auto border-l border-slate-800/60\"\r\n                data-sidebar\r\n              >\r\n                <RightPanel open={rightPanelOpen} onClose={() => setRightPanelOpen(false)} />\r\n              </div>\r\n            </ErrorBoundary>\r\n          </Suspense>\r\n        )}\r\n      </div>\r\n\r\n      {/* Bottom Chrome - Fixed footer, never scrolls */}\r\n      <div\r\n        ref={bottomChromeRef}\r\n        id=\"bottomBar\"\r\n        className=\"fixed bottom-0 left-0 right-0 z-50 flex-none shrink-0 border-t border-slate-800 bg-slate-950\"\r\n        style={{\r\n          boxShadow: '0 -6px 24px rgba(0,0,0,0.35)',\r\n          background: 'linear-gradient(180deg, rgba(15,23,42,0.96), rgba(10,12,16,0.96))',\r\n        }}\r\n      >\r\n        {!isFullscreen && currentMode === 'Browse' && (\r\n          <Suspense fallback={null}>\r\n            <ErrorBoundary componentName=\"BottomStatus\">\r\n              <BottomStatus />\r\n            </ErrorBoundary>\r\n          </Suspense>\r\n        )}\r\n      </div>\r\n\r\n      {!isFullscreen && !isDesktopLayout && showWebContent && (\r\n        <MobileDock\r\n          activeMode={currentMode}\r\n          onSelectMode={setMode}\r\n          onOpenLibrary={() => setUnifiedSidePanelOpen(true)}\r\n          onOpenAgent={() => setRightPanelOpen(true)}\r\n        />\r\n      )}\r\n\r\n      {/* Agent Overlay */}\r\n      <Suspense fallback={null}>\r\n        <Portal>\r\n          <ErrorBoundary componentName=\"AgentOverlay\">\r\n            <AgentOverlay />\r\n          </ErrorBoundary>\r\n        </Portal>\r\n      </Suspense>\r\n\r\n      <Suspense fallback={null}>\r\n        <Portal>\r\n          <ErrorBoundary componentName=\"ClipperOverlay\">\r\n            <ClipperOverlay\r\n              active={clipperActive}\r\n              onCancel={() => setClipperActive(false)}\r\n              onCreateHighlight={handleCreateHighlight}\r\n            />\r\n          </ErrorBoundary>\r\n        </Portal>\r\n      </Suspense>\r\n\r\n      <Suspense fallback={null}>\r\n        <Portal>\r\n          <ErrorBoundary componentName=\"ReaderOverlay\">\r\n            <ReaderOverlay\r\n              active={readerActive}\r\n              onClose={() => setReaderActive(false)}\r\n              tabId={tabsState.activeId}\r\n              url={activeTab?.url}\r\n            />\r\n          </ErrorBoundary>\r\n        </Portal>\r\n      </Suspense>\r\n\r\n      {graphDropHint && (\r\n        <Portal>\r\n          <div className=\"pointer-events-none fixed inset-0 z-tour flex items-center justify-center\">\r\n            <div className=\"rounded-3xl border border-purple-500/40 bg-purple-900/50 px-8 py-6 text-center shadow-[0_0_60px_rgba(168,85,247,0.35)] backdrop-blur-sm\">\r\n              <div className=\"text-[11px] uppercase tracking-[0.3em] text-purple-200/70\">\r\n                Tab graph\r\n              </div>\r\n              <div className=\"mt-2 text-lg font-semibold text-purple-100\">\r\n                Drop to map this tab&apos;s DNA\r\n              </div>\r\n              <div className=\"mt-1 text-xs text-purple-200/80\">\r\n                Release anywhere to open the graph overlay.\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </Portal>\r\n      )}\r\n\r\n      <Suspense fallback={null}>\r\n        <Portal>\r\n          <ErrorBoundary componentName=\"TabGraphOverlay\">\r\n            <TabGraphOverlay />\r\n          </ErrorBoundary>\r\n        </Portal>\r\n      </Suspense>\r\n\r\n      {/* Regen Whisper - Voice Tips */}\r\n      {!isFullscreen && (\r\n        <Suspense fallback={null}>\r\n          {/* VoiceTips disabled by user request */}\r\n          {/* Voice components removed by user request */}\r\n        </Suspense>\r\n      )}\r\n\r\n      {consentVisible && (\r\n        <Suspense fallback={null}>\r\n          <Portal>\r\n            <ErrorBoundary componentName=\"ConsentDashboard\">\r\n              <ConsentDashboard />\r\n            </ErrorBoundary>\r\n          </Portal>\r\n        </Suspense>\r\n      )}\r\n\r\n      {trustDashboardVisible && (\r\n        <Suspense fallback={null}>\r\n          <Portal>\r\n            <ErrorBoundary componentName=\"TrustEthicsDashboard\">\r\n              <TrustEthicsDashboard />\r\n            </ErrorBoundary>\r\n          </Portal>\r\n        </Suspense>\r\n      )}\r\n\r\n      {/* Research Tour - Only show if TOS and Cookie Consent are not showing */}\r\n      {onboardingVisible && !showTOS && !showCookieConsent && (\r\n        <Suspense fallback={null}>\r\n          <Portal>\r\n            <ErrorBoundary componentName=\"ResearchTour\">\r\n              <ResearchTour\r\n                onClose={() => {\r\n                  // Component already calls finishOnboarding() before onClose()\r\n                  // This callback is just for cleanup if needed\r\n                }}\r\n              />\r\n            </ErrorBoundary>\r\n          </Portal>\r\n        </Suspense>\r\n      )}\r\n\r\n      {/* Overlays */}\r\n      {commandPaletteOpen && (\r\n        <Suspense fallback={null}>\r\n          <Portal>\r\n            <ErrorBoundary componentName=\"CommandPalette\">\r\n              <CommandPalette onClose={() => setCommandPaletteOpen(false)} />\r\n            </ErrorBoundary>\r\n          </Portal>\r\n        </Suspense>\r\n      )}\r\n\r\n      {permissionRequest && (\r\n        <Suspense fallback={null}>\r\n          <Portal>\r\n            <ErrorBoundary componentName=\"PermissionPrompt\">\r\n              <PermissionPrompt\r\n                request={permissionRequest}\r\n                onClose={() => setPermissionRequest(null)}\r\n              />\r\n            </ErrorBoundary>\r\n          </Portal>\r\n        </Suspense>\r\n      )}\r\n\r\n      {consentRequest && (\r\n        <Suspense fallback={null}>\r\n          <Portal>\r\n            <ErrorBoundary componentName=\"ConsentPrompt\">\r\n              <ConsentPrompt request={consentRequest} onClose={() => setConsentRequest(null)} />\r\n            </ErrorBoundary>\r\n          </Portal>\r\n        </Suspense>\r\n      )}\r\n      {/* Crash Recovery Dialog */}\r\n      {crashedTab && (\r\n        <CrashRecoveryDialog\r\n          tabId={crashedTab.tabId}\r\n          reason={crashedTab.reason}\r\n          exitCode={crashedTab.exitCode}\r\n          onClose={() => setCrashedTab(null)}\r\n          onReload={handleReload}\r\n        />\r\n      )}\r\n\r\n      {/* Memory Sidebar - Collapsible in Research Mode, hidden in other modes */}\r\n      {currentMode === 'Research' && (\r\n        <ResearchMemoryPanel\r\n          open={memorySidebarOpen}\r\n          onClose={() => {\r\n            setMemorySidebarOpen(false);\r\n            // Dispatch event for TopBar to sync state\r\n            window.dispatchEvent(\r\n              new CustomEvent('memory-sidebar:toggle', { detail: { open: false } })\r\n            );\r\n          }}\r\n          onCreateMemory={() => {\r\n            // Handled by ResearchMemoryPanel internally via CreateMemoryDialog\r\n          }}\r\n        />\r\n      )}\r\n      {/* TradeSidebar - Hidden in Trade Mode (clean UI) */}\r\n      {currentMode !== 'Trade' && (\r\n        <TradeSidebar open={tradeSidebarOpen} onClose={() => setTradeSidebarOpen(false)} />\r\n      )}\r\n\r\n      {/* Regen Sidebar */}\r\n      {!isFullscreen && isDesktopLayout && regenSidebarOpen && (\r\n        <Suspense fallback={null}>\r\n          <ErrorBoundary componentName=\"RegenSidebar\">\r\n            <RegenSidebarWrapper />\r\n          </ErrorBoundary>\r\n        </Suspense>\r\n      )}\r\n\r\n      {/* Redix Debug Panel - Dev Only */}\r\n      {isDev && RedixDebugPanel && (\r\n        <Suspense fallback={null}>\r\n          <RedixDebugPanel open={redixDebugOpen} onClose={() => setRedixDebugOpen(false)} />\r\n        </Suspense>\r\n      )}\r\n      <SuspensionIndicator />\r\n      <BatteryIndicator />\r\n      <div className=\"fixed bottom-6 left-1/2 z-[105] w-full max-w-3xl -translate-x-1/2 px-4\">\r\n        <MemoryMonitor />\r\n      </div>\r\n\r\n      {/* Voice Companion - Disabled by user request */}\r\n      {/* Voice components removed by user request */}\r\n\r\n      {restoreToast && (\r\n        <Portal>\r\n          <div className=\"fixed bottom-6 right-6 z-50\">\r\n            <div\r\n              className={`rounded-xl border px-4 py-3 text-sm shadow-xl shadow-black/40 ${\r\n                restoreToast.variant === 'success'\r\n                  ? 'border-emerald-400/40 bg-emerald-500/15 text-emerald-100'\r\n                  : 'border-amber-400/40 bg-amber-500/15 text-amber-100'\r\n              }`}\r\n            >\r\n              {restoreToast.message}\r\n            </div>\r\n          </div>\r\n        </Portal>\r\n      )}\r\n\r\n      {/* Terms of Service Acceptance */}\r\n      {showTOS && <TermsAcceptance onAccept={handleTOSAccept} onDecline={handleTOSDecline} />}\r\n\r\n      {/* Cookie Consent Banner - Only show if TOS is not showing and onboarding is not active */}\r\n      {showCookieConsent && !showTOS && !onboardingVisible && (\r\n        <CookieConsent\r\n          onAccept={preferences => {\r\n            console.log('[AppShell] Cookie consent accepted:', preferences);\r\n            localStorage.setItem('regen:cookie-consent', JSON.stringify(preferences));\r\n            // Force a small delay to ensure localStorage is written and state updates\r\n            setTimeout(() => {\r\n              setShowCookieConsent(false);\r\n              console.log('[AppShell] Cookie consent modal closed, onboarding should start now');\r\n              // Force a re-check of onboarding after cookie consent is closed\r\n              // The useEffect should trigger automatically, but we'll log to confirm\r\n              console.log('[AppShell] State after cookie consent:', {\r\n                showTOS,\r\n                showCookieConsent: false,\r\n                hasConsented,\r\n                onboardingVisible,\r\n              });\r\n            }, 100);\r\n          }}\r\n          onDecline={() => {\r\n            console.log('[AppShell] Cookie consent declined');\r\n            // Save minimal consent (essential only)\r\n            const minimal: CookiePreferences = {\r\n              essential: true,\r\n              analytics: false,\r\n              functional: false,\r\n              advertising: false,\r\n              timestamp: Date.now(),\r\n              version: '2025-12-17',\r\n            };\r\n            localStorage.setItem('regen:cookie-consent', JSON.stringify(minimal));\r\n            setTimeout(() => {\r\n              setShowCookieConsent(false);\r\n              console.log('[AppShell] Cookie consent modal closed, onboarding should start now');\r\n            }, 100);\r\n          }}\r\n        />\r\n      )}\r\n      <ToastHost />\r\n\r\n      {/* Tier 1: Session Restore Modal */}\r\n      <Suspense fallback={null}>\r\n        <SessionRestoreModal />\r\n      </Suspense>\r\n\r\n      {/* Loop Resume Modal */}\r\n      <LoopResumeModal open={loopResumeModalOpen} onClose={() => setLoopResumeModalOpen(false)} />\r\n\r\n      {/* Workflow Marketplace */}\r\n      <WorkflowMarketplace\r\n        open={workflowMarketplaceOpen}\r\n        onClose={() => setWorkflowMarketplaceOpen(false)}\r\n      />\r\n\r\n      <GlobalSearch />\r\n      <WisprOrb />\r\n      <OmniModeSwitcher />\r\n\r\n      {/* Mini Hover AI - Text selection assistant */}\r\n      <MiniHoverAI enabled={!overlayActive && showWebContent} />\r\n\r\n      {/* Unified Side Panel - History, Bookmarks, Downloads */}\r\n      {!isFullscreen && isDesktopLayout && (\r\n        <UnifiedSidePanel\r\n          open={unifiedSidePanelOpen}\r\n          onClose={() => setUnifiedSidePanelOpen(false)}\r\n        />\r\n      )}\r\n\r\n      {/* Tier 3: Global Command Bar */}\r\n      <CommandBar />\r\n\r\n      {/* Quick Command Palette (Cmd+K / Ctrl+K) */}\r\n      <QuickCommandPalette />\r\n\r\n      {/* Tier 3: Onboarding Flow - Legacy fallback, only if ResearchTour is not available */}\r\n      {/* ResearchTour is the primary onboarding component, so this is kept as fallback only */}\r\n\r\n      {/* Session Restore Prompt - Hidden in Browse mode (shows as toast instead) */}\r\n      {currentMode !== 'Browse' && <SessionRestorePrompt />}\r\n\r\n      {/* First Launch Installer */}\r\n      {showInstaller && (\r\n        <InstallProgressModal\r\n          onComplete={async () => {\r\n            const { markSetupComplete } = await import('../../core/installer/firstLaunch');\r\n            markSetupComplete();\r\n            setShowInstaller(false);\r\n            toast.success('Setup complete! Your AI brain is ready.');\r\n          }}\r\n          onError={error => {\r\n            console.error('[AppShell] Installer error:', error);\r\n            toast.error(\r\n              `Setup failed: ${error.message}. You can install Ollama manually from ollama.com`\r\n            );\r\n            // Don't close installer - let user retry or skip\r\n          }}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"file":"AppShell-CJtR0Pw4.js"}