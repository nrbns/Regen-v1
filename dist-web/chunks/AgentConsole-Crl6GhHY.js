const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/automationBridge-DqKbbR2V.js","chunks/core-ai-yFIunLTZ.js","chunks/vendor-zustand-BWsgwsXr.js","chunks/vendor-react-gmX1Lmvt.js","chunks/vendor-react-dom-Bkb6jJ_S.js","chunks/vendor-Vl2WtvH-.js","chunks/mode-manager.ts-DwguZmJt.js","chunks/core-memory-DmK-uh9X.js"])))=>i.map(i=>d[i]);
import{x as X,m as F,u as le,y as z,a as ie,o as ce,z as de,e as ue,A as W,B as q,_ as H}from"./core-ai-yFIunLTZ.js";import{r as n,j as t,m as me,S as Y,i as ge,F as pe,at as xe,B as fe,g as he,a$ as be,l as ye,u as we,P as ve}from"./vendor-react-gmX1Lmvt.js";import{u as je,A as Ne}from"./mode-research-BclgCwOH.js";import{t as ke,M as Se,f as D,s as Ae}from"./core-memory-DmK-uh9X.js";import{m as h,A as G}from"./vendor-framer-motion-DDE19Uim.js";import"./vendor-zustand-BWsgwsXr.js";import"./vendor-Vl2WtvH-.js";import"./mode-manager.ts-DwguZmJt.js";import"./vendor-react-dom-Bkb6jJ_S.js";import"./vendor-utils-5Vdoy44w.js";import"./mode-docs-FcsoolLb.js";import"./vendor-pdf-ejcqEZLU.js";import"./vendor-mammoth-BPQIafDs.js";const Ce=[{id:"trade",label:"Trade",icon:me,description:"Market analysis, signals, order execution"},{id:"research",label:"Research",icon:Y,description:"Multi-source search, citations, verification"},{id:"dev",label:"Dev",icon:ge,description:"Code extraction, auto-debug, profiling"},{id:"document",label:"Document",icon:pe,description:"PDF/Doc insights, table extraction"},{id:"workflow",label:"Workflow",icon:xe,description:"Arc-like automated workflows"}];function Ie({onAgentSelect:m,defaultMode:N="research"}){const[u,b]=n.useState(N),[l,w]=n.useState([]);return n.useEffect(()=>{const o=X.getCapabilities(u,{mode:u});w(o),m?.(u,o)},[u,m]),t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsx("div",{className:"flex flex-wrap gap-2",children:Ce.map(o=>{const S=o.icon,g=u===o.id;return t.jsxs("button",{onClick:()=>b(o.id),className:`flex items-center gap-2 rounded-lg border px-4 py-2 transition-all ${g?"border-emerald-500 bg-emerald-500/20 text-emerald-400":"border-neutral-700 bg-neutral-800/50 text-neutral-300 hover:border-neutral-600"} `,children:[t.jsx(S,{className:"h-4 w-4"}),t.jsx("span",{className:"font-medium",children:o.label})]},o.id)})}),l.length>0&&t.jsxs("div",{className:"rounded-lg bg-neutral-800/50 p-4",children:[t.jsx("h3",{className:"mb-2 text-sm font-semibold text-neutral-300",children:"Capabilities"}),t.jsx("ul",{className:"flex flex-wrap gap-2",children:l.map(o=>t.jsx("li",{className:"rounded-full bg-neutral-700/50 px-3 py-1 text-xs text-neutral-400",children:o},o))})]})]})}function Ee(){const{stagehand:m,execute:N,click:u,type:b,extract:l,navigate:w}=je({context:"agent"});return n.useEffect(()=>(typeof window<"u"&&(window.agentStagehand={stagehand:m,execute:N,click:u,type:b,extract:l,navigate:w,runTask:async o=>{await b('textarea[name="task"]',o),await u('button[type="submit"]')},getLogs:async()=>await l(".agent-logs"),cancel:async()=>{await u('button[data-action="cancel"]')}}),()=>{typeof window<"u"&&delete window.agentStagehand}),[m,N,u,b,l,w]),null}function Ve(){const[m,N]=n.useState(null),[u,b]=n.useState([]),[l,w]=n.useState(""),[o,S]=n.useState(""),[g,v]=n.useState(!1),[Z,J]=n.useState("idle"),E=n.useRef(null),T=n.useRef(JSON.stringify({goal:"Open example.com",steps:[{skill:"navigate",args:{url:"https://example.com"}}],output:{type:"json",schema:{}}},null,2)),x=n.useRef(null),A=n.useRef(""),y=n.useRef(null),{status:ee,transcript:f,events:V,setRun:B,setStatus:p,appendTranscript:_,reset:K,runId:Te}=F(),L=le(e=>e.language||"auto"),C=z(e=>e.entries.filter(a=>a.agentId==="agent.console").slice(0,5)),[O,te]=n.useState("research"),{activeId:P,tabs:se}=ie(),Q=se.find(e=>e.id===P);n.useEffect(()=>{const e=ce();e.length>0&&console.log("[AgentConsole] Found",e.length,"crashed loops")},[]),n.useEffect(()=>()=>{q()},[]),n.useEffect(()=>{E.current&&(l||f)&&(E.current.scrollTop=E.current.scrollHeight)},[l,f]),n.useEffect(()=>{A.current=l||f||""},[l,f]),n.useEffect(()=>{const e=(r=>{const{runId:d,dsl:j}=r.detail;j&&(T.current=JSON.stringify(j,null,2),S(j.goal||"Execute automation"),H(async()=>{const{updateAutomationStatus:s}=await import("./automationBridge-DqKbbR2V.js");return{updateAutomationStatus:s}},__vite__mapDeps([0,1,2,3,4,5,6,7])).then(({updateAutomationStatus:s})=>{s(d,{progress:10})}),setTimeout(()=>{M()},100))}),a=(()=>{y.current&&(y.current.abort(),v(!1),p("idle"))});return window.addEventListener("agent:execute",e),window.addEventListener("agent:cancel",a),()=>{window.removeEventListener("agent:execute",e),window.removeEventListener("agent:cancel",a)}},[M,p]);const k=n.useCallback((e,a)=>{const r=x.current;if(!r)return;const d=Math.round(performance.now()-r.startedAt);ke(`agent_stream_${e}`,{source:"AgentConsole",queryLength:r.query.length,latencyMs:d,provider:a?.provider??r.provider??"unknown",model:a?.model??r.model??"unknown",promptTokens:a?.promptTokens??void 0,completionTokens:a?.completionTokens??void 0,totalTokens:a?.totalTokens??void 0,outputChars:A.current.length||void 0,error:a?.error}).catch(()=>{}),x.current=null},[]),$=n.useCallback(async e=>{try{z.getState().addEntry({agentId:"agent.console",runId:e.runId,prompt:e.prompt,response:e.response,error:e.error,success:e.success,tokens:e.usage?{prompt:e.usage.prompt_tokens??null,completion:e.usage.completion_tokens??null,total:e.usage.total_tokens??null}:void 0})}catch(a){console.warn("[AgentConsole] Failed to update agent memory store:",a)}if(!(typeof window>"u"))try{await Se.saveEvent({type:"agent",value:e.response||e.error||e.prompt,metadata:{action:e.prompt,runId:e.runId,skill:"agent.console",result:e.response,error:e.error,duration:e.durationMs,tokensUsed:e.usage?.total_tokens??void 0,promptTokens:e.usage?.prompt_tokens,completionTokens:e.usage?.completion_tokens,success:e.success}})}catch(a){console.warn("[AgentConsole] Failed to persist console memory:",a)}},[]),re=n.useCallback(()=>{try{z.getState().clearAgent("agent.console")}catch(e){console.warn("[AgentConsole] Failed to clear agent console history:",e)}},[]);n.useEffect(()=>{if(typeof window>"u"||!window.agent){console.warn("[AgentConsole] window.agent not available");return}const e=r=>{b(d=>[...d,r]),r.type==="token"&&r.text&&_(r.text)},a=async r=>{b(d=>[...d,r]),F.getState().appendEvent({id:`event_${Date.now()}_${Math.random()}`,type:"step",step:r.idx,status:r.skill,content:r.res?JSON.stringify(r.res):void 0,timestamp:Date.now()});try{await D("step_complete",{runId:m||void 0,skill:r.skill,step:r.idx,result:r.res?JSON.stringify(r.res).substring(0,200):void 0})}catch(d){console.warn("[AgentConsole] Failed to track agent step:",d)}};try{window.agent.onToken(e),window.agent.onStep(a)}catch(r){console.error("[AgentConsole] Failed to register agent handlers:",r)}return()=>{}},[_,m]);const M=n.useCallback(async()=>{const e=o.trim();if(!e||g)return;K(),w(""),v(!0),p("connecting");const a=new AbortController;y.current=a,x.current={startedAt:performance.now(),query:e};const r=`agent-stream-${Date.now()}-${Math.random().toString(36).slice(2,8)}`;B(r,e,P);try{const s=await X.execute(O,e,{mode:O,tabId:P,url:Q?.url,sessionId:Q?.sessionId});s.actions&&s.actions.length>0&&console.log("[AgentConsole] Agent generated actions:",s.actions)}catch(s){console.error("[AgentConsole] Multi-agent execution failed:",s)}de({language:L,mode:"agent"});try{await D("stream_start",{action:e,skill:"stream"})}catch(s){console.warn("[AgentConsole] Failed to track agent action:",s)}const d={mode:"agent-console"};C.length>0&&(d.agent_runs=C.slice(0,3).map(s=>({prompt:s.prompt,response:s.response,success:s.success,error:s.error,createdAt:s.createdAt})));let j=[];try{j=(await Ae(e,{limit:5,minSimilarity:.6})).map(c=>({value:c.event.value,metadata:c.event.metadata,id:c.event.id,type:c.event.type,similarity:c.similarity}))}catch(s){console.warn("[AgentConsole] Failed to fetch memory context:",s)}j.length>0&&(d.memories=j);try{let s=null,c=null,R=!1;if(await ue.runTask({kind:"agent",prompt:e,context:d,mode:"agent-console",metadata:{surface:"agent-console"},llm:{temperature:.2,maxTokens:900},signal:a.signal},i=>{i.type==="token"&&typeof i.data=="string"?(R||(R=!0,p("live")),w(I=>`${I}${i.data}`),_(i.data)):i.type==="done"?i.data&&typeof i.data!="string"?s=i.data:typeof i.data=="string"&&(s={text:i.data,provider:"unknown",model:"unknown"}):i.type==="error"&&(c=typeof i.data=="string"?i.data:"AI stream failed")}),y.current=null,a.signal.aborted){v(!1),k("cancelled");return}if(c){const i=x.current?Math.round(performance.now()-x.current.startedAt):void 0;await $({prompt:e,runId:r,success:!1,error:c,response:A.current||l||void 0,durationMs:i}),v(!1),p("error"),F.getState().setError(c),W({mode:"agent",metadata:{language:L}}),q(),k("error",{error:c}),H(async()=>{const{completeAutomation:I}=await import("./automationBridge-DqKbbR2V.js");return{completeAutomation:I}},__vite__mapDeps([0,1,2,3,4,5,6,7])).then(({completeAutomation:I})=>{I(r,void 0,c)}).catch(()=>{});return}const U=s?.text??A.current??l??"",oe=x.current?Math.round(performance.now()-x.current.startedAt):void 0;W({mode:"agent",status:"complete",metadata:{language:L}}),q(),await $({prompt:e,runId:r,success:!0,response:U,usage:s?.usage,durationMs:oe}),v(!1),p("complete"),k("success",{provider:s?.provider,model:s?.model,promptTokens:s?.usage?.prompt_tokens??null,completionTokens:s?.usage?.completion_tokens??null,totalTokens:s?.usage?.total_tokens??null}),H(async()=>{const{completeAutomation:i}=await import("./automationBridge-DqKbbR2V.js");return{completeAutomation:i}},__vite__mapDeps([0,1,2,3,4,5,6,7])).then(({completeAutomation:i})=>{i(r,{output:U,result:s})}).catch(()=>{})}catch(s){if(y.current=null,a.signal.aborted){k("cancelled");return}const c=s instanceof Error?s.message:String(s),R=x.current?Math.round(performance.now()-x.current.startedAt):void 0;await $({prompt:e,runId:r,success:!1,error:c,response:A.current||l||void 0,durationMs:R}),v(!1),p("error"),F.getState().setError(c),k("error",{error:c});try{await D("stream_error",{action:e,error:c})}catch{}}},[o,g,K,p,B,_,k,C]),ae=n.useCallback(()=>{y.current&&(y.current.abort(),y.current=null,v(!1),p("complete"))},[p]),ne=n.useCallback(async()=>{const e=l||f;if(e)try{await navigator.clipboard.writeText(e),J("copied"),setTimeout(()=>J("idle"),2e3)}catch(a){console.error("Failed to copy:",a)}},[l,f]);return t.jsxs("div",{className:"flex h-full flex-col gap-4 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"rounded-xl border border-blue-500/40 bg-blue-500/10 p-2",children:t.jsx(fe,{size:20,className:"text-blue-300"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl font-semibold text-gray-100",children:"Agent Console"}),t.jsx("p",{className:"text-xs text-gray-400",children:"Stream AI responses and manage agent runs"})]})]}),t.jsx("div",{className:"flex items-center gap-2",children:ee==="live"&&t.jsxs(h.span,{className:"inline-flex items-center gap-2 rounded-full border border-emerald-500/40 bg-emerald-500/15 px-3 py-1 text-xs text-emerald-100",animate:{opacity:[1,.7,1]},transition:{duration:1.5,repeat:1/0},children:[t.jsx("span",{className:"h-2 w-2 rounded-full bg-emerald-400"}),"Streaming"]})})]}),t.jsxs("div",{className:"grid flex-1 grid-cols-1 gap-4 lg:grid-cols-2",children:[t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/40 p-4",children:[t.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-300",children:"Agent Mode"}),t.jsx(Ie,{defaultMode:O,onAgentSelect:(e,a)=>{te(e),console.log("[AgentConsole] Selected agent:",e,"Capabilities:",a)}})]}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Ask Redix"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx("input",{id:"agent-console-query",name:"agent-console-query",type:"text",value:o,onChange:e=>S(e.target.value),onKeyDown:e=>{e.key==="Enter"&&!e.shiftKey&&!g&&(e.preventDefault(),M())},placeholder:"Ask anything... (e.g., 'summarize quantum computing trends')",disabled:g,className:"w-full rounded-xl border border-slate-700/60 bg-slate-800/70 px-4 py-3 text-sm text-gray-100 placeholder:text-gray-500 focus:border-blue-500/60 focus:outline-none focus:ring-1 focus:ring-blue-500/40 disabled:opacity-50"}),g&&t.jsx(h.div,{className:"absolute right-3 top-1/2 -translate-y-1/2",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:t.jsx(he,{size:16,className:"text-blue-400"})})]}),g?t.jsxs(h.button,{onClick:ae,whileHover:{scale:1.05},whileTap:{scale:.95},className:"inline-flex items-center gap-2 rounded-xl border border-red-500/60 bg-red-500/20 px-4 py-3 text-sm font-medium text-red-100 transition hover:bg-red-500/30",children:[t.jsx(be,{size:16}),"Stop"]}):t.jsxs(h.button,{onClick:M,disabled:!o.trim(),whileHover:{scale:o.trim()?1.05:1},whileTap:{scale:o.trim()?.95:1},className:"inline-flex items-center gap-2 rounded-xl border border-blue-500/60 bg-blue-500/20 px-4 py-3 text-sm font-medium text-blue-100 transition hover:bg-blue-500/30 disabled:cursor-not-allowed disabled:opacity-40",children:[t.jsx(ye,{size:16}),"Send"]})]})]}),t.jsxs("details",{className:"rounded-xl border border-slate-700/60 bg-slate-900/40",children:[t.jsx("summary",{className:"cursor-pointer px-4 py-2 text-sm font-medium text-gray-300 hover:text-gray-100",children:"Advanced: Agent DSL"}),t.jsxs("div",{className:"border-t border-slate-700/60 p-4",children:[t.jsx("textarea",{id:"agent-dsl-editor",name:"agent-dsl",className:"h-48 w-full rounded-lg border border-slate-700/60 bg-slate-800/70 p-3 font-mono text-xs text-gray-200 focus:border-blue-500/60 focus:outline-none",defaultValue:T.current,onChange:e=>T.current=e.target.value}),t.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[t.jsx("button",{className:"rounded-lg border border-indigo-500/60 bg-indigo-500/20 px-3 py-1.5 text-xs font-medium text-indigo-100 transition hover:bg-indigo-500/30",onClick:async()=>{if(typeof window>"u"||!window.agent){alert("Agent API not available. Please ensure you are running in Electron.");return}try{const e=JSON.parse(T.current),a=await window.agent.start(e);if(a?.runId){N(a.runId);try{await D("run_start",{runId:a.runId,skill:e.goal||"unknown",action:JSON.stringify(e).substring(0,200)})}catch(r){console.warn("[AgentConsole] Failed to track agent run:",r)}}}catch(e){console.error("Failed to start agent run:",e),alert(`Failed to start agent run: ${e instanceof Error?e.message:String(e)}`)}},children:"Start Run"}),t.jsx("button",{className:"rounded-lg border border-slate-700/60 bg-slate-800/60 px-3 py-1.5 text-xs font-medium text-gray-300 transition hover:bg-slate-800/80",onClick:async()=>{if(typeof window>"u"||!window.agent){alert("Agent API not available. Please ensure you are running in Electron.");return}if(m)try{await window.agent.stop(m)}catch(e){console.error("Failed to stop agent run:",e),alert(`Failed to stop agent run: ${e instanceof Error?e.message:String(e)}`)}},children:"Stop Run"})]})]})]}),V.length>0&&t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Recent Events"}),t.jsx("div",{className:"max-h-48 space-y-2 overflow-y-auto rounded-lg border border-slate-700/60 bg-slate-900/40 p-3",children:t.jsx(G,{children:V.slice(-5).reverse().map(e=>t.jsxs(h.div,{initial:{opacity:0,x:-8},animate:{opacity:1,x:0},exit:{opacity:0},className:"rounded-lg border border-slate-700/40 bg-slate-800/50 p-2 text-xs",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-medium text-gray-200",children:e.type}),e.step!==void 0&&t.jsxs("span",{className:"text-gray-400",children:["Step ",e.step]})]}),e.content&&t.jsx("p",{className:"mt-1 truncate text-gray-400",children:e.content})]},e.id))})})]}),C.length>0&&t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Recent Agent Runs"}),t.jsx("button",{className:"text-xs text-gray-500 hover:text-gray-300",onClick:re,children:"Clear"})]}),t.jsx("div",{className:"space-y-2",children:C.map(e=>t.jsxs("button",{onClick:()=>S(e.prompt),className:"w-full rounded-lg border border-slate-700/60 bg-slate-900/40 p-3 text-left transition hover:border-slate-500/60 hover:bg-slate-900/70",children:[t.jsxs("div",{className:"flex items-center justify-between text-[11px]",children:[t.jsx("span",{className:"text-gray-500",children:new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),t.jsx("span",{className:e.success?"text-emerald-400":"text-rose-400",children:e.success?"Succeeded":"Error"})]}),t.jsx("p",{className:"mt-1 line-clamp-1 text-sm text-gray-200",children:e.prompt}),(e.response||e.error)&&t.jsx("p",{className:"mt-1 line-clamp-2 text-xs text-gray-400",children:(e.response||e.error||"").trim()})]},e.id))})]})]}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Response"}),(l||f)&&t.jsx("button",{onClick:ne,className:"inline-flex items-center gap-1.5 rounded-lg border border-slate-700/60 bg-slate-800/60 px-2 py-1 text-xs text-gray-300 transition hover:bg-slate-800/80",children:Z==="copied"?t.jsxs(t.Fragment,{children:[t.jsx(we,{size:14,className:"text-emerald-400"}),"Copied"]}):t.jsxs(t.Fragment,{children:[t.jsx(ve,{size:14}),"Copy"]})})]}),t.jsx("div",{ref:E,className:"flex-1 overflow-y-auto rounded-xl border border-slate-700/60 bg-slate-900/60 p-4",children:t.jsx(G,{mode:"wait",children:l||f?t.jsx(h.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"prose prose-invert prose-sm max-w-none",children:t.jsxs("div",{className:"whitespace-pre-wrap text-sm leading-relaxed text-gray-200",children:[l||f,g&&t.jsx(h.span,{className:"ml-1 inline-block h-4 w-0.5 bg-blue-400",animate:{opacity:[1,0,1]},transition:{duration:.8,repeat:1/0}})]})},"response"):g?t.jsxs(h.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[t.jsx(Ne,{message:"AI is processing your request..."}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-3 w-full animate-pulse rounded bg-gray-800/50"}),t.jsx("div",{className:"h-3 w-5/6 animate-pulse rounded bg-gray-800/50"}),t.jsx("div",{className:"h-3 w-4/6 animate-pulse rounded bg-gray-800/50"})]})]},"loading"):t.jsxs(h.div,{initial:{opacity:0},animate:{opacity:1},className:"flex h-full flex-col items-center justify-center text-center",children:[t.jsx("div",{className:"rounded-full border border-slate-700/60 bg-slate-800/60 p-4",children:t.jsx(Y,{size:24,className:"text-slate-500"})}),t.jsx("p",{className:"mt-4 text-sm text-gray-400",children:"Ask a question to see streaming AI responses"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Responses stream in real-time as they're generated"})]},"empty")})})]})]}),t.jsx(Ee,{})]})}export{Ve as default};
//# sourceMappingURL=AgentConsole-Crl6GhHY.js.map
