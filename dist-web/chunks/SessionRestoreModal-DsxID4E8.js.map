{"version":3,"file":"SessionRestoreModal-DsxID4E8.js","sources":["../../src/components/SessionRestoreModal.tsx"],"sourcesContent":["/**\n * Session Restore Modal - Tier 1\n * Shows prompt to restore last session on app load\n */\n\nimport { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { RotateCcw, X } from 'lucide-react';\nimport { loadSession, clearSession, getSessionSummary } from '../services/session';\nimport { useTabsStore } from '../state/tabsStore';\nimport { useAppStore } from '../state/appStore';\nimport { ipc } from '../lib/ipc-typed';\nimport { formatDistanceToNow } from 'date-fns';\nimport { log } from '../utils/logger';\nimport { track } from '../services/analytics';\n\nexport default function SessionRestoreModal() {\n  const [show, setShow] = useState(false);\n  const [sessionSummary, setSessionSummary] = useState<{\n    tabCount: number;\n    savedAt: number | null;\n  } | null>(null);\n  const [isRestoring, setIsRestoring] = useState(false);\n  const tabsStore = useTabsStore();\n  const appStore = useAppStore();\n\n  useEffect(() => {\n    // Check for session on mount\n    const summary = getSessionSummary();\n    if (summary && summary.tabCount > 0) {\n      setSessionSummary(summary);\n      setShow(true);\n      log.info('Session restore modal: session found', summary);\n    }\n  }, []);\n\n  const handleRestore = async () => {\n    setIsRestoring(true);\n    try {\n      const session = loadSession();\n      if (!session) {\n        log.error('Session restore: no session data found');\n        return;\n      }\n\n      log.info('Restoring session', { tabCount: session.tabs.length, mode: session.mode });\n\n      // Restore mode\n      if (session.mode) {\n        await appStore.setMode(session.mode);\n      }\n\n      // Restore tabs\n      if (session.tabs.length > 0) {\n        // Clear existing tabs first\n        const currentTabs = tabsStore.tabs;\n        for (const tab of currentTabs) {\n          try {\n            await ipc.tabs.close({ id: tab.id });\n          } catch (err) {\n            log.warn('Failed to close tab during restore', err);\n          }\n        }\n\n        // Create restored tabs\n        for (const tab of session.tabs) {\n          try {\n            const url = tab.url || 'about:blank';\n            const newTab = await ipc.tabs.create(url);\n            const tabId =\n              typeof newTab === 'object' && newTab && 'id' in newTab\n                ? newTab.id\n                : typeof newTab === 'string'\n                  ? newTab\n                  : null;\n\n            // Update tab with restored data\n            if (tabId && typeof tabId === 'string') {\n              tabsStore.updateTab(tabId, {\n                title: tab.title,\n                appMode: tab.appMode,\n                url: tab.url,\n              });\n            }\n          } catch (err) {\n            log.warn('Failed to restore tab', err);\n          }\n        }\n\n        // Set active tab - handle gracefully if tab doesn't exist\n        if (session.activeTabId) {\n          const restoredTab = tabsStore.tabs.find(t => t.id === session.activeTabId);\n          if (restoredTab) {\n            try {\n              tabsStore.setActive(session.activeTabId);\n              await ipc.tabs.activate({ id: session.activeTabId }).catch(() => {\n                // Suppress errors for internal/system tabs or if IPC fails\n              });\n            } catch {\n              // Suppress errors - tab might not exist anymore\n            }\n          }\n        }\n      }\n\n      log.info('Session restored successfully');\n\n      // Tier 1: Track session restore\n      track('auth_session_restored', {\n        tabCount: session.tabs.length,\n        mode: session.mode,\n      });\n\n      setShow(false);\n    } catch (error) {\n      log.error('Failed to restore session', error);\n    } finally {\n      setIsRestoring(false);\n    }\n  };\n\n  const handleDismiss = () => {\n    clearSession();\n    setShow(false);\n    log.info('Session restore dismissed');\n\n    // Tier 1: Track dismissal\n    track('auth_session_restored', {\n      action: 'dismissed',\n      tabCount: sessionSummary?.tabCount || 0,\n    });\n  };\n\n  if (!show || !sessionSummary) return null;\n\n  const savedAgo = sessionSummary.savedAt\n    ? formatDistanceToNow(new Date(sessionSummary.savedAt), { addSuffix: true })\n    : 'recently';\n\n  return (\n    <AnimatePresence>\n      {show && (\n        <div\n          className=\"fixed inset-0 z-[10000] flex items-center justify-center bg-black/60 backdrop-blur-sm\"\n          onClick={e => {\n            if (e.target === e.currentTarget) {\n              handleDismiss();\n            }\n          }}\n        >\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95 }}\n            animate={{ opacity: 1, scale: 1 }}\n            exit={{ opacity: 0, scale: 0.95 }}\n            className=\"mx-4 w-full max-w-md rounded-xl border border-slate-700 bg-slate-900 shadow-2xl\"\n            onClick={e => e.stopPropagation()}\n          >\n            <div className=\"p-6\">\n              <div className=\"mb-4 flex items-start justify-between\">\n                <div>\n                  <h3 className=\"mb-1 text-lg font-semibold text-gray-100\">\n                    Restore your last browsing session?\n                  </h3>\n                  <p className=\"text-sm text-gray-400\">\n                    Last saved {savedAgo} â€¢ {sessionSummary.tabCount} tab\n                    {sessionSummary.tabCount === 1 ? '' : 's'}\n                  </p>\n                </div>\n                <button\n                  type=\"button\"\n                  onClick={e => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    (e as any).stopImmediatePropagation();\n                    setTimeout(() => {\n                      handleDismiss();\n                    }, 0);\n                  }}\n                  className=\"text-gray-400 transition-colors hover:text-gray-200\"\n                  aria-label=\"Dismiss\"\n                  style={{ pointerEvents: 'auto', zIndex: 10001 }}\n                >\n                  <X size={20} />\n                </button>\n              </div>\n\n              <div className=\"mt-6 flex gap-3\">\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    if (isRestoring) return;\n                    handleRestore();\n                  }}\n                  disabled={isRestoring}\n                  className=\"flex flex-1 items-center justify-center gap-2 rounded-lg border border-blue-500/60 bg-blue-600/20 px-4 py-2.5 text-sm font-medium text-blue-100 transition-colors hover:bg-blue-600/30 disabled:cursor-not-allowed disabled:opacity-50\"\n                >\n                  {isRestoring ? (\n                    <>\n                      <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-blue-400 border-t-transparent\" />\n                      Restoring...\n                    </>\n                  ) : (\n                    <>\n                      <RotateCcw size={16} />\n                      Restore\n                    </>\n                  )}\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    if (isRestoring) return;\n                    handleDismiss();\n                  }}\n                  disabled={isRestoring}\n                  className=\"flex-1 rounded-lg border border-slate-700 bg-slate-800/60 px-4 py-2.5 text-sm text-slate-300 transition-colors hover:bg-slate-700/80 disabled:opacity-50\"\n                >\n                  Start Fresh\n                </button>\n              </div>\n            </div>\n          </motion.div>\n        </div>\n      )}\n    </AnimatePresence>\n  );\n}\n"],"names":["SessionRestoreModal","show","setShow","useState","sessionSummary","setSessionSummary","isRestoring","setIsRestoring","tabsStore","useTabsStore","appStore","useAppStore","useEffect","summary","getSessionSummary","log","handleRestore","session","loadSession","currentTabs","tab","ipc","err","url","newTab","tabId","t","track","error","handleDismiss","clearSession","savedAgo","formatDistanceToNow","jsx","AnimatePresence","e","motion","jsxs","X","Fragment","RotateCcw"],"mappings":"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"}