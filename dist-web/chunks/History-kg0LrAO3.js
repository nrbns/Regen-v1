import{r as o,$ as se,j as e,a0 as re,b1 as ae,T as Q,b2 as le,t as ie,o as D,g as ne,X as V,ab as ce,G as q,b3 as oe,O as de,E as ue,P as xe}from"./vendor-react-gmX1Lmvt.js";import{i as N}from"./core-ai-yFIunLTZ.js";import{i as me}from"../assets/index-D9cF9G1U.js";import{m as A}from"./vendor-framer-motion-DDE19Uim.js";function he(r,i,n=[]){o.useEffect(()=>me.on(r,i),[r,...n])}function ge(){const r=se(),[i,n]=o.useState([]),[a,u]=o.useState(""),[h,c]=o.useState(!0),[g,v]=o.useState(null),[m,y]=o.useState("all"),[w,F]=o.useState(null),[W,$]=o.useState(!1),[T,G]=o.useState(null),[K,R]=o.useState("idle"),C=o.useRef(!0);o.useEffect(()=>()=>{C.current=!1},[]),o.useEffect(()=>{(async()=>{try{const t=await N.history.list();Array.isArray(t)?n(t):n([])}catch(t){console.error("Failed to load history:",t),n([])}finally{c(!1)}})()},[]),he("history:updated",()=>{N.history.list().then(s=>n(s||[])).catch(console.error)},[]),o.useEffect(()=>{const s=a.trim();if(s.length<2){F(null),$(!1);return}let t=!1;return $(!0),N.history.search(s).then(l=>{t||F(Array.isArray(l)?l:[])}).catch(l=>{t||(console.error("History search failed:",l),F([]))}).finally(()=>{t||$(!1)}),()=>{t=!0}},[a]);const k=o.useCallback(async()=>{if(!navigator?.storage?.estimate){C.current&&R("error");return}C.current&&R("loading");try{const{usage:s=0,quota:t=0}=await navigator.storage.estimate();if(!C.current)return;const l=t>0?s/t*100:0;G({usage:s,quota:t,percent:l,updatedAt:Date.now()}),R("idle")}catch(s){console.error("Failed to estimate storage:",s),C.current&&R("error")}},[]);o.useEffect(()=>{k();const s=window.setInterval(k,45e3);return()=>window.clearInterval(s)},[k]);const Y=o.useCallback(()=>{k()},[k]),S=o.useMemo(()=>{const s=new Set;let t=0,l=0,d=0;return i.forEach(f=>{try{const L=new URL(f.url);s.add(L.hostname),L.protocol==="https:"?t+=1:l+=1,E(f.url)&&(d+=1)}catch{}}),{total:i.length,uniqueDomains:s.size,secureCount:t,insecureCount:l,searchCount:d}},[i]),M=o.useMemo(()=>{const s=w??i;let t=s;if(!w&&a.trim()){const x=a.toLowerCase();t=s.filter(j=>j.title.toLowerCase().includes(x)||j.url.toLowerCase().includes(x))}m!=="all"&&(t=t.filter(x=>{switch(m){case"search":return!!E(x.url);case"secure":try{return new URL(x.url).protocol==="https:"}catch{return!1}case"insecure":try{return new URL(x.url).protocol!=="https:"}catch{return!1}default:return!0}}));const l={},d=Date.now(),f=1440*60*1e3,L=7*f,te=30*f;return t.forEach(x=>{const j=x.lastVisitTime??x.timestamp,b=d-j;let p;b<f?p="Today":b<f*2?p="Yesterday":b<L?p="This Week":b<te?p="This Month":p="Older",l[p]||(l[p]=[]),l[p].push(x)}),Object.entries(l).map(([x,j])=>({date:x,entries:j.sort((b,p)=>(p.lastVisitTime??p.timestamp)-(b.lastVisitTime??b.timestamp))})).sort((x,j)=>{const b=["Today","Yesterday","This Week","This Month","Older"];return b.indexOf(x.date)-b.indexOf(j.date)})},[i,w,a,m]),_=o.useMemo(()=>M.reduce((s,t)=>s+t.entries.length,0),[M]),X=async()=>{confirm("Are you sure you want to clear all browsing history?")&&(await N.history.clear(),n([]))},I=async s=>{await N.history.deleteUrl?.(s),n(i.filter(t=>t.url!==s)),v(t=>t?.url===s?null:t)},J=async s=>{try{await N.tabs.create(s)&&r("/")}catch(t){console.error("Failed to open history URL:",t),r("/"),setTimeout(()=>{N.tabs.create("about:blank").catch(console.error)},100)}},Z=s=>{if(Date.now()-s<1e3*60*60*24)return U(s);const l=new Date(s);return l.toLocaleDateString()+" "+l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},O=s=>{try{return`https://www.google.com/s2/favicons?domain=${new URL(s).hostname}&sz=32`}catch{return}},E=s=>{try{const t=new URL(s),l=t.hostname,d=t.searchParams;return l.includes("google")?d.get("q")||d.get("query"):l.includes("duckduckgo")||l.includes("bing.com")?d.get("q"):l.includes("search.yahoo.com")?d.get("p"):l.includes("youtube.com")||l.includes("youtu.be")?d.get("search_query"):l.includes("reddit.com")?d.get("q"):null}catch{return null}},P=(s,t)=>{if(!t)return s;const l=new RegExp(`(${ee(t)})`,"ig");return s.split(l).map((d,f)=>l.test(d)?e.jsx("mark",{className:"rounded-sm bg-blue-500/30 px-0.5 text-blue-100",children:d},f):e.jsx("span",{children:d},f))},ee=s=>s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return h?e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-[#1A1D28]",children:e.jsx(re,{size:24,className:"animate-spin text-blue-400"})}):e.jsxs("div",{className:"flex h-full w-full flex-col bg-[#1A1D28] text-gray-100",children:[e.jsxs("div",{className:"border-b border-gray-800/50 p-6",children:[e.jsxs("div",{className:"mb-4 flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"History"}),e.jsxs("span",{className:"flex items-center gap-2 text-xs uppercase tracking-[0.28em] text-gray-500",children:[e.jsx(ae,{size:14}),S.total," visits · ",S.uniqueDomains," domains"]})]}),e.jsxs(A.button,{onClick:X,whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex items-center gap-2 rounded-lg border border-gray-700/50 bg-gray-900/60 px-4 py-2 text-gray-300 transition-colors hover:bg-red-600/20 hover:text-red-400",children:[e.jsx(Q,{size:18}),e.jsx("span",{children:"Clear browsing data"})]})]}),e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx(H,{label:"Secure",value:S.secureCount,accent:"text-emerald-300",helper:"HTTPS pages",icon:e.jsx(le,{size:16,className:"text-emerald-300"})}),e.jsx(H,{label:"Insecure",value:S.insecureCount,accent:"text-amber-300",helper:"HTTP pages",icon:e.jsx(ie,{size:16,className:"text-amber-300"})}),e.jsx(H,{label:"Searches",value:S.searchCount,accent:"text-blue-300",helper:"Recognised search queries",icon:e.jsx(D,{size:16,className:"text-blue-300"})}),e.jsx(pe,{usage:T?.usage??0,quota:T?.quota??0,percent:T?.percent??0,updatedAt:T?.updatedAt??0,status:K,onRefresh:Y})]}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"}),e.jsx("input",{type:"text",value:a,onChange:s=>u(s.target.value),placeholder:"Search history",className:"h-10 w-full rounded-lg border border-gray-700/50 bg-gray-900/60 pl-10 pr-4 text-gray-200 placeholder-gray-500 focus:border-blue-500/50 focus:outline-none focus:ring-2 focus:ring-blue-500/50"}),W&&e.jsx(ne,{size:16,className:`absolute top-1/2 -translate-y-1/2 animate-spin text-blue-400 ${a?"right-9":"right-3"}`}),a&&e.jsx("button",{onClick:()=>u(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-300",children:e.jsx(V,{size:18})})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-gray-400",children:[e.jsx(ce,{size:14}),e.jsx(z,{active:m==="all",onClick:()=>y("all"),label:"All"}),e.jsx(z,{active:m==="search",onClick:()=>y("search"),label:"Search"}),e.jsx(z,{active:m==="secure",onClick:()=>y("secure"),label:"Secure"}),e.jsx(z,{active:m==="insecure",onClick:()=>y("insecure"),label:"Insecure"})]})]}),e.jsxs("div",{className:"grid flex-1 grid-cols-1 gap-4 overflow-y-auto p-6 xl:grid-cols-[2fr_minmax(280px,1fr)]",children:[e.jsxs("div",{children:[w&&e.jsxs("div",{className:"mb-4 flex items-center gap-2 text-xs text-blue-300",children:[e.jsx(D,{size:14}),e.jsxs("span",{children:["Showing ",_," high-relevance result",_===1?"":"s"," ","for “",a.trim(),"”"]})]}),M.length===0?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-center",children:[e.jsx(q,{size:48,className:"mb-4 text-gray-600"}),e.jsx("h3",{className:"mb-2 text-lg font-semibold text-gray-300",children:a?"No results found":"No history yet"}),e.jsx("p",{className:"text-sm text-gray-500",children:a?"Try a different search term":"Pages you visit will appear here"})]}):e.jsx("div",{className:"space-y-6",children:M.map(s=>e.jsxs("div",{children:[e.jsx("h3",{className:"mb-3 text-sm font-semibold uppercase tracking-wide text-gray-400",children:s.date}),e.jsx("div",{className:"space-y-1",children:s.entries.map(t=>e.jsxs(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`group flex cursor-pointer items-center gap-3 rounded-lg border bg-gray-900/60 p-3 transition-all hover:bg-gray-900/80 ${g?.id===t.id?"border-blue-500/40 shadow-[0_0_0_1px_rgba(59,130,246,0.35)]":"border-gray-800/50 hover:border-gray-700/50"}`,onClick:()=>v(t),children:[e.jsx("div",{className:"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded border border-gray-700/50 bg-gray-800/50",children:t.favicon||O(t.url)?e.jsx("img",{src:t.favicon||O(t.url),alt:"",className:"h-6 w-6",onError:l=>{l.target.style.display="none"}}):e.jsx(q,{size:16,className:"text-gray-500"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between gap-2",children:[e.jsx("span",{className:"truncate font-medium text-gray-200",children:a?P(t.title||t.url,a):t.title||t.url}),e.jsx("span",{className:"flex-shrink-0 text-xs text-gray-500",children:Z(t.lastVisitTime??t.timestamp)})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"truncate text-xs text-gray-400",children:a?P(t.url,a):t.url}),e.jsxs("div",{className:"flex flex-shrink-0 items-center gap-2",children:[t.visitCount&&t.visitCount>1&&e.jsxs("span",{className:"text-xs text-gray-500",children:[t.visitCount," visits"]}),E(t.url)&&e.jsx("span",{className:"rounded-full border border-blue-500/30 bg-blue-500/15 px-2 py-0.5 text-[10px] uppercase tracking-wide text-blue-300",children:"Search"}),(()=>{try{const l=new URL(t.url).protocol;return e.jsx("span",{className:`rounded-full border px-2 py-0.5 text-[10px] uppercase tracking-wide ${l==="https:"?"border-emerald-500/30 bg-emerald-500/15 text-emerald-300":"border-amber-500/30 bg-amber-500/15 text-amber-200"}`,children:l==="https:"?"Secure":"Insecure"})}catch{return null}})()]})]})]}),e.jsx(A.button,{onClick:l=>{l.stopPropagation(),I(t.url)},whileHover:{scale:1.1},whileTap:{scale:.9},className:"flex-shrink-0 rounded-lg p-1.5 text-gray-500 opacity-0 transition-all hover:bg-red-600/20 hover:text-red-400 group-hover:opacity-100",title:"Remove from history",children:e.jsx(V,{size:16})})]},t.id))})]},s.date))})]}),e.jsx("aside",{className:"hidden xl:block",children:g?e.jsx(fe,{entry:g,detectSearchQuery:E,formatRelative:U,onOpen:()=>J(g.url),onCopy:()=>{navigator?.clipboard?.writeText&&navigator.clipboard.writeText(g.url).catch(console.error)},onRemove:()=>I(g.url)}):e.jsxs("div",{className:"sticky top-6 flex min-h-[240px] flex-col items-center justify-center rounded-xl border border-gray-800/60 bg-gray-900/40 p-4 text-sm text-gray-500",children:[e.jsx(q,{size:28,className:"mb-3 text-gray-600"}),e.jsx("p",{children:"Select a history item to see details, cached parameters, and quick actions."})]})})]})]})}function z({active:r,label:i,onClick:n}){return e.jsx("button",{type:"button",onClick:n,className:`flex items-center gap-1 rounded-full border px-2.5 py-1 text-xs transition-colors ${r?"border-blue-500/40 bg-blue-500/15 text-blue-200":"border-gray-700/60 bg-gray-900/40 text-gray-400 hover:border-gray-600 hover:text-gray-200"}`,children:i})}function H({label:r,value:i,helper:n,icon:a,accent:u}){return e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-gray-800/60 bg-gray-900/40 px-3 py-2 text-xs text-gray-400",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-md border border-gray-700/50 bg-gray-800/60",children:a}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-[0.24em] text-gray-500",children:r}),e.jsx("span",{className:`text-base font-semibold ${u}`,children:i}),e.jsx("span",{className:"text-[10px] text-gray-500",children:n})]})]})}function pe({usage:r,quota:i,percent:n,status:a,updatedAt:u,onRefresh:h}){const c=Number.isFinite(n)?Math.max(0,Math.min(100,n)):0,g=B(r),v=i>0?B(i):"—",m=`${c>=10?Math.round(c):c.toFixed(1)}%`,y=u?U(u):"moments ago";return e.jsxs("div",{className:"flex min-w-[200px] flex-col gap-2 rounded-lg border border-gray-800/60 bg-gray-900/40 px-3 py-2 text-xs text-gray-400",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-md border border-gray-700/50 bg-gray-800/60",children:e.jsx(oe,{size:16,className:"text-indigo-300"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-[0.24em] text-gray-500",children:"Cache usage"}),e.jsx("span",{className:"text-base font-semibold text-indigo-200",children:g}),e.jsxs("span",{className:"text-[10px] text-gray-500",children:["of ",v," (",m,")"]})]})]}),e.jsx("button",{type:"button",onClick:h,disabled:a==="loading",className:"rounded-md border border-gray-700/60 p-1.5 text-gray-400 transition-colors hover:border-indigo-400/40 hover:text-indigo-200 disabled:cursor-not-allowed disabled:opacity-60",title:"Refresh storage estimate",children:e.jsx(de,{size:14,className:a==="loading"?"animate-spin text-indigo-200":"text-current"})})]}),e.jsx("div",{className:"h-2 w-full overflow-hidden rounded-full bg-gray-800",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-400 to-blue-500 transition-[width] duration-300",style:{width:`${c}%`},"aria-valuenow":c,"aria-valuemin":0,"aria-valuemax":100})}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Updated ",a==="loading"?"…":y]}),a==="error"&&e.jsx("div",{className:"text-[10px] text-amber-300",children:"Storage estimate unavailable in this environment."})]})}function fe({entry:r,detectSearchQuery:i,formatRelative:n,onOpen:a,onCopy:u,onRemove:h}){let c=null;try{c=new URL(r.url)}catch{c=null}const g=c?i(r.url):null,v=c?Array.from(c.searchParams.entries()):[],m=r.lastVisitTime&&r.lastVisitTime>r.timestamp?r.lastVisitTime-r.timestamp:0;return e.jsxs("div",{className:"sticky top-6 space-y-4 rounded-xl border border-gray-800/60 bg-gray-900/50 p-4 text-sm text-gray-300 shadow-[0_18px_45px_rgba(15,23,42,0.35)]",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-semibold text-gray-100",children:r.title||"Untitled page"}),e.jsx("p",{className:"break-all text-xs text-gray-500",children:r.url})]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("button",{type:"button",onClick:a,className:"rounded-md border border-blue-500/30 bg-blue-500/15 p-1.5 text-blue-200 transition-colors hover:bg-blue-500/25",title:"Open in a new tab",children:e.jsx(ue,{size:14})}),e.jsx("button",{type:"button",onClick:u,className:"rounded-md border border-gray-700/60 bg-gray-800/60 p-1.5 text-gray-400 transition-colors hover:bg-gray-800 hover:text-gray-100",title:"Copy URL",children:e.jsx(xe,{size:14})}),e.jsx("button",{type:"button",onClick:h,className:"rounded-md border border-red-500/40 bg-red-500/15 p-1.5 text-red-200 transition-colors hover:bg-red-500/25",title:"Remove from history",children:e.jsx(Q,{size:14})})]})]}),e.jsxs("div",{className:"space-y-2 text-xs text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-[0.2em] text-gray-500",children:"First visit"}),e.jsx("span",{className:"text-gray-300",children:new Date(r.timestamp).toLocaleString()}),e.jsx("span",{className:"text-gray-500",children:n(r.timestamp)})]}),r.lastVisitTime&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-[0.2em] text-gray-500",children:"Last visit"}),e.jsx("span",{className:"text-gray-300",children:new Date(r.lastVisitTime).toLocaleString()}),e.jsx("span",{className:"text-gray-500",children:n(r.lastVisitTime)})]}),r.visitCount&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-[0.2em] text-gray-500",children:"Visits"}),e.jsx("span",{className:"text-gray-300",children:r.visitCount})]}),m>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-[0.2em] text-gray-500",children:"Cache span"}),e.jsx("span",{className:"text-gray-300",children:je(m)})]}),c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-[0.2em] text-gray-500",children:"Domain"}),e.jsx("span",{className:"text-gray-300",children:c.hostname})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] uppercase tracking-[0.2em] text-gray-500",children:"Protocol"}),e.jsx("span",{className:`rounded-full border px-2 py-0.5 ${c.protocol==="https:"?"border-emerald-500/30 bg-emerald-500/15 text-emerald-200":"border-amber-500/30 bg-amber-500/15 text-amber-200"}`,children:c.protocol.replace(":","").toUpperCase()})]})]})]}),g&&e.jsxs("div",{className:"space-y-1 rounded-lg border border-blue-500/30 bg-blue-500/10 p-3 text-xs text-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-2 font-semibold text-blue-200",children:[e.jsx(D,{size:14}),"Recognised search query"]}),e.jsx("p",{className:"text-sm text-blue-100",children:g})]}),v.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-xs uppercase tracking-[0.24em] text-gray-500",children:"Query Parameters"}),e.jsx("div",{className:"space-y-1",children:v.map(([y,w])=>e.jsxs("div",{className:"flex items-start gap-2 rounded-md border border-gray-800/50 bg-gray-900/50 px-2 py-1 text-xs text-gray-400",children:[e.jsx("span",{className:"min-w-[80px] font-medium text-gray-300",children:y}),e.jsx("span",{className:"break-all text-gray-400",children:w||"—"})]},y))})]})]})}const be=[{unit:"year",ms:1e3*60*60*24*365},{unit:"month",ms:1e3*60*60*24*30},{unit:"week",ms:1e3*60*60*24*7},{unit:"day",ms:1e3*60*60*24},{unit:"hour",ms:1e3*60*60},{unit:"minute",ms:1e3*60},{unit:"second",ms:1e3}],ye=new Intl.RelativeTimeFormat(void 0,{numeric:"auto"});function U(r){const i=r-Date.now(),n=Math.abs(i);for(const{unit:a,ms:u}of be)if(n>=u||a==="second"){const h=Math.round(i/u);return ye.format(h,a)}return""}function B(r){if(!Number.isFinite(r)||r<=0)return"0 B";const i=["B","KB","MB","GB","TB"],n=Math.min(i.length-1,Math.floor(Math.log(r)/Math.log(1024))),a=r/Math.pow(1024,n);return`${a>=100?Math.round(a):Math.round(a*10)/10} ${i[n]}`}function je(r){if(!Number.isFinite(r)||r<=0)return"—";let i=Math.floor(r/1e3);const n=[{label:"d",value:86400},{label:"h",value:3600},{label:"m",value:60}],a=[];for(const{label:u,value:h}of n)if(i>=h){const c=Math.floor(i/h);i-=c*h,a.push(`${c}${u}`)}return a.length===0&&a.push(`${Math.max(1,i)}s`),a.join(" ")}const ke=Object.freeze(Object.defineProperty({__proto__:null,default:ge},Symbol.toStringTag,{value:"Module"}));export{ge as H,ke as a,he as u};
//# sourceMappingURL=History-kg0LrAO3.js.map
