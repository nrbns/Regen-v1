const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/core-ai-yFIunLTZ.js","chunks/vendor-zustand-BWsgwsXr.js","chunks/vendor-react-gmX1Lmvt.js","chunks/vendor-react-dom-Bkb6jJ_S.js","chunks/vendor-Vl2WtvH-.js","chunks/mode-manager.ts-DwguZmJt.js","chunks/core-memory-DmK-uh9X.js","chunks/OmniDesk-C5fSodZ1.js","assets/index-D9cF9G1U.js","chunks/mode-research-BclgCwOH.js","chunks/vendor-utils-5Vdoy44w.js","chunks/mode-docs-FcsoolLb.js","chunks/vendor-pdf-ejcqEZLU.js","chunks/vendor-mammoth-BPQIafDs.js","chunks/vendor-framer-motion-DDE19Uim.js","assets/index-D7i95XKH.css","chunks/screenshotAnalyzer--BZfFR7x.js","chunks/battery-manager-DeaBgtPF.js","chunks/History-kg0LrAO3.js","chunks/Downloads-CU-ngJEB.js","chunks/WorkspacesPanel-3geKynW_.js","chunks/bookmarksStore-CAScveEF.js","chunks/workspacesStore-BSqEl-CQ.js","chunks/tradeStore-CHfkU4NA.js","chunks/dataService-HUHZrGu9.js","chunks/registry-CG5fPtjR.js","chunks/trustDashboardStore-BRaGSCcb.js","chunks/memory-manager-BFSAMsDL.js","chunks/policies-CRVv_IL8.js","chunks/RedixDebugPanel-B__gR_cw.js","chunks/SessionRestoreModal-DsxID4E8.js","chunks/TopBar-DlyyI3dP.js","chunks/TabStrip-DwWt0XPA.js","chunks/profileStore-CltTxMCZ.js","chunks/RightPanel-DtmRQd7t.js","chunks/PrivacyDashboard-B5QYv-jo.js","chunks/BottomStatus-CpusWBZO.js","chunks/CommandPalette-C3fUrmXD.js","chunks/PermissionPrompt-BewnDXtf.js","chunks/ConsentPrompt-GT-g9PFb.js","chunks/AgentOverlay-BLctF3fX.js","chunks/RegenSidebar-4rHIQNpC.js","chunks/ClipperOverlay-B_9ypu2u.js","chunks/ReaderOverlay-BY93HbSi.js","chunks/TabGraphOverlay-DdEVCPFr.js","chunks/ConsentDashboard-CjN7bvtp.js","chunks/vendor-reactflow-BGigvD3b.js","assets/vendor-reactflow-Fd0xVSp_.css","chunks/TrustEthicsDashboard-xBQUU1OG.js","chunks/ResearchTour-TWw7Br_Z.js","chunks/memoryMonitor-BGCXgiUi.js","chunks/firstLaunch-ChO73SC_.js"])))=>i.map(i=>d[i]);
import{i as E,a as K,h as Se,u as Ce,l as Re,b as Q,n as Tt,R as Bs,d as ue,_ as L,t as A,e as Us,o as Ws,p as Ta,q as Ea,s as Ia,j as le}from"./core-ai-yFIunLTZ.js";import{r as c,j as e,S as xe,g as ot,E as ht,F as ge,a as Ca,Y as qs,_ as Ma,$ as Pa,o as fe,X as oe,a0 as Vs,a1 as Ks,a2 as it,G as qt,t as yt,O as Hs,a3 as xt,N as te,a4 as Aa,a5 as _a,a6 as Ra,a7 as Vt,a8 as Kt,D as gt,a9 as za,aa as Da,f as La,ab as Gs,ac as Oa,ad as $a,q as Ys,ae as us,af as Fa,P as Js,ag as Ba,ah as Ua,ai as Wa,aj as qa,Z as Va,ak as Qs,M as Ka,p as Ha,al as Ga,am as Xs,an as Zs,k as ea,Q as Ya,i as Ja,ao as Qa,m as ta,e as Xa,w as Za,ap as Ee,aq as er,I as ms,h as Ht,ar as tr,as as sr,n as Ie,at as ar,au as rr,av as nr,aw as or,ax as ir,B as lr,u as ps,ay as cr,az as dr,aA as fs}from"./vendor-react-gmX1Lmvt.js";import{S as at,i as Le,s as ur}from"../assets/index-D9cF9G1U.js";import{H as mr,u as hs}from"./History-kg0LrAO3.js";import{D as pr,P as me}from"./Downloads-CU-ngJEB.js";import{c as De,p as sa}from"./vendor-zustand-BWsgwsXr.js";import{n as aa,O as fr}from"./OmniDesk-C5fSodZ1.js";import{m as _,A as ee}from"./vendor-framer-motion-DDE19Uim.js";import{t as hr,d as xr,f as Gt}from"./vendor-utils-5Vdoy44w.js";import{m as gr,c as We,s as se,a as br,t as Et,l as pe}from"./mode-research-BclgCwOH.js";import{invoke as xs}from"@tauri-apps/api/core";import{a as yr,b as vr,c as wr,M as jr,d as It,s as Sr,e as Nr}from"./core-memory-DmK-uh9X.js";import{B as kr,W as Tr,e as Er}from"./WorkspacesPanel-3geKynW_.js";import{u as Ir}from"./bookmarksStore-CAScveEF.js";import{useTradeStore as Ft}from"./tradeStore-CHfkU4NA.js";import{fetchTradeQuote as Cr}from"./dataService-HUHZrGu9.js";import{pluginRegistry as Mr}from"./registry-CG5fPtjR.js";import{u as Pr}from"./trustDashboardStore-BRaGSCcb.js";const Ar=De((t,s)=>({visible:!1,loading:!1,error:null,data:null,focusedTabId:null,async open(){s().visible||t({visible:!0}),await s().refresh()},close(){t({visible:!1,focusedTabId:null})},async toggle(){s().visible?t({visible:!1,focusedTabId:null}):(t({visible:!0}),await s().refresh())},async refresh(){t({loading:!0,error:null});try{const a=await E.graph.tabs();if(!a||typeof a!="object")throw new Error("Graph data unavailable");t({data:a,loading:!1,error:null})}catch(a){t({loading:!1,error:a instanceof Error?a.message:String(a)})}},setFocusedTab(a){t({focusedTabId:a})},async focusTab(a){t({visible:!0,focusedTabId:a}),await s().refresh()}}));function _r(){const[t,s]=c.useState(""),a=K(i=>i.activeId),r=K(i=>i.tabs),n=a?r.find(i=>i.id===a):null,o=async i=>{if(!i.trim())return;if(/^https?:\/\//i.test(i)||/^[a-zA-Z0-9-]+\.[a-zA-Z]{2,}/.test(i)){const p=i.startsWith("http")?i:`https://${i}`;n?await E.tabs.navigate(n.id,p):await E.tabs.create(p)}else{const p=`https://www.google.com/search?q=${encodeURIComponent(i)}`;n?await E.tabs.navigate(n.id,p):await E.tabs.create(p)}s("")};return e.jsx("div",{className:"h-screen bg-gradient-to-br from-purple-950 via-black to-pink-950 text-white flex items-center justify-center overflow-hidden",children:e.jsxs("div",{className:"text-center max-w-4xl w-full px-10",children:[e.jsx(_.h1,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"text-8xl md:text-9xl font-black bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent mb-8",children:"REGEN"}),e.jsx(_.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-3xl md:text-4xl mt-8 text-purple-300 mb-16",children:"The Future of Browsing"}),e.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"relative max-w-2xl mx-auto",children:[e.jsx("input",{type:"text",value:t,onChange:i=>s(i.target.value),onKeyDown:i=>{i.key==="Enter"&&o(t)},placeholder:"Search or ask AI anything...",className:"w-full px-8 py-6 bg-white/10 backdrop-blur-xl rounded-full text-xl md:text-2xl placeholder-purple-400 focus:outline-none focus:ring-4 focus:ring-purple-500/50 transition-all text-white",autoFocus:!0}),e.jsx(_.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>o(t),className:"absolute right-8 top-1/2 -translate-y-1/2 p-2 rounded-full hover:bg-white/10 transition",title:"AI Search",children:e.jsx(xe,{className:"w-7 h-7 md:w-9 md:h-9 text-pink-400 animate-pulse"})})]})]})})}var Rr=Object.defineProperty,zr=(t,s,a)=>s in t?Rr(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,Fe=(t,s,a)=>zr(t,typeof s!="symbol"?s+"":s,a);const bt=hr(t=>{requestAnimationFrame(t)},16,{leading:!0,trailing:!0}),Dr=xr(t=>{t()},100);class Lr{constructor(){Fe(this,"iframes",new Map),Fe(this,"observers",new Map),Fe(this,"messageHandlers",new Map)}registerIframe(s,a,r={}){r.sandbox&&a.setAttribute("sandbox",r.sandbox.join(" ")),r.allow&&a.setAttribute("allow",r.allow),r.lazy&&a.setAttribute("loading","lazy"),a.setAttribute("fetchpriority","low"),a.style.contentVisibility="auto",a.style.contain="layout style paint",this.iframes.set(s,a);const n=new ResizeObserver(()=>{bt(()=>{this.handleIframeResize(s,a)})});n.observe(a),this.observers.set(s,n);const o=i=>{i.source===a.contentWindow&&this.handleIframeMessage(s,i)};window.addEventListener("message",o),this.messageHandlers.set(s,o)}handleIframeResize(s,a){requestAnimationFrame(()=>{const r=a.getBoundingClientRect();window.dispatchEvent(new CustomEvent("iframe-resize",{detail:{id:s,rect:r}}))})}handleIframeMessage(s,a){const r=["*"];(r.includes("*")||r.includes(a.origin))&&window.dispatchEvent(new CustomEvent("iframe-message",{detail:{id:s,data:a.data,origin:a.origin}}))}unregisterIframe(s){if(this.iframes.get(s)){const r=this.observers.get(s);r&&(r.disconnect(),this.observers.delete(s));const n=this.messageHandlers.get(s);n&&(window.removeEventListener("message",n),this.messageHandlers.delete(s)),this.iframes.delete(s)}}getIframe(s){return this.iframes.get(s)}postMessage(s,a,r="*"){const n=this.iframes.get(s);n?.contentWindow&&n.contentWindow.postMessage(a,r)}}let Ct=null;function Yt(){return Ct||(Ct=new Lr),Ct}class Or{constructor(){Fe(this,"renderQueue",[]),Fe(this,"isRendering",!1),Fe(this,"frameId",null)}queueRender(s){this.renderQueue.push(s),this.scheduleRender()}scheduleRender(){this.isRendering||this.frameId!==null||(this.frameId=requestAnimationFrame(()=>{this.frameId=null,this.flushRenderQueue()}))}flushRenderQueue(){if(this.renderQueue.length===0){this.isRendering=!1;return}this.isRendering=!0,this.renderQueue.splice(0,10).forEach(a=>{try{a()}catch(r){console.error("[OptimizedViewRenderer] Render error:",r)}}),this.renderQueue.length>0?this.scheduleRender():this.isRendering=!1}cancel(){this.frameId!==null&&(cancelAnimationFrame(this.frameId),this.frameId=null),this.renderQueue=[],this.isRendering=!1}}let Mt=null;function ra(){return Mt||(Mt=new Or),Mt}class $r{constructor(){Fe(this,"metrics",new Map)}start(s){const a=performance.now();return()=>{const r=performance.now()-a,n=this.metrics.get(s)||[];n.push(r),n.length>100&&n.shift(),this.metrics.set(s,n)}}getAverage(s){const a=this.metrics.get(s)||[];return a.length===0?0:a.reduce((r,n)=>r+n,0)/a.length}getMetrics(){const s={};return this.metrics.forEach((a,r)=>{s[r]={avg:this.getAverage(r),count:a.length}}),s}}let Pt=null;function Fr(){return Pt||(Pt=new $r),Pt}function Br(t={}){const{iframeId:s,lazy:a=!0,sandbox:r,onResize:n,onMessage:o}=t,i=c.useRef(null),u=c.useMemo(()=>ra(),[]),p=c.useMemo(()=>Fr(),[]);c.useEffect(()=>{if(s&&i.current){const y=Yt();return y.registerIframe(s,i.current,{lazy:a,sandbox:r||["allow-scripts","allow-same-origin"],allow:"clipboard-read; clipboard-write"}),()=>{y.unregisterIframe(s)}}},[s,a,r]),c.useEffect(()=>{if(!n)return;const y=x=>{if(x.detail.id===s){const l=x.detail.rect;n(l)}};return window.addEventListener("iframe-resize",y),()=>{window.removeEventListener("iframe-resize",y)}},[s,n]),c.useEffect(()=>{if(!o)return;const y=x=>{x.detail.id===s&&o(x.detail.data)};return window.addEventListener("iframe-message",y),()=>{window.removeEventListener("iframe-message",y)}},[s,o]);const b=c.useCallback(y=>{const x=p.start("view-update");u.queueRender(()=>{y(),x()})},[u,p]),m=c.useCallback(()=>{Dr(()=>{if(i.current){const y=i.current.getBoundingClientRect();n?.(y)}})},[n]);return c.useEffect(()=>(window.addEventListener("resize",m),()=>{window.removeEventListener("resize",m)}),[m]),{iframeRef:i,queueUpdate:b,getMetrics:()=>p.getMetrics()}}const Ur=["ob://","about:","chrome://","edge://","app://","regen://"];function Wr(t){return t?Ur.some(s=>t.startsWith(s)):!0}function qr({tab:t,overlayActive:s}){const a=c.useRef(null),r=c.useRef(null),n=Se(),o=Re(),i=Ce(S=>S.language||"auto"),[u,p]=c.useState(!1),[b,m]=c.useState(null),[y,x]=c.useState(!1);Br({iframeId:t?.id,lazy:!t?.active,sandbox:at.split(" "),onResize:S=>{bt(()=>{})}});const l=c.useMemo(()=>{let S=t?.url;if(!S||S==="about:blank"||Wr(S))return null;if(!S.startsWith("http://")&&!S.startsWith("https://")){const v=aa(S,"bing",i!=="auto"?i:void 0,!0);return v||`https://www.bing.com/search?q=${encodeURIComponent(S)}`}return S},[t?.url,i]);c.useEffect(()=>{if(!(!n||!l||o))return()=>{p(!1),m(null),x(!1)}},[n,o,l]),c.useEffect(()=>{if(n||!l||!r.current)return;const S=r.current;let v=!0;const C=3e4;let T=null;const U=()=>{if(v&&(T&&(clearTimeout(T),T=null),p(!1),m(null),!!r.current))try{r.current.contentDocument?.title,x(!1)}catch{x(!1)}},H=Y=>{if(!v)return;T&&(clearTimeout(T),T=null),p(!1);const q=Y instanceof ErrorEvent&&Y.message||"",ae=Y.target,re=q&&(q.toLowerCase().includes("x-frame-options")||q.toLowerCase().includes("frame-ancestors")||q.toLowerCase().includes("refused to display")||q.toLowerCase().includes("denied")||q.toLowerCase().includes("frame")&&q.toLowerCase().includes("blocked"))||ae===S&&S.contentWindow===null&&S.contentDocument===null;if(l&&!re){const F=l.toLowerCase();if(F.includes("duckduckgo.com")||F.includes("google.com/search"))try{const N=new URL(l),R=N.searchParams.get("q")||N.searchParams.get("query")||"";if(R){const W=`https://www.bing.com/search?q=${encodeURIComponent(R)}`;console.log("[TabContentSurface] Converting iframe-blocked search to Bing:",W),setTimeout(()=>{r.current&&(r.current.src=W,p(!0),m(null))},100);return}}catch{}}re?(x(!0),m("This site blocks embedded views (X-Frame-Options).")):(m("Failed to load this page. Please check the URL or your connection."),x(!1))};return T=setTimeout(()=>{v&&(p(!1),m("This page is taking too long to load. Check your connection or try refreshing."),T=null)},C),S.addEventListener("load",U),S.addEventListener("error",H),()=>{v=!1,T&&(clearTimeout(T),T=null),S&&r.current&&(S.removeEventListener("load",U),S.removeEventListener("error",H)),p(!1),m(null),x(!1)}},[n,o,l]),c.useEffect(()=>{if(n||!r.current||!l)return;const S=r.current;let v=!0;const C=3e4;let T=null;const U=()=>{if(v&&(T&&(clearTimeout(T),T=null),p(!1),m(null),!!r.current))try{r.current.contentDocument?.title,x(!1)}catch{x(!1)}},H=q=>{if(!v)return;T&&(clearTimeout(T),T=null),p(!1);const ae=q instanceof ErrorEvent&&q.message||"",re=q.target,F=ae&&(ae.toLowerCase().includes("x-frame-options")||ae.toLowerCase().includes("frame-ancestors")||ae.toLowerCase().includes("refused to display")||ae.toLowerCase().includes("denied")||ae.toLowerCase().includes("frame")&&ae.toLowerCase().includes("blocked"))||re===S&&S.contentWindow===null&&S.contentDocument===null;if(l&&!F){const N=l.toLowerCase();if(N.includes("duckduckgo.com")||N.includes("google.com/search"))try{const R=new URL(l),W=R.searchParams.get("q")||R.searchParams.get("query")||"";if(W){const be=`https://www.bing.com/search?q=${encodeURIComponent(W)}`;console.log("[TabContentSurface] Converting iframe-blocked search to Bing:",be),setTimeout(()=>{r.current&&(r.current.src=be,p(!0),m(null))},100);return}}catch{}}F?(x(!0),m("This site blocks embedded views (X-Frame-Options).")):(m("Failed to load this page. Please check the URL or your connection."),x(!1))};T=setTimeout(()=>{v&&(p(!1),m("This page is taking too long to load. Check your connection or try refreshing."),T=null)},C),S.addEventListener("load",U),S.addEventListener("error",H);const Y=(q=>{q.detail?.tabId===t?.id&&(v=!1,T&&(clearTimeout(T),T=null),S&&r.current&&(S.removeEventListener("load",U),S.removeEventListener("error",H),S.src="about:blank"))});return window.addEventListener("tab-closed",Y),()=>{v=!1,window.removeEventListener("tab-closed",Y),T&&(clearTimeout(T),T=null),S&&r.current&&(S.removeEventListener("load",U),S.removeEventListener("error",H),S.src="about:blank"),p(!1),m(null),x(!1)}},[n,o,l,t?.id]);const d=c.useCallback(()=>{if(l)try{window.open(l,"_blank","noopener,noreferrer")}catch(S){console.warn("[TabContentSurface] failed to open external window",S)}},[l]);c.useEffect(()=>{if(!l){p(!1),m(null),x(!1);return}if(!n){const S=r.current;if(!S)return;S.src!==l&&(p(!0),S.src=l),x(!1)}},[n,o,l]);const h=t?.id?`tabpanel-${t.id}`:"tabpanel-empty",w=t?.id?`tab-${t.id}`:void 0,k=!t||!t.active,O=Q(S=>S.mode??"Browse"),j=O==="Browse"||!O;return l?e.jsxs(_.div,{ref:a,className:`h-full w-full bg-black ${s?"pointer-events-none":""}`,id:h,role:"tabpanel","aria-labelledby":w,"aria-hidden":k,initial:{opacity:.4},animate:{opacity:1},transition:{duration:.35,ease:"easeOut"},style:{position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%",zIndex:k?0:1},children:[!n&&l?e.jsx("iframe",{ref:S=>{if(S&&(r.current=S,t?.id)){const v=Yt();bt(()=>{v.registerIframe(t.id,S,{lazy:!t.active,sandbox:at.split(" "),allow:"fullscreen; autoplay; camera; microphone; geolocation; payment; clipboard-read; clipboard-write; display-capture; storage-access"})})}},className:"h-full w-full border-0",style:{position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%",border:"none",contentVisibility:t?.active?"auto":"hidden",contain:"layout style paint"},src:l&&l!=="about:blank"?l:"regen://newtab",sandbox:at,allow:"fullscreen; autoplay; camera; microphone; geolocation; payment; clipboard-read; clipboard-write; display-capture; storage-access",referrerPolicy:"no-referrer",loading:t?.active?"eager":"lazy",fetchPriority:t?.active?"high":"low",title:t?.title??"Tab content","aria-label":t?.title?`Content for ${t.title}`:l?`External content for ${new URL(l).hostname}`:"Tab content","aria-live":"off",onError:S=>{console.warn("[TabContentSurface] Iframe error event:",S);const v=S.currentTarget;v&&!v.contentWindow&&!v.contentDocument&&(x(!0),m("This site blocks embedded views (X-Frame-Options)."))}}):null,e.jsx(ee,{children:u&&e.jsx(_.div,{className:"pointer-events-none absolute inset-0 z-10 flex items-center justify-center bg-slate-950/55 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},role:"status","aria-live":"polite","aria-label":"Loading page content",children:e.jsxs(_.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.2},className:"flex flex-col items-center gap-4 rounded-2xl border border-slate-700/60 bg-slate-900/90 px-6 py-5 text-sm text-slate-200 shadow-lg shadow-black/40",children:[e.jsx(_.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:e.jsx(ot,{className:"h-6 w-6 text-emerald-300","aria-hidden":"true"})}),e.jsxs("div",{className:"w-full max-w-xs text-center",children:[e.jsxs("div",{className:"mb-2 font-medium",children:["Loading ",new URL(l).hostname,"…"]}),e.jsx("div",{className:"mb-3 mt-1 text-xs text-slate-400",children:"This may take a moment"}),e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"h-1 w-full overflow-hidden rounded-full bg-slate-800/60",children:e.jsx(_.div,{className:"h-full bg-gradient-to-r from-emerald-500 via-cyan-500 to-emerald-500",initial:{x:"-100%",width:"40%"},animate:{x:["-100%","100%"]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}})})})]})]})})}),e.jsx(ee,{children:b&&e.jsx(_.div,{className:"pointer-events-auto absolute inset-0 z-10 flex items-center justify-center bg-slate-950/80 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},role:"alert","aria-live":"assertive",children:e.jsxs(_.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{duration:.18},className:"max-w-md space-y-3 rounded-2xl border border-amber-400/40 bg-amber-500/15 px-5 py-4 text-center text-sm text-amber-100 shadow-lg shadow-black/50",children:[e.jsx("div",{className:"font-medium",children:b}),e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("button",{type:"button",onClick:()=>{if(l&&n){const S=K.getState().activeId;S&&E.tabs.reload({id:S}).catch(console.error),m(null),p(!0)}else l&&!n&&r.current&&(m(null),p(!0),r.current.src=l)},className:"rounded-lg border border-amber-400/60 bg-amber-500/20 px-3 py-1.5 text-xs font-medium text-amber-50 transition-colors hover:bg-amber-500/30",children:"Retry"})})]})})}),e.jsx(ee,{children:!n&&y&&e.jsx(_.div,{className:"absolute inset-0 z-20 flex items-center justify-center bg-slate-950/85 px-6",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(_.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.92,opacity:0},transition:{duration:.22},className:"max-w-lg space-y-4 rounded-3xl border border-emerald-500/40 bg-emerald-500/15 p-6 text-center text-sm text-emerald-100 shadow-2xl shadow-black/50",children:[e.jsxs("div",{className:"text-lg font-semibold text-emerald-50",children:[l?new URL(l).hostname:"This page"," cannot be embedded"]}),e.jsx("p",{className:"text-emerald-100/70",children:"This site blocks embedded views for security (X-Frame-Options). You can open it in your system browser or use the desktop build for full webview support."}),e.jsx("div",{className:"flex items-center justify-center gap-3",children:e.jsxs("button",{type:"button",onClick:d,className:"inline-flex items-center gap-2 rounded-xl border border-emerald-400/60 bg-emerald-500/20 px-4 py-2 text-sm font-medium text-emerald-50 transition hover:border-emerald-300/70 hover:bg-emerald-500/30",children:[e.jsx(ht,{size:16}),"Open in Browser"]})})]})})})]},l):e.jsx(_.div,{id:h,role:"tabpanel","aria-labelledby":w,"aria-hidden":k,className:"h-full w-full overflow-hidden bg-black",initial:{opacity:0},animate:{opacity:1},transition:{duration:.2},style:{position:"absolute",inset:0,zIndex:k?0:1,pointerEvents:"auto"},children:j?e.jsx(_r,{}):e.jsx(fr,{variant:"split",forceShow:!0})})}function gs(t){const s="allow-scripts allow-same-origin allow-forms allow-popups allow-modals";return t?"allow-scripts allow-forms allow-popups":s}function Vr(t,s){t&&(s?(t.setAttribute("sandbox",gs(!0)),t.setAttribute("referrerpolicy","no-referrer")):(t.setAttribute("sandbox",gs(!1)),t.setAttribute("referrerpolicy","no-referrer-when-downgrade")))}const Kr=["ob://","about:","chrome://","edge://","app://","regen://"];function Hr(t){return t?Kr.some(s=>t.startsWith(s)):!0}function bs(t,s){let a=t.url;if(!a||a==="about:blank"||Hr(a))return null;if(!a.startsWith("http://")&&!a.startsWith("https://")){const r=aa(a,"bing",s!=="auto"?s:void 0,!0);return r||`https://www.bing.com/search?q=${encodeURIComponent(a)}`}return a}function Gr({tabs:t,activeTabId:s}){const a=Ce(l=>l.language||"auto"),r=Ce(l=>l.privacy),n=r.trackerProtection&&r.adBlockEnabled,o=Se(),i=c.useRef(new Map),u=c.useRef(Yt());c.useRef(ra());const p=c.useRef(new Set),b=c.useRef(new Map),m=c.useRef(new Map),y=c.useRef(new Map),x=l=>d=>{d?(i.current.set(l,d),o||bt(()=>{u.current.registerIframe(l,d,{lazy:!0,sandbox:n?["allow-scripts","allow-forms","allow-popups"]:at.split(" "),allow:"fullscreen; autoplay; camera; microphone; geolocation; payment; clipboard-read; clipboard-write; display-capture; storage-access"})})):(i.current.delete(l),o||u.current.unregisterIframe(l))};return c.useEffect(()=>{o||t.forEach(l=>{const d=i.current.get(l.id);if(!d)return;const h=bs(l,a),w=d.src;if(h&&h!==w&&h!=="about:blank"){const k=l.id===s;(k||w==="about:blank")&&(console.log("[TabIframeManager] Updating iframe src from tab URL change",{tabId:l.id,oldSrc:w,newSrc:h,isActive:k}),d.src=h)}})},[t,a,s,o]),c.useEffect(()=>{if(o)return;const d=setInterval(()=>{t.forEach(h=>{const w=i.current.get(h.id);if(w)try{!(w.contentWindow!==null)&&w.src&&!w.src.startsWith("about:")?setTimeout(()=>{try{!w.contentWindow&&w.src&&(console.warn("[TabIframeManager] Detected X-Frame-Options blocking for tab",h.id,h.url),p.current.add(h.id),window.dispatchEvent(new CustomEvent("iframe-blocked",{detail:{tabId:h.id,url:h.url}})))}catch{}},2e3):p.current.delete(h.id)}catch{}})},1e3);return()=>{clearInterval(d),o||i.current.forEach((h,w)=>{u.current.unregisterIframe(w)}),i.current.forEach((h,w)=>{h._cleanup&&(h._cleanup(),delete h._cleanup);const k=b.current.get(w);k&&(k.disconnect(),b.current.delete(w));const O=m.current.get(w);if(O&&h.contentDocument){try{h.contentDocument.removeEventListener("click",O,!0)}catch{}m.current.delete(w)}const j=y.current.get(w);if(j&&h.contentWindow){try{h.contentWindow.removeEventListener("popstate",j),h.contentWindow.removeEventListener("hashchange",j)}catch{}y.current.delete(w)}})}},[t,o]),e.jsx("div",{className:"relative h-full w-full",children:t.map(l=>{const d=bs(l,a),h=l.id===s;p.current.has(l.id);const w=d||"about:blank",k=i.current.get(l.id);return k&&k.src!==w&&w!=="about:blank"&&h&&(console.log("[TabIframeManager] Updating iframe src",{tabId:l.id,oldSrc:k.src,newSrc:w,isActive:h}),requestAnimationFrame(()=>{const j=i.current.get(l.id);j&&l.id===s&&(j.src=w)})),e.jsx("iframe",{ref:j=>{x(l.id)(j),j&&n&&Vr(j,n),j&&!o&&(j.style.contentVisibility=h?"auto":"hidden",j.style.contain="layout style paint",j.setAttribute("fetchpriority",h?"high":"low"))},src:w,title:l.title??"Tab content",sandbox:n?"allow-scripts allow-forms allow-popups":at,allow:"fullscreen; autoplay; camera; microphone; geolocation; payment; clipboard-read; clipboard-write; display-capture; storage-access",referrerPolicy:n?"no-referrer":"no-referrer-when-downgrade",loading:h?"eager":"lazy",className:"absolute inset-0 h-full w-full border-0",style:{display:h?"block":"none",pointerEvents:h?"auto":"none",zIndex:h?1:0,visibility:h?"visible":"hidden",contentVisibility:h?"auto":"hidden",contain:"layout style paint"},"aria-label":l.title?`Content for ${l.title}`:d?`External content for ${new URL(d).hostname}`:"Tab content","aria-live":"off",onLoad:()=>{const j=i.current.get(l.id);if(j){try{const S=j.contentWindow,v=j.contentDocument;let C=null,T=null;try{C=S?.location.href||null,T=v?.title||null}catch{C=j.src||null}if(console.log("[TabIframeManager] Iframe loaded",{tabId:l.id,currentUrl:C,currentTitle:T,iframeSrc:j.src,isActive:h}),C&&C!==l.url&&!C.startsWith("about:")){console.log("[TabIframeManager] URL changed, updating tab",{tabId:l.id,oldUrl:l.url,newUrl:C});const U={url:C};T?U.title=T:U.title=Tt(C),K.getState().updateTab(l.id,U)}else if(T&&T!==l.title)console.log("[TabIframeManager] Title changed, updating tab",{tabId:l.id,oldTitle:l.title,newTitle:T}),K.getState().updateTab(l.id,{title:T});else if(!T&&C&&C!==l.url){const U=Tt(C);console.log("[TabIframeManager] Cross-origin navigation, deriving title from URL",{tabId:l.id,url:C,derivedTitle:U}),K.getState().updateTab(l.id,{url:C,title:U})}if(S&&v){console.log("[TabIframeManager] Injecting interceptors for tab",l.id);const U=S.open;S.open=(F,N,R)=>{if(console.log("[TabIframeManager] window.open intercepted",{url:F,target:N,tabId:l.id}),F){const W=typeof F=="string"?F:F.toString();window.postMessage({type:"open-in-new-tab",url:W,sourceTabId:l.id},"*")}return null};const H=F=>{const R=F.target.closest?.("a");if(!(!R||!R.href)){if(R.target==="_blank"||R.target==="_new"){F.preventDefault(),F.stopPropagation(),console.log('[TabIframeManager] target="_blank" click intercepted',{href:R.href,tabId:l.id}),window.postMessage({type:"open-in-new-tab",url:R.href,sourceTabId:l.id},"*");return}if(R.href&&R.href!==l.url&&!R.href.startsWith("about:")){const W=R.href;console.log("[TabIframeManager] Link clicked, updating tab URL",{tabId:l.id,clickedUrl:W,currentUrl:l.url});const be=Tt(W);K.getState().updateTab(l.id,{url:W,title:be})}}};m.current.set(l.id,H),v.addEventListener("click",H,!0);const Y=()=>{try{const F=S.location.href,N=v?.title||null;if(F&&F!==l.url&&!F.startsWith("about:")){console.log("[TabIframeManager] Navigation detected, updating URL and title",{tabId:l.id,newUrl:F,newTitle:N});const R={url:F};N&&(R.title=N),K.getState().updateTab(l.id,R)}else N&&N!==l.title&&(console.log("[TabIframeManager] Title updated",{tabId:l.id,newTitle:N}),K.getState().updateTab(l.id,{title:N}))}catch{console.log("[TabIframeManager] Navigation detected (cross-origin, URL tracking limited)",l.id)}},q=Y,ae=Y;y.current.set(l.id,q),S.addEventListener("popstate",q),S.addEventListener("hashchange",ae);const re=()=>{try{S.removeEventListener("popstate",q),S.removeEventListener("hashchange",ae),y.current.delete(l.id)}catch{}};if(j._cleanup=re,v){const F=new MutationObserver(()=>{try{const R=v.title;R&&R!==l.title&&(console.log("[TabIframeManager] Title changed via MutationObserver",{tabId:l.id,newTitle:R}),K.getState().updateTab(l.id,{title:R}))}catch{}}),N=v.querySelector("title");N&&(F.observe(N,{childList:!0,subtree:!0,characterData:!0}),b.current.set(l.id,F))}console.log("[TabIframeManager] Interceptors installed for tab",l.id)}else console.warn("[TabIframeManager] Cannot access iframe contentWindow/contentDocument (cross-origin)",l.id)}catch{console.warn("[TabIframeManager] Could not inject interceptors (cross-origin expected)",l.id)}try{!j.contentWindow&&d&&!d.startsWith("about:")&&(console.warn("[TabIframeManager] X-Frame-Options detected on load",l.id),p.current.add(l.id),window.dispatchEvent(new CustomEvent("iframe-blocked",{detail:{tabId:l.id,url:l.url}})))}catch{}}},onError:j=>{console.warn("[TabIframeManager] Iframe error",{tabId:l.id,url:d,error:j}),d&&!d.startsWith("about:")&&(p.current.add(l.id),window.dispatchEvent(new CustomEvent("iframe-blocked",{detail:{tabId:l.id,url:l.url}})))}},l.id)})})}function Yr(t){return[{id:"doc-edit-open",title:"Open Document Editor",description:"Open the document auto-edit interface",icon:ge,action:()=>t("/doc-editor"),keywords:["document","edit","doc","file","word","pdf","excel"],category:"document"},{id:"doc-rewrite",title:"Rewrite Document",description:"AI-powered document rewriting",icon:xe,action:()=>{t("/doc-editor"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("doc-command",{detail:{task:"rewrite"}}))},500)},keywords:["rewrite","rephrase","edit","improve"],category:"document"},{id:"doc-grammar",title:"Fix Grammar",description:"Fix grammar and spelling errors",icon:Ca,action:()=>{t("/doc-editor"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("doc-command",{detail:{task:"grammar"}}))},500)},keywords:["grammar","spell","check","fix","correct"],category:"document"},{id:"doc-translate",title:"Translate Document",description:"Translate document to another language",icon:qs,action:()=>{t("/doc-editor"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("doc-command",{detail:{task:"translate"}}))},500)},keywords:["translate","language","convert","hindi","english"],category:"document"},{id:"doc-excel-normalize",title:"Normalize Excel Data",description:"Clean and normalize spreadsheet data",icon:Ma,action:()=>{t("/doc-editor"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("doc-command",{detail:{task:"normalize"}}))},500)},keywords:["excel","normalize","clean","spreadsheet","data"],category:"document"}]}function Jr(){const[t,s]=c.useState(""),[a,r]=c.useState([]),[n,o]=c.useState(!1),[i,u]=c.useState(!1),[p,b]=c.useState(0),m=c.useRef(null),{tabs:y,setActive:x}=K(),l=Pa(),d=c.useMemo(()=>Yr(l),[l]);async function h(j){if(j.length<2){r([]);return}u(!0);try{const S=[],v=j.toLowerCase();d.filter(T=>`${T.title} ${T.description} ${T.keywords.join(" ")}`.toLowerCase().includes(v)).forEach(T=>{S.push({id:T.id,title:T.title,content:T.description,_index:"commands",command:T})});try{const T=await gr([{indexUid:"tabs",q:j,limit:5},{indexUid:"notes",q:j,limit:5},{indexUid:"research",q:j,limit:5},{indexUid:"charts",q:j,limit:5}]);T.results&&Array.isArray(T.results)&&T.results.forEach(U=>{U.hits&&Array.isArray(U.hits)&&U.hits.forEach(H=>{S.push({...H,_index:U.indexUid})})})}catch{console.debug("[GlobalSearch] MeiliSearch not available")}r(S),b(0)}catch(S){console.error("[GlobalSearch] Search error:",S),r([])}finally{u(!1)}}c.useEffect(()=>{if(!n)return;const j=setTimeout(()=>{h(t)},300);return()=>clearTimeout(j)},[t,n]),c.useEffect(()=>{const j=S=>{(S.ctrlKey||S.metaKey)&&S.key==="k"&&(S.preventDefault(),o(!0),setTimeout(()=>m.current?.focus(),100)),S.key==="Escape"&&n&&(o(!1),s(""),r([])),n&&a.length>0&&(S.key==="ArrowDown"?(S.preventDefault(),b(v=>Math.min(v+1,a.length-1))):S.key==="ArrowUp"?(S.preventDefault(),b(v=>Math.max(v-1,0))):S.key==="Enter"&&p>=0&&p<a.length&&(S.preventDefault(),w(a[p])))};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[n,a,p]),c.useEffect(()=>{n&&setTimeout(()=>m.current?.focus(),100)},[n]);const w=j=>{if(j._index==="commands"&&j.command){j.command.action(),o(!1),s(""),r([]);return}if(j._index==="tabs"&&j.url){const S=y.find(v=>v.url===j.url);S?x(S.id):K.getState().add({id:`tab-${Date.now()}`,title:j.title||"New Tab",url:j.url})}else j._index==="notes"||j._index==="research"?console.log("Open note/research:",j):j._index==="charts"&&console.log("Open chart:",j);o(!1),s(""),r([])},k=j=>{if(j._index==="commands"&&j.command){const S=j.command.icon;return e.jsx(S,{size:16,className:"text-cyan-400"})}switch(j._index){case"tabs":return e.jsx(qt,{size:16,className:"text-blue-400"});case"notes":return e.jsx(ge,{size:16,className:"text-green-400"});case"research":return e.jsx(it,{size:16,className:"text-purple-400"});case"charts":return e.jsx(Ks,{size:16,className:"text-yellow-400"});case"commands":return e.jsx(ge,{size:16,className:"text-cyan-400"});default:return e.jsx(fe,{size:16,className:"text-gray-400"})}},O=j=>j.title||j.content||j.symbol||"Untitled";return e.jsx(ee,{children:n&&e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[99999] flex items-start justify-center bg-black/70 pt-32 backdrop-blur-sm",onClick:()=>{o(!1),s(""),r([])},children:e.jsxs(_.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"w-full max-w-3xl overflow-hidden rounded-2xl border border-purple-800 bg-gray-900 shadow-2xl",onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center gap-4 border-b border-gray-800 px-6 py-4",children:[e.jsx(fe,{size:20,className:"text-purple-400"}),e.jsx("input",{ref:m,id:"global-search-input",name:"global-search-query",type:"text",placeholder:"Search tabs, notes, charts, research… (Hindi bhi chalega)",className:"flex-1 bg-transparent text-lg text-white placeholder-purple-400 outline-none",value:t,onChange:j=>s(j.target.value),onKeyDown:j=>{j.key==="Escape"&&(o(!1),s(""),r([]))}}),t&&e.jsx("button",{onClick:()=>{s(""),r([]),m.current?.focus()},className:"text-gray-400 hover:text-white",children:e.jsx(oe,{size:18})})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-b-2 border-purple-400"})}):a.length===0&&t.length>=2?e.jsxs("div",{className:"py-12 text-center text-gray-500",children:['No results found for "',t,'"']}):a.length===0?e.jsxs("div",{className:"py-12 text-center text-gray-500",children:[e.jsx("p",{className:"mb-2",children:"Type to search..."}),e.jsx("p",{className:"text-sm text-gray-600",children:"Search across tabs, notes, research, and charts"})]}):a.map((j,S)=>e.jsxs(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:S*.05},className:`flex cursor-pointer items-center gap-4 px-6 py-4 transition-colors ${S===p?"border-l-2 border-purple-400 bg-purple-900/50":"hover:bg-purple-900/30"}`,onClick:()=>w(j),onMouseEnter:()=>b(S),children:[k(j),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"mb-1 flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium uppercase text-purple-400",children:j._index}),j.timestamp&&e.jsxs("span",{className:"text-xs text-gray-500",children:[e.jsx(Vs,{size:12,className:"mr-1 inline"}),new Date(j.timestamp).toLocaleDateString()]})]}),e.jsx("div",{className:"truncate font-medium text-white",children:O(j)}),j.content&&j.content!==O(j)&&e.jsxs("div",{className:"mt-1 truncate text-sm text-gray-400",children:[j.content.slice(0,100),j.content.length>100?"...":""]}),j.url&&e.jsx("div",{className:"mt-1 truncate text-xs text-gray-500",children:j.url})]})]},`${j._index}-${j.id}`))}),a.length>0&&e.jsxs("div",{className:"flex items-center justify-between border-t border-gray-800 px-6 py-3 text-xs text-gray-500",children:[e.jsx("span",{children:"↑↓ Navigate • Enter Select • Esc Close"}),e.jsxs("span",{children:[a.length," result",a.length!==1?"s":""]})]})]})})})}async function Qr(t,s){if(console.log("[IframeBlockedFallback] Handling blocked iframe",{tabId:t,url:s}),Re())try{await xs("navigate_main_webview",{url:s}),console.log("[IframeBlockedFallback] Emitted navigation event")}catch(a){console.warn("[IframeBlockedFallback] Failed to open in main webview, trying external browser",a);try{await xs("open_external",{url:s}),console.log("[IframeBlockedFallback] Opened in external browser")}catch(r){console.error("[IframeBlockedFallback] Failed to open in external browser",r),window.open(s,"_blank")}}else window.open(s,"_blank")}function Xr(){const t=s=>{Qr(s.detail.tabId,s.detail.url)};return window.addEventListener("iframe-blocked",t),()=>{window.removeEventListener("iframe-blocked",t)}}function Zr(t,s){const a=c.useRef(s);c.useEffect(()=>{a.current=s},[s]),c.useEffect(()=>{const r=typeof t=="function"?t:a.current;return r?Bs.watch(t,o=>{r(o)}):void 0},[t])}function en({tabId:t,reason:s,exitCode:a,onClose:r,onReload:n}){const[o]=c.useState([]),[i,u]=c.useState(!1);c.useEffect(()=>{(async()=>{})()},[]);const p=()=>{n(),r()},b=async m=>{u(!0);try{r()}catch(y){console.error("Failed to restore snapshot:",y)}finally{u(!1)}};return e.jsx(ee,{children:e.jsx("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:m=>{m.target===m.currentTarget&&r()},children:e.jsx(_.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"rounded-2xl border border-red-500/40 bg-gray-900/95 backdrop-blur-xl shadow-2xl p-6 max-w-md w-full mx-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"rounded-full bg-red-500/20 p-3",children:e.jsx(yt,{size:24,className:"text-red-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-1",children:"Tab Crashed"}),e.jsxs("p",{className:"text-sm text-gray-400 mb-4",children:["This tab encountered an error and stopped responding.",s&&e.jsxs("span",{className:"block mt-1 text-xs",children:["Reason: ",s,a!==void 0&&` (Exit code: ${a})`]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("button",{onClick:m=>{m.stopImmediatePropagation(),m.stopPropagation(),p()},onMouseDown:m=>{m.stopImmediatePropagation(),m.stopPropagation()},disabled:i,className:"flex items-center justify-center gap-2 rounded-lg border border-blue-500/60 bg-blue-500/20 px-4 py-2 text-sm font-medium text-blue-100 transition-colors hover:bg-blue-500/30 disabled:opacity-50 disabled:cursor-not-allowed",style:{zIndex:10011,isolation:"isolate"},children:[e.jsx(Hs,{size:16}),"Reload Tab"]}),o.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Or restore from snapshot:"}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:o.slice(0,3).map(m=>e.jsx("button",{onClick:y=>{y.stopImmediatePropagation(),y.stopPropagation(),b(m.id)},onMouseDown:y=>{y.stopImmediatePropagation(),y.stopPropagation()},disabled:i,className:"w-full flex items-center justify-between rounded-lg border border-gray-700/60 bg-gray-800/60 px-3 py-2 text-xs text-gray-300 transition-colors hover:bg-gray-700/60 disabled:opacity-50",style:{zIndex:10011,isolation:"isolate"},children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(xt,{size:12}),new Date(m.timestamp).toLocaleString()]})},m.id))})]}),e.jsx("button",{onClick:m=>{m.stopImmediatePropagation(),m.stopPropagation(),r()},onMouseDown:m=>{m.stopImmediatePropagation(),m.stopPropagation()},className:"mt-2 rounded-lg border border-gray-700/60 bg-gray-800/60 px-4 py-2 text-sm text-gray-400 transition-colors hover:bg-gray-700/60",style:{zIndex:10011,isolation:"isolate"},children:"Close"})]})]}),e.jsx("button",{onClick:m=>{m.stopImmediatePropagation(),m.stopPropagation(),r()},onMouseDown:m=>{m.stopImmediatePropagation(),m.stopPropagation()},className:"rounded-lg p-1 text-gray-400 hover:text-gray-200 transition-colors",style:{zIndex:10011,isolation:"isolate"},children:e.jsx(oe,{size:18})})]})})})})}function tn(){const[t,s]=c.useState(null);return c.useEffect(()=>{const r=o=>{s(o)};return Le.on("tabs:crash-detected",r)},[]),{crashedTab:t,setCrashedTab:s,handleReload:async()=>{if(t)try{(await E.tabs.list()).find(o=>o.id===t.tabId)?await E.tabs.reload(t.tabId):await E.tabs.create("about:blank")}catch(r){console.error("Failed to reload crashed tab:",r)}}}}function sn(t){return typeof t=="string"?`var(--space-${t})`:`var(--space-${t})`}function vt(){return{spacing:Object.assign(sn,{xs:"var(--space-2)",sm:"var(--space-3)",md:"var(--space-4)",lg:"var(--space-6)",xl:"var(--space-8)","2xl":"var(--space-10)"}),fontSize:{xs:"var(--font-size-xs)",sm:"var(--font-size-sm)",base:"var(--font-size-base)",lg:"var(--font-size-lg)",xl:"var(--font-size-xl)","2xl":"var(--font-size-2xl)","3xl":"var(--font-size-3xl)","4xl":"var(--font-size-4xl)","5xl":"var(--font-size-5xl)"},color:{primary:"var(--color-primary-500)",primaryHover:"var(--color-primary-400)",primaryActive:"var(--color-primary-600)",surface:"var(--surface-panel)",surfaceHover:"var(--surface-hover)",surfaceActive:"var(--surface-active)",border:"var(--surface-border)",borderStrong:"var(--surface-border-strong)",text:"var(--text-primary)",textMuted:"var(--text-muted)",accent:"var(--accent)"},radius:{sm:"var(--radius-md, 0.375rem)",md:"var(--radius-lg, 0.5rem)",lg:"var(--radius-2xl, 1rem)",pill:"9999px"},shadow:{sm:"var(--shadow-sm)",md:"var(--shadow-md)",lg:"var(--shadow-lg)"}}}const an="bg-slate-800/60 rounded",rn="animate-pulse",nn={text:"h-4",circular:"rounded-full",rectangular:"rounded-md",rounded:"rounded-lg"},pt=te.forwardRef(({variant:t="rectangular",width:s,height:a,animate:r=!0,className:n,style:o,...i},u)=>{const p=nn[t],b={width:s?typeof s=="number"?`${s}px`:s:void 0,height:a?typeof a=="number"?`${a}px`:a:void 0,...o},m={initial:{opacity:.6},animate:{opacity:[.6,1,.6]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}};return e.jsx(_.div,{ref:u,className:We(an,p,r&&rn,n),style:b,...m,"aria-busy":"true","aria-label":"Loading content",...i})});pt.displayName="Skeleton";function on({items:t=5,className:s,...a}){return e.jsx("div",{className:We("space-y-2",s),...a,children:Array.from({length:t}).map((r,n)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg",children:[e.jsx(pt,{variant:"circular",width:40,height:40}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(pt,{variant:"text",width:"70%",height:16}),e.jsx(pt,{variant:"text",width:"50%",height:12})]})]},n))})}const ln={primary:"bg-[var(--color-primary-600)] text-white shadow-[0_12px_20px_rgba(37,99,235,0.25)] hover:bg-[var(--color-primary-500)] focus-visible:ring-[var(--color-primary-400)]",secondary:"bg-[var(--surface-elevated)] text-[var(--text-primary)] border border-[var(--surface-border)] hover:bg-[var(--surface-hover)] focus-visible:ring-[var(--surface-border-strong)]",ghost:"bg-transparent text-[var(--text-primary)] hover:bg-[var(--surface-hover)] focus-visible:ring-[var(--surface-border)]",danger:"bg-[#dc2626] text-white hover:bg-[#b91c1c] focus-visible:ring-[#f87171]"},cn={sm:"h-8 px-3 text-xs gap-1.5",md:"h-10 px-4 text-sm gap-2",lg:"h-12 px-6 text-base gap-2.5"},je=c.forwardRef(({tone:t="primary",size:s="md",loading:a=!1,icon:r,trailingIcon:n,fullWidth:o,disabled:i,className:u,children:p,...b},m)=>{const y=i||a;return e.jsx(_.button,{...b,ref:m,className:We("inline-flex items-center justify-center rounded-full font-medium transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--surface-root)]",ln[t],cn[s],o&&"w-full",y&&"opacity-50 cursor-not-allowed",u),disabled:y,whileHover:y?void 0:{scale:1.015},whileTap:y?void 0:{scale:.97},children:a?e.jsxs(e.Fragment,{children:[e.jsx(ot,{className:"animate-spin",size:s==="sm"?14:s==="md"?16:18}),e.jsx("span",{children:"Loading"})]}):e.jsxs(e.Fragment,{children:[r&&e.jsx("span",{className:"flex-shrink-0",children:r}),p&&e.jsx("span",{className:"truncate",children:p}),n&&e.jsx("span",{className:"flex-shrink-0",children:n})]})})});je.displayName="Button";const dn=c.forwardRef(({icon:t,size:s="md",...a},r)=>{const n=s==="sm"?16:s==="md"?18:20;return e.jsx(je,{ref:r,...a,size:s,className:We("rounded-full p-0",s==="sm"&&"w-8 h-8",s==="md"&&"w-10 h-10",s==="lg"&&"w-12 h-12",a.className),children:e.jsx("span",{style:{width:n,height:n},className:"flex items-center justify-center",children:t})})});dn.displayName="IconButton";const un=c.forwardRef(({position:t="bottom-right",fixed:s=!0,className:a,...r},n)=>{const o={"bottom-right":s?"fixed bottom-6 right-6":"","bottom-left":s?"fixed bottom-6 left-6":"","top-right":s?"fixed top-6 right-6":"","top-left":s?"fixed top-6 left-6":""};return e.jsx(je,{ref:n,...r,size:"lg",className:We("rounded-full shadow-lg z-50",o[t],a)})});un.displayName="FAB";const Oe=c.forwardRef(({className:t,leadingIcon:s,trailingIcon:a,disabled:r,...n},o)=>e.jsxs("label",{className:We("inline-flex h-11 items-center gap-2 rounded-2xl border border-[var(--surface-border)] bg-[var(--surface-elevated)] px-3 text-sm text-[var(--text-primary)] transition focus-within:border-[var(--surface-border-strong)] focus-within:ring-2 focus-within:ring-[var(--accent)]",r&&"opacity-60 cursor-not-allowed",t),children:[s&&e.jsx("span",{className:"text-[var(--text-muted)]",children:s}),e.jsx("input",{...n,ref:o,disabled:r,className:"h-full flex-1 bg-transparent text-[var(--text-primary)] placeholder:text-[var(--text-muted)] focus:outline-none"}),a&&e.jsx("span",{className:"text-[var(--text-muted)]",children:a})]}));Oe.displayName="Input";const na=c.forwardRef(({className:t,label:s,disabled:a,...r},n)=>e.jsxs("div",{className:"space-y-1.5",children:[s&&e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-[var(--text-muted)]",children:s}),e.jsx("textarea",{...r,ref:n,disabled:a,className:We("w-full rounded-2xl border border-[var(--surface-border)] bg-[var(--surface-elevated)] px-3 py-2 text-sm text-[var(--text-primary)] placeholder:text-[var(--text-muted)] transition focus:border-[var(--surface-border-strong)] focus:outline-none focus:ring-2 focus:ring-[var(--accent)]",a&&"opacity-60 cursor-not-allowed",t)})]}));na.displayName="TextArea";const At=[{value:"note",label:"Note",icon:ge,description:"Save a text note with tags"},{value:"bookmark",label:"Bookmark",icon:Aa,description:"Bookmark a URL for later"},{value:"task",label:"Task",icon:_a,description:"Create a task with optional due date"}];function mn({open:t,onClose:s,onCreated:a,initialType:r,initialUrl:n,initialTitle:o}){const i=vt(),[u,p]=c.useState(r==="note"||r==="bookmark"||r==="task"?r:"note"),[b,m]=c.useState(o||""),[y,x]=c.useState(n||""),[l,d]=c.useState(""),[h,w]=c.useState([]),[k,O]=c.useState(""),[j,S]=c.useState("medium"),[v,C]=c.useState(""),[T,U]=c.useState(!1),H=c.useCallback(()=>{const N=k.trim();N&&!h.includes(N)&&(w([...h,N.startsWith("#")?N:`#${N}`]),O(""))},[k,h]),Y=c.useCallback(N=>{w(h.filter(R=>R!==N))},[h]),q=c.useCallback(N=>{(N.key==="Enter"||N.key===",")&&(N.preventDefault(),H())},[H]),ae=c.useCallback(async N=>{N.preventDefault(),U(!0);try{let R="";if(u==="note"){if(!l.trim()){se("error","Note content is required"),U(!1);return}R=await yr(y||window.location.href,{title:b||"Untitled Note",notePreview:l,noteLength:l.length,tags:h.length>0?h:void 0,url:y||void 0})}else if(u==="bookmark"){if(!y.trim()){se("error","URL is required for bookmarks"),U(!1);return}const W={title:b||"Untitled Bookmark"};h.length>0&&(W.tags=h),R=await vr(y,W)}else if(u==="task"){if(!b.trim()){se("error","Task title is required"),U(!1);return}const W={url:y||void 0,notes:l||void 0,priority:j,dueDate:v?new Date(v).getTime():void 0};h.length>0&&(W.tags=h),R=await wr(b,W)}R?(se("success",`${At.find(W=>W.value===u)?.label} created successfully`),m(""),x(""),d(""),w([]),O(""),S("medium"),C(""),a?.(),s()):se("error","Failed to create memory")}catch(R){console.error("[CreateMemoryDialog] Failed to create memory:",R),se("error","Failed to create memory")}finally{U(!1)}},[u,b,y,l,h,j,v,a,s]),re=c.useCallback(()=>{T||s()},[T,s]);if(!t)return null;const F=At.find(N=>N.value===u);return e.jsx(ee,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:re,className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50","aria-hidden":"true"}),e.jsx(_.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"fixed inset-0 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"create-memory-title",children:e.jsxs("div",{className:"w-full max-w-lg bg-[var(--surface-root)] border border-[var(--surface-border)] rounded-xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden",onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-[var(--surface-border)]",style:{padding:i.spacing(4)},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[F&&e.jsx(F.icon,{size:20,className:"text-[var(--color-primary-400)] flex-shrink-0"}),e.jsx("h2",{id:"create-memory-title",className:"font-semibold text-[var(--text-primary)]",style:{fontSize:i.fontSize.lg},children:"Create Memory"})]}),e.jsx("button",{onClick:N=>{N.stopImmediatePropagation(),N.stopPropagation(),re()},onMouseDown:N=>{N.stopImmediatePropagation(),N.stopPropagation()},disabled:T,className:"rounded-lg p-1.5 text-[var(--text-muted)] hover:text-[var(--text-primary)] hover:bg-[var(--surface-hover)] transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] disabled:opacity-50",style:{zIndex:10011,isolation:"isolate"},"aria-label":"Close dialog",children:e.jsx(oe,{size:18})})]}),e.jsx("div",{className:"border-b border-[var(--surface-border)]",style:{padding:i.spacing(3),paddingTop:i.spacing(2)},children:e.jsx("div",{className:"flex gap-2",children:At.map(N=>{const R=N.icon;return e.jsxs("button",{onClick:W=>{W.stopImmediatePropagation(),W.stopPropagation(),p(N.value)},onMouseDown:W=>{W.stopImmediatePropagation(),W.stopPropagation()},className:`
                          flex-1 flex flex-col items-center gap-2 px-3 py-2.5 rounded-lg border transition-all
                          ${u===N.value?"bg-[var(--color-primary-600)] border-[var(--color-primary-500)] text-white":"bg-[var(--surface-elevated)] border-[var(--surface-border)] text-[var(--text-secondary)] hover:bg-[var(--surface-hover)]"}
                          focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1
                        `,style:{zIndex:10011,isolation:"isolate"},"aria-pressed":u===N.value,children:[e.jsx(R,{size:18}),e.jsx("div",{className:"text-xs font-medium",children:N.label})]},N.value)})})}),e.jsx("form",{onSubmit:N=>{N.preventDefault(),N.stopPropagation(),ae(N)},className:"flex-1 overflow-y-auto",style:{padding:i.spacing(4)},onMouseDown:N=>{const R=N.target;R.closest('button[type="submit"]')||R.closest("input")||R.closest("textarea")||R.closest("select")},onClick:N=>{const R=N.target;R.closest('button[type="submit"]')||R.closest("input")||R.closest("textarea")||R.closest("select")},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"memory-title",className:"block text-sm font-medium text-[var(--text-primary)] mb-1.5",style:{fontSize:i.fontSize.sm},children:["Title ",u==="task"&&e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx(Oe,{id:"memory-title",value:b,onChange:N=>m(N.target.value),placeholder:u==="task"?"Task title...":"Optional title...",required:u==="task",disabled:T})]}),(u==="bookmark"||u==="note")&&e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"memory-url",className:"block text-sm font-medium text-[var(--text-primary)] mb-1.5",style:{fontSize:i.fontSize.sm},children:["URL ",u==="bookmark"&&e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ra,{size:16,className:"text-[var(--text-muted)] flex-shrink-0"}),e.jsx(Oe,{id:"memory-url",type:"url",value:y,onChange:N=>x(N.target.value),placeholder:"https://example.com",required:u==="bookmark",disabled:T})]})]}),(u==="note"||u==="task")&&e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"memory-content",className:"block text-sm font-medium text-[var(--text-primary)] mb-1.5",style:{fontSize:i.fontSize.sm},children:[u==="note"?"Content":"Notes"," ",u==="note"&&e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx(na,{id:"memory-content",value:l,onChange:N=>d(N.target.value),placeholder:u==="note"?"Write your note...":"Optional notes...",rows:u==="note"?6:4,required:u==="note",disabled:T})]}),u==="task"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"memory-priority",className:"block text-sm font-medium text-[var(--text-primary)] mb-1.5",style:{fontSize:i.fontSize.sm},children:"Priority"}),e.jsxs("select",{id:"memory-priority",value:j,onChange:N=>S(N.target.value),className:"w-full px-3 py-2 rounded-lg bg-[var(--surface-panel)] border border-[var(--surface-border)] text-[var(--text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)]",style:{fontSize:i.fontSize.sm},disabled:T,children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"memory-due-date",className:"block text-sm font-medium text-[var(--text-primary)] mb-1.5",style:{fontSize:i.fontSize.sm},children:"Due Date"}),e.jsx(Oe,{id:"memory-due-date",type:"date",value:v,onChange:N=>C(N.target.value),disabled:T})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"memory-tags",className:"block text-sm font-medium text-[var(--text-primary)] mb-1.5",style:{fontSize:i.fontSize.sm},children:"Tags"}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Vt,{size:16,className:"text-[var(--text-muted)] flex-shrink-0"}),e.jsx(Oe,{id:"memory-tags",value:k,onChange:N=>O(N.target.value),onKeyDown:q,placeholder:"Add tags (press Enter or comma)",disabled:T}),e.jsx(je,{type:"button",tone:"secondary",size:"sm",icon:e.jsx(Kt,{size:14}),onClick:N=>{N.stopImmediatePropagation(),N.stopPropagation(),H()},onMouseDown:N=>{N.stopImmediatePropagation(),N.stopPropagation()},disabled:T||!k.trim(),style:{zIndex:10011,isolation:"isolate"},children:"Add"})]}),h.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:h.map(N=>e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-[var(--surface-elevated)] text-[var(--color-primary-300)] text-xs",style:{fontSize:i.fontSize.xs},children:[N,e.jsx("button",{type:"button",onClick:R=>{R.stopImmediatePropagation(),R.stopPropagation(),Y(N)},onMouseDown:R=>{R.stopImmediatePropagation(),R.stopPropagation()},className:"hover:text-red-400 transition-colors",style:{zIndex:10011,isolation:"isolate"},"aria-label":`Remove tag ${N}`,children:e.jsx(oe,{size:12})})]},N))})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-[var(--surface-border)]",style:{padding:i.spacing(4)},children:[e.jsx(je,{type:"button",tone:"secondary",onClick:N=>{N.stopImmediatePropagation(),N.stopPropagation(),re()},onMouseDown:N=>{N.stopImmediatePropagation(),N.stopPropagation()},disabled:T,style:{zIndex:10011,isolation:"isolate"},children:"Cancel"}),e.jsxs(je,{type:"submit",tone:"primary",onClick:N=>{N.preventDefault(),N.stopPropagation(),N.stopImmediatePropagation()},onMouseDown:N=>{N.stopPropagation()},disabled:T||!b.trim(),loading:T,style:{zIndex:10011,isolation:"isolate",pointerEvents:"auto"},children:["Create ",F?.label]})]})]})})]})})}function pn(t){const s={version:"1.0",exportedAt:new Date().toISOString(),count:t.length,memories:t.map(a=>({id:a.id,type:a.type,value:a.value,metadata:a.metadata,timestamp:a.ts,score:a.score}))};return JSON.stringify(s,null,2)}function fn(t){if(t.length===0)return`Type,Value,Title,URL,Timestamp,Tags
`;const s=["Type","Value","Title","URL","Timestamp","Date","Time","Tags","Pinned"],a=t.map(n=>{const o=new Date(n.ts),i=Array.isArray(n.metadata?.tags)?n.metadata.tags.join("; "):"",u=n.metadata?.pinned?"Yes":"No";return[n.type,ut(String(n.value||"")),ut(n.metadata?.title||""),ut(n.metadata?.url||""),n.ts.toString(),o.toLocaleDateString(),o.toLocaleTimeString(),ut(i),u]});return[s.join(","),...a.map(n=>n.join(","))].join(`
`)}function ut(t){return t?t.includes(",")||t.includes('"')||t.includes(`
`)?`"${t.replace(/"/g,'""')}"`:t:""}function hn(t,s,a="text/plain"){const r=new Blob([t],{type:a}),n=URL.createObjectURL(r),o=document.createElement("a");o.href=n,o.download=s,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>{URL.revokeObjectURL(n)},100)}function xn(t,s){let a=[...t];s.dateRange&&(s.dateRange.start&&(a=a.filter(p=>p.ts>=s.dateRange.start)),s.dateRange.end&&(a=a.filter(p=>p.ts<=s.dateRange.end))),s.filterByType&&s.filterByType.length>0&&(a=a.filter(p=>s.filterByType.includes(p.type))),s.filterByTags&&s.filterByTags.length>0&&(a=a.filter(p=>{const b=Array.isArray(p.metadata?.tags)?p.metadata.tags:[];return s.filterByTags.some(m=>b.includes(m))}));const r=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5),n=s.format==="json"?"json":"csv",o=`regen-memories-${r}.${n}`;let i,u;s.format==="json"?(i=pn(a),u="application/json"):(i=fn(a),u="text/csv"),hn(i,o,u)}function gn({open:t,onClose:s,events:a,availableTags:r}){const n=vt(),[o,i]=c.useState("json"),[u,p]=c.useState({}),[b,m]=c.useState([]),[y,x]=c.useState([]),[l,d]=c.useState(!1),h=["search","visit","mode_switch","bookmark","note","task","highlight","screenshot","agent"],w=c.useCallback(v=>{m(C=>C.includes(v)?C.filter(T=>T!==v):[...C,v])},[]),k=c.useCallback(v=>{x(C=>C.includes(v)?C.filter(T=>T!==v):[...C,v])},[]),O=c.useCallback(()=>{d(!0);try{const v={format:o,dateRange:u.start||u.end?{start:u.start?new Date(u.start).getTime():void 0,end:u.end?new Date(u.end).getTime():void 0}:void 0,filterByType:b.length>0?b:void 0,filterByTags:y.length>0?y:void 0};xn(a,v);const C=a.length;se("success",`Exported ${C} ${C===1?"memory":"memories"} to ${o.toUpperCase()}`),s()}catch(v){console.error("[ExportMemoriesDialog] Export failed:",v),se("error","Failed to export memories")}finally{d(!1)}},[o,u,b,y,a,s]),j=c.useCallback(()=>{l||s()},[l,s]);if(!t)return null;const S=a.length;return e.jsx(ee,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:v=>{v.target===v.currentTarget&&j()},onMouseDown:v=>{const C=v.target;C.closest("button")||C.closest('[role="button"]')||C.closest('[role="dialog"]')},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50","aria-hidden":"true"}),e.jsx(_.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"fixed inset-0 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"export-memories-title",children:e.jsxs("div",{className:"w-full max-w-2xl bg-[var(--surface-root)] border border-[var(--surface-border)] rounded-xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden",onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-[var(--surface-border)]",style:{padding:n.spacing(4)},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(gt,{size:20,className:"text-[var(--color-primary-400)]"}),e.jsx("h2",{id:"export-memories-title",className:"font-semibold text-[var(--text-primary)]",style:{fontSize:n.fontSize.lg},children:"Export Memories"})]}),e.jsx("button",{onClick:v=>{v.stopImmediatePropagation(),v.stopPropagation(),j()},onMouseDown:v=>{v.stopImmediatePropagation(),v.stopPropagation()},disabled:l,className:"rounded-lg p-1.5 text-[var(--text-muted)] hover:text-[var(--text-primary)] hover:bg-[var(--surface-hover)] transition-colors focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] disabled:opacity-50",style:{zIndex:10011,isolation:"isolate"},"aria-label":"Close dialog",children:e.jsx(oe,{size:18})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",style:{padding:n.spacing(4)},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-primary)] mb-3",style:{fontSize:n.fontSize.sm},children:"Export Format"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:v=>{v.stopImmediatePropagation(),v.stopPropagation(),i("json")},onMouseDown:v=>{v.stopImmediatePropagation(),v.stopPropagation()},className:`
                          flex-1 flex items-center gap-3 px-4 py-3 rounded-lg border transition-all
                          ${o==="json"?"bg-[var(--color-primary-600)] border-[var(--color-primary-500)] text-white":"bg-[var(--surface-elevated)] border-[var(--surface-border)] text-[var(--text-secondary)] hover:bg-[var(--surface-hover)]"}
                          focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1
                        `,style:{zIndex:10011,isolation:"isolate"},"aria-pressed":o==="json",children:[e.jsx(za,{size:20}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"JSON"}),e.jsx("div",{className:"text-xs opacity-80",children:"Structured data format"})]})]}),e.jsxs("button",{onClick:v=>{v.stopImmediatePropagation(),v.stopPropagation(),i("csv")},onMouseDown:v=>{v.stopImmediatePropagation(),v.stopPropagation()},className:`
                          flex-1 flex items-center gap-3 px-4 py-3 rounded-lg border transition-all
                          ${o==="csv"?"bg-[var(--color-primary-600)] border-[var(--color-primary-500)] text-white":"bg-[var(--surface-elevated)] border-[var(--surface-border)] text-[var(--text-secondary)] hover:bg-[var(--surface-hover)]"}
                          focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1
                        `,style:{zIndex:10011,isolation:"isolate"},"aria-pressed":o==="csv",children:[e.jsx(Da,{size:20}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:"CSV"}),e.jsx("div",{className:"text-xs opacity-80",children:"Spreadsheet format"})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-[var(--text-primary)] mb-3",style:{fontSize:n.fontSize.sm},children:[e.jsx(La,{size:16,className:"inline mr-2"}),"Date Range (Optional)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"export-start-date",className:"block text-xs text-[var(--text-muted)] mb-1.5",style:{fontSize:n.fontSize.xs},children:"Start Date"}),e.jsx(Oe,{id:"export-start-date",type:"date",value:u.start||"",onChange:v=>p(C=>({...C,start:v.target.value})),disabled:l})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"export-end-date",className:"block text-xs text-[var(--text-muted)] mb-1.5",style:{fontSize:n.fontSize.xs},children:"End Date"}),e.jsx(Oe,{id:"export-end-date",type:"date",value:u.end||"",onChange:v=>p(C=>({...C,end:v.target.value})),disabled:l})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-[var(--text-primary)] mb-3",style:{fontSize:n.fontSize.sm},children:[e.jsx(Gs,{size:16,className:"inline mr-2"}),"Filter by Type (Optional)"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[h.map(v=>e.jsx("button",{onClick:C=>{C.stopImmediatePropagation(),C.stopPropagation(),w(v)},onMouseDown:C=>{C.stopImmediatePropagation(),C.stopPropagation()},className:`
                            px-3 py-1.5 rounded-full text-sm font-medium transition-colors
                            ${b.includes(v)?"bg-[var(--color-primary-600)] text-white":"bg-[var(--surface-elevated)] text-[var(--text-secondary)] hover:bg-[var(--surface-hover)]"}
                            focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1
                          `,style:{fontSize:n.fontSize.sm,zIndex:10011,isolation:"isolate"},"aria-pressed":b.includes(v),children:v.replace("_"," ")},v)),b.length>0&&e.jsx("button",{onClick:v=>{v.stopImmediatePropagation(),v.stopPropagation(),m([])},onMouseDown:v=>{v.stopImmediatePropagation(),v.stopPropagation()},className:"px-3 py-1.5 rounded-full text-sm text-[var(--text-muted)] hover:text-[var(--text-primary)] hover:bg-[var(--surface-hover)] transition-colors",style:{fontSize:n.fontSize.sm,zIndex:10011,isolation:"isolate"},children:"Clear"})]})]}),r.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-[var(--text-primary)] mb-3",style:{fontSize:n.fontSize.sm},children:[e.jsx(Vt,{size:16,className:"inline mr-2"}),"Filter by Tags (Optional)"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.slice(0,10).map(v=>e.jsxs("button",{onClick:C=>{C.stopImmediatePropagation(),C.stopPropagation(),k(v)},onMouseDown:C=>{C.stopImmediatePropagation(),C.stopPropagation()},className:`
                              px-3 py-1.5 rounded-full text-sm font-medium transition-colors
                              ${y.includes(v)?"bg-[var(--color-primary-600)] text-white":"bg-[var(--surface-elevated)] text-[var(--text-secondary)] hover:bg-[var(--surface-hover)]"}
                              focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1
                            `,style:{fontSize:n.fontSize.sm,zIndex:10011,isolation:"isolate"},"aria-pressed":y.includes(v),children:["#",v]},v)),y.length>0&&e.jsx("button",{onClick:v=>{v.stopImmediatePropagation(),v.stopPropagation(),x([])},onMouseDown:v=>{v.stopImmediatePropagation(),v.stopPropagation()},className:"px-3 py-1.5 rounded-full text-sm text-[var(--text-muted)] hover:text-[var(--text-primary)] hover:bg-[var(--surface-hover)] transition-colors",style:{fontSize:n.fontSize.sm,zIndex:10011,isolation:"isolate"},children:"Clear"})]})]}),e.jsxs("div",{className:"rounded-lg border border-[var(--surface-border)] bg-[var(--surface-elevated)]",style:{padding:n.spacing(3)},children:[e.jsx("div",{className:"text-sm text-[var(--text-primary)] font-medium mb-1",children:"Export Summary"}),e.jsxs("div",{className:"text-xs text-[var(--text-muted)] space-y-1",children:[e.jsxs("div",{children:["Format: ",o.toUpperCase()]}),e.jsxs("div",{children:["Memories: ",S]}),u.start&&e.jsxs("div",{children:["From: ",new Date(u.start).toLocaleDateString()]}),u.end&&e.jsxs("div",{children:["To: ",new Date(u.end).toLocaleDateString()]}),b.length>0&&e.jsxs("div",{children:["Types: ",b.length," selected"]}),y.length>0&&e.jsxs("div",{children:["Tags: ",y.length," selected"]})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-[var(--surface-border)]",style:{padding:n.spacing(4)},children:[e.jsx(je,{type:"button",tone:"secondary",onClick:v=>{v.stopImmediatePropagation(),v.stopPropagation(),j()},onMouseDown:v=>{v.stopImmediatePropagation(),v.stopPropagation()},disabled:l,style:{zIndex:10011,isolation:"isolate"},children:"Cancel"}),e.jsxs(je,{type:"button",tone:"primary",icon:e.jsx(gt,{size:16}),onClick:v=>{v.stopImmediatePropagation(),v.stopPropagation(),O()},onMouseDown:v=>{v.stopImmediatePropagation(),v.stopPropagation()},disabled:l,loading:l,style:{zIndex:10011,isolation:"isolate"},children:["Export ",o.toUpperCase()]})]})]})})]})})}function bn({memory:t,compact:s,onPin:a,onCopy:r,onOpen:n,onDelete:o}){const i=vt(),u=t.metadata?.pinned??!1,p=t.type.split("_").map(d=>d.charAt(0).toUpperCase()+d.slice(1)).join(" "),b=t.type.charAt(0).toUpperCase(),m=new Date(t.ts).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),y=new Date(t.ts).toLocaleDateString([],{month:"short",day:"numeric"}),x=c.useCallback(()=>{const d=t.metadata?.title||t.value||"";navigator.clipboard.writeText(d).then(()=>{se("success","Copied to clipboard"),r(t)}).catch(()=>{se("error","Failed to copy")})},[t,r]),l=c.useCallback(()=>{t.metadata?.url&&window.open(t.metadata.url,"_blank"),n(t)},[t,n]);return e.jsx(_.li,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.15},className:"group relative",children:e.jsx("div",{className:`rounded-lg border transition-all duration-200 ${u?"border-[var(--color-primary-500)]/40 bg-[var(--surface-elevated)] shadow-md":"hover:border-[var(--color-primary-500)]/30 border-[var(--surface-border)] bg-[var(--surface-panel)]"} hover:shadow-md`,style:{padding:i.spacing(3)},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex flex-shrink-0 flex-col items-center",style:{width:i.spacing(10)},children:[e.jsx("div",{className:`flex items-center justify-center rounded-full text-xs font-semibold ${u?"bg-[var(--color-primary-500)]/20 text-[var(--color-primary-400)]":"bg-[var(--surface-elevated)] text-[var(--text-muted)]"} `,style:{width:i.spacing(8),height:i.spacing(8)},"aria-label":`Type: ${p}`,children:b}),!s&&e.jsx("div",{className:"mt-1 text-xs text-[var(--text-muted)]",style:{fontSize:i.fontSize.xs},children:y})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"mb-1 flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium uppercase tracking-wide text-[var(--text-muted)]",style:{fontSize:i.fontSize.xs},children:p}),u&&e.jsx(us,{size:12,className:"flex-shrink-0 text-[var(--color-primary-400)]","aria-label":"Pinned"})]}),e.jsx("div",{className:"flex-shrink-0 text-xs text-[var(--text-muted)]",style:{fontSize:i.fontSize.xs},children:m})]}),e.jsx("h4",{className:"mb-1 line-clamp-2 font-semibold text-[var(--text-primary)]",style:{fontSize:i.fontSize.sm},children:t.metadata?.title||t.value}),!s&&t.metadata?.url&&e.jsx("div",{className:"mb-2 truncate text-xs text-[var(--text-muted)]",style:{fontSize:i.fontSize.xs},children:t.metadata.url}),!s&&t.value&&t.value!==t.metadata?.title&&e.jsx("p",{className:"mb-2 line-clamp-2 text-sm text-[var(--text-secondary)]",style:{fontSize:i.fontSize.sm},children:t.value}),t.metadata?.tags&&t.metadata.tags.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1.5",children:t.metadata.tags.map(d=>e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-[var(--surface-elevated)] px-2 py-0.5 text-xs text-[var(--color-primary-300)]",style:{fontSize:i.fontSize.xs},children:[e.jsx(Vt,{size:10}),d.startsWith("#")?d:`#${d}`]},d))})]}),e.jsxs("div",{className:"ml-2 flex flex-col gap-1 opacity-0 transition-opacity focus-within:opacity-100 group-hover:opacity-100",role:"group","aria-label":"Memory actions",children:[e.jsx("button",{onClick:()=>a(t.id,!u),className:`rounded-md p-1.5 transition-colors ${u?"bg-[var(--color-primary-500)]/10 text-[var(--color-primary-400)]":"text-[var(--text-muted)] hover:bg-[var(--surface-hover)] hover:text-[var(--color-primary-400)]"} focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1`,"aria-label":u?"Unpin memory":"Pin memory",title:u?"Unpin":"Pin",children:u?e.jsx(us,{size:14}):e.jsx(Fa,{size:14})}),t.metadata?.url&&e.jsx("button",{onClick:l,className:"rounded-md p-1.5 text-[var(--text-muted)] transition-colors hover:bg-[var(--surface-hover)] hover:text-[var(--color-primary-400)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1","aria-label":"Open in new tab",title:"Open",children:e.jsx(ht,{size:14})}),e.jsx("button",{onClick:x,className:"rounded-md p-1.5 text-[var(--text-muted)] transition-colors hover:bg-[var(--surface-hover)] hover:text-[var(--color-primary-400)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1","aria-label":"Copy to clipboard",title:"Copy",children:e.jsx(Js,{size:14})}),o&&e.jsx("button",{onClick:()=>o(t.id),className:"rounded-md p-1.5 text-[var(--text-muted)] transition-colors hover:bg-red-500/10 hover:text-red-400 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-1","aria-label":"Delete memory",title:"Delete",children:e.jsx(oe,{size:14})})]})]})})})}function yn({open:t,onClose:s,onCreateMemory:a}){const r=vt(),[n,o]=c.useState(""),[i,u]=c.useState("all"),[p,b]=c.useState("expanded"),[m,y]=c.useState("newest"),[x,l]=c.useState([]),[d,h]=c.useState(!1),[w,k]=c.useState([]),[O,j]=c.useState([]),[S,v]=c.useState([]),[C,T]=c.useState(null),[U,H]=c.useState(!1),[Y,q]=c.useState(!1),ae=c.useRef(null),re=c.useRef(null),F=br(n,300);c.useEffect(()=>{if(!t)return;const M=z=>{if(z.key==="/"&&!(z.target instanceof HTMLInputElement)){z.preventDefault(),ae.current?.focus();return}if((z.key==="n"||z.key==="N")&&(z.metaKey||z.ctrlKey)){z.preventDefault(),H(!0);return}if(z.key==="j"&&!(z.target instanceof HTMLInputElement)){z.preventDefault(),T(B=>{const X=B===null?0:Math.min(B+1,x.length-1);return re.current&&re.current.children[X]?.scrollIntoView({behavior:"smooth",block:"nearest"}),X});return}if(z.key==="k"&&!(z.target instanceof HTMLInputElement)){z.preventDefault(),T(B=>{const X=B===null?x.length-1:Math.max(B-1,0);return re.current&&re.current.children[X]?.scrollIntoView({behavior:"smooth",block:"nearest"}),X});return}if(z.key==="Escape"&&!(z.target instanceof HTMLInputElement)){s();return}};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[t,x.length,a,s]);const N=c.useCallback(async()=>{h(!0);try{const M=await jr.getEvents({limit:500});l(M)}catch(M){console.error("[ResearchMemoryPanel] Failed to load events:",M),se("error","Failed to load memories")}finally{h(!1)}},[]);c.useEffect(()=>{t&&N()},[t,N]);const R=c.useCallback(()=>{N()},[N]);c.useEffect(()=>{if(!t)return;(async()=>{try{const z=await It.getAllTags();v(z)}catch(z){console.error("[ResearchMemoryPanel] Failed to load tags:",z)}})()},[t]),c.useEffect(()=>{if(!F||F.length<3){k([]);return}(async()=>{try{const z=await Sr(F,{limit:50,minSimilarity:.5});k(z)}catch(z){console.error("[ResearchMemoryPanel] Semantic search failed:",z),k([])}})()},[F]);const W=c.useMemo(()=>{let M=x;if(i==="research"?M=M.filter(z=>z.metadata?.tags?.some(B=>B.includes("research")||B.includes("#research"))):i==="trade"&&(M=M.filter(z=>z.metadata?.tags?.some(B=>B.includes("trade")||B.includes("#trade")))),O.length>0&&(M=M.filter(z=>O.some(B=>z.metadata?.tags?.includes(B)))),F)if(w.length>0){const z=new Set(w.map(B=>B.event.id));M=M.filter(B=>z.has(B.id))}else{const z=F.toLowerCase();M=M.filter(B=>B.value.toLowerCase().includes(z)||B.metadata?.title?.toLowerCase().includes(z)||B.metadata?.tags?.some(X=>X.toLowerCase().includes(z)))}return M=[...M].sort((z,B)=>{if(m==="newest")return B.ts-z.ts;if(m==="oldest")return z.ts-B.ts;if(m==="relevance"&&w.length>0){const X=w.find(ve=>ve.event.id===z.id),Ne=w.find(ve=>ve.event.id===B.id);if(X&&Ne)return Ne.similarity-X.similarity;if(X)return-1;if(Ne)return 1}return B.ts-z.ts}),M},[x,i,O,F,w,m]),be=async(M,z)=>{try{await It.updateEventMetadata(M,{pinned:z}),l(B=>B.map(X=>X.id===M?{...X,metadata:{...X.metadata,pinned:z}}:X)),se("success",z?"Memory pinned":"Memory unpinned")}catch(B){console.error("[ResearchMemoryPanel] Failed to toggle pin:",B),se("error","Failed to update memory")}},lt=c.useCallback(M=>{},[]),wt=c.useCallback(async M=>{if(M.metadata?.url)try{await E.tabs.create({url:M.metadata.url}),se("success","Opened in new tab")}catch(z){console.error("[ResearchMemoryPanel] Failed to open tab:",z),se("error","Failed to open in new tab")}},[]),Je=async M=>{try{await It.deleteEvent(M),l(z=>z.filter(B=>B.id!==M)),se("success","Memory deleted")}catch(z){console.error("[ResearchMemoryPanel] Failed to delete event:",z),se("error","Failed to delete memory")}},ye=M=>{j(z=>z.includes(M)?z.filter(B=>B!==M):[...z,M])};return t?e.jsx(ee,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:s,className:"fixed inset-0 z-40 bg-black/50 backdrop-blur-sm","aria-hidden":"true"}),e.jsxs(_.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"fixed bottom-0 right-0 top-0 z-50 flex w-0 max-w-[90vw] flex-col overflow-hidden border-l border-[var(--surface-border)] bg-[var(--surface-root)] shadow-2xl backdrop-blur-xl sm:max-w-full md:w-[420px] md:overflow-visible",role:"dialog","aria-modal":"true","aria-label":"Research Memory Panel",onClick:M=>M.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-[var(--surface-border)]",style:{padding:r.spacing(4)},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{size:20,className:"text-[var(--color-primary-400)]"}),e.jsx("h2",{className:"font-semibold text-[var(--text-primary)]",style:{fontSize:r.fontSize.lg},children:"SuperMemory"})]}),e.jsx("button",{onClick:s,className:"rounded-lg p-1.5 text-[var(--text-muted)] transition-colors hover:bg-[var(--surface-hover)] hover:text-[var(--text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)]","aria-label":"Close panel",children:e.jsx(oe,{size:18})})]}),e.jsx("div",{style:{padding:r.spacing(4),paddingBottom:r.spacing(3)},children:e.jsxs("div",{className:"relative",children:[e.jsx(fe,{size:16,className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-[var(--text-muted)]"}),e.jsx("input",{ref:ae,type:"text",placeholder:"Search memories... (Press / to focus)",value:n,onChange:M=>o(M.target.value),className:"w-full rounded-lg border border-[var(--surface-border)] bg-[var(--surface-panel)] py-2 pl-10 pr-4 text-[var(--text-primary)] transition-all placeholder:text-[var(--text-muted)] focus:border-transparent focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)]",style:{fontSize:r.fontSize.sm},"aria-label":"Search memories"})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 border-b border-[var(--surface-border)]",style:{padding:r.spacing(4),paddingTop:r.spacing(2),paddingBottom:r.spacing(3)},children:[["all","research","trade"].map(M=>e.jsx("button",{onClick:()=>u(M),className:`rounded-full px-3 py-1.5 text-sm font-medium transition-colors ${i===M?"bg-[var(--color-primary-600)] text-white":"bg-[var(--surface-elevated)] text-[var(--text-secondary)] hover:bg-[var(--surface-hover)]"} focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1`,style:{fontSize:r.fontSize.sm},"aria-pressed":i===M,children:M.charAt(0).toUpperCase()+M.slice(1)},M)),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsx("button",{onClick:()=>b(p==="compact"?"expanded":"compact"),className:"rounded-md p-1.5 text-[var(--text-muted)] transition-colors hover:bg-[var(--surface-hover)] hover:text-[var(--text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)]","aria-label":`Switch to ${p==="compact"?"expanded":"compact"} view`,title:p==="compact"?"Expanded view":"Compact view",children:p==="compact"?e.jsx(Oa,{size:16}):e.jsx($a,{size:16})}),e.jsxs("div",{className:"text-sm text-[var(--text-muted)]",style:{fontSize:r.fontSize.sm},children:[W.length," ",W.length===1?"item":"items"]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 border-b border-[var(--surface-border)]",style:{padding:r.spacing(3),paddingTop:r.spacing(2),paddingBottom:r.spacing(2)},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Gs,{size:14,className:"text-[var(--text-muted)]"}),e.jsx("span",{className:"text-xs text-[var(--text-muted)]",style:{fontSize:r.fontSize.xs},children:"Sort:"}),e.jsxs("select",{value:m,onChange:M=>y(M.target.value),className:"rounded-md border border-[var(--surface-border)] bg-[var(--surface-elevated)] px-2 py-1 text-xs text-[var(--text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)]",style:{fontSize:r.fontSize.xs},"aria-label":"Sort mode",children:[e.jsx("option",{value:"newest",children:"Newest"}),e.jsx("option",{value:"oldest",children:"Oldest"}),e.jsx("option",{value:"relevance",children:"Relevance"})]})]}),S.slice(0,5).map(M=>e.jsxs("button",{onClick:()=>ye(M),className:`rounded-full px-2 py-1 text-xs font-medium transition-colors ${O.includes(M)?"bg-[var(--color-primary-600)] text-white":"bg-[var(--surface-elevated)] text-[var(--text-secondary)] hover:bg-[var(--surface-hover)]"} focus:outline-none focus:ring-2 focus:ring-[var(--color-primary-500)] focus:ring-offset-1`,style:{fontSize:r.fontSize.xs},"aria-pressed":O.includes(M),children:["#",M]},M)),O.length>0&&e.jsx("button",{onClick:()=>j([]),className:"rounded-full px-2 py-1 text-xs text-[var(--text-muted)] transition-colors hover:bg-[var(--surface-hover)] hover:text-[var(--text-primary)]",style:{fontSize:r.fontSize.xs},children:"Clear"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto","aria-busy":d,children:d?e.jsx("div",{style:{padding:r.spacing(4)},children:e.jsx(on,{items:5})}):W.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-2xl border border-[var(--surface-border)] bg-gradient-to-br from-[#281b5f] via-[#152038] to-[#0f172a] text-center text-white shadow-inner shadow-black/30",style:{padding:r.spacing(8),minHeight:"300px"},children:[e.jsx(ge,{size:48,className:"mb-4 text-purple-200"}),e.jsx("p",{className:"mb-2 text-2xl font-semibold",children:"Welcome to Research Mode"}),e.jsx("p",{className:"mb-4 max-w-md text-sm text-purple-100/80",children:"Ask Regen in Hindi, Tamil, Bengali, or English. Your best answers and agent handoffs land here automatically."}),e.jsxs("button",{type:"button",onClick:()=>window.dispatchEvent(new CustomEvent("research:quickstart",{detail:{query:"Compare Nifty vs BankNifty for intraday"}})),className:"inline-flex items-center gap-2 rounded-full bg-white/90 px-5 py-2 text-sm font-semibold text-[#0f172a] transition hover:bg-white",children:["Try “Compare Nifty vs BankNifty”",e.jsx(Ys,{size:16})]})]}):e.jsx("ul",{ref:re,className:"flex flex-col gap-3",style:{padding:r.spacing(4)},role:"list",children:e.jsx(ee,{mode:"popLayout",children:W.map(M=>e.jsx(bn,{memory:M,compact:p==="compact",onPin:be,onCopy:lt,onOpen:wt,onDelete:Je},M.id))})})}),e.jsxs("div",{className:"flex items-center gap-2 border-t border-[var(--surface-border)]",style:{padding:r.spacing(4)},children:[e.jsx(je,{tone:"primary",size:"sm",icon:e.jsx(Kt,{size:16}),onClick:()=>H(!0),fullWidth:!0,className:"flex-1",children:"Create Memory"}),e.jsx(je,{tone:"secondary",size:"sm",onClick:()=>q(!0),children:"Export"})]})]}),e.jsx(mn,{open:U,onClose:()=>H(!1),onCreated:R}),e.jsx(gn,{open:Y,onClose:()=>q(!1),events:x,availableTags:S})]})}):null}const ys=100,vn=10080*60*1e3,ze=De(t=>({suspensions:{},lastEvent:void 0,setSuspended:s=>t(a=>{let r={...a.suspensions,[s.tabId]:{...a.suspensions[s.tabId]??{},...s,acknowledged:!1}};const n=Object.entries(r);if(n.length>ys){const i=n.sort((u,p)=>(u[1].suspendedAt||0)-(p[1].suspendedAt||0)).slice(-ys);r=Object.fromEntries(i)}return{suspensions:r,lastEvent:{tabId:s.tabId,type:"suspended",timestamp:Date.now(),reason:s.reason}}}),acknowledge:s=>t(a=>{const r=a.suspensions[s];return r?{suspensions:{...a.suspensions,[s]:{...r,acknowledged:!0}}}:a}),resolve:(s,a)=>t(r=>{if(!r.suspensions[s])return r;const n={...r.suspensions};return delete n[s],{suspensions:n,lastEvent:a?.silent?r.lastEvent:{tabId:s,type:"restored",timestamp:Date.now()}}}),cleanup:()=>t(s=>{const a=Date.now(),r={};return Object.entries(s.suspensions).forEach(([n,o])=>{a-(o.suspendedAt||0)<vn&&(r[n]=o)}),{suspensions:r}})}));var wn=Object.defineProperty,jn=(t,s,a)=>s in t?wn(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,tt=(t,s,a)=>jn(t,typeof s!="symbol"?s+"":s,a);const vs={tabCapMB:512,maxTotalMB:4096,rebalanceIntervalMs:3e4,reserveForActiveTabsMB:1024};class Sn{constructor(){tt(this,"options",{...vs}),tt(this,"samples",[]),tt(this,"pool",new Map),tt(this,"metricsTimer",null),tt(this,"rebalanceTimer",null)}start(s){this.options={...vs,...s??{}},this.pollUsage(),this.rebalance(),this.metricsTimer&&clearInterval(this.metricsTimer),this.rebalanceTimer&&clearInterval(this.rebalanceTimer),this.metricsTimer=setInterval(()=>this.pollUsage(),2e4),this.rebalanceTimer=setInterval(()=>this.rebalance(),this.options.rebalanceIntervalMs)}stop(){this.metricsTimer&&clearInterval(this.metricsTimer),this.rebalanceTimer&&clearInterval(this.rebalanceTimer),this.metricsTimer=null,this.rebalanceTimer=null}update(s){this.start({...this.options,...s})}async pollUsage(){if(E?.tabs?.getAllMetrics)try{const s=await E.tabs.getAllMetrics(),a=Date.now();Object.entries(s||{}).forEach(([r,n])=>{typeof n?.memoryMB=="number"&&(this.samples.push({tabId:r,memoryMB:n.memoryMB,timestamp:a}),this.samples.length>2e3&&this.samples.splice(0,this.samples.length-2e3))}),ue({type:"redix:memory:sample",payload:{totalTabs:Object.keys(s??{}).length,timestamp:a}})}catch(s){console.warn("[MemoryPool] Failed to poll usage",s)}}async rebalance(){if(!(!Se()&&!Re()||!E?.tabs?.list))try{const a=await E.tabs.list(),r=Date.now(),n=new Map;this.samples.forEach(x=>{(!n.has(x.tabId)||x.timestamp>r-6e4)&&n.set(x.tabId,x.memoryMB)});const o=a.filter(x=>x.active),i=a.filter(x=>!x.active),u=this.options.maxTotalMB,p=Math.min(u*.5,Math.max(this.options.reserveForActiveTabsMB,o.length*(this.options.tabCapMB/2))),b=o.length?Math.max(this.options.tabCapMB,p/o.length):0,m=i.length?Math.max(256,(u-p)/i.length):this.options.tabCapMB,y=[];for(const x of o)y.push(this.setCap(x.id,Math.round(b)));for(const x of i){const l=n.get(x.id)??0,d=Math.max(256,Math.min(m,l+128));y.push(this.setCap(x.id,Math.round(d)))}await Promise.allSettled(y),ue({type:"redix:memory:pool:update",payload:{timestamp:r,activeTabs:o.length,backgroundTabs:i.length,caps:Array.from(this.pool.values())}})}catch(a){console.warn("[MemoryPool] Failed to rebalance",a)}}async setCap(s,a){const r=this.pool.get(s);if(r&&Math.abs(r.capMB-a)<32)return r;try{await E.tabs.setMemoryCap(s,a);const n={tabId:s,capMB:a,lastUpdated:Date.now()};return this.pool.set(s,n),n}catch(n){return console.warn("[MemoryPool] Failed to set cap",{tabId:s,capMB:a},n),r}}}const Bt=new Sn;function Nn(){Bt.start(),window.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&Bt.start()})}function kn(t){Bt.update(t)}const oa={suspendBackgroundTabs:!0,suspendAfterMinutes:12,throttleHeavyTabs:!0,memoryThreshold:70,cpuThreshold:80,batteryThreshold:20,prefetchEnabled:!0,prefetchOnWifiOnly:!0};let $e={...oa},Ge=new Set,Ut=new Set;async function Jt(){try{if(typeof window<"u"&&window.localStorage){const t=localStorage.getItem("redix:policy");t&&($e={...oa,...JSON.parse(t)})}}catch(t){console.warn("[Redix] Failed to load policy:",t)}return $e}function ia(t){$e={...$e,...t};try{typeof window<"u"&&window.localStorage&&(localStorage.setItem("redix:policy",JSON.stringify($e)),ue({type:"redix:policy:update",payload:$e}))}catch(s){console.error("[Redix] Failed to save policy:",s)}}function Qt(){return{...$e}}async function la(t){if(!Ge.has(t))try{Ge.add(t),ue({type:"redix:tab:suspend",payload:{tabId:t}});try{typeof E<"u"&&E?.tabs?.wake&&await E.tabs.wake(t)}catch{}}catch(s){console.error("[Redix] Failed to suspend tab:",s),Ge.delete(t)}}async function Tn(t){if(Ge.has(t))try{Ge.delete(t),ue({type:"redix:tab:thaw",payload:{tabId:t}});try{typeof E<"u"&&E?.tabs?.wake&&await E.tabs.wake(t)}catch{}}catch(s){console.error("[Redix] Failed to thaw tab:",s)}}function En(t,s){s?(Ut.add(t),ue({type:"redix:tab:heavy",payload:{tabId:t}})):(Ut.delete(t),ue({type:"redix:tab:light",payload:{tabId:t}}))}function In(t){return Ge.has(t)}function Cn(t){return Ut.has(t)}async function Wt(t){const s=Qt();if(s.suspendBackgroundTabs)try{if(!Se()&&!Re()||typeof E>"u"||!E?.tabs?.list)return;const r=await E.tabs.list();if(!Array.isArray(r)||r.length===0)return;const o=r.find(i=>i.active)?.id;for(const i of r){if(i.id===o||i.url?.startsWith("about:")||i.url?.startsWith("chrome:"))continue;const u=i.lastActiveAt||i.createdAt||0;(Date.now()-u)/(1e3*60)>s.suspendAfterMinutes&&await la(i.id)}}catch(a){console.warn("[Redix] Failed to optimize tabs:",a)}t?.memoryUsage&&t.memoryUsage>s.memoryThreshold&&ue({type:"redix:performance:low",payload:{reason:"memory",usage:t.memoryUsage}}),t?.cpuUsage&&t.cpuUsage>s.cpuThreshold&&ue({type:"redix:performance:low",payload:{reason:"cpu",usage:t.cpuUsage}}),t?.batteryLevel&&t.batteryLevel<s.batteryThreshold&&(ue({type:"redix:performance:low",payload:{reason:"battery",level:t.batteryLevel}}),s.prefetchEnabled&&ia({prefetchEnabled:!1}))}async function Mn(){await Jt(),Nn(),Bs.watch(t=>{t.type==="redix:performance:low"&&Wt()}),setInterval(()=>{Wt()},3e4)}const Pn=Object.freeze(Object.defineProperty({__proto__:null,getPolicy:Qt,initializeOptimizer:Mn,isTabHeavy:Cn,isTabSuspended:In,loadPolicy:Jt,markTabHeavy:En,optimizePerformance:Wt,savePolicy:ia,suspendTab:la,thawTab:Tn},Symbol.toStringTag,{value:"Module"})),An=5,_n=60*1e3,Rn=640;let ws=!1,_t=null,Ue=[];const rt=new Set;function js(){const t=new Set(K.getState().tabs.map(a=>a.id));Ue=Ue.filter(a=>t.has(a.id)),rt.forEach(a=>{t.has(a)||rt.delete(a)});const s=ze.getState();Object.keys(s.suspensions).forEach(a=>{t.has(a)||s.resolve(a,{silent:!0})})}function zn(){if(ws||typeof window>"u"||!Se())return;ws=!0;let t=An*60*1e3;Jt().then(o=>{o?.suspendAfterMinutes&&(t=Math.max(1,o.suspendAfterMinutes)*60*1e3)}).catch(()=>{const o=Qt?.();o?.suspendAfterMinutes&&(t=Math.max(1,o.suspendAfterMinutes)*60*1e3)});const s=o=>{Array.isArray(o)&&(Ue=o,js(),Ns())},a=Le.on("tabs:updated",s),r=K.subscribe(o=>o.activeId,(o,i)=>{if(!o||o===i)return;K.getState().tabs.find(p=>p.id===o)?.sleeping?Xt(o,{activate:!1}):ze.getState().resolve(o,{silent:!0})}),n=K.subscribe(o=>o.tabs,()=>{Ns()});_t=setInterval(()=>{js(),Ss(t).catch(()=>{})},_n),Ss(t).catch(()=>{}),window.addEventListener("beforeunload",()=>{a(),r(),n(),_t&&clearInterval(_t)},{once:!0})}async function Ss(t){if(!E?.tabs?.list)return;let s=Ue;if(!s.length){const r=await E.tabs.list().catch(()=>[]);Array.isArray(r)&&(s=r,Ue=s)}if(!s.length)return;const a=Date.now();for(const r of s)Dn(r,a,t)&&await ca(r,"inactivity")}function Dn(t,s,a){if(!t||!t.id||t.active||t.sleeping||t.pinned||!t.url||t.url.startsWith("about:")||t.url.startsWith("chrome:")||t.url.startsWith("edge:"))return!1;const r=t.lastActiveAt??t.createdAt??0;return r?s-r>=a:!1}async function ca(t,s){if(!(!E?.tabs?.hibernate||rt.has(t.id))){rt.add(t.id);try{let a=null;if(E.tabs.capturePreview)try{const r=await E.tabs.capturePreview({id:t.id,maxWidth:Rn,quality:.65});r?.success&&r.dataUrl&&(a=r.dataUrl)}catch{}await E.tabs.hibernate({id:t.id}),ze.getState().setSuspended({tabId:t.id,title:t.title,url:t.url,snapshot:a,suspendedAt:Date.now(),lastActiveAt:t.lastActiveAt,reason:s}),ue({type:"redix:tab:suspended",payload:{tabId:t.id,reason:s}})}catch(a){console.warn("[Redix] Failed to suspend tab",t?.id,a)}finally{rt.delete(t.id)}}}function Ns(){const t=ze.getState(),s=new Map(Ue.map(r=>[r.id,r])),a=new Set(K.getState().tabs.map(r=>r.id));t.cleanup(),Object.keys(t.suspensions).forEach(r=>{if(!a.has(r)){t.resolve(r,{silent:!0});return}const n=s.get(r);(!n||!n.sleeping)&&t.resolve(r,{silent:!0})})}async function Xt(t,s){if(!E?.tabs?.wake){ze.getState().resolve(t,{silent:!0});return}try{await E.tabs.wake({id:t}),ze.getState().resolve(t),ue({type:"redix:tab:resumed",payload:{tabId:t}}),s?.activate&&await E.tabs.activate({id:t}).catch(()=>{})}catch(a){console.warn("[Redix] Failed to resume tab",t,a)}}function da(t){ze.getState().acknowledge(t)}async function Ln(t){const s=Ue.find(a=>a.id===t);s&&await ca(s,"manual")}const On=Object.freeze(Object.defineProperty({__proto__:null,acknowledgeSuspendedTab:da,manuallySuspendTab:Ln,resumeSuspendedTab:Xt,startTabSuspensionService:zn},Symbol.toStringTag,{value:"Module"}));function $n(){const t=ze(r=>r.suspensions),s=c.useMemo(()=>Object.values(t).filter(r=>!r.acknowledged),[t]);if(!s.length)return null;const a=[...s].sort((r,n)=>(n.suspendedAt||0)-(r.suspendedAt||0)).slice(0,3);return e.jsxs("div",{className:"fixed bottom-6 left-6 z-[120] flex flex-col gap-3",children:[a.map(r=>e.jsxs("article",{className:"flex w-[320px] items-center gap-3 rounded-2xl border border-purple-500/30 bg-slate-950/90 px-3 py-3 shadow-xl shadow-black/40 backdrop-blur",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-xl border border-white/10 bg-slate-900/80",children:[r.snapshot?e.jsx("img",{src:r.snapshot,alt:r.title||r.url||"Sleeping tab",className:"h-16 w-16 object-cover"}):e.jsx("div",{className:"flex h-16 w-16 items-center justify-center text-purple-300",children:e.jsx(Ba,{size:20})}),e.jsx("span",{className:"absolute inset-0 bg-gradient-to-tr from-purple-600/30 to-transparent"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs uppercase tracking-[0.3em] text-purple-300",children:[e.jsx(Ua,{size:12}),e.jsx("span",{children:"Suspended"})]}),e.jsx("p",{className:"text-sm font-semibold text-white line-clamp-1",children:r.title||r.url||"Sleeping tab"}),e.jsxs("p",{className:"text-xs text-slate-400",children:[r.reason==="memory"?"Paused for memory health":"Suspended to save resources"," ","• ",Gt(r.suspendedAt??Date.now(),{addSuffix:!0})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>Xt(r.tabId,{activate:!0}),className:"inline-flex items-center gap-1 rounded-full bg-purple-500/90 px-3 py-1 text-xs font-semibold text-white shadow-sm shadow-purple-500/40 transition hover:brightness-110",children:[e.jsx(xt,{size:12}),"Resume"]}),e.jsx("button",{type:"button",onClick:()=>da(r.tabId),className:"rounded-full border border-white/15 px-3 py-1 text-xs text-slate-300 transition hover:border-white/40 hover:text-white",children:"Keep sleeping"})]})]})]},r.tabId)),s.length>a.length&&e.jsxs("div",{className:"rounded-full border border-white/15 bg-slate-950/70 px-3 py-1 text-xs text-slate-300 shadow-sm",children:["+",s.length-a.length," more tabs sleeping"]})]})}const ks={supported:typeof navigator<"u"&&"getBattery"in navigator,level:null,charging:null,chargingTime:null,dischargingTime:null,lastUpdated:Date.now()};function Rt(t,s){if(t!=="Auto")return t;const a=typeof s.level=="number"?s.level:null;return a!==null&&!s.charging&&a<=.25?"PowerSave":a!==null&&s.charging&&a>=.95?"Performance":"Balanced"}const Be=De()(sa(t=>({battery:ks,selectedMode:"Balanced",effectiveMode:"Balanced",setBattery:s=>t(a=>{const r={...a.battery,...s,supported:typeof s.supported=="boolean"?s.supported:a.battery.supported,lastUpdated:s&&"lastUpdated"in s?s.lastUpdated:Date.now()},n=Rt(a.selectedMode,r);return{battery:r,effectiveMode:n}}),setMode:s=>t(a=>{const r=Rt(s,a.battery);return{selectedMode:s,effectiveMode:r}})}),{name:"redix:power-store",partialize:t=>({selectedMode:t.selectedMode}),onRehydrateStorage:()=>t=>{t&&(t.effectiveMode=Rt(t.selectedMode,t.battery??ks))}})),Ts={Performance:{tabCapMB:768,maxTotalMB:6144,reserveForActiveTabsMB:2048},Balanced:{tabCapMB:512,maxTotalMB:4096,reserveForActiveTabsMB:1536},PowerSave:{tabCapMB:384,maxTotalMB:3072,reserveForActiveTabsMB:1024}};let Es=!1,Is=null;function Fn(){Es||(Es=!0,Cs(Be.getState().effectiveMode),Is=Be.subscribe(t=>t.effectiveMode,(t,s)=>{t!==s&&Cs(t)}),window.addEventListener("beforeunload",()=>{Is?.()},{once:!0}))}function Zt(t){Be.getState().setMode(t)}function Cs(t){const s=Ts[t]??Ts.Balanced;kn(s),ue({type:"redix:power:mode",payload:{effectiveMode:t,selectedMode:Be.getState().selectedMode}})}const Bn=Object.freeze(Object.defineProperty({__proto__:null,initPowerModes:Fn,setPowerMode:Zt},Symbol.toStringTag,{value:"Module"})),Un=[{id:"Performance",title:"Performance",description:"Full power, no throttling. Ideal when plugged in.",metrics:"Max tabs · High AI throughput"},{id:"Balanced",title:"Balanced",description:"Smart defaults for everyday browsing.",metrics:"Adaptive caps · Standard prefetch"},{id:"PowerSave",title:"Power-save",description:"Aggressive throttling to extend battery life.",metrics:"Lower tab caps · Prefetch paused"},{id:"Auto",title:"Auto",description:"Automatically chooses the best mode using battery signals.",metrics:"Smart switching"}];function Wn({selected:t,effective:s,onClose:a,onSelect:r}){return e.jsx(ee,{children:e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[160] flex items-center justify-center bg-black/60 backdrop-blur-sm px-4",children:e.jsxs(_.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},exit:{y:20,opacity:0},className:"w-full max-w-3xl rounded-[32px] border border-white/10 bg-slate-950/90 p-6 shadow-[0_35px_120px_rgba(0,0,0,0.55)]",children:[e.jsxs("header",{className:"mb-6 flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-slate-500",children:"Power modes"}),e.jsx("h2",{className:"text-2xl font-semibold text-white",children:"Optimize Redix for the moment"}),e.jsx("p",{className:"text-sm text-slate-400",children:t==="Auto"?`Auto is managing power. Currently running ${s}.`:`Active mode: ${t}. Switch whenever you need.`})]}),e.jsx("button",{type:"button",onClick:a,className:"rounded-full border border-white/20 px-4 py-2 text-xs font-semibold uppercase tracking-[0.3em] text-slate-300 hover:border-white/40",children:"Close"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:Un.map(n=>{const o=t===n.id,i=n.id!=="Auto"&&s===n.id;return e.jsxs("button",{type:"button",onClick:()=>{Zt(n.id),r(n.id)},className:`flex h-full flex-col items-start gap-2 rounded-3xl border px-4 py-4 text-left transition ${o?"border-purple-400/70 bg-purple-500/10 shadow-[0_0_25px_rgba(168,85,247,0.2)]":"border-white/10 bg-white/5 hover:border-white/30"}`,children:[e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold text-white",children:n.title}),e.jsx("p",{className:"text-xs text-slate-400",children:n.metrics})]}),o&&e.jsx("span",{className:"rounded-full bg-purple-500/20 px-3 py-1 text-xs font-semibold text-purple-200",children:"Active"})]}),e.jsx("p",{className:"text-sm text-slate-300",children:n.description}),n.id==="Auto"&&i&&e.jsxs("p",{className:"text-xs text-emerald-300",children:["Auto is currently running ",s]})]},n.id)})})]})})})}function qn(t){return typeof t!="number"?"—":`${Math.round(t*100)}%`}function Vn(){const t=Be(b=>b.battery),s=Be(b=>b.selectedMode),a=Be(b=>b.effectiveMode),[r,n]=c.useState(!1),o=c.useMemo(()=>t.charging?e.jsx(Wa,{size:18,className:"text-emerald-300"}):e.jsx(qa,{size:18,className:"text-slate-200"}),[t.charging]),i=qn(t.level),p=s==="Auto"?`Auto → ${a}`:a;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fixed bottom-6 right-6 z-[110] flex flex-col items-end gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>n(!0),className:"flex items-center gap-3 rounded-2xl border border-white/10 bg-slate-900/80 px-3 py-2 text-left text-sm text-white shadow-lg shadow-black/40 backdrop-blur transition hover:border-white/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[o,e.jsxs("div",{className:"flex flex-col leading-tight",children:[e.jsx("span",{className:"text-xs uppercase tracking-[0.35em] text-slate-400",children:"Battery"}),e.jsx("span",{className:"text-sm font-semibold text-white",children:i})]})]}),e.jsxs("div",{className:"flex flex-col text-right leading-tight",children:[e.jsx("span",{className:"text-xs uppercase tracking-[0.35em] text-slate-400",children:"Mode"}),e.jsx("span",{className:"text-sm font-semibold text-white",children:p})]}),e.jsx("div",{className:"rounded-full bg-purple-500/20 p-1.5 text-purple-200",children:e.jsx(Va,{size:14})})]}),!t.supported&&e.jsx("span",{className:"text-xs text-slate-400",children:"Battery telemetry unavailable"})]}),r&&e.jsx(Wn,{selected:s,effective:a,onClose:()=>n(!1),onSelect:b=>{Zt(b),n(!1)}})]})}const zt=De(t=>({history:[],latest:void 0,capacityMB:void 0,pushSnapshot:s=>t(a=>{const r=[...a.history,s].slice(-200);return{latest:s,history:r}}),setCapacity:s=>t(()=>({capacityMB:s}))})),Kn=t=>t>=.85?"text-red-400":t>=.7?"text-amber-300":"text-emerald-300";function Hn(){const t=zt(x=>x.latest),s=zt(x=>x.history),a=zt(x=>x.capacityMB),[r,n]=c.useState(!0),o=c.useMemo(()=>t?[...t.tabs].sort((x,l)=>l.memoryMB-x.memoryMB).slice(0,5):[],[t]),i=c.useMemo(()=>{if(!s.length)return[];const x=Math.max(...s.map(l=>l.totalMB||0),1);return s.slice(-40).map((l,d,h)=>({x:d/Math.max(1,h.length-1)*100,y:40-Math.min(l.totalMB||0,x)/x*40}))},[s]);if(!t)return null;const u=t.totalMB,p=a??Math.max(u*1.5,4096),b=Math.min(u/p,1),m=Math.round(b*100),y=Kn(b);return e.jsxs("div",{className:"rounded-3xl border border-slate-900/60 bg-slate-950/70 p-4 shadow-inner shadow-black/40",children:[e.jsxs("header",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-white",children:[e.jsx(Qs,{size:16,className:"text-purple-300"}),e.jsx("h3",{className:"text-sm font-semibold uppercase tracking-[0.3em]",children:"Memory Monitor"})]}),e.jsx("button",{type:"button",onClick:()=>n(x=>!x),className:"text-xs text-slate-400 underline-offset-2 hover:text-white",children:r?"Hide":"Show"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("div",{className:"text-xs text-slate-400",children:"Total usage"}),e.jsxs("div",{className:"text-xl font-semibold text-white",children:[u.toFixed(0)," MB"," ",e.jsxs("span",{className:"text-sm text-slate-500",children:["/ ",p.toFixed(0)," MB",t.freeMB?` (≈${t.freeMB.toFixed(0)} MB free)`:""]})]}),e.jsx("div",{className:"mt-2 h-3 overflow-hidden rounded-full bg-slate-800",children:e.jsx("div",{className:`h-full rounded-full ${b>=.85?"bg-red-500":b>=.7?"bg-amber-400":"bg-emerald-400"}`,style:{width:`${m}%`}})}),e.jsxs("p",{className:`mt-1 text-xs font-semibold ${y}`,children:[m,"% of budget used"]})]}),e.jsxs("div",{className:"flex min-w-[160px] flex-col gap-1 rounded-2xl border border-white/10 bg-white/5 px-3 py-2 text-xs text-slate-300",children:[e.jsx("span",{className:"text-slate-400",children:"Trend (last 30 samples)"}),e.jsx("svg",{width:"140",height:"40",viewBox:"0 0 100 40",preserveAspectRatio:"none",className:"text-purple-300",children:e.jsx("polyline",{fill:"none",stroke:"currentColor",strokeWidth:"2",points:i.map(x=>`${x.x},${x.y}`).join(" ")})})]})]}),r&&e.jsxs("div",{className:"mt-4 grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2 text-xs uppercase tracking-[0.2em] text-slate-400",children:[e.jsx(Ks,{size:14}),"Top tabs"]}),e.jsx("div",{className:"space-y-2",children:o.map(x=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl bg-black/20 px-3 py-2 text-sm text-slate-200",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate font-semibold text-white",children:x.title||x.url||"Untitled tab"}),e.jsx("p",{className:"text-xs text-slate-400",children:x.appMode||"Browse"})]}),e.jsxs("span",{className:"ml-3 font-semibold text-slate-100",children:[x.memoryMB.toFixed(0)," MB"]})]},x.tabId))})]}),e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2 text-xs uppercase tracking-[0.2em] text-slate-400",children:[e.jsx(yt,{size:14}),"Alerts"]}),m>=85?e.jsx("div",{className:"rounded-xl border border-red-400/40 bg-red-500/10 px-3 py-2 text-sm text-red-200",children:"Memory is critically high. Consider closing heavy tabs."}):m>=70?e.jsx("div",{className:"rounded-xl border border-amber-400/40 bg-amber-500/10 px-3 py-2 text-sm text-amber-200",children:"Memory usage elevated. Auto power-save may trigger soon."}):e.jsx("div",{className:"rounded-xl border border-emerald-400/40 bg-emerald-500/10 px-3 py-2 text-sm text-emerald-200",children:"Memory is healthy. Redix is reclaiming surplus automatically."})]})]})]})}const Gn=[{id:"summarize",label:"Summarize",icon:e.jsx(it,{size:14})},{id:"explain",label:"Explain",icon:e.jsx(xe,{size:14})},{id:"translate",label:"Translate",icon:e.jsx(fe,{size:14})},{id:"search",label:"Search",icon:e.jsx(fe,{size:14})},{id:"copy",label:"Copy",icon:e.jsx(Js,{size:14})}];function Yn({enabled:t=!0,onAction:s}){const[a,r]=c.useState(""),[n,o]=c.useState(null),[i,u]=c.useState(!1),[p,b]=c.useState(!1),m=c.useRef(null);c.useEffect(()=>{if(!t)return;const x=()=>{const d=window.getSelection(),h=d?.toString().trim()||"";if(h.length>0&&h.length<500){const w=d?.getRangeAt(0);if(w){const k=w.getBoundingClientRect();o({x:k.left+k.width/2,y:k.top-10}),r(h),b(!0)}}else b(!1),r(""),o(null)},l=d=>{m.current&&!m.current.contains(d.target)&&(b(!1),r(""),o(null))};return document.addEventListener("selectionchange",x),document.addEventListener("mousedown",l),()=>{document.removeEventListener("selectionchange",x),document.removeEventListener("mousedown",l)}},[t]);const y=async x=>{if(a){u(!0);try{switch(x){case"copy":await navigator.clipboard.writeText(a),s?.(x,a);break;case"summarize":case"explain":case"translate":case"search":try{await E.redix.stream(`${x}: ${a}`,{sessionId:`minihover-${Date.now()}`},l=>{l.type==="token"&&l.text&&console.log("[MiniHoverAI] Response:",l.text)}),s?.(x,a)}catch(l){console.error("[MiniHoverAI] AI action failed:",l)}break}}catch(l){console.error("[MiniHoverAI] Action failed:",l)}finally{u(!1),b(!1),r(""),o(null),window.getSelection()?.removeAllRanges()}}};return!t||!p||!n?null:e.jsx(ee,{children:p&&n&&e.jsxs(_.div,{ref:m,initial:{opacity:0,scale:.8,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:10},transition:{duration:.2},className:"fixed z-[9999] pointer-events-auto",style:{left:`${n.x}px`,top:`${n.y}px`,transform:"translate(-50%, -100%)"},children:[e.jsx("div",{className:"bg-gray-900/95 backdrop-blur-xl border border-gray-700/50 rounded-lg shadow-2xl p-2 flex items-center gap-1",children:i?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 text-sm text-gray-300",children:[e.jsx(ot,{size:16,className:"animate-spin text-blue-400"}),e.jsx("span",{children:"Processing..."})]}):e.jsxs(e.Fragment,{children:[Gn.map(x=>e.jsxs(_.button,{onClick:()=>y(x.id),whileHover:{scale:1.05},whileTap:{scale:.95},className:"flex items-center gap-1.5 px-3 py-2 rounded-md bg-gray-800/60 hover:bg-gray-700/80 border border-gray-700/50 text-gray-300 hover:text-blue-400 transition-colors text-xs font-medium",title:x.label,children:[x.icon,e.jsx("span",{children:x.label})]},x.id)),e.jsx("button",{onClick:()=>{b(!1),r(""),o(null),window.getSelection()?.removeAllRanges()},className:"p-2 rounded-md text-gray-400 hover:text-gray-200 hover:bg-gray-800/60 transition-colors",title:"Close",children:e.jsx(oe,{size:14})})]})}),e.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-full w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-700/50"})]})})}function Ms(t){const s=t.toLowerCase().trim(),a=t.trim(),r=[/(?:निफ्टी|nifty|reliance|टीसीएस|tcs|hdfc|एचडीएफसी)\s*(?:(\d+)\s*)?(?:खरीदो|kharido|buy|बेचो|becho|sell)/i,/(?:buy|kharido|खरीदो|becho|बेचो|sell)\s+(\w+)\s*(?:(\d+)\s*(?:quantity|qty|qty|मात्रा))?\s*(?:SL|stop\s*loss|स्टॉप\s*लॉस)\s*(\d+)?/i,/(\d+)\s+(\w+(?:\s+\w+)?)\s+(?:buy|kharido|खरीदो|becho|बेचो|sell)\s*(?:at\s*market|market\s*price)?/i,/(?:buy|kharido|खरीदो)\s+(\d+)\s+(\w+)/i,/(\d+)\s+(\w+)\s+(?:buy|kharido|खरीदो|sell|becho|बेचो)/i];for(const n of r){const o=s.match(n);if(o){const i=s.includes("sell")||s.includes("becho")||s.includes("बेचो");let u=o[2]||o[1];s.includes("निफ्टी")||s.includes("nifty")?u="NIFTY":s.includes("टीसीएस")||s.includes("tcs")?u="TCS":s.includes("एचडीएफसी")||s.includes("hdfc")?u="HDFC":s.includes("reliance")&&(u="RELIANCE");let p=1;o[1]&&!isNaN(parseInt(o[1],10))?p=parseInt(o[1],10):o[2]&&!isNaN(parseInt(o[2],10))&&(p=parseInt(o[2],10));const b=s.match(/(?:SL|stop\s*loss|स्टॉप\s*लॉस)\s*(\d+)/i),m=b?parseInt(b[1],10):void 0;return{type:"trade",orderType:i?"sell":"buy",symbol:u.toUpperCase(),quantity:p,stopLoss:m,originalText:a}}}if(s.includes("मौसम")||s.includes("weather")||s.includes("बारिश")||s.includes("गर्मी")||s.includes("temperature")||s.includes("तापमान")){let n="Delhi";return(s.includes("मुंबई")||s.includes("mumbai"))&&(n="Mumbai"),(s.includes("बैंगलोर")||s.includes("bangalore"))&&(n="Bangalore"),(s.includes("कोलकाता")||s.includes("kolkata"))&&(n="Kolkata"),(s.includes("चेन्नई")||s.includes("chennai"))&&(n="Chennai"),(s.includes("हैदराबाद")||s.includes("hyderabad"))&&(n="Hyderabad"),{type:"weather",query:n,originalText:a}}if(s.includes("ट्रेन")||s.includes("train")||s.includes("टिकट")||s.includes("ticket")||s.includes("book")&&(s.includes("train")||s.includes("ट्रेन"))){let n="Delhi",o="Mumbai",i="tomorrow";return(s.includes("मुंबई")||s.includes("mumbai"))&&(s.includes("से")||s.includes("from")?o="Mumbai":n="Mumbai"),(s.includes("दिल्ली")||s.includes("delhi"))&&(s.includes("से")||s.includes("from")?n="Delhi":o="Delhi"),(s.includes("चेन्नई")||s.includes("chennai"))&&(o="Chennai"),(s.includes("बैंगलोर")||s.includes("bangalore"))&&(o="Bangalore"),(s.includes("कोलकाता")||s.includes("kolkata"))&&(o="Kolkata"),{type:"train",query:`${n} to ${o} on ${i}`,url:`train:${n}:${o}:${i}`,originalText:a}}if(s.includes("फ्लाइट")||s.includes("flight")||s.includes("हवाई जहाज")||s.includes("उड़ान")||s.includes("book")&&(s.includes("flight")||s.includes("फ्लाइट"))){let n="Delhi",o="Mumbai",i="tomorrow",u;return(s.includes("मुंबई")||s.includes("mumbai"))&&(o="Mumbai"),(s.includes("बैंगलोर")||s.includes("bangalore"))&&(o="Bangalore"),(s.includes("चेन्नई")||s.includes("chennai"))&&(o="Chennai"),(s.includes("दिल्ली")||s.includes("delhi"))&&(n="Delhi"),(s.includes("वापस")||s.includes("return")||s.includes("राउंड")||s.includes("दोनों तरफ"))&&(u="20 December"),{type:"flight",query:`${n} to ${o} on ${i}${u?` return ${u}`:""}`,url:`flight:${n}:${o}:${i}${u?`:${u}`:""}`,originalText:a}}if(s.includes("research")||s.includes("research kar"))return{type:"research",query:s.match(/research\s+(?:kar\s+)?(.+)/i)?.[1]||a.replace(/research\s+(?:kar\s+)?/i,""),originalText:a};if(s.includes("search")||s.includes("dhundho")||s.includes("खोजो")||s.includes("show me")||s.includes("dikhao"))return{type:"search",query:s.match(/(?:search|dhundho|खोजो|show\s+me|dikhao)\s+(.+)/i)?.[1]||a,originalText:a};if(s.includes("summarize")||s.includes("summary")||s.includes("samjha de")||s.includes("समझा दे"))return{type:"summarize",query:a,originalText:a};if(s.includes("explain")||s.includes("kya kar raha hai")||s.includes("क्या कर रहा है"))return{type:"explain",query:a,originalText:a};if(s.includes("fill")||s.includes("daal do")||s.includes("डाल दो")||s.includes("form fill")||s.includes("auto fill"))return{type:"fill_form",query:a,originalText:a};if(s.includes("save my profile")||s.includes("save profile")||s.includes("mera profile save kar")||s.includes("मेरा प्रोफाइल सेव कर"))return{type:"save_profile",query:a,originalText:a};if(s.includes("screenshot")||s.includes("स्क्रीनशॉट")||s.includes("screenshot le")||s.includes("स्क्रीनशॉट ले")||s.includes("isme kya hai")||s.includes("इसमें क्या है")||s.includes("analysis")||s.includes("analysis kar")||s.includes("एनालिसिस कर")||s.includes("yeh chart")||s.includes("यह चार्ट"))return{type:"screenshot",query:a,originalText:a};if(s.includes("open")&&s.match(/\d+\s+tab/)){const n=s.match(/open\s+(\d+)\s+tab/i),o=s.match(/about\s+(.+)/i);return{type:"open_tabs",tabs:n?parseInt(n[1],10):5,query:o?.[1],originalText:a}}return s.includes("open")||s.includes("go to")||s.includes("kholo")?{type:"navigate",url:s.match(/(?:open|go\s+to|kholo)\s+(.+)/i)?.[1]||a,originalText:a}:{type:"search",query:a,originalText:a}}async function Ps(t){const s=Q.getState().mode;try{const{isElectronRuntime:a}=await L(async()=>{const{isElectronRuntime:r}=await import("./core-ai-yFIunLTZ.js").then(n=>n.N);return{isElectronRuntime:r}},__vite__mapDeps([0,1,2,3,4,5,6]));if(a())try{const{ipc:r}=await L(async()=>{const{ipc:i}=await import("./core-ai-yFIunLTZ.js").then(u=>u.U);return{ipc:i}},__vite__mapDeps([0,1,2,3,4,5,6])),n=s.toLowerCase(),o=await r.invoke("wispr_command",{input:t.originalText,mode:n});if(o){A.success(o);return}}catch(r){console.warn("[WISPR] Backend routing failed, using frontend:",r)}switch(t.type){case"trade":await Jn(t);break;case"research":await Qn(t);break;case"search":await As(t);break;case"summarize":await Xn(t);break;case"explain":await Zn(t);break;case"fill_form":await eo(t);break;case"save_profile":await to(t);break;case"screenshot":await no(t);break;case"open_tabs":await oo(t);break;case"navigate":await io(t);break;case"weather":await so(t);break;case"train":await ao(t);break;case"flight":await ro(t);break;default:await As(t)}}catch(a){console.error("[WISPR] Command execution failed:",a),A.error(`Failed to execute: ${t.originalText}`)}}async function Jn(t){Q.getState().mode!=="Trade"&&(Q.getState().setMode("Trade"),await new Promise(u=>setTimeout(u,300)));const{symbol:s,quantity:a,orderType:r,stopLoss:n,takeProfit:o}=t;if(!s||!a){A.error("Missing symbol or quantity for trade command");return}const i=r==="buy"||r==="sell"?r:"buy";try{const u=Date.now();A.info(`Placing ${i} order: ${a} ${s}...`);const{tradeApi:p}=await L(async()=>{const{tradeApi:y}=await import("./core-ai-yFIunLTZ.js").then(x=>x.O);return{tradeApi:y}},__vite__mapDeps([0,1,2,3,4,5,6])),b=await p.placeOrder({symbol:s.toUpperCase(),quantity:a,orderType:i,stopLoss:n,takeProfit:o}),m=Date.now()-u;if(b.success){const y=`${i==="buy"?"BUY":"SELL"} order placed: ${a} × ${s}
Order ID: ${b.orderId}
Time: ${m}ms${n?`
SL: ₹${n}`:""}${o?` | TP: ₹${o}`:""}`;if(A.success(y),window.dispatchEvent(new CustomEvent("wispr:trade",{detail:{symbol:s,quantity:a,orderType:i,stopLoss:n,orderId:b.orderId,success:!0}})),"speechSynthesis"in window){const x=Ce.getState().language||"en",l=new SpeechSynthesisUtterance(x==="hi"?`${i==="buy"?"खरीद":"बिक्री"} आदेश ${b.orderId} सफल`:`${i==="buy"?"Buy":"Sell"} order ${b.orderId} placed successfully`);l.lang=x==="hi"?"hi-IN":"en-US",speechSynthesis.speak(l)}}else throw new Error("Order placement failed")}catch(u){console.error("[WISPR] Trade order failed:",u);const p=u.message||"Failed to place order. Check Zerodha API keys.";A.error(`Order failed: ${p}`),window.dispatchEvent(new CustomEvent("wispr:trade",{detail:{symbol:s,quantity:a,orderType:r,stopLoss:n,success:!1,error:p}}))}}async function Qn(t){if(Q.getState().mode!=="Research"&&(Q.getState().setMode("Research"),await new Promise(a=>setTimeout(a,500))),!t.query){A.error("No research query provided");return}window.dispatchEvent(new CustomEvent("wispr:research",{detail:{query:t.query}})),A.info(`Researching: ${t.query}`)}async function As(t){if(!t.query)return;const{normalizeInputToUrlOrSearch:s}=await L(async()=>{const{normalizeInputToUrlOrSearch:p}=await import("./OmniDesk-C5fSodZ1.js").then(b=>b.s);return{normalizeInputToUrlOrSearch:p}},__vite__mapDeps([7,2,3,4,0,1,5,6,8,9,10,11,12,13,14,15])),{useSettingsStore:a}=await L(async()=>{const{useSettingsStore:p}=await import("./core-ai-yFIunLTZ.js").then(b=>b.V);return{useSettingsStore:p}},__vite__mapDeps([0,1,2,3,4,5,6])),r=a.getState(),n=r.language||"auto",o=r.searchEngine||"google";let i="google";(o==="duckduckgo"||o==="bing"||o==="yahoo")&&(i=o);const u=s(t.query,i,n!=="auto"?n:void 0);await E.tabs.create(u),A.success(`Searching: ${t.query}`)}async function Xn(t){const{useTabsStore:s}=await L(async()=>{const{useTabsStore:i}=await import("./core-ai-yFIunLTZ.js").then(u=>u.S);return{useTabsStore:i}},__vite__mapDeps([0,1,2,3,4,5,6])),a=s.getState(),n=a.tabs.find(i=>i.id===a.activeId);if(!n?.url||n.url==="about:blank"){A.error("No page to summarize");return}const o=await Us.runTask({kind:"summary",prompt:`Summarize this page in 3 bullet points: ${n.url}`,context:{url:n.url}});A.success(o.text.substring(0,200)+"...",{duration:1e4})}async function Zn(t){const s=window.getSelection()?.toString();if(!s){A.error("No code selected. Please select code to explain.");return}const a=await Us.runTask({kind:"chat",prompt:`Explain this code in simple language:

${s}`});A.success(a.text.substring(0,300)+"...",{duration:1e4})}async function eo(t){const{fillAllForms:s,getUserProfile:a}=await L(async()=>{const{fillAllForms:i,getUserProfile:u}=await import("./formFiller-CRt4dSj3.js");return{fillAllForms:i,getUserProfile:u}},[]);if(document.querySelectorAll("form").length===0){A.error("No forms found on this page");return}const n=a();if(Object.keys(n).length===0){A.info('No saved profile found. Say "Save my profile" to store your information first.');return}const o=s(n);o>0?A.success(`Filled ${o} form field${o===1?"":"s"} with saved profile`):A.info("No matching fields found. Profile data may not match form fields.")}async function to(t){const{saveUserProfile:s}=await L(async()=>{const{saveUserProfile:i}=await import("./formFiller-CRt4dSj3.js");return{saveUserProfile:i}},[]),a=document.querySelectorAll("form");if(a.length===0){A.info('No forms found. Please fill a form first, then say "Save my profile" again.');return}const r=a[0],n=new FormData(r),o={};for(const[i,u]of n.entries())if(typeof u=="string"&&u.trim()){const p=i.toLowerCase();p.includes("name")&&!o.name?o.name=u:p.includes("email")&&!o.email?o.email=u:(p.includes("phone")||p.includes("mobile"))&&!o.phone?o.phone=u:p.includes("address")&&!o.address?o.address=u:p.includes("city")&&!o.city?o.city=u:p.includes("pincode")||p.includes("zip")||p.includes("postal")?o.pincode=u:p.includes("aadhaar")||p.includes("aadhar")?o.aadhaar=u:p.includes("pan")&&(o.pan=u)}Object.keys(o).length>0?(s(o),A.success(`Profile saved with ${Object.keys(o).length} field${Object.keys(o).length===1?"":"s"}`)):A.info("No profile data found in forms. Please fill a form first.")}async function so(t){try{const s=t.query||"Delhi";if(typeof window<"u"&&window.__TAURI__){const{invoke:a}=await L(async()=>{const{invoke:r}=await import("@tauri-apps/api/core");return{invoke:r}},[]);await a("get_weather",{city:s}),A.success(`Weather for ${s} loading...`)}else try{const a=await fetch(`http://127.0.0.1:4000/api/weather/${s}`);if(a.ok){const r=await a.json();window.dispatchEvent(new CustomEvent("weather-update",{detail:r}))}}catch(a){console.warn("[WISPR] Weather API fallback failed:",a)}}catch(s){console.error("[WISPR] Weather command failed:",s),A.error("Failed to get weather. Check internet connection.")}}async function ao(t){try{const s=t.query?.split(" to ")||[],a=s[0]||"Delhi",r=s[1]?.split(" on ")||[],n=r[0]||"Mumbai",o=r[1]||"tomorrow";if(typeof window<"u"&&window.__TAURI__){const{invoke:i}=await L(async()=>{const{invoke:u}=await import("@tauri-apps/api/core");return{invoke:u}},[]);await i("book_train",{from:a,to:n,date:o}),A.success(`Booking train from ${a} to ${n}...`)}else A.info(`Train booking: ${a} → ${n} on ${o}`)}catch(s){console.error("[WISPR] Train command failed:",s),A.error("Failed to book train. Please try again.")}}async function ro(t){try{const s=t.query?.split(" to ")||[],a=s[0]||"Delhi",r=s[1]?.split(" on ")||[],n=r[0]||"Mumbai",o=r[1]?.split(" return ")||[],i=o[0]||"tomorrow",u=o[1]||void 0;if(typeof window<"u"&&window.__TAURI__){const{invoke:p}=await L(async()=>{const{invoke:b}=await import("@tauri-apps/api/core");return{invoke:b}},[]);await p("book_flight",{from:a,to:n,departDate:i,returnDate:u}),A.success(`Booking flight: ${a} → ${n}${u?" (round-trip)":""}...`)}else A.info(`Flight booking: ${a} → ${n} on ${i}${u?` return ${u}`:""}`)}catch(s){console.error("[WISPR] Flight command failed:",s),A.error("Failed to book flight. Please try again.")}}async function no(t){const{captureAndAnalyze:s}=await L(async()=>{const{captureAndAnalyze:n}=await import("./screenshotAnalyzer--BZfFR7x.js");return{captureAndAnalyze:n}},__vite__mapDeps([16,0,1,2,3,4,5,6])),a=t.query?.replace(/screenshot|isme kya hai|इसमें क्या है|analysis|analyze/gi,"").trim();A.info("Capturing screenshot...");const r=await s(a||void 0);if(r){const n=document.createElement("div");n.className="fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm",n.innerHTML=`
      <div class="bg-slate-900 border border-purple-600 rounded-3xl p-8 max-w-2xl max-h-[80vh] overflow-y-auto shadow-2xl">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-2xl font-bold text-purple-300">WISPR Screenshot Analysis</h2>
          <button class="text-gray-400 hover:text-white" onclick="this.closest('.fixed').remove()">✕</button>
        </div>
        <div class="text-gray-200 whitespace-pre-wrap">${r}</div>
        <button 
          class="mt-4 px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-white"
          onclick="this.closest('.fixed').remove()"
        >
          Close
        </button>
      </div>
    `,document.body.appendChild(n),n.addEventListener("click",i=>{i.target===n&&n.remove()});const o=i=>{i.key==="Escape"&&(n.remove(),document.removeEventListener("keydown",o))};document.addEventListener("keydown",o)}else A.error("Failed to analyze screenshot")}async function oo(t){const s=t.tabs||5,a=t.query||"";if(!a){A.error("No search query provided");return}const{normalizeInputToUrlOrSearch:r}=await L(async()=>{const{normalizeInputToUrlOrSearch:p}=await import("./OmniDesk-C5fSodZ1.js").then(b=>b.s);return{normalizeInputToUrlOrSearch:p}},__vite__mapDeps([7,2,3,4,0,1,5,6,8,9,10,11,12,13,14,15])),{useSettingsStore:n}=await L(async()=>{const{useSettingsStore:p}=await import("./core-ai-yFIunLTZ.js").then(b=>b.V);return{useSettingsStore:p}},__vite__mapDeps([0,1,2,3,4,5,6])),i=n.getState().searchEngine||"google";let u="google";(i==="duckduckgo"||i==="bing"||i==="yahoo")&&(u=i);for(let p=0;p<s;p++){const b=`${a} ${p>0?`page ${p+1}`:""}`,m=r(b,u);await E.tabs.create(m),await new Promise(y=>setTimeout(y,200))}A.success(`Opened ${s} tabs about: ${a}`)}async function io(t){if(!t.url)return;const{normalizeInputToUrlOrSearch:s}=await L(async()=>{const{normalizeInputToUrlOrSearch:y}=await import("./OmniDesk-C5fSodZ1.js").then(x=>x.s);return{normalizeInputToUrlOrSearch:y}},__vite__mapDeps([7,2,3,4,0,1,5,6,8,9,10,11,12,13,14,15])),{useSettingsStore:a}=await L(async()=>{const{useSettingsStore:y}=await import("./core-ai-yFIunLTZ.js").then(x=>x.V);return{useSettingsStore:y}},__vite__mapDeps([0,1,2,3,4,5,6])),n=a.getState().searchEngine||"google";let o="google";(n==="duckduckgo"||n==="bing"||n==="yahoo")&&(o=n);const i=s(t.url,o),{useTabsStore:u}=await L(async()=>{const{useTabsStore:y}=await import("./core-ai-yFIunLTZ.js").then(x=>x.S);return{useTabsStore:y}},__vite__mapDeps([0,1,2,3,4,5,6])),p=u.getState(),m=p.tabs.find(y=>y.id===p.activeId);m?await E.tabs.navigate(m.id,i):await E.tabs.create(i)}const lo={hi:"hi-IN",en:"en-US",ta:"ta-IN",te:"te-IN",bn:"bn-IN",mr:"mr-IN",kn:"kn-IN",ml:"ml-IN",gu:"gu-IN",pa:"pa-IN",ur:"ur-PK"};function co(t){return!t||t==="auto"?"hi-IN,en-US":lo[t]||t.includes("-")?t:`${t}-${t.toUpperCase()}`}function uo(){const[t,s]=c.useState(!1),[a,r]=c.useState(""),[n,o]=c.useState(!1),[i,u]=c.useState(!1),[p,b]=c.useState(!1),m=c.useRef(null),y=Ce(w=>w.language||"auto"),x=["hey wispr","jarvis","regen","wake up"];c.useEffect(()=>{const w=window.SpeechRecognition||window.webkitSpeechRecognition;if(!w){console.warn("[WISPR] Speech Recognition not available");return}try{const k=new w;k.continuous=!1,k.interimResults=!0,k.lang=co(y),k.maxAlternatives=1,k.onresult=O=>{const j=Array.isArray(O.results)?Array.from(O.results):[],S=j[j.length-1],v=S?.[0]?.transcript||"";S?.isFinal?(r(v.trim()),o(!0),l(v.trim())):r(v)},k.onerror=O=>{console.error("[WISPR] Speech recognition error:",O.error),s(!1),o(!1),r(""),O.error==="not-allowed"?A.error("Microphone permission denied. Please enable it in browser settings."):O.error==="no-speech"?s(!1):A.error(`Speech recognition error: ${O.error}`)},k.onend=()=>{s(!1),o(!1),r("")},m.current=k}catch(k){console.error("[WISPR] Failed to initialize speech recognition:",k)}},[y]);const l=async w=>{if(!w.trim()){s(!1);return}try{o(!0);const k=w.toLowerCase();if(x.some(j=>k.includes(j))||i){u(!0),b(!0);let j=w;for(const C of x)if(k.includes(C)){j=w.substring(w.toLowerCase().indexOf(C)+C.length).trim();break}if(Se())try{const{ipc:C}=await L(async()=>{const{ipc:Y}=await import("./core-ai-yFIunLTZ.js").then(q=>q.U);return{ipc:Y}},__vite__mapDeps([0,1,2,3,4,5,6])),T=await C.vision.captureScreen(),U=`User said: "${j||w}"
Describe what you see on screen and suggest the best action.`,H=await C.vision.analyze(U,T);if("speechSynthesis"in window){const Y=new SpeechSynthesisUtterance(H||"Command processed");Y.lang="en-IN",Y.rate=1,Y.pitch=1,window.speechSynthesis.speak(Y),r(`Jarvis: ${H.substring(0,100)}${H.length>100?"...":""}`)}}catch(C){console.warn("[WISPR] Vision processing failed:",C),A.warning("Vision analysis unavailable. Using text-only mode.")}const S=Ms(j||w),v=S.type.charAt(0).toUpperCase()+S.type.slice(1).replace("_"," ");r(`Jarvis: Executing ${v}...`),await Ps(S),r(`✓ Jarvis: ${v} completed`)}else{const j=Ms(w),S=j.type.charAt(0).toUpperCase()+j.type.slice(1).replace("_"," ");r(`Executing ${S}...`),await Ps(j),r(`✓ ${S} completed`)}setTimeout(()=>{r("")},2e3)}catch(k){console.error("[WISPR] Command execution error:",k),r("✗ Command failed"),A.error("Failed to execute command"),setTimeout(()=>{r("")},2e3)}finally{o(!1),s(!1),setTimeout(()=>{r("")},3e3)}},d=()=>{const w=m.current;if(!w){A.error("Speech recognition not available. Please use Chrome or Edge.");return}try{s(!0),r(""),o(!1),w.start(),A.info("WISPR listening... Speak now")}catch(k){console.error("[WISPR] Failed to start recognition:",k),s(!1),k.message?.includes("already started")?(w.stop(),setTimeout(()=>{w.start(),s(!0)},100)):A.error("Failed to start voice recognition")}},h=()=>{const w=m.current;if(w)try{w.stop()}catch(k){console.error("[WISPR] Error stopping recognition:",k)}s(!1),o(!1),r("")};return c.useEffect(()=>{Se()&&(async()=>{try{const{ipcEvents:k}=await L(async()=>{const{ipcEvents:O}=await import("../assets/index-D9cF9G1U.js").then(j=>j.h);return{ipcEvents:O}},__vite__mapDeps([8,0,1,2,3,4,5,6,9,10,11,12,13,14,15]));k.on("wake-wispr",()=>{t||(d(),u(!0),A.info("Jarvis mode activated!"))}),k.on("open-trade-mode",async()=>{const{useAppStore:O}=await L(async()=>{const{useAppStore:j}=await import("./core-ai-yFIunLTZ.js").then(S=>S.Q);return{useAppStore:j}},__vite__mapDeps([0,1,2,3,4,5,6]));O.getState().setMode("Trade"),A.info("Trade mode opened")})}catch(k){console.warn("[WISPR] Global hotkey setup failed:",k)}})()},[t]),c.useEffect(()=>{const w=k=>{k.ctrlKey&&k.code==="Space"&&!k.shiftKey&&(k.preventDefault(),k.stopPropagation(),t?h():(d(),u(!0))),t&&(k.key==="Escape"||k.ctrlKey&&k.key==="c")&&(k.preventDefault(),h(),A.info("WISPR stopped"))};return window.addEventListener("keydown",w,!0),()=>window.removeEventListener("keydown",w,!0)},[t]),e.jsxs(e.Fragment,{children:[e.jsxs(_.div,{drag:!0,dragMomentum:!1,className:"fixed bottom-24 right-8 z-50 cursor-move",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsxs("button",{onClick:()=>t?h():d(),className:"relative","aria-label":"WISPR Voice Assistant",children:[e.jsx("div",{className:`w-20 h-20 rounded-full bg-gradient-to-r from-purple-600 to-pink-600 shadow-2xl flex items-center justify-center transition-all ${t?"animate-pulse scale-110 ring-4 ring-purple-500/50":"hover:scale-105"} ${i?"ring-4 ring-blue-500":""}`,children:t?e.jsx(Ka,{className:"w-10 h-10 text-white animate-bounce"}):i?e.jsx(Ha,{className:"w-10 h-10 text-white"}):e.jsx(xe,{className:"w-10 h-10 text-white"})}),p&&e.jsx("div",{className:"absolute -bottom-2 -right-2 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(Ga,{className:"w-3 h-3 text-white"})})]}),e.jsx("div",{className:"absolute -top-10 left-1/2 -translate-x-1/2 bg-black/80 backdrop-blur px-4 py-2 rounded-full text-sm whitespace-nowrap pointer-events-none",children:i?"Jarvis Mode":"Ctrl + Space to talk"})]}),t&&e.jsxs(_.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},className:"fixed bottom-48 right-8 bg-black/90 backdrop-blur-xl border border-purple-600 rounded-3xl p-8 shadow-2xl max-w-md z-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-4 h-4 bg-red-500 rounded-full animate-pulse"}),e.jsx("p",{className:"text-2xl font-bold text-purple-300",children:n?"Processing...":"WISPR Listening..."})]}),e.jsx("button",{onClick:h,className:"text-gray-400 hover:text-white transition-colors","aria-label":"Stop listening",children:e.jsx(oe,{className:"w-5 h-5"})})]}),a&&e.jsxs("div",{className:"mt-4 p-4 bg-purple-900/20 rounded-xl border border-purple-500/30",children:[e.jsx("p",{className:"text-sm text-gray-300 mb-2",children:"You said:"}),e.jsx("p",{className:"text-white font-medium text-lg",children:a})]}),e.jsx("p",{className:"mt-4 text-gray-400 text-sm",children:n?"Executing your command...":`Say in Hindi or English:
"निफ्टी खरीदो 50" or "Buy 50 Nifty"
"Research Tesla" or "Screenshot le"`}),e.jsx("button",{onClick:h,className:"mt-4 w-full bg-red-600/20 hover:bg-red-600/30 border border-red-500/50 rounded-lg px-4 py-2 text-red-300 text-sm font-medium transition-colors",children:"Band kar / Stop (Esc)"})]})]})}const mo=[{id:"history",label:"History",icon:e.jsx(Vs,{size:16})},{id:"bookmarks",label:"Bookmarks",icon:e.jsx(Xs,{size:16})},{id:"workspaces",label:"Workspaces",icon:e.jsx(Zs,{size:16})},{id:"downloads",label:"Downloads",icon:e.jsx(gt,{size:16})}];function po({open:t,onClose:s,defaultTab:a="history",width:r=420}){const[n,o]=c.useState(a),[i,u]=c.useState(""),[p,b]=c.useState(!1),[m,y]=c.useState(!1);if(c.useEffect(()=>{const l=()=>{y(window.innerWidth<768),window.innerWidth<768&&b(!1)};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),!t)return null;const x=p?64:m?"100%":r;return e.jsx(ee,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:s,className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40","aria-hidden":"true"}),e.jsxs(_.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:`fixed right-0 top-0 bottom-0 z-50 bg-[#1A1D28] border-l border-gray-800/60 flex flex-col shadow-2xl transition-all duration-300 ${m?"w-full":""}`,style:{width:typeof x=="string"?x:`${x}px`},role:"dialog","aria-modal":"true","aria-label":"Side panel",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-800/60 px-4 py-3",children:[!p&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-100",children:"Library"})}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[!m&&e.jsx("button",{onClick:()=>b(!p),className:"p-1.5 rounded-lg text-gray-400 hover:text-gray-100 hover:bg-gray-800/60 transition-colors",title:p?"Expand":"Collapse",children:e.jsx(Ys,{size:18,className:`transition-transform ${p?"rotate-180":""}`})}),e.jsx("button",{onClick:l=>{l.stopImmediatePropagation(),l.stopPropagation(),s()},onMouseDown:l=>{l.stopImmediatePropagation(),l.stopPropagation()},className:"p-1.5 rounded-lg text-gray-400 hover:text-gray-100 hover:bg-gray-800/60 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500/40",style:{zIndex:10011,isolation:"isolate"},"aria-label":"Close panel",children:e.jsx(oe,{size:18})})]})]}),!p&&e.jsx("div",{className:"flex items-center border-b border-gray-800/60 px-4 bg-gray-900/30",children:mo.filter(l=>l&&l.id).map(l=>e.jsxs("button",{onClick:d=>{d.stopImmediatePropagation(),d.stopPropagation(),l&&o(l.id)},onMouseDown:d=>{d.stopImmediatePropagation(),d.stopPropagation()},className:`
                    relative flex items-center gap-2 px-4 py-3 text-sm font-medium transition-colors
                    ${n===l.id?"text-blue-400":"text-gray-400 hover:text-gray-200"}
                  `,style:{zIndex:10011,isolation:"isolate"},"aria-selected":n===l.id,role:"tab",children:[l.icon,e.jsx("span",{children:l.label}),n===l.id&&e.jsx(_.div,{layoutId:"activeTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-400",initial:!1})]},l.id))}),!p&&(n==="history"||n==="bookmarks"||n==="workspaces")&&e.jsx("div",{className:"px-4 py-3 border-b border-gray-800/60",children:e.jsxs("div",{className:"relative",children:[e.jsx(fe,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:i,onChange:l=>u(l.target.value),placeholder:`Search ${n}...`,className:"w-full pl-9 pr-3 py-2 bg-gray-900/60 border border-gray-700/50 rounded-lg text-sm text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/40 focus:border-blue-500/40"})]})}),!p&&e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(ee,{mode:"wait",children:e.jsxs(_.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},className:"h-full overflow-y-auto",children:[n==="history"&&e.jsx("div",{className:"h-full",children:e.jsx(mr,{})}),n==="bookmarks"&&e.jsx("div",{className:"h-full",children:e.jsx(kr,{})}),n==="workspaces"&&e.jsx("div",{className:"h-full",children:e.jsx(Tr,{})}),n==="downloads"&&e.jsx("div",{className:"h-full",children:e.jsx(pr,{})})]},n)})})]})]})})}function fo(){const[t,s]=c.useState(null),[a,r]=c.useState(!0),[n,o]=c.useState(null),i=async()=>{try{r(!0);const u=await E.system.getStatus();s(u),o(null)}catch(u){o(u instanceof Error?u:new Error("Failed to fetch system status")),console.error("[useSystemStatus] Failed to fetch status:",u)}finally{r(!1)}};return c.useEffect(()=>{if(!Se()&&!Re()){r(!1);return}i();const p=setInterval(i,5e3);return()=>clearInterval(p)},[]),{data:t,isLoading:a,error:n,refetch:i}}function ho(){const[t,s]=c.useState(!1),[a,r]=c.useState(""),[n,o]=c.useState(0),i=Q(d=>d.setMode),u=Ir(d=>d.bookmarks),{data:p}=fo(),b=c.useMemo(()=>{const d=[{id:"mode-research",label:"Switch to Research Mode",description:"AI-powered research and analysis",icon:fe,keywords:["research","mode","switch"],category:"modes",action:()=>i("Research")},{id:"new-tab",label:"New Tab",description:"Open a new tab",icon:ge,keywords:["new","tab","open"],category:"actions",action:async()=>{const h=await E.tabs.create("about:blank");if(h){const w=typeof h=="object"&&"id"in h?h.id:typeof h=="string"?h:null;w&&typeof w=="string"&&K.getState().setActive(w)}}},{id:"open-omniagent",label:"Open OmniAgent",description:"Ask OmniAgent a question",icon:xe,keywords:["agent","omniagent","ai","ask"],category:"actions",action:async()=>{await i("Research");const h=new CustomEvent("omniagent:focus");window.dispatchEvent(h)}},{id:"open-settings",label:"Open Settings",description:"Configure Regen",icon:ea,keywords:["settings","preferences","config"],category:"navigation",action:()=>{window.location.href="/settings"}},{id:"open-bookmarks",label:"Open Bookmarks",description:"View saved bookmarks",icon:it,keywords:["bookmarks","saved","favorites"],category:"navigation",action:()=>{const h=new CustomEvent("sidepanel:open",{detail:{tab:"bookmarks"}});window.dispatchEvent(h)}},{id:"open-workspaces",label:"Open Workspaces",description:"View saved workspaces",icon:Zs,keywords:["workspaces","sessions","saved"],category:"navigation",action:()=>{const h=new CustomEvent("sidepanel:open",{detail:{tab:"workspaces"}});window.dispatchEvent(h)}},{id:"system-status",label:"System Status",description:"View system health and service status",icon:Qs,keywords:["system","status","health","redis","redix","worker"],category:"settings",action:()=>{const h=new CustomEvent("system-status:open");window.dispatchEvent(h)}}];return u.slice(0,5).forEach(h=>{d.push({id:`bookmark-${h.id}`,label:h.title,description:h.url,icon:it,keywords:[h.title,h.url,"bookmark"],category:"navigation",action:async()=>{const w=await E.tabs.create(h.url);if(w){const k=typeof w=="object"&&"id"in w?w.id:typeof w=="string"?w:null;k&&typeof k=="string"&&K.getState().setActive(k)}}})}),d},[u,i,p]),m=c.useMemo(()=>{if(!a.trim())return b;const d=a.toLowerCase();return b.filter(h=>h.label.toLowerCase().includes(d)||h.description?.toLowerCase().includes(d)||h.keywords.some(w=>w.toLowerCase().includes(d)))},[b,a]);c.useEffect(()=>{const d=h=>{if((h.metaKey||h.ctrlKey)&&h.key==="k"&&(h.preventDefault(),s(w=>!w),Et("command_bar_opened")),t){if(h.key==="Escape")s(!1);else if(h.key==="ArrowDown")h.preventDefault(),o(w=>Math.min(w+1,m.length-1));else if(h.key==="ArrowUp")h.preventDefault(),o(w=>Math.max(w-1,0));else if(h.key==="Enter"){h.preventDefault();const w=m[n];w&&(w.action(),s(!1),r(""),Et("command_bar_executed",{command:w.id}))}}};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[t,m,n]),c.useEffect(()=>{o(0)},[a]);const y=d=>{d.action(),s(!1),r(""),Et("command_bar_executed",{command:d.id})},x=c.useMemo(()=>{const d={};return m.forEach(h=>{d[h.category]||(d[h.category]=[]),d[h.category].push(h)}),d},[m]),l={modes:"Modes",actions:"Actions",navigation:"Navigation",settings:"Settings"};return e.jsx(ee,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>s(!1),className:"fixed inset-0 z-[1080] bg-black/60 backdrop-blur-sm"}),e.jsxs(_.div,{initial:{opacity:0,scale:.95,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20},className:"fixed left-1/2 top-1/2 z-[1080] mx-4 w-full max-w-2xl -translate-x-1/2 -translate-y-1/2 rounded-2xl border border-slate-700 bg-slate-900 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 border-b border-slate-800 p-4",children:[e.jsx(fe,{size:20,className:"text-slate-400"}),e.jsx("input",{id:"command-bar-search",name:"command-bar-query",type:"text",value:a,onChange:d=>r(d.target.value),placeholder:"Type a command or search...",className:"flex-1 bg-transparent text-lg text-white placeholder-slate-500 focus:outline-none",autoFocus:!0}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500",children:[e.jsx("kbd",{className:"rounded border border-slate-700 bg-slate-800 px-2 py-1",children:navigator.platform.includes("Mac")?"⌘":"Ctrl"}),e.jsx("span",{children:"+"}),e.jsx("kbd",{className:"rounded border border-slate-700 bg-slate-800 px-2 py-1",children:"K"})]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto p-2",children:m.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-400",children:[e.jsx("p",{children:"No commands found"}),e.jsx("p",{className:"mt-2 text-sm",children:"Try a different search term"})]}):Object.entries(x).map(([d,h])=>e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"px-3 py-2 text-xs font-semibold uppercase tracking-wide text-slate-500",children:l[d]||d}),h.map((w,k)=>{const O=m.indexOf(w),j=O===n;return e.jsxs("button",{onClick:()=>y(w),onMouseEnter:()=>o(O),className:`flex w-full items-center gap-3 rounded-lg px-3 py-2 transition-colors ${j?"border border-purple-500/40 bg-gradient-to-r from-purple-500/20 to-cyan-500/20":"hover:bg-slate-800"}`,children:[e.jsx(w.icon,{size:18,className:j?"text-purple-300":"text-slate-400"}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:`font-medium ${j?"text-white":"text-slate-200"}`,children:w.label}),w.description&&e.jsx("div",{className:"mt-0.5 text-xs text-slate-500",children:w.description})]}),j&&e.jsx(Ya,{size:16,className:"text-purple-300"})]},w.id)})]},d))})]})]})})}const xo=[{id:"search",name:"AI Search",icon:fe,description:"Intelligent search with AI-powered results",color:"from-blue-500 to-cyan-500"},{id:"code",name:"AI Code",icon:Ja,description:"Code generation, debugging, and explanation",color:"from-purple-500 to-pink-500"},{id:"research",name:"AI Research",icon:it,description:"Deep research with multi-source aggregation",color:"from-emerald-500 to-teal-500"},{id:"writing",name:"AI Writing",icon:ge,description:"Content creation, editing, and enhancement",color:"from-orange-500 to-red-500"},{id:"translate",name:"AI Translate",icon:qs,description:"Real-time translation in 100+ languages",color:"from-indigo-500 to-purple-500"},{id:"image",name:"AI Image",icon:Qa,description:"Image generation, analysis, and editing",color:"from-pink-500 to-rose-500"}];function go(){const[t,s]=c.useState(!1),[a,r]=c.useState(null),{setMode:n}=Q(),o=i=>{r(i),n({search:"Browse",code:"Browse",research:"Research",writing:"Docs",translate:"Browse",image:"Images"}[i]),setTimeout(()=>s(!1),300)};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>s(!t),className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-2 font-semibold transition-all hover:scale-105",children:[e.jsx(xe,{className:"w-5 h-5"}),e.jsx("span",{children:"AI Omni Mode"})]}),e.jsx(ee,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>s(!1),className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[60]"}),e.jsx(_.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"fixed inset-0 z-[70] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-purple-500/50 rounded-3xl p-8 max-w-4xl w-full shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold text-white flex items-center gap-3",children:[e.jsx(xe,{className:"w-8 h-8 text-purple-400"}),"AI Omni Mode"]}),e.jsx("p",{className:"text-gray-400 mt-2",children:"Transform your browser into an AI operating system"})]}),e.jsx("button",{onClick:()=>s(!1),className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(oe,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:xo.map(i=>{const u=i.icon;return e.jsxs(_.button,{onClick:()=>o(i.id),whileHover:{scale:1.05},whileTap:{scale:.95},className:`bg-gradient-to-br ${i.color} p-6 rounded-2xl text-left hover:shadow-xl transition-all group`,children:[e.jsx(u,{className:"w-8 h-8 text-white mb-3 group-hover:scale-110 transition-transform"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-1",children:i.name}),e.jsx("p",{className:"text-white/80 text-sm",children:i.description})]},i.id)})}),e.jsxs("div",{className:"mt-6 text-center text-gray-400 text-sm",children:["Press ",e.jsx("kbd",{className:"px-2 py-1 bg-slate-800 rounded",children:"Esc"})," to close"]})]})})]})}),typeof window<"u"&&e.jsx(bo,{onToggle:()=>s(!t)})]})}function bo({onToggle:t}){return typeof window>"u"||c.useEffect(()=>{const s=a=>{a.ctrlKey&&a.shiftKey&&a.key==="O"&&(a.preventDefault(),t()),a.key==="Escape"&&t()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[t]),null}function yo(){const[t,s]=c.useState(!1),[a,r]=c.useState(""),[n,o]=c.useState(0),i=c.useRef(null),{setMode:u}=Q(),p=[{id:"research",label:"Research Mode",description:"Open research mode and search",icon:xe,keywords:["research","search","find","lookup"],action:async()=>{await u("Research"),s(!1),A.info("Research mode opened")}},{id:"trade",label:"Trade Mode",description:"Open trading mode with charts",icon:ta,keywords:["trade","trading","chart","btc","crypto"],action:async()=>{await u("Trade"),s(!1),A.info("Trade mode opened")}},{id:"browse",label:"Browse Mode",description:"Switch to browsing mode",icon:qt,keywords:["browse","web","internet"],action:async()=>{await u("Browse"),s(!1),A.info("Browse mode opened")}},{id:"wispr",label:"WISPR Voice",description:"Activate WISPR voice assistant",icon:xe,keywords:["wispr","voice","jarvis","assistant"],action:()=>{s(!1),window.dispatchEvent(new CustomEvent("activate-wispr")),A.info("WISPR activated")}},{id:"new-workspace",label:"New Workspace",description:"Create a new workspace for organizing tabs",icon:ge,keywords:["workspace","new","create","folder"],action:async()=>{s(!1),window.dispatchEvent(new CustomEvent("create-workspace")),A.info("New workspace created")}},{id:"look-it-up",label:"Look It Up",description:"Quick search and summarize (SigmaOS-style)",icon:fe,keywords:["look","search","summarize","quick"],action:async()=>{s(!1),window.dispatchEvent(new CustomEvent("open-quick-search")),A.info("Quick search opened")}}],b=te.useMemo(()=>{if(!a.trim())return p;const m=a.toLowerCase();return p.filter(y=>y.label.toLowerCase().includes(m)||y.description.toLowerCase().includes(m)||y.keywords.some(x=>x.toLowerCase().includes(m)))},[a]);return c.useEffect(()=>{if(!t)return;const m=y=>{y.key==="ArrowDown"?(y.preventDefault(),o(x=>Math.min(x+1,b.length-1))):y.key==="ArrowUp"?(y.preventDefault(),o(x=>Math.max(x-1,0))):y.key==="Enter"?(y.preventDefault(),b[n]&&b[n].action()):y.key==="Escape"&&(s(!1),r(""))};return window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m)},[t,b,n]),c.useEffect(()=>{const m=y=>{(navigator.platform.toUpperCase().indexOf("MAC")>=0?y.metaKey:y.ctrlKey)&&y.key==="k"&&(y.preventDefault(),s(d=>!d),t||setTimeout(()=>i.current?.focus(),100))};return window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m)},[t]),c.useEffect(()=>{o(0)},[a]),e.jsx(ee,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>s(!1),className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50"}),e.jsx(_.div,{initial:{opacity:0,scale:.95,y:-20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20},className:"fixed top-1/4 left-1/2 -translate-x-1/2 w-full max-w-2xl z-50",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 border-b border-slate-800",children:[e.jsx(fe,{className:"w-5 h-5 text-slate-400"}),e.jsx("input",{ref:i,type:"text",value:a,onChange:m=>r(m.target.value),placeholder:"Type a command or search...",className:"flex-1 bg-transparent text-white placeholder-slate-500 outline-none",autoFocus:!0}),e.jsx("button",{onClick:()=>s(!1),className:"text-slate-400 hover:text-white transition-colors",children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:b.length===0?e.jsx("div",{className:"px-4 py-8 text-center text-slate-400",children:"No commands found"}):b.map((m,y)=>{const x=m.icon,l=y===n;return e.jsxs("button",{onClick:()=>m.action(),onMouseEnter:()=>o(y),className:`w-full flex items-center gap-3 px-4 py-3 text-left transition-colors ${l?"bg-purple-600/20 border-l-2 border-purple-500":"hover:bg-slate-800/50"}`,children:[e.jsx(x,{size:20,className:"text-slate-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-white font-medium",children:m.label}),e.jsx("div",{className:"text-sm text-slate-400",children:m.description})]}),l&&e.jsx("div",{className:"text-xs text-slate-500",children:"Enter"})]},m.id)})}),e.jsxs("div",{className:"px-4 py-2 border-t border-slate-800 text-xs text-slate-500 flex items-center justify-between",children:[e.jsx("div",{children:"↑↓ Navigate • Enter Select • Esc Close"}),e.jsx("div",{children:"Cmd+K / Ctrl+K to open"})]})]})})]})})}function vo(){const[t,s]=c.useState(null),[a,r]=c.useState(!1),{setActive:n}=K(),{setMode:o}=Q();c.useEffect(()=>{if(!Se()&&!Re())return;const y=async()=>{try{const x=await E.session.checkRestore();if(x?.available&&x?.snapshot){const l=await E.session.getSnapshot();l&&l.tabs&&Array.isArray(l.tabs)&&s(l)}}catch{}};if(y(),window.ipc?.on){const x=(l,d)=>{y()};return window.ipc.on?.("session:restore-available",x),()=>{window.ipc?.removeListener&&window.ipc.removeListener("session:restore-available",x)}}},[]);const i=async()=>{if(t){r(!0);try{for(const m of t.tabs){const y=await E.tabs.create({url:m.url,mode:m.mode||"normal",containerId:m.containerId,fromSessionRestore:!0});if(y&&typeof y=="object"&&"id"in y){const x=typeof y.id=="string"?y.id:null;x&&(m.active||m.id===t.activeTabId)&&n(x)}}t.mode&&o(t.mode),await E.session.dismissRestore(),s(null)}catch(m){console.error("[SessionRestorePrompt] Failed to restore:",m)}finally{r(!1)}}},u=async()=>{try{await E.session.dismissRestore(),s(null)}catch(m){console.error("[SessionRestorePrompt] Failed to dismiss:",m)}};if(!t)return null;const p=t.tabs.length,b=new Date(t.timestamp);return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:m=>{m.target.closest("button")},children:e.jsxs("div",{className:"mx-4 w-full max-w-md rounded-lg border border-gray-700 bg-gray-900 p-6 shadow-xl",onClick:m=>{m.target.closest("button")||m.stopPropagation()},children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xt,{className:"h-5 w-5 text-blue-500"}),e.jsx("h2",{className:"text-xl font-bold text-gray-200",children:"Restore Previous Session?"})]}),e.jsx("button",{type:"button",onClick:m=>{m.preventDefault(),m.stopPropagation(),m.stopImmediatePropagation(),setTimeout(()=>{u()},0)},className:"text-gray-400 transition-colors hover:text-gray-300","aria-label":"Close",style:{pointerEvents:"auto",zIndex:10001},children:e.jsx(oe,{className:"h-5 w-5"})})]}),e.jsx("p",{className:"mb-4 text-sm text-gray-400",children:"We found a session snapshot from your last session. Would you like to restore it?"}),e.jsxs("div",{className:"mb-4 space-y-2 rounded bg-gray-800 p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Tabs"}),e.jsx("span",{className:"font-medium text-gray-200",children:p})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Mode"}),e.jsx("span",{className:"font-medium capitalize text-gray-200",children:t.mode})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Last saved"}),e.jsx("span",{className:"font-medium text-gray-200",children:Gt(b,{addSuffix:!0})})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:m=>{m.preventDefault(),m.stopPropagation(),m.stopImmediatePropagation(),setTimeout(()=>{i()},0)},disabled:a,className:"flex flex-1 items-center justify-center gap-2 rounded bg-blue-500 px-4 py-2 transition-colors hover:bg-blue-600 disabled:cursor-not-allowed disabled:opacity-50",style:{pointerEvents:a?"none":"auto",zIndex:10001},children:a?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4 animate-spin"}),"Restoring..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xt,{className:"h-4 w-4"}),"Restore"]})}),e.jsx("button",{type:"button",onClick:m=>{m.preventDefault(),m.stopPropagation(),m.stopImmediatePropagation(),setTimeout(()=>{u()},0)},disabled:a,className:"flex-1 rounded bg-gray-700 px-4 py-2 transition-colors hover:bg-gray-600 disabled:opacity-50",style:{pointerEvents:a?"none":"auto",zIndex:10001},children:"Start Fresh"})]})]})})}const wo=[/banking|financial|credit|loan|mortgage/i,/medical|health|patient|diagnosis|prescription/i,/legal|lawyer|attorney|court|lawsuit/i,/government|gov|irs|tax|social.*security/i,/adult|xxx|porn/i],jo=["bankofamerica.com","chase.com","wellsfargo.com","paypal.com","healthcare.gov","irs.gov","ssa.gov"],So={enabled:!0,sensitivityThreshold:70,autoPrivate:!1,autoGhost:!0};let ft={...So};async function No(t){try{const a=new URL(t).hostname.toLowerCase();let r=0;const n=[];for(const o of wo)(o.test(a)||o.test(t))&&(r+=20,n.push(`Matches sensitive pattern: ${o.source}`));jo.some(o=>a.includes(o))&&(r+=30,n.push("Known sensitive domain"));try{if(typeof E.threats?.scanUrl=="function"){const o=await E.threats.scanUrl(t);if(o&&typeof o=="object"){const i=o.riskLevel||"low";i==="high"||i==="critical"?(r+=40,n.push(`Redix threat scan: ${i} risk`)):i==="medium"&&(r+=20,n.push(`Redix threat scan: ${i} risk`))}}}catch(o){console.debug("[PrivacyAutoToggle] Threat scan failed:",o)}return{isSensitive:r>=ft.sensitivityThreshold,score:Math.min(100,r),reasons:n}}catch(s){return console.error("[PrivacyAutoToggle] Failed to check sensitivity:",s),{isSensitive:!1,score:0,reasons:[]}}}async function ko(t,s){if(!ft.enabled||s!=="Normal")return null;const a=await No(t);if(!a.isSensitive)return null;if(console.debug(`[PrivacyAutoToggle] Sensitive site detected (score: ${a.score}):`,t,a.reasons),ft.autoGhost)try{const r=await E.tor.status();if(r&&!r.stub)return r.running||await E.tor.start(),await E.private.createGhostTab({url:t}),"Ghost"}catch(r){console.warn("[PrivacyAutoToggle] Ghost mode failed, trying Private:",r)}if(ft.autoPrivate)try{return await E.private.createWindow({url:t}),"Private"}catch(r){console.error("[PrivacyAutoToggle] Failed to create private window:",r)}return null}const To=(t,s)=>{const a=t.map(r=>`${r.appMode??"all"}|${r.url??"about:blank"}`).join("::");return`${s??"none"}#${a}`},mt=De()(sa((t,s)=>({snapshot:null,saveSnapshot:(a,r)=>{if(!Array.isArray(a)||a.length===0){t({snapshot:null});return}const n=a.map(u=>({id:u.id,url:u.url,title:u.title,appMode:u.appMode,containerId:u.containerId,containerName:u.containerName,containerColor:u.containerColor})),o=s().snapshot,i=To(n,r);o?.hash!==i&&t({snapshot:{updatedAt:Date.now(),tabCount:n.length,tabs:n,activeId:n.some(u=>u.id===r)?r:n[0].id,hash:i}})},clearSnapshot:()=>t({snapshot:null}),restoreFromSnapshot:async()=>{const a=s().snapshot;if(!a||a.tabs.length===0)return{restored:!1,tabCount:0};const r=K.getState(),n=[];for(const u of a.tabs){const p=u.url||"about:blank";try{const b=await E.tabs.create(p),m=typeof b=="string"?b:b&&typeof b=="object"?b.id:null;m&&(r.updateTab(m,{title:u.title,appMode:u.appMode,containerId:u.containerId,containerName:u.containerName,containerColor:u.containerColor}),n.push(m))}catch(b){console.warn("[SessionStore] Failed to recreate tab from snapshot:",b)}}if(n.length===0)return{restored:!1,tabCount:0};const o=a.tabs.findIndex(u=>u.id===a.activeId),i=o>=0?n[o]:n[n.length-1];if(i){r.setActive(i);try{await E.tabs.activate({id:i})}catch(u){console.warn("[SessionStore] Failed to activate restored tab:",u)}}return{restored:!0,tabCount:n.length}}}),{name:"regen:session-snapshot",version:1})),ua="regen:history",ma=150,Eo=()=>{if(typeof window>"u")return[];try{const t=window.localStorage.getItem(ua);if(!t)return[];const s=JSON.parse(t);return Array.isArray(s)?s.filter(a=>a&&typeof a.id=="string").sort((a,r)=>(r.timestamp??0)-(a.timestamp??0)).slice(0,ma):[]}catch{return[]}},_s=t=>{if(!(typeof window>"u"))try{window.localStorage.setItem(ua,JSON.stringify(t))}catch(s){console.warn("[historyStore] Failed to persist history",s)}},Io=De((t,s)=>({entries:Eo(),addEntry:a=>{const r={...a,id:`${a.type}-${Date.now()}-${Math.random().toString(36).slice(2)}`,timestamp:Date.now()};t(n=>{const o=[r,...n.entries].slice(0,ma);return _s(o),{entries:o}})},clear:()=>{t({entries:[]}),_s([])},getRecent:(a=15)=>s().entries.slice(0,a)}));function Dt(){const t=document.getElementById("bottomBar");if(t){const s=t.getBoundingClientRect().height;document.documentElement.style.setProperty("--bottom-bar-height",`${s}px`)}else document.documentElement.style.setProperty("--bottom-bar-height","80px")}function Rs(){const t=document.querySelector("[data-top-chrome]");if(t){const s=t.getBoundingClientRect().height;document.documentElement.style.setProperty("--topbar-height",`${s}px`)}else document.documentElement.style.setProperty("--topbar-height","56px")}function zs(){const t=document.querySelector("[data-sidebar]");if(t){const s=t.getBoundingClientRect().width;document.documentElement.style.setProperty("--sidebar-width",`${s}px`)}else document.documentElement.style.setProperty("--sidebar-width","320px")}function Co(){Dt(),Rs(),zs();const t=()=>{Dt(),Rs(),zs()};window.addEventListener("resize",t);const s=document.getElementById("bottomBar"),a=s?new ResizeObserver(()=>{Dt()}):null;return s&&a&&a.observe(s),()=>{window.removeEventListener("resize",t),a&&s&&a.unobserve(s)}}function Mo({open:t,onClose:s}){const{activeSymbol:a,setActiveSymbol:r,watchlist:n,addToWatchlist:o,quotes:i,updateQuote:u}=Ft(),[p,b]=c.useState(!1),[m,y]=c.useState(null),[x,l]=c.useState("");c.useEffect(()=>{if(!t)return;let w=!1;const k=async()=>{b(!0),y(null);try{const j=await Cr(a);w||u(a,j)}catch(j){w||y(j instanceof Error?j.message:"Failed to load quote")}finally{w||b(!1)}};k();const O=setInterval(k,5e3);return()=>{w=!0,clearInterval(O)}},[a,t,u]);const d=i[a],h=(d?.change||0)>=0;return e.jsxs(e.Fragment,{children:[t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-30 sm:hidden",onClick:s,"aria-hidden":"true"}),e.jsxs("div",{className:`fixed right-0 top-0 bottom-0 w-96 max-w-[90vw] sm:max-w-full bg-gray-900/95 backdrop-blur-xl border-l border-gray-800 z-40 transform transition-transform duration-300 ${t?"translate-x-0":"translate-x-full"}`,onClick:w=>w.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xa,{size:18,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Trade Mode"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Ghost + VPN enabled for market data"})]})]}),e.jsx("button",{onClick:s,className:"rounded-lg p-1.5 text-gray-400 hover:text-white hover:bg-gray-800 transition-colors","aria-label":"Close trade sidebar",children:"✕"})]}),e.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto h-full",children:[e.jsxs("div",{className:"bg-gray-800/50 rounded-xl border border-gray-700/50 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase text-gray-400 tracking-wide",children:"Active Symbol"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:a}),d&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[h?e.jsx(ta,{size:16,className:"text-green-400"}):e.jsx(Za,{size:16,className:"text-red-400"}),e.jsxs("span",{className:h?"text-green-400":"text-red-400",children:[d.change.toFixed(2)," (",d.changePercent.toFixed(2),"%)"]})]})]}),e.jsx("button",{onClick:()=>i[a]&&u(a,i[a]),className:"p-2 rounded-lg bg-gray-800 text-gray-300 hover:text-white hover:bg-gray-700",title:"Refresh quote",children:e.jsx(Hs,{size:16})})]}),e.jsx("div",{className:"mt-4 h-24",children:d?e.jsx(Po,{values:d.sparkline,positive:h}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 text-sm",children:p?"Loading...":"No data"})})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-xl border border-gray-700/50 p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-200",children:"Watchlist"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:x,onChange:w=>l(w.target.value.toUpperCase()),placeholder:"Add symbol",className:"bg-gray-900 border border-gray-700 text-sm text-white rounded px-2 py-1 w-24"}),e.jsx("button",{onClick:()=>{x&&(o(x),r(x),l(""))},className:"p-1.5 rounded bg-blue-500/20 text-blue-300 hover:bg-blue-500/30",children:e.jsx(Kt,{size:14})})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(w=>{const k=i[w],O=k?k.change>=0:!0;return e.jsx("button",{onClick:()=>r(w),className:`px-3 py-1.5 rounded-lg border text-sm transition-colors ${w===a?"border-blue-500/40 bg-blue-500/10 text-blue-200":"border-gray-700 text-gray-300 hover:border-blue-500/40"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:w}),k&&e.jsxs("span",{className:O?"text-green-400":"text-red-400",children:[O?"+":"",k.changePercent.toFixed(1),"%"]})]})},w)})})]}),d&&e.jsxs("div",{className:"bg-gray-800/50 rounded-xl border border-gray-700/50 p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-200",children:"Sentiment"}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${d.sentiment==="bullish"?"bg-green-500/20 text-green-300":d.sentiment==="bearish"?"bg-red-500/20 text-red-300":"bg-gray-700 text-gray-300"}`,children:d.sentiment})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm text-gray-300",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Price"}),e.jsxs("div",{className:"text-lg font-semibold text-white",children:["$",d.price.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Volume"}),e.jsx("div",{children:d.volume?.toLocaleString()||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Prev Close"}),e.jsxs("div",{children:["$",d.previousClose?.toFixed(2)??"—"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Updated"}),e.jsx("div",{children:new Date(d.updatedAt).toLocaleTimeString()})]})]})]}),m&&e.jsx("div",{className:"text-sm text-red-400",children:m})]})]})]})}function Po({values:t,positive:s}){const a=Math.max(...t),r=Math.min(...t),n=a-r||1;return e.jsx("div",{className:"h-full w-full flex items-end gap-[2px]",children:t.map((o,i)=>{const u=(o-r)/n*100;return e.jsx("div",{className:`flex-1 rounded-sm ${s?"bg-green-500/60":"bg-red-500/60"}`,style:{height:`${u}%`}},i)})})}function Ao({onAccept:t,onDecline:s}){const[a,r]=c.useState(!1),[n,o]=c.useState(null),[i,u]=c.useState(!1),p=te.useRef(!1);c.useEffect(()=>{if(!p.current){p.current=!0;try{const l=localStorage.getItem("regen:tos:accepted");if(l)try{const d=JSON.parse(l);if(d.version==="2025-12-17"&&d.accepted){o(d.version),typeof t=="function"&&setTimeout(()=>{t()},0);return}}catch{}}catch(l){console.error("[TermsAcceptance] Error checking acceptance status:",l)}}},[]);const b=l=>{},m=()=>{typeof t=="function"&&Promise.resolve().then(()=>{t()})},y=()=>{if(!i){console.warn("[TermsAcceptance] Accept called but terms not checked");return}console.log("[TermsAcceptance] Accept button clicked");try{const l={version:"2025-12-17",accepted:!0,timestamp:Date.now()};localStorage.setItem("regen:tos:accepted",JSON.stringify(l)),console.log("[TermsAcceptance] Acceptance saved to localStorage"),o("2025-12-17"),console.log("[TermsAcceptance] acceptedVersion state updated"),m()}catch(l){console.error("[TermsAcceptance] Failed to save acceptance:",l),o("2025-12-17"),m()}},x=()=>{try{localStorage.removeItem("regen:tos:accepted")}catch(l){console.error("[TermsAcceptance] Failed to clear acceptance:",l)}typeof s=="function"&&s()};return n?(console.log("[TermsAcceptance] Component hidden - already accepted version:",n),null):e.jsx(ee,{mode:"wait",children:e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[10002] bg-gray-900/95 backdrop-blur-sm flex items-center justify-center p-4",style:{pointerEvents:"auto"},onMouseDown:l=>{const d=l.target;d.closest("button")||d.closest('[role="button"]')||d.closest("a")},onClick:l=>{const d=l.target;d.closest("button")||d.closest('[role="button"]')||d.closest("a")},children:e.jsxs(_.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-gray-800 border border-gray-700 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col",onMouseDown:l=>{const d=l.target;d.closest("button")||d.closest('[role="button"]')||d.closest("a")},onClick:l=>{const d=l.target;d.closest("button")||d.closest('[role="button"]')||d.closest("a")||l.stopPropagation()},children:[e.jsxs("div",{className:"flex items-center gap-3 p-6 border-b border-gray-700",children:[e.jsx("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:e.jsx(ge,{size:24,className:"text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-100",children:"Terms of Service"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Please read and accept our Terms of Service to continue"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 text-sm text-gray-300 leading-relaxed",onScroll:b,children:a?e.jsxs("div",{className:"prose prose-invert prose-sm max-w-none",children:[e.jsx("p",{className:"text-gray-400 mb-4",children:e.jsx("strong",{children:"Last Updated: December 17, 2025"})}),e.jsxs("section",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"1. Acceptance of Terms"}),e.jsx("p",{children:"By downloading, installing, accessing, or using Regen, you agree to be bound by these Terms of Service. If you do not agree to these Terms, do not use the Software."})]}),e.jsxs("section",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"2. Description of Service"}),e.jsx("p",{children:"Regen is a privacy-first, agentic research browser that provides multi-mode browsing, privacy features (Tor, VPN, Shields, Ghost Mode), AI-powered content processing, and knowledge graph tracking."})]}),e.jsxs("section",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"3. Privacy and Data"}),e.jsx("p",{className:"mb-2",children:"Regen stores data locally on your device by default. When using Ghost Mode (Tor Browser integration), all data is stored in ephemeral sessions with no persistence."}),e.jsx("p",{children:"You may export your data at any time using the GDPR data export feature in Settings."})]}),e.jsxs("section",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"4. Acceptable Use"}),e.jsx("p",{className:"mb-2",children:"You agree NOT to use Regen to:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-gray-400 ml-4",children:[e.jsx("li",{children:"Violate any applicable laws or regulations"}),e.jsx("li",{children:"Infringe on intellectual property rights"}),e.jsx("li",{children:"Transmit malicious code or harmful content"}),e.jsx("li",{children:"Engage in illegal activities"}),e.jsx("li",{children:"Attempt to reverse engineer the Software"})]})]}),e.jsxs("section",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"5. Disclaimers"}),e.jsx("p",{className:"mb-2",children:'THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND. We do not guarantee that the Software will be available at all times, free from errors, or secure from all threats.'}),e.jsx("p",{children:'AI-generated content is provided "as-is" and may contain errors. Always verify important information from primary sources.'})]}),e.jsxs("section",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-3",children:"6. Open Source"}),e.jsxs("p",{children:["Regen is open-source software licensed under the MIT License. The source code is available at"," ",e.jsxs("a",{href:"https://github.com/nrbns/Omnibrowser",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 underline inline-flex items-center gap-1",children:["GitHub",e.jsx(ht,{size:12})]})]})]}),e.jsx("div",{className:"mt-8 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-200",children:[e.jsx("strong",{children:"Note:"})," This is a summary. The full Terms of Service are available in"," ",e.jsx("code",{className:"bg-gray-900/50 px-2 py-1 rounded text-xs",children:"TERMS_OF_SERVICE.md"})," ","or"," ",e.jsxs("a",{href:"https://github.com/nrbns/Omnibrowser/blob/main/TERMS_OF_SERVICE.md",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 underline inline-flex items-center gap-1",children:["view online",e.jsx(ht,{size:12})]})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gray-900/50 rounded-lg border border-gray-700",children:[e.jsx("h3",{className:"font-semibold text-gray-100 mb-2",children:"Key Points:"}),e.jsxs("ul",{className:"space-y-2 text-gray-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Ee,{size:16,className:"text-green-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Regen is open-source (MIT License)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Ee,{size:16,className:"text-green-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Data is stored locally on your device"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Ee,{size:16,className:"text-green-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Ghost Mode provides maximum privacy (ephemeral sessions)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Ee,{size:16,className:"text-green-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"You can export your data at any time"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Ee,{size:16,className:"text-green-400 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:'AI content is provided "as-is" - verify important information'})]})]})]}),e.jsxs("button",{type:"button",onClick:l=>{l.preventDefault(),l.stopImmediatePropagation(),l.stopPropagation(),r(!0)},onMouseDown:l=>{l.preventDefault(),l.stopImmediatePropagation(),l.stopPropagation(),r(!0)},onPointerDown:l=>{l.preventDefault(),l.stopImmediatePropagation(),l.stopPropagation(),r(!0)},className:"w-full px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm text-gray-200 transition-colors flex items-center justify-center gap-2 cursor-pointer active:scale-95",style:{pointerEvents:"auto",cursor:"pointer",zIndex:10010,position:"relative",isolation:"isolate",touchAction:"manipulation"},children:[e.jsx(ge,{size:16}),e.jsx("span",{children:"Read Full Terms of Service"})]})]})}),e.jsx("div",{className:"flex items-center justify-between p-6 border-t border-gray-700 gap-4",children:e.jsxs("div",{className:"flex flex-col gap-3 flex-1",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:l=>{l.stopPropagation(),u(l.target.checked)},onClick:l=>{l.stopPropagation()},className:"mt-1 h-4 w-4 rounded border-gray-600 bg-gray-800 text-blue-500 focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-2 focus:ring-offset-gray-900 cursor-pointer",style:{pointerEvents:"auto",zIndex:10011,position:"relative"}}),e.jsx("span",{className:"text-sm text-gray-300 group-hover:text-gray-200",children:"I have read and agree to the Terms of Service"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:l=>{l.preventDefault(),l.stopImmediatePropagation(),l.stopPropagation(),x()},onMouseDown:l=>{l.preventDefault(),l.stopImmediatePropagation(),l.stopPropagation(),x()},onPointerDown:l=>{l.preventDefault(),l.stopImmediatePropagation(),l.stopPropagation(),x()},className:"px-6 py-2.5 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm font-medium text-gray-200 transition-colors flex items-center gap-2 cursor-pointer active:scale-95",style:{pointerEvents:"auto",cursor:"pointer",zIndex:10010,position:"relative",isolation:"isolate",touchAction:"manipulation"},children:[e.jsx(oe,{size:16}),e.jsx("span",{children:"Decline"})]}),e.jsxs("button",{type:"button",disabled:!i,onClick:l=>{if(!i){l.preventDefault(),l.stopPropagation();return}console.log("[TermsAcceptance] Accept button onClick triggered"),l.preventDefault(),l.stopPropagation(),y()},onMouseDown:l=>{if(!i){l.preventDefault(),l.stopPropagation();return}console.log("[TermsAcceptance] Accept button onMouseDown triggered"),l.preventDefault(),l.stopPropagation()},onPointerDown:l=>{if(!i){l.preventDefault(),l.stopPropagation();return}console.log("[TermsAcceptance] Accept button onPointerDown triggered"),l.preventDefault(),l.stopPropagation()},className:`px-6 py-2.5 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 active:scale-95 ${i?"bg-blue-600 hover:bg-blue-700 text-white cursor-pointer":"bg-gray-700 text-gray-400 cursor-not-allowed opacity-50"}`,style:{pointerEvents:"auto",cursor:i?"pointer":"not-allowed",zIndex:10010,position:"relative",isolation:"isolate",touchAction:"manipulation"},children:[e.jsx(Ee,{size:16}),e.jsx("span",{children:"Accept"})]})]})]})})]})},"terms-acceptance-modal")})}const st="2025-12-17";function _o({onAccept:t,onDecline:s,showSettings:a=!1}){const[r,n]=c.useState({essential:!0,analytics:!1,functional:!1,advertising:!1,timestamp:Date.now(),version:st}),[o,i]=c.useState(a),[u,p]=c.useState(!1);c.useEffect(()=>{try{const d=localStorage.getItem("regen:cookie-consent");if(d){const h=JSON.parse(d);h.version===st&&(n(h),p(!0))}}catch{}},[]);const b=()=>{const d={essential:!0,analytics:!0,functional:!0,advertising:!0,timestamp:Date.now(),version:st};n(d),p(!0),t(d)},m=()=>{p(!0),t(r)},y=()=>{const d={essential:!0,analytics:!1,functional:!1,advertising:!1,timestamp:Date.now(),version:st};n(d),p(!0),t(d),s?.()},x=d=>{d!=="essential"&&n(h=>({...h,[d]:!h[d]}))},l=[{id:"essential",name:"Essential Cookies",description:"Required for the app to function. These cannot be disabled.",required:!0,examples:["Session management","Security","Authentication"]},{id:"analytics",name:"Analytics Cookies",description:"Help us understand how you use Regen to improve the experience.",required:!1,examples:["Usage statistics","Performance metrics","Error tracking"]},{id:"functional",name:"Functional Cookies",description:"Enable enhanced features and personalization.",required:!1,examples:["Preferences","Settings","Theme selection"]},{id:"advertising",name:"Advertising Cookies",description:"Used for personalized ads (currently not used in Regen).",required:!1,examples:["Ad personalization","Ad targeting"]}];return u&&!a&&r.essential?null:e.jsx(ee,{children:e.jsx(_.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},className:"fixed bottom-0 left-0 right-0 z-[10001] p-4",style:{pointerEvents:"auto"},children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs(_.div,{initial:{scale:.95},animate:{scale:1},className:"bg-gray-800 border border-gray-700 rounded-xl shadow-2xl overflow-hidden",onClick:d=>{const h=d.target;h.closest("button")||h.closest('[role="button"]')||h.closest("a")||d.stopPropagation()},onMouseDown:d=>{const h=d.target;h.closest("button")||h.closest('[role="button"]')||h.closest("a")},children:[e.jsxs("div",{className:"flex items-center gap-3 p-6 border-b border-gray-700",children:[e.jsx("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:e.jsx(er,{size:24,className:"text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-100",children:"Cookie Preferences"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"We use cookies to enhance your browsing experience and analyze usage."})]}),a&&e.jsx("button",{type:"button",onClick:d=>{d.preventDefault(),d.stopImmediatePropagation(),d.stopPropagation(),i(!1)},onMouseDown:d=>{d.preventDefault(),d.stopImmediatePropagation(),d.stopPropagation()},className:"p-2 hover:bg-gray-700 rounded-lg transition-colors","aria-label":"Close",style:{pointerEvents:"auto",cursor:"pointer",zIndex:10011,isolation:"isolate"},children:e.jsx(oe,{size:20,className:"text-gray-400"})})]}),e.jsx("div",{className:"p-6 max-h-[60vh] overflow-y-auto",children:o?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ms,{size:16,className:"text-blue-400 mt-0.5 flex-shrink-0"}),e.jsxs("p",{className:"text-sm text-blue-200",children:[e.jsx("strong",{children:"Your Privacy Matters:"})," Regen stores data locally on your device by default. Cookies and similar technologies are used only for essential functionality and optional analytics. You can change these preferences at any time in Settings."]})]})}),l.map(d=>e.jsx("div",{className:`p-4 rounded-lg border ${r[d.id]?"bg-green-500/10 border-green-500/30":"bg-gray-900/50 border-gray-700"}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-100",children:d.name}),d.required&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-700 text-gray-300 rounded",children:"Required"})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-2",children:d.description}),e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("strong",{children:"Examples:"})," ",d.examples.join(", ")]})]}),e.jsx("div",{className:"flex items-center gap-2",children:d.required?e.jsx("div",{className:"px-3 py-1.5 bg-gray-700 text-gray-300 rounded text-sm font-medium",children:"Always On"}):e.jsx("button",{type:"button",onClick:h=>{h.preventDefault(),h.stopImmediatePropagation(),h.stopPropagation(),x(d.id)},onMouseDown:h=>{h.preventDefault(),h.stopImmediatePropagation(),h.stopPropagation()},className:`px-3 py-1.5 rounded text-sm font-medium transition-colors ${r[d.id]?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-700 hover:bg-gray-600 text-gray-300"}`,style:{pointerEvents:"auto",cursor:"pointer",zIndex:10011,isolation:"isolate"},children:r[d.id]?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ee,{size:14}),"Enabled"]}):"Disabled"})})]})},d.id)),e.jsx("div",{className:"p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ht,{size:16,className:"text-yellow-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-yellow-200",children:[e.jsx("strong",{children:"Note:"})," Disabling non-essential cookies may limit some features. Essential cookies are required for the app to function properly."]})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"We use cookies to provide essential functionality and optional analytics. Your data is stored locally on your device by default."}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx(ms,{size:14}),e.jsx("span",{children:"You can customize cookie preferences or accept all cookies."})]})]})}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-700 gap-4 bg-gray-900/50",children:[e.jsxs("button",{type:"button",onClick:d=>{d.preventDefault(),d.stopImmediatePropagation(),d.stopPropagation(),i(!o)},onMouseDown:d=>{d.preventDefault(),d.stopImmediatePropagation(),d.stopPropagation()},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm font-medium text-gray-200 transition-colors flex items-center gap-2",style:{pointerEvents:"auto",cursor:"pointer",zIndex:10011,isolation:"isolate"},children:[e.jsx(ea,{size:16}),e.jsx("span",{children:o?"Hide Details":"Customize"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:d=>{d.preventDefault(),d.stopImmediatePropagation(),d.stopPropagation(),y()},onMouseDown:d=>{d.preventDefault(),d.stopImmediatePropagation(),d.stopPropagation()},className:"px-6 py-2.5 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm font-medium text-gray-200 transition-colors",style:{pointerEvents:"auto",cursor:"pointer",zIndex:10011,isolation:"isolate"},children:"Accept Essential Only"}),o?e.jsxs("button",{type:"button",onClick:d=>{d.preventDefault(),d.stopImmediatePropagation(),d.stopPropagation(),m()},onMouseDown:d=>{d.preventDefault(),d.stopImmediatePropagation(),d.stopPropagation()},className:"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium text-white transition-colors flex items-center gap-2",style:{pointerEvents:"auto",cursor:"pointer",zIndex:10011,isolation:"isolate"},children:[e.jsx(Ee,{size:16}),e.jsx("span",{children:"Save Preferences"})]}):e.jsxs("button",{type:"button",onClick:d=>{d.preventDefault(),d.stopImmediatePropagation(),d.stopPropagation(),b()},onMouseDown:d=>{d.preventDefault(),d.stopImmediatePropagation(),d.stopPropagation()},className:"px-6 py-2.5 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium text-white transition-colors flex items-center gap-2",style:{pointerEvents:"auto",cursor:"pointer",zIndex:10011,isolation:"isolate"},children:[e.jsx(Ee,{size:16}),e.jsx("span",{children:"Accept All"})]})]})]})]})})})})}function Ro(){const[t,s]=c.useState(!1),[a,r]=c.useState(null),[n,o]=c.useState(!1);return c.useEffect(()=>{try{const i=localStorage.getItem("regen:cookie-consent");if(i){const u=JSON.parse(i);if(u.version===st){r(u),s(!0);return}}o(!0)}catch{o(!0)}},[]),{hasConsented:t,preferences:a,showConsent:()=>o(!0)}}const Lt="regen:onboarding:completed",Ye={isCompleted(){try{return window.localStorage.getItem(Lt)==="1"}catch{return!1}},setCompleted(){try{window.localStorage.setItem(Lt,"1")}catch{}},clear(){try{window.localStorage.removeItem(Lt)}catch{}}},nt=De(t=>({visible:typeof window<"u"&&!Ye.isCompleted(),start:()=>{t({visible:!0})},finish:()=>{Ye.setCompleted(),t({visible:!1})},reset:()=>{Ye.clear(),t({visible:!0})}}));typeof window<"u"&&(window.__STORE={...window.__STORE,onboarding:nt});function zo(t){return typeof navigator>"u"?t.ctrlKey:navigator.userAgent.includes("Mac")?t.metaKey:t.ctrlKey}function Do(){const t=Q(r=>r.setMode),s=Q(r=>r.setResearchPaneOpen),a=nt(r=>r.start);c.useEffect(()=>{const r=n=>{if(!zo(n))return;const o=n.key.toLowerCase();if(n.shiftKey&&o==="r"){n.preventDefault(),t("Research"),s(!0),A.success("Research agent ready — type your prompt.");return}if(n.shiftKey&&o==="s"){n.preventDefault(),Er().catch(()=>{});return}n.shiftKey&&(o==="/"||o==="?")&&(n.preventDefault(),a(),A.info("Launching Research tour…"))};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[t,s,a])}function Lo(){return e.jsx(tr,{position:"bottom-right",toastOptions:{duration:4e3,style:{background:"#1e293b",color:"#e2e8f0",border:"1px solid #334155",borderRadius:"0.75rem",padding:"12px 16px",fontSize:"14px",maxWidth:"400px"},success:{duration:4e3,style:{color:"#10b981"},iconTheme:{primary:"#10b981",secondary:"#1e293b"}},error:{duration:5e3,style:{color:"#ef4444"},iconTheme:{primary:"#ef4444",secondary:"#1e293b"}},loading:{duration:1/0,style:{color:"#e2e8f0"}}}})}const Oo=t=>t&&typeof t=="object"&&"id"in t?String(t.id):typeof t=="string"?t:`tab-${Date.now()}`;async function $o(t){const s=K.getState(),a=t??s.popRecentlyClosed();if(!a)return se("info","No recently closed tabs to reopen."),!1;t&&s.removeRecentlyClosed(t.closedId);try{const r=await E.tabs.create({url:a.url||"about:blank",containerId:a.containerId||void 0}),n=Oo(r);return setTimeout(()=>{const o=K.getState();o.updateTab(n,{appMode:a.appMode,containerId:a.containerId,containerName:a.containerName,containerColor:a.containerColor,mode:a.mode,title:a.title||o.tabs.find(i=>i.id===n)?.title,url:a.url}),o.setActive(n)},75),se("success",`Reopened ${a.title||a.url||"tab"}`),!0}catch(r){return console.error("Failed to reopen closed tab:",r),s.pushRecentlyClosed(a),se("error","Failed to reopen closed tab."),!1}}async function Fo(){return $o()}const pa="regen_trade_alerts_v1";function Bo(){try{const t=localStorage.getItem(pa);if(t){const s=JSON.parse(t),a=Date.now();return s.filter(r=>r.expiresAt>a)}}catch(t){pe.warn("[TradeAlertsCron] Failed to load alerts from storage:",t)}return[]}function Uo(t){try{localStorage.setItem(pa,JSON.stringify(t))}catch(s){pe.warn("[TradeAlertsCron] Failed to save alerts to storage:",s)}}function Ds(){const t=Bo(),s=Date.now(),a=t.filter(r=>r.expiresAt>s);Uo(a)}function Wo(){Ds(),setInterval(Ds,6e4),pe.info("[TradeAlertsCron] Initialized")}var qo=Object.defineProperty,Vo=(t,s,a)=>s in t?qo(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,Ko=(t,s,a)=>Vo(t,s+"",a);class Ho{constructor(){Ko(this,"extensions",new Map)}register(s){if(this.extensions.has(s.id)){pe.warn(`[ExtensionsAPI] Extension ${s.id} already registered`);return}this.extensions.set(s.id,s);const a={id:s.id,name:s.name||s.id,version:s.version||"1.0.0",description:`Extension: ${s.name||s.id}`,enabled:!0,onEnable:s.activate,onDisable:s.deactivate};Mr.register(a),pe.info(`[ExtensionsAPI] Registered extension: ${s.id}`)}list(){return Array.from(this.extensions.values()).map(s=>({id:s.id,name:s.name,version:s.version}))}get(s){return this.extensions.get(s)}async activate(s){const a=this.extensions.get(s);if(!a)return!1;if(a.activate)try{return await a.activate(),pe.info(`[ExtensionsAPI] Activated extension: ${s}`),!0}catch(r){return pe.error(`[ExtensionsAPI] Failed to activate extension ${s}:`,r),!1}return!0}async deactivate(s){const a=this.extensions.get(s);if(!a)return!1;if(a.deactivate)try{return await a.deactivate(),pe.info(`[ExtensionsAPI] Deactivated extension: ${s}`),!0}catch(r){return pe.error(`[ExtensionsAPI] Failed to deactivate extension ${s}:`,r),!1}return!0}}const Ls=new Ho;function Go(){if(!(typeof window>"u")){if(window.regenExtensions||(window.regenExtensions={register:t=>{Ls.register(t)},list:()=>Ls.list()}),typeof window.__regenExtensionsPreload=="function")try{window.__regenExtensionsPreload(window.regenExtensions)}catch(t){pe.warn("[ExtensionsAPI] Preload hook failed:",t)}pe.info("[ExtensionsAPI] Initialized window.regenExtensions")}}function Yo(){typeof window>"u"||(window.__regenExtensionsPreload=t=>{pe.info("[ExtensionsAPI] Preload hook called")})}function Jo(){const t=c.useCallback((r,n,o={})=>{const{showToUser:i=!0,logToConsole:u=!0,context:p={},fallback:b=null}=o;if(u&&console.error("[App Error]",r,{error:n,...p,timestamp:new Date().toISOString()}),i){const m=typeof r=="string"&&r.length>0?r:"An unexpected error occurred";A.error(m)}return b},[]),s=c.useCallback((r,n,o={})=>{const i=r instanceof Error?r.message:typeof r=="string"?r:"Unknown error occurred",u=n?`${n}: ${i}`:i;return t(u,r,o)},[t]),a=c.useCallback(async(r,n,o)=>{try{return await r()}catch(i){return s(i,o,{showToUser:!1,logToConsole:!0,fallback:n}),n}},[s]);return{showError:t,handleError:s,safeExecute:a}}function Qo({open:t,onClose:s}){const[a,r]=c.useState([]);c.useEffect(()=>{if(t){const i=Ws();r(i)}},[t]);const n=i=>{Ta(i.runId)?(Ie.success(`Resumed loop: ${i.goal.slice(0,50)}...`),s()):Ie.error("Failed to resume loop")},o=i=>{Ea(i),r(u=>u.filter(p=>p.runId!==i)),Ie.success("Deleted crashed loop")};return t?e.jsx(ee,{children:e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:s,className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),e.jsxs(_.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative bg-[#1A1D28] border border-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ht,{size:20,className:"text-yellow-400"}),e.jsxs("h2",{className:"text-lg font-semibold text-gray-100",children:["Crashed Loops (",a.length,")"]})]}),e.jsx("button",{onClick:s,className:"p-1.5 rounded-lg text-gray-400 hover:text-gray-100 hover:bg-gray-800/60 transition-colors",children:e.jsx(oe,{size:18})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:a.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx("p",{children:"No crashed loops found."}),e.jsx("p",{className:"text-sm mt-2",children:"All loops completed successfully."})]}):e.jsx("div",{className:"space-y-3",children:a.map(i=>e.jsx("div",{className:"bg-gray-900/60 rounded-lg p-4 border border-gray-800/50",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-400",children:[i.runId.slice(0,8),"..."]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${i.status==="live"?"bg-green-900/30 text-green-400":i.status==="error"?"bg-red-900/30 text-red-400":"bg-yellow-900/30 text-yellow-400"}`,children:i.status}),i.mode&&e.jsx("span",{className:"text-xs text-gray-500",children:i.mode})]}),e.jsx("h3",{className:"font-medium text-gray-200 mb-1 truncate",children:i.goal||"Untitled loop"}),i.transcript&&e.jsxs("p",{className:"text-xs text-gray-400 line-clamp-2 mb-2",children:[i.transcript.slice(0,150),"..."]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[i.events.length," events • Last saved"," ",new Date(i.lastSaved).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>n(i),className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium transition-colors flex items-center gap-1.5",children:[e.jsx(sr,{size:14}),"Resume"]}),e.jsx("button",{onClick:()=>o(i.runId),className:"p-1.5 text-gray-400 hover:text-red-400 hover:bg-gray-800/60 rounded-lg transition-colors",title:"Delete",children:e.jsx(oe,{size:16})})]})]})},i.runId))})}),e.jsxs("div",{className:"p-4 border-t border-gray-800 flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Loops are auto-saved every 5 seconds. Resume to continue where you left off."}),e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm font-medium transition-colors",children:"Close"})]})]})]})}):null}const Xo=[{id:"1",name:"Research to Trade Alert",description:"Automatically sends trading alerts when research finds market opportunities",author:"RegenBrowser",category:"automation",language:"auto",tags:["research","trade","alerts"],downloads:1250,rating:4.8,workflowId:"research-trade-alert",createdAt:Date.now()-864e5,updatedAt:Date.now()-36e5},{id:"2",name:"Multilingual Research Summary",description:"Summarizes research in any language and sends to email/Slack",author:"Community",category:"research",language:"auto",tags:["research","multilingual","summary"],downloads:890,rating:4.6,workflowId:"multilingual-research",createdAt:Date.now()-1728e5,updatedAt:Date.now()-72e5},{id:"3",name:"Nifty Monitor Loop",description:"Monitors Nifty index every 30s and alerts on significant changes",author:"RegenBrowser",category:"trade",language:"hi",tags:["nifty","monitoring","alerts"],downloads:2100,rating:4.9,workflowId:"nifty-monitor",createdAt:Date.now()-2592e5,updatedAt:Date.now()-18e5}];function Zo({open:t,onClose:s}){const[a]=c.useState(Xo),[r,n]=c.useState(""),[o,i]=c.useState("all"),[u,p]=c.useState("all"),[b,m]=c.useState(!1),y=a.filter(d=>{const h=!r||d.name.toLowerCase().includes(r.toLowerCase())||d.description.toLowerCase().includes(r.toLowerCase())||d.tags.some(O=>O.toLowerCase().includes(r.toLowerCase())),w=o==="all"||d.category===o,k=u==="all"||d.language===u||!d.language;return h&&w&&k}),x=async d=>{m(!0);try{if(d.workflowId){const h=await Ia({type:"install-workflow",data:{workflowId:d.workflowId,workflowUrl:d.workflowUrl||"http://localhost:5678"},sourceMode:"marketplace",targetMode:"n8n"},d.language||"auto");h.success?Ie.success(`Installed workflow: ${d.name}`):Ie.error(h.error||"Failed to install workflow")}else Ie.error("Workflow ID not available")}catch(h){Ie.error(`Installation failed: ${h.message}`)}finally{m(!1)}},l=[{value:"all",label:"All Categories"},{value:"automation",label:"Automation"},{value:"research",label:"Research"},{value:"trade",label:"Trade"},{value:"productivity",label:"Productivity"},{value:"integration",label:"Integration"}];return t?e.jsx(ee,{children:e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:s,className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),e.jsxs(_.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative bg-[#1A1D28] border border-gray-800 rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ar,{size:24,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-100",children:"Workflow Marketplace"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Browse and install n8n workflows"})]})]}),e.jsx("button",{onClick:s,className:"p-1.5 rounded-lg text-gray-400 hover:text-gray-100 hover:bg-gray-800/60 transition-colors",children:e.jsx(oe,{size:20})})]}),e.jsxs("div",{className:"p-4 border-b border-gray-800 space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:r,onChange:d=>n(d.target.value),placeholder:"Search workflows...",className:"w-full pl-10 pr-4 py-2 bg-gray-900/60 border border-gray-700/50 rounded-lg text-sm text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("select",{value:o,onChange:d=>i(d.target.value),className:"px-3 py-1.5 bg-gray-900/60 border border-gray-700/50 rounded-lg text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:l.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))}),e.jsxs("select",{value:u,onChange:d=>p(d.target.value),className:"px-3 py-1.5 bg-gray-900/60 border border-gray-700/50 rounded-lg text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"all",children:"All Languages"}),e.jsx("option",{value:"auto",children:"Auto-detect"}),e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"hi",children:"Hindi"}),e.jsx("option",{value:"ta",children:"Tamil"}),e.jsx("option",{value:"bn",children:"Bengali"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:y.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx("p",{children:"No workflows found."}),e.jsx("p",{className:"text-sm mt-2",children:"Try adjusting your search or filters."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:y.map(d=>e.jsxs(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-gray-900/60 rounded-lg p-4 border border-gray-800/50 hover:border-gray-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-100 mb-1",children:d.name}),e.jsx("p",{className:"text-sm text-gray-400 line-clamp-2",children:d.description})]}),e.jsxs("div",{className:"flex items-center gap-1 text-yellow-400 ml-2",children:[e.jsx(Xs,{size:14,className:"fill-current"}),e.jsx("span",{className:"text-xs",children:d.rating})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 bg-blue-900/30 text-blue-400 rounded",children:d.category}),d.language&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-green-900/30 text-green-400 rounded",children:d.language}),e.jsxs("span",{className:"text-xs text-gray-500",children:[d.downloads," downloads"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>x(d),disabled:b,className:"flex-1 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-700 disabled:cursor-not-allowed rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1.5",children:[e.jsx(gt,{size:14}),"Install"]}),e.jsx("button",{onClick:()=>{const h=`https://github.com/regenbrowser/workflows/tree/main/${d.workflowId||d.id}`;navigator.share?navigator.share({title:`Share ${d.name}`,text:d.description,url:h}).catch(()=>{navigator.clipboard.writeText(h),Ie.success("Workflow link copied to clipboard!")}):(navigator.clipboard.writeText(h),Ie.success("Workflow link copied to clipboard!"))},className:"px-3 py-1.5 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm transition-colors",title:"Share workflow (Earn affiliates)",children:e.jsx(rr,{size:14})})]})]},d.id))})}),e.jsxs("div",{className:"p-4 border-t border-gray-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Workflows run on your local n8n instance. Install n8n to use workflows."}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Share n8n workflows – Earn affiliates"," ",e.jsx("a",{href:"https://github.com/regenbrowser/workflows",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 underline",children:"GitHub repo"})]})]}),e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm font-medium transition-colors",children:"Close"})]})]})]})}):null}const ei=[{id:"Browse",label:"Browse",icon:qt},{id:"Research",label:"Research",icon:nr},{id:"Trade",label:"Trade",icon:or}];function ti({activeMode:t,onSelectMode:s,onOpenLibrary:a,onOpenAgent:r}){return e.jsx(_.nav,{initial:{y:120,opacity:0},animate:{y:0,opacity:1},exit:{y:120,opacity:0},transition:{type:"spring",stiffness:260,damping:30},className:"fixed inset-x-0 bottom-0 z-[65] px-4 pb-[calc(env(safe-area-inset-bottom)+16px)] pt-3",children:e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-slate-800/70 bg-slate-950/95 p-2 shadow-2xl shadow-black/40 backdrop-blur-xl",children:[ei.map(n=>{const o=n.icon,i=n.id===t;return e.jsxs("button",{type:"button",onClick:()=>s(n.id),className:`flex flex-1 flex-col items-center gap-1 rounded-xl px-2 py-1 text-[11px] font-semibold transition ${i?"bg-emerald-500/10 text-emerald-300":"text-slate-400 hover:text-slate-100"}`,"aria-pressed":i,children:[e.jsx(o,{size:20}),e.jsx("span",{children:n.label})]},n.id)}),e.jsxs("button",{type:"button",onClick:a,className:"flex flex-col items-center gap-1 rounded-xl px-2 py-1 text-[11px] font-semibold text-slate-400 transition hover:text-slate-100",children:[e.jsx(ir,{size:20}),e.jsx("span",{children:"Library"})]}),e.jsxs("button",{type:"button",onClick:r,className:"flex flex-col items-center gap-1 rounded-xl px-2 py-1 text-[11px] font-semibold text-slate-400 transition hover:text-slate-100",children:[e.jsx(lr,{size:20}),e.jsx("span",{children:"Agent"})]})]})})}const Ot={windows:"https://ollama.com/download/windows",macos:"https://ollama.com/download/mac",linux:"https://ollama.com/download/linux"},fa=["phi3:mini","llava:7b"];async function Os(){try{if(typeof window<"u"&&window.ipc){const t=window.ipc;if(t.system&&typeof t.system.checkCommand=="function")return(await t.system.checkCommand("ollama"))?.installed===!0}try{return(await fetch("http://localhost:11434/api/tags",{method:"GET"})).ok}catch{return!1}}catch{return!1}}async function si(){try{const t=await fetch("http://localhost:11434/api/tags");return t.ok?((await t.json()).models||[]).map(a=>a.name):[]}catch{return[]}}function ai(){const t=navigator.platform.toLowerCase();return t.includes("win")?Ot.windows:t.includes("mac")?Ot.macos:Ot.linux}async function ri(t){const s=ai();t({stage:"downloading",progress:0,message:"Downloading Ollama installer..."});try{if(typeof window<"u"&&window.ipc){const i=window.ipc;if(i.system&&typeof i.system.downloadFile=="function")return(await i.system.downloadFile(s,{onProgress:p=>{t({stage:"downloading",progress:p,message:`Downloading Ollama... ${Math.round(p)}%`})}}))?.path||""}const a=await fetch(s);if(!a.ok)throw new Error("Failed to download Ollama");const r=await a.blob(),n=window.URL.createObjectURL(r),o=document.createElement("a");return o.href=n,o.download="ollama-installer",o.click(),t({stage:"downloading",progress:100,message:"Download complete. Please run the installer."}),n}catch(a){throw console.error("[Installer] Download failed:",a),a}}async function ni(t,s){s({stage:"installing",progress:0,message:"Installing Ollama..."});try{if(typeof window<"u"&&window.ipc){const a=window.ipc;if(a.system&&typeof a.system.runInstaller=="function"){await a.system.runInstaller(t,{silent:!0,onProgress:r=>{s({stage:"installing",progress:r,message:`Installing Ollama... ${Math.round(r)}%`})}});return}}s({stage:"installing",progress:50,message:"Please complete the Ollama installation in the opened window..."}),A.info("Please complete the Ollama installation, then return here.")}catch(a){throw console.error("[Installer] Installation failed:",a),a}}async function oi(t,s){s({stage:"pulling_models",progress:0,message:`Downloading ${t}...`,modelProgress:{model:t,progress:0}});try{const a=await fetch("http://localhost:11434/api/pull",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,stream:!0})});if(!a.ok)throw new Error(`Failed to pull ${t}`);const r=a.body?.getReader(),n=new TextDecoder;if(!r)throw new Error("No response body");let o="";for(;;){const{done:i,value:u}=await r.read();if(i)break;o+=n.decode(u,{stream:!0});const p=o.split(`
`);o=p.pop()||"";for(const b of p)if(b.trim())try{const m=JSON.parse(b);if(m.completed){s({stage:"pulling_models",progress:100,message:`${t} downloaded successfully`,modelProgress:{model:t,progress:100}});break}if(m.total&&m.completed!==void 0){const y=m.completed/m.total*100;s({stage:"pulling_models",progress:y/fa.length*100,message:`Downloading ${t}... ${Math.round(y)}%`,modelProgress:{model:t,progress:y}})}}catch{}}}catch(a){throw console.error(`[Installer] Failed to pull ${t}:`,a),a}}async function ii(t){try{if(t({stage:"checking",progress:0,message:"Checking Ollama installation..."}),await Os())t({stage:"pulling_models",progress:0,message:"Ollama already installed. Checking models..."});else{const n=await ri(t);await ni(n,t),t({stage:"checking",progress:90,message:"Waiting for Ollama to start..."});let o=30;for(;o>0&&!await Os();)await new Promise(i=>setTimeout(i,1e3)),o--;if(o===0)throw new Error("Ollama did not start. Please restart the app.")}const a=await si(),r=fa.filter(n=>!a.includes(n));if(r.length===0){t({stage:"complete",progress:100,message:"All models already installed!"});return}for(let n=0;n<r.length;n++){const o=r[n];await oi(o,t)}t({stage:"complete",progress:100,message:"Installation complete! Your AI brain is ready."})}catch(s){throw console.error("[Installer] Installation failed:",s),t({stage:"error",progress:0,message:`Installation failed: ${s instanceof Error?s.message:"Unknown error"}`}),s}}function li({onComplete:t,onError:s}){const[a,r]=c.useState({stage:"checking",progress:0,message:"Initializing..."}),[n,o]=c.useState(!0);c.useEffect(()=>{let p=!1;return(async()=>{try{await ii(m=>{p||(r(m),m.stage==="complete"?(o(!1),setTimeout(()=>{t()},2e3)):m.stage==="error"&&(o(!1),s(new Error(m.message))))})}catch(m){p||(o(!1),s(m instanceof Error?m:new Error("Installation failed")))}})(),()=>{p=!0}},[t,s]);const i=()=>{switch(a.stage){case"complete":return e.jsx(ps,{className:"w-16 h-16 text-emerald-400"});case"error":return e.jsx(Ht,{className:"w-16 h-16 text-red-400"});default:return e.jsx(ot,{className:"w-16 h-16 text-purple-400 animate-spin"})}},u=()=>{switch(a.stage){case"complete":return"from-emerald-500 to-teal-600";case"error":return"from-red-500 to-rose-600";default:return"from-purple-500 to-pink-600"}};return e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/90 backdrop-blur-sm",children:e.jsxs(_.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-slate-900 border border-purple-600/50 rounded-3xl p-12 max-w-2xl w-full mx-4 shadow-2xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"flex justify-center mb-4",children:i()}),e.jsx("h2",{className:"text-3xl font-bold text-white mb-2",children:a.stage==="complete"?"Your AI Brain is Ready! 🧠":a.stage==="error"?"Installation Failed":"Downloading Your AI Brain..."}),e.jsx("p",{className:"text-gray-400 text-lg",children:a.message})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:a.stage==="pulling_models"&&a.modelProgress?`${a.modelProgress.model}: ${Math.round(a.modelProgress.progress)}%`:`${Math.round(a.progress)}%`}),e.jsxs("span",{className:"text-sm text-gray-400",children:[a.stage==="checking"&&"Step 1/4",a.stage==="downloading"&&"Step 2/4",a.stage==="installing"&&"Step 3/4",a.stage==="pulling_models"&&"Step 4/4",a.stage==="complete"&&"Complete!"]})]}),e.jsx("div",{className:"h-4 bg-slate-800 rounded-full overflow-hidden",children:e.jsx(_.div,{className:`h-full bg-gradient-to-r ${u()} shadow-lg`,initial:{width:0},animate:{width:`${a.progress}%`},transition:{duration:.3,ease:"easeOut"}})})]}),e.jsx(ee,{mode:"wait",children:e.jsxs(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"space-y-2",children:[a.stage==="checking"&&e.jsx("div",{className:"text-center text-gray-300",children:e.jsx("p",{className:"text-sm",children:"Checking if Ollama is installed..."})}),a.stage==="downloading"&&e.jsxs("div",{className:"text-center text-gray-300",children:[e.jsx("p",{className:"text-sm",children:"Downloading Ollama installer..."}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This may take a few minutes"})]}),a.stage==="installing"&&e.jsxs("div",{className:"text-center text-gray-300",children:[e.jsx("p",{className:"text-sm",children:"Installing Ollama..."}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Please wait while we set up your AI engine"})]}),a.stage==="pulling_models"&&a.modelProgress&&e.jsxs("div",{className:"text-center text-gray-300",children:[e.jsx("p",{className:"text-sm font-medium",children:a.modelProgress.model}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:a.modelProgress.progress<100?"Downloading model weights...":"Model ready!"})]}),a.stage==="complete"&&e.jsx(_.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-emerald-400 mb-4",children:[e.jsx(xe,{className:"w-5 h-5"}),e.jsx("p",{className:"text-lg font-semibold",children:"All set! Starting Regen..."})]})}),a.stage==="error"&&e.jsxs("div",{className:"text-center text-red-400",children:[e.jsx("p",{className:"text-sm",children:a.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"You can try installing Ollama manually from ollama.com"})]})]},a.stage)}),a.stage==="pulling_models"&&e.jsxs("div",{className:"mt-6 space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-2",children:"Models"}),["phi3:mini","llava:7b"].map(p=>{const b=a.modelProgress?.model===p&&a.modelProgress.progress===100,m=a.modelProgress?.model===p;return e.jsxs("div",{className:`flex items-center gap-3 p-2 rounded-lg ${m?"bg-purple-500/20 border border-purple-500/50":"bg-slate-800/50"}`,children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-gray-300",children:p})}),b&&e.jsx(ps,{className:"w-4 h-4 text-emerald-400"}),m&&!b&&e.jsx(ot,{className:"w-4 h-4 text-purple-400 animate-spin"})]},p)})]})]})})}async function ci(t){const s={};t.type&&t.type!=="all"&&(s.type=t.type),t.status&&t.status!=="all"&&(t.status==="pending"?s.approved=!1:(t.status==="approved"||t.status==="revoked")&&(s.approved=!0));const a=await E.consent.list(Object.keys(s).length>0?s:void 0);if(!Array.isArray(a))return[];let r=a;return t.status==="pending"?r=r.filter(n=>!n.approved):t.status==="approved"?r=r.filter(n=>n.approved&&!n.revokedAt):t.status==="revoked"&&(r=r.filter(n=>!!n.revokedAt)),r.sort((n,o)=>o.timestamp-n.timestamp)}const di=De((t,s)=>({visible:!1,loading:!1,error:null,filter:{type:"all",status:"all"},records:[],async open(){s().visible||t({visible:!0}),await s().refresh()},close(){t({visible:!1})},async toggle(){s().visible?t({visible:!1}):(t({visible:!0}),await s().refresh())},async refresh(){t({loading:!0,error:null});try{const a=await ci(s().filter);t({records:a,loading:!1,error:null})}catch(a){t({loading:!1,error:a instanceof Error?a.message:String(a)})}},async setFilter(a){t(r=>({filter:{...r.filter,...a}})),await s().refresh()},async approve(a){await E.consent.approve(a),await s().refresh()},async revoke(a){await E.consent.revoke(a),await s().refresh()}}));var ui=Object.defineProperty,mi=(t,s,a)=>s in t?ui(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,$t=(t,s,a)=>mi(t,typeof s!="symbol"?s+"":s,a);const $s=()=>new Promise(t=>setTimeout(()=>L(()=>Promise.resolve().then(()=>Pn),void 0).then(s=>s.initializeOptimizer()).then(t),2e3)),pi=()=>new Promise(t=>setTimeout(()=>L(()=>Promise.resolve().then(()=>On),void 0).then(s=>s.startTabSuspensionService()).then(t),2e3)),fi=()=>new Promise(t=>setTimeout(()=>L(()=>import("./battery-manager-DeaBgtPF.js"),__vite__mapDeps([17,0,1,2,3,4,5,6,8,9,10,11,12,13,14,15,18,19,7,20,21,22,23,24,25,26])).then(s=>s.initBatteryManager()).then(t),2e3)),hi=()=>new Promise(t=>setTimeout(()=>L(()=>import("./memory-manager-BFSAMsDL.js"),__vite__mapDeps([27,0,1,2,3,4,5,6,8,9,10,11,12,13,14,15,18,19,7,20,21,22,23,24,25,26])).then(s=>s.initMemoryManager()).then(t),2e3)),xi=()=>new Promise(t=>setTimeout(()=>L(()=>Promise.resolve().then(()=>Bn),void 0).then(s=>s.initPowerModes()).then(t),2e3)),gi=()=>L(()=>import("./policies-CRVv_IL8.js"),__vite__mapDeps([28,0,1,2,3,4,5,6])).then(t=>t.updatePolicyMetrics),bi=()=>L(()=>import("./policies-CRVv_IL8.js"),__vite__mapDeps([28,0,1,2,3,4,5,6])).then(t=>t.getPolicyRecommendations),yi=()=>new Promise(t=>setTimeout(()=>L(()=>import("./core-memory-DmK-uh9X.js").then(s=>s.g),__vite__mapDeps([6,0,1,2,3,4,5])).then(s=>s.initNightlySummarization()).then(t),3e3)),Fs=le()?te.lazy(()=>L(()=>import("./RedixDebugPanel-B__gR_cw.js"),__vite__mapDeps([29,2,3,4,0,1,5,6,14])).then(t=>({default:t.RedixDebugPanel}))):null,vi=te.lazy(()=>L(()=>import("./SessionRestoreModal-DsxID4E8.js"),__vite__mapDeps([30,2,3,4,0,1,5,6,9,10,11,12,13,14])));class ie extends te.Component{constructor(s){super(s),$t(this,"handleReload",()=>{window.location.reload()}),$t(this,"handleOpenLogs",async()=>{try{const a=await E.diagnostics.openLogs();this.setState({copyStatus:a?.success?"success":"error",copyMessage:a?.success?"Logs folder opened.":"Unable to open logs folder.",copying:!1})}catch(a){console.error("Failed to open logs folder from error boundary:",a),this.setState({copyStatus:"error",copyMessage:"Failed to open logs folder.",copying:!1})}}),$t(this,"handleCopyDiagnostics",async()=>{if(!this.state.copying){this.setState({copying:!0,copyStatus:null,copyMessage:void 0});try{const a=await E.diagnostics.copyDiagnostics();a?.diagnostics&&navigator?.clipboard?.writeText?(await navigator.clipboard.writeText(a.diagnostics),this.setState({copyStatus:"success",copyMessage:"Diagnostics copied to clipboard.",copying:!1})):(this.setState({copyStatus:"error",copyMessage:"Clipboard unavailable. Diagnostics logged to console.",copying:!1}),console.info("[Diagnostics] Summary:",a?.diagnostics))}catch(a){console.error("Failed to copy diagnostics from error boundary:",a),this.setState({copyStatus:"error",copyMessage:"Failed to copy diagnostics.",copying:!1})}}}),this.state={hasError:!1,copyStatus:null,copying:!1}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,a){console.error(`ErrorBoundary caught error${this.props.componentName?` in ${this.props.componentName}`:""}:`,s,a),this.setState({error:s,errorInfo:a.componentStack??void 0})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"flex min-h-screen w-full items-center justify-center bg-slate-950 px-6 py-12 text-gray-100",children:e.jsxs("div",{className:"w-full max-w-xl space-y-5 rounded-2xl border border-slate-800 bg-slate-900/70 p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"rounded-full bg-red-500/20 p-2 text-red-200",children:e.jsx(yt,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg font-semibold text-red-200",children:["Something went wrong",this.props.componentName?` inside ${this.props.componentName}`:"","."]}),this.state.error?.message&&e.jsx("p",{className:"mt-2 text-sm text-red-100/80",children:this.state.error.message}),e.jsx("p",{className:"mt-2 text-sm text-gray-400",children:"Try reloading the interface. You can also copy diagnostics or inspect the latest logs to share with the team."})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:this.handleReload,className:"rounded-lg border border-blue-500/50 bg-blue-500/10 px-4 py-2 text-sm font-medium text-blue-100 transition-colors hover:border-blue-500/70",children:"Reload app"}),e.jsx("button",{onClick:this.handleCopyDiagnostics,disabled:this.state.copying,className:`rounded-lg border px-4 py-2 text-sm font-medium transition-colors ${this.state.copying?"cursor-wait border-indigo-500/30 bg-indigo-500/10 text-indigo-200/60":"border-indigo-500/50 bg-indigo-500/10 text-indigo-100 hover:border-indigo-500/70"}`,children:this.state.copying?"Copying…":"Copy diagnostics"}),e.jsx("button",{onClick:this.handleOpenLogs,className:"rounded-lg border border-emerald-500/50 bg-emerald-500/10 px-4 py-2 text-sm font-medium text-emerald-100 transition-colors hover:border-emerald-500/70",children:"Open logs folder"})]}),this.state.copyMessage&&e.jsx("div",{className:`text-sm ${this.state.copyStatus==="success"?"text-emerald-300":"text-red-300"}`,children:this.state.copyMessage}),le()&&this.state.errorInfo&&e.jsxs("details",{className:"text-xs text-gray-400",children:[e.jsx("summary",{className:"cursor-pointer text-gray-300",children:"Stack trace"}),e.jsx("pre",{className:"mt-2 max-h-48 overflow-auto whitespace-pre-wrap rounded bg-black/40 p-3",children:this.state.errorInfo})]})]})}):this.props.children}}const wi=te.lazy(()=>L(()=>import("./TopBar-DlyyI3dP.js"),__vite__mapDeps([31,2,3,4,0,1,5,6,9,10,11,12,13,14,8,15,21,18,19,7,20,22,23,24,25,26])).then(t=>({default:t.TopBar}))),ji=te.lazy(()=>L(()=>import("./TabStrip-DwWt0XPA.js"),__vite__mapDeps([32,2,3,4,0,1,5,6,8,9,10,11,12,13,14,15,33,19,18,7,20,21,22,23,24,25,26])).then(t=>({default:t.TabStrip}))),Si=te.lazy(()=>L(()=>import("./RightPanel-DtmRQd7t.js"),__vite__mapDeps([34,2,3,4,0,1,5,6,18,8,9,10,11,12,13,14,15,35,19,7,20,21,22,23,24,25,26])).then(t=>({default:t.RightPanel}))),Ni=te.lazy(()=>L(()=>import("./BottomStatus-CpusWBZO.js"),__vite__mapDeps([36,0,1,2,3,4,5,6,14,18,8,9,10,11,12,13,15,33,7,26])).then(t=>({default:t.BottomStatus}))),ki=te.lazy(()=>L(()=>import("./CommandPalette-C3fUrmXD.js"),__vite__mapDeps([37,2,3,4,0,1,5,6,8,9,10,11,12,13,14,15])).then(t=>({default:t.CommandPalette}))),Ti=te.lazy(()=>L(()=>import("./PermissionPrompt-BewnDXtf.js"),__vite__mapDeps([38,2,3,4,0,1,5,6,14])).then(t=>({default:t.PermissionPrompt}))),Ei=te.lazy(()=>L(()=>import("./ConsentPrompt-GT-g9PFb.js"),__vite__mapDeps([39,2,3,4,0,1,5,6,14])).then(t=>({default:t.ConsentPrompt}))),Ii=te.lazy(()=>L(()=>import("./AgentOverlay-BLctF3fX.js"),__vite__mapDeps([40,2,3,4,0,1,5,6,18,8,9,10,11,12,13,14,15])).then(t=>({default:t.AgentOverlay}))),Ci=te.lazy(()=>L(()=>import("./RegenSidebar-4rHIQNpC.js"),__vite__mapDeps([41,0,1,2,3,4,5,6])).then(t=>({default:t.RegenSidebar}))),Mi=()=>e.jsx("div",{className:"fixed bottom-0 right-0 top-0 z-50 h-full min-h-0 w-[400px] overflow-hidden border-l border-slate-800/60 bg-gray-900",children:e.jsx(Ci,{})}),Pi=te.lazy(()=>L(()=>import("./ClipperOverlay-B_9ypu2u.js"),__vite__mapDeps([42,2,3,4,0,1,5,6,14])).then(t=>({default:t.ClipperOverlay}))),Ai=te.lazy(()=>L(()=>import("./ReaderOverlay-BY93HbSi.js"),__vite__mapDeps([43,0,1,2,3,4,5,6,14])).then(t=>({default:t.ReaderOverlay}))),_i=te.lazy(()=>L(()=>import("./TabGraphOverlay-DdEVCPFr.js"),__vite__mapDeps([44,2,3,4,0,1,5,6,14,10,8,9,11,12,13,15,18,19,7,20,21,22,23,24,25,26])).then(t=>({default:t.TabGraphOverlay}))),Ri=te.lazy(()=>L(()=>import("./ConsentDashboard-CjN7bvtp.js"),__vite__mapDeps([45,2,3,4,0,1,5,6,14,46,47,10,8,9,11,12,13,15,18,19,7,20,21,22,23,24,25,26])).then(t=>({default:t.ConsentDashboard}))),zi=te.lazy(()=>L(()=>import("./TrustEthicsDashboard-xBQUU1OG.js"),__vite__mapDeps([48,2,3,4,0,1,5,6,26,14,10,8,9,11,12,13,15,18,19,7,20,21,22,23,24,25])).then(t=>({default:t.TrustEthicsDashboard}))),Di=te.lazy(()=>L(()=>import("./ResearchTour-TWw7Br_Z.js"),__vite__mapDeps([49,2,3,4,0,1,5,6,14,8,9,10,11,12,13,15,18,19,7,20,21,22,23,24,25,26])).then(t=>({default:t.ResearchTour})));function Li(){const[t,s]=c.useState(!1),[a,r]=c.useState(!1),[n,o]=c.useState(!1),[i,u]=c.useState(null),[p,b]=c.useState(null),[m,y]=c.useState(!1),x=Q(f=>f.memorySidebarOpen),l=Q(f=>f.setMemorySidebarOpen),d=Q(f=>f.setMode),[h,w]=c.useState(!1),[k,O]=c.useState(!1),[j,S]=c.useState(!1),[v,C]=c.useState(!1),T=le(),U=Ce(f=>f.appearance.theme),H=Ce(f=>f.appearance.compactUI),Y=Ce(f=>f.privacy.clearOnExit),{crashedTab:q,setCrashedTab:ae,handleReload:re}=tn();c.useEffect(()=>Co(),[]),c.useEffect(()=>{if(Re()){const f=Xr();let g=null;(async()=>{try{const{listen:D}=await L(async()=>{const{listen:P}=await import("@tauri-apps/api/event");return{listen:P}},[]);g=await D("navigate-to-url",P=>{console.log("[AppShell] Received navigation event:",P.payload),window.location.href=P.payload})}catch(D){console.warn("[AppShell] Failed to setup Tauri navigation listener:",D);const P=$=>{console.log("[AppShell] Received navigation event (fallback):",$.detail),window.location.href=$.detail};window.addEventListener("navigate-to-url",P),g=()=>{window.removeEventListener("navigate-to-url",P)}}})();const I=D=>{const{type:P,url:$,sourceTabId:V}=D.data||{};if(P==="open-in-new-tab"&&$){console.log("[AppShell] Received open-in-new-tab message",{url:$,sourceTabId:V,origin:D.origin});const Z=K.getState(),J={id:`tab-${Date.now()}-${Math.random().toString(36).slice(2,7)}`,url:$,title:"New Tab",active:!1,createdAt:Date.now()};Z.add(J)}};return window.addEventListener("message",I),()=>{f(),g&&g(),window.removeEventListener("message",I)}}},[]),c.useEffect(()=>{Ws().length>0&&setTimeout(()=>{O(!0)},2e3)},[]),c.useEffect(()=>{let f=null;return(async()=>{const{startMemoryMonitoring:I,stopMemoryMonitoring:D,unloadInactiveTabs:P}=await L(async()=>{const{startMemoryMonitoring:$,stopMemoryMonitoring:V,unloadInactiveTabs:Z}=await import("./memoryMonitor-BGCXgiUi.js");return{startMemoryMonitoring:$,stopMemoryMonitoring:V,unloadInactiveTabs:Z}},__vite__mapDeps([50,0,1,2,3,4,5,6]));I(async()=>{await P()},async()=>{await P(),A.warning("Low memory detected. Some tabs were unloaded for better performance.")}),f=()=>D()})(),()=>{f&&f()}},[]),c.useEffect(()=>{y(!1);const f=()=>{const I=!!(document.fullscreenElement||window.webkitFullscreenElement||window.mozFullScreenElement);I!==m&&y(I)},g=setTimeout(f,100);return document.addEventListener("fullscreenchange",f),document.addEventListener("webkitfullscreenchange",f),document.addEventListener("mozfullscreenchange",f),()=>{clearTimeout(g),document.removeEventListener("fullscreenchange",f),document.removeEventListener("webkitfullscreenchange",f),document.removeEventListener("mozfullscreenchange",f)}},[]);const[F,N]=c.useState(!1),[R,W]=c.useState(!1),[be,lt]=c.useState(()=>typeof navigator<"u"?!navigator.onLine:!1),[wt,Je]=c.useState(!1),ye=nt(f=>f.visible),M=nt(f=>f.start);nt(f=>f.finish),Do();const[z,B]=c.useState(!1),X=c.useRef(null),Ne=c.useRef(null),ve=c.useMemo(()=>Se(),[]),ct=ve&&typeof window<"u"&&!!window.ipc;c.useEffect(()=>{const f=()=>lt(!1),g=()=>lt(!0);return window.addEventListener("online",f),window.addEventListener("offline",g),()=>{window.removeEventListener("online",f),window.removeEventListener("offline",g)}},[]),c.useEffect(()=>{if(!ve)return;const f=Le.on("wake-wispr",()=>{window.dispatchEvent(new CustomEvent("activate-wispr")),A.info("WISPR activated")}),g=Le.on("open-trade-mode",()=>{d("Trade"),A.info("Trade mode opened")}),I=Le.on("open-research-mode",()=>{d("Research"),A.info("Research mode opened")});return()=>{f(),g(),I()}},[d]),c.useEffect(()=>{if(!ve)return;let f=-1,g=-1;const I=()=>{const $=Math.round(X.current?.offsetHeight??0),V=Math.round(Ne.current?.offsetHeight??0),Z=m?0:V;$!==f&&document.documentElement.style.setProperty("--header-height",`${$}px`),(Z!==g||Z!==V)&&document.documentElement.style.setProperty("--footer-height",`${Z}px`),($!==f||Z!==g)&&(f=$,g=Z,E.ui.setChromeOffsets({top:$,bottom:Z}))},D=[],P=$=>{if(!$||typeof ResizeObserver>"u")return;const V=new ResizeObserver(I);V.observe($),D.push(V)};return P(X.current),P(Ne.current),I(),window.addEventListener("resize",I),()=>{window.removeEventListener("resize",I),D.forEach($=>$.disconnect())}},[ve,m]),c.useEffect(()=>{if(!X.current)return;const f=()=>{const I=X.current?.offsetHeight??0,D=`${I}px`;if(document.documentElement.style.setProperty("--header-height",D),document.documentElement.style.setProperty("--omnix-topbar-height",D),typeof window<"u"&&(window.__OMNIX_TOPBAR_HEIGHT=I,typeof window.__omnix_apply_topbar=="function"))try{window.__omnix_apply_topbar()}catch{}};f();const g=new ResizeObserver(f);return X.current&&g.observe(X.current),()=>g.disconnect()},[]),c.useEffect(()=>{Wo()},[]),c.useEffect(()=>{Yo(),Go()},[]),c.useEffect(()=>{be?E.ollama.check().then(f=>{Je(f?.available??!1)}).catch(()=>{Je(!1)}):Je(!1)},[be]);const[Me,jt]=c.useState(null),[es,St]=c.useState(!1),[Oi,$i]=c.useState("idle"),[ha,xa]=c.useState(()=>typeof window<"u"?window.innerWidth:1920),we=ha>=1280;c.useEffect(()=>{if(!ve||typeof window>"u"||!window.ui||typeof window.ui.setRightDock!="function")return;const f=t&&!m&&we?360:0;try{window.ui.setRightDock(f)}catch{}},[t,m,we,ve]);const[,ts]=c.useState(!1),qe=mt(f=>f.snapshot),ss=mt(f=>f.saveSnapshot);mt(f=>f.restoreFromSnapshot);const as=mt(f=>f.clearSnapshot),rs=Io(f=>f.clear),ne=K();Jo();const[de,dt]=c.useState(!1),[Pe,Qe]=c.useState(!1),[Xe,ns]=c.useState(null),{hasConsented:Ae}=Ro(),ga=c.useCallback(()=>{console.log("[AppShell] handleTOSAccept called - closing TOS modal"),console.log("[AppShell] Current state - showTOS:",de,"hasConsented:",Ae,"showCookieConsent:",Pe),dt(!1),console.log("[AppShell] TOS modal closed, waiting for cookie consent and onboarding to start...")},[de,Ae,Pe]),ba=c.useCallback(()=>{window.confirm("You must accept the Terms of Service to use Regen. Would you like to exit?")&&(typeof window<"u"&&window.api?.app?.quit?window.api.app.quit():window.close())},[]);c.useEffect(()=>{if(typeof window>"u")return;const f=()=>{xa(window.innerWidth)};return window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]),c.useEffect(()=>(ur(),()=>{}),[]),c.useEffect(()=>{const f=window.setTimeout(()=>{ss(ne.tabs,ne.activeId)},500);return()=>window.clearTimeout(f)},[ne.tabs,ne.activeId,ss]),c.useEffect(()=>{if(!Y)return;const f=()=>{as(),rs(),K.getState().clearRecentlyClosed()};return window.addEventListener("beforeunload",f),()=>window.removeEventListener("beforeunload",f)},[Y,rs,as]),c.useEffect(()=>{if(typeof document>"u")return;const f=document.documentElement,g=window.matchMedia("(prefers-color-scheme: dark)"),I=()=>{const D=U==="system"?g.matches?"dark":"light":U;f.dataset.theme=D,f.dataset.compact=H?"true":"false"};if(I(),U==="system"){const D=()=>I();return g.addEventListener("change",D),()=>g.removeEventListener("change",D)}},[U,H]),c.useEffect(()=>{try{const f=localStorage.getItem("regen:tos:accepted");if(f){const g=JSON.parse(f);if(g.version==="2025-12-17"&&g.accepted){dt(!1),Ae||Qe(!0);return}}dt(!0)}catch{dt(!0)}},[Ae]),c.useEffect(()=>{if(!de&&!Ae){console.log("[AppShell] Showing cookie consent - TOS accepted, cookie consent needed");const f=setTimeout(()=>{Qe(!0),console.log("[AppShell] Cookie consent modal shown")},300);return()=>clearTimeout(f)}else!de&&Ae&&(console.log("[AppShell] Cookie consent already given, skipping cookie consent modal"),Qe(!1))},[de,Ae]),c.useEffect(()=>{let f=0;const g=J=>{const ce=J.dataTransfer?.types;return ce?Array.from(ce).includes("application/x-regen-tab-id"):!1},I=J=>{g(J)&&(J.preventDefault(),f+=1,B(!0))},D=J=>{g(J)&&(J.preventDefault(),J.dataTransfer&&(J.dataTransfer.dropEffect="copy"))},P=J=>{g(J)&&(f=Math.max(0,f-1),f===0&&B(!1))},$=()=>{f=0,B(!1)},V=J=>{if(!g(J))return;J.preventDefault(),f=0,B(!1);const ce=J.dataTransfer?.getData("application/x-regen-tab-id");if(ce)try{Ar.getState().focusTab(ce)}catch(_e){le()&&console.warn("[AppShell] Failed to focus tab graph from drop",_e)}},Z=()=>{f=0,B(!1)};return document.addEventListener("dragenter",I),document.addEventListener("dragover",D),document.addEventListener("dragleave",P),document.addEventListener("dragend",$),document.addEventListener("drop",V),window.addEventListener("tabgraph:dragend",Z),()=>{document.removeEventListener("dragenter",I),document.removeEventListener("dragover",D),document.removeEventListener("dragleave",P),document.removeEventListener("dragend",$),document.removeEventListener("drop",V),window.removeEventListener("tabgraph:dragend",Z)}},[]);const ya=di(f=>f.visible),va=Pr(f=>f.visible),os=c.useCallback(f=>{const{tabs:g,activeId:I,setActive:D}=K.getState(),P=Q.getState().mode,$=g.filter(_e=>!P||!_e.appMode||_e.appMode===P);if($.length===0)return!1;const V=$.findIndex(_e=>_e.id===I),J=((V>=0?V:0)+f+$.length)%$.length,ce=$[J];return ce&&ce.id!==I?(D(ce.id),E.tabs.activate({id:ce.id}),!0):!1},[]),Nt=c.useCallback((f,g=!1)=>{const{tabs:I,setActive:D}=K.getState(),P=Q.getState().mode,$=I.filter(J=>!P||!J.appMode||J.appMode===P);if($.length===0)return!1;const V=g?Math.max($.length-1,0):Math.min(Math.max(f,0),$.length-1),Z=$[V];return Z?(D(Z.id),E.tabs.activate({id:Z.id}),!0):!1},[]),G=c.useMemo(()=>{const f=Array.isArray(ne.tabs)?ne.tabs.filter(I=>I&&I.id):[],g=f.find(I=>I.id===ne.activeId);return ne.activeId&&!g&&console.warn("[AppShell] activeTab not found",{activeId:ne.activeId,availableIds:f.map(I=>I.id),totalTabs:f.length}),g||void 0},[ne.tabs,ne.activeId]),ke=Q(f=>f.mode),he=ke??"Browse";c.useEffect(()=>{if(typeof document>"u")return;const f=(ke??"browse").toLowerCase();return document.documentElement.dataset.modeTheme=f,()=>{document.documentElement.dataset.modeTheme=f}},[ke]);const Ze=Q(f=>f.researchPaneOpen),et=Q(f=>f.setResearchPaneOpen),Ve=Ft(f=>f.sidebarOpen),Ke=Ft(f=>f.setSidebarOpen),is=Q(f=>f.regenSidebarOpen),wa=Q(f=>f.setRegenSidebarOpen),[Fi,ja]=c.useState(.62),ls=c.useRef("");c.useEffect(()=>{!G?.url||G.url===ls.current||G.url.startsWith("about:")||G.url.startsWith("chrome:")||G.url.startsWith("edge:")||G.url.startsWith("app:")||G.url.startsWith("ob://")||(ls.current=G.url,Nr(G.url,G.title,{tabId:G.id,containerId:G.containerId}).catch(f=>{console.warn("[AppShell] Failed to track visit:",f)}))},[G?.url,G?.title,G?.id,G?.containerId]),c.useEffect(()=>{setTimeout(()=>{yi().catch(f=>{le()&&console.warn("[AppShell] Nightly summarization init failed:",f)})},2e3)},[]);const[cs,ds]=c.useState(!1),kt=a||!!i||!!p||F||R,He=G?.url??"",Te=he!=="Research"&&he!=="Trade"&&!!He&&!He.startsWith("ob://")&&!He.startsWith("about:")&&!He.startsWith("chrome://")&&!He.startsWith("edge://")&&!He.startsWith("app://");c.useEffect(()=>{(we||!Te)&&ts(!1)},[we,Te]);const Sa=Te&&we,Na=c.useCallback(()=>{Te&&ds(!0)},[Te]);c.useEffect(()=>{if(!cs)return;const f=I=>{ja(D=>{const P=I.clientX/window.innerWidth;return Number.isNaN(P)?D:Math.min(.85,Math.max(.25,P))})},g=()=>{ds(!1)};return window.addEventListener("mousemove",f),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",g)}},[cs]),c.useMemo(()=>{if(!Me)return null;try{return Gt(new Date(Me.updatedAt),{addSuffix:!0})}catch{return null}},[Me]),c.useEffect(()=>{ke==="Research"?(Ze||et(!0),Ve&&Ke(!1)):ke==="Trade"?(Ve||Ke(!0),Ze&&et(!1),x&&l(!1)):ke==="GraphMind"?(Q.getState().graphDockOpen||Q.getState().toggleGraphDock(),Ze&&et(!1),Ve&&Ke(!1),x&&l(!1)):(Ze&&et(!1),Ve&&Ke(!1))},[ke,x,Ze,et,Ve,Ke,l]),c.useEffect(()=>{(()=>{"requestIdleCallback"in window?requestIdleCallback(()=>{$s().catch(g=>{le()&&console.warn("[AppShell] Optimizer init failed:",g)})},{timeout:2e3}):setTimeout(()=>{$s().catch(g=>{le()&&console.warn("[AppShell] Optimizer init failed")})},500)})()},[]),c.useEffect(()=>{if(!ct)return;const f=setTimeout(()=>{pi().catch(g=>{le()&&console.warn("[AppShell] Tab suspension init failed:",g)})},1e3);return()=>clearTimeout(f)},[ct]),c.useEffect(()=>{if(!ct)return;const f=setTimeout(()=>{Promise.all([fi().catch(g=>{le()&&console.warn("[AppShell] Battery manager init failed:",g)}),xi().catch(g=>{le()&&console.warn("[AppShell] Power modes init failed:",g)}),hi().catch(g=>{le()&&console.warn("[AppShell] Memory manager init failed:",g)})]).catch(()=>{})},1500);return()=>clearTimeout(f)},[ct]),Zr(f=>{if(f.type==="redix:performance:low"){le()&&console.log("[Redix] Performance low:",f.payload);const{memory:g,cpu:I,battery:D}=f.payload||{};gi().then(P=>{P({memoryUsage:g,cpuUsage:I,batteryLevel:D})}).catch(()=>{})}if(f.type.startsWith("redix:policy:")&&bi().then(g=>{const I=g();I.length>0&&le()&&console.log("[Redix] Policy recommendations:",I)}).catch(()=>{}),f.type==="redix:mode:error"){const{mode:g,error:I}=f.payload||{};console.error("[ModeManager] Mode transition error:",g,I),ns({message:`Failed to switch to ${g} mode: ${I||"Unknown error"}`,variant:"error"})}if(f.type==="redix:mode:activated"){const{mode:g}=f.payload||{}}}),c.useEffect(()=>{if(typeof window>"u")return;if(de||Pe){console.log("[AppShell] Onboarding blocked - showTOS:",de,"showCookieConsent:",Pe);return}console.log("[AppShell] Checking if onboarding should start...",{isCompleted:Ye.isCompleted(),onboardingVisible:ye});const f=setTimeout(()=>{!Ye.isCompleted()&&!ye?(console.log("[AppShell] Starting onboarding..."),M()):console.log("[AppShell] Onboarding not started - isCompleted:",Ye.isCompleted(),"visible:",ye)},1200);return()=>clearTimeout(f)},[ye,M,de,Pe]),c.useEffect(()=>{if(ke!=="Browse"||!G?.url)return;const g=setTimeout(async()=>{try{const I=G.url;if(!I)return;const D=await ko(I,"Normal")}catch{}},1e3);return()=>clearTimeout(g)},[G?.url,ke]),c.useEffect(()=>{if(!qe){jt(null);return}if(qe.tabCount===0){jt(null),St(!0);return}Me&&Me.updatedAt===qe.updatedAt||(jt({updatedAt:qe.updatedAt,windowCount:1,tabCount:qe.tabCount}),St(!1))},[qe,Me]),c.useEffect(()=>{if(!Me||es)return;const f=setTimeout(()=>{St(!0)},3e4);return()=>clearTimeout(f)},[Me,es]),c.useEffect(()=>{if(!Xe)return;const f=window.setTimeout(()=>{ns(null)},6e3);return()=>{window.clearTimeout(f)}},[Xe]),hs("permissions:request",f=>{u(f)},[]),hs("agent:consent:request",f=>{if(!f||!f.id||!f.action)return;const g={id:f.id,action:{type:f.action.type,description:f.action.description,risk:f.action.risk??"medium"},callback:async I=>{try{I?await E.consent.approve(f.id):await E.consent.revoke(f.id)}catch(D){console.error("Failed to resolve consent:",D)}finally{b(null)}}};b(g)},[]),c.useEffect(()=>{const f=I=>{y(I.fullscreen)};return Le.on("app:fullscreen-changed",f)},[]),c.useEffect(()=>{const f=g=>{const D=navigator.platform.toUpperCase().indexOf("MAC")>=0?g.metaKey:g.ctrlKey;if(g.key==="F11"){g.preventDefault(),E.windowControl.toggleFullscreen();return}if(D&&!g.shiftKey&&!g.altKey&&g.key.toLowerCase()==="k"){const P=g.target;if(P?.hasAttribute("data-omnibox-input")||P?.closest('[data-onboarding="omnibox"]')){g.preventDefault(),r(!0);return}return}if(D&&g.shiftKey&&!g.altKey&&g.key.toLowerCase()==="k"){g.preventDefault(),r(!0);return}if(!(D&&!g.shiftKey&&!g.altKey&&g.key.toLowerCase()==="l")){if(D&&!g.shiftKey&&!g.altKey&&g.key.toLowerCase()==="t"){g.preventDefault(),E.tabs.create("about:blank").catch(P=>{le()&&console.error("[AppShell] Failed to create tab:",P)});return}if(D&&!g.shiftKey&&!g.altKey&&g.key.toLowerCase()==="w"){g.preventDefault();const P=K.getState();if(P.activeId){const $=P.tabs.find(V=>V.id===P.activeId);$&&P.rememberClosedTab($),E.tabs.close({id:P.activeId}).catch(V=>{le()&&console.error("[AppShell] Failed to close tab:",V)})}return}if(D&&g.shiftKey&&!g.altKey&&g.key.toLowerCase()==="t"){g.preventDefault(),Fo();return}if(D&&g.shiftKey&&!g.altKey&&g.key.toLowerCase()==="a"){g.preventDefault(),s(P=>!P);return}if(D&&g.shiftKey&&!g.altKey&&g.key.toLowerCase()==="m"){g.preventDefault(),l(!x);return}if(D&&g.shiftKey&&!g.altKey&&g.key.toLowerCase()==="r"){g.preventDefault(),wa(!is);return}if(D&&g.shiftKey&&!g.altKey&&g.key.toLowerCase()==="l"){g.preventDefault(),o(!n);return}if(D&&g.shiftKey&&!g.altKey&&g.key.toLowerCase()==="h"){g.preventDefault(),K.getState().activeId&&N(!0);return}if(D&&g.altKey&&g.key.toLowerCase()==="p"){g.preventDefault(),document.querySelector("[data-network-button]")?.click();return}if(D&&g.altKey&&g.key.toLowerCase()==="s"){g.preventDefault(),document.querySelector("[data-shields-button]")?.click();return}if(!(D&&!g.shiftKey&&!g.altKey&&g.key.toLowerCase()==="f")){if(D&&!g.altKey&&g.key==="Tab"){os(g.shiftKey?-1:1)&&g.preventDefault();return}if(D&&!g.altKey&&!g.shiftKey){const P=Number(g.key);if(!Number.isNaN(P)&&P>=1&&P<=9){g.preventDefault(),P===9?Nt(0,!0):Nt(P-1);return}}if(g.key==="Escape"){F?N(!1):a?r(!1):i?u(null):p?b(null):t?s(!1):x&&l(!1);return}}}};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[a,i,p,t,F,x,os,Nt]),c.useEffect(()=>{window.dispatchEvent(new CustomEvent("memory-sidebar:toggle",{detail:{open:x}}));const f=g=>{const{open:I}=g.detail;I!==x&&l(I)};return window.addEventListener("memory-sidebar:toggle",f),()=>{window.removeEventListener("memory-sidebar:toggle",f)}},[x,l]);const ka=async f=>{if(!G?.url){N(!1);return}try{const g=await E.research.getNotes(G.url),I=g?.notes??"",D=Array.isArray(g?.highlights)?g.highlights:[];await E.research.saveNotes(G.url,I,[...D,f]),Le.emit("research:highlight-added",{url:G.url,highlight:f})}catch(g){console.error("Failed to save highlight:",g)}finally{N(!1)}};return console.log("[AppShell] Rendering - showTOS:",de,"showCookieConsent:",Pe,"onboardingVisible:",ye),e.jsxs("div",{className:"flex w-screen flex-col overflow-hidden bg-slate-950 text-slate-100",style:{height:"calc(100vh - var(--bottom-bar-height, 80px))"},"data-app-shell":"true",children:[e.jsxs("div",{ref:X,"data-top-chrome":!0,className:"flex-none shrink-0 border-b border-slate-800 bg-slate-950",children:[!m&&e.jsx(c.Suspense,{fallback:e.jsx("div",{style:{height:"40px",backgroundColor:"#0f172a"}}),children:e.jsx(ie,{componentName:"TopBar",fallback:e.jsx("div",{style:{height:"40px",backgroundColor:"#0f172a",padding:"8px",color:"#94a3b8",display:"flex",alignItems:"center",fontSize:"12px"},children:e.jsx("span",{children:"Loading navigation..."})}),children:he!=="Research"&&he!=="Trade"&&e.jsx(wi,{showAddressBar:!0,showQuickActions:!0,currentUrl:ne.tabs.find(f=>f.id===ne.activeId)?.url,onModeChange:async f=>{const I={browse:"Browse",research:"Research",trade:"Trade",dev:"Browse"}[f]||"Browse",D=Q.getState().mode;if(I!==D){try{const{ipc:P}=await L(async()=>{const{ipc:$}=await import("./core-ai-yFIunLTZ.js").then(V=>V.U);return{ipc:$}},__vite__mapDeps([0,1,2,3,4,5,6]));await P.invoke("wispr_command",{input:`Init ${I} mode`,mode:f.toLowerCase()}),I==="Trade"?await P.invoke("regen_launch",{url:"https://www.tradingview.com/chart/?symbol=BINANCE:BTCUSDT",mode:"trade"}):I==="Research"&&await P.invoke("regen_launch",{url:"https://www.google.com",mode:"research"})}catch(P){console.warn("[AppShell] Mode init failed:",P)}await d(I)}},onAddressBarSubmit:async f=>{try{const g=ne.tabs.find(ce=>ce.id===ne.activeId),I=g?.url==="about:blank"||!g?.url,{normalizeInputToUrlOrSearch:D}=await L(async()=>{const{normalizeInputToUrlOrSearch:ce}=await import("./OmniDesk-C5fSodZ1.js").then(_e=>_e.s);return{normalizeInputToUrlOrSearch:ce}},__vite__mapDeps([7,2,3,4,0,1,5,6,8,9,10,11,12,13,14,15])),P=Ce.getState(),$=P.language||"auto",V=P.searchEngine||"google";let Z="google";V==="duckduckgo"||V==="bing"||V==="yahoo"?Z=V:(V==="all"||V==="mock")&&(Z="google");const J=D(f,Z,$!=="auto"?$:void 0);I&&g?await E.tabs.navigate(g.id,J):await E.tabs.create(J)}catch(g){console.error("[TopBar] Failed to navigate:",g),A.error("Failed to navigate")}}})})}),be&&e.jsxs("div",{className:"flex items-center justify-between gap-3 border-b border-amber-500/40 bg-amber-500/15 px-4 py-2 text-xs text-amber-100 sm:text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yt,{size:14,className:"flex-shrink-0 text-amber-300"}),e.jsx("span",{children:"Offline mode: remote AI and sync are paused. Local actions remain available."})]}),wt&&e.jsx("button",{type:"button",onClick:()=>{document.querySelector("[data-settings-button]")?.click()},className:"flex items-center gap-1.5 rounded-md border border-amber-400/40 bg-amber-500/20 px-2.5 py-1 text-[11px] font-medium text-amber-100 transition-colors hover:border-amber-400/60 hover:bg-amber-500/30",children:e.jsx("span",{children:"Try Local AI"})})]}),!m&&e.jsxs(e.Fragment,{children:[he!=="Research"&&he!=="Trade"&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(ie,{componentName:"TabStrip",children:e.jsx("div",{className:"relative z-50 w-full",style:{pointerEvents:"auto"},children:e.jsx(ji,{})})})}),Te&&!we&&e.jsxs("div",{className:"flex items-center justify-end gap-2 px-3 py-2 text-xs text-slate-300 sm:px-4",children:[e.jsxs("button",{type:"button",onClick:()=>ts(!0),className:"inline-flex items-center gap-2 rounded-full border border-slate-700/60 bg-slate-900/70 px-3 py-1.5 font-medium text-slate-100 shadow-sm transition hover:border-slate-500/70",children:[e.jsx(cr,{size:14}),e.jsx("span",{children:"Workspace tools"})]}),e.jsxs("button",{type:"button",onClick:()=>s(!0),className:"inline-flex items-center gap-2 rounded-full border border-slate-700/60 bg-slate-900/70 px-3 py-1.5 font-medium text-slate-100 shadow-sm transition hover:border-slate-500/70",children:[e.jsx(dr,{size:14}),e.jsx("span",{children:"Agent console"})]})]})]})]}),e.jsxs("div",{className:"flex min-h-0 w-full flex-1 overflow-hidden bg-slate-950",children:[e.jsx("div",{className:"content-wrapper flex min-w-0 flex-1 flex-col overflow-hidden",children:Te?e.jsxs("div",{className:"flex min-h-0 min-w-0 flex-1 overflow-hidden bg-slate-950",children:[e.jsx("div",{className:"webview-container relative flex min-h-0 min-w-0 flex-1 overflow-hidden bg-slate-950",style:{zIndex:0,position:"relative"},children:Re()?e.jsx(Gr,{tabs:ne.tabs,activeTabId:ne.activeId}):e.jsx(qr,{tab:G,overlayActive:kt})}),Sa&&e.jsxs(e.Fragment,{children:[e.jsx("div",{onMouseDown:Na,className:"z-20 h-full w-[6px] flex-shrink-0 cursor-col-resize items-center justify-center bg-slate-900/50 transition-colors hover:bg-slate-800",children:e.jsx("div",{className:"h-24 w-[2px] rounded-full bg-slate-700/80"})}),e.jsx("div",{className:"relative w-[320px] min-w-[300px] max-w-sm flex-shrink-0 overflow-hidden border-l border-slate-800/60 bg-slate-950/40",children:e.jsx("div",{className:"h-full min-h-0 overflow-y-auto",children:e.jsx(fs,{})})})]})]}):e.jsx("div",{className:`min-h-0 min-w-0 flex-1 overflow-hidden bg-slate-950 ${m?"absolute inset-0":""}`,children:e.jsx("div",{className:`h-full w-full overflow-auto bg-slate-950 ${kt?"webview--masked":""}`,children:e.jsx(fs,{})})})}),!m&&we&&t&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(ie,{componentName:"RightPanel",children:e.jsx("div",{className:"h-full min-h-0 w-[340px] max-w-[380px] overflow-y-auto border-l border-slate-800/60","data-sidebar":!0,children:e.jsx(Si,{open:t,onClose:()=>s(!1)})})})})]}),e.jsx("div",{ref:Ne,id:"bottomBar",className:"fixed bottom-0 left-0 right-0 z-50 flex-none shrink-0 border-t border-slate-800 bg-slate-950",style:{boxShadow:"0 -6px 24px rgba(0,0,0,0.35)",background:"linear-gradient(180deg, rgba(15,23,42,0.96), rgba(10,12,16,0.96))"},children:!m&&he==="Browse"&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(ie,{componentName:"BottomStatus",children:e.jsx(Ni,{})})})}),!m&&!we&&Te&&e.jsx(ti,{activeMode:he,onSelectMode:d,onOpenLibrary:()=>o(!0),onOpenAgent:()=>s(!0)}),e.jsx(c.Suspense,{fallback:null,children:e.jsx(me,{children:e.jsx(ie,{componentName:"AgentOverlay",children:e.jsx(Ii,{})})})}),e.jsx(c.Suspense,{fallback:null,children:e.jsx(me,{children:e.jsx(ie,{componentName:"ClipperOverlay",children:e.jsx(Pi,{active:F,onCancel:()=>N(!1),onCreateHighlight:ka})})})}),e.jsx(c.Suspense,{fallback:null,children:e.jsx(me,{children:e.jsx(ie,{componentName:"ReaderOverlay",children:e.jsx(Ai,{active:R,onClose:()=>W(!1),tabId:ne.activeId,url:G?.url})})})}),z&&e.jsx(me,{children:e.jsx("div",{className:"pointer-events-none fixed inset-0 z-tour flex items-center justify-center",children:e.jsxs("div",{className:"rounded-3xl border border-purple-500/40 bg-purple-900/50 px-8 py-6 text-center shadow-[0_0_60px_rgba(168,85,247,0.35)] backdrop-blur-sm",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-[0.3em] text-purple-200/70",children:"Tab graph"}),e.jsx("div",{className:"mt-2 text-lg font-semibold text-purple-100",children:"Drop to map this tab's DNA"}),e.jsx("div",{className:"mt-1 text-xs text-purple-200/80",children:"Release anywhere to open the graph overlay."})]})})}),e.jsx(c.Suspense,{fallback:null,children:e.jsx(me,{children:e.jsx(ie,{componentName:"TabGraphOverlay",children:e.jsx(_i,{})})})}),!m&&e.jsx(c.Suspense,{fallback:null}),ya&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(me,{children:e.jsx(ie,{componentName:"ConsentDashboard",children:e.jsx(Ri,{})})})}),va&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(me,{children:e.jsx(ie,{componentName:"TrustEthicsDashboard",children:e.jsx(zi,{})})})}),ye&&!de&&!Pe&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(me,{children:e.jsx(ie,{componentName:"ResearchTour",children:e.jsx(Di,{onClose:()=>{}})})})}),a&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(me,{children:e.jsx(ie,{componentName:"CommandPalette",children:e.jsx(ki,{onClose:()=>r(!1)})})})}),i&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(me,{children:e.jsx(ie,{componentName:"PermissionPrompt",children:e.jsx(Ti,{request:i,onClose:()=>u(null)})})})}),p&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(me,{children:e.jsx(ie,{componentName:"ConsentPrompt",children:e.jsx(Ei,{request:p,onClose:()=>b(null)})})})}),q&&e.jsx(en,{tabId:q.tabId,reason:q.reason,exitCode:q.exitCode,onClose:()=>ae(null),onReload:re}),he==="Research"&&e.jsx(yn,{open:x,onClose:()=>{l(!1),window.dispatchEvent(new CustomEvent("memory-sidebar:toggle",{detail:{open:!1}}))},onCreateMemory:()=>{}}),he!=="Trade"&&e.jsx(Mo,{open:Ve,onClose:()=>Ke(!1)}),!m&&we&&is&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(ie,{componentName:"RegenSidebar",children:e.jsx(Mi,{})})}),T&&Fs&&e.jsx(c.Suspense,{fallback:null,children:e.jsx(Fs,{open:h,onClose:()=>w(!1)})}),e.jsx($n,{}),e.jsx(Vn,{}),e.jsx("div",{className:"fixed bottom-6 left-1/2 z-[105] w-full max-w-3xl -translate-x-1/2 px-4",children:e.jsx(Hn,{})}),Xe&&e.jsx(me,{children:e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsx("div",{className:`rounded-xl border px-4 py-3 text-sm shadow-xl shadow-black/40 ${Xe.variant==="success"?"border-emerald-400/40 bg-emerald-500/15 text-emerald-100":"border-amber-400/40 bg-amber-500/15 text-amber-100"}`,children:Xe.message})})}),de&&e.jsx(Ao,{onAccept:ga,onDecline:ba}),Pe&&!de&&!ye&&e.jsx(_o,{onAccept:f=>{console.log("[AppShell] Cookie consent accepted:",f),localStorage.setItem("regen:cookie-consent",JSON.stringify(f)),setTimeout(()=>{Qe(!1),console.log("[AppShell] Cookie consent modal closed, onboarding should start now"),console.log("[AppShell] State after cookie consent:",{showTOS:de,showCookieConsent:!1,hasConsented:Ae,onboardingVisible:ye})},100)},onDecline:()=>{console.log("[AppShell] Cookie consent declined");const f={essential:!0,analytics:!1,functional:!1,advertising:!1,timestamp:Date.now(),version:"2025-12-17"};localStorage.setItem("regen:cookie-consent",JSON.stringify(f)),setTimeout(()=>{Qe(!1),console.log("[AppShell] Cookie consent modal closed, onboarding should start now")},100)}}),e.jsx(Lo,{}),e.jsx(c.Suspense,{fallback:null,children:e.jsx(vi,{})}),e.jsx(Qo,{open:k,onClose:()=>O(!1)}),e.jsx(Zo,{open:j,onClose:()=>S(!1)}),e.jsx(Jr,{}),e.jsx(uo,{}),e.jsx(go,{}),e.jsx(Yn,{enabled:!kt&&Te}),!m&&we&&e.jsx(po,{open:n,onClose:()=>o(!1)}),e.jsx(ho,{}),e.jsx(yo,{}),he!=="Browse"&&e.jsx(vo,{}),v&&e.jsx(li,{onComplete:async()=>{const{markSetupComplete:f}=await L(async()=>{const{markSetupComplete:g}=await import("./firstLaunch-ChO73SC_.js");return{markSetupComplete:g}},__vite__mapDeps([51,0,1,2,3,4,5,6]));f(),C(!1),A.success("Setup complete! Your AI brain is ready.")},onError:f=>{console.error("[AppShell] Installer error:",f),A.error(`Setup failed: ${f.message}. You can install Ollama manually from ollama.com`)}})]})}const nl=Object.freeze(Object.defineProperty({__proto__:null,AppShell:Li},Symbol.toStringTag,{value:"Module"}));export{nl as A,Zo as W,zt as a,vt as b,fo as c,Jo as d,Ar as e,di as f,nt as g,$o as r,Be as u};
//# sourceMappingURL=AppShell-CJtR0Pw4.js.map
