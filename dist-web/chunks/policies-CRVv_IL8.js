import{d as n,R as y}from"./core-ai-yFIunLTZ.js";import"./vendor-zustand-BWsgwsXr.js";import"./vendor-react-gmX1Lmvt.js";import"./vendor-react-dom-Bkb6jJ_S.js";import"./vendor-Vl2WtvH-.js";import"./mode-manager.ts-DwguZmJt.js";import"./core-memory-DmK-uh9X.js";const f={suspendBackgroundTabs:!0,suspendAfterMinutes:5,throttleHeavyTabs:!0,memoryThreshold:60,cpuThreshold:70,batteryThreshold:30,prefetchEnabled:!1,prefetchOnWifiOnly:!0},m={suspendBackgroundTabs:!0,suspendAfterMinutes:12,throttleHeavyTabs:!0,memoryThreshold:70,cpuThreshold:80,batteryThreshold:20,prefetchEnabled:!0,prefetchOnWifiOnly:!0},b={suspendBackgroundTabs:!0,suspendAfterMinutes:8,throttleHeavyTabs:!0,memoryThreshold:50,cpuThreshold:60,batteryThreshold:40,prefetchEnabled:!1,prefetchOnWifiOnly:!0},p={default:{suspendBackgroundTabs:!0,suspendAfterMinutes:12,throttleHeavyTabs:!0,memoryThreshold:70,cpuThreshold:80,batteryThreshold:20,prefetchEnabled:!0,prefetchOnWifiOnly:!0},performance:f,balanced:m,battery:b};var g=Object.defineProperty,v=(i,e,t)=>e in i?g(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,h=(i,e,t)=>v(i,typeof e!="symbol"?e+"":e,t);class P{constructor(){h(this,"currentMode","default"),h(this,"metrics",{}),h(this,"activePolicies"),this.activePolicies=this.getPolicyRules("default"),this.initializeMetrics()}getPolicyRules(e=this.currentMode){const t=p[e];return t||(console.warn(`[RedixPolicies] Unknown policy mode: ${e}, using default`),p.default)}setMode(e){this.currentMode=e,this.activePolicies=this.getPolicyRules(e),n({type:"redix:policy:mode-changed",payload:{mode:e,policies:this.activePolicies}}),console.log(`[RedixPolicies] Mode changed to: ${e}`)}getMode(){return this.currentMode}updateMetrics(e){this.metrics={...this.metrics,...e},this.evaluatePolicies()}async initializeMetrics(){if("getBattery"in navigator)try{const e=await navigator.getBattery();this.updateMetrics({batteryLevel:e.level*100,isBatteryLow:e.level<.2}),e.addEventListener("levelchange",()=>{this.updateMetrics({batteryLevel:e.level*100,isBatteryLow:e.level<.2})})}catch(e){console.warn("[RedixPolicies] Battery API unavailable:",e)}if("connection"in navigator){const e=navigator.connection;e&&(this.updateMetrics({isWifi:e.effectiveType==="wifi"||e.type==="wifi"}),e.addEventListener("change",()=>{this.updateMetrics({isWifi:e.effectiveType==="wifi"||e.type==="wifi"})}))}if("memory"in performance){const e=performance.memory;if(e){const t=e.usedJSHeapSize/e.jsHeapSizeLimit*100;this.updateMetrics({memoryUsage:t})}}}evaluatePolicies(){const{memoryUsage:e,cpuUsage:t,batteryLevel:s,isWifi:r}=this.metrics,{memoryThreshold:a,cpuThreshold:l,batteryThreshold:o,prefetchEnabled:d,prefetchOnWifiOnly:u}=this.activePolicies;d&&(u&&!r||s!==void 0&&s<o)&&n({type:"redix:policy:prefetch-disabled",payload:{reason:u&&!r?"not_wifi":"battery_low",batteryLevel:s,isWifi:r}}),e!==void 0&&e>a&&n({type:"redix:policy:memory-high",payload:{usage:e,threshold:a,action:"throttle_tabs"}}),t!==void 0&&t>l&&n({type:"redix:policy:cpu-high",payload:{usage:t,threshold:l,action:"throttle_tabs"}}),s!==void 0&&s<o&&n({type:"redix:policy:battery-low",payload:{level:s,threshold:o,action:"suspend_background_tabs"}})}shouldAllow(e,t){const{suspendBackgroundTabs:s,prefetchEnabled:r,prefetchOnWifiOnly:a}=this.activePolicies,{isWifi:l,batteryLevel:o}=this.metrics,{batteryThreshold:d}=this.activePolicies;switch(e){case"prefetch":return!(!r||a&&!l||o!==void 0&&o<d);case"suspend_tab":return s;case"throttle_tab":return this.activePolicies.throttleHeavyTabs;default:return!0}}getRecommendations(){const e=[],{memoryUsage:t,cpuUsage:s,batteryLevel:r}=this.metrics,{memoryThreshold:a,cpuThreshold:l,batteryThreshold:o}=this.activePolicies;return t!==void 0&&t>a&&e.push("Consider closing unused tabs to reduce memory usage"),s!==void 0&&s>l&&e.push("CPU usage is high - heavy tabs will be throttled"),r!==void 0&&r<o&&e.push("Battery is low - background tabs will be suspended"),e}getMetrics(){return{...this.metrics}}getActivePolicies(){return{...this.activePolicies}}}const c=new P,L=i=>c.setMode(i),E=()=>c.getMode(),W=i=>c.updateMetrics(i),A=(i,e)=>c.shouldAllow(i,e),U=()=>c.getRecommendations(),H=()=>c.getMetrics(),k=i=>c.getPolicyRules(i);y.watch("redix:performance:low",i=>{const{memory:e,cpu:t,battery:s}=i.payload;c.updateMetrics({memoryUsage:e,cpuUsage:t,batteryLevel:s})});export{H as getPolicyMetrics,E as getPolicyMode,U as getPolicyRecommendations,k as getPolicyRules,c as policyEngine,L as setPolicyMode,A as shouldAllowPolicy,W as updatePolicyMetrics};
//# sourceMappingURL=policies-CRVv_IL8.js.map
