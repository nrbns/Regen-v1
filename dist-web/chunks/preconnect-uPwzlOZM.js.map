{"version":3,"file":"preconnect-uPwzlOZM.js","sources":["../../src/services/ollama/preconnect.ts"],"sourcesContent":["/**\n * Ollama Pre-connect Service - Telepathy Upgrade Phase 3\n * Pre-connect Ollama on app start to eliminate first-request latency\n */\n\nimport { invoke } from '@tauri-apps/api/core';\n\nlet preconnectPromise: Promise<boolean> | null = null;\nlet isPreconnected = false;\n\n/**\n * Pre-connect to Ollama on app startup\n * This eliminates the first-request latency when embedding is needed\n */\nexport async function preconnectOllama(): Promise<boolean> {\n  // Return cached promise if already connecting\n  if (preconnectPromise) {\n    return preconnectPromise;\n  }\n\n  // Return immediately if already connected\n  if (isPreconnected) {\n    return true;\n  }\n\n  preconnectPromise = (async () => {\n    try {\n      console.log('[OllamaPreconnect] Starting pre-connection...');\n\n      // Check if Ollama is available\n      const isAvailable = await invoke<boolean>('check_ollama_status').catch(() => false);\n\n      if (!isAvailable) {\n        console.warn('[OllamaPreconnect] Ollama not available, skipping pre-connect');\n        return false;\n      }\n\n      // Warm up connection by calling a lightweight endpoint\n      // This primes the connection pool and loads the model into memory if needed\n      await invoke<number[]>('embed_text', {\n        text: 'warmup',\n        model: 'nomic-embed-text:4bit',\n      }).catch(() => {\n        // Ignore errors - this is just a warmup\n        // If model doesn't exist, that's okay\n      });\n\n      isPreconnected = true;\n      console.log('[OllamaPreconnect] Pre-connection complete');\n      return true;\n    } catch (error) {\n      console.warn('[OllamaPreconnect] Pre-connection failed (non-critical)', error);\n      return false;\n    } finally {\n      preconnectPromise = null;\n    }\n  })();\n\n  return preconnectPromise;\n}\n\n/**\n * Check if Ollama is pre-connected\n */\nexport function isOllamaPreconnected(): boolean {\n  return isPreconnected;\n}\n"],"names":["preconnectPromise","isPreconnected","preconnectOllama","invoke","error"],"mappings":"8CAOA,IAAIA,EAA6C,KAC7CC,EAAiB,GAMrB,eAAsBC,GAAqC,CAEzD,OAAIF,IAKAC,EACK,IAGTD,GAAqB,SAAY,CAC/B,GAAI,CAMF,OALA,QAAQ,IAAI,+CAA+C,EAGvC,MAAMG,EAAgB,qBAAqB,EAAE,MAAM,IAAM,EAAK,GASlF,MAAMA,EAAiB,aAAc,CACnC,KAAM,SACN,MAAO,uBAAA,CACR,EAAE,MAAM,IAAM,CAGf,CAAC,EAEDF,EAAiB,GACjB,QAAQ,IAAI,4CAA4C,EACjD,KAhBL,QAAQ,KAAK,+DAA+D,EACrE,GAgBX,OAASG,EAAO,CACd,eAAQ,KAAK,0DAA2DA,CAAK,EACtE,EACT,QAAA,CACEJ,EAAoB,IACtB,CACF,GAAA,EAEOA,GACT"}