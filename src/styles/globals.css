/* Inter font for premium typography - must be first */
@import url('https://rsms.me/inter/inter.css');

/* Import Design System - must be before @tailwind */
/* Performance optimizations - must be first */
@import './performance.css';

@import './design-system.css';

/* SPRINT 0: Micro-interactions */
@import './sprint0-micro-interactions.css';

/* Import Design Tokens - must be before @tailwind */
@import './tokens.css';

/* Theme vars (light/dark) - must be before @tailwind */
@import './theme.css';

/* SPRINT 0: Low-Data Mode Styles - Must be before @tailwind */
@import './low-data-mode.css';

/* Phase A: Low-RAM Mode Styles - Must be before @tailwind */
@import './low-ram-mode.css';

/* Animations for new components */
@import './animations.css';

@tailwind base;
@tailwind components;
@tailwind utilities;

html {
  /* SPRINT 0: Typography foundation - 16px base, system font for low-download */
  font-size: 16px; /* Base font size for rem calculations */
  font-family:
    -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif; /* System fonts first for low-download, Inter optional */
  font-feature-settings:
    'calt' 1,
    'liga' 1;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  line-height: 1.5; /* Base line-height for content */
}

/* SPRINT 0: Typography scale - 8px baseline grid */
body {
  font-size: 1rem; /* 16px */
  line-height: 1.5; /* Content line-height */
  letter-spacing: -0.01em; /* Slight negative for better readability */
}

/* SPRINT 0: UI elements line-height (tighter than content) */
button,
input,
select,
textarea,
[role='button'] {
  line-height: 1.4; /* UI line-height */
}

/* Trade Mode Controls */
.trade-controls {
  position: relative;
  z-index: 40;
}

.floating-assistant {
  z-index: 50;
}

/* Layout CSS Variables - PR: Fix layout overlap issues */
/* SPRINT 0: 8px baseline grid spacing scale */
:root {
  --sidebar-width: 320px;
  --topbar-height: 56px;
  --bottom-bar-height: 80px;
  --tabstrip-height: 40px;

  /* SPRINT 0: 8px baseline grid spacing scale */
  --spacing-1: 4px;
  --spacing-2: 8px;
  --spacing-3: 12px;
  --spacing-4: 16px;
  --spacing-5: 24px;
  --spacing-6: 32px;
  --spacing-7: 48px;
  --spacing-8: 64px;

  /* SPRINT 0: Animation durations for micro-interactions */
  --animation-fast: 150ms;
  --animation-normal: 200ms;
  --animation-slow: 300ms;

  /* SPRINT 0: Border radius scale */
  --radius-sm: 4px;
  --radius-md: 8px;
  --radius-lg: 12px;
}

/* App root layout - accounts for bottom bar */
.app-root {
  display: flex;
  height: calc(100vh - var(--bottom-bar-height, 80px));
  width: 100vw;
  overflow: hidden;
}

/* Content wrapper - uses remaining space */
.content-wrapper {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  min-width: 0; /* Critical: allows children to shrink */
  min-height: 0; /* Critical: allows children to shrink */
}

/* Webview container - must account for topbar only; bottom handled globally */
.webview-container {
  flex: 1 1 auto;
  min-height: 0; /* Critical for scrollable children inside flex */
  position: relative;
  overflow: hidden; /* Hide outer overflows, let webview scroll internally */
}

/* Sidebar - part of flex flow, not absolute positioned */
[data-sidebar] {
  flex: 0 0 var(--sidebar-width, 320px);
  width: var(--sidebar-width, 320px);
  box-sizing: border-box;
}

/* Ensure content doesn't get pointer-blocked unnecessarily */
.content-wrapper,
.webview-container {
  pointer-events: auto;
}

/* Screen reader only - for accessible announcements */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

body {
  margin: 0;
  font-family:
    -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell',
    'Noto Sans', 'Noto Sans Devanagari', 'Noto Sans Bengali', 'Noto Sans Tamil', 'Noto Sans Telugu',
    'Noto Sans Gujarati', 'Noto Sans Kannada', 'Noto Sans Malayalam', 'Noto Sans Oriya',
    'Noto Sans Gurmukhi', sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
  font-display: swap; /* Prevent invisible text during font load */
  background-color: var(--surface-root);
  color: var(--text-primary);
  transition:
    background-color 200ms ease,
    color 200ms ease;
}

@keyframes shimmer {
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
}

.bg-surface-panel {
  background-color: var(--surface-panel);
}

.bg-surface-elevated {
  background-color: var(--surface-elevated);
}

.border-surface {
  border-color: var(--surface-border);
}

.text-primary {
  color: var(--text-primary);
}

.text-muted {
  color: var(--text-muted);
}

.button-surface {
  background-color: var(--surface-elevated);
  border: 1px solid var(--surface-border);
  color: var(--text-muted);
  backdrop-filter: blur(12px);
  transition:
    background-color 160ms ease,
    color 160ms ease,
    border-color 160ms ease,
    transform 160ms ease;
}

.button-surface:hover,
.button-surface:focus-visible,
.button-surface--active {
  background-color: var(--surface-hover);
  color: var(--text-primary);
  border-color: var(--surface-border-strong);
}

.button-surface[disabled] {
  opacity: 0.45;
  cursor: not-allowed;
}

.theme-pill {
  color: var(--text-muted);
  border: 1px solid transparent;
}

.theme-pill-active {
  color: var(--text-primary);
  border: 1px solid var(--surface-border-strong);
}

html,
body,
#root {
  height: 100%;
  width: 100%;
  margin: 0;
  padding: 0;
  overflow: hidden;
}

body {
  overflow: hidden; /* app itself doesn't scroll */
}

/* Portal root: ensures proper stacking context for all modals/overlays */
#portal-root {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 1000; /* Base z-index for portal container */
  isolation: isolate; /* Create new stacking context */
}

/* Portal children can receive pointer events */
#portal-root > * {
  pointer-events: auto;
}

/* Drag regions for custom titlebar */
.drag {
  -webkit-app-region: drag;
}
.no-drag {
  -webkit-app-region: no-drag;
}

/* Webview sizing */
webview,
.webview {
  display: block;
  width: 100%;
  height: 100%;
}

/* Ensure webview iframes don't overflow */
iframe.webview-iframe,
iframe[src^='http'],
iframe[src^='https'],
iframe[role='tabpanel'] {
  width: 100% !important;
  height: 100% !important;
  border: none !important;
  display: block !important;
  overflow: hidden !important;
}

/* When overlays/modals are open, mask webview to avoid focus/hover steal */
.webview--masked {
  pointer-events: none;
}

/* Show focus only for keyboard/navigation users */
:where(button, [role='button'], a, input, textarea, select) {
  outline: none;
}
:where(button, [role='button'], a, input, textarea, select):focus-visible {
  outline: 2px solid currentColor;
  outline-offset: 2px;
}

/* Smooth scrolling - DAY 2: Mobile UI Fix */
html {
  scroll-behavior: smooth;
}

@media (prefers-reduced-motion: reduce) {
  html {
    scroll-behavior: auto;
  }
  * {
    animation: none !important;
    transition: none !important;
    scroll-behavior: auto !important;
  }
}

/* Safe-area padding for system UI (notches/taskbars) */
.app-shell {
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
}

/* Scrollbar utilities */
.scrollbar-hide {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

.scrollbar-hide::-webkit-scrollbar {
  display: none;
}

/* Glass morphism utilities */
.glass {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

@keyframes shimmer {
  0% {
    transform: translateX(-100%);
  }
  50% {
    transform: translateX(0%);
  }
  100% {
    transform: translateX(100%);
  }
}

.menu-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  width: 100%;
  padding: 0.45rem 1rem;
  font-size: 0.9rem;
  color: var(--text-muted);
  background: transparent;
  border: none;
  text-align: left;
  transition:
    background-color 150ms ease,
    color 150ms ease,
    border-color 150ms ease;
  cursor: pointer;
}

.menu-item:hover,
.menu-item:focus-visible {
  background-color: var(--surface-hover);
  color: var(--text-primary);
}

.menu-item:disabled {
  opacity: 0.45;
  cursor: not-allowed;
}

.menu-item svg {
  color: var(--text-muted);
}

.menu-item:hover svg,
.menu-item:focus-visible svg {
  color: var(--text-primary);
}

/* Animation for fade-in effects */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fadeIn {
  animation: fadeIn 0.3s ease-out;
}

/* DAY 2: Mobile UI Improvements */

/* Responsive breakpoints */
@media (max-width: 767px) {
  /* Mobile-specific styles */
  :root {
    --mobile-padding: 16px;
    --mobile-card-padding: 16px;
    --mobile-card-gap: 8px;
  }

  /* SPRINT 0: Touch targets - minimum 44x44px (all devices, not just mobile) */
  button,
  a,
  [role='button'],
  input[type='button'],
  input[type='submit'],
  [role='tab'],
  [role='menuitem'] {
    min-height: 44px;
    min-width: 44px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  /* Card spacing on mobile */
  .card-mobile {
    padding: var(--mobile-card-padding);
    margin-bottom: var(--mobile-card-gap);
  }

  /* Responsive grid - single column on mobile */
  .responsive-grid {
    grid-template-columns: 1fr !important;
  }
}

@media (min-width: 768px) and (max-width: 1023px) {
  /* Tablet-specific styles */
  :root {
    --tablet-padding: 24px;
    --tablet-card-padding: 20px;
    --tablet-card-gap: 12px;
  }

  /* Responsive grid - 2 columns on tablet */
  .responsive-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (min-width: 1024px) {
  /* Desktop-specific styles */
  :root {
    --desktop-padding: 32px;
    --desktop-card-padding: 24px;
    --desktop-card-gap: 16px;
  }

  /* Responsive grid - 3+ columns on desktop */
  .responsive-grid {
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  }
}

/* Mobile keyboard handling */
@media (max-width: 767px) {
  /* Prevent input from being hidden by keyboard */
  input:focus,
  textarea:focus {
    scroll-margin-bottom: 100px;
  }

  /* Adjust viewport on mobile when keyboard appears */
  .mobile-input-container {
    padding-bottom: env(keyboard-inset-height, 0px);
  }
}

/* Mobile scroll improvements */
@media (max-width: 767px) {
  /* Better scroll performance on mobile */
  * {
    -webkit-overflow-scrolling: touch;
  }

  /* Prevent scroll bounce on iOS */
  body {
    overscroll-behavior-y: none;
  }
}
